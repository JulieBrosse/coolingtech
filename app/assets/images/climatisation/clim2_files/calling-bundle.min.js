!function(e){function t(t){for(var i,a,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)a=s[d],r[a]&&p.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(u&&u(t);p.length;)p.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={4:0,6:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.swcJsonp=window.swcJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([370,0]),n()}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(91),r=window;t.swcWindow=r,r.swc=r.swc||r.SkypeWebControl||{},r.swc.shared=r.swc.shared||{},r.swc.scriptLoader=r.swc.scriptLoader||i.default,r.SKYPE=r.SKYPE||{},r.SkypeWebControl=r.swc;var o=r.swc;t.swc=o,t.SKYPE=r.SKYPE||{}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(124),a=n(18),s=n(33),c=n(0),l=n(38),u=n(21),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isFocused=!0,t.restart=function(){t.dispose(),t._initManagers&&t._initManagers(),t._signInManager.getSkypeToken().then(null,function(){}),t.MePersonManager.fetch(),t.restoreLastConversation()},t}return r(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.initServices=function(e){t._initParams=e,t.instance.SignInManager,t.instance.WebApi},t.prototype.dispose=function(){var e;e=this._mePersonManager,c.swc.MePersonManager,e&&(e.dispose(),e=null),this._amsManager&&this._amsManager.dispose(),this._persons&&this._persons.dispose(),this._isReady=!1,this._isCleared=!1},Object.defineProperty(t,"performanceData",{get:function(){return t._performanceData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MePersonManager",{get:function(){return this._mePersonManager||(this._mePersonManager=c.swc.MePersonManager),this._mePersonManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AgentsManager",{get:function(){return this._agentsManager||(this._agentsManager=new o.default),this._agentsManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AmsManager",{get:function(){return this._amsManager||(this._amsManager=u.getServices().amsManager),this._amsManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ContactsManager",{get:function(){return this._contactsManager||(this._contactsManager=u.getServices().contactsManager),this._contactsManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SignInManager",{get:function(){if(!this._signInManager&&(this._signInManager=u.getServices().signInManager,!this._signInManager)){var e=t._initParams;u.getServices().initManagers(l.default.locale,{tokenProvider:e.skypeTokenProvider,initialToken:e.initialSkypeTokenData,externalLogin:e.externalLogin,tokenType:e.tokenType}),this._signInManager=u.getServices().signInManager,this._signInManager&&this._signInManager.subscribe("resurrect",this.restart)}return this._signInManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Persons",{get:function(){return this._persons||(this._persons=u.getServices().persons),this._persons},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"TelemetryService",{get:function(){return this._telemetryService||(this._telemetryService=u.getServices().telemetryManager),this._telemetryService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PesManager",{get:function(){return this._pesManager||(this._pesManager=u.getServices().pesManager),this._pesManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SearchManager",{get:function(){return this._searchManager||(this._searchManager=u.getServices().searchManager),this._searchManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Storage",{get:function(){return s.default.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"WebApi",{get:function(){return this._webApi||(this._webApi=u.getServices().webApi),this._webApi},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"NotificationsManager",{get:function(){return u.getServices().notificationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wx",{get:function(){return u.getServices().wx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"i18n",{get:function(){return u.getServices().i18n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AvatarService",{get:function(){return u.getServices().avatarService},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCleared",{get:function(){return this._isCleared},set:function(e){e!==this._isCleared&&(this._isCleared=e,this.publish("isCleared",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFocused",{get:function(){return this._isFocused},set:function(e){e!==this._isFocused&&(this._isFocused=e,this.publish("isFocused",e))},enumerable:!0,configurable:!0}),t.prototype.setRestoreOfLastConversation=function(e){this._lastConversationCallback=e},t.prototype.restoreLastConversation=function(){this._lastConversationCallback&&this._lastConversationCallback()},t.prototype.setManagersInit=function(e){this._initManagers||(this._initManagers=e)},t._performanceData={},t.initPesManager=function(){u.getServices().initPesManager()},t}(a.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(24),o=n(24),a=n(19),s=n(66),c=function(){function e(){}return Object.defineProperty(e,"ECS",{get:function(){return i.swc.EcsConfig},set:function(e){i.swc.EcsConfig=e},enumerable:!0,configurable:!0}),e.getPlatformId=function(){if(e._platformID)return e._platformID;var t=a.default.getHost(),n={"outlook.live.com":915,"outlook-sdf.live.com":915,"interviews.skype.com":916,"interviews-df.skype.com":916,"interviews-int.skype.com":916,"www.bing.com":917,"www.staging-bing-int.com":917,"www.bing-int.com":917,"www.msn.com":918,"int.msn.com":918,"int1.msn.com":918,"wtskype2.azurewebsites.net":919,"azuresupportextension-ms.hosting.portal.azure.net":919,"portal.azure.com":919,"rc.portal.azure.com":919,"ms.portal.azure.com":919,"onedrive.live.com":920,"www.skype.com":921};for(var i in n)if(n.hasOwnProperty(i)&&t.indexOf(i)>-1)return n[i];return 912},e.getPlatformName=function(){switch(this.getPlatformId()){case 915:return"outlook";case 916:return"interviews";case 917:return"bing";case 918:return"msn";case 919:return"azureportal";case 920:return"onedrive";case 921:return"scom";default:return"other"}},e.getClientVersion=function(){if(e.CLIENT_VERSION!==e.DEFAULT_CLIENT_VERSION)return e.CLIENT_VERSION;for(var t=e.ECS.version.split("."),n=t.length,i=0;i<4-n;i++)t.splice(t.length-1,0,"0");return e.CLIENT_VERSION=e.getPlatformId()+"/"+t.join("."),e.CLIENT_VERSION},e.getChatClientInfo=function(){return this.CHAT_CLIENT_INFO?this.CHAT_CLIENT_INFO:(this.CHAT_CLIENT_INFO="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country=n/a; clientName=swc; clientVer="+e.getUiVersion(),this.CHAT_CLIENT_INFO)},e.getUiVersion=function(){return this.UI_VERSION?this.UI_VERSION:(this.UI_VERSION=e.getClientVersion()+"//swc",this.UI_VERSION)},e.getClientInfo=function(){if(this.SYSTEM_INFO)return this.SYSTEM_INFO;var t=o.UNKNOWN_VERSION;try{t=window.navigator.platform}catch(e){}return this.SYSTEM_INFO=e.getUiVersion()+"os="+r.default.getOsName()+"; osVer="+r.default.getOsVersion()+"; proc="+t+"; deviceType="+r.default.getDeviceType()+"; browser="+r.default.getBrowserName()+"; browserVer="+r.default.getBrowserVersion(),this.SYSTEM_INFO},e.APPNAME="SWC",e.LOCALE="en-us",e.PES_LOCALE="en",e.ORIGIN="SkypeLWC",e.ORIGIN_CALLING="SkypeCalling",e.MSG_MAX_LENGTH=2e3,e.SKYPE_TOKEN_KEY=s.SKYPE_TOKEN_KEY,e.SKYPE_REGTOKEN_KEY=s.SKYPE_REGTOKEN_KEY,e.PLATFORM_ID=912,e.BUTTON_MARKER_CLASS=".skype-button",e.CHAT_MARKER_CLASS=".skype-chat",e.RECENTS_MARKER_CLASS=".skype-recents",e.CHAT_FRAME_MARKER_CLASS=".lwc-chat-frame",e.CALL_FRAME_MARKER_CLASS=".swc-call-frame",e.LOGIN_CLIENT_ID="919866",e.LOGIN_PAGE_URL="https://login.skype.com/login",e.LOGIN_THEME="skype-white",e.LOGOUT_PAGE_URL="https://login.skype.com/logout",e.LOGIN_POPUP_URL="https://demoplayground.skype.com/joinlwc?t=",e.LOGIN_POPUP_FEATURES="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no",e.LOGOUT_POPUP_FEATURES="width=1, height=1, menubar=no, status=no, titlebar=no, toolbar=no",e.TEAMS_URL="https://api.teams.skype.com/",e.TEAMS_AUTH_URL="https://authsvc-server.teams.microsoft.com",e.TEAMS_PROFILE_URL="https://teams.microsoft.com/",e.SHAREPOINT_URL="https://microsoft-my.sharepoint.com/",e.AMS_HOST_URL="https://api.asm.skype.com/v1/",e.APS_HOST_URL="https://api.aps.skype.com/v1/",e.CDN_SERVICE_HOST="secure.skypeassets.com",e.OA_URL="https://pro.skype.com/v1/onboarding",e.OA_URL_INT="https://havana-latest.skype.com/v1/onboarding",e.URLP_SERVICE_URL="https://urlp.asm.skype.com",e.ECS_GRAPH_URL="https://skypegraph.skype.com/",e.MS_GRAPH_URL="https://graph.microsoft.com/v1.0/me/",e.MS_APP_CLIENT_ID="b8d5facb-2aee-4653-98cb-4acc8f0d0e97",e.MS_APP_SECRET="sYUC331musgrjOBHJ45$%_}",e.MS_APP_REDIRECT_URL_DEMO="https://latest-swc.cdn.skype.com/demo/connect.html",e.MS_APP_REDIRECT_URL_OUTLOOK="https://latest-swc.cdn.skype.com/demo/msauth.html",e.MS_AUTHORIZE_URL="https://login.microsoftonline.com/common/oauth2/v2.0/authorize",e.ECS_GRAPH_ETAG=null,e.ECS_GRAPH_SERVICE_SETTINGS=null,e.INVITE_HOST_URL_INT="https://latest-join.skype.com/api/v1/",e.INVITE_HOST_URL="https://join.skype.com/api/v1/",e.CHAT_CLIENT_INFO="",e.CHAT_GUEST_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_JOIN_URL="https://latest-join.skype.com/api/v2/conversation",e.SKYPE_CALLER_ID="lwc",e.CONTACTS_HOST_URL="https://edge.skype.com/pcs-df/contacts/v2/",e.CONTACTS_SCD_HOST_URL="https://scd.skype.com/contacts/v3/",e.AGENTS_HOST_URL="https://join.skype.com/",e.AVATAR_SERVICE_URL="https://avatar.skype.com/v1/",e.STRATUS_DOMAIN_HOST_URL="https://profile.skype.com/profile/v1/",e.WX_HOST_URL="https://wx.skype.com/api/v1/scom/",e.ECS_CLIENT_NAME="skype",e.ECS_TEAM_NAME="lwc",e.ECS_CLIENT_VERSION="1.00",e.GET_HELP_URL="https://support.skype.com/en/faq/FA34704/what-is-skype-web-control",e.CONCIERGE_BOT_MRI="28:concierge",e.CONCIERGE_BOT_DF_MRI="28:concierge_df",e.DEFAULT_CLIENT_VERSION=e.getPlatformId()+"/0.0.0.0",e.CLIENT_VERSION=e.DEFAULT_CLIENT_VERSION,e.DEFAULT_AVATAR_URI="https://swc.cdn.skype.com/assets/img/defaultAvatar.png",e.WELCOME_IMG_URI="https://swc.cdn.skype.com/assets/img/welcome_add_2x.png",e.MSG_DELETED_CLASSIC_SKYPE="Edited previous message: ",e.UI_VERSION="",e.SYSTEM_INFO="",e.MESSAGE_PROPERTIES={GLOBAL:{ACTIVITY_DATA:"activityData",PINNED:"pinned",PROTOTYPE_SKYPEX:"prototype_skypex"},PER_USER:{EMOTIONS:"emotions",POLL:"poll",TRANSLATIONS:"translations",ACTIVITY_DATA:"activityData",SMS_REPORT:"smsdeliveryreports"}},e.CHAT_SERVICE_COMMANDS={SET_MESSAGE_PROPERTY:"setMessageProperty",REMOVE_MESSAGE_PROPERTY:"removeMessageProperty",REMOVE_ALL_MESSAGES:"removeAllMessage",SET_IS_FAVORITE:"setIsFavorite",SMS_PRICE:"getSmsPrice"},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(6),o=n(23),a=n(135),s=n(248),c=n(17),l=n(13);n(152);var u=n(0),d=n(38),p=n(249),h=n(254),f=n(257),g=n(136),m=n(277),_=n(280),v=n(143),y=n(282),S=n(285),E=n(144),T=n(286),C=n(287),I=n(49),A=n(33),b=n(289),O=n(292),R=n(293),P=n(294),N=n(297),w=n(304),M=n(146),k=n(316),D=n(317),L=n(320),U=n(323),x=n(326),F=n(327),H=n(329),G=n(330),j=n(331),B=n(338),V=n(55),W=n(339),q=function(){function e(){this.activeEndpoints=[]}return e.setExternalLogin=function(t){e._externalLogin||(e._externalLogin=t)},Object.defineProperty(e,"initPromise",{get:function(){return e._initPromise.promise},enumerable:!0,configurable:!0}),Object.defineProperty(e,"signInManager",{get:function(){return e._skypeSignInManager?e._skypeSignInManager:null},enumerable:!0,configurable:!0}),Object.defineProperty(e,"storage",{get:function(){return A.default.get()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"localStorage",{get:function(){return A.LocalStorage.get()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"telemetryManager",{get:function(){return e._telemetryManager||(e._telemetryManager=new W.default),e._telemetryManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"conversations",{get:function(){return e._conversationsManager||(e._conversationsManager=new j.default),e._conversationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsGraphService",{get:function(){return new F.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"skypeGraphService",{get:function(){return new L.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"microsoftGraphService",{get:function(){return new P.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stratusService",{get:function(){if(!e._stratusService){var t=r.default.get.backend===l.MessagingBackend.TEAMS;e._stratusService=t?new x.default:new U.default}return e._stratusService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"amsService",{get:function(){return new p.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"amsManager",{get:function(){if(r.default.get.isTeams()){var t=!(!e._options||!e._options.fileSharing)&&!!e._options.fileSharing.forceEnterpriseAms;e._amsManager=new s.TeamsAmsManager(t)}else e._amsManager=new a.default;return e._amsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sharepointService",{get:function(){return new D.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"webApi",{get:function(){return this._webApi},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pesManager",{get:function(){return e._pesManager||(r.default.get.backend===l.MessagingBackend.TEAMS?e._pesManager=new k.default:e._pesManager=new M.default),e._pesManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsManager",{get:function(){return e._contactsManager||(e._contactsManager=new S.SkypeContactsManager),e._contactsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"searchManager",{get:function(){return e._searchManager||(r.default.get.backend===l.MessagingBackend.TEAMS?e._searchManager=new T.TeamsSearchManager:e._searchManager=new E.default),e._searchManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"persons",{get:function(){return e._persons||(e._persons=new B.default),e._persons},enumerable:!0,configurable:!0}),Object.defineProperty(e,"botsService",{get:function(){return new b.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsService",{get:function(){return e._agentsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsService",{get:function(){if(!e._contactsService){var t=r.default.get.backend===l.MessagingBackend.TEAMS;e._contactsService=t?new v.default:new y.default}return e._contactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"outlookContactsService",{get:function(){return e._outlookContactsService||(e._outlookContactsService=new _.default),e._outlookContactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"translatorService",{get:function(){return G.default},enumerable:!0,configurable:!0}),e.createDirectLineService=function(e,t){return new C.DirectLineV3(e,t)},Object.defineProperty(e,"oa",{get:function(){return w},enumerable:!0,configurable:!0}),Object.defineProperty(e,"wx",{get:function(){return O.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePerson",{get:function(){return e._mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationsManager",{get:function(){return e._notificationsManager||(e._notificationsManager=new N.default),e._notificationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"avatarService",{get:function(){return e._avatarService||(e._avatarService=new f.default),e._avatarService},enumerable:!0,configurable:!0}),e.setEverOpenedChats=function(t){e._everOpenedChats=t},e.signinStateHandler=function(){switch(this.signInManager.state){case o.SigninState.SignedOut:this.webApi.reset(),this.persons.dispose(),this._mePerson=null;break;case o.SigninState.SignedIn:this._mePerson||(this._mePerson=new R.default("8:"+this.signInManager.currentUserName))}},e.recetVisibilityHandler=function(t){if(e._isRecentsVisible=t,t){var n=Date.now().toString();A.LocalStorage.setItem("swc-recentslastseen",n),this._webApi.startEndpointActivation()}else e.isActive()||this._webApi.stopEndpointActivation()},e.chatShownHandler=function(t,n){if(n&&n.currentConversationId){if(t)return e._isChatShown=!0,void this.webApi.startEndpointActivation();e._isChatShown=!1;for(var i=Object.getOwnPropertyNames(e._everOpenedChats),r=0;r<i.length;r++){if(e._everOpenedChats[i[r]].onStage){e._isChatShown=!0;break}}e._isChatShown?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()}},e.focusHandler=function(t){e._isFocused=t,e._isFocused?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.callingStateHandler=function(t){var n=!1;if(t)switch(t.status){case 2:case 3:case 4:case 9:n=!0}e._isInCall=n,n?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.updateListOfActiveEndpoints=function(e){},e.isActive=function(){return(e._isInCall||e._isFocused)&&(e._isRecentsVisible||e._isChatShown)},e._initPromise=new c.CancelablePromise,e._everOpenedChats={},e._agentsService=new h.default,e._pesInitialized=!1,e.isZombie=!0,e.initManagers=function(t,n,o){e._options=o,e._skypeSignInManager||(e._skypeSignInManager=new V.default(n.tokenProvider,n.initialToken,n.externalLogin||e._externalLogin,n.tokenType),e.signInManager.subscribe("state",e.signinStateHandler.bind(e))),e._webApi||(r.default.get.backend===l.MessagingBackend.TEAMS?e._webApi=new m.ConversationTeamsWebApi:e._webApi=new g.ConversationConsumerWebApi);var a=e._initPromise.resolve.bind(e._initPromise),s=e._initPromise.cancel.bind(e._initPromise);I.default.init(t||d.default.locale).then(a,s),u.swc.API.registerEvent(i.ApiEvents.InappActivityStarted,H.default.send),u.swc.API.registerEvent(i.ApiEvents.recentsShown,e.recetVisibilityHandler.bind(e,!0)),u.swc.API.registerEvent(i.ApiEvents.recentsHidden,e.recetVisibilityHandler.bind(e,!1)),u.swc.API.registerEvent(i.ApiEvents.onControlShow,e.chatShownHandler.bind(e,!0)),u.swc.API.registerEvent(i.ApiEvents.onControlHide,e.chatShownHandler.bind(e,!1)),u.swc.API.registerEvent(i.ApiEvents.onControlClose,e.chatShownHandler.bind(e,!1)),u.swc.API.registerEvent(i.ApiEvents.onFocused,e.focusHandler.bind(e)),u.swc.API.registerEvent(i.ApiEvents.CallStatusChanged,e.callingStateHandler.bind(e)),u.swc.API.registerEvent(i.ApiEvents.CallStatusChanged,e.notificationsManager.callStateHandler.bind(e.notificationsManager))},e.initPesManager=function(){e._pesInitialized||(e.signInManager.onceSignedIn().then(function(){e.pesManager.init()}),e._pesInitialized=!0)},e._isRecentsVisible=!1,e._isChatShown=!1,e._isFocused=!1,e._isInCall=!1,e}();t.default=q},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.CreateControl="createControl",e.IncomingCall="incomingCall",e.CallingReady="callingReady",e.RecentsReady="recentsReady",e.InChatCallingReady="inChatCallingReady",e.BotAddedToThread="botAddedToThread",e.RecentDataLoaded="recentDataLoaded",e.StartChat="startChat",e.StartCall="startCall",e.AcceptCall="acceptCall",e.RejectCall="rejectCall",e.UpdateCallingScreen="updateCallingScreen",e.ForceExpandChat="forceExpandChat",e.ToggleExpressionPicker="toggleExpressionPicker",e.HideExpressionPicker="hideExpressionPicker",e.PesConfigInitialized="pesConfigInitialized",e.Ready="ready",e.ChatOpen="chat-open",e.Click="click",e.Fullscreenchange="fullscreenchange",e.UpdateUnreadMessageCounter="updateUnreadMessageCounter",e.InappActivityStarted="inappActivityStarted",e.ClientOpened="clientOpened",e.ClientFocused="clientFocused",e.ChatServiceUnavailable="chatServiceUnavailable",e.RemoveAllMessagesFromUi="removeAllMessagesFromUi",e.RequestEditingMessage="requestEditingMessage",e.OnVisibilityChange="onVisibilityChange",e.OnMessageSent="onMessageSent",e.OnMessageReceived="onMessageReceived",e.onFocused="onFocused",e.OnConversationReady="onConversationReady",e.onControlShow="onControlShow",e.onControlHide="onControlHide",e.onControlClose="onControlClose",e.OnCallStart="onCallStart",e.OnCallConnect="onCallConnect",e.OnCallEnd="onCallEnd",e.CallingLayoutChanged="callingLayoutChanged",e.CallLayoutChanged="callLayoutChanged",e.CallStatusChanged="callStatusChanged",e.DevicesPermissions="devicesPermissions",e.DominantSpeakerChanged="dominantSpeakerChanged",e.EndpointRegistered="endpointRegistered",e.RecentConversationsFetched="recentConversationsFetched",e.UnreadConversationsUpdate="unreadConversationsUpdate",e.ReceivedNotification="receivedNotification",e.HideNotification="hideNotification",e.OpenRecentList="openRecentList",e.recentsShown="recentsShown",e.recentsHidden="recentsHidden",e.RecentItemSelected="onRecentItemSelected",e.recentsUIReady="recentsUIReady",e.recentItemsLoaded="recentItemsLoaded",e.onMessageExpand="onMessageExpand",e.onMessageCollapse="onMessageCollapse",e.OnConversationDelete="onConversationDelete",e.scrollToBottom="scrollToBottom",e.hideBubbleWindow="hideBubbleWindow",e.errorCode="errorCode",e.invoke={sendMessageToBotResponse:"invoke:sendMessageToBot:response",sendMessageToBot:"invoke:sendMessageToBot",signOut:"invoke:signOut",startCall:"invoke:startCall",stopCall:"invoke:stopCall",setAad:"invoke:setAad",getTokenExpirationTime:"invoke:getTokenExpirationTime",registerMask:"registerMask",unregisterMask:"unregisterMask"},e.cmd={reg:"cmd:register",unreg:"cmd:unregister",exec:"cmd:execute"},e.threadNotificationsProxy={reg:"proxy:threadNotifications:register",unreg:"proxy:threadNotifications:unregister",notify:"proxy:threadNotifications:notify"},e.messagingProxy={disconnect:"proxy:messaging:disconnect",disconnected:"proxy:messaging:disconnected"},e.conversationProxy={disableInput:"proxy:conversation:disableInput",expand:"proxy:conversation:expand",connected:"proxy:conversation:connected",focusInput:"proxy:conversation:focusInput",openFilePicker:"proxy:conversation:filepicker",setInputPlaceholder:"proxy:conversation:placeholder",setMessageProperties:"proxy:conversation:setMessageProperties",setInputText:"proxy:conversation:inputtext",toggleEmoticonPicker:"proxy:conversation:emoticonpicker",showConfirmationDialog:"proxy:conversation:showConfirmationDialog",resShowConfirmationDialog:"proxy:conversation:resShowConfirmationDialog",regMessageReceived:"proxy:conversation:regMessageReceived",messageReceived:"proxy:conversation:messageReceived",regUnreadCount:"proxy:conversation:regUnreadCount",unreadCount:"proxy:conversation:unreadCount",setActionBar:"proxy:conversation:setActionBar",resActionBar:"proxy:conversation:resActionBar",regDownload:"proxy:conversation:regDownload",resDownload:"proxy:conversation:resDownload"},e.proxy={resolve:"proxy:resolve",request:"proxy:request"},e.bridge={theme:{request:"bridge:request:theme",return:"bridge:request:return"}},e}();t.ApiEvents=i;var r=function(){function e(){}return e.SELECTED_PARTICIPANTS_CHANGE="selectedParticipants:change",e}();t.ParticipantEvents=r;var o=function(){function e(){}return e.SCROLL_RECOUNT="scroll:recount",e}();t.ScrollEvents=o;var a=function(){function e(){}return e.ITEM_SELECT_REQUEST="pes:picker:selectRequest",e.ITEM_SEND_REQUEST="pes:picker:sendRequest",e.ITEM_CANCEL_REQUEST="pes:picker:cancelRequest",e.OPEN_PICKER="pes:picker:open",e.SEARCH_QUERY_CHANGED="pes:picker:searchQueryChanged",e.CLEAR_SEARCH_RESULTS="pes:picker:clearSearchResults",e}();t.ExpressionPickerEvents=a;var s=function(){function e(){}return e.SEARCH_START="search:start",e.SHOW_CONTACTS="show:contacts",e.UPDATE_SEARCH_RESULTS="search:updateResults",e.TOGGLE_RESULTS_COMPONENT="search:toggleResultsComponent",e.SEARCH_CREATE_CONTACTLIST="create:contactlist",e.EMPTY_QUERY="search:EmptyQuery",e.FOCUS_SEARCH_INPUT="search:FocusInput",e.EMPTY_RESULTS="search:emptyResults",e}();t.SearchEvents=s;var c=function(){function e(){}return e.SHOW="campaign:show",e.DISMISS="campaign:dismiss",e}();t.CampaignEvents=c,function(e){e.TokenProviderRequest="swc:auth:request:tokenprovider",e.TokenProviderResponse="swc:auth:response:tokenprovider",e.RegionGtmsRequest="swc:auth:request:regiongtms",e.RegionGtmsResponse="swc:auth:response:regiongtms"}(t.AuthEvents||(t.AuthEvents={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),r=function(){function e(){}return e.Create=function(t,n,r){void 0===r&&(r=i.PIIType.NotSet);var o=new e;return o.key=t,o.value=n,o.type=r,o},e}();t.TelemetryPropertyValue=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(18),s=n(13),c=n(0),l=n(38),u=function(e){function t(){var t=e.call(this)||this;return t.sessionId="",t.backend=s.MessagingBackend.UNDETERMINED,t.style="",t.translatorEnabled=!1,t.frameless=!1,t.callingReady=!1,t.standaloneCalling=!1,t.largeEmoticonClass=!1,t.isParallelView=!1,t.parentProtocol="n/a",t.bridge(),t}return r(t,e),Object.defineProperty(t,"get",{get:function(){return c.swc.shared.app||(c.swc.shared.app=new t),c.swc.shared.app},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLocale",{get:function(){return l.default.locale},enumerable:!0,configurable:!0}),t.prototype.copy=function(e){e&&Object.getOwnPropertyNames(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);i&&i.writable&&(t[n]=i.value||t[n])})},t.prototype.isTeams=function(){return this.backend===s.MessagingBackend.TEAMS},Object.defineProperty(t.prototype,"theme",{get:function(){return this._theme},set:function(e){e!==this._theme&&(this._theme=e,this.publish("theme",e))},enumerable:!0,configurable:!0}),t.prototype.bridge=function(){var e=this;c.swc.API.registerEvent(o.ApiEvents.bridge.theme.return,function(t){return e.theme=t}),c.swc.API.triggerEvent(o.ApiEvents.bridge.theme.request)},t}(a.default);t.default=u},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(29)),i(n(94)),i(n(95)),i(n(96)),i(n(41)),i(n(97))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(19),a=n(5);t.NA="n/a";var s=function(){function e(e){this.name=e,this.timestamp=Date.now(),this.type="general"}return e.prototype.getEventProperties=function(){return this.version=a.TelemetryPropertyValue.Create("version",r.default.ECS.version),this.host=a.TelemetryPropertyValue.Create("host",this.gethost()),this.isFirstPartyIntegration=a.TelemetryPropertyValue.Create("isFirstParty",this.isFirstParty()),this.lang=a.TelemetryPropertyValue.Create("locale",i.default.get.currentLocale),this.correlationId||(this.correlationId=a.TelemetryPropertyValue.Create("correlationId",i.default.get.correlationId)),this.identityType=this.identityType||a.TelemetryPropertyValue.Create("identitytype",t.NA),this.getCustomProperties()},e.prototype.getProperty=function(e){return void 0===e||null===e?t.NA:"string"!=typeof e?e+"":e},e.prototype.gethost=function(){return i.default.get.host&&i.default.get.host.toLowerCase()!==t.NA.toLowerCase()?i.default.get.host:o.default.getHost()||t.NA},e.prototype.isFirstParty=function(){var e=this.gethost();return[".skype.com",".bing.com",".live.com",".office.com",".office365.com",".msn.com",".linkedin.com",".azure.com",".microsoft.com"].some(function(t){return e.indexOf(t)>-1})},e}();t.TelemetryEvent=s},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HTTP_ERROR_RANGE=1e3]="HTTP_ERROR_RANGE",e[e.ERR_FAIL_INIT=1]="ERR_FAIL_INIT",e[e.ERR_PARSE_RESPONSE=111]="ERR_PARSE_RESPONSE",e[e.ERR_PARSE_RESPONSE2=112]="ERR_PARSE_RESPONSE2",e[e.INFO_CONVERSATION_ALREADY_SUBSCRIBED=1e4]="INFO_CONVERSATION_ALREADY_SUBSCRIBED",e[e.INFO_REQUESTED_ECS=10001]="INFO_REQUESTED_ECS",e[e.ERR_UNSUPPORTED_CONVERSATION_ID=10002]="ERR_UNSUPPORTED_CONVERSATION_ID",e[e.ERR_UNSUPPORTED_CONVERSATION_ID_TYPE=10003]="ERR_UNSUPPORTED_CONVERSATION_ID_TYPE",e[e.ERR_RESOURCE_ALREADY_HANDLED=10004]="ERR_RESOURCE_ALREADY_HANDLED",e[e.ERR_UPDATE_SUBSCRIPTION=10005]="ERR_UPDATE_SUBSCRIPTION",e[e.ERR_ME_PERSON_ALREADY_FETCHED=10006]="ERR_ME_PERSON_ALREADY_FETCHED",e[e.ERR_FETCH_ME_PERSON=10007]="ERR_FETCH_ME_PERSON",e[e.INFO_CONTACT_ALREADY_SUBSCRIBED=10008]="INFO_CONTACT_ALREADY_SUBSCRIBED",e[e.ERR_DESTINATION_NOT_REACHABLE=10009]="ERR_DESTINATION_NOT_REACHABLE",e[e.DBG_DL_REQUIRES_TOKEN=10011]="DBG_DL_REQUIRES_TOKEN",e[e.ERR_GET_CONVERSATION_ID=10021]="ERR_GET_CONVERSATION_ID",e[e.DL_SERVICE_CREATE_CONVERSATION=10024]="DL_SERVICE_CREATE_CONVERSATION",e[e.ERR_CREATE_CONVERSATION=10025]="ERR_CREATE_CONVERSATION",e[e.DL_SERVICE_SEND_MESSAGE=10023]="DL_SERVICE_SEND_MESSAGE",e[e.ERR_SEND_MESSAGE=10026]="ERR_SEND_MESSAGE",e[e.ERR_RESET_TOKEN=10027]="ERR_RESET_TOKEN",e[e.ERR_SET_TOKEN_REFRESH_TIMEOUT=10028]="ERR_SET_TOKEN_REFRESH_TIMEOUT",e[e.ERR_UNDEFINED_IDENTITY_TYPE=10029]="ERR_UNDEFINED_IDENTITY_TYPE",e[e.ERR_PARSE_JSON=10030]="ERR_PARSE_JSON",e[e.ERR_UNKNOWN_BACKEND=10033]="ERR_UNKNOWN_BACKEND",e[e.ERR_INVALID_TIMEOUT=10040]="ERR_INVALID_TIMEOUT",e[e.INFO_JSON_EMPTY=10041]="INFO_JSON_EMPTY",e[e.INFO_ASYNC_FLAG_NOT_BOOLEAN=10042]="INFO_ASYNC_FLAG_NOT_BOOLEAN",e[e.ERR_UNSUPPORTED_LANGUAGE=10050]="ERR_UNSUPPORTED_LANGUAGE",e[e.ERR_NOT_SUPPORTED_YET=10051]="ERR_NOT_SUPPORTED_YET",e[e.ERR_NAME_ALREADY_EXISTS=10060]="ERR_NAME_ALREADY_EXISTS",e[e.ERR_CALLBACK_NAMESPACE_ALREADY_EXISTS=10061]="ERR_CALLBACK_NAMESPACE_ALREADY_EXISTS",e[e.ERR_INIT_POLLING=10070]="ERR_INIT_POLLING",e[e.ERR_PARSE_POLLING=10071]="ERR_PARSE_POLLING",e[e.DL_SERVICE_INIT_POLLING=10072]="DL_SERVICE_INIT_POLLING",e[e.ERR_PES_CONFIG_LOAD=10080]="ERR_PES_CONFIG_LOAD",e[e.ERR_LOAD_IMG=10110]="ERR_LOAD_IMG",e[e.ERR_UNKNOWN_MESSAGE_TYPE=10250]="ERR_UNKNOWN_MESSAGE_TYPE",e[e.ERR_I18N_NOT_INITIALIZED=10500]="ERR_I18N_NOT_INITIALIZED",e[e.ERR_CONVERSATION_MISSING=10501]="ERR_CONVERSATION_MISSING",e[e.ERR_DEFINE_CONVERSATION_PREFIX=10502]="ERR_DEFINE_CONVERSATION_PREFIX",e[e.ERR_FETCH_ME_PERSON_AND_LOAD_PES=10503]="ERR_FETCH_ME_PERSON_AND_LOAD_PES",e[e.ERR_CREATE_GROUP_WITH_GUEST=10504]="ERR_CREATE_GROUP_WITH_GUEST",e[e.DBG_EMPTY_CHAT_SHOWN=10505]="DBG_EMPTY_CHAT_SHOWN",e[e.INFO_JOIN_GROUP_DISABLED=10506]="INFO_JOIN_GROUP_DISABLED",e[e.ERR_JOIN_CONVERSATION=10507]="ERR_JOIN_CONVERSATION",e[e.ERR_SENDING_MESSAGE_TO_BOT=10508]="ERR_SENDING_MESSAGE_TO_BOT",e[e.ERR_FETCH_THREAD=10509]="ERR_FETCH_THREAD",e[e.ERR_ADD_BOT_TO_CONVERSATION=10510]="ERR_ADD_BOT_TO_CONVERSATION",e[e.ERR_ADD_PERSON_TO_CONVERESATION=10511]="ERR_ADD_PERSON_TO_CONVERESATION",e[e.ERR_REMOVE_PERSON_FROM_CONVERSATION=10512]="ERR_REMOVE_PERSON_FROM_CONVERSATION",e[e.ERR_RESOLVE_USER_DETAILS=10801]="ERR_RESOLVE_USER_DETAILS",e[e.ERR_UPDATE_CALLING_SCREEN=10901]="ERR_UPDATE_CALLING_SCREEN",e[e.ERR_HIDE_CALLING_SCREEN=10902]="ERR_HIDE_CALLING_SCREEN",e[e.ERR_FETCH_CONTACTS_MAIN=11001]="ERR_FETCH_CONTACTS_MAIN",e[e.ERR_FETCH_CONTACT_MAIN=11002]="ERR_FETCH_CONTACT_MAIN",e[e.ERR_FETCH_CONTACTS_TEAMS=11010]="ERR_FETCH_CONTACTS_TEAMS",e[e.ERR_GET_ECS_CONFIG=12001]="ERR_GET_ECS_CONFIG",e[e.ERR_GET_ADVANCED_SEARCH_PARAMS=12002]="ERR_GET_ADVANCED_SEARCH_PARAMS",e[e.ERR_START_CONVERSATION=100001]="ERR_START_CONVERSATION",e[e.ERR_FETCH_ME_PERSON_IN_LIST=101010]="ERR_FETCH_ME_PERSON_IN_LIST",e[e.ERR_START_CONVERSATION_WITH_BOT=105001]="ERR_START_CONVERSATION_WITH_BOT",e[e.ERR_CHECK_CONVERSATION_STATUS=105002]="ERR_CHECK_CONVERSATION_STATUS",e[e.ERR_CREATE_SUMMARY_NOTIFICATION=200001]="ERR_CREATE_SUMMARY_NOTIFICATION",e[e.ERR_CREATE_CALL_NOTIFICATION=200003]="ERR_CREATE_CALL_NOTIFICATION",e[e.ERR_UNIFIED_PRESENCE_FAILED=103501]="ERR_UNIFIED_PRESENCE_FAILED",e[e.ERR_UNIFIED_PRESENCE_NO_AAD=103502]="ERR_UNIFIED_PRESENCE_NO_AAD"}(t.ErrorCodes||(t.ErrorCodes={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(10),o=n(86),a=n(0),s=function(){function e(){}return e.throwError=function(e,t,n,r){var s=new Error(function(){if(!n||0===Object.getOwnPropertyNames(n).length)return e+(t?": "+t:"");if("string"==typeof n)return n;var i="";return Object.getOwnPropertyNames(n).forEach(function(e){i+=e+": "+n[e]+";"}),i}()),c=new o.ErrorEvent;c.code=e+"",c.message=s.message,c.shortMessage=e+(t?": "+t:""),c.stack=s.stack,c.conversationId=r,a.swc.API.triggerEvent(i.ApiEvents.errorCode,e);try{a.swc.services.telemetryManager.sendEvent(c)}catch(e){}},e.throwHttpErrorCode=function(e,t){e+=r.ErrorCodes.HTTP_ERROR_RANGE,a.swc.API.triggerEvent(i.ApiEvents.errorCode,e)},e}();t.default=s},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.SKYPE=100]="SKYPE",e[e.DIRECT_LINE=200]="DIRECT_LINE",e[e.TEAMS=300]="TEAMS"}(t.MessagingBackend||(t.MessagingBackend={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(13),a=n(25),s=n(99),c=n(57),l={"<":"&lt;",">":"&gt;","&lt;":"<","&gt;":">","&LT;":"<","&GT;":">","&":"&amp;",'"':"&quot;","'":"&apos;","&amp;":"&","&quot;":'"',"&apos;":"'","&#39;":"'","&#96;":"`","&AMP;":"&","&QUOT;":'"',"&APOS;":"'"},u='(?:(?:\\s*title="[^"]+?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}',d=s.default.multilineRegExp(["(&lt;a ",u,'href="((?:https?://|mailto:)[^"]+?)"',u,"&gt;)","((?:(?!&lt;/a&gt;)[\\s\\S])*)","(&lt;/a&gt;)"],"gi"),p={ALLOWED_TAGS:["span","canvas"],ALLOWED_ATTR:["id","type","data-item-id","class","data-is-animated"]},h={ALLOWED_TAGS:["b","i","s","br","at","ss","h1","h2","h3","h4","h5","h6","span","div","quote","ul","li","ol","em","strong","br","canvas","p","title","description"],ALLOWED_ATTR:["tabindex","title","target","id","type","data-item-id","class","data-is-animated"]},f=function(){function e(){}return e.map=function(e){return l[e]},e.multilineRegExp=function(e,t){return new RegExp(e.join(""),t)},e.modifyLinkAnchorOpening=function(e,t){return e.search(s.default.escapeSpecialChars(t))>-1?e:e.replace(/(<a|&lt;a)/,function(e){return e+" "+t})},e.escapeBrackets=function(e){return e.replace(/([<>])/gi,this.map)},e.unescapeBrackets=function(e){return e.replace(/(&lt;|&gt;)/gi,this.map)},e.unescape=function(e){return e.replace(/(&lt;|&gt;|&amp;|&quot;|&apos;|&#39;|&#96;)/gi,this.map)},e.validateUnescapedLink=function(e){return this.escapeBrackets(e).replace(d,this.validateAnchor)},e.parseTopic=function(t){return t?(t?e.unescape(t):"").replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1").replace(/(<.*?\.{3,})$/,"").trim():t},e.getMessageSanitizedContent=function(e,t){var n={ALLOWED_TAGS:[],ALLOWED_ATTR:[]};return t&&t.noLinks?n=h:t&&t.noFormatting?n=p:(n={ALLOWED_TAGS:h.ALLOWED_TAGS.concat(["a"]),ALLOWED_ATTR:h.ALLOWED_ATTR.concat(["href"])},i.default.get.backend===o.MessagingBackend.TEAMS&&(n.ALLOWED_TAGS.push("img"),n.ALLOWED_ATTR.push("src","style","alt"))),a.default.dompurify.sanitize(e,n)},e.validateAnchor=function(t,n,i,r,o){var a=e.unescapeBrackets(n),s=e.unescapeBrackets(o);return 0!==i.indexOf("mailto:")&&(a=e.modifyLinkAnchorOpening(a,'target="_blank"')),a=e.modifyLinkAnchorOpening(a,'tabindex="-1"'),(a=e.modifyLinkAnchorOpening(a,'title="'+i+'"'))+r+s},e.webify=function(e){return e.replace(/(\r?\n)|(&lt;br\s?\/&gt;)/gm,"<br/>")},e.attachActionToLinks=function(e,t,n,i){if(1===e.nodeType&&e.matches(t))for(var r=e.querySelectorAll("a"),o=0;o<r.length;o++){var a=r[o];if(a.href.indexOf(n)>1){var s=c.default.getQueryParameter(a.href,n);s&&(a.setAttribute("data-swc-payload",s),a.addEventListener("click",i))}}},e.getSenderIdFromUrl=function(e){if(!e)return e;var t=e.match(/\/(\d+:[^?/]*)/);return t&&t[1]?t[1]:(e.match(/(\d+:[^?/]*)/),e)},e.extractMsgContent=function(e){return 0!==e.indexOf(r.default.MSG_DELETED_CLASSIC_SKYPE)?e:e.slice(r.default.MSG_DELETED_CLASSIC_SKYPE.length,e.length)},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),r=n(1),o=n(7),a=n(75),s=n(14),c=n(43),l=function(){function e(){var e=this;this.encoder=new i.default,this.decodeContent=function(t){return e.encoder.decode(t)}}return e.prototype.generate=function(e){return null},e.prototype._createMessageModel=function(e,t,n){void 0===n&&(n=!1);var i=new a.default(n),l=void 0!==t?t:e.content;n?e.customType&&(i.customType=e.customType):(i.senderId=s.default.getSenderIdFromUrl(e.from),i.sender=r.default.instance.Persons.getPerson(i.senderId,!0));var u=r.default.instance.MePersonManager.isMe(c.default.normalizePersonId(i.senderId));i.id=e.id,i.content=l?this.decodeContent(l):"",i.timestamp=new Date(e.originalarrivaltime),i.originalTimestamp=i.timestamp,i.composeTime=new Date(e.composetime),i.skypeEditedId=e.skypeeditedid,i.key=e.skypeeditedid||e.clientmessageid||e.id||"0",i.direction=n||!u?o.Direction.Incoming:o.Direction.Outgoing,i.rawMessageType=e.messagetype,i.clientMessageId=e.clientmessageid,i.editedTimestamp=e.properties&&e.properties.edittime?new Date(parseInt(e.properties.edittime,10)):null,i.deletedTimestamp=e.properties&&e.properties.deletetime?new Date(parseInt(e.properties.deletetime,10)):null;var d,p=!!e.skypeeditedid||!!i.editedTimestamp,h=!l&&!!e.skypeeditedid||!!i.deletedTimestamp;if(i.isEdited=p,i.isDeleted=h,i.version=Number(e.version),e.properties&&e.properties.files)try{var f=JSON.parse(e.properties.files);(d=i.files).push.apply(d,f)}catch(e){}return i},e.prototype._generateOutgoingModel=function(e){var t=new a.default(!1,e);return t.id=e.clientmessageid,t.timestamp=new Date(e.composetime),t.originalTimestamp=t.timestamp,t.key=e.clientmessageid,t.senderId=r.default.instance.MePersonManager.mePerson.mri,t.direction=o.Direction.Outgoing,t.content=this.decodeContent(e.content),t.processedContent=e.processedcontent,t.rawMessageType=e.messagetype,t.clientMessageId=e.clientmessageid,t},e.prototype.parseContentFor=function(e,t){var n=new RegExp("<"+t+">(.+?)</"+t+">","i"),i=e.match(n);return i?i[1]:""},e}();t.default=l},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(17),o=n(70),a=n(103),s=n(252),c=500;t.default=function(e,t,n,i){var r=this;return 0,new Promise(function(o,a){var s=function(u){l(e,t.timeout,n,i).then(function(e){e.callCount=u,o(e)}).catch(function(e){0===e.status&&u<t.retryCount?setTimeout(s.bind(r,u+1),c):a(e)})};s(1)})};var l=function(t,n,c,l){var d=Date.now(),p=l?l.method:null,h=function(e){var n=Date.now()-d;return e.ok||(s.ServiceFaultEvent.report(t,e,n,c+""),i.default.throwHttpErrorCode(e.status,e.statusText)),a.default().register(t,c+"",n,e,p),Promise.resolve(e)},f=function(e){var n=Date.now()-d;return s.ServiceFaultEvent.report(t,e,n,c+""),a.default().register(t,c+"",n,e,p),Promise.reject(e)};return o.get().onceOnline().then(function(){var t=e(c,l),i=new r.CancelablePromise(t);return u(i,n).then(h,f)},function(e){return Promise.reject(e)})},u=function(e,t){var n=setTimeout(function(){n=null,e.cancel({ok:!1,status:0,statusText:"Timeout"})},t),i=function(){n&&clearTimeout(n)};return e.promise.then(i,i),e.promise}}).call(this,n(61))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e){var t=this;this._isCanceled=!1,this._status=i.Pending,this.cancel=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t._isCanceled||(t._isCanceled=!0,e[0]=e[0]||{},e[0].isCanceled=!0,t._status=i.Rejected,t._reject.apply(t._promise,e))},this._promise=new Promise(function(n,r){t._resolve=n,t._reject=r,e&&(e.then(function(e){t._isCanceled||(t._status=i.Resolved,n(e))},function(e){t._status=i.Rejected,r(e)}),e.catch(function(e){t._status=i.Rejected,t._isCanceled?r({isCanceled:!0}):r(e)}))})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._status!==i.Resolved&&(this._status=i.Resolved,this._resolve.apply(this._promise,e))},e.prototype.cancelQuitely=function(){this.status===i.Pending&&(this.promise.then(function(){},function(){}),this.cancel())},e}();t.CancelablePromise=r,function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(i=t.PromiseStatus||(t.PromiseStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.callbacks={},this.subscribe=function(t,n){void 0===e.callbacks[t]&&(e.callbacks[t]=new Array),e.callbacks[t].push(n)},this.unsubscribe=function(t,n){if(void 0!==e.callbacks[t]){var i=e.callbacks[t].indexOf(n);i>-1&&e.callbacks[t].splice(i,1)}},this.publish=function(t,n){void 0!==e.callbacks[t]&&e.callbacks[t].map(function(e){return e}).forEach(function(e){e(n)})}}return e.prototype.dispose=function(){for(var e in this.callbacks)this.callbacks.hasOwnProperty(e)&&(this.callbacks[e]=null);this.callbacks={}},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(39),r=n(0),o=n(92),a={allowedDomains:["swc.cdn.skype.com","latest-swc.cdn.skype.com"]},s=function(){function e(){}return e.combine=function(e,t){return e.lastIndexOf("/")!==e.length-1&&"/"!==t.substring(0,1)?e+"/"+t:this.getAppPath()+e+t},e.getAbsoluteUrl=function(e,t){var n=this.getCompletePath(e,t),o="css"===t?"css/":"";return e===i.PackageName.SDK_LOADER_CHAT?this.combine(r.swc.EcsConfig.loaderUrl,n):e===i.PackageName.CONNECT?this.combine(r.swc.EcsConfig.loaderUrl,n):this.combine(o,n)},e.getCompletePath=function(e,t){var n="";switch(r.swc.EcsConfig.environment){case"df":case"ppe":case"prod":n=".min"}return""+e+n+"."+t},e.setQueryParameters=function(e,t){return e+"?"+this.buildQueryParameters(t)},e.buildQueryParameters=function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),t.join("&")},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e.getVendorPath=function(){return e.getCDNPath()+"/vendors"},e.getConnectPagePath=function(){return e.getAppPath()+"connect.html"},e.getAppPath=function(){var t=0===r.swc.EcsConfig.version.indexOf("fb-")?"fb":"v";return e.getCDNPath()+"/"+t+"/"+r.swc.EcsConfig.version+"/"},e.getCDNPath=function(){var t=r.swc.EcsConfig.domain;return e.validateUriOrDie(t,a),t},e.validateUriOrDie=function(e,t){if(!o.UrlValidator.instance.validate(e,t))throw new Error("Invalid URI!")},e.appendQueryParam=function(e,t,n){return e+(-1===e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(n)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guid={generate:function(){var e=new Uint16Array(8);(window.crypto||window.msCrypto).getRandomValues(e);var t=0,n=function(){return(4369|e[t++]).toString(16)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},isGuid:function(e){return/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(17),s=n(18),c=n(39),l=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getServices=function(){if(!l.swc||!l.swc.services)throw new Error("Unable to find services");return l.swc.services},t}(s.default);t.default=u,t.loadServices=function(){return o?o.promise:(o=new a.CancelablePromise,l.swc.services?(o.resolve(l.swc.services),o.promise):(l.swc.scriptLoader.addScript(c.PackageName.SERVICES,!0,function(){var e=l.swc.services;o.resolve(e)}),o.promise))},t.getServices=function(){var e=l.swc.services;if(!e)throw new Error("Services are not found");return e}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SignedOut=0]="SignedOut",e[e.SigningIn=1]="SigningIn",e[e.SignedIn=2]="SignedIn",e[e.SigningOut=3]="SigningOut"}(t.SigninState||(t.SigninState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o,a=n(33),s=n(28),c=n(20),l={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"};!function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Tablet="Tablet"}(i=t.DeviceType||(t.DeviceType={})),function(e){e.MSIE="MSIE",e.CHROME="Chrome",e.FIREFOX="Firefox",e.SAFARI="Safari",e.EDGE="Edge",e.ELECTRON="Electron",e.SKYPE_SHELL="SkypeShell",e.PHANTOMJS="PhantomJS",e.UNKNOWN="Unknown"}(r=t.BrowserVendor||(t.BrowserVendor={})),function(e){e.WINDOWS="Windows",e.MACOSX="Mac OS X",e.WINDOWS_PHONE="Windows Phone",e.WINDOWS_RT="Windows RT",e.IOS="iOS",e.ANDROID="Android",e.LINUX="Linux",e.UNKNOWN="Unknown"}(o=t.OperatingSystem||(t.OperatingSystem={})),t.UNKNOWN_VERSION="U";var u=function(){function e(){}return e.getDeviceType=function(){return window.navigator.userAgent.match(/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i)?i.Mobile:window.navigator.userAgent.match(/tablet|ipad/i)?i.Tablet:i.Desktop},e.getUserAgent=function(){return s.default.getWindow().navigator.userAgent},e.userAgentContainsString=function(e){return this.getUserAgent().indexOf(e)>-1},e.isChrome=function(){return this.userAgentContainsString(r.CHROME)&&!this.userAgentContainsString(r.EDGE)},e.isIe=function(){return this.userAgentContainsString("Trident")},e.isEdge=function(){return this.userAgentContainsString(r.EDGE)},e.isOpera=function(){return this.userAgentContainsString("OPR/")},e.testSupporedList=function(t){if(!t)return!1;t.constructor!==Array&&"string"==typeof t&&(t=[t]);for(var n=e.getBrowserName().toLocaleLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase().indexOf(n)>-1)return!0;return!1},e.getBrowserName=function(){return this.isOpera()?r.UNKNOWN:this.userAgentContainsString(r.PHANTOMJS)?r.PHANTOMJS:this.isEdge()?r.EDGE:this.userAgentContainsString(r.ELECTRON)?r.ELECTRON:this.userAgentContainsString(r.CHROME)?r.CHROME:this.userAgentContainsString(r.FIREFOX)?r.FIREFOX:this.userAgentContainsString(r.SAFARI)?r.SAFARI:this.userAgentContainsString(r.SKYPE_SHELL)?r.SKYPE_SHELL:this.isIe()?r.MSIE:r.UNKNOWN},e.getBrowserVersion=function(){var e,n,i,o,a,s=this;return this.isIe()?(o=s.getUserAgent(),(a=o.match(new RegExp(r.MSIE+" ([\\d,.]+)")))?a[1]:(i=o.match(new RegExp("rv:([\\d,.]+)")))?i[1]:void 0):((e=this.getBrowserName())===r.SAFARI&&(e="Version"),(n=s.getUserAgent().match(new RegExp(e+"/([\\d,.]+)")))?n[1]:t.UNKNOWN_VERSION)},e.getScreenInfo=function(){var e=s.default.getWindow(),t=s.default.getWindow().navigator;return{width:s.default.getWindow().screen&&s.default.getWindow().screen.width||0,height:s.default.getWindow().screen&&s.default.getWindow().screen.height||0,pixelRatio:s.default.getWindow().devicePixelRatio||0,colorDepth:s.default.getWindow().screen&&s.default.getWindow().screen.colorDepth||0,isTouchEnabled:Object.prototype.hasOwnProperty.call(e,"ontouchstart")||t.MaxTouchPoints>0}},e.getOsName=function(){var e=this.getUserAgent();return e.match(/windows\sphone\s\d+\.\d+/i)?o.WINDOWS_PHONE:e.match(/ arm;/i)?o.WINDOWS_RT:e.match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?o.IOS:e.match(/android/i)?o.ANDROID:e.match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i)?o.LINUX:e.match(/(macintosh|mac os x)/i)?o.MACOSX:e.match(/(windows|win32)/i)?o.WINDOWS:o.UNKNOWN},e.getOsVersion=function(e){var n=this;void 0===e&&(e=!1);var i;return this.getOsName()===o.WINDOWS?function(e){var i=n.getUserAgent().match(new RegExp("Windows NT ([\\d,.]+)"));if(i){if(e)return i[1];if(l[i[1]])return l[i[1]]}return t.UNKNOWN_VERSION}(e):this.getOsName()===o.MACOSX&&(i=n.getUserAgent().match(new RegExp(o.MACOSX+" ([\\d,_,.]+)")))?i[1].replace(/_/g,"."):t.UNKNOWN_VERSION},e.getDeviceId=function(){var e=a.LocalStorage,t=e.getItem("swc-deviceId");return t||(t=c.guid.generate(),e.setItem("swc-deviceId",t)),t},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return Object.defineProperty(e,"dompurify",{get:function(){var e=window;return e.DOMPurify||(e.DOMPurify=n(68)),e.DOMPurify},enumerable:!0,configurable:!0}),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.PERSON=1]="PERSON",e[e.THREAD=2]="THREAD",e[e.BOT=3]="BOT",e[e.JOIN_URL=4]="JOIN_URL",e[e.DIRECT_LINE_TOKEN=5]="DIRECT_LINE_TOKEN",e[e.PHONE=6]="PHONE"}(t.SDKMode||(t.SDKMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(1),o=n(13),a=function(){function e(e,t,n){var i=this;this._createMessageModel=e,this._generateContent=t,this._subscribedCallbacks={},this._subscribeOnceToPersonsName=function(e){i._subscribedCallbacks[e.id]||(i._subscribedCallbacks[e.id]=i._onDisplayNameChanged.bind(i,e.id),e.subscribe("displayName",i._subscribedCallbacks[e.id]))},this._onDisplayNameChanged=function(e){i._messageModel.content=i._generateContent(i),i._initiator.unsubscribe("displayName",i._subscribedCallbacks[e])},this._getInitiatorFromContent(n.content),this._getTargetsFromContent(n.content),this._messageModel=this._createMessageModel(n,this._generateContent(this),!0)}return e.prototype._isSelfAction=function(){return 1===this._targets.length&&this._targets[0].id===this._initiator.id},e.prototype._getInitiatorFromContent=function(e){var t=e.match(/<initiator>(\d+:.+)<\/initiator>/i);t&&(this._initiator=r.default.instance.Persons.getPerson(t[1]))},e.prototype._getTargetsFromContent=function(e){var t=this,n=/(?:<target>|<id>)(\d+:.+?)(?:<\/id>|<\/target>)/i,a=[];(e.match(/<target>.+?<\/target>/gi)||[]).forEach(function(e){var t=e.match(n);t&&a.push(t[1])}),this._targets=a.map(function(e){return r.default.instance.Persons.getPerson(e)}),i.default.get.backend===o.MessagingBackend.TEAMS&&(this._targets=this._targets.filter(function(e){return e.mri!==t._initiator.mri}))},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getWindow=function(){return window},e.getDocument=function(){return window.document},e.getParentWithClass=function(e,t){for(;e&&!this.hasClass(e,t);)e=e.parentNode;return e},e.isInViewport=function(e){var t=this.getWindow();return e.bottom>0&&e.right>0&&e.top<t.innerHeight&&e.left<t.innerWidth},e.readDataset=function(e,t,n){return e.dataset?e.dataset[t]:e.getAttribute("data-"+n)},e.writeDataset=function(e,t,n,i){e.dataset?e.dataset[t]=i:e.setAttribute("data-"+n,i)},e.hasClass=function(e,t){if(e.classList)return e.classList.contains(t);for(var n=0,i=e.className?e.className.split(" "):[];n<i.length;n++){if(i[n]===t)return!0}return!1},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Skype=8]="Skype",e[e.Agent=28]="Agent",e[e.Pstn=4]="Pstn",e[e.MSA=1]="MSA",e[e.Undefined=0]="Undefined"}(t.ContactType||(t.ContactType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NotSet=0]="NotSet",e[e.Identity=10]="Identity"}(t.PIIType||(t.PIIType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),r=n(11),o=n(26),a=n(10),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return i.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=i.ConversationType.JOIN,i.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=i.ConversationType.AGENT,i.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=i.ConversationType.GROUP,i.ConversationType.GROUP;if(/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,"")))return this.typeMapppings[e]=i.ConversationType.PHONE,i.ConversationType.PHONE;return/^(99:)?([A-Z]|[a-z][^\.])+([\S])*\.(cwA|dAA)/i.test(e)?(this.typeMapppings[e]=i.ConversationType.DIRECT_LINE,i.ConversationType.DIRECT_LINE):(this.typeMapppings[e]=i.ConversationType.PERSON,i.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case i.ConversationType.PERSON:return o.SDKMode.PERSON;case i.ConversationType.AGENT:return o.SDKMode.BOT;case i.ConversationType.JOIN:return o.SDKMode.JOIN_URL;case i.ConversationType.DIRECT_LINE:return o.SDKMode.DIRECT_LINE_TOKEN;case i.ConversationType.PHONE:return o.SDKMode.PHONE;case i.ConversationType.GROUP:return o.SDKMode.THREAD}return o.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case o.SDKMode.PERSON:return"8";case o.SDKMode.BOT:return"28";case o.SDKMode.THREAD:return"19";case o.SDKMode.DIRECT_LINE_TOKEN:return"99";case o.SDKMode.PHONE:return"4";default:r.default.throwError(a.ErrorCodes.ERR_DEFINE_CONVERSATION_PREFIX,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return i.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return i.ConversationType.PHONE;case"8":return i.ConversationType.PERSON;case"19":return i.ConversationType.GROUP;case"28":return i.ConversationType.AGENT;case"99":return i.ConversationType.DIRECT_LINE;default:return i.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.GUEST=100]="GUEST",e[e.SKYPE=200]="SKYPE",e[e.DL_TOKEN=300]="DL_TOKEN",e[e.TEAMS=400]="TEAMS"}(t.IdentityType||(t.IdentityType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getItem=function(e){return this.get().getItem(e)},e.setItem=function(e,t){this.get().setItem(e,t)},e.removeItem=function(e){this.get().removeItem(e)},e.get=function(){if(this._storage)return this._storage;try{"object"==typeof sessionStorage&&(localStorage.setItem("ls","0"),localStorage.removeItem("ls"),this._storage=window.sessionStorage)}catch(e){this._storage=new o}return this._storage},e}();t.default=i;var r=function(){function e(){}return e.getItem=function(e){var t=this.get();return t?t.getItem(e):""},e.setItem=function(e,t){this.get().setItem(e,t)},e.removeItem=function(e){this.get().removeItem(e)},e.get=function(){if(this._storage)return this._storage;try{"object"==typeof localStorage&&(localStorage.setItem("ls","0"),localStorage.removeItem("ls"),this._storage=window.localStorage)}catch(e){this._storage=new o}return this._storage},e}();t.LocalStorage=r;var o=function(){function e(){this._items={}}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.length=0},e.prototype.getItem=function(e){return this._items[e]},e.prototype.key=function(e){return null},e.prototype.removeItem=function(e){delete this._items[e]},e.prototype.setItem=function(e,t){this._items[e]=t},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),r={id:"flik",ariaLabelLocKey:"expressionPicker_mruMojiPack_ariaLabel",titleLocKey:"expressionPicker_mruMojiPack_title",mruLimit:10},o=function(){function e(){var e=this;this.CACHE_KEY="swx|pes",this.SAVED_DATA_VERSION="v1.0",this.FEATURED_IN_PREFIX="FeaturedIn-",this.pesCDNAuthentication={skypeServiceHost:"static.asm.skype.com",tokenSourceEndpoint:"/pes/v1/petoken",cdnServiceHost:"static-asm.secure.skypeassets.com",cookieSourceEndpoint:"/token/token_to_cookies",securedPathsPatter:"static[.]asm[.]skype[.]com",cdnTokenTtlMs:3e5,rewriteRules:[{from:"static.asm.skype.com",to:"static-asm.secure.skypeassets.com"},{from:"api.asm.skype.com",to:"static-asm.secure.skypeassets.com"}]},this.itemTypes={typeKeyName:"type",tab:{id:"tab",ariaLabelLocKey:"expressionPicker_mruTab_ariaLabel",titleLocKey:"expressionPicker_mruTab_title"},emoticon:{id:"emoticon",ariaLabelLocKey:"expressionPicker_mruEmoticonPack_ariaLabel",titleLocKey:"expressionPicker_mruEmoticonPack_title",mruLimit:27},moji:r,image:{id:"image"},message:{id:"message"},sticker:{id:"sticker"},flik:r},this.mru={TAB_ID:"mru",PACK_PREFIX:"mru:"},this.bingSearch={TAB_ID:"bing",PACK_PREFIX:"bing:"},this.giphyImageSearch={TAB_ID:"giphyImages",PACK_PREFIX:"giphy-imh:"},this.localSearch={TAB_ID:"localSearch",PACK_PREFIX:"local:",titleLocKey:"expressionPicker_localSearchPack_title",ariaLabelLocKey:"expressionPicker_localSearchPack_ariaLabel"},this.frameHeights={emoticons:{SMALL:20,LARGE:40,EXTRA_LARGE:60,SUPER_LARGE:120},moji:{THUMBNAIL:40,KEYFRAME:80},packs:{TAB:19}},this.profiles={emoticons:{getSmall:function(){return e.highDpi?"default_40_f":"default_20_f"},getLarge:function(){return e.highDpi?"default_80_f":"default_40_f"},getExtraLarge:function(){return e.highDpi?"default_120_f":"default_60_f"},getSuperLarge:function(){return e.highDpi?"default_240_f":"default_120_f"},getSmallAnimated:function(){return e.highDpi?"default_40_anim_f":"default_20_anim_f"},getLargeAnimated:function(){return e.highDpi?"default_80_anim_f":"default_40_anim_f"},getExtraLargeAnimated:function(){return e.highDpi?"default_120_anim_f":"default_60_anim_f"},getSuperLargeAnimated:function(){return e.highDpi?"default_240_anim_f":"default_120_anim_f"}},moji:{thumbnail:"thumbnail",content:"default"}}}return Object.defineProperty(e.prototype,"highDpi",{get:function(){return this._highDpi||(this._highDpi=i.default.getScreenInfo().pixelRatio>1),this._highDpi},enumerable:!0,configurable:!0}),e}();t.default=new o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={"Âª":"a","Âº":"o","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã§":"c","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã±":"n","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã½":"y","Ã¿":"y","Ä":"a","Äƒ":"a","Ä…":"a","Ä‡":"c","Ä‰":"c","Ä‹":"c","Ä":"c","Ä":"d","Ä“":"e","Ä•":"e","Ä—":"e","Ä™":"e","Ä›":"e","Ä":"g","ÄŸ":"g","Ä¡":"g","Ä£":"g","Ä¥":"h","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä³":"ij","Äµ":"j","Ä·":"k","Äº":"l","Ä¼":"l","Ä¾":"l","Å€":"lÂ·","Å„":"n","Å†":"n","Åˆ":"n","Å‰":"Ê¼n","Å":"o","Å":"o","Å‘":"o","Å•":"r","Å—":"r","Å™":"r","Å›":"s","Å":"s","ÅŸ":"s","Å¡":"s","Å£":"t","Å¥":"t","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Åµ":"w","Å·":"y","Åº":"z","Å¼":"z","Å¾":"z","Å¿":"s","Æ¡":"o","Æ°":"u","Ç†":"dz","Çˆ":"Lj","Ç‰":"lj","Ç‹":"Nj","ÇŒ":"nj","ÇŽ":"a","Ç":"i","Ç’":"o","Ç”":"u","Ç–":"u","Ç˜":"u","Çš":"u","Çœ":"u","ÇŸ":"a","Ç¡":"a","Ç§":"g","Ç©":"k","Ç«":"o","Ç­":"o","Ç°":"j","Ç³":"dz","Çµ":"g","Ç¹":"n","Ç»":"a","È":"a","Èƒ":"a","È…":"e","È‡":"e","È‰":"i","È‹":"i","È":"o","È":"o","È‘":"r","È“":"r","È•":"u","È—":"u","È™":"s","È›":"t","ÈŸ":"h","È§":"a","È©":"e","È«":"o","È­":"o","È¯":"o","È±":"o","È³":"y","Ê°":"h","Ê²":"j","Ê³":"r","Ê·":"w","Ê¸":"y","Ë¡":"l","Ë¢":"s","Ë£":"x"},r=function(){function e(){}return e.toBoolean=function(e){return e?"true"===e.toLowerCase():null},e.wordAt=function(e,t){var n=this.wordBoundariesAt(e,t);return e.substring(n.start,n.end)},e.inject=function(e,t,n,i){return void 0===i&&(i=n),e.substr(0,n)+t+e.substr(i,e.length)},e.wordBoundariesAt=function(e,t){var n=e.substring(0,t).search(/\S+$/),i=e.substring(t).search(/\s/);return-1===n&&(n=t),-1===i?i=e.length:i+=t,{start:n,end:i}},e.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},e.zipString=function(e,t){return 0===e.length?t:0===t.length?e:e[0]+t[0]+this.zipString(e.substr(1),t.substr(1))},e.normalizeString=function(e){if(e=e.toLowerCase(),String.prototype.normalize)return e.normalize("NFKD").replace(/[\u0300-\u036f]/g,"");var t=parseInt("0xD800",16),n=parseInt("0xDBFF",16),r=0,o="",a="",s=void 0;if(!e)return e;for(;r<e.length;)o+=e.charAt(r),((s=e.charCodeAt(r))<t||s>n)&&(a+=i.hasOwnProperty(o)?i[o]:o,o=""),r++;return a},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(30),s=n(13),c=n(26),l=n(11),u=n(31),d=n(5),p=n(8),h=n(10),f=function(e){function t(t,n){var i=e.call(this,t)||this;i.conversation=n,i._topic=p.NA,i._topic=n.topic;return i._topicUpdateHandler=function(e){i._topic=e}.bind(i),n.subscribe("topic",i._topicUpdateHandler),i}return r(t,e),t.prototype.getCustomProperties=function(){this.conversation.unsubscribe("topic",this._topicUpdateHandler);var e=new Array;return e.push(this.getConversationId()),e.push(d.TelemetryPropertyValue.Create("conversationType",this.conversation.getConversationType())),e.push(this.getSDKMode()),e.push(this.getBackend()),e.push(this.getConversationTopic()),e.push(this.getTrafficProvider()),e.push(this.getTrafficSource()),e},t.prototype.getConversationId=function(){switch(this.conversation.getConversationType()){case o.ConversationType.AGENT:case o.ConversationType.DIRECT_LINE:return d.TelemetryPropertyValue.Create("conversationId",u.default.getNormalizeId(this.conversation.id));default:return d.TelemetryPropertyValue.Create("conversationId",u.default.getNormalizeId(this.conversation.id),a.PIIType.Identity)}},t.prototype.getConversationTopic=function(){var e=p.NA;return this.conversation.getConversationType()!==o.ConversationType.AGENT&&this.conversation.getConversationType()!==o.ConversationType.DIRECT_LINE||(e=this._topic&&""!==this._topic?this._topic:p.NA),d.TelemetryPropertyValue.Create("conversationTopic",e)},t.prototype.getBackend=function(){var e="",t=this.conversation.getBackend();switch(t){case s.MessagingBackend.UNDETERMINED:e=p.NA;break;case s.MessagingBackend.SKYPE:e="Skype";break;case s.MessagingBackend.DIRECT_LINE:e="DirectLine";break;case s.MessagingBackend.UNDEFINED:e=p.NA;break;default:l.default.throwError(h.ErrorCodes.ERR_UNKNOWN_BACKEND,"Unknown backend:"+t)}return d.TelemetryPropertyValue.Create("backend",e)},t.prototype.getSDKMode=function(){var e="",t=u.default.getSdkModeFromId(this.conversation.id);switch(t){case c.SDKMode.BOT:e="bot";break;case c.SDKMode.DIRECT_LINE_TOKEN:e="DirectLine";break;case c.SDKMode.JOIN_URL:e="url";break;case c.SDKMode.PERSON:e="person";break;case c.SDKMode.THREAD:e="thread";break;case c.SDKMode.PHONE:e="phone";break;case c.SDKMode.UNDEFINED:e=p.NA;break;default:l.default.throwError(h.ErrorCodes.ERR_UNDEFINED_IDENTITY_TYPE,"Unknown identityType:"+t)}return d.TelemetryPropertyValue.Create("sdkMode",e)},t.prototype.getTrafficProvider=function(){var e=this.conversation.definition?this.conversation.definition.TrafficProvider:p.NA;return d.TelemetryPropertyValue.Create("provider",e)},t.prototype.getTrafficSource=function(){var e=this.conversation.definition?this.conversation.definition.TrafficSource:p.NA;return d.TelemetryPropertyValue.Create("source",e)},t}(p.TelemetryEvent);t.ConversationDataEvent=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,i){var r=[];for(r.push(t);0!==r.length;){var o=r.pop();o.nodeType===Node.TEXT_NODE?this.encodeTextNodeToXml(e,o,n,i):this.isElementAllowed(o)&&this.pushChildNodes(r,o)}},e.prototype.wordMatcher=function(){return/[\w()#:\-=<>;'\|\$"\]\*\^&\+@\{\?ÆŽ\/\\!~]+/g},e.prototype.getAllWords=function(e){for(var t,n=this.wordMatcher(),i=new Array;null!==(t=n.exec(e));)i.push(t);return i},e.prototype.encodeTextNodeToXml=function(e,t,n,i){var r=t.parentNode,o=this.encodeWords(e,t,n,i);o&&o.length&&(o.forEach(function(e){r.insertBefore(e,t)}),r.removeChild(t))},e.prototype.encodeWords=function(e,t,n,i){var r=this,o=t.nodeValue,a=0,s=[];return this.getAllWords(o).forEach(function(t){var c=r.wordRawToXml(e,t[0],n,i);0!==c.length&&(a!==t.index&&s.push(e.createTextNode(o.substring(a,t.index))),a=t.index+t[0].length,s=s.concat(c))}),0!==a&&a<o.length&&s.push(e.createTextNode(o.substring(a))),s},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.WordDomTransformer=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return Object.defineProperty(e,"locale",{get:function(){return this._locale?this._locale:document.documentElement.lang?document.documentElement.lang.toLowerCase():window.navigator.languages&&0!==window.navigator.languages.length?window.navigator.languages[0].toLowerCase():navigator.language.toLowerCase()},set:function(e){e=e||"",this._locale=e.toLowerCase()},enumerable:!0,configurable:!0}),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.DIRECTLINE_CHAT="directline-bundle",e.SDK_LOADER_CHAT="sdk-loader",e.SDK_CORE="sdk-core",e.ASSETS="assets-bundle",e.BUILDER="builder-bundle",e.BUILDER_CORE="builder-core",e.CALLING="calling-bundle",e.CALLING_STANDALONE="callingStandalone-bundle",e.SERVICES="services-bundle",e.CHAT_BUNDLE="chat-bundle",e.RECENTS_BUNDLE="recents-bundle",e.UICOMPONENT_BUNDLE="uicomponent-bundle",e.INDEX_BUILDER="index-builder",e.INDEX_CHAT="lwc-chat-index",e.INDEX_CALLING="calling-index",e.INDEX_RECENTS="recents-index",e.CONNECT="connect",e.HOST_CHAT_PAGE="host-chat",e.HOST_BING_PAGE="host-button",e.HOST_BUILDER_PAGE="host-builder",e.STYLE_BUILDER="swc-builder",e.STYLE_SDK="swc-sdk",e.STYLE_CHAT_SKYPE="swc-chat",e.STYLE_RECENTS_SKYPE="swc-recents",e.STYLE_CHAT_BING="swc-bing",e.STYLE_CHAT_THEME_DARK="swc-dark",e.STYLE_CALLING="swc-calling",e}();t.PackageName=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.callbacks=new Array,t.pushObservable=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];e.prototype.push.apply(t,n);var r=new a;return r.newItems=n,t.publish(r),t.length},t.popObservable=function(){var n=e.prototype.pop.call(t);return t.publish(),n},t.shiftObservable=function(){var n=e.prototype.shift.call(t);return t.publish(),n},t.unshiftObservable=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];e.prototype.unshift.apply(t,n);var r=new a;return r.newItems=n,t.publish(r),t.length},t.sortObservable=function(n){var i=e.prototype.sort.call(t,n);return t.publish(),i},t.spliceObservable=function(n,i){for(var r,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];r=i?o?e.prototype.splice.apply(t,[n,i].concat(o)):e.prototype.splice.call(t,n,i):e.prototype.splice.call(t,n);var c=new a;return c.oldItems=r,t.publish(c),r},t.subscribe=function(e){t.callbacks.push(e)},t.unsubscribe=function(e){var n=t.callbacks.indexOf(e);n>-1&&t.callbacks.splice(n,1)},t.dispose=function(){t.callbacks.forEach(function(e,n){t.callbacks[n]=null}),t.callbacks=[]},t.publish=function(e){e||((e=new a).newItems=new Array),t.callbacks.forEach(function(n){n(t,e)})},t}return r(t,e),t}(Array);t.ObservableCollection=o;var a=function(){function e(){}return Object.defineProperty(e.prototype,"newItems",{get:function(){return this._newItems},set:function(e){this._newItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldItems",{get:function(){return this._oldItems},set:function(e){this._oldItems=e},enumerable:!0,configurable:!0}),e}();t.CollectionChangedEventArgs=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UNDEFINED="",e.PERSON="person",e.PHONE="phone",e.AGENT="agent",e.JOIN="join",e.GROUP="group",e.DIRECT_LINE="dl"}(t.ConversationType||(t.ConversationType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(29),r=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):i.ContactType.Undefined},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(29),r=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t&&t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):i.ContactType.Undefined},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.BUTTON_SEND_CLICK=1]="BUTTON_SEND_CLICK",e[e.KEYPRESS_ENTER=2]="KEYPRESS_ENTER",e[e.WELCOME_MESSAGE=3]="WELCOME_MESSAGE",e[e.TYPING=4]="TYPING",e[e.SUGGESTED_ACTION=5]="SUGGESTED_ACTION",e[e.BUTTON_SWIFT_CLICKED=6]="BUTTON_SWIFT_CLICKED",e[e.INVITE=7]="INVITE",e[e.ADDON=8]="ADDON"}(t.ActionTrigger||(t.ActionTrigger={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(0),o=n(59),a=function(){function e(){this.requests={}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.async=function(e,t,n){var o=this,a=r.swc.API;return this.requests[t]=this.requests[t]||new Promise(function(r,s){var c=n&&setTimeout(s,n),l=function(n){n&&n.refId&&n.refId===t&&(c&&clearTimeout(c),a.unregisterEvent(i.ApiEvents.proxy.resolve,l),r(o.create(e,n)))};a.registerEvent(i.ApiEvents.proxy.resolve,l)}),setTimeout(function(){a.triggerEvent(i.ApiEvents.proxy.request,t)},0),this.requests[t]},e.prototype.create=function(e,t){return new e(t)},e}();t.ProxyFactory=a;var s=function(){return function(e){var t=this;this.data={},this.callCount=0,this.exec=function(e,t){return r.swc.API.triggerEvent(e,t)},this.reg=function(e,t){return r.swc.API.registerEvent(e,t)},this.createCID=function(){return o.hashCode((t.callCount++).toString()+t.refId)},this.refId=e.refId,this.data=e,this.init()}}();t.Proxy=s;var c=function(){function e(){var e=this;this.connections={},this.answer=function(t){var n=e.connections[t];n&&e.events.triggerEvent(i.ApiEvents.proxy.resolve,Object.assign(n,{refId:t}))},this.events=r.swc.API,this.events.registerEvent(i.ApiEvents.proxy.request,this.answer)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t,n){this.connections[e]||(this.connections[e]=t||{},n&&n(),this.answer(e))},e.prototype.disconnect=function(e){delete this.connections[e]},e}();t.ProxyConnector=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(29),r={caseFirst:"upper"},o=function(){function e(){}return e.mapSearchProfileInfo=function(e){return e&&e.results?e.results.map(function(e){var t=e.nodeProfileData.skypeId,n={skypeid:-1===t.indexOf("8:")?"8:"+t:t,name:e.nodeProfileData.name,avatar:e.nodeProfileData.avatarUrl,type:i.ContactType.Skype,contactType:e.nodeProfileData.contactType,annotation:e.nodeAnnotation,jobTitle:e.nodeProfileData.jobTitle,department:e.nodeProfileData.department,location:e.nodeProfileData.location};return e.nodeConnectionData&&(n.distance=e.nodeConnectionData.distance,n.mutualFriendCount=e.nodeConnectionData.mutualFriendCount),n}):[]},e.getWrappedIdWithMri=function(e){var t=/^\d+:/.exec(e.id);if(t&&t[0])return e.id;var n=e.isAgent?/^28:/:/^8:/;return(e.isAgent?"28:":"8:")+e.id.replace(n,"")},e.sortByName=function(e,t){var n=e.vm.person.displayName.localeCompare(t.vm.person.displayName,void 0,r);return 0===n?e.vm.person.id.localeCompare(t.vm.person.id):n},e.getSortedByRelevance=function(t){var n=t.filter(function(e){return e.vm.mutualFriendCount}).sort(function(e,t){return t.vm.mutualFriendCount-e.vm.mutualFriendCount}),i=t.filter(function(e){return!e.vm.mutualFriendCount}).sort(e.sortByName);return n.concat(i)},e.mapContactVMItems=function(e,t){for(var n=0;n<e.length;n++){var i=e[n].person;e[n]&&(t[i.id]=e[n])}},e.handleParticipantsChanges=function(t,n){Object.keys(t).length&&(n.newItems?e.markAddedParticipants(t,n.newItems):n.oldItems&&e.markRemovedParticipants(t,n.oldItems))},e.markAddedParticipants=function(e,t){for(var n=0;n<t.length;n++){var i=e[t[n].person.id];i&&!i.alreadyParticipant&&(i.alreadyParticipant=!0)}},e.markRemovedParticipants=function(e,t){for(var n=0;n<t.length;n++){var i=e[t[n].person.id];i&&i.alreadyParticipant&&(i.alreadyParticipant=!1)}},e.preloadImage=function(e,t,n){if(e.indexOf("data:image/jpeg;base64")>-1)t&&"function"==typeof t&&t(e);else{var i=new Image,r=encodeURI(decodeURI(e));i.onload=function(){t&&"function"==typeof t&&t(r)},i.onerror=function(e){n&&"function"==typeof n&&n()},i.src=r}},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(6),o=n(2),a=n(13),s=n(32),c=n(103),l=n(3),u=function(e){void 0===e&&(e="");var t=e.match((i||(i=r.default.get.backend===a.MessagingBackend.TEAMS?/^(https?:.+?\.microsoft\.com\/V\d+\/)/i:/^(https?:.+?\.live\.com\/V\d+\/)/i),i));return t?t[1]:null};t.handle404Redirect=function(e,t){var n=e.headers.get("location");return 404===e.status&&n&&u(n)?(o.default.CHAT_HOST_URL=u(n),t()):Promise.resolve(e)},t.getDomain=function(){return l.default.signInManager.userIdentityType===s.IdentityType.GUEST&&o.default.CHAT_GUEST_HOST_URL!==o.default.CHAT_HOST_URL&&c.default().register("webapi-guestInDogfood","",0,null,""),o.default.CHAT_HOST_URL},t.getConversationIdFromUrl=function(e){var t=e&&e.match(/\/(\d+:[^?/]*)/);return t&&t[1]?t[1]:void 0},t.reset=function(){o.default.CHAT_HOST_URL=o.default.CHAT_GUEST_HOST_URL},t.normalizePersonId=function(e){var t=e.match(/(\d+:)([\S]*)/);return t?t[2]:e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.HideChatWindow="bs:hChat",e.OpenChatWindow="bs:oChat",e.ShowChatWindow="bs:sChat",e.CollapseChatWindow="bs:chat:collapse",e.ExpandChatWindow="bs:chat:expand",e.LoadChatData="bs:sChat:run",e.StartActivation="bs:sChat:startActivation",e.StopActivation="bs:sChat:stopActivation",e.UpdateConversation="swc:chat:update",e.MessageSent="lwc:mSent",e.DockIframe="bs:calling:iframe:dock",e.IframeDocked="bs:calling:iframe:docked",e.UndockIframe="bs:calling:iframe:undock",e.IframeUndocked="bs:calling:iframe:undocked",e.IframeDragging="bs:calling:iframe:drag:dragging",e.IframeDragStart="bs:calling:iframe:drag:start",e.IframeDragStop="bs:calling:iframe:drag:stop",e.TriggerAPI="bs:api:trigger",e.OpenRecentsWindow="swc:recents:open",e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(216),r=n(2),o=n(11),a=n(19),s=n(116),c=n(217),l=n(218),u=n(108),d=n(10),p=function(){try{return window.swc.services.i18n}catch(e){}return null},h=function(){function e(){this._initialized=!1,u.default.set(i),l.default.init(r.default.LOCALE)}return e.prototype.init=function(e){var t=this;e||(e=r.default.LOCALE),this.lang=s.default.getLocale(e.toLowerCase()),this._initialized=!0;try{window.swc.services.i18n=this}catch(e){}return this.lang===r.default.LOCALE?Promise.resolve():c.default.load(a.default.getAppPath()+"resources/i18n",this.lang).then(function(){return l.default.init(t.lang),{}},function(){return t.lang=r.default.LOCALE,l.default.init(r.default.LOCALE),{}})},e.prototype.fetch=function(e,t){if(!this._initialized){if(p())return p().fetch(e,t);o.default.throwError(d.ErrorCodes.ERR_I18N_NOT_INITIALIZED,"You need to initialize I18N before using it")}void 0!==t&&void 0!==t.count&&(e+=l.default.getPluralSuffix(t.count));var n=this._getKeyValueText(e);return this._replaceParams(n,t)},e.prototype._replaceParams=function(e,t){for(var n in void 0===t&&(t={}),t)if(t.hasOwnProperty(n)){var i=t[n].toString(),r="{"+n+"}";e=e.replace(r,i)}return e},e.prototype._getKeyValueText=function(e){var t=u.default.get();return t&&t[e]?t[e]:e},e}(),f=p();f||(f=new h),t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(69),r=n(1),o=n(13),a=n(0),s=n(6),c=n(25),l=n(125),u=n(117),d=n(126),p=n(83),h=n(128),f=n(88),g={LARGE:"large",EXTRA_LARGE:"extraLarge"},m=3,_=function(e){var t;return(r.default.instance.PesManager.config?r.default.instance.PesManager.config.items:[]).forEach(function(n){t||n.id!==e||(t=n)}),t},v=function(){function e(e,t){var n=this;this.outgoingDomTransformers=[],this.incomingDomTransformers=[],this.encode=function(e,t,r){var o=new DOMParser,a=i(e),s=l.default.addFormatting(a),c=o.parseFromString(s,"text/html");if(0!==c.getElementsByTagName("parsererror").length)return a;try{return n.outgoingDomTransformers.forEach(function(e){try{e.transformRawToXml(c,c.body,t,r)}catch(e){}}),n.convertHtmlDomToXmlString(c)}catch(e){return a}},this.decode=function(e){var t,i,a,c=n;s.default.get.backend===o.MessagingBackend.TEAMS&&(e=(e=e.replace(/^<div><div>(.*)<\/div>[\s]?<\/div>$/,"$1")).replace(/<span[^>/]+type="(\([a-z]+\))"[^>]+><img[^>]+itemid="(\w+)"[^>]+><\/span>/g,'<ss type="$2">$1</ss>'));try{var l=n._private.parseXML(n._private.encapsulateInRootElement(e));if(l)return i=l.documentElement,r.default.instance.PesManager.canRenderConfigItems()&&function(e){var n=s.default.get.largeEmoticonClass?g.EXTRA_LARGE:g.LARGE,r=i.getElementsByTagName("ss"),o=[],a=r.length<=m&&r.length>0;if(a)for(t=0;t<i.childNodes.length;++t){var l=0===i.childNodes[t].textContent.replace(" ","").length;a=a&&("ss"===i.childNodes[t].tagName||l)}var u,d,p=r.length>20;for(t=0;t<r.length;++t){var h=c.emoticonEncoder.createHtmlElement(e,r[t].getAttribute("type"),r[t].textContent,a,p,n);h&&o.push([h,r[t]])}for(t=0;t<o.length;++t)u=o[t][0],(d=o[t][1]).parentNode&&d.parentNode.replaceChild(u,d)}(l),(a=i.getElementsByTagName("e_m"))&&0!==a.length&&a[0].parentNode.removeChild(a[0]),n.incomingDomTransformers.forEach(function(e){try{e.transformRawToXml(l,i)}catch(e){}}),c.emoticonEncoder.fixInvalidHtml(n._private.decapsulateFromRootElement(n._private.xmlToString(l)))}catch(e){}return e},this.convertHtmlDomToXmlString=function(e){for(var t=e.implementation.createDocument(e.body.namespaceURI,"message",null);0!==e.body.childNodes.length;)t.childNodes[0].appendChild(e.body.childNodes[0]);var i=t.childNodes[0].outerHTML;return s.default.get.backend===o.MessagingBackend.TEAMS&&(i=n._translateToTeamsEmoticons(i,e,t)),i.replace(/(?:^<message.*?>|<\/message>$)/g,"")},this._translateToTeamsEmoticons=function(e,t,n){var i=e.match(/<ss[^>]+>[^<]+<\/ss>/g),o=i.length===n.firstChild.childNodes.length&&i.length<=m&&i.length>0,a=r.default.instance.PesManager.map;for(var s in i){var c=i[s],l=c.match(/<ss type="([^"]+)">([^<]+)<\/ss>/),u=(l[0],l[1]),d=a[l[2]];d.match(/^\(.*\)$/)||(d="("+d+")");var p=_(u),h=t.implementation.createDocument(t.body.namespaceURI,"emoticon",null),f=h.createElement("span"),g=o?50:20;f.setAttribute("class","animated-emoticon-"+g+"-"+u+" animated-emoticon-flat-"+g+"-"+u),f.setAttribute("title",u),f.setAttribute("type",d),f.setAttribute("style","height:"+g+"px; width:"+g+"px; max-height:"+g+"px; max-width:"+g+"px");var v=h.createElement("img");v.setAttribute("alt",p.description),v.setAttribute("itemid",u),v.setAttribute("itemscope",""),v.setAttribute("itemtype","https://schema.skype.com/Emoji"),v.setAttribute("src","https://statics.teams.microsoft.com/evergreen-assets/funstuff/skype-emoticons-f/"+u+"/default_"+g+".png"),v.setAttribute("style","width:"+g+"px; height:"+g+"px"),f.appendChild(v),h.childNodes[0].appendChild(f);var y=h.childNodes[0].outerHTML.replace(/(?:^<emoticon.*?>|<\/emoticon>$)/g,"");e=e.replace(c,y)}return e},this.addLinkElementTarget=function(e,t,n){return e&&e.tagName&&"a"===e.tagName.toLowerCase()&&(e.hasAttribute("target")||e.setAttribute("target","_blank")),e},this._private={separators:{"   ":!0,"\n":!0,"\r":!0," ":!0,"Â ":!0,"áš€":!0,"â€€":!0,"â€":!0,"â€‚":!0,"â€ƒ":!0,"â€„":!0,"â€…":!0,"â€†":!0,"â€‡":!0,"â€ˆ":!0,"â€‰":!0,"â€Š":!0,"â€¯":!0,"âŸ":!0,"ã€€":!0},createFlagElement:function(e,t,n){var i=e.createElement("span");return i.textContent=n,i.setAttribute("class","flag "+t),i.textContent="(flag:"+t+")",i},encapsulateInRootElement:function(e){for(var t;t!==e;)t=e,e=e.replace(/<\s*?root[\s\S]*?>.*?(<\s*?\/\s*?root\s*?>)?/gi,"");return"<root>"+e+"</root>"},decapsulateFromRootElement:function(e){return e.match(/<root ?\/>/)?"":e.length==="</root>".length?"":e.substring("<root>".length,e.length-"</root>".length)},parseXML:function(e){var t;try{if(a.swcWindow.DOMParser){var n=new DOMParser;n.async=!1,t=n.parseFromString(e,"text/xml")}else{var i=new ActiveXObject("Microsoft.XMLDOM");if(i.async=!1,i.loadXML(e))return i}}catch(e){return null}var r=t.parseError;return r&&0!==r.errorCode?null:t.getElementsByTagName("parsererror").length>0?null:t},xmlToString:function(e){var t;try{t=(new XMLSerializer).serializeToString(e)}catch(n){t=e.xml}return t},xmlEscapeMap:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXml:function(e){var t=this.xmlEscapeMap;return e.replace(/[<>&"']/g,function(e){return t[e]})},unescapeXml:function(e){var t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};return e.replace(/&lt;|&gt;|&amp;|&quot;|&apos/g,function(e){return t[e]})}},this.emoticonEncoder=new u.default,e?e.forEach(function(e){n.incomingDomTransformers.push(e)}):this.incomingDomTransformers=[new h.NewLineDomTransformer,new d.MentionDomDecoder],t?t.forEach(function(e){n.outgoingDomTransformers.push(e)}):this.outgoingDomTransformers=[new f.URLDomTransformer,new h.NewLineDomTransformer,new p.MentionDomEncoder,this.emoticonEncoder],this.dompurifyConfig={ALLOWED_TAGS:["a","b","i","s","br","at","ss","h1","h2","h3","h4","h5","h6","span","div","quote","ul","li","ol","em","strong","br"],ALLOWED_ATTR:["tabindex","title","href","target","id","type"]},c.default.dompurify.addHook("beforeSanitizeAttributes",this.addLinkElementTarget)}return e.prototype.getDomPurify=function(){return window.DOMPurify},e}();t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(129),r=function(){function e(){}return e.parse=function(e,t){return i.setOptions({renderer:this.renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1}),e=e.replace(/<br\s*\/?><br\s*\/?>/g,"\n\n").replace(/<br\s*\/?>/g,"  \n"),(e=i(e).trim()).replace(/^<p>/,"").replace(/<\/p>$/,"")},e.renderer=new i.Renderer,e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(46),r=n(14),o=["rgb(153, 180, 51)","rgb(107, 165, 231)","rgb(231, 115, 189)","rgb(0, 163, 0)","rgb(30, 113, 69)","rgb(255, 0, 151)","rgb(126, 56, 120)","rgb(96, 60, 186)","rgb(29, 29, 29)","rgb(0, 171, 169)","rgb(45, 137, 239)","rgb(43, 87, 151)","rgb(218, 83, 44)","rgb(185, 29, 71)","rgb(238, 17, 17)"],a=function(){function e(){}return e.isDefaultPublicUrl=function(e){return e.indexOf("/profile/avatar")>-1||e.indexOf("/public")>-1},e._replaceDefaultImage=function(t){var n=t.split("?")[0],i=t.split("?")[1],r=e.isDefaultPublicUrl(t);return i?(t=n+"?"+i,t+=r?"&returnDefaultImage=false":""):t+=r?"?returnDefaultImage=false":"",t},e.getBackgroundColor=function(e){for(var t=0,n=e.length-1;n>=0;n--){var i=e.charCodeAt(n),r=n%8;t^=(i<<r)+(i>>8-r)}return o[t%o.length]},e._filterDisplayName=function(e){return r.default.getMessageSanitizedContent(e).replace(/\s+/gi," ").trim()},e.loadAvatarUri=function(t,n,r){t&&(t.indexOf("?auth_key=")<0&&(t=t.indexOf("?returnDefaultImage")<0?e._replaceDefaultImage(t):t.replace("returnDefaultImage=true","returnDefaultImage=false")),i.default.preloadImage(t,n,r))},e.getInitials=function(t){var n="",i=(t=e._filterDisplayName(t)).split(" ");return i.length>1?(n+=i[0][0]?i[0][0]:"",n+=i[1][0]?i[1][0]:""):i.length&&(n+=i[0][0]?i[0][0]:"",n+=i[0][1]?i[0][1]:""),n.toUpperCase()},e}();t.default=a},function(e,t,n){"use strict";var i=this;Object.defineProperty(t,"__esModule",{value:!0}),n(79);var r=n(2),o=n(20),a=n(16),s=n(23),c=n(3),l=n(260),u=n(47),d={retryCount:3,timeout:5e4,policy:""},p=function(e,t){void 0===t&&(t={});var n=Object.assign({},t);return l.getHeaders().then(function(t){return n.method=e,n.headers=n.headers||{},Object.assign(n.headers,{ClientInfo:r.default.getChatClientInfo(),Pragma:"no-cache",Expires:0,ContextId:"tcid="+o.guid.generate(),BehaviorOverride:"redirectAs404"},t),n})},h=function(e,t,n,i,r){return void 0===r&&(r=3),429===t.status||500===t.status||503===t.status?0===r?Promise.reject(t):a.default("webapi-"+e,d,n,i).then(function(t){return new Promise(function(o){setTimeout(function(){o(h(e,t,n,i,r-1))},2e3*(3-r+1))})}):Promise.resolve(t)},f=function(e,t,n,r,o){return p(t,r).then(function(g){if(!u.getDomain())return c.default.signInManager.logout("services:domain is undefined"),Promise.reject({message:"Domain is undefined"});var m=o?n:u.getDomain()+n;return a.default("webapi-"+e,d,m,g).then(l.handleRegTokenExpiry).catch(function(n){return c.default.signInManager.state===s.SigninState.SignedOut?Promise.reject(n):p(t,r).then(function(t){return a.default("webapi-"+e,d,m,t)})}).then(l.handleRegTokenExpiry).catch(function(e){return Promise.reject(e)}).then(function(i){return c.default.signInManager.state===s.SigninState.SignedOut?Promise.reject(i):p(t,r).then(function(t){return h(e,i,u.getDomain()+n,t)})}).then(l.processHeaders).then(function(o){return u.handle404Redirect(o,f.bind(i,e,t,n,r))})})};t.get=function(e,t,n){return f(e,"GET",t,n)},t.getWithDomain=function(e,t,n){return f(e,"GET",t,n,!0)},t.put=function(e,t,n,i){return f(e,"PUT",t,n,i)},t.del=function(e,t,n){return f(e,"DELETE",t,n)},t.post=function(e,t,n){return f(e,"POST",t,n)},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})},t.reset=function(){l.reset(),u.reset()};var g=n(104);t.addGetParamsToUrl=g.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.callback=e,this.timeout=t}return e.prototype.start=function(){this.reset(),this.retryTimeout=setTimeout(this.callback,this.timeout)},e.prototype.reset=function(){this.retryTimeout&&clearTimeout(this.retryTimeout)},e}();t.FixedTimeout=i,t.build=function(e,t){return new i(e,t)}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(6),s=n(2),c=n(267),l=n(18),u=n(33),d=n(268),p=n(269),h=n(270),f=n(271),g=n(0),m=n(156),_=n(54),v=n(154),y=n(272),S=n(23),E=n(17),T=n(32),C=n(13),I=n(26),A=n(3),b=n(273),O=n(19);n(274);var R,P="Please disable your popup blocker as it affects sign in/out process. Repeat the operation again after disabling the blocker.",N=2e4;t.SKYPE_AAD_AUD="https://api.spaces.skype.com",t.SHAREPOINT_AAD_AUD="https://microsoft-my.sharepoint.com",function(e){e.SpacesApi="https://api.spaces.skype.com",e.Sharepoint="https://microsoft-my.sharepoint.com",e.Presence="https://presence.teams.microsoft.com/"}(R=t.AadAudience||(t.AadAudience={}));var w=function(){function e(){var e=this;this.init=function(){var t=function(e,t){return new Promise(function(n){var i=function(e){n(e),g.swc.API.unregisterEvent(t,i)};g.swc.API.registerEvent(t,i),g.swc.API.triggerEvent(e)})};e.tokenProvider=function(){return t(o.AuthEvents.TokenProviderRequest,o.AuthEvents.TokenProviderResponse)},e.regionGtmsProvider=function(){return t(o.AuthEvents.RegionGtmsRequest,o.AuthEvents.RegionGtmsResponse)}},this.tokenProviderCallback=function(){return Promise.all([e.tokenProvider(),e.regionGtmsProvider()]).then(function(t){var n=t[0],i=t[1];return{tokens:{skypeToken:n,expiresIn:e.getExiresIn(n)},regionGtms:i}})},this.init()}return e.prototype.getExiresIn=function(e){return(new m.default).getTokenData(e).exp-Math.floor(Date.now()/1e3)},e}(),M=function(e){function t(n,i,r,o){var l=e.call(this)||this;l.outerTokenProvider=n,l._signOutContext=new b.default,l._reloginContext=new c.default(!1),l._tokenParser=new m.default,l._userIdentityType=T.IdentityType.UNDETERMINED,l.login=function(e){if(l._externalLogin&&"function"==typeof l._externalLogin)return l._externalLogin(),void l.sendSignedInTelemetry("","externalLogin");var t=s.default.LOGIN_PAGE_URL;if(t+="?client_id="+s.default.LOGIN_CLIENT_ID,t+="&redirect_uri="+encodeURI(O.default.getConnectPagePath()),t+="&lang="+s.default.LOCALE,t+="&response_type=token",l._getTokenPromise&&l._getTokenPromise.status===E.PromiseStatus.Pending){var n=l.showLoginPopup.bind(l,t,e);l._getTokenPromise.promise.then(null,n)}else l.showLoginPopup(t,e)},l.logout=function(e){if(l.outerTokenProvider)return Promise.resolve();if(l._signOutContext.signoutPromise)return l._signOutContext.signoutPromise;if(l.state===S.SigninState.SigningOut)return Promise.resolve();if(l.prelogoutActions.length>0){var t=l._logout.bind(l,e);return l._signOutContext.signoutPromise=l.execPrelogoutAction(l.prelogoutActions.pop()).then(t,t),l._signOutContext.signoutPromise}return l._signOutContext.signoutPromise=l._logout(e),l._signOutContext.signoutPromise},l._logout=function(e){if(l.state===S.SigninState.SigningOut)return Promise.resolve();var t=Date.now();l._reloginContext.canRelogin||l._reloginContext.setContext(l.activeConversationSdkMode===I.SDKMode.BOT,function(){return l.getGuestToken()});var n=s.default.LOGOUT_PAGE_URL;n+="?",n+="&client_id="+s.default.LOGIN_CLIENT_ID,n+="&redirect_uri="+O.default.getConnectPagePath(),n+="&redirect=true",n+="&response_type=token";var i=window.open(n,"_blank",s.default.LOGOUT_POPUP_FEATURES),r=null===i||void 0===i;return r&&l._userIdentityType===T.IdentityType.SKYPE?(l.sendSignedOutTelemetry(e,t,!0),alert(P),Promise.resolve()):(!r&&window.focus&&i.focus(),l.state=S.SigninState.SigningOut,l.state=S.SigninState.SignedOut,l.reset(),l.sendSignedOutTelemetry(e,t),l._lastAuthSource=y.AuthSource.UserLogout,a.default.get.meId="",Promise.resolve())},l.execPrelogoutAction=function(e){var t=function(){if(l.prelogoutActions.length>0){var e=l.prelogoutActions.pop();return l.execPrelogoutAction(e)}return Promise.resolve()};e&&"function"==typeof e||t();var n=e();return n&&"function"==typeof n.then?n.then(t.bind(l),t.bind(l)):t()},l.getGuestToken=function(){if(l._guestUserPromise)return l._guestUserPromise;var e=Date.now();return l._guestUserPromise=d.default.getGuestToken("Guest").then(function(t){return l._userIdentityType=T.IdentityType.GUEST,l.setTokenDataToCache(t.SkypeToken,86400,!0),l.sendSignedInTelemetry(t.SkypeToken,"guest",e),l._signOutContext.reset(),t},function(t){l.sendSignedInTelemetry(void 0,"guest",e,t.message),l.clearUserDataFromCache(),l._guestUserPromise=null}),l._guestUserPromise},l.showLoginPopup=function(e,t){var n,i,r=Date.now(),o=l.state===S.SigninState.SignedOut,a=function(e){var s=/(?:access_token=)([\S]*)(?:&)(?:expires_in=)([\d*]*)/g.exec(e.data);if(s&&(n=s[1],i=s[2]),s||(n=e.data.token,i=Date.now()+864e5+""),!n)return l.state=S.SigninState.SignedOut,void window.removeEventListener("message",a);o&&(l.currentUsername=n?l._tokenParser.retrieveMeName(n):"",l.setTokenDataToCache(n,parseInt(i,10),!1),l.publish("resurrect",!0),l._signOutContext.reset()),o?t&&t(n):(l._reloginContext.setContext(!0,function(){return l._userIdentityType=T.IdentityType.SKYPE,l.setTokenDataToCache(n,parseInt(i,10),!1),l.sendSignedInTelemetry(n,"popup",r),t&&t(n),Promise.resolve()}),l._signOutContext.reset(),l._signOutContext.isRelogin=!0,l.logout()),l._lastAuthSource=y.AuthSource.Popup,window.removeEventListener("message",a)};window.addEventListener("message",a,!1);var c=window.open(e,"_blank",s.default.LOGIN_POPUP_FEATURES);c&&window.focus&&c.focus()};var u=!a.default.get.frameless&&window!==window.top&&!!window.parent,p=!o||o!==v.TokenType.Aad,h=!p&&u;return l._onceSingedInPromise=new E.CancelablePromise,l._state=S.SigninState.SignedOut,h||(l.getSkypeToken=n||l._getSkypeToken),l._externalLogin=r,a.default.get.backend=o&&"aad"===o?C.MessagingBackend.TEAMS:C.MessagingBackend.SKYPE,h&&(l.teamsRemoteTokenExchange=new w,l.getSkypeToken=function(){return l._getSkypeTokenFromAad()}),l.outerTokenProvider?p?(l.clearUserDataFromCache(),l._getInfoFromExternalToken()):l._getSkypeTokenFromAad():i&&(l.clearUserDataFromCache(),l.setTokenDataToCache(i.skypeToken,i.expiresAt,i.isGuest),p?(l._userIdentityType=t._getUserIdentityType(i),l._lastAuthSource=y.AuthSource.WX):(l.teamsTokenPromise=Promise.resolve(i.skypeToken),l.currentUsername=l._tokenParser.retrieveMeName(i.skypeToken),l.state=S.SigninState.SignedIn,l._lastAuthSource=y.AuthSource.AAD,l._userIdentityType=T.IdentityType.SKYPE)),l.prelogoutActions=[],l}return r(t,e),t._getUserIdentityType=function(e){return e.isGuest?T.IdentityType.GUEST:"aad"===e.tokenType?T.IdentityType.TEAMS:T.IdentityType.SKYPE},t.prototype._getInfoFromExternalToken=function(){var e=this;a.default.get.backend=C.MessagingBackend.SKYPE,this.outerTokenProvider().then(function(t){e.currentUsername=t?e._tokenParser.retrieveMeName(t):"";var n=e._userId.indexOf("guest:")>-1;e.state=t?S.SigninState.SignedIn:S.SigninState.SignedOut,e._lastAuthSource=n?y.AuthSource.Guest:y.AuthSource.External,e._userIdentityType=n?T.IdentityType.GUEST:T.IdentityType.SKYPE,e.sendSignedInTelemetry(t,"external",Date.now())},function(){e.state=S.SigninState.SignedOut,e._lastAuthSource=y.AuthSource.External,e.sendSignedInTelemetry(null,"external",Date.now())})},t.prototype._getSkypeToken=function(){var e=this;if(a.default.get.backend=C.MessagingBackend.SKYPE,this._getTokenPromise&&this._getTokenPromise.status===E.PromiseStatus.Pending)return this._getTokenPromise.promise;this._lastAuthSource=y.AuthSource.UNDEFINED;var t=this.getTokenDataFromCache();if(t&&t.isGuest&&a.default.get.isSkypeOnly&&(t=null),a.default.get.isGuestOnlyMode&&t&&!t.isGuest&&(this.clearUserDataFromCache(),t=null),this._signedIn||!t||t.isGuest||(t=null),t)return this.currentUsername=this._tokenParser.retrieveMeName(t.token),this._userIdentityType=t.isGuest?T.IdentityType.GUEST:T.IdentityType.SKYPE,void 0===this._signedIn&&(this.sendSignedInTelemetry(t.token,"cache",Date.now()),this.callExternalHandler(this.externalSuccessCallback)),this._lastAuthSource=y.AuthSource.Cache,this.state=S.SigninState.SignedIn,Promise.resolve(t.token);this.state=S.SigninState.SigningIn,this.clearUserDataFromCache();var n=new Promise(function(t,n){var i=e;function r(e){i.activeConversationSdkMode===I.SDKMode.BOT?(i.state!==S.SigninState.SignedIn&&(i.state=S.SigninState.SigningIn),i.getGuestToken().then(function(e){i.currentUsername=i._tokenParser.retrieveMeName(e.SkypeToken),i.state=S.SigninState.SignedIn,t(e.SkypeToken),i.callExternalHandler(i.externalSuccessCallback),i._lastAuthSource=y.AuthSource.Guest}).catch(function(e){i.clearUserDataFromCache(),i.callExternalHandler(i.externalFailureCallback,i.formatError(e)),i._guestTokenRetryInterval||(i._guestTokenRetryInterval=new _.FixedTimeout(r.bind(i),N)),i._guestTokenRetryInterval.start()})):(i.state=S.SigninState.SignedOut,n(),i.callExternalHandler(i.externalFailureCallback,i.formatError(e)))}e.state!==S.SigninState.SignedIn&&(e.state=S.SigninState.SigningIn),a.default.get.isGuestOnlyMode?r():e.silentLogin().then(function(e){this.state=S.SigninState.SignedIn,this.currentUsername=this._tokenParser.retrieveMeName(e),t(e),this.callExternalHandler(this.externalSuccessCallback),this._lastAuthSource=y.AuthSource.SilentLogin}.bind(e),function(e){return a.default.get.isSkypeOnly?(i.state=S.SigninState.SignedOut,i.callExternalHandler(i.externalFailureCallback),n()):r(e)}.bind(e))});return this._getTokenPromise=new E.CancelablePromise(n),this._getTokenPromise.promise},t.prototype.onceSignedIn=function(){return this.getSkypeToken().then(null,function(){}),this._onceSingedInPromise.promise},t.prototype.getLastAuthSource=function(){return this._lastAuthSource},Object.defineProperty(t.prototype,"lastAuthSource",{get:function(){return this._lastAuthSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){if(e===S.SigninState.SignedIn&&(this._lastSignedInTimestamp=Date.now()),e!==this._state){this._state=e,this._signedIn=this._state===S.SigninState.SignedIn,this.publish("state",e),this.publish("isSignedIn",this._signedIn);var t=this._onceSingedInPromise.status===E.PromiseStatus.Pending;this._signedIn&&t?this._onceSingedInPromise.resolve():this._state!==S.SigninState.SignedOut||t||(this._onceSingedInPromise=new E.CancelablePromise)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userIdentityType",{get:function(){return this._userIdentityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUsername",{set:function(e){this._userId=e,a.default.get.meId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUserName",{get:function(){return this._userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return this._signedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloginContext",{get:function(){return this._reloginContext},enumerable:!0,configurable:!0}),t.prototype.checkAuthFailuresCount=function(e){e>=3&&this.clearUserDataFromCache()},t.prototype.setExternalCallbacks=function(e,t){this.externalSuccessCallback=e,this.externalFailureCallback=t,this._state===S.SigninState.SignedIn&&this.callExternalHandler(this.externalSuccessCallback)},t.prototype.getTokenExpirationTime=function(){var e=this.getTokenDataFromCache();return e&&e.expiresAt},t.prototype.sendSignedInTelemetry=function(e,t,n,i){this.currentUsername=e?this._tokenParser.retrieveMeName(e):"";var r=new h.SignInEvent;r.authOrigin=t,r.status=e?"200":"500",r.ttc=n?Date.now()-n:-1,r.errorMessage=i,A.default.telemetryManager.sendEvent(r)},t.prototype.sendSignedOutTelemetry=function(e,t,n){var i=new f.SignOutEvent;i.origin=e,i.status=n?500:200,i.ttc=t?Date.now()-t:-1,n&&(i.errorMessage="Popup is blocked"),A.default.telemetryManager.sendEvent(i)},t.prototype.getRegistrationToken=function(){var e,t=u.default.get().getItem("skype|registrationtoken");if(t)try{e=JSON.parse(t)}catch(e){}return e},t.prototype.getTokenDataFromCache=function(){if(!this._tokenData)try{this._tokenData=JSON.parse(u.default.get().getItem(s.default.SKYPE_TOKEN_KEY))}catch(e){return this.clearUserDataFromCache(),null}return this._tokenData&&(this._tokenData=this.isTokenValid(this._tokenData)?this._tokenData:null),this._tokenData},t.prototype.isTokenValid=function(e){var t=this.getRegistrationToken();return!(t&&!t.value&&t.failureCount>=3)&&(!(e.expiresAt<Date.now())&&(this._userIdentityType===T.IdentityType.SKYPE&&this.activeConversationSdkMode===I.SDKMode.PERSON&&e.isGuest?(this._tokenData=null,this.clearUserDataFromCache(),!1):!(this._userIdentityType===T.IdentityType.GUEST&&this.activeConversationSdkMode===I.SDKMode.BOT&&!e.isGuest)||(this._tokenData=null,this.clearUserDataFromCache(),!1)))},t.prototype.setTokenDataToCache=function(e,t,n){var i=this,r=0;t&&(r=Date.now()+1e3*t,this._tokenRenovationTimeout&&this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=new _.FixedTimeout(function(){a.default.get.backend===C.MessagingBackend.TEAMS?(i.teamsTokenPromise=null,i._getSkypeTokenFromAad()):n?i.getGuestToken():i.silentLogin()},1e3*Math.abs(t-60)),this._tokenRenovationTimeout.start()),u.default.get().setItem(s.default.SKYPE_TOKEN_KEY,JSON.stringify({token:e,expiresAt:r,isGuest:n}))},t.prototype.clearUserDataFromCache=function(){this._tokenData=null,u.default.get().removeItem(s.default.SKYPE_TOKEN_KEY),u.default.get().removeItem(s.default.SKYPE_REGTOKEN_KEY),u.default.get().removeItem("skype|epid"),u.default.get().removeItem("skype|hasHistory")},t.prototype.silentLogin=function(){var e=this;if(this._silentLoginPromise)return this._silentLoginPromise;var t=Date.now();return this._silentLoginPromise=new Promise(function(n,i){var r={client_id:s.default.LOGIN_CLIENT_ID,env:"live",callback:function(r){var o,a=function(i){e.sendSignedInTelemetry(i,"silent",t),e._silentLoginPromise=null,n(i)};try{o=JSON.parse(r.data)}catch(e){o=r.data?r.data:r}o.error?(o.error,"invalid_grant"===o.error&&e.clearUserDataFromCache(),e.sendSignedInTelemetry(void 0,"silent",t,o.error),e._silentLoginPromise=null,i(o.error)):o.token?(e.setTokenDataToCache(o.token,o.expires_in,!1),a(o.token)):o.skypetoken&&(e.setTokenDataToCache(o.skypetoken,o.expires_in,!1),a(o.skypetoken)),i(new Error("Neither token nor skypeToken in the response"))}};g.SKYPE.login.Silent.init(r).load()}),this._silentLoginPromise},t.prototype.callExternalHandler=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e&&"function"==typeof e)try{e.apply(null,[].slice.call(arguments,1))}catch(e){}},t.prototype.formatError=function(e){var t;return e instanceof Error?t=Object.create(e):"string"==typeof e?t=new Error(e):(t=new Error("Unknown: please check *data* property for more info")).data=e,t.name="SWCApi:signin:"+t.name,t},t.prototype.reset=function(){this.clearUserDataFromCache(),this._signOutContext.reset(),this._guestUserPromise=null,this._silentLoginPromise=null,this._signedIn=!1,this._tokenData=null,this.currentUsername="",this._getTokenPromise&&this._getTokenPromise.status===E.PromiseStatus.Pending&&this._getTokenPromise.cancel(),this._getTokenPromise=null,this._aad=null,this._tokenRenovationTimeout&&(this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=null)},t.prototype.aad=function(e){return e||(e=R.SpacesApi),this.outerTokenProvider?this.outerTokenProvider(e).then(function(e){return-1===e.indexOf("Bearer")?"Bearer "+e:e}):Promise.reject("outerTokenProvider is not defined")},t.prototype.isAadSupported=function(){return!!this.outerTokenProvider},t.prototype._signInWithAadSkypetokens=function(e,t){void 0===t&&(t=!1),e.regionGtms&&(s.default.CHAT_HOST_URL=e.regionGtms.chatService+"/v1/",s.default.CHAT_GUEST_HOST_URL=e.regionGtms.chatService+"/v1/",s.default.AMS_HOST_URL=e.regionGtms.ams+"/v1/",s.default.AVATAR_SERVICE_URL=e.regionGtms.mtImageService),a.default.get.backend=C.MessagingBackend.TEAMS,this.setTokenDataToCache(e.tokens.skypeToken,e.tokens.expiresIn,t),this.currentUsername=this._tokenParser.retrieveMeName(e.tokens.skypeToken),this.state=e.tokens.skypeToken?S.SigninState.SignedIn:S.SigninState.SignedOut,this._lastAuthSource=y.AuthSource.AAD,this._userIdentityType=T.IdentityType.SKYPE,this.sendSignedInTelemetry(e.tokens.skypeToken,"aad",Date.now())},t.prototype._getSkypeTokenFromAad=function(){var e=this;return this.teamsTokenPromise?this.teamsTokenPromise:this.teamsRemoteTokenExchange?(this.teamsTokenPromise=this.teamsRemoteTokenExchange.tokenProviderCallback().then(function(t){return e._signInWithAadSkypetokens(t),t.tokens.skypeToken}),this.teamsTokenPromise):(this.teamsTokenPromise=new Promise(function(t,n){var i=function(t){e.clearUserDataFromCache(),e.state=S.SigninState.SignedOut,e.sendSignedInTelemetry(null,"aad",Date.now()),n()};e.outerTokenProvider(R.SpacesApi).then(function(n){-1===n.indexOf("Bearer")&&(n="Bearer "+n),p.default.exchangeForSkypeToken(n).then(function(n){n.json?n.json().then(function(n){n.tokens?(n.regionGtms&&(s.default.CHAT_HOST_URL=n.regionGtms.chatService+"/v1/",s.default.CHAT_GUEST_HOST_URL=n.regionGtms.chatService+"/v1/",s.default.AMS_HOST_URL=n.regionGtms.ams+"/v1/",s.default.AVATAR_SERVICE_URL=n.regionGtms.mtImageService),e.setTokenDataToCache(n.tokens.skypeToken,n.tokens.expiresIn,!1),e.currentUsername=e._tokenParser.retrieveMeName(n.tokens.skypeToken),e.state=n.tokens.skypeToken?S.SigninState.SignedIn:S.SigninState.SignedOut,e._lastAuthSource=y.AuthSource.AAD,e._userIdentityType=T.IdentityType.SKYPE,e.sendSignedInTelemetry(n.tokens.skypeToken,"aad",Date.now()),t(n.tokens.skypeToken)):i()},i):i()},i)},function(e){})}),this.getSkypeToken=this._skypeTokenBasedOnAad.bind(this),this.teamsTokenPromise)},t.prototype._skypeTokenBasedOnAad=function(){return this.teamsTokenPromise},t}(l.default);t.default=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),r=n(51),o=n(7),a=n(14),s=n(119),c=function(){function e(){}return e._encoder=new i.default,e.INVALID_VALUE="invalidValue",e.urlPrefixBlacklist=["http","file","smb"],e.filterOutNotValidItems=function(t,n){for(var i=e.mapArray(t,n),r=[],o=0;o<i.length;o++){var a=i[o];a.isValid&&!a.isValid()||r.push(a)}return r},e.filterOutDisabledItems=function(t,n){for(var i=e.mapArray(t,n),r=[],o=0;o<i.length;o++){var a=i[o];a.isDisabled&&a.isDisabled()||r.push(a)}return r},e.getItemIfNotDisabled=function(e){return e.isDisabled&&e.isDisabled()?null:e},e.mapArray=function(e,t){var n=[];if(!e)return n;for(var i=0;i<e.length;i++){var r=e[i];r&&n.push(t(r))}return n},e.mapImages=function(e,t,n,i){var r=[];return e.forEach(function(e){e.url&&r.push(new s.default(e,t,n,i))}),r},e.normalizeText=function(e){return e?a.default.getMessageSanitizedContent(e):null},e.normalizeUrl=function(t,n,i){var r,s=t?a.default.getMessageSanitizedContent(t):e.INVALID_VALUE,c=e.urlPrefixBlacklist;if(!n)switch(i){case o.SwiftCardActionType.openUrl:case o.SwiftCardActionType.showImage:s=function(t){try{var n=document.createElement("a");return n.href=t,["https:"].indexOf(n.protocol)>-1?t:e.INVALID_VALUE}catch(t){return e.INVALID_VALUE}}(s),s=function(t){for(var n=0;n<c.length;n++)if(new RegExp("^"+c[n]+":","i").test(t))return e.INVALID_VALUE;return t}(s=(r=s).match(/^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)?r:e.INVALID_VALUE);break;case o.SwiftCardActionType.signin:s=/^https/i.test(s)?s:e.INVALID_VALUE}return s=function(t){return t===e.INVALID_VALUE?e.INVALID_VALUE:t.match(/^[\s\S]*javascript:/gim)?e.INVALID_VALUE:t}(s)},e.normalizeDestination=function(t){return/^(skype|tel):/i.test(t)?a.default.getMessageSanitizedContent(t):e.INVALID_VALUE},e.normalizeRichText=function(t,n){if(!t)return"";t=n?t:e._encoder.decode(e._encoder.encode(t)),t=a.default.unescapeBrackets(t);var i=r.default.parse(t);return a.default.getMessageSanitizedContent(i)},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getQueryParameters=function(){var e=window.location.search.substring(1);return this.extractQueryParameters(e)},e.extractQuery=function(e){var t="";return e.indexOf("?")>-1&&(t=e.split("?")[1]),t},e.getQueryParameter=function(e,t){var n=this.extractQuery(e);return n?this.extractQueryParameters(n)[t]:null},e.extractQueryParameters=function(e){var t={};return e.split("&").forEach(function(e){var n=e.split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])||""}),t},e.extractProtocol=function(e){var t=null;return e.indexOf("://")>-1&&(t=e.split("://")[0]),t},e.extractHostname=function(e){return(e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},e.extractPath=function(e){var t="";e.indexOf("//")>-1&&(e=e.split("//")[1]);var n=e.indexOf("/");return n>-1&&(t=e.substring(n)),t=t.split("?")[0]},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(18),a=n(7),s=function(e){function t(t,n){var i=e.call(this)||this;return i._isTyping=!1,i._person=t,i._role=n&&n.role?n.role:a.ParticipantRole.User,i._capabilities=n&&n.capabilities?n.capabilities:[],i}return r(t,e),Object.defineProperty(t.prototype,"person",{get:function(){return this._person},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this._role},set:function(e){e!==this._role&&(this._role=e,this.publish("role",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},set:function(e){e!==this._capabilities&&(this._capabilities=e,this.publish("capabilities",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._isTyping},set:function(e){if(this._isTyping=e,this.publish("isTyping",e),this._typingIndicatorTimoutId&&clearTimeout(this._typingIndicatorTimoutId),e){var t=this;this._typingIndicatorTimoutId=setTimeout(function(){t.isTyping=!1,t._typingIndicatorTimoutId=void 0},5e3)}},enumerable:!0,configurable:!0}),t}(o.default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashCode=function(e){var t=0,n=e.length,i=0;if(n>0)for(;i<n;)t=(t<<5)-t+e.charCodeAt(i++)|0;return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.setRectStyle=function(e,t){var n=e.style;n.top=t.top+"px",n.left=t.left+"px",n.width=t.width+"px",n.height=t.height+"px"},e.resetRectStyle=function(e){var t=e.style;t.width=t.height=t.top=t.bottom=t.right=t.left=null},e.isInDom=function(e){if(e)for(;e.parentNode;)if((e=e.parentNode)===document.documentElement)return!0;return!1},e.innerSize=function(t){var n=e.style(t);return{width:t.offsetWidth-parseInt(n.paddingLeft)-parseInt(n.paddingRight),height:t.offsetHeight-parseInt(n.paddingTop)-parseInt(n.paddingBottom)}},e.setStyle=function(e,t){e.setAttribute("style",t)},e.style=function(e){return window.getComputedStyle(e)},e.copyStyle=function(t,n,i){for(var r=e.style(n),o=t.style,a=0,s=i;a<s.length;a++){var c=s[a];o[c]=r[c]}},e.isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},e.transport=function(t,n,i,r,o,a){var s=t.getBoundingClientRect(),c=function(e){return n.appendChild(e)};!a&&c(t),t.style.transition="all 0.5s ease",e.setRectStyle(t,s),setTimeout(function(){return e.setRectStyle(t,i)},0),setTimeout(function(){o(),t.style.transition=null,a&&c(t)},r)},e}();t.default=i},function(e,t,n){(function(t){(function(){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=function(e){return e&&DataView.prototype.isPrototypeOf(e)},r=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=s(e),t=c(t);var n=this.map[e];n||(n=[],this.map[e]=n),n.push(t)},u.prototype.delete=function(e){delete this.map[s(e)]},u.prototype.get=function(e){var t=this.map[s(e)];return t?t[0]:null},u.prototype.getAll=function(e){return this.map[s(e)]||[]},u.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},u.prototype.set=function(e,t){this.map[s(e)]=[c(t)]},u.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(i){e.call(t,i,n,this)},this)},this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),l(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),l(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),l(e)},t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},g.call(m.prototype),g.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var a=[301,302,303,307,308];v.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=u,e.Request=m,e.Response=v,e.fetch=function(e,n){return new Promise(function(i,r){var o=new m(e,n),a=new XMLHttpRequest;a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new u,e.split("\r\n").forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();t.append(i,r)}}),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;i(new v(r,n))},a.onerror=function(){r(new TypeError("Network request failed"))},a.ontimeout=function(){r(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials&&(a.withCredentials=!0),"responseType"in a&&t.blob&&(a.responseType="blob"),o.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function h(e){var t=new FileReader,n=p(t);return t.readAsArrayBuffer(e),n}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&i(e))this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!r(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e,t,n,i=d(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=p(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(e,t){var n,i,r=(t=t||{}).body;if("string"==typeof e)this.url=e;else{if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=(n=t.method||this.method||"GET",i=n.toUpperCase(),o.indexOf(i)>-1?i:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function _(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(r))}}),t}function v(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this),e.exports=t.fetch}).call(t)}).call(this,n(22))},function(e,t,n){(function(t){var n="Expected a function",i=NaN,r="[object Symbol]",o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,u="object"==typeof t&&t&&t.Object===Object&&t,d="object"==typeof self&&self&&self.Object===Object&&self,p=u||d||Function("return this")(),h=Object.prototype.toString,f=Math.max,g=Math.min,m=function(){return p.Date.now()};function _(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&h.call(e)==r}(e))return i;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=s.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):a.test(e)?i:+e}e.exports=function(e,t,i){var r,o,a,s,c,l,u=0,d=!1,p=!1,h=!0;if("function"!=typeof e)throw new TypeError(n);function y(t){var n=r,i=o;return r=o=void 0,u=t,s=e.apply(i,n)}function S(e){var n=e-l;return void 0===l||n>=t||n<0||p&&e-u>=a}function E(){var e=m();if(S(e))return T(e);c=setTimeout(E,function(e){var n=t-(e-l);return p?g(n,a-(e-u)):n}(e))}function T(e){return c=void 0,h&&r?y(e):(r=o=void 0,s)}function C(){var e=m(),n=S(e);if(r=arguments,o=this,l=e,n){if(void 0===c)return function(e){return u=e,c=setTimeout(E,t),d?y(e):s}(l);if(p)return c=setTimeout(E,t),y(l)}return void 0===c&&(c=setTimeout(E,t)),s}return t=v(t)||0,_(i)&&(d=!!i.leading,a=(p="maxWait"in i)?f(v(i.maxWait)||0,t):a,h="trailing"in i?!!i.trailing:h),C.cancel=function(){void 0!==c&&clearTimeout(c),u=0,r=l=o=c=void 0},C.flush=function(){return void 0===c?s:T(m())},C}}).call(this,n(22))},function(e,t,n){var i=n(419),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(o(i,t),t.Buffer=a),o(r,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t,n){var i=window;i.ES6Promise=i.ES6Promise||n(90),!i.Promise&&i.ES6Promise&&i.ES6Promise.polyfill()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.alias=function(t,n,i,r){var o=e.pathToArray(n),a=o.pop(),s=e.build(o,i);return s[a]=r?t:s[a]||t},e.build=function(t,n){var i=n||window;return e.pathToArray(t).forEach(function(e){return i=i[e]=i[e]||{}}),i},e.pathToArray=function(e){return e instanceof Array?e:e.split(".")},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SKYPE_TOKEN_KEY="skype|token",t.SKYPE_REGTOKEN_KEY="skype|registrationtoken",function(e){e.SkypeToken="skype|token",e.RegistrationToken="skype|registrationtoken",e.Endpoint="skype|endpoint",e.EndpointOwner="skype|endpointowner"}(t.SessionStorageKeys||(t.SessionStorageKeys={}))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(0),l=n(52);!function(e){e.Online="online",e.Busy="busy",e.Away="away"}(t.PresenceStatusUI||(t.PresenceStatusUI={}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n._onClick=function(e){e.stopPropagation(),n.props.onClick&&n.props.onClick()},n.state={bgColor:"transparent",bgImage:"",initials:"",initialsStyle:{},showBlock:!1,presenceStatus:null},n}return r(t,e),t.prototype.componentDidMount=function(){if(this.setState({initials:l.default.getInitials(this.props.title),bgColor:l.default.getBackgroundColor(this.props.title),showBlock:!!this.props.showBlock,initialsStyle:{display:""},presenceStatus:this.props.presenceStatus}),this.props.avatarUrl){var e=this.props.avatarUrl;this._loadAvatar(e)}},t.prototype._loadAvatar=function(e){var t=this;l.default.loadAvatarUri(e,function(){var n=e.indexOf("data:image/jpeg;base64")>-1?"url('"+e+"')":"url("+e+")";t.setState({bgImage:n}),t.setState({bgColor:"transparent",initialsStyle:{display:"none"}})})},t.prototype.componentWillReceiveProps=function(e){if(this.props.title!==e.title&&this.setState({initials:l.default.getInitials(e.title),bgColor:l.default.getBackgroundColor(e.title)}),this.props.showBlock!==e.showBlock&&this.setState({showBlock:!!e.showBlock}),this.props.presenceStatus!==e.presenceStatus&&this.setState({presenceStatus:e.presenceStatus}),this.props.avatarUrl!==e.avatarUrl&&e.avatarUrl){var t=e.avatarUrl;this._loadAvatar(t)}},t.prototype.render=function(){var e={"tab-index":"0","aria-label":"avatar"},t={backgroundColor:this.state.bgColor},n=this.state.bgImage?{display:"flex",backgroundImage:this.state.bgImage}:{display:"none"},i=["avatar"];this.state.presenceStatus&&i.push(this.state.presenceStatus);var r=c.swc.Assets.SVG;return s.createElement("div",o({className:i.join(" ")},e,{style:t,onClick:this._onClick}),s.createElement("div",o({className:"avatar avatarImage"},e,{style:n})),s.createElement("span",{className:"initials",style:this.state.initialsStyle},this.state.initials),this.state.showBlock&&s.createElement("span",{className:"blocked",dangerouslySetInnerHTML:{__html:r.iconBlocked}}))},t}(a.Component);t.BasicAvatar=u},function(e,t,n){var i;!function(r){"use strict";var o="undefined"==typeof window?null:window;void 0===(i=function(){return function e(t){var n=function(t){return e(t)};if(n.version="0.8.3",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var i=t.document,r=i,o=t.DocumentFragment,a=t.HTMLTemplateElement,s=t.NodeFilter,c=t.NamedNodeMap||t.MozNamedAttrMap,l=t.Text,u=t.Comment,d=t.DOMParser;if("function"==typeof a){var p=i.createElement("template");p.content&&p.content.ownerDocument&&(i=p.content.ownerDocument)}var h=i.implementation,f=i.createNodeIterator,g=i.getElementsByTagName,m=i.createDocumentFragment,_=r.importNode,v={};n.isSupported=void 0!==h.createHTMLDocument&&9!==i.documentMode;var y=function(e,t){for(var n=t.length;n--;)"string"==typeof t[n]&&(t[n]=t[n].toLowerCase()),e[t[n]]=!0;return e},S=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},E=null,T=y({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),C=null,I=y({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),A=null,b=null,O=!0,R=!1,P=!1,N=!1,w=/\{\{[\s\S]*|[\s\S]*\}\}/gm,M=/<%[\s\S]*|[\s\S]*%>/gm,k=!1,D=!1,L=!1,U=!1,x=!0,F=!0,H=y({},["audio","head","math","script","style","svg","video"]),G=y({},["audio","video","img","source"]),j=y({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),B=null,V=i.createElement("form"),W=function(e){n.removed.push({element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}},q=function(e,t){n.removed.push({attribute:t.getAttributeNode(e),from:t}),t.removeAttribute(e)},z=function(e){return f.call(e.ownerDocument||e,e,s.SHOW_ELEMENT|s.SHOW_COMMENT|s.SHOW_TEXT,function(){return s.FILTER_ACCEPT},!1)},K=function(e){var t,i;if(ee("beforeSanitizeElements",e,null),function(e){if(e instanceof l||e instanceof u)return!1;if("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof c)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute)return!0;return!1}(e))return W(e),!0;if(t=e.nodeName.toLowerCase(),ee("uponSanitizeElement",e,{tagName:t}),!E[t]||A[t]){if(F&&!H[t]&&"function"==typeof e.insertAdjacentHTML)try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(e){}return W(e),!0}return!P||e.firstElementChild||e.content&&e.content.firstElementChild||!/</g.test(e.textContent)||(n.removed.push({element:e.cloneNode()}),e.innerHTML=e.textContent.replace(/</g,"&lt;")),N&&3===e.nodeType&&(i=(i=(i=e.textContent).replace(w," ")).replace(M," "),e.textContent!==i&&(n.removed.push({element:e.cloneNode()}),e.textContent=i)),ee("afterSanitizeElements",e,null),!1},Y=/^data-[\-\w.\u00B7-\uFFFF]/,J=/^(?:(?:(?:f|ht)tps?|mailto|tel|skype):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,X=/^(?:\w+script|data):/i,Q=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,$=function(e){var r,o,a,s,c,l,u,d;if(ee("beforeSanitizeAttributes",e,null),l=e.attributes){for(u={attrName:"",attrValue:"",keepAttr:!0},d=l.length;d--;)if(r=l[d],o=r.name,a=r.value,s=o.toLowerCase(),u.attrName=s,u.attrValue=a,u.keepAttr=!0,ee("uponSanitizeAttribute",e,u),a=u.attrValue,"name"===s&&"IMG"===e.nodeName&&l.id?(c=l.id,l=Array.prototype.slice.apply(l),q("id",e),q(o,e),l.indexOf(c)>d&&e.setAttribute("id",c.value)):("id"===o&&e.setAttribute(o,""),q(o,e)),u.keepAttr&&(!x||"id"!==s&&"name"!==s||!(a in t||a in i||a in V))){if(N&&(a=(a=a.replace(w," ")).replace(M," ")),O&&Y.test(s));else{if(!C[s]||b[s])continue;if(j[s]);else if(J.test(a.replace(Q,"")));else if("src"===s&&0===a.indexOf("data:")&&G[e.nodeName.toLowerCase()]);else if(R&&!X.test(a.replace(Q,"")));else if(a)continue}try{e.setAttribute(o,a),n.removed.pop()}catch(e){}}ee("afterSanitizeAttributes",e,null)}},Z=function(e){var t,n=z(e);for(ee("beforeSanitizeShadowDOM",e,null);t=n.nextNode();)ee("uponSanitizeShadowNode",t,null),K(t)||(t.content instanceof o&&Z(t.content),$(t));ee("afterSanitizeShadowDOM",e,null)},ee=function(e,t,i){v[e]&&v[e].forEach(function(e){e.call(n,t,i,B)})};return n.sanitize=function(e,i){var a,s,c,l,u;if(e||(e=""),"string"!=typeof e){if("function"!=typeof e.toString)throw new TypeError("toString is not a function");e=e.toString()}if(!n.isSupported)return"object"==typeof t.toStaticHTML||"function"==typeof t.toStaticHTML?t.toStaticHTML(e):e;if(function(e){"object"!=typeof e&&(e={}),E="ALLOWED_TAGS"in e?y({},e.ALLOWED_TAGS):T,C="ALLOWED_ATTR"in e?y({},e.ALLOWED_ATTR):I,A="FORBID_TAGS"in e?y({},e.FORBID_TAGS):{},b="FORBID_ATTR"in e?y({},e.FORBID_ATTR):{},O=!1!==e.ALLOW_DATA_ATTR,R=e.ALLOW_UNKNOWN_PROTOCOLS||!1,P=e.SAFE_FOR_JQUERY||!1,N=e.SAFE_FOR_TEMPLATES||!1,k=e.WHOLE_DOCUMENT||!1,D=e.RETURN_DOM||!1,L=e.RETURN_DOM_FRAGMENT||!1,U=e.RETURN_DOM_IMPORT||!1,x=!1!==e.SANITIZE_DOM,F=!1!==e.KEEP_CONTENT,N&&(O=!1),L&&(D=!0),e.ADD_TAGS&&(E===T&&(E=S(E)),y(E,e.ADD_TAGS)),e.ADD_ATTR&&(C===I&&(C=S(C)),y(C,e.ADD_ATTR)),F&&(E["#text"]=!0),Object&&"freeze"in Object&&Object.freeze(e),B=e}(i),n.removed=[],!D&&!k&&-1===e.indexOf("<"))return e;if(!(a=function(e){var t,n;try{t=(new d).parseFromString(e,"text/html")}catch(e){}return t&&t.documentElement||(t=h.createHTMLDocument(""),(n=t.body).parentNode.removeChild(n.parentNode.firstElementChild),n.outerHTML=e),"function"==typeof t.getElementsByTagName?t.getElementsByTagName(k?"html":"body")[0]:g.call(t,k?"html":"body")[0]}(e)))return D?null:"";for(l=z(a);s=l.nextNode();)3===s.nodeType&&s===c||K(s)||(s.content instanceof o&&Z(s.content),$(s),c=s);if(D){if(L)for(u=m.call(a.ownerDocument);a.firstChild;)u.appendChild(a.firstChild);else u=a;return U&&(u=_.call(r,u,!0)),u}return k?a.outerHTML:a.innerHTML},n.addHook=function(e,t){"function"==typeof t&&(v[e]=v[e]||[],v[e].push(t))},n.removeHook=function(e){v[e]&&v[e].pop()},n.removeHooks=function(e){v[e]&&(v[e]=[])},n.removeAllHooks=function(){v={}},n}(o)}.call(t,n,t,e))||(e.exports=i)}()},function(e,t,n){(function(t){var n=1/0,i="[object Symbol]",r=/[&<>"'`]/g,o=RegExp(r.source),a="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,c=a||s||Function("return this")();var l,u=(l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==l?void 0:l[e]}),d=Object.prototype.toString,p=c.Symbol,h=p?p.prototype:void 0,f=h?h.toString:void 0;function g(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&d.call(e)==i}(e))return f?f.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}e.exports=function(e){var t;return(e=null==(t=e)?"":g(t))&&o.test(e)?e.replace(r,u):e}}).call(this,n(22))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(18),s=n(17),c=function(e){function t(){var t=e.call(this)||this;return t._isOnline=navigator.onLine,t.subscribeOnlineHandlers(),t}return r(t,e),Object.defineProperty(t.prototype,"isOnline",{get:function(){return this._isOnline},set:function(e){e!==this._isOnline&&(this._isOnline=e,this.publish("isOnline",e),e&&this._onlinePromise&&this._onlinePromise.status===s.PromiseStatus.Pending&&this._onlinePromise.resolve())},enumerable:!0,configurable:!0}),t.prototype.onceOnline=function(){return this.isOnline?Promise.resolve():(this._onlinePromise&&this._onlinePromise.status===s.PromiseStatus.Pending||(this._onlinePromise=new s.CancelablePromise),this._onlinePromise.promise)},t.prototype.subscribeOnlineHandlers=function(){window.addEventListener("online",this.onlineStatusHandler.bind(this)),window.addEventListener("offline",this.onlineStatusHandler.bind(this))},t.prototype.unsubscribeOnlineHandlers=function(){window.removeEventListener("online",this.onlineStatusHandler),window.removeEventListener("offline",this.onlineStatusHandler)},t.prototype.onlineStatusHandler=function(){this.isOnline=navigator.onLine},t}(a.default);t.get=function(){return o||(o=new c),o}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=function(e){function t(t,n){var i=e.call(this,"notification_action")||this;return i.notificationType=t,i.notificationAction=n,i}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(o.TelemetryPropertyValue.Create("type",this.notificationType)),e.push(o.TelemetryPropertyValue.Create("action",this.notificationAction)),e},t}(n(8).TelemetryEvent);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(20),o=function(){function e(){this.id=r.guid.generate(),this.title="",this.description="",this.sender="",this.avatarUrl="",this.actions=[]}return e.prototype.hide=function(){window.swc.API.triggerEvent(i.ApiEvents.HideNotification,this.id)},e}();t.Notification=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.TEXT=100]="TEXT",e[e.IMAGE=200]="IMAGE",e[e.FILE=300]="FILE",e[e.SWIFT=400]="SWIFT",e[e.TYPING=500]="TYPING",e[e.EMOTICON=600]="EMOTICON",e[e.QUICK_REPLY=700]="QUICK_REPLY"}(t.MessageType||(t.MessageType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(83),r=n(1),o=n(44),a=n(7),s=n(56),c="https://www.skype.com/",l="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no, rel=noopener noreferrer",u=function(){function e(e,t,n){var u=this;switch(this.type=a.SwiftCardActionType.unknown,this.actions={},this.isValid=function(){return!!u.title||!!u.value||!!u.fallbackUri},this.isDisabled=function(){return!1},this.isSupported=function(){return null!==u.type&&u.type!==a.SwiftCardActionType.unknown},this.action=function(){return u.isValid()&&!u.isCalling()?u.actions[a.SwiftCardActionType[u.type]]().then(function(){}).catch(function(){}):Promise.resolve()},this.openUrl=function(){return u.value.match(/^skype:\?payments/)||u.value.match(/^skype:/),window.open(u.value,"_blank").opener=null,Promise.resolve()},this.imBack=function(){Date.now();return u.conversation.sendSwift({title:u.title,value:u.value}).then(function(){Date.now();return Promise.resolve()}).catch(function(){Date.now()})},this.showImage=function(){var e=u.value||"";return u.conversation.sendMessage(e,o.ActionTrigger.SUGGESTED_ACTION),Promise.resolve()},this.postBack=function(){return u.conversation.sendSwift({title:u.title,value:u.value,image:u.image}),Promise.resolve()},this.payment=function(){var e=u.fallbackUri?u.fallbackUri:u.value;if(e){var t=window.open(e,"_blank",l);return t&&window.focus&&t.focus(),t.opener=null,Promise.resolve()}},this.convertToActionType=function(e){if(!e)return null;try{switch(e.toLowerCase()){case"unsupported":return a.SwiftCardActionType.unsupported;case"openurl":return a.SwiftCardActionType.openUrl;case"imback":return a.SwiftCardActionType.imBack;case"signin":return a.SwiftCardActionType.signin;case"call":return a.SwiftCardActionType.call;case"showimage":return a.SwiftCardActionType.showImage;case"payment":case"anypayment":return a.SwiftCardActionType.payment;case"postback":return a.SwiftCardActionType.postBack;default:return a.SwiftCardActionType.unknown}}catch(e){return a.SwiftCardActionType.unknown}},this.type=this.convertToActionType(e.type),this.isCallActionType=this.type===a.SwiftCardActionType.call,this.title=s.default.normalizeText(e.title),this.value=e.value?s.default.normalizeUrl(e.value,t.isDirectLineBackend()):null,this.isCalling=ko.observable(!1),this.senderId=n,this.tooltip=this.title,this.image=e.image?e.image:null,this.fallbackUri=e.fallback&&e.fallback.uri?s.default.normalizeUrl(e.fallback.uri,t.isDirectLineBackend()):null,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.call]]=this.call,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.imBack]]=this.imBack,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.postBack]]=this.postBack,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.openUrl]]=this.openUrl,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.showImage]]=this.showImage,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.signin]]=this.openUrl,this.actions[a.SwiftCardActionType[a.SwiftCardActionType.payment]]=this.payment,this.type){case a.SwiftCardActionType.call:this.value=s.default.normalizeDestination(this.value);break;case a.SwiftCardActionType.imBack:if(t.isGroup()){var d=this.value,p=n.substring(3),h=function(){var e=new i.MentionDomEncoder,n=e.getMentionUserData(p,t);if(n){var r=e.createXmlElement(document,n).outerHTML;u.value=r+" "+d}};t.participants.filter(function(e){return e.person.id.toLowerCase()===p}).forEach(function(e){e.person.subscribe("displayName",h)}),h()}break;case a.SwiftCardActionType.showImage:this.value&&(this.value=s.default.normalizeUrl(e.value,t.isDirectLineBackend())),this.title||(this.title=r.default.instance.i18n.fetch("s_showImageTitle"));break;case a.SwiftCardActionType.payment:this.value&&(this.value.match(/^skype:\?payments/)?this.value=s.default.normalizeDestination(this.value):this.value=s.default.normalizeUrl(e.value,t.isDirectLineBackend()));break;case a.SwiftCardActionType.openUrl:this.value&&(this.value.match(/^skype:/)?this.value=s.default.normalizeDestination(this.value):this.value=s.default.normalizeUrl(e.value,t.isDirectLineBackend(),a.SwiftCardActionType.openUrl),this.tooltip?this.tooltip+="\n\n"+this.value:this.tooltip=this.value);break;case a.SwiftCardActionType.signin:this.value=s.default.normalizeUrl(e.value,t.isDirectLineBackend(),a.SwiftCardActionType.signin),this.title||(this.title=r.default.instance.i18n.fetch("s_signInTitle"));break;case a.SwiftCardActionType.unsupported:this.type=a.SwiftCardActionType.openUrl,this.title||(this.title=r.default.instance.i18n.fetch("s_unsupported_button")),this.value||(this.value=c);break;case a.SwiftCardActionType.postBack:this.title=s.default.normalizeText(this.title),this.value=s.default.normalizeText(this.value),this.tooltip||(this.tooltip=this.title)}this.conversation=t}return e.prototype.call=function(){return Promise.reject("Calling is not supported")},e}();t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(18),s=n(40),c=n(7),l=function(e){function t(t,n){var i=e.call(this)||this;return i.customType=c.CustomMessageType.Custom,i.supportedAnnotations=[],i.type=c.MessageType.UserMessage,i._isDeleted=!1,i._isEdited=!1,i.timestamp=new Date,i.originalTimestamp=i.timestamp,i._payload=n,i._status=c.DeliveryStatus.Pending,i.suggestedActions=new s.ObservableCollection,t&&(i.type=c.MessageType.SystemMessage),i.supportedAnnotations.push(o.default.MESSAGE_PROPERTIES.PER_USER.EMOTIONS),i.emotions=new s.ObservableCollection,i.files=new s.ObservableCollection,i}return r(t,e),Object.defineProperty(t.prototype,"clientMessageId",{get:function(){return this._clientMessageId},set:function(e){this._clientMessageId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"composeTime",{get:function(){return this._composeTime},set:function(e){e!==this._composeTime&&(this._composeTime=e,this.publish("composeTime",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},set:function(e){e!==this._content&&(this._content=e,this.publish("content",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){e!==this._direction&&(this._direction=e,this.publish("direction",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageContent",{get:function(){return this._imageContent},set:function(e){e!==this._imageContent&&(this._imageContent=e,this.publish("imageContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return this._isDeleted},set:function(e){e!==this._isDeleted&&(this._isDeleted=e,this.publish("isDeleted",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEdited",{get:function(){return this._isEdited},set:function(e){e!==this._isEdited&&(this._isEdited=e,this.publish("isEdited",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFirst",{get:function(){return this._isFirst},set:function(e){e!==this._isFirst&&(this._isFirst=e,this.publish("isFirst",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTranslated",{get:function(){return this._isTranslated},set:function(e){e!==this._isTranslated&&(this._isTranslated=e,this.publish("isTranslated",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key},set:function(e){e!==this._key&&(this._key=e,this.publish("key",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalTimestamp",{get:function(){return this._originalTimestamp},set:function(e){e!==this._originalTimestamp&&(this._originalTimestamp=e,this.publish("originalTimestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processedContent",{get:function(){return this._processedContent},set:function(e){e!==this._processedContent&&(this._processedContent=e,this.publish("processedContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawMessageType",{get:function(){return this._rawMessageType},set:function(e){this._rawMessageType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this._sender},set:function(e){e!==this._sender&&(this._sender=e,this.publish("sender",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"senderId",{get:function(){return this._senderId},set:function(e){e!==this._senderId&&(this._senderId=e,this.publish("senderId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skypeEditedId",{get:function(){return this._skypeEditedId},set:function(e){e!==this._skypeEditedId&&(this._skypeEditedId=e,this.publish("skypeEditedId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){e!==this._status&&(this._status=e,this.publish("status",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){e!==this._timestamp&&(this._timestamp=e,this.publish("timestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translation",{get:function(){return this._content},set:function(e){e!==this._translation&&(this._translation=e,this.publish("translation",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},set:function(e){e!==this._version&&(this._version=e)},enumerable:!0,configurable:!0}),t}(a.default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(113),l=n(67),u=n(132),d=function(e){function t(t){var n=e.call(this,t)||this;return n._onAvatarUpdate=function(e){n.setState({avatarUrl:e})},n._onTopicUpdate=function(e){n.setState({title:e})},n._onBlockedUpdate=function(e){n.setState({showBlock:e})},n._onPresenceUpdate=function(e){var t;switch(e){case c.PresenceStatus.Online:t=l.PresenceStatusUI.Online;break;case c.PresenceStatus.Busy:case c.PresenceStatus.OnThePhone:t=l.PresenceStatusUI.Busy;break;case c.PresenceStatus.Away:case c.PresenceStatus.Idle:case c.PresenceStatus.OutToLunch:case c.PresenceStatus.BeRightBack:t=l.PresenceStatusUI.Away}n.setState({presenceStatus:t})},n.state={title:"",avatarUrl:"",showBlock:!1,presenceStatus:null},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this.props.person;this._onTopicUpdate(e.displayName||e.id),e.subscribe("displayName",this._onTopicUpdate),this.props.isPstn||(this._onBlockedUpdate(e.isBlocked),e.subscribe("isBlocked",this._onBlockedUpdate),this.props.customAvatar?this._onAvatarUpdate(this.props.customAvatar):(this._onAvatarUpdate(e.avatarData),e.subscribe("avatarData",this._onAvatarUpdate)),this.props.showPresence&&(this._onPresenceUpdate(e.presenceStatus),e.subscribe("presenceStatus",this._onPresenceUpdate)))},t.prototype.componentWillUnmount=function(){var e=this.props.person;e.unsubscribe("avatarData",this._onAvatarUpdate),e.unsubscribe("displayName",this._onTopicUpdate),e.unsubscribe("isBlocked",this._onBlockedUpdate),e.unsubscribe("presenceStatus",this._onPresenceUpdate)},t.prototype.render=function(){return this.props.isPstn?s.createElement(u.PstnAvatar,o({},this.state)):s.createElement(l.BasicAvatar,o({},this.state,{onClick:this.props.onClick}))},t}(a.Component);t.PersonAvatar=d},,function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&h())}function h(){if(!u){var e=s(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||u||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError;e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.testOrigin=function(t){return e.origin!==t},e.post=function(t,n){try{e.targets[t].target.postMessage(n,"*")}catch(e){}},e.cast=function(t,n,i,r){var o={name:t,origin:e.origin,payload:n};i?Array.isArray(i)?i.forEach(function(t){return e.post(t,o)}):e.post(i,o):Object.keys(e.targets).forEach(function(t){return r!==e.targets[t].origin&&e.post(t,o)})},e.exists=function(t){return!!e.registry[t]},e.copy=function(t){t&&t.registry&&Object.getOwnPropertyNames(t.registry).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t.registry,n);i&&i.writable&&(e.registry[n]=i.value||e.registry[n])})},e.addTarget=function(t,n,i,r){e.targets[t]=e.targets[t]||{target:r,origin:n,targetDomain:i}},e.removeTarget=function(t){delete e.targets[t]},e.connect=function(t){e.origin=t,e.connected||(window.addEventListener("message",e.receiver),e.connected=!0)},e.disconnect=function(){window.removeEventListener("message",e.receiver),e.connected=!1},e.registerEvent=function(t,n){if(t&&n){var i=e.registry;if(i[t]){if(-1!==i[t].indexOf(n))return}else i[t]=[];i[t].push(n)}},e.unregisterEvent=function(t,n){if(t&&n){var i=e.registry;if(i[t]&&i[t].length){var r=i[t].indexOf(n);-1!==r&&i[t].splice(r,1)}}},e.triggerEvent=function(t,n,i,r,o){void 0===i&&(i=!0),e.connected&&i&&e.cast(t,n,r,o);var a=!1,s=e.registry;return s[t]&&s[t].forEach(function(e){try{e(n),a=!0}catch(e){}}),a},e.dispose=function(){for(var t in e.registry)delete e.registry[t];e.disconnect()},e.targets={},e.receiver=function(t){var n=t.data;n&&n.origin&&e.testOrigin(n.origin)&&n.name&&e.triggerEvent(n.name,n.payload,!0,null,n.origin)},e.registry={},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(36),s=n(8),c=function(e){function t(t){var n=e.call(this,"kpi_conversation_load",t)||this;return n.status=200,n.cached=!1,n}return r(t,e),t.prototype.getCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);return t.push(o.TelemetryPropertyValue.Create("status",this.getProperty(this.status))),t.push(o.TelemetryPropertyValue.Create("timeLoad",this.timeToLoad||0)),t.push(o.TelemetryPropertyValue.Create("timeRender",this.timeToRender||0)),t.push(o.TelemetryPropertyValue.Create("messages",this.messagesCount||s.NA)),t.push(o.TelemetryPropertyValue.Create("cached",this.cached)),t},t.isAvailable=!0,t}(a.ConversationDataEvent);t.ConversationLoadEvent=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(1),l=n(20),u=function(e){function t(t){var n=e.call(this,t)||this;return n._id=l.guid.generate(),n.state=o({isAnimated:!1,textOnly:!1},n._getNewState(t)),t.setUpdateCallback&&t.setUpdateCallback(function(e){n.setState(function(){return n._getNewState(e)})}),n}return r(t,e),t.prototype._getNewState=function(e){var t=c.default.instance.PesManager.emoticonMap,n=e.emoticonId||this.props.emoticonId,i=e.textContent||this.props.textContent,r=e.title||this.props.title;if(!n||!t.hasOwnProperty(n))return{textOnly:!0,textContent:i};var o={textOnly:!1,textContent:i,title:r,emoticonId:n};return!0===e.isAnimated?o.isAnimated=!0:!1===e.isAnimated&&(o.isAnimated=!1),o},t.prototype.componentDidMount=function(){var e=this;this.setState(function(t,n){return e._getNewState(n)})},t.prototype.componentWillReceiveProps=function(e){var t=this;this.setState(function(){return t._getNewState(e)})},t.prototype.render=function(){if(this.state.textOnly)return s.createElement("span",null,this.state.textContent);var e=["emoticon"],t={"data-item-id":this.state.emoticonId,"data-is-animated":this.state.isAnimated,textContent:this.state.textContent,title:this.state.title};return this.props.large&&e.push(this.props.largeEmoticonClass),s.createElement("span",{className:e.join(" ")},s.createElement("canvas",o({},t,{id:this._id})))},t}(a.Component);t.SwcEmoticon=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=/(\(|\))/g,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.wordRawToXml=function(e,t,n,i){for(var r,o=[],a=/[\.,_:\-;?]$/,s=t.substring(1),c=this.getMentionUserData(s,n,i);!c&&s.match(a);)r=s.charAt(s.length-1),s=s.substring(0,s.length-1),c=this.getMentionUserData(s,n,i);return c&&(o.push(this.createXmlElement(e,c)),r&&o.push(e.createTextNode(r))),o},t.prototype.getMentionUserData=function(e,t,n){var i,r={defaultDisplayName:"",displayName:"",skypeId:"",type:"",isMePerson:!1};if(!e)return null;var a=0===(e=e.toLowerCase()).indexOf("("),s=a?e.substring(1,e.length-1):"",c=t?t.participants:[];if(r.isMePerson=!!n&&(e===n.id.toLowerCase()||a&&n.displayName.replace(o,"").toLowerCase()===s),r.isMePerson)i=n;else{var l=c.filter(function(t){return t.person.id.toLowerCase()===e||a&&t.person.displayName.replace(o,"").toLowerCase()===s});l.length&&(i=l[0].person)}return i?(r.skypeId=i.id,r.type="28",r.displayName=i.displayName,r.defaultDisplayName||(r.defaultDisplayName=r.displayName),r):null},t.prototype.wordMatcher=function(){return/@([a-z0-9\.,\-_:]+|\(.+?\))/gi},t.prototype.createXmlElement=function(e,t){var n=e.createElement("at");return n.setAttribute("id",t.type+":"+t.skypeId),n.innerText=t.defaultDisplayName,n},t}(n(37).WordDomTransformer);t.MentionDomEncoder=a},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){var i=n(63).Buffer;function r(e,t){this._block=i.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}r.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=i.from(e,t));for(var n=this._block,r=this._blockSize,o=e.length,a=this._len,s=0;s<o;){for(var c=a%r,l=Math.min(o-s,r-c),u=0;u<l;u++)n[c+u]=e[s+u];s+=l,(a+=l)%r==0&&this._update(n)}return this._len+=o,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var i=(4294967295&n)>>>0,r=(n-i)/4294967296;this._block.writeUInt32BE(r,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var o=this._hash();return e?o.toString(e):o},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(30),a=n(5),s=n(8),c=function(e){function t(){return e.call(this,"runtimeError")||this}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(a.TelemetryPropertyValue.Create("message",this.message)),e.push(a.TelemetryPropertyValue.Create("shortMessage",this.shortMessage)),e.push(a.TelemetryPropertyValue.Create("stack",this.stack)),e.push(a.TelemetryPropertyValue.Create("code",this.code)),e.push(this.getConversationId()),e},t.prototype.getConversationId=function(){return this.conversationId?0===this.conversationId.indexOf("8:")?a.TelemetryPropertyValue.Create("conversationId",this.conversationId,o.PIIType.Identity):a.TelemetryPropertyValue.Create("conversationId",this.conversationId):a.TelemetryPropertyValue.Create("conversationId",s.NA)},t}(s.TelemetryEvent);t.ErrorEvent=c},function(e,t){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1})},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"a"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){var n,i=t.match(/^(?:https?:\/\/|mailto:)(.+)$/i),r=i&&i[0],o=r;return r||(r=(i=t.match(/^[^@]+@(?:\w+(?:\.\w+)+)$/i))&&"mailto:"+i[0],o=i&&i[0]),r||(i=t.match(/^(?:www(?:\.\w+){1,}\.(?:com|org|net|edu|gov|mil|aero|arpa|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|tel|travel|[a-z]{2,3}))$/i))&&i[0]&&(n=i.input?i.input.split("?")[1]:"",r="https://"+i[0],o=r=n?r+"?"+n:r),r?[this.createXmlElement(e,r,o)]:[]},t.prototype.wordMatcher=function(){return/\S+/g},t.prototype.createXmlElement=function(e,t,n){var i=e.createElement("a");return i.setAttribute("href",t),i.setAttribute("title",t),i.setAttribute("target","_blank"),i.setAttribute("tabindex","-1"),i.innerText=n,i},t}(n(37).WordDomTransformer);t.URLDomTransformer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="px",r=25,o=function(){var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",e.className="swc-scroll-viewport",e.innerHTML="<style>.swc-scroll-viewport::-webkit-scrollbar{width:0;}</style>",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}();function a(){return"rtl"===document.dir}var s=function(){function e(e,t){var n=this;this.container=e,this.viewport=t,this.recount=function(){n.vh=n.viewport.offsetHeight,n.sh=n.viewport.scrollHeight,n.vw=n.container.offsetWidth;var e=n.viewport.getBoundingClientRect();n.vpOffsetX=e.left,n.vpOffsetY=e.top,n.vh2sh=n.vh/n.sh,n.sh2vh=n.sh/n.vh;var t=Math.round(n.vh*n.vh2sh),o=n.slider.style;if(t<r){var a=n.vh-r+t;n.vh2sh=a/n.sh,o.height=r+i,n.sliderH=r}else o.height=t+i,n.sliderH=t;n.show(),n.updateSlider()},this.update=function(){n.ticking=!1,n.updateSlider()},this.show=function(){n.sh<=n.vh||!n.active?n.hide():n.visible||(n.rail.style.display="",n.visible=!0)},this.hide=function(){n.visible&&(n.rail.style.display="none",n.viewport.classList.remove("active"),n.visible=!1)},this.updateSlider=function(){var e=n.viewport.scrollTop*n.vh2sh;n.currentTop!==e&&(n.currentTop=e,n.slider.style.top=n.currentTop+i)},this.requestTick=function(e){n.ticking||requestAnimationFrame(n.update),n.ticking=!0},this.bindEvents=function(){n.viewport.addEventListener("scroll",n.requestTick,!1),n.container.addEventListener("mousedown",n.onMouseDown),n.container.addEventListener("mousemove",n.onMouseMove),n.container.addEventListener("mouseenter",n.onMouseEnter),n.container.addEventListener("mouseleave",n.onMouseLeave)},this.unbindEvents=function(){n.viewport.removeEventListener("scroll",n.requestTick,!1),n.container.removeEventListener("mousedown",n.onMouseDown),n.container.removeEventListener("mousemove",n.onMouseMove),n.container.removeEventListener("mouseenter",n.onMouseEnter),n.container.removeEventListener("mouseleave",n.onMouseLeave)},this.onMouseMove=function(e){n.dragging?n.viewport.scrollTop=(e.clientY-n.vpOffsetY)*n.sh2vh:(a()?e.clientX-n.vpOffsetX<=10:e.clientX-n.vpOffsetX>n.vw-10)?(n.rail.classList.add("active"),n.hover=!0):n.hover&&(n.rail.classList.remove("active"),n.hover=!1)},this.onMouseEnter=function(){n.active=!0,n.recount()},this.onMouseLeave=function(){n.active=!1,n.dragging||n.hide()},this.onMouseDown=function(e){var t=e.clientX-n.vpOffsetX,i=e.clientY-n.vpOffsetY;if(a()?t<10:t>=n.vw-10){var r=parseInt(n.slider.style.top,10);i>r&&i<r+n.sliderH?n.startDrag(e):n.viewport.scrollTop=i*n.sh2vh,e.preventDefault(),e.stopPropagation()}},this.handleDrag=function(e){n.viewport.scrollTop=(e.clientY-n.dragOffset)*n.sh2vh},this.startDrag=function(e){n.dragging||(n.viewport.classList.add("scrolling"),n.dragOffset=e.pageY-n.slider.offsetTop,n.dragging=!0,n.container.removeEventListener("mousemove",n.onMouseMove),window.addEventListener("mouseup",n.stopDrag),window.addEventListener("mousemove",n.handleDrag)),e.preventDefault()},this.stopDrag=function(){window.removeEventListener("mousemove",n.handleDrag),window.removeEventListener("mouseup",n.stopDrag),n.container.addEventListener("mousemove",n.onMouseMove),n.viewport.classList.remove("scrolling"),n.dragging=!1},this.container.classList.add("swc-scroll-wrapper"),this.viewport.classList.add("swc-scroll-viewport"),o&&this.viewport.classList.add("swc-scroll-hide"),this.build(),this.init()}return e.prototype.init=function(){this.bindEvents()},e.prototype.build=function(){this.slider=document.createElement("div"),this.slider.className="swc-scroll-slider",this.rail=document.createElement("div"),this.rail.className="swc-scroll-rail",this.rail.appendChild(this.slider),this.rail.style.display="none",this.container.appendChild(this.rail)},e}();t.default=s},function(e,t,n){(function(t,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4+314e4831
 */var i;i=function(){"use strict";function e(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,o=void 0,a=void 0,s=function(e,t){f[r]=e,f[r+1]=t,2===(r+=2)&&(a?a(g):S())};var c="undefined"!=typeof window?window:void 0,l=c||{},u=l.MutationObserver||l.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function h(){var e=setTimeout;return function(){return e(g,1)}}var f=new Array(1e3);function g(){for(var e=0;e<r;e+=2){(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0}r=0}var m,_,v,y,S=void 0;function E(e,t){var n=this,i=new this.constructor(I);void 0===i[C]&&H(i);var r=n._state;if(r){var o=arguments[r-1];s(function(){return x(r,i,o,n._result)})}else L(n,i,e,t);return i}function T(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(I);return w(t,e),t}d?S=function(){return t.nextTick(g)}:u?(_=0,v=new u(g),y=document.createTextNode(""),v.observe(y,{characterData:!0}),S=function(){y.data=_=++_%2}):p?((m=new MessageChannel).port1.onmessage=g,S=function(){return m.port2.postMessage(0)}):S=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(g)}:h()}catch(e){return h()}}():h();var C=Math.random().toString(36).substring(2);function I(){}var A=void 0,b=1,O=2,R={error:null};function P(e){try{return e.then}catch(e){return R.error=e,R}}function N(t,n,i){n.constructor===t.constructor&&i===E&&n.constructor.resolve===T?function(e,t){t._state===b?k(e,t._result):t._state===O?D(e,t._result):L(t,void 0,function(t){return w(e,t)},function(t){return D(e,t)})}(t,n):i===R?(D(t,R.error),R.error=null):void 0===i?k(t,n):e(i)?function(e,t,n){s(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?w(e,n):k(e,n))},function(t){i||(i=!0,D(e,t))},e._label);!i&&r&&(i=!0,D(e,r))},e)}(t,n,i):k(t,n)}function w(e,t){var n,i;e===t?D(e,new TypeError("You cannot resolve a promise with itself")):(i=typeof(n=t),null===n||"object"!==i&&"function"!==i?k(e,t):N(e,t,P(t)))}function M(e){e._onerror&&e._onerror(e._result),U(e)}function k(e,t){e._state===A&&(e._result=t,e._state=b,0!==e._subscribers.length&&s(U,e))}function D(e,t){e._state===A&&(e._state=O,e._result=t,s(M,e))}function L(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+b]=n,r[o+O]=i,0===o&&e._state&&s(U,e)}function U(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?x(n,i,r,o):r(o);e._subscribers.length=0}}function x(t,n,i,r){var o=e(i),a=void 0,s=void 0,c=void 0,l=void 0;if(o){if((a=function(e,t){try{return e(t)}catch(e){return R.error=e,R}}(i,r))===R?(l=!0,s=a.error,a.error=null):c=!0,n===a)return void D(n,new TypeError("A promises callback cannot return that same promise."))}else a=r,c=!0;n._state!==A||(o&&c?w(n,a):l?D(n,s):t===b?k(n,a):t===O&&D(n,a))}var F=0;function H(e){e[C]=F++,e._state=void 0,e._result=void 0,e._subscribers=[]}var G=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(I),this.promise[C]||H(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&k(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===A&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===T){var r=P(e);if(r===E&&e._state!==A)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===j){var o=new n(I);N(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===A&&(this._remaining--,e===O?D(i,n):this._result[t]=n),0===this._remaining&&k(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;L(e,void 0,function(e){return n._settledAt(b,t,e)},function(e){return n._settledAt(O,t,e)})},e}();var j=function(){function e(t){this[C]=F++,this._result=this._state=void 0,this._subscribers=[],I!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){w(e,t)},function(t){D(e,t)})}catch(t){D(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},e}();return j.prototype.then=E,j.all=function(e){return new G(this,e).promise},j.race=function(e){var t=this;return i(e)?new t(function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},j.resolve=T,j.reject=function(e){var t=new this(I);return D(t,e),t},j._setScheduler=function(e){a=e},j._setAsap=function(e){s=e},j._asap=s,j.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=j},j.Promise=j,j},e.exports=i()}).call(this,n(78),n(22))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),r=n(19),o=function(){function e(){}return e.addScript=function(t,n,o,a){var s=n?r.default.getAbsoluteUrl(t,"js"):t;if(-1==e.loaded.indexOf(s)){var c=e.progress;if(c[s])return o&&-1==c[s].success.indexOf(o)&&c[s].success.push(o),void(a&&-1==c[s].failure.indexOf(a)&&c[s].failure.push(a));c[s]={success:[],failure:[]},o&&c[s].success.push(o),a&&c[s].failure.push(a);var l=i.default.getDocument(),u=l.createElement("script");u.type="text/javascript",u.src=s,o&&(u.onload=function(){e.progress[s].success.forEach(function(e){try{e()}catch(e){}}),delete e.progress[s],e.loaded.push(s)}),a&&(u.onerror=function(){e.progress[s].failure.forEach(function(e){try{e()}catch(e){}}),delete e.progress[s]}),l.getElementsByTagName("body")[0].appendChild(u)}else o&&o()},e.hasScript=function(e){for(var t=0;t<document.scripts.length;t++){if(document.scripts[t].src===e)return!0}return!1},e.loaded=[],e.progress={},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={allowedProtocols:["https:"]},r=function(){function e(){this.probe=document.createElement("a")}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},e.prototype.validate=function(e,t){if(!e)return!1;var n=Object.assign(i,t||{}),r=function(e,t){if(!t)return!0;for(var n,i=0,r=t;i<r.length;i++){if(n=r[i]===e)break}return n};this.probe.href=e;var o=r(this.probe.protocol,n.allowedProtocols)&&r(this.probe.hostname,n.allowedDomains)&&r(this.probe.port,n.allowedPorts);return this.probe.href="",o},e}();t.UrlValidator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){this.fn=e}return e.prototype.fulfill=function(e){this.fn(e)},e}(),o=function(){function e(e,t,n){this.ns=e,this.name=t,this.method=n,this.defer=this.defer.bind(this)}return e.prototype.defer=function(){var e,t,n=new Promise(function(n,i){e=new r(n),t=new r(i)});return a.calls[this.ns][this.name].push({method:this.method,args:arguments,resolve:e,reject:t}),n},e}(),a=function(){function e(){}return e.execute=function(t,n,i,r){if(t&&t[n]&&t[n].deferred){var o=e.calls[t][n];t[n]=i;var a=Object.keys(i);o.forEach(function(e){if(a.indexOf(e.method)>-1){var i=t[n][e.method].apply(r,e.args);i instanceof Promise?i.then(function(t){return e.resolve.fulfill(t)},function(t){return e.reject.fulfill(t)}):e.resolve.fulfill()}}),delete e.calls[t][n]}},e.deferApi=function(t,n,i){t&&!t[n]&&(t[n]={deferred:!0},i.forEach(function(e){t[n][e]=new o(t,n,e).defer}),e.calls[t]=e.calls[t]||{},e.calls[t][n]=[])},e.calls={},e}();t.default=i.swc.deferrer=i.swc.deferrer||a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.unknown=0]="unknown",e[e.card=1]="card",e[e.carousel=2]="carousel",e[e.signin=3]="signin",e[e.receipt=4]="receipt",e[e.multiline=5]="multiline",e[e.adaptive=6]="adaptive"}(t.SwiftCardType||(t.SwiftCardType={})),function(e){e[e.unknown=0]="unknown",e[e.hero=1]="hero",e[e.thumb=2]="thumb",e[e.receipt=3]="receipt",e[e.signin=4]="signin",e[e.video=5]="video",e[e.audio=6]="audio",e[e.animation=7]="animation",e[e.actionImage=8]="actionImage",e[e.flex=9]="flex",e[e.adaptive=10]="adaptive"}(t.SwiftCardContentType||(t.SwiftCardContentType={})),function(e){e[e.unknown=0]="unknown",e[e.unsupported=1]="unsupported",e[e.openUrl=2]="openUrl",e[e.imBack=3]="imBack",e[e.signin=4]="signin",e[e.call=5]="call",e[e.showImage=6]="showImage",e[e.payment=7]="payment",e[e.postBack=8]="postBack"}(t.SwiftCardActionType||(t.SwiftCardActionType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UserMessage="UserMessage",e.SwiftCard="SwiftCard",e.SystemMessage="SystemMessage",e.Unsupported="Unsupported",e.SkypeLogo="SkypeLogo",e.Welcome="Welcome",e.Translate="Translate",e.LwcImage="LwcImage",e.LwcFile="LwcFile",e.UnreadSplitter="UnreadSplitter"}(t.MessageType||(t.MessageType={})),function(e){e.CallEnd="CallEndMsg",e.MissedCall="MissedCallMsg",e.MissedGroupCall="MissedGroupCallMsg",e.Call="CallMsg",e.Custom="CustomMsg",e.MeLeftGroup="MeLeftGroupConversation"}(t.CustomMessageType||(t.CustomMessageType={})),function(e){e[e.Incoming=0]="Incoming",e[e.Outgoing=1]="Outgoing"}(t.Direction||(t.Direction={})),function(e){e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed"}(t.DeliveryStatus||(t.DeliveryStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.addMember="addMember",e.changeTopic="changeTopic",e.changePicture="changePicture",e.kickMember="kickMember",e.editMsg="editMsg",e.callP2P="callP2P",e.sendText="sendText",e.sendSms="sendSms",e.sendFileP2P="sendFileP2P",e.sendContacts="sendContacts",e.sendVideoMsg="sendVideoMsg",e.sendMediaMsg="sendMediaMsg",e.changeModerated="changeModerated"}(t.ParticipantCapabilities||(t.ParticipantCapabilities={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Admin="Admin",e.User="User"}(t.ParticipantRole||(t.ParticipantRole={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){var t=this;this.getLogger=function(e){if(t.loggerPromise)return t.loggerPromise;var n=new i.swcWindow.ariaTelemetry.LogConfiguration;return n.disableCookies=!0,i.swcWindow.ariaTelemetry.LogManager.initialize(t.tenantId,n),t.loggerPromise=new Promise(function(n,r){t.logger?n(t.logger):(t.logger=new i.swcWindow.ariaTelemetry.Logger(e),n(t.logger))}),t.loggerPromise},this.tenantId=e,this.getLogger(e)}return e.prototype.sendEvent=function(e){this.getLogger(this.tenantId).then(function(t){t.logEvent(e)})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.multilineRegExp=function(e,t){return new RegExp(e.join(""),t)},e.escapeSpecialChars=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},e}();t.default=i},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(253),a={retryCount:3,timeout:12e4,policy:""};t.request=function(e,t,n){var o=0===t.indexOf("http")?t:i.default.AMS_HOST_URL+t;return r.default("ams-"+e,a,o,n)},t.putData=function(e,n,i){return o.getHeaders().then(function(r){var o={method:"PUT"};return o.body=i,o.headers=r,t.request(e,n,o)})},t.getData=function(e,n){return o.getHeaders().then(function(i){i.append("Accept","image/webp,image/*,*/*;q=0.8"),i.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=i,t.request(e,n,r).then(function(e){return e.blob()})})},t.getJson=function(e,n){return o.getHeaders().then(function(i){i.append("Accept","image/webp,image/*,*/*;q=0.8"),i.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=i,t.request(e,n,r).then(function(e){return e.json()})})},t.post=function(e,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var o={method:"POST"};return o.body=i,o.headers=r,t.request(e,n,o)})},t.postForm=function(e,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/x-www-form-urlencoded");var o={method:"POST"};return o.headers=r,o.credentials="include",i&&(o.body=i),t.request(e,n,o)})},t.get=function(e,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"GET"};return r.headers=i,t.request(e,n,r)})},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(251),o=n(3),a=function(){function e(){this.services={},this.threshold=10}return e.prototype.register=function(e,t,n,i,o){if(!this.services[e]){i&&i.status;this.services[e]=new r.default(e,t,n,i.status,o)}i&&i.ok?(this.services[e].successCount++,this.services[e].ttsSuccess+=n):this.services[e].ttsFailure+=n,this.services[e].totalCount++,this.services[e].totalCount>=this.threshold&&this.publishEvent(e)},e.prototype.flushAll=function(){for(var e in this.services)this.publishEvent(e)},e.prototype.publishEvent=function(e){var t=this.services[e];t.successCount>0&&(t.ttsSuccess=t.ttsSuccess/t.successCount),t.ttsFailure>0&&(t.ttsFailure=t.ttsFailure/(t.totalCount-t.successCount)),o.default.telemetryManager.sendEvent(t),delete this.services[e]},e}();t.default=function(){return i||(i=new a),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGetParamsToUrl=function(e,t){var n=[],i=function(e){if(void 0!==t[e]){var i=encodeURIComponent(e);if(Array.isArray(t[e]))t[e].forEach(function(e){var t=encodeURIComponent(e);n.push(i+"="+t)});else{var r=encodeURIComponent(t[e].toString());n.push(i+"="+r)}}};for(var r in t)i(r);return e+"?"+n.join("&")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(6),o=n(23),a=n(13),s=n(70),c=n(32),l=n(3),u=n(138),d=n(53),p=function(){u.getPolling().authorization.then(function(){h()?t.activationRequest().then(function(e){t.stopActivation(),e&&e.ok&&(i=setTimeout(p,12e3))},function(){t.stopActivation()}):t.stopActivation()})};function h(){return l.default.signInManager.userIdentityType===c.IdentityType.SKYPE&&l.default.signInManager.state===o.SigninState.SignedIn&&s.get().isOnline&&r.default.get.backend!==a.MessagingBackend.TEAMS}t.activationRequest=function(){var e=l.default.storage.getItem("skype|epid"),t="users/ME/endpoints/"+e+"/active",n={body:JSON.stringify({timeout:15})};return!e&&h()?Promise.reject({}):d.post("active",t,n)},t.startActivation=function(){i||h()&&p()},t.stopActivation=function(){i&&(clearTimeout(i),i=null)},s.get().subscribe("isOnline",function(e){e||t.stopActivation()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Chat="chat",e.Space="space",e.Topic="topic",e.SfbInterop="sfbinterop"}(t.ThreadType||(t.ThreadType={})),function(e){e.Text="Text",e.RichText="RichText",e.RichTextUriObject="RichText/UriObject",e.RichTextMedia_GenericFile="RichText/Media_GenericFile",e.ControlClearTyping="Control/ClearTyping",e.ControlTyping="Control/Typing",e.ControlLiveState="Control/LiveState",e.SystemMessage="SystemMessage",e.InviteFreeRelationshipChangedInitialized="InviteFreeRelationshipChanged/Initialized",e.SignalFlamingo="Signal/Flamingo",e.RichTextHtml="RichText/Html"}(t.MessagePayloadType||(t.MessagePayloadType={})),function(e){e.Audio="Audio",e.Video="Video"}(t.PresenceCapabilities||(t.PresenceCapabilities={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOST_URL="https://directline.botframework.com/api/",t.V3_HOST_URL="https://directline.botframework.com/v3/directline/",t.V3_BING_HOST_URL="https://bing.botframework.com/v3/directline/",t.POLLING_INTERVAL=1500,t.CONTINUOUS_POLLING_INTERVAL=5e3,t.MAX_RETRY_ATTEMPTS=5,t.MAX_POLLING_RETRIES=10},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(79);var i=n(11),r=n(10),o=function(){function e(){}return e.prototype.set=function(e){this._throwIfFalsy(e),this._resourcesLocation=e},e.prototype.merge=function(e){this._throwIfFalsy(e),Object.assign(this._resourcesLocation,e)},e.prototype.get=function(){return this._resourcesLocation},e.prototype._throwIfFalsy=function(e){e||i.default.throwError(r.ErrorCodes.ERR_DESTINATION_NOT_REACHABLE,"[i18n / resources] Specified destination for localizations resources is not reachable")},e}();t.default=new o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maxLength=16,t.minLength=2,t.firstLetters="8:(B;|I]>+xX<*\\",t.firstLettersMap={8:"8",":":":","(":"(",B:"B",";":";","|":"|",I:"I","]":"]",">":">","+":"+",x:"x",X:"X","<":"<","*":"*","\\":"\\"},t.clearShortcutMap=function(){t.shortcutIdMap={}},t.idEmoticonMap={},t.shortcutIdMap={":)":"smile",":-)":"smile",":=)":"smile","(smile)":"smile",":(":"sad",":-(":"sad",":=(":"sad","(sad)":"sad",":<":"sad",":-<":"sad",":D":"laugh",":-D":"laugh",":=D":"laugh",":d":"laugh",":-d":"laugh",":=d":"laugh","(laugh)":"laugh",":>":"laugh",":->":"laugh","(lol)":"laugh","(LOL)":"laugh","(cool)":"cool","8-)":"cool","8=)":"cool","B-)":"cool","B=)":"cool",":O":"surprised",":-O":"surprised",":=O":"surprised",":o":"surprised",":-o":"surprised",":=o":"surprised","(surprised)":"surprised",";)":"wink",";-)":"wink",";=)":"wink","(wink)":"wink",";(":"cry",";-(":"cry",";=(":"cry","(cry)":"cry",":'(":"cry","(:|":"sweat","(sweat)":"sweat",":|":"speechless",":-|":"speechless",":=|":"speechless","(speechless)":"speechless","(kiss)":"kiss",":*":"kiss",":-*":"kiss",":=*":"kiss","(xo)":"kiss","(K)":"kiss","(k)":"kiss",":P":"tongueout",":-P":"tongueout",":=P":"tongueout",":p":"tongueout",":-p":"tongueout",":=p":"tongueout","(tongueout)":"tongueout",":$":"blush",":-$":"blush",":=$":"blush",':">':"blush","(blush)":"blush",":^)":"wonder","(wonder)":"wonder","|-)":"sleepy","I-)":"sleepy","I=)":"sleepy","(snooze)":"sleepy","|-(":"dull","|(":"dull","|=(":"dull","(dull)":"dull","(inlove)":"inlove","(love)":"inlove",":]":"inlove",":-]":"inlove","]:)":"eg",">:)":"eg","(grin)":"eg","(yn)":"fingerscrossed","(fingers)":"fingerscrossed","(fingerscrossed)":"fingerscrossed","(crossedfingers)":"fingerscrossed","(yawn)":"yawn","(puke)":"puke",":&":"puke",":-&":"puke",":=&":"puke","+o(":"puke","(doh)":"doh","(angry)":"angry",":@":"angry",":-@":"angry",":=@":"angry","x(":"angry","x-(":"angry","X(":"angry","X-(":"angry","x=(":"angry","X=(":"angry",";@":"angry",";-@":"angry","(wasntme)":"wasntme","(wm)":"wasntme","(party)":"party","<O)":"party","<o)":"party","<:o)":"party","(worry)":"worry",":S":"worry",":s":"worry",":-s":"worry",":-S":"worry",":=s":"worry",":=S":"worry","(mm)":"mmm","(mmm)":"mmm","(mmmm)":"mmm","(nerd)":"nerdy","8-|":"nerdy","B-|":"nerdy","8|":"nerdy","B|":"nerdy","8=|":"nerdy","B=|":"nerdy",":x":"lipssealed",":-x":"lipssealed",":X":"lipssealed",":-X":"lipssealed",":#":"lipssealed",":-#":"lipssealed",":=x":"lipssealed",":=X":"lipssealed",":=#":"lipssealed","(wave)":"hi","(hi)":"hi","(bye)":"hi","(BYE)":"hi","(Bye)":"hi","(Hi)":"hi","(HI)":"hi","(facepalm)":"facepalm","(fail)":"facepalm","(devil)":"devil","(6)":"devil","(angel)":"angel","(A)":"angel","(a)":"angel","(envy)":"envy","(V)":"envy","(v)":"envy","(wait)":"wait","(hug)":"hug","(bear)":"hug","(makeup)":"makeup","(kate)":"makeup","(chuckle)":"giggle","(giggle)":"giggle","(clap)":"clap","(think)":"think",":-?":"think",":?":"think",":=?":"think","*-)":"think","(bow)":"bow","(rofl)":"rofl","(rotfl)":"rofl","(whew)":"whew","(phew)":"whew","(happy)":"happy","(smirk)":"smirk","(nod)":"nod","(shake)":"shake","(waiting)":"waiting","(forever)":"waiting","(impatience)":"waiting","(emo)":"emo","(y)":"yes","(Y)":"yes","(ok)":"yes","(yes)":"yes","(OK)":"yes","(oK)":"yes","(Ok)":"yes","(n)":"no","(N)":"no","(no)":"no","(handshake)":"handshake","(highfive)":"highfive","(hifive)":"highfive","(h5)":"highfive","(heart)":"heart","(h)":"heart","(H)":"heart","(l)":"heart","(L)":"heart","<3":"heart","(lalala)":"lalala","(lalalala)":"lalala","(lala)":"lalala","(notlistening)":"lalala","(heidy)":"heidy","(squirrel)":"heidy","(F)":"flower","(f)":"flower","(flower)":"flower","(rain)":"rain","(london)":"rain","(st)":"rain","(ST)":"rain","(St)":"rain","(sun)":"sun","(#)":"sun","(tumbleweed)":"tumbleweed","(music)":"music","(8)":"music","(bandit)":"bandit","(tmi)":"tmi","(coffee)":"coffee","(c)":"coffee","(C)":"coffee","(pi)":"pizza","(pizza)":"pizza","(cash)":"cash","(mo)":"cash","($)":"cash","(flex)":"muscle","(muscle)":"muscle","(^)":"cake","(cake)":"cake","(beer)":"beer","(bricklayers)":"beer","(B)":"beer","(b)":"beer","(d)":"drink","(D)":"drink","(drink)":"drink","\\o/":"dance","\\:D/":"dance","\\:d/":"dance","(dance)":"dance","(ninja)":"ninja","(J)":"ninja","(j)":"ninja","(*)":"star","(star)":"star","(headbang)":"headbang","(banghead)":"headbang","(swear)":"swear","(drunk)":"drunk","(finger)":"finger","(poolparty)":"poolparty","(hrv)":"poolparty","(rock)":"rock","(smoking)":"smoke","(smoke)":"smoke","(ci)":"smoke","(bug)":"bug","(toivo)":"toivo","(wfh)":"wfh","(@h)":"wfh","(@H)":"wfh","(hollest)":"hollest","(zilmer)":"priidu","(e)":"mail","(m)":"mail","(mail)":"mail","(E)":"mail","(o)":"time","(O)":"time","(time)":"time","(clock)":"time","(0)":"time","(~)":"movie","(film)":"movie","(movie)":"movie","(mp)":"phone","(ph)":"phone","(phone)":"phone","(talk)":"talk","(call)":"call","(T)":"call","(t)":"call","(punch)":"punch","*|":"punch","*-|":"punch","(skype)":"skype","(ss)":"skype","(u)":"brokenheart","(U)":"brokenheart","(brokenheart)":"brokenheart","(mooning)":"mooning","(oliver)":"oliver","(bartlett)":"bertlett","(football)":"bertlett","(soccer)":"bertlett","(so)":"bertlett","(talktothehand)":"talktothehand","(idea)":"idea",":i":"idea",":I":"idea","*-:)":"idea","(sheep)":"sheep","(bah)":"sheep","(cat)":"cat",":3":"cat","(@)":"cat","(meow)":"cat","(bike)":"bike","(bicycle)":"bike","(sander)":"bike","(dog)":"dog",":o3":"dog","(&)":"dog"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),r=n(34),o={small:"getSmall",large:"getLarge",extraLarge:"getExtraLarge",superLarge:"getSuperLarge"};t.buildEmoticonUrl=function(e,n,a,s){var c=e+"/"+n.id+"/views/";c=t.rewriteUrls(c,r.default.pesCDNAuthentication.rewriteRules);var l=o[a]+(s?"Animated":"");return i.default.setQueryParameters(c+r.default.profiles.emoticons[l](),{etag:n.etag})},t.rewriteUrls=function(e,t){if("string"!=typeof e)return e;var n,i=e;for(n in t)if(-1!==n.search(n.from)){i=i.replace(n.from,n.to);break}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(73),r=function(){function e(){}return e.getSentMessageType=function(t){switch(t){case i.MessageType.FILE:case i.MessageType.IMAGE:return e.File;case i.MessageType.SWIFT:return e.Card;default:return e.Text}},e.getReceivedMessageType=function(t){switch(t){case"":return e.File;case"":return e.Card;default:return e.Text}},e.Text="text",e.File="file",e.Card="card",e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(226);t.Duration=i.Duration;var r=n(227);t.getCallMessage=r.getCallMessage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Online="Online",e.Busy="Busy",e.Offline="Offline",e.Undefined="Undefined",e.OnThePhone="OnThePhone",e.Away="Away",e.Idle="Idle",e.OutToLunch="OutToLunch",e.BeRightBack="BeRightBack"}(t.PresenceStatus||(t.PresenceStatus={}))},function(e,t){if("function"!=typeof window.CustomEvent){var n=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};n.prototype=window.Event.prototype,window.CustomEvent=n}},function(e,t){var n,i,r,o,a;(n||(n={})).version="2.9.0",function(e){!function(e){e[e.BT_STOP=0]="BT_STOP",e[e.BT_STOP_BASE=1]="BT_STOP_BASE",e[e.BT_BOOL=2]="BT_BOOL",e[e.BT_UINT8=3]="BT_UINT8",e[e.BT_UINT16=4]="BT_UINT16",e[e.BT_UINT32=5]="BT_UINT32",e[e.BT_UINT64=6]="BT_UINT64",e[e.BT_FLOAT=7]="BT_FLOAT",e[e.BT_DOUBLE=8]="BT_DOUBLE",e[e.BT_STRING=9]="BT_STRING",e[e.BT_STRUCT=10]="BT_STRUCT",e[e.BT_LIST=11]="BT_LIST",e[e.BT_SET=12]="BT_SET",e[e.BT_MAP=13]="BT_MAP",e[e.BT_INT8=14]="BT_INT8",e[e.BT_INT16=15]="BT_INT16",e[e.BT_INT32=16]="BT_INT32",e[e.BT_INT64=17]="BT_INT64",e[e.BT_WSTRING=18]="BT_WSTRING",e[e.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(e.BondDataType||(e.BondDataType={})),function(e){e[e.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",e[e.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",e[e.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",e[e.JSON_PROTOCOL=21322]="JSON_PROTOCOL",e[e.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",e[e.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"}(e.ProtocolType||(e.ProtocolType={}))}((i=r||(r={})).Bond||(i.Bond={})),function(e){!function(e){!function(e){var t=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e){for(var t=0;t<this._buffer.length&&this._buffer[t]!=e;++t);t==this._buffer.length&&this._buffer.push(e)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e}();e.Set=t;var n=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e,t){-1==this._getIndex(e)&&this._buffer.push({Key:e,Value:t})},e.prototype.AddOrReplace=function(e,t){var n=this._getIndex(e);n>=0?this._buffer[n]={Key:e,Value:t}:this._buffer.push({Key:e,Value:t})},e.prototype.Remove=function(e){var t=this._getIndex(e);t>=0&&this._buffer.splice(t,1)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e.prototype.ContainsKey=function(e){return this._getIndex(e)>=0},e.prototype.Get=function(e){var t=this._getIndex(e);return t>=0?this._buffer[t].Value:null},e.prototype._getIndex=function(e){for(var t=0,n=-1;t<this._buffer.length;++t)if(this._buffer[t].Key==e){n=t;break}return n},e}();e.Map=n}(e.Collections||(e.Collections={}))}(e.Bond||(e.Bond={}))}(r||(r={})),function(e){!function(t){!function(e){var i=function(){function e(){}return e.GetBytes=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?t.push(192|i>>6,128|63&i):i<55296||i>=57344?t.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++n)),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return t},e}();e.Utf8=i;var r=function(){function e(){}return e.GetString=function(e){var t,n,i,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],a=e.length%3,s=function(e){return[r.charAt(e>>18&63),r.charAt(e>>12&63),r.charAt(e>>6&63),r.charAt(63&e)].join("")};for(t=0,i=e.length-a;t<i;t+=3)n=(e[t]<<16)+(e[t+1]<<8)+e[t+2],o.push(s(n));switch(a){case 1:n=e[e.length-1],o.push(r.charAt(n>>2)),o.push(r.charAt(n<<4&63)),o.push("==");break;case 2:n=(e[e.length-2]<<8)+e[e.length-1],o.push(r.charAt(n>>10)),o.push(r.charAt(n>>4&63)),o.push(r.charAt(n<<2&63)),o.push("=")}return o.join("")},e}();e.Base64=r;var o=function(){function e(){}return e.GetBytes=function(e){for(var t=[];4294967168&e;)t.push(127&e|128),e>>>=7;return t.push(127&e),t},e}();e.Varint=o;var a=function(){function e(){}return e.GetBytes=function(e){for(var t=e.low,n=e.high,i=[];n||4294967168&t;)i.push(127&t|128),t=(127&n)<<25|t>>>7,n>>>=7;return i.push(127&t),i},e}();e.Varint64=a;var s=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var i=new DataView(new ArrayBuffer(4));i.setFloat32(0,e,!0);for(var r=[],o=0;o<4;++o)r.push(i.getUint8(o));return r}return n.ConvertNumberToArray(e,!1)},e}();e.Float=s;var c=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var i=new DataView(new ArrayBuffer(8));i.setFloat64(0,e,!0);for(var r=[],o=0;o<8;++o)r.push(i.getUint8(o));return r}return n.ConvertNumberToArray(e,!0)},e}();e.Double=c;var l=function(){function e(){}return e.EncodeZigzag16=function(e){return(e=t.Number.ToInt16(e))<<1^e>>15},e.EncodeZigzag32=function(e){return(e=t.Number.ToInt32(e))<<1^e>>31},e.EncodeZigzag64=function(e){var n=e.low,i=e.high,r=i<<1|n>>>31,o=n<<1;2147483648&i&&(r=~r,o=~o);var a=new t.UInt64("0");return a.low=o,a.high=r,a},e}();e.Zigzag=l}(t.Encoding||(t.Encoding={})),function(i){var r=function(){function e(){}return e.GetString=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];if(i<=191)t.push(String.fromCharCode(i));else if(i<=223){var r=e[++n];t.push(String.fromCharCode((31&i)<<6|63&r))}else if(i<=239){r=e[++n];var o=e[++n];t.push(String.fromCharCode((15&i)<<12|(63&r)<<6|63&o))}else{i=(7&i)<<18|(63&(r=e[++n]))<<12|(63&(o=e[++n]))<<6|63&e[++n],i-=65536,t.push(String.fromCharCode(55296|i>>10&1023)),t.push(String.fromCharCode(56320|1023&i))}}return t.join("")},e}();i.Utf8=r;var o=function(){function e(){}return e.GetBytes=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],i=0;i<e.length;++i){var r=t.indexOf(e.charAt(i++)),o=t.indexOf(e.charAt(i++)),a=t.indexOf(e.charAt(i++)),s=t.indexOf(e.charAt(i));n.push(r<<2|o>>4),a>=0&&(n.push(o<<4&240|a>>2),s>=0&&n.push(a<<6&192|s))}return n},e}();i.Base64=o;var a=function(){function t(){}return t.GetInt64=function(t){var n=new e.Bond.Int64("0"),i=this._Read(t);return n.low=i[0],i.length>1&&(n.high=i[1]),n},t.GetNumber=function(e){return this._Read(e)[0]},t._Read=function(e){for(var t=[],n=0,i=!0,r=0;i;){if(i=0!=(128&(o=e.shift())),o&=127,!(r<28)){n|=o<<r,t.push(n),n=o>>4,r=3;break}n|=o<<r,r+=7}for(;i;){var o;if(i=0!=(128&(o=e.shift())),n|=(o&=127)<<r,(r+=7)>=32)break}return t.push(n),t},t}();i.Varint=a;var s=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){for(var i=new DataView(new ArrayBuffer(4)),r=0;r<4;++r)i.setUint8(r,e[r]);return i.getFloat32(0,!0)}return n.ConvertArrayToNumber(e,!1)},e}();i.Float=s;var c=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){for(var i=new DataView(new ArrayBuffer(8)),r=0;r<8;++r)i.setUint8(r,e[r]);return i.getFloat64(0,!0)}return n.ConvertArrayToNumber(e,!0)},e}();i.Double=c;var l=function(){function t(){}return t.DecodeZigzag16=function(e){return((65535&e)>>>1^-(1&e))<<16>>16},t.DecodeZigzag32=function(e){return e>>>1^-(1&e)},t.DecodeZigzag64=function(t){var n=1&t.high,i=t.high>>>1,r=1&t.low,o=t.low>>>1;o|=n<<31,r&&(o^=4294967295,i^=4294967295);var a=new e.Bond.UInt64("0");return a.low=o,a.high=i,a},t}();i.Zigzag=l}(t.Decoding||(t.Decoding={}));var n=function(){function e(){}return e.ConvertNumberToArray=function(e,t){if(!e)return t?this._doubleZero:this._floatZero;var n=t?52:23,i=(1<<(t?11:8)-1)-1,r=1-i,o=i,a=e<0?1:0;e=Math.abs(e);for(var s=Math.floor(e),c=e-s,l=2*(i+2)+n,u=new Array(l),d=0;d<l;)u[d++]=0;for(d=i+2;d&&s;)u[--d]=s%2,s=Math.floor(s/2);for(d=i+1;d<l-1&&c>0;)(c*=2)>=1?(u[++d]=1,--c):u[++d]=0;for(var p=0;p<l&&!u[p];++p);var h=i+1-p,f=p+n;if(u[f+1]){for(d=f;d>p&&!(u[d]=1-u[d]);--d);d==p&&++h}if(h>o||s)return a?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(h<r)return t?this._doubleZero:this._floatZero;if(t){var g=0;for(d=0;d<20;++d)g=g<<1|u[++p];for(var m=0;d<52;++d)m=m<<1|u[++p];return[255&m,m>>8&255,m>>16&255,m>>>24,255&(g=a<<31|2147483647&(g|=h+i<<20)),g>>8&255,g>>16&255,g>>>24]}var _=0;for(d=0;d<23;++d)_=_<<1|u[++p];return[255&(_=a<<31|2147483647&(_|=h+i<<23)),_>>8&255,_>>16&255,_>>>24]},e.ConvertArrayToNumber=function(e,n){var i=(1<<(n?11:8)-1)-1,r=0!=(128&e[n?7:3]),o=n?(127&e[7])<<4|(240&e[6])>>4:(127&e[3])<<1|(128&e[2])>>7;if(255==o)throw new t.Exception("Not a valid float/double buffer.");var a=1,s=1;if(n){var c=(15&e[6])<<28|(255&e[5])<<20|(255&e[4])<<12,l=e[3]<<24|(255&e[2])<<16|(255&e[1])<<8|255&e[0];if(!o&&!c&&!l)return 0;for(var u=0;u<20;++u)s/=2,c<0&&(a+=s),c<<=1;for(u=0;u<32;++u)s/=2,l<0&&(a+=s),l<<=1}else{var d=(127&e[2])<<25|(255&e[1])<<17|(255&e[0])<<9;if(!o&&!d)return 0;for(u=0;u<23;++u)s/=2,d<0&&(a+=s),d<<=1}return a*=Math.pow(2,o-i),r?0-a:a},e}();n._floatZero=[0,0,0,0],n._doubleZero=[0,0,0,0,0,0,0,0],n._floatInifinity=[0,0,128,127],n._floatNegInifinity=[0,0,128,255],n._doubleInifinity=[0,0,0,0,0,0,240,127],n._doubleNegInifinity=[0,0,0,0,0,0,240,255]}(e.Bond||(e.Bond={}))}(r||(r={})),function(e){!function(e){!function(t){var n=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(e.Number.ToByte(t))},t.prototype.Write=function(e,t,n){for(;n--;)this.WriteByte(e[t++])},t.prototype.GetBuffer=function(){return this._buffer},t}();t.MemoryStream=n}(e.IO||(e.IO={}))}(e.Bond||(e.Bond={}))}(r||(r={})),function(e){!function(e){var t=function(){return function(e,t){this.Type=e,this.Id=t}}();e.FieldTag=t;var n=function(){return function(e,t){this.ElementType=e,this.Size=t}}();e.ContainerTag=n;var i=function(){return function(e,t,n){this.KeyType=e,this.ValueType=t,this.Size=n}}();e.KeyValueContainerTag=i;var r=function(){return function(){}}();e.Bonded=r;var o=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e),this.low<0&&(this.high=-1)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.Int64=o;var a=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.UInt64=a;var s=function(){function e(){}return e.ToByte=function(e){return this.ToUInt8(e)},e.ToInt8=function(e){return 127&e|(128&e)<<24>>24},e.ToInt16=function(e){return 32767&e|(32768&e)<<16>>16},e.ToInt32=function(e){return 2147483647&e|2147483648&e},e.ToUInt8=function(e){return 255&e},e.ToUInt16=function(e){return 65535&e},e.ToUInt32=function(e){return 4294967295&e},e}();e.Number=s;var c=function(){return function(e){this.Message=e}}();e.Exception=c;var l=function(){return function(){}}();e.KeyValuePair=l;var u=function(){function e(){}return e.IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},e}();e.BrowserChecker=u}(e.Bond||(e.Bond={}))}(r||(r={})),function(e){!function(e){var t=function(){function t(e){this._stream=e}return t.prototype.WriteBlob=function(e){this._stream.Write(e,0,e.length)},t.prototype.WriteBool=function(e){this._stream.WriteByte(e?1:0)},t.prototype.WriteContainerBegin=function(e,t){this.WriteUInt8(t),this.WriteUInt32(e)},t.prototype.WriteMapContainerBegin=function(e,t,n){this.WriteUInt8(t),this.WriteUInt8(n),this.WriteUInt32(e)},t.prototype.WriteContainerEnd=function(){},t.prototype.WriteDouble=function(t){var n=e.Encoding.Double.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFloat=function(t){var n=e.Encoding.Float.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFieldBegin=function(e,t,n){t<=5?this._stream.WriteByte(e|t<<5):t<=255?(this._stream.WriteByte(192|e),this._stream.WriteByte(t)):(this._stream.WriteByte(224|e),this._stream.WriteByte(t),this._stream.WriteByte(t>>8))},t.prototype.WriteFieldEnd=function(){},t.prototype.WriteFieldOmitted=function(e,t,n){},t.prototype.WriteInt16=function(t){t=e.Encoding.Zigzag.EncodeZigzag16(t),this.WriteUInt16(t)},t.prototype.WriteInt32=function(t){t=e.Encoding.Zigzag.EncodeZigzag32(t),this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(e.Encoding.Zigzag.EncodeZigzag64(t))},t.prototype.WriteInt8=function(t){this._stream.WriteByte(e.Number.ToInt8(t))},t.prototype.WriteString=function(t){if(""==t)this.WriteUInt32(0);else{var n=e.Encoding.Utf8.GetBytes(t);this.WriteUInt32(n.length),this._stream.Write(n,0,n.length)}},t.prototype.WriteStructBegin=function(e,t){},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?e.BondDataType.BT_STOP_BASE:e.BondDataType.BT_STOP)},t.prototype.WriteUInt16=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt16(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt32=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt32(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt64=function(t){var n=e.Encoding.Varint64.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(e.Number.ToUInt8(t))},t.prototype.WriteWString=function(e){this.WriteUInt32(e.length);for(var t=0;t<e.length;++t){var n=e.charCodeAt(t);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8)}},t}();e.CompactBinaryProtocolWriter=t;var n=function(){return function(){}}();e.CompactBinaryProtocolReader=n}(e.Bond||(e.Bond={}))}(r||(r={})),function(e){var t=function(){function t(){}return t.IsSafari=function(){if(null===t._isSafari)if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.toLowerCase();e.indexOf("safari")>=0&&e.indexOf("chrome")<0?t._isSafari=!0:t._isSafari=!1}else t._isSafari=!1;return t._isSafari},t.IsReactNative=function(){return null===t._isReactNative&&("undefined"!=typeof navigator&&navigator.product?t._isReactNative="ReactNative"===navigator.product:t._isReactNative=!1),t._isReactNative},t.IsUint8ArrSupported=function(){return!e.Utils.IsSafari()&&"undefined"!=typeof Uint8Array&&!e.Utils.IsReactNative()},t.ajax=function(e,n){var i=t._createConnection();if(e.headers){var r="qsp=true";for(var o in e.headers)r+="&",r+=encodeURIComponent(o),r+="=",r+=encodeURIComponent(e.headers[o]);e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=r}i.open(e.type,e.url,!n),e.complete&&(i.onload=function(){e.complete(i)},i.ontimeout=function(){e.complete(i)},i.onerror=function(){e.complete(i)},i.onabort=function(){e.complete(i)}),i.send(e.data)},t.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},t.IsUsingXDomainRequest=function(){null==t._usingXDomainRequest&&(void 0===(new XMLHttpRequest).withCredentials&&"undefined"!=typeof XDomainRequest?t._usingXDomainRequest=!0:t._usingXDomainRequest=!1);return t._usingXDomainRequest},t._createConnection=function(){var e=new XMLHttpRequest;return t.IsUsingXDomainRequest()?new XDomainRequest:e},t}();t._isSafari=null,t._isReactNative=null,t._usingXDomainRequest=null,e.Utils=t}(o||(o={})),function(e){!function(e){!function(e){!function(t){var n=function(){function e(){}return e.GetGuid=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1,5)};return[e(),e(),"-",e(),"-",e(),"-",e(),"-",e(),e(),e()].join("")},e.GetTimeStamp=function(){var e=(new Date).getTime(),t=new r.Bond.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},e.GetTimeStampWithValue=function(e){var t=new r.Bond.Int64("0");return t.low=4294967295&e,t.high=Math.floor(e/4294967296),t},e}();t.utils=n,function(e){e[e.NotSet=0]="NotSet",e[e.Event=1]="Event",e[e.PerformanceCounter=2]="PerformanceCounter",e[e.Anomaly=3]="Anomaly",e[e.Prediction=4]="Prediction",e[e.TraceLog=5]="TraceLog",e[e.EventSourceLog=6]="EventSourceLog",e[e.HttpLog=7]="HttpLog",e[e.PerformanceCounterAzure=8]="PerformanceCounterAzure",e[e.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(t.RecordType||(t.RecordType={})),function(e){e[e.NotSet=0]="NotSet",e[e.O365=1]="O365",e[e.SkypeBI=2]="SkypeBI",e[e.SkypeData=3]="SkypeData"}(t.PIIScrubber||(t.PIIScrubber={})),function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(t.PIIKind||(t.PIIKind={})),function(e){e[e.Unknown=0]="Unknown",e[e.MSACID=1]="MSACID",e[e.MSAPUID=2]="MSAPUID",e[e.ANID=3]="ANID",e[e.OrgIdCID=4]="OrgIdCID",e[e.OrgIdPUID=5]="OrgIdPUID",e[e.UserObjectId=6]="UserObjectId",e[e.Skype=7]="Skype",e[e.Yammer=8]="Yammer",e[e.EmailAddress=9]="EmailAddress",e[e.PhoneNumber=10]="PhoneNumber",e[e.SipAddress=11]="SipAddress",e[e.MUID=12]="MUID"}(t.UserIdType||(t.UserIdType={}));var i=function(){function t(){this.ScrubType=e.datamodels.PIIScrubber.NotSet,this.Kind=e.datamodels.PIIKind.NotSet,this.RawContent=""}return t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(t,n){t.WriteStructBegin(null,n),this.ScrubType!=e.datamodels.PIIScrubber.NotSet?(t.WriteFieldBegin(r.Bond.BondDataType.BT_INT32,1,null),t.WriteInt32(this.ScrubType),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_INT32,1,null),this.Kind!=e.datamodels.PIIKind.NotSet?(t.WriteFieldBegin(r.Bond.BondDataType.BT_INT32,2,null),t.WriteInt32(this.Kind),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_INT32,2,null),""!=this.RawContent?(t.WriteFieldBegin(r.Bond.BondDataType.BT_STRING,3,null),t.WriteString(this.RawContent),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_STRING,3,null),t.WriteStructEnd(n)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}();t.PII=i;var o=function(){function t(){this.Id=n.GetGuid(),this.Timestamp=n.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new r.Bond.Collections.Map,this.RecordType=e.datamodels.RecordType.NotSet,this.PIIExtensions=new r.Bond.Collections.Map}return t.prototype.AddOrReplacePII=function(t,n,i){var r=new e.datamodels.PII;r.RawContent=n,r.Kind=i,r.ScrubType=e.datamodels.PIIScrubber.O365,this.PIIExtensions.AddOrReplace(t,r)},t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(t,n){if(t.WriteStructBegin(null,n),""!=this.Id?(t.WriteFieldBegin(r.Bond.BondDataType.BT_STRING,1,null),t.WriteString(this.Id),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_STRING,1,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(r.Bond.BondDataType.BT_INT64,3,null):(t.WriteFieldBegin(r.Bond.BondDataType.BT_INT64,3,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),""!=this.Type?(t.WriteFieldBegin(r.Bond.BondDataType.BT_STRING,5,null),t.WriteString(this.Type),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_STRING,5,null),""!=this.EventType?(t.WriteFieldBegin(r.Bond.BondDataType.BT_STRING,6,null),t.WriteString(this.EventType),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_STRING,6,null),this.Extension.Count()){t.WriteFieldBegin(r.Bond.BondDataType.BT_MAP,13,null),t.WriteMapContainerBegin(this.Extension.Count(),r.Bond.BondDataType.BT_STRING,r.Bond.BondDataType.BT_STRING);for(var i=0;i<this.Extension.GetBuffer().length;++i)t.WriteString(this.Extension.GetBuffer()[i].Key),t.WriteString(this.Extension.GetBuffer()[i].Value);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(r.Bond.BondDataType.BT_MAP,13,null);if(this.RecordType!=e.datamodels.RecordType.NotSet?(t.WriteFieldBegin(r.Bond.BondDataType.BT_INT32,24,null),t.WriteInt32(this.RecordType),t.WriteFieldEnd()):t.WriteFieldOmitted(r.Bond.BondDataType.BT_INT32,24,null),this.PIIExtensions.Count()){t.WriteFieldBegin(r.Bond.BondDataType.BT_MAP,30,null),t.WriteMapContainerBegin(this.PIIExtensions.Count(),r.Bond.BondDataType.BT_STRING,r.Bond.BondDataType.BT_STRUCT);for(var o=0;o<this.PIIExtensions.GetBuffer().length;++o)t.WriteString(this.PIIExtensions.GetBuffer()[o].Key),this.PIIExtensions.GetBuffer()[o].Value.WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(r.Bond.BondDataType.BT_MAP,30,null);t.WriteStructEnd(n)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}();t.Record=o;var a=function(){function e(){this.Source="",this.DataPackageId="",this.Timestamp=new r.Bond.Int64("0"),this.Records=[]}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){if(e.WriteStructBegin(null,t),""!=this.Source?(e.WriteFieldBegin(r.Bond.BondDataType.BT_STRING,2,null),e.WriteString(this.Source),e.WriteFieldEnd()):e.WriteFieldOmitted(r.Bond.BondDataType.BT_STRING,2,null),""!=this.DataPackageId?(e.WriteFieldBegin(r.Bond.BondDataType.BT_STRING,5,null),e.WriteString(this.DataPackageId),e.WriteFieldEnd()):e.WriteFieldOmitted(r.Bond.BondDataType.BT_STRING,5,null),this.Timestamp.Equals("0")?e.WriteFieldOmitted(r.Bond.BondDataType.BT_INT64,6,null):(e.WriteFieldBegin(r.Bond.BondDataType.BT_INT64,6,null),e.WriteInt64(this.Timestamp),e.WriteFieldEnd()),this.Records.length){e.WriteFieldBegin(r.Bond.BondDataType.BT_LIST,8,null),e.WriteContainerBegin(this.Records.length,r.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.Records.length;++n)this.Records[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(r.Bond.BondDataType.BT_LIST,8,null);e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.DataPackage=a;var s=function(){function e(){this.DataPackages=[],this.RequestRetryCount=0}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){if(e.WriteStructBegin(null,t),this.DataPackages.length){e.WriteFieldBegin(r.Bond.BondDataType.BT_LIST,1,null),e.WriteContainerBegin(this.DataPackages.length,r.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.DataPackages.length;++n)this.DataPackages[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(r.Bond.BondDataType.BT_LIST,1,null);0!=this.RequestRetryCount?(e.WriteFieldBegin(r.Bond.BondDataType.BT_INT32,2,null),e.WriteInt32(this.RequestRetryCount),e.WriteFieldEnd()):e.WriteFieldOmitted(r.Bond.BondDataType.BT_INT32,2,null),e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.ClientToCollectorRequest=s}(e.datamodels||(e.datamodels={}))}(e.telemetry||(e.telemetry={}))}(e.applications||(e.applications={}))}(a||(a={})),function(e){!function(e){!function(e){!function(t){var i,a;!function(e){e[e.SENT=0]="SENT",e[e.SEND_FAILED=1]="SEND_FAILED"}(i=t.CallbackEventType||(t.CallbackEventType={})),function(e){e[e.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",e[e.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",e[e.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",e[e.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",e[e.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",e[e.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(a=t.DATARV_ERROR||(t.DATARV_ERROR={}));var s=function(){function e(e){this._errorCode=a.DATARV_ERROR_OK,this._errorCode=e}return e.prototype.ErrorCode=function(){return this._errorCode},e.prototype.toString=function(){switch(this._errorCode){case a.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case a.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case a.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case a.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case a.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case a.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},e}();t.Exception=s;var c=function(){return function(){}}();t.TelemetryConfig=c;var l=function(){function e(){}return e.CreateTelemetryManager=function(){return new p},e}();t.TelemetryManagerFactory=l;var u,d=function(){function e(){}return e.MaxPackageSizeInBytes=function(){return 3e6},e.TimeIntervalForNextSendInMS=function(){return 1e3},e}();!function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started"}(u||(u={}));var p=function(){function t(){this._MaxPackageSizeInBytes=d.MaxPackageSizeInBytes(),this._listeners=[],this._status=u.Created,this._etag=null,this._testServerResponseHook=null,this._isPaused=!1}return t.prototype.Initialize=function(e){if(this._status!=u.Created)throw new s(a.DATARV_ERROR_INVALID_STATUS);if(!e||!e.collectorUrl)throw new s(a.DATARV_ERROR_INVALID_CONFIG);this._config=e,this._Reset(),this._status=u.Initialized,this._Verbose("Initialize() done")},t.prototype.AddListener=function(e){if(this._status<u.Initialized)throw new s(a.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return void this._Verbose("the listener has been added already, index: "+t);this._listeners.push(e),this._Verbose("AddListener() done, the new length: "+this._listeners.length)},t.prototype.RemoveListener=function(e){if(this._status<u.Initialized)throw new s(a.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return 1==this._listeners.length?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)},t.prototype.Start=function(){if(this._status<u.Initialized)throw new s(a.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",t._tag].join(" ")),this._status>=u.Started&&this._Verbose("Start() already, ignore"),++t._tag,this._status=u.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",t._tag].join(""))},t.prototype.Stop=function(){if(this._status<u.Initialized)throw new s(a.DATARV_ERROR_INVALID_STATUS);return this._Verbose("Stop(), status: "+this._status),this._status==u.Initialized?void this._Verbose("Stop() already, ignore"):(this._Reset(),this._status=u.Initialized,void this._Verbose("Stop() done, status: "+this._status))},t.prototype.Pause=function(){this._isPaused=!0,this._CleanTimer()},t.prototype.Resume=function(){this._isPaused=!1,this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1)},t.prototype.Flush=function(e){this._eventsCache.IsEmpty()||this._WorkThread(e,!0)},t.prototype.SendAsync=function(e,n){if(this._status<u.Initialized)throw new s(a.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",n.length].join(" ")),this._status<u.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!n)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new s(a.DATARV_ERROR_INVALID_ARG);for(var i=0;i<n.length;++i)if(!n[i].Id||!t._eventTypeRegex.test(n[i].EventType)||n[i].Timestamp.Equals("0"))throw this._Error(["eventId:",n[i].Id,"eventType:",n[i].EventType,"timestamp high:",n[i].Timestamp.high,"timestamp low:",n[i].Timestamp.low].join("")),new s(a.DATARV_ERROR_INVALID_EVENT);return this._eventsCache.AddEvents(e,n),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},t.prototype._WorkThread=function(e,i){var a=this;try{if(this._Verbose("_WorkThread, status: "+this._status),this._status<u.Started)return void this._Verbose("_WorkThread, status is not started, return");var s=this._eventsCache.DequeuEvents();if(null==s)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var c=this._PackEvents(s.tenantToken,s.events);if(this._eventsCache.AddEvents(s.tenantToken,c.remainedEvents),null==c.buffer||0==c.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testServerResponseHook){var l=this._testServerResponseHook();return void setTimeout(this._SendCallback(p,s.tenantToken,c.sendEvents,l,!1,null),100)}var d={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+n.version},complete:function(t){return a._SendCallback(p,s.tenantToken,c.sendEvents,t,i,e)}};o.Utils.IsUint8ArrSupported()?(this._Verbose("Uint8Array is defined, send with binary format directly."),d.data=new Uint8Array(c.buffer)):(this._Verbose("Uint8Array is undefined, send with base64 encode."),d.data=r.Bond.Encoding.Base64.GetString(c.buffer),d.headers["content-encoding"]="base64"),s.tenantToken&&(d.headers["x-apikey"]=s.tenantToken);var p=t._tag;this._lastActiveTime=(new Date).getTime(),o.Utils.ajax(d,i),this._Verbose("_Workthread, send via jquery, tag: "+p)}catch(e){this._Error("_WorkThread, exception: "+e)}},t.prototype._PackEvents=function(t,n){this._Verbose("_PackageEvents, total Count: "+n.length);var i=new e.datamodels.ClientToCollectorRequest,r=new e.datamodels.DataPackage;r.Source="JS_default_source",r.DataPackageId=e.datamodels.utils.GetGuid(),r.Timestamp=e.datamodels.utils.GetTimeStamp();var o,a=n;for(n=[];r.Records=[],r.Records.push.apply(r.Records,a),i.DataPackages=[],i.DataPackages.push(r),o=this._Serialize(i),this._Verbose(["_PackageEvents, sendEvents.length:",a.length,"buffer.length:",o.length,"MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(o.length<this._MaxPackageSizeInBytes);){if(1==a.length){a=[],o=null;break}var s=a.splice(0,Math.floor(a.length/2));this._Verbose("_PackageEvents, too large, package again"),n.push.apply(n,a),a=s}return this._Verbose(["_PakcageEvents done, sendEventsCount:",a.length,"buffer.length:",null==o?0:o.length,"remained events:",n.length].join("")),{buffer:o,sendEvents:a,remainedEvents:n}},t.prototype._Serialize=function(e){var t=new r.Bond.IO.MemoryStream,n=new r.Bond.CompactBinaryProtocolWriter(t);return e.Write(n),t.GetBuffer()},t.prototype._SendCallback=function(e,n,r,o,a,s){if(this._Verbose(["_SendCallback","tag:",e,"current tag:",t._tag,"tenantToken:",n,"events count:",r.length,"jqXHR:",o].join("")),s&&s(o?o.status:0,n,r),!a){var c=o&&void 0!==o.status&&200===o.status;if(this._status<u.Started||e<t._tag)return void this._Verbose("_SendCallback, is not started, or tag is not the same, return");if(!c)if(o&&void 0!==o.status&&501!==o.status&&505!==o.status&&(o.status<300||o.status>=500||408===o.status)||!o||void 0===o.status)return this._Verbose("retry statusCode: "+(o?o.status:0)),this._eventsCache.AddEvents(n,r),void this._ScheduleTimer(!0);for(var l=0;l<this._listeners.length;++l)this._listeners[l](c?i.SENT:i.SEND_FAILED,o?o.status:0,n,r);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}},t.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._ScheduleTimer=function(e){var t=this;if(!this._isPaused)if(this._Verbose("_ScheduleTimer: isRetry: "+e),this._CleanTimer(),e){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);var n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return t._WorkThread(null,!1)},1e3*n),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{n=0;var i=(new Date).getTime()-this._lastActiveTime;n=i>d.TimeIntervalForNextSendInMS()?0:d.TimeIntervalForNextSendInMS()-i,this._timer=setTimeout(function(){return t._WorkThread(null,!1)},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1}},t.prototype._Verbose=function(e){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+e)},t.prototype._Info=function(e){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+e)},t.prototype._Error=function(e){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+e)},t.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new h},t.prototype.__GetListenerArray=function(){return this._listeners},t.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},t.prototype.__IsScheduled=function(){return null!=this._timer},t.prototype.__ChageMaxPackageSizeInKB=function(e){this._MaxPackageSizeInBytes=1024*e},t.prototype.__SetTestServerResponseHook=function(e){this._testServerResponseHook=e},t}();p._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,p._tag=0;var h=function(){function e(){this._events={},this._tokens=[]}return e.prototype.AddEvents=function(e,t){t.length&&(this._events[e]||(this._events[e]=[],this._tokens.push(e)),this._events[e].push.apply(this._events[e],t))},e.prototype.IsEmpty=function(){return 0==this._tokens.length},e.prototype.DequeuEvents=function(){if(0==this._tokens.length)return null;var e=this._tokens.shift(),t=this._events[e];return delete this._events[e],{tenantToken:e,events:t}},e.prototype.GetTotalEventsCount=function(){var e=0;for(var t in this._events)e+=this._events[t].length;return e},e}()}(e._sender||(e._sender={}))}(e.telemetry||(e.telemetry={}))}(e.applications||(e.applications={}))}(a||(a={})),function(e){!function(t){!function(t){var i=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),r=function(){return function(){this.collectorUrl=null,this.enableAutoUserSession=!1,this.browserOverrides=null,this.disableCookies=!1}}();r.COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/",r.COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/",r.COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/",r.COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/",r.COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/",t.LogConfiguration=r;var o=function(){return function(){this.onSaveData=null,this.onGetData=null}}();t.LogConfigurationBrowserOverrides=o;var a,s=function(){function e(){this.value=null,this.pii=null}return e._isPii=function(e){return null!==e&&void 0!==e&&e!==t.datamodels.PIIKind.NotSet&&!isNaN(e)&&void 0!==t.datamodels.PIIKind[e]},e}(),c=function(){function e(){this.name=null,this.timestamp=null,this.properties={},this.eventType=null}return e.prototype.setProperty=function(n,i,r){if(!n||!e._propertyNameRegex.test(n))throw new l(a.INVALID_PROPERTY_NAME);this.properties[n]=r?{value:i,pii:r!=t.datamodels.PIIKind.NotSet?r:null}:{value:i,pii:null}},e}();c._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,t.EventProperties=c,function(e){e[e.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",e[e.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",e[e.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",e[e.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",e[e.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",e[e.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",e[e.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",e[e.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE",e[e.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET=10]="INVALID_CONFIGURATION_USE_CUSTOM_GET_SET"}(a=t.TelemetryError||(t.TelemetryError={}));var l=function(){function e(e){this.errorCode=null,this.errorCode=e}return e.prototype.ErrorCode=function(){return this.errorCode},e.prototype.toString=function(){switch(this.errorCode){case a.INVALID_TENANT_TOKEN:return"Invalid tenant token";case a.MISSING_EVENT_PROPERTIES_NAME:return"Eventproperties.name can not be null or empty";case a.INVALID_PROPERTY_NAME:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$";case a.MISSING_FAILURE_SIGNATURE:return"Failure signature can't be null or empty.";case a.MISSING_FAILURE_DETAIL:return"Failure detail can't be null or empty.";case a.MISSING_PAGEVIEW_ID:return"Pageview id can't be null or empty.";case a.MISSING_PAGEVIEW_NAME:return"Pageview name can't be null or empty.";case a.INVALID_SESSION_STATE:return"Session state has to be a value from the SessionState enum.";case a.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET:return"Invalid configuration provided during initialization. Both onGetConfigData and onSaveConfigData must be provided together.  These are manditory when running in a non-brower enviornment";default:return"Unknown error"}},e}();t.Exception=l;var u=function(){function n(e){this.contextMap={},this.piiKind=t.datamodels.PIIKind.NotSet,this._allowDeviceInfoFields=!1,this._allowDeviceInfoFields=e}return n.prototype.setAppId=function(e){e&&(this.contextMap["AppInfo.Id"]=e)},n.prototype.setAppVersion=function(e){e&&(this.contextMap["AppInfo.Version"]=e)},n.prototype.setAppLanguage=function(e){e&&(this.contextMap["AppInfo.Language"]=e)},n.prototype.setDeviceId=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.Id"]=e,p.checkAndUpdateDeviceId(e))},n.prototype.setDeviceOsName=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsName"]=e)},n.prototype.setDeviceOsVersion=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsVersion"]=e)},n.prototype.setDeviceBrowserName=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserName"]=e)},n.prototype.setDeviceBrowserVersion=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserVersion"]=e)},n.prototype.setUserId=function(t,n,i){if(t&&(this.contextMap["UserInfo.Id"]=t),i)this.contextMap["UserInfo.IdType"]=i;else{var r;switch(n){case e.applications.telemetry.datamodels.PIIKind.SipAddress:r=e.applications.telemetry.datamodels.UserIdType.SipAddress;break;case e.applications.telemetry.datamodels.PIIKind.PhoneNumber:r=e.applications.telemetry.datamodels.UserIdType.PhoneNumber;break;case e.applications.telemetry.datamodels.PIIKind.SmtpAddress:r=e.applications.telemetry.datamodels.UserIdType.EmailAddress;break;default:r=e.applications.telemetry.datamodels.UserIdType.Unknown}this.contextMap["UserInfo.IdType"]=r}if(n)s._isPii(n)&&(this.piiKind=n);else{var o;switch(i){case e.applications.telemetry.datamodels.UserIdType.Skype:o=e.applications.telemetry.datamodels.PIIKind.Identity;break;case e.applications.telemetry.datamodels.UserIdType.EmailAddress:o=e.applications.telemetry.datamodels.PIIKind.SmtpAddress;break;case e.applications.telemetry.datamodels.UserIdType.PhoneNumber:o=e.applications.telemetry.datamodels.PIIKind.PhoneNumber;break;case e.applications.telemetry.datamodels.UserIdType.SipAddress:o=e.applications.telemetry.datamodels.PIIKind.SipAddress;break;default:o=e.applications.telemetry.datamodels.PIIKind.NotSet}s._isPii(o)&&(this.piiKind=o)}},n.prototype.setUserMsaId=function(e){e&&(this.contextMap["UserInfo.MsaId"]=e)},n.prototype.setUserANID=function(e){e&&(this.contextMap["UserInfo.ANID"]=e)},n.prototype.setUserAdvertisingId=function(e){e&&(this.contextMap["UserInfo.AdvertisingId"]=e)},n.prototype.setUserTimeZone=function(e){e&&(this.contextMap["UserInfo.TimeZone"]=e)},n.prototype.setUserLanguage=function(e){e&&(this.contextMap["UserInfo.Language"]=e)},n}();t.SemanticContext=u;var d,p=function(){function e(){}return e.initialize=function(n,i){this._overrides=n,this._disableCookies=i;var r=e._getAppLanguage();r&&e.semanticContext.setAppLanguage(r);var o=e._getUserLanguage();o&&e.semanticContext.setUserLanguage(o);var a=(new Date).getTimezoneOffset(),s=a%60,c=(a-s)/60,l="+";if(c>0&&(l="-"),e.semanticContext.setUserTimeZone(l+(c<10?"0"+c:c.toString())+":"+(s<10?"0"+s:s.toString())),e._getUserAgent()&&(e.semanticContext.setDeviceBrowserName(e._getBrowserName()),e.semanticContext.setDeviceBrowserVersion(e._getBrowserVersion()),e.semanticContext.setDeviceOsName(e._getOsName()),e.semanticContext.setDeviceOsVersion(e._getOsVersion())),this._disableCookies&&!this._overrides)return e._deleteCookie(e.DEVICE_ID_COOKIE),void e._deleteCookie(e.FIRST_LAUNCH_TIME_COOKIE);var u=e._getData(e.DEVICE_ID_COOKIE);u&&""!=u||(u=t.datamodels.utils.GetGuid()),e.semanticContext.setDeviceId(u)},e.checkAndUpdateDeviceId=function(t){var n=e._getData(e.DEVICE_ID_COOKIE),i=e._getData(e.FIRST_LAUNCH_TIME_COOKIE);n!==t&&(i=(new Date).getTime().toString()),e.firstLaunchTime=parseInt(i),e._saveData(e.DEVICE_ID_COOKIE,t),e._saveData(e.FIRST_LAUNCH_TIME_COOKIE,i)},e._saveData=function(t,n){if(this._overrides)this._overrides.onSaveData(t,n);else if("undefined"!=typeof document&&void 0!==document.cookie&&!e._disableCookies){var i=new Date;i.setTime(i.getTime()+31536e6);var r="expires="+i.toUTCString();document.cookie=t+"="+n+"; "+r}},e._getData=function(t){if(this._overrides)return this._overrides.onGetData(t)||"";if("undefined"!=typeof document&&void 0!==document.cookie&&!e._disableCookies)for(var n=t+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){for(var o=i[r],a=0;" "==o.charAt(a);)a++;if(0==(o=o.substring(a)).indexOf(n))return o.substring(n.length,o.length)}return""},e._getUserAgent=function(){return"undefined"!=typeof navigator&&navigator.userAgent||""},e._getAppLanguage=function(){return"undefined"!=typeof document&&document.documentElement?document.documentElement.lang:null},e._getUserLanguage=function(){return"undefined"!=typeof navigator?navigator.userLanguage||navigator.language:null},e._userAgentContainsString=function(t){return e._getUserAgent().indexOf(t)>-1},e._isIe=function(){return e._userAgentContainsString("Trident")},e._isEdge=function(){return e._userAgentContainsString(e.BROWSERS.EDGE)},e._isOpera=function(){return e._userAgentContainsString("OPR/")},e._getBrowserName=function(){return e._isOpera()?e.BROWSERS.UNKNOWN:e._userAgentContainsString(e.BROWSERS.PHANTOMJS)?e.BROWSERS.PHANTOMJS:e._isIe()?e.BROWSERS.MSIE:e._isEdge()?e.BROWSERS.EDGE:e._userAgentContainsString(e.BROWSERS.ELECTRON)?e.BROWSERS.ELECTRON:e._userAgentContainsString(e.BROWSERS.CHROME)?e.BROWSERS.CHROME:e._userAgentContainsString(e.BROWSERS.FIREFOX)?e.BROWSERS.FIREFOX:e._userAgentContainsString(e.BROWSERS.SAFARI)?e.BROWSERS.SAFARI:e._userAgentContainsString(e.BROWSERS.SKYPE_SHELL)?e.BROWSERS.SKYPE_SHELL:e.BROWSERS.UNKNOWN},e._getBrowserVersion=function(){return e._isIe()?function(){var t,n=e._getUserAgent(),i=n.match(new RegExp(e.BROWSERS.MSIE+" "+e.REGEX_VERSION));return i?i[1]:(t=n.match(new RegExp("rv:"+e.REGEX_VERSION)))?t[1]:void 0}():function(t){var n;return t===e.BROWSERS.SAFARI&&(t="Version"),(n=e._getUserAgent().match(new RegExp(t+"/"+e.REGEX_VERSION)))?n[1]:e.UNKNOWN_VERSION}(e._getBrowserName())},e._getOsName=function(){return e._getUserAgent().match(/windows\sphone\s\d+\.\d+/i)?e.OPERATING_SYSTEMS.WINDOWS_PHONE:e._getUserAgent().match(/ arm;/i)?e.OPERATING_SYSTEMS.WINDOWS_RT:e._getUserAgent().match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?e.OPERATING_SYSTEMS.IOS:e._getUserAgent().match(/android/i)?e.OPERATING_SYSTEMS.ANDROID:e._getUserAgent().match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i)?e.OPERATING_SYSTEMS.LINUX:e._getUserAgent().match(/(macintosh|mac os x)/i)?e.OPERATING_SYSTEMS.MACOSX:e._getUserAgent().match(/(windows|win32)/i)?e.OPERATING_SYSTEMS.WINDOWS:e.OPERATING_SYSTEMS.UNKNOWN},e._getOsVersion=function(){return e._getOsName()===e.OPERATING_SYSTEMS.WINDOWS?function(){var t=e._getUserAgent().match(new RegExp("Windows NT "+e.REGEX_VERSION));return t&&e.VERSION_MAPPINGS[t[1]]?e.VERSION_MAPPINGS[t[1]]:e.UNKNOWN_VERSION}():e._getOsName()===e.OPERATING_SYSTEMS.MACOSX?function(){var t=e._getUserAgent().match(new RegExp(e.OPERATING_SYSTEMS.MACOSX+" "+e.REGEX_VERSION_MAC));if(t){var n=t[1].replace(/_/g,".");if(n){var i=function(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}(n);return i?n.split(i)[0]:n}}return e.UNKNOWN_VERSION}():e.UNKNOWN_VERSION},e}();p.semanticContext=new u(!0),p.firstLaunchTime=-1,p.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},p.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},p.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},p.REGEX_VERSION="([\\d,.]+)",p.REGEX_VERSION_MAC="([\\d,_,.]+)",p.UNKNOWN_VERSION="Unknown",p.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",p.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",p._deleteCookie=function(e){"undefined"!=typeof document&&void 0!==document.cookie&&(document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},p._disableCookies=!1,function(e){e[e.STARTED=0]="STARTED",e[e.ENDED=1]="ENDED"}(d=t.SessionState||(t.SessionState={}));var h=function(){function e(){}return e.initialize=function(t,n){if(!e._initialized){if(!t)throw new l(a.INVALID_TENANT_TOKEN);if(e._defaultToken=t,e._tmConfig.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/",e._configuration=n,!("undefined"!=typeof window||n&&n.browserOverrides&&n.browserOverrides.onGetData))throw new l(a.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);var r=null;if(n)if(n.collectorUrl&&(e._tmConfig.collectorUrl=n.collectorUrl),n.browserOverrides){if(r=new o,n.browserOverrides.onGetData?!n.browserOverrides.onSaveData:n.browserOverrides.onSaveData)throw new l(a.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);r.onGetData=n.browserOverrides.onGetData,r.onSaveData=n.browserOverrides.onSaveData}else n.disableCookies&&(e._sessionEnabled=!1);i.Initialize(e._tmConfig),i.Start(),p.initialize(r,n.disableCookies),e._initialized=!0,"undefined"!=typeof window&&window.addEventListener&&(n&&n.enableAutoUserSession&&(e._logger=new f,e._logger.logSession(d.STARTED)),window.addEventListener("beforeunload",e._teardown))}},e.pauseTransmission=function(){i.Pause()},e.resumeTransmission=function(){i.Resume()},e.flush=function(e){i.Flush(e)},e.addCallbackListener=function(t){e._initialized&&i.AddListener(t)},e.setContext=function(t,n,i){e._contextProperties.setProperty(t,n,i)},e.isInitialized=function(){return e._initialized},e.getDefaultToken=function(){return e._defaultToken},e.getSemanticContext=function(){return e._semanticContext},e._getInitIdForToken=function(n){return e._initIdMap[n]||(e._initIdMap[n]=t.datamodels.utils.GetGuid()),e._initIdMap[n]},e._getSequenceForToken=function(t){return e._sequenceMap[t]||(e._sequenceMap[t]=0),e._sequenceMap[t]++,e._sequenceMap[t]},e._teardown=function(){e._logger&&e._logger.logSession(d.ENDED),e.flush()},e.__backToUninitialized=function(){e._tmConfig=new t._sender.TelemetryConfig,e._semanticContext=new u(!0),e._contextProperties=new c,e._configuration=null,i=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),e._initialized=!1,e._initIdMap={},e._sequenceMap={}},e}();h._initialized=!1,h._defaultToken=null,h._tmConfig=new t._sender.TelemetryConfig,h._logger=null,h._initIdMap={},h._sequenceMap={},h._configuration=null,h._contextProperties=new c,h._semanticContext=new u(!0),h._sessionEnabled=!0,t.LogManager=h;var f=function(){function e(e){this._initId=null,this._tenantToken=null,this._contextProperties=new c,this._semanticContext=new u(!1),this._sessionStartTime=0,this._sessionId=null,this._tenantToken=e||h.getDefaultToken(),this._initId=h._getInitIdForToken(this._tenantToken)}return e.prototype.logEvent=function(e){if(!e.name)throw new l(a.MISSING_EVENT_PROPERTIES_NAME);var t=this._createEventRecord(e.name,e.eventType);this._addPropertiesAndSendEvent(t,e)},e.prototype.logFailure=function(e,t,n,i,r){if(!e)throw new l(a.MISSING_FAILURE_SIGNATURE);if(!t)throw new l(a.MISSING_FAILURE_DETAIL);var o=this._createEventRecord("failure","failure");o.Extension.Add("Failure.Signature",e),o.Extension.Add("Failure.Detail",t),n&&o.Extension.Add("Failure.Category",n),i&&o.Extension.Add("Failure.Id",i),this._addPropertiesAndSendEvent(o,r)},e.prototype.logPageView=function(e,t,n,i,r,o){if(!e)throw new l(a.MISSING_PAGEVIEW_ID);if(!t)throw new l(a.MISSING_PAGEVIEW_NAME);var s=this._createEventRecord("pageview","pageview");s.Extension.Add("PageView.Id",e),s.Extension.Add("PageView.Name",t),n&&s.Extension.Add("PageView.Category",n),i&&s.Extension.Add("PageView.Uri",i),r&&s.Extension.Add("PageView.ReferrerUri",r),this._addPropertiesAndSendEvent(s,o)},e.prototype.logSession=function(e,n){if(h._sessionEnabled){if(e!==d.STARTED&&e!==d.ENDED)throw new l(a.INVALID_SESSION_STATE);var i=this._createEventRecord("session","session");if(e===d.STARTED){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=t.datamodels.utils.GetGuid(),i.Extension.Add("Session.Id",this._sessionId),i.Extension.Add("Session.State","Started")}else if(e===d.ENDED){if(0==this._sessionStartTime)return;var r=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);i.Extension.Add("Session.Duration",r.toString()),i.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(r)),i.Extension.Add("Session.Id",this._sessionId),i.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0}i.Extension.Add("Session.FirstLaunchTime",this._getISOString(new Date(p.firstLaunchTime))),this._addPropertiesAndSendEvent(i,n)}},e.prototype.getSessionId=function(){return this._sessionId},e.prototype.setContext=function(e,t,n){this._contextProperties.setProperty(e,t,n)},e.prototype.getSemanticContext=function(){return this._semanticContext},e.prototype._getSessionDurationFromTime=function(e){return e<0?"Undefined":e<=3?"UpTo3Sec":e<=10?"UpTo10Sec":e<=30?"UpTo30Sec":e<=60?"UpTo60Sec":e<=180?"UpTo3Min":e<=600?"UpTo10Min":e<=1800?"UpTo30Min":"Above30Min"},e.prototype._createEventRecord=function(e,i){var r=new t.datamodels.Record;i||(i="custom"),r.EventType=e.toLowerCase(),r.Type=i.toLowerCase(),r.Extension.Add("EventInfo.Source","JS_default_source"),r.Extension.Add("EventInfo.InitId",this._initId),r.Extension.Add("EventInfo.Sequence",h._getSequenceForToken(this._tenantToken).toString()),r.Extension.Add("EventInfo.Name",e.toLowerCase());var o=new Date;return r.Timestamp=t.datamodels.utils.GetTimeStampWithValue(o.getTime()),r.Extension.Add("EventInfo.Time",this._getISOString(o)),r.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+n.version),r},e.prototype._getISOString=function(e){function t(e){return e<10?"0"+e:e.toString()}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+function(e){return e<10?"00"+e:e<100?"0"+e:e.toString()}(e.getUTCMilliseconds())+"Z"},e.prototype._addCustomPropertiesToEvent=function(e,t){this._addSemanticContext(e,p.semanticContext),this._addSemanticContext(e,h._semanticContext),this._addSemanticContext(e,this._semanticContext),this._sessionId&&e.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(e,h._contextProperties),this._addEventPropertiesToEvent(e,this._contextProperties),this._addEventPropertiesToEvent(e,t)},e.prototype._addSemanticContext=function(e,n){if(n&&n.contextMap){var i=n.contextMap;for(var r in n.contextMap)"UserInfo.Id"==r&&n.piiKind!=t.datamodels.PIIKind.NotSet?e.AddOrReplacePII(r,i[r],n.piiKind):e.Extension.AddOrReplace(r,i[r])}},e.prototype._addEventPropertiesToEvent=function(e,n){if(n){n.timestamp&&n.timestamp>=new Date("1/1/2000").getTime()&&(e.Timestamp=t.datamodels.utils.GetTimeStampWithValue(n.timestamp),e.Extension.AddOrReplace("EventInfo.Time",this._getISOString(new Date(n.timestamp)))),n.name&&(e.EventType=n.name.toLowerCase(),e.Extension.AddOrReplace("EventInfo.Name",n.name.toLowerCase()));var i=n.properties;if(i)for(var r in i)r&&(i[r].value||!1===i[r].value||0==i[r].value||""==i[r].value)&&(s._isPii(i[r].pii)?(e.AddOrReplacePII(r,i[r].value.toString(),i[r].pii),e.Extension.Remove(r)):(e.Extension.AddOrReplace(r,i[r].value.toString()),e.PIIExtensions.Remove(r)))}},e.prototype._addPropertiesAndSendEvent=function(e,t){this._addCustomPropertiesToEvent(e,t),h.isInitialized()&&(this._sanitizeName(e),i.SendAsync(this._tenantToken,[e]))},e.prototype._sanitizeName=function(e){var t=e.EventType.replace(/\./g,"_");e.EventType=t,e.Extension.AddOrReplace("EventInfo.Name",t)},e}();t.Logger=f}(t.telemetry||(t.telemetry={}))}(e.applications||(e.applications={}))}(a||(a={})),void 0!==e&&(e.exports=a.applications.telemetry)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en-ca",defaultLocale:"en-gb"},{language:"en-au",defaultLocale:"en-gb"},{language:"en-in",defaultLocale:"en-gb"},{language:"en-hk",defaultLocale:"en-gb"},{language:"en-ie",defaultLocale:"en-gb"},{language:"en-pk",defaultLocale:"en-gb"},{language:"en-sg",defaultLocale:"en-gb"},{language:"en-gb",defaultLocale:"en-gb"},{language:"en",defaultLocale:"en-us"},{language:"es-ar",defaultLocale:"es-mx"},{language:"es-uy",defaultLocale:"es-mx"},{language:"es-py",defaultLocale:"es-mx"},{language:"es-co",defaultLocale:"es-mx"},{language:"es-cl",defaultLocale:"es-mx"},{language:"es-pe",defaultLocale:"es-mx"},{language:"es-ec",defaultLocale:"es-mx"},{language:"es-ve",defaultLocale:"es-mx"},{language:"es-cr",defaultLocale:"es-mx"},{language:"es-do",defaultLocale:"es-mx"},{language:"es-pa",defaultLocale:"es-mx"},{language:"es-gt",defaultLocale:"es-mx"},{language:"es-bo",defaultLocale:"es-mx"},{language:"es-ev",defaultLocale:"es-mx"},{language:"es-hn",defaultLocale:"es-mx"},{language:"es-ni",defaultLocale:"es-mx"},{language:"es-pu",defaultLocale:"es-mx"},{language:"es-br",defaultLocale:"es-mx"},{language:"es-419",defaultLocale:"es-mx"},{language:"es-us",defaultLocale:"es-us"},{language:"gl",defaultLocale:"es-es"},{language:"eu",defaultLocale:"es-es"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"fi",defaultLocale:"fi-fi"},{language:"fr",defaultLocale:"fr-fr"},{language:"iw",defaultLocale:"he-il"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"in",defaultLocale:"id-id"},{language:"id",defaultLocale:"id-id"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"ko",defaultLocale:"ko-kr"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ms",defaultLocale:"ms-my"},{language:"no",defaultLocale:"nb-no"},{language:"nb",defaultLocale:"nb-no"},{language:"nn",defaultLocale:"nb-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt-pt",defaultLocale:"pt-pt"},{language:"pt-br",defaultLocale:"pt-br"},{language:"pt",defaultLocale:"pt-br"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-latn-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-tw",defaultLocale:"zh-tw"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-tw"},{language:"zh-mo",defaultLocale:"zh-tw"}],r=[{locale:"am-et",pesLocale:"am"},{locale:"ar-sa",pesLocale:"ar"},{locale:"az-latn-az",pesLocale:"az"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg"},{locale:"bn-bd",pesLocale:"bn"},{locale:"bn-in",pesLocale:"bn"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca"},{locale:"ca-es-valencia",pesLocale:"ca"},{locale:"cs-cz",pesLocale:"cs"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da"},{locale:"de-de",pesLocale:"de"},{locale:"el-gr",pesLocale:"el"},{locale:"en-gb",pesLocale:"en"},{locale:"en-us",pesLocale:"en"},{locale:"es-es",pesLocale:"es"},{locale:"et-ee",pesLocale:"et"},{locale:"eu-es",pesLocale:"eu"},{locale:"fa-ir",pesLocale:"fa"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil_PH"},{locale:"fr-fr",pesLocale:"fr"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he"},{locale:"hi-in",pesLocale:"hi"},{locale:"hr-hr",pesLocale:"hr"},{locale:"hu-hu",pesLocale:"hu"},{locale:"id-id",pesLocale:"id"},{locale:"is-is",pesLocale:"is"},{locale:"it-it",pesLocale:"it"},{locale:"ja-jp",pesLocale:"ja"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk"},{locale:"kn-in",pesLocale:"kn"},{locale:"ko-kr",pesLocale:"ko"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt"},{locale:"lv-lv",pesLocale:"lv"},{locale:"mk-mk",pesLocale:"mk"},{locale:"ml-in",pesLocale:"ml"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms"},{locale:"nb-no",pesLocale:"no"},{locale:"nl-nl",pesLocale:"nl"},{locale:"nn-no",pesLocale:"no"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"ro-ro",pesLocale:"ro"},{locale:"ru-ru",pesLocale:"ru"},{locale:"sk-sk",pesLocale:"sk"},{locale:"sl-sl",pesLocale:"sl"},{locale:"sq-al",pesLocale:"sq"},{locale:"sr-cyrl-ba",pesLocale:"sr"},{locale:"sr-cyrl-rs",pesLocale:"sr"},{locale:"sr-latn-rs",pesLocale:"sr"},{locale:"sv-se",pesLocale:"sv"},{locale:"sw-ke",pesLocale:"sw"},{locale:"ta-in",pesLocale:"ta"},{locale:"te-in",pesLocale:"te"},{locale:"th-th",pesLocale:"th"},{locale:"tr-tr",pesLocale:"tr"},{locale:"uk-ua",pesLocale:"uk"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz"},{locale:"vi-vn",pesLocale:"vi"},{locale:"zh-cn",pesLocale:"zh_Hans"},{locale:"zh-tw",pesLocale:"zh_Hant"}],o=function(){function e(){}return e.prototype.getLocale=function(e){var t=this.getMappingByLanguage(e);if(t)return t.defaultLocale;var n=e.lastIndexOf("-");return n>-1?this.getLocale(e.substring(0,n)):e},e.prototype.getPesLocale=function(e){var t,n;return e?(t=this.getPESMapping(e))&&t.pesLocale?t.pesLocale:(n=this.getLocale(e))!==e&&(t=this.getPESMapping(n))?t.pesLocale:"default":"default"},e.prototype.getPESMapping=function(e){for(var t=0;t<r.length;t++)if(r[t].locale.toLowerCase()===e.toLowerCase())return r[t];return null},e.prototype.getMappingByLanguage=function(e){for(var t=0;t<i.length;t++)if(i[t].language.toLowerCase()===e.toLowerCase())return i[t];return null},e}();t.default=new o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=n(82),l=/^\w$/,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.hasLargeEmoticon=function(e){return/<span(\sxmlns=".*")? class="emoticon\s?\w*\s?(animated)?\s+\w*large"><canvas(\s?(data-[-a-z]*|height|width|id|textcontent)=".*")*?>.*<\/canvas><\/span>/i.test(e)},t.prototype.fixInvalidHtml=function(e){return e.replace(/<canvas((?:\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*)\s*\/>/g,"<canvas$1></canvas>")},t.prototype.createHtmlElement=function(e,t,n,i,r,s){var l={large:i,largeEmoticonClass:s,textContent:n,emoticonId:t,isAnimated:!r},u=a.createElement(c.SwcEmoticon,l),d=document.createDocumentFragment();return o.render(u,d),d},t.prototype.isElementAllowed=function(e){return"span"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("emoticon")},t.prototype.wordRawToXml=function(e,t){var n=[],i=0,r=s.default.instance.PesManager.map;if(!s.default.instance.PesManager.canRenderConfigItems())return n;for(var o=0;o<t.length;o++){for(var a="",c=-1,l=o+1;l<t.length+1;l++){var u=t.substring(o,l),d=r.hasOwnProperty(u)&&r[u];d&&!this.isWordChar(t[l])&&(a=d,c=l)}a&&(i!==o&&n.push(e.createTextNode(t.substring(i,o))),i=c,n.push(this.createXmlElement(e,a,t.substring(o,c))),o=c-1)}return 0!==i&&i<t.length&&n.push(e.createTextNode(t.substring(i))),n},t.prototype.createXmlElement=function(e,t,n){var i=e.createElement("ss");return i.setAttribute("type",t),i.innerText=n,i},t.prototype.isWordChar=function(e){return l.test(e)},t}(n(37).WordDomTransformer);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.actionType=o.SwiftCardActionType.unknown,r.originalPayload=t,r.actionType=t.type,r.image=t.image||t.image_url||null,r}return r(t,e),t}(n(74).default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(1),o=n(7),a=n(11),s=n(130),c=n(74),l=n(56),u=n(10),d=function(){return function(e,t,n,d){var p=this;this.url=ko.observable(),this.destinationSize={narrow:{},default:{},carouselDefault:{},carouselNarrow:{}},this.trustedDomains=[i.default.AMS_HOST_URL,i.default.CDN_SERVICE_HOST],this.shouldProcessThroughAMS=function(e){return p._conversation.isSkypeBackend()&&!p.isTrustedUrl(e)},this.processImage=function(e){p.shouldProcessThroughAMS(e)?p.processViaAMS(e).then(function(e){var t=e.url||e.thumbnail,n=e.thumbnail_meta?e.thumbnail_meta:null;n?(p.url(t),p.naturalSize({height:n.height,width:n.width})):p.loadImageSize(l.default.normalizeUrl(t,p._isDl))},function(e){}):p.loadImageSize(p._conversation.isSkypeBackend()?l.default.normalizeUrl(e,p._isDl):e)},this.hasProcessedUrl=function(){return!!p.url()},this.isTrustedUrl=function(e){var t=!1;return p.trustedDomains.forEach(function(n){t=e.indexOf(n)>-1}),t},this.processViaAMS=function(e){var t=i.default.URLP_SERVICE_URL+"/v1/url/info?url=",n=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),o=new RegExp(n,"g"),a=e.indexOf(t)>0?e.replace(o,""):e;return new Promise(function(e){return r.default.instance.AmsManager.getPictureThumbnail(t+encodeURIComponent(a)).then(e)})},this.loadImageSize=function(e){var t=new Image;t.onload=function(){p.url(e),p.naturalSize({height:t.naturalHeight,width:t.naturalWidth})},t.onerror=function(e){a.default.throwError(u.ErrorCodes.ERR_LOAD_IMG,"Unable to load an image, is dl="+p._isDl,e)},t.src=e},this.getUiSize=function(){var e=s.default.instance.CurrentStyle,t=p.getDestinationSize(p.contentType,e,p.isImageInCarousel()),n=p.naturalSize(),i={height:0,width:0};if(0===n.height||0===n.width||0===t.height)return i;var r=t.width/t.height,a=n.width/n.height;switch(p.contentType){case o.SwiftCardContentType.hero:a<r?(i.width=t.width,i.height=n.height*t.width/n.width,p.bottomAlignment((i.height-t.height)/2)):(i.height=t.height,i.width=n.width*t.height/n.height),p.leftAlignment(i.width/-2);break;case o.SwiftCardContentType.animation:case o.SwiftCardContentType.audio:a<r?(i.width=n.width*t.height/n.height,i.height=n.height*t.height/n.height):(i.height=t.height,i.width=n.width*t.height/n.height);break;case o.SwiftCardContentType.thumb:case o.SwiftCardContentType.actionImage:a<r?(i.height=t.height,i.width=i.height*a):a===r?(i.height=t.height,i.width=n.width*t.height/n.height):(i.width=t.width,i.height=i.width/a),p.bottomAlignment((i.height-t.height)/2),p.leftAlignment(i.width/-2);break;case o.SwiftCardContentType.receipt:a<r?(i.height=t.height,i.width=i.height*a):a===r?(i.height=t.height,i.width=n.width*t.height/n.height):(i.width=t.width,i.height=i.width/a,p.bottomAlignment((i.height-t.height)/2)),p.leftAlignment(i.width/-2);break;case o.SwiftCardContentType.flex:a<=r?(1===a?(i.height=t.height,i.width=t.height):(i.width=n.width*t.height/n.height,i.height=t.height),p.leftAlignment((i.width-t.width)/-2)):(i.height=t.height,i.width=n.width*t.height/n.height,p.leftAlignment((i.width-t.width)/-2))}return i},this.getTitleByType=function(){switch(p.tap.type){case o.SwiftCardActionType.call:case o.SwiftCardActionType.imBack:return p.createImageTitle();case o.SwiftCardActionType.openUrl:return p.createImageTitle()+"\n\n"+p.tap.value;case o.SwiftCardActionType.showImage:return(p.alt?p.alt+" ":"")+p.lowerFirstLetter(p.tap.title)}return""},this.createImageTitle=function(){var e=p.tap.title||"",t=r.default.instance.i18n.fetch("accessibility_swift_action_prefix",{swiftAction:p.lowerFirstLetter(e)});return(p.alt?p.alt+" ":"")+t},this.lowerFirstLetter=function(e){return e?e[0].toLowerCase()+e.substring(1):""},this.getDestinationSize=function(e,t,n){return(t===s.StyleModes.NORMAL?n?p.destinationSize.carouselDefault:p.destinationSize.default:n?p.destinationSize.carouselNarrow:p.destinationSize.narrow)[e]},this._conversation=t,this._isDl=this._conversation.isDirectLineBackend(),this.destinationSize.narrow[o.SwiftCardContentType.hero]={height:105,width:188},this.destinationSize.default[o.SwiftCardContentType.hero]={height:153,width:272},this.destinationSize.carouselDefault[o.SwiftCardContentType.hero]={height:145,width:270},this.destinationSize.carouselNarrow[o.SwiftCardContentType.hero]={height:105,width:188},this.destinationSize.narrow[o.SwiftCardContentType.thumb]={height:76,width:76},this.destinationSize.default[o.SwiftCardContentType.thumb]={height:112,width:112},this.destinationSize.carouselDefault[o.SwiftCardContentType.thumb]={height:112,width:112},this.destinationSize.carouselNarrow[o.SwiftCardContentType.thumb]={height:76,width:76},this.destinationSize.narrow[o.SwiftCardContentType.receipt]={height:76,width:76},this.destinationSize.default[o.SwiftCardContentType.receipt]={height:112,width:112},this.destinationSize.narrow[o.SwiftCardContentType.animation]={height:105,width:172},this.destinationSize.default[o.SwiftCardContentType.animation]={height:153,width:256},this.destinationSize.carouselDefault[o.SwiftCardContentType.animation]={height:145,width:256},this.destinationSize.carouselNarrow[o.SwiftCardContentType.animation]={height:105,width:172},this.destinationSize.narrow[o.SwiftCardContentType.audio]={height:105,width:172},this.destinationSize.default[o.SwiftCardContentType.audio]={height:145,width:256},this.destinationSize.carouselDefault[o.SwiftCardContentType.audio]={height:145,width:256},this.destinationSize.carouselNarrow[o.SwiftCardContentType.audio]={height:105,width:172},this.destinationSize.default[o.SwiftCardContentType.actionImage]={height:20,width:20},this.destinationSize.narrow[o.SwiftCardContentType.actionImage]={height:16,width:16},this.destinationSize.narrow[o.SwiftCardContentType.flex]={height:105,width:188},this.destinationSize.default[o.SwiftCardContentType.flex]={height:153,width:272},this.destinationSize.carouselDefault[o.SwiftCardContentType.flex]={height:145,width:256},this.destinationSize.carouselNarrow[o.SwiftCardContentType.flex]={height:105,width:188},this.contentType=d,this.alt=l.default.normalizeRichText(e.alt,this._isDl),e.url&&this.processImage(e.url),this.tap=null,e.tap&&(this.tap=l.default.getItemIfNotDisabled(new c.default(e.tap,t,n)),this.tap&&this.tap.type===o.SwiftCardActionType.showImage&&!this.tap.value&&(this.tap.value=this.url())),this.naturalSize=ko.observable({height:0,width:0}),this.uiSize=ko.pureComputed(this.getUiSize.bind(this)),this.isValid=ko.pureComputed(this.hasProcessedUrl),this.bottomAlignment=ko.observable(),this.leftAlignment=ko.observable(),this.isImageInCarousel=ko.observable(!1)}}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(14),o=n(42),a=function(){function e(){}return e._processUsers=function(e,t){for(var n=i.default.instance.MePersonManager.mePerson,a=0;a<e.users.length;a++){var s=null,c=e.users[a],l=o.default.normalizePersonId(c.mri);c.person=n.id===l?n:i.default.instance.Persons.getPerson(c.mri,!0),c.value=c.value?r.default.getMessageSanitizedContent(c.value):"";for(var u=0;u<t.users.length;u++){var d=t.users[u];if(c.mri===d.mri){s=d;break}}s||t.users.push(c)}},e.parseMessageProperties=function(t,n){n.properties&&t.supportedAnnotations.forEach(function(i){var r=n.properties?n.properties[i]:[],o=t[i];if(r)for(var a=function(t){var n=null,i=r[t];i&&"reactionsConsumptionHorizon"!==i.key&&function(){for(var t=0;t<o.length;t++){var r=o[t];i.key===r.key&&(n=r)}n||(n={key:i.key,users:[]},o.pushObservable(n)),e._processUsers(i,n)}()},s=0;s<r.length;s++)a(s)})},e.updateMessageProperties=function(e,t){t&&e.supportedAnnotations.forEach(function(n){var i=e[n],r=t[n];i&&r&&(i.spliceObservable(0,i.length),r&&r.forEach(function(e){i.pushObservable(e)}))})},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=function(e){function t(t){var n=e.call(this,"kpi_action")||this;return n.actionType=t,n}return r(t,e),t.prototype.getCustomProperties=function(){var e=[];return e.push(o.TelemetryPropertyValue.Create("type",this.actionType)),e},t}(n(8).TelemetryEvent);t.UserActionEvent=a,function(e){e.StartVideoCall="videocall",e.StartAudioCall="audiocall",e.Feedback="feedback",e.GetHelp="gethelp",e.OpenComposer="openComposer",e.AddParticipant="addParticipant",e.Participants="participants",e.Fullscreen="fullscreen",e.MediaSettings="mediaSettings",e.SwitchToChat="switchToChat",e.MinimizeChat="minimizeChat",e.VideoOn="videoOn",e.VideoOff="videoOff",e.AudioOn="audioOn",e.AudioOff="audioOff",e.ScreenSharingOn="screenSharingOn",e.ScreenSharingOff="screenSharingOff",e.ToggleAudio="toggleAudio",e.StopCall="stopCall",e.ExpressionPicker="expressionPicker",e.FilePicker="filePicker",e.DeleteMessage="deleteMessage",e.DeleteConversation="deleteChat",e.LeaveConversation="leaveChat",e.BlockUser="block",e.UnblockUser="unblock",e.ReactionPicker="reactionPicker"}(t.UserActionType||(t.UserActionType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(4);t.BUBBLE_TYPE={INFO:"infoBubble",MENU_LIST:"menuList",REACTION_PREVIEW:"reactionPreviewBubble",REACTION_PANE:"reactionPaneBubble"},function(e){e.nextToElement="nextToElement",e.onContextMenu="onContextMenu"}(i=t.BubblePosition||(t.BubblePosition={}));var o=function(){function e(){}return e.add=function(n,o,a,s,c){void 0===c&&(c=i.nextToElement);for(var l=e.build(),u=s==t.BUBBLE_TYPE.INFO,d=l.content;d.firstChild;)d.removeChild(d.firstChild);if(d.appendChild(a),l.container.className="swc-bubble "+s,l.arrow.style.display=u?"block":"none",c===i.nextToElement){var p,h=n.getBoundingClientRect(),f=o.getBoundingClientRect(),g=h.top-f.top,m=f.bottom-h.bottom,_=h.left-f.left,v=f.right-h.right,y=u?10:0,S=void 0,E=h.width/2,T=h.bottom-f.top+y;if(_<v)l.container.style.right="",(p=(S=h.left-f.left+E)-90)<0?(l.container.style.left=S-90-p+E+"px",l.arrow.style.left=90-E+p-8+"px"):(l.container.style.left=S-90+E+"px",l.arrow.style.left="82px");else l.container.style.left="",(p=(S=f.right-h.right+E)-90)<0?(l.container.style.right=S-90+E-p+"px",l.arrow.style.left=90+E-p-8+"px"):(l.container.style.right=S-90+E+"px",l.arrow.style.left="82px");g>m?(l.container.style.top="",l.container.style.bottom=T+"px",l.arrow.style.top="",l.arrow.style.bottom="-10px",l.arrow.style.borderBottom="",l.arrow.style.borderTop="10px solid #d8d8d8",l.arrowInner.style.bottom="2px",l.arrowInner.style.borderBottom="",l.arrowInner.style.borderTop="9px solid #fdc856"):(l.container.style.bottom="",l.container.style.top=T+"px",l.arrow.style.bottom="",l.arrow.style.top="-10px",l.arrow.style.borderTop="",l.arrow.style.borderBottom="10px solid #d8d8d8",l.arrow.style.top="-10px",l.arrowInner.style.top="2px",l.arrowInner.style.borderTop="",l.arrowInner.style.borderBottom="9px solid #fdc856"),o.appendChild(l.container)}else{var C=n,I=C.target,A={x:C.clientX,y:C.clientY},b=o.getBoundingClientRect(),O=o.parentElement?o.parentElement.getBoundingClientRect():null;if(!n||!I)return;var R=A.y-O.top,P=O.bottom-A.y,N=A.x-b.left,w=b.right-A.x;l.container.style.visibility="hidden",o.appendChild(l.container),setTimeout(function(){var e=l.container.offsetWidth,t=l.container.offsetHeight,n=w>e?N:N-e,i=P>t?R+O.top-b.top:R+O.top-b.top-t;l.container.style.left=n+"px",l.container.style.right="",l.container.style.top=i+"px",l.container.style.bottom="",l.container.style.visibility="visible"},0)}o.addEventListener("click",e.remove),window.swc.API.registerEvent(r.ApiEvents.hideBubbleWindow,e.remove)},e.remove=function(){if(e.instance&&e.instance.container){var t=e.instance.container.parentElement;t&&(t.removeEventListener("click",e.remove),window.swc.API.unregisterEvent(r.ApiEvents.hideBubbleWindow,e.remove),t.removeChild(e.instance.container))}},e.build=function(){if(!e.instance){var t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div");n.className="swc-content",i.className="swc-arrow",r.className="swc-arrow-inner",i.appendChild(r),t.appendChild(i),t.appendChild(n),e.instance={container:t,content:n,arrow:i,arrowInner:r}}return e.instance},e}();t.default=o},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.addAgent=function(e){return t._botsService.addAgentToContacts(e)},t.getAgent=function(e){return t._agentsService.getAgentDetails(e)},t._agentsService=t.getServices().agentsService,t._botsService=t.getServices().botsService,t}return r(t,e),t}(n(21).default);t.SkypeAgentsManager=o,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.addFormatting=function(t){return t=e.addFormattingTags(t,"s",/(\s|^|_|\*|i>|b>|s>)~((?!~\s).)*~(\s|$|_|\*|<)/gi,"~")},e.addFormattingTags=function(t,n,i,r){for(var o=t.match(i);o&&o.length>0&&2!=o[0].trim().length;)o.forEach(function(i){var o=i.trim(),a=(o=o.substring(o.indexOf(r),o.lastIndexOf(r)+1)).substr(1,o.length-2);a=e.createStartTag(n,r)+a+e.createEndTag(n),t=t.replace(o,a)}),o=t.match(i);return t},e.createStartTag=function(e,t){return"<"+e+' raw_pre="'+t+'" raw_post="'+t+'">'},e.createEndTag=function(e){return"</"+e+">"},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.xmlNodeToHtml=function(e,t){if("at"===t.nodeName.toLowerCase()&&t.attributes.getNamedItem("id")){var n=e.createElement("i");return n.setAttribute("class","mention"),n.setAttribute("title",t.attributes.getNamedItem("id").value),n.textContent=t.textContent,[n]}return[]},t}(n(127).DomTransformerBase);t.MentionDomDecoder=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,i){var r=[];for(r.push(t);0!==r.length;){var o=r.pop();this.encodeTextNodeToXml(e,o,n,i)&&o.nodeType!==Node.TEXT_NODE&&this.isElementAllowed(o)&&this.pushChildNodes(r,o)}},e.prototype.encodeTextNodeToXml=function(e,t,n,i){var r=t.parentNode,o=this.xmlNodeToHtml(e,t,n,i);if(!o||!o.length)return!0;for(var a=0;a<o.length;a++)r.insertBefore(o[a],t);return r.removeChild(t),!1},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.DomTransformerBase=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"pre"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){return[this.createXmlElement(e)]},t.prototype.getAllWords=function(e){for(var t,n=/\r?\n/g,i=new Array;null!==(t=n.exec(e));)i.push(t);return i},t.prototype.createXmlElement=function(e){return e.createElement("br")},t}(n(37).WordDomTransformer);t.NewLineDomTransformer=o},function(e,t,n){(function(t){(function(){"use strict";var t={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:p,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:p,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:p,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};function n(e){this.tokens=[],this.tokens.links={},this.options=e||f.defaults,this.rules=t.normal,this.options.gfm&&(this.options.tables?this.rules=t.tables:this.rules=t.gfm)}t.bullet=/(?:[*+-]|\d+\.)/,t.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,t.item=c(t.item,"gm")(/bull/g,t.bullet)(),t.list=c(t.list)(/bull/g,t.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+t.def.source+")")(),t.blockquote=c(t.blockquote)("def",t.def)(),t._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",t.html=c(t.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,t._tag)(),t.paragraph=c(t.paragraph)("hr",t.hr)("heading",t.heading)("lheading",t.lheading)("blockquote",t.blockquote)("tag","<"+t._tag)("def",t.def)(),t.normal=h({},t),t.gfm=h({},t.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),t.gfm.paragraph=c(t.paragraph)("(?!","(?!"+t.gfm.fences.source.replace("\\1","\\2")+"|"+t.list.source.replace("\\1","\\3")+"|")(),t.tables=h({},t.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),n.rules=t,n.lex=function(e,t){return new n(t).lex(e)},n.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},n.prototype.token=function(e,n,i){var r,o,a,s,c,l,u,d,p;for(e=e.replace(/^ +$/gm,"");e;)if((a=this.rules.newline.exec(e))&&(e=e.substring(a[0].length),a[0].length>1&&this.tokens.push({type:"space"})),a=this.rules.code.exec(e))e=e.substring(a[0].length),a=a[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?a:a.replace(/\n+$/,"")});else if(a=this.rules.fences.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"code",lang:a[2],text:a[3]||""});else if(a=this.rules.heading.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"heading",depth:a[1].length,text:a[2]});else if(n&&(a=this.rules.nptable.exec(e))){for(e=e.substring(a[0].length),l={type:"table",header:a[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3].replace(/\n$/,"").split("\n")},d=0;d<l.align.length;d++)/^ *-+: *$/.test(l.align[d])?l.align[d]="right":/^ *:-+: *$/.test(l.align[d])?l.align[d]="center":/^ *:-+ *$/.test(l.align[d])?l.align[d]="left":l.align[d]=null;for(d=0;d<l.cells.length;d++)l.cells[d]=l.cells[d].split(/ *\| */);this.tokens.push(l)}else if(a=this.rules.lheading.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"heading",depth:"="===a[2]?1:2,text:a[1]});else if(a=this.rules.hr.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"hr"});else if(a=this.rules.blockquote.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"blockquote_start"}),a=a[0].replace(/^ *> ?/gm,""),this.token(a,n,!0),this.tokens.push({type:"blockquote_end"});else if(a=this.rules.list.exec(e)){for(e=e.substring(a[0].length),s=a[2],this.tokens.push({type:"list_start",ordered:s.length>1}),r=!1,p=(a=a[0].match(this.rules.item)).length,d=0;d<p;d++)u=(l=a[d]).length,~(l=l.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(u-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+u+"}","gm"),"")),this.options.smartLists&&d!==p-1&&(s===(c=t.bullet.exec(a[d+1])[0])||s.length>1&&c.length>1||(e=a.slice(d+1).join("\n")+e,d=p-1)),o=r||/\n\n(?!\s*$)/.test(l),d!==p-1&&(r="\n"===l.charAt(l.length-1),o||(o=r)),this.tokens.push({type:o?"loose_item_start":"list_item_start"}),this.token(l,!1,i),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(a=this.rules.html.exec(e))e=e.substring(a[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===a[1]||"script"===a[1]||"style"===a[1]),text:a[0]});else if(!i&&n&&(a=this.rules.def.exec(e)))e=e.substring(a[0].length),this.tokens.links[a[1].toLowerCase()]={href:a[2],title:a[3]};else if(n&&(a=this.rules.table.exec(e))){for(e=e.substring(a[0].length),l={type:"table",header:a[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3].replace(/(?: *\| *)?\n$/,"").split("\n")},d=0;d<l.align.length;d++)/^ *-+: *$/.test(l.align[d])?l.align[d]="right":/^ *:-+: *$/.test(l.align[d])?l.align[d]="center":/^ *:-+ *$/.test(l.align[d])?l.align[d]="left":l.align[d]=null;for(d=0;d<l.cells.length;d++)l.cells[d]=l.cells[d].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(n&&(a=this.rules.paragraph.exec(e)))e=e.substring(a[0].length),this.tokens.push({type:"paragraph",text:"\n"===a[1].charAt(a[1].length-1)?a[1].slice(0,-1):a[1]});else if(a=this.rules.text.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"text",text:a[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var i={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ <>]+(@|:\/)[^ <>]+)>/,url:p,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^<'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:p,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};function r(e,t){if(this.options=t||f.defaults,this.links=e,this.rules=i.normal,this.renderer=this.options.renderer||new o,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=i.breaks:this.rules=i.gfm:this.options.pedantic&&(this.rules=i.pedantic)}function o(e){this.options=e||{}}function a(e){this.tokens=[],this.token=null,this.options=e||f.defaults,this.options.renderer=this.options.renderer||new o,this.renderer=this.options.renderer,this.renderer.options=this.options}function s(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function c(e,t){return e=e.source,t=t||"",function n(i,r){return i?(r=(r=r.source||r).replace(/(^|[^\[])\^/g,"$1"),e=e.replace(i,r),n):new RegExp(e,t)}}function l(e,t){return u[" "+e]||(/^[^:]+:\/*[^/]*$/.test(e)?u[" "+e]=e+"/":u[" "+e]=e.replace(/[^/]*$/,"")),e=u[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+t:e+t}i._inside=/(?:\[[^\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,i._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,i.link=c(i.link)("inside",i._inside)("href",i._href)(),i.reflink=c(i.reflink)("inside",i._inside)(),i.normal=h({},i),i.pedantic=h({},i.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),i.gfm=h({},i.normal,{escape:c(i.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:c(i.text)("]|","~]|")("|","|https?://|")()}),i.breaks=h({},i.gfm,{br:c(i.br)("{2,}","*")(),text:c(i.gfm.text)("{2,}","*")()}),r.rules=i,r.output=function(e,t,n){return new r(t,n).output(e)},r.prototype.output=function(e){for(var t,n,i,r,o="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),o+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),"@"===r[2]?(n=s(":"===r[1].charAt(6)?this.mangle(r[1].substring(7)):this.mangle(r[1])),i=this.mangle("mailto:")+n):i=n=s(r[1]),o+=this.renderer.link(i,null,n);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):s(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,o+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),o+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),o+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),o+=this.renderer.codespan(s(r[2].trim(),!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),o+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),o+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),o+=this.renderer.text(s(this.smartypants(r[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(r[0].length),i=n=s(r[1]),o+=this.renderer.link(i,null,n);return o},r.prototype.outputLink=function(e,t){var n=s(t.href),i=t.title?s(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,i,this.output(e[1])):this.renderer.image(n,i,s(e[1]))},r.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"â€”").replace(/--/g,"â€“").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1â€˜").replace(/'/g,"â€™").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1â€œ").replace(/"/g,"â€").replace(/\.{3}/g,"â€¦"):e},r.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",i=e.length,r=0;r<i;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},o.prototype.code=function(e,t,n){if(this.options.highlight){var i=this.options.highlight(e,t);null!=i&&i!==e&&(n=!0,e=i)}return t?'<pre><code class="'+this.options.langPrefix+s(t,!0)+'">'+(n?e:s(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:s(e,!0))+"\n</code></pre>"},o.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},o.prototype.html=function(e){return e},o.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},o.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},o.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"},o.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},o.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},o.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},o.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},o.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},o.prototype.strong=function(e){return"<strong>"+e+"</strong>"},o.prototype.em=function(e){return"<em>"+e+"</em>"},o.prototype.codespan=function(e){return"<code>"+e+"</code>"},o.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},o.prototype.del=function(e){return"<del>"+e+"</del>"},o.prototype.link=function(e,t,n){if(this.options.sanitize){try{var i=decodeURIComponent((r=e,r.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return n}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:")||0===i.indexOf("data:"))return n}var r;this.options.baseUrl&&!d.test(e)&&(e=l(this.options.baseUrl,e));var o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>"},o.prototype.image=function(e,t,n){this.options.baseUrl&&!d.test(e)&&(e=l(this.options.baseUrl,e));var i='<img src="'+e+'" alt="'+n+'"';return t&&(i+=' title="'+t+'"'),i+=this.options.xhtml?"/>":">"},o.prototype.text=function(e){return e},a.parse=function(e,t,n){return new a(t,n).parse(e)},a.prototype.parse=function(e){this.inline=new r(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},a.prototype.next=function(){return this.token=this.tokens.pop()},a.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},a.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},a.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,i,r="",o="";for(n="",e=0;e<this.token.header.length;e++)({header:!0,align:this.token.align[e]}),n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",i=0;i<t.length;i++)n+=this.renderer.tablecell(this.inline.output(t[i]),{header:!1,align:this.token.align[i]});o+=this.renderer.tablerow(n)}return this.renderer.table(r,o);case"blockquote_start":for(o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":o="";for(var a=this.token.ordered;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,a);case"list_item_start":for(o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var s=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(s);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var u={},d=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function p(){}function h(e){for(var t,n,i=1;i<arguments.length;i++)for(n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function f(e,t,i){if(i||"function"==typeof t){i||(i=t,t=null);var r,o,c=(t=h({},f.defaults,t||{})).highlight,l=0;try{r=n.lex(e,t)}catch(e){return i(e)}o=r.length;var u=function(e){if(e)return t.highlight=c,i(e);var n;try{n=a.parse(r,t)}catch(t){e=t}return t.highlight=c,e?i(e):i(null,n)};if(!c||c.length<3)return u();if(delete t.highlight,!o)return u();for(;l<r.length;l++)!function(e){"code"!==e.type?--o||u():c(e.text,e.lang,function(t,n){return t?u(t):null==n||n===e.text?--o||u():(e.text=n,e.escaped=!0,void(--o||u()))})}(r[l])}else try{return t&&(t=h({},f.defaults,t)),a.parse(n.lex(e,t),t)}catch(e){if(e.message+="\nPlease report this to https://github.com/chjj/marked.",(t||f.defaults).silent)return"<p>An error occurred:</p><pre>"+s(e.message+"",!0)+"</pre>";throw e}}p.exec=p,f.options=f.setOptions=function(e){return h(f.defaults,e),f},f.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new o,xhtml:!1,baseUrl:null},f.Parser=a,f.parser=a.parse,f.Renderer=o,f.Lexer=n,f.lexer=n.lex,f.InlineLexer=r,f.inlineLexer=r.output,f.parse=f,e.exports=f}).call(function(){return this||("undefined"!=typeof window?window:t)}())}).call(this,n(22))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(62),o=n(28),a=function(){function e(){var e=this;this.handlers=[],this.dispose=function(){o.default.getWindow().removeEventListener("resize",e.windowResizeHandler)},this.getCurrentStyle=function(){return(e.forcedWidth||o.default.getWindow().innerWidth)<356?i.NARROW:i.NORMAL},this.onResize=function(){e._currentStyle=e.getCurrentStyle();for(var t=0,n=e.handlers;t<n.length;t++){var i=n[t];try{i()}catch(e){}}};this.windowResizeHandler=r(this.onResize,500),o.default.getWindow().addEventListener("resize",this.windowResizeHandler)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CurrentStyle",{get:function(){return this._currentStyle},enumerable:!0,configurable:!0}),e.prototype.forceWidth=function(e){this.forcedWidth=e,this._currentStyle=this.getCurrentStyle()},e.prototype.addResizeHandler=function(e){-1==this.handlers.indexOf(e)&&this.handlers.push(e)},e.prototype.removeResizeHandler=function(e){var t=this.handlers.indexOf(e);-1!=t&&this.handlers.splice(t,1)},e}();t.default=a,function(e){e[e.NARROW=0]="NARROW",e[e.NORMAL=1]="NORMAL"}(i=t.StyleModes||(t.StyleModes={}))},function(e,t,n){"use strict";
/*!
 *  AufLog.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function i(e,t){var n=0;return e.replace(/%[dixs%]/g,function(e){var i=0;if("%"!==e[i++])return"";var r=e[i++];return"%"===r?"%":"s"===r?t[n++]:"d"===r||"i"===r?t[n++]:"x"===r?t[n++].toString(16):e})}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=i,t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return i(e,t)}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(0),l=n(52),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e={backgroundColor:l.default.getBackgroundColor(this.props.title)||"transparent"},t=c.swc.Assets.SVG;return s.createElement("div",o({className:"avatar",style:e},{"tab-index":"0","aria-label":"avatar"},{dangerouslySetInnerHTML:{__html:t.iconPstnContact}}))},t}(a.Component);t.PstnAvatar=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(6),o=n(2),a=n(8),s=n(30),c=n(98),l=n(5),u=function(){function e(){}return e.init=function(){i.swc.TelemetryService=i.swc.TelemetryService||new e},e.prototype.sendEvent=function(e){var t=this;if(e){this.logger||(this.logger=new c.default(o.default.ECS.ariaTenantId));var n=new window.ariaTelemetry.EventProperties;n.name=e.name,n.eventType=e.type,n.timestamp=e.timestamp;var i=e.getEventProperties();i.forEach(function(e){t.addProperty(n,e)}),this.addProperty(n,e.version),this.addProperty(n,e.identityType),this.addProperty(n,e.host),this.addProperty(n,e.lang),this.addProperty(n,e.isFirstPartyIntegration),this.addProperty(n,e.correlationId),this.addProperty(n,l.TelemetryPropertyValue.Create("sessionId",r.default.get.sessionId?r.default.get.sessionId:a.NA)),this.addProperty(n,l.TelemetryPropertyValue.Create("user",r.default.get.meId||a.NA,s.PIIType.Identity)),i.forEach(function(e){void 0!==e.value&&""!==e.value||(e.value=a.NA),void 0===e.type&&(e.type=s.PIIType.NotSet)}),this.logger.sendEvent(n)}},e.prototype.addProperty=function(e,t){e.setProperty(t.key,t.value+"",t.type)},e}();t.AriaTelemetryService=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(10),o=n(21),a=n(17),s=n(11),c=n(1),l=function(){function e(){var e=this;this.fetch=function(){return e.mePerson?Promise.resolve(e.mePerson):e._mePersonPromise&&e._mePersonPromise.status===a.PromiseStatus.Pending?e._mePersonPromise.promise:(e._mePersonPromise=new a.CancelablePromise(e._fetchMePerson()),e._mePersonPromise.promise.catch(function(e){s.default.throwError(r.ErrorCodes.ERR_FETCH_ME_PERSON,"Unable to fetch me person",e)}),e._mePersonPromise.promise)}}return e.init=function(){i.swc.MePersonManager=i.swc.MePersonManager||new e},Object.defineProperty(e.prototype,"mePerson",{get:function(){return o.getServices().mePerson},enumerable:!0,configurable:!0}),e.prototype.isMe=function(e){return!!this.mePerson&&(this.mePerson.id===e||this.mePerson.msaId===e||this.mePerson.mri===e)},e.prototype.dispose=function(){this._mePersonPromise&&this._mePersonPromise.status!==a.PromiseStatus.Pending&&(this._mePersonPromise=null),this.mePerson&&this.mePerson.dispose()},e.prototype._fetchMePerson=function(){var e=this;return this.mePerson?Promise.reject("[skypeConversationsManager] mePerson has been already fetched."):c.default.instance.SignInManager.onceSignedIn().then(function(){return e.getDetails(),e.mePerson})},e.prototype.getDetails=function(){},e}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(1),s=n(247),c=function(e){function t(){var t=e.call(this)||this;return t.downloadFile=function(e){return t.authenticate().then(function(){return t._amsService.downloadFile(e)})},t.authenticate=function(){return t._authenticated?Promise.resolve():(t._authenticated=!0,t._authenticate())},t.createImageMessage=function(e,t){var n=o.default.AMS_HOST_URL+"objects/"+t.id,i=o.default.AMS_HOST_URL+"objects/"+t.id+"/views/imgt1",r="https://login.skype.com/login/sso?go=webclient.xmm&amp;pic="+t.id,a=e.name,s='<URIObject type="Picture.1" ';return s+='uri="'+n+'" ',s+='url_thumbnail="'+i+'">',s+='To view this shared photo, go to: <a href="'+r+'">'+r+"</a>",s+='<OriginalName v="'+a+'"/><meta type="photo" originalName="'+a+'"/>',s+="</URIObject>"},t.createFileMessage=function(e,t){var n=o.default.AMS_HOST_URL+"objects/"+t.id,i=o.default.AMS_HOST_URL+"objects/"+t.id+"/views/thumbnail",r="https://login.skype.com/login/sso?go=webclient.xmm&amp;docid="+t.id,a=e.name,s='<URIObject type="File.1" ';return s+='uri="'+n+'" ',s+='url_thumbnail="'+i+'">',s+="<Title>Title: "+a+"</Title>",s+="<Description> Description: "+a+"</Description> ",s+='<a href="'+r+'">'+r+"</a>",s+='<OriginalName v="'+a+'"/>',s+='<FileSize v="'+e.size+'"/>',s+="</URIObject>"},t._authenticate=function(){new Headers;return t._amsService.authenticate()},t._amsService=t.getServices().amsService,t._authenticated=!1,t}return r(t,e),t.prototype.sendFile=function(e,t){var n=this;return this.authenticate().then(function(){return n._amsService.createNewDocument(e.id,t).then(function(i){var r=Date.now();return n._amsService.sendFile(i.id,t).then(function(o){var c=new s.default(e,t);return c.status=o.status,c.ttc=Date.now()-r,a.default.instance.TelemetryService.sendEvent(c),n._amsService.isDocumentTypeImage(t.type)?e.sendImage(n.createImageMessage(t,i)):e.sendFile(n.createFileMessage(t,i))})})})},t.prototype.downloadPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPictureThumbnail(e)})},t.prototype.getPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.getPictureThumbnail(e)})},t.prototype.downloadPicture=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPicture(e)})},t.prototype.dispose=function(){this._authenticated=!1},t}(n(21).default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(137),a=n(2),s=n(17),c=n(10),l=n(11),u=n(3),d=n(53),p=n(47),h={"8:echo123":!0},f=["Online","Busy","Away","Hidden"],g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateConsumptionHorizonToLastMessage=function(e){if(null!==e.lastMessage){var n=e.lastMessage,i=n.skypeeditedid||n.clientmessageid||n.id||"0",r=new Date(n.originalarrivaltime).getTime()+";"+(new Date).getTime()+";"+i;t.updateConsumptionHorizon(e.id,r).then(function(){e.setConsumptionHorizon(r),e.isUnread=!1})}},t.markAllConversationsAsRead=function(){var e=t.recents().getAllConversations();Object.keys(e).forEach(function(n){e[n].isUnread&&t.updateConsumptionHorizonToLastMessage(e[n])})},t.fetchMessagesByLink=function(e){return e=e.substring(e.indexOf("users/ME/conversations/")),o.getPolling().authorization.then(function(){return d.get("fetchMessagesByLink",e).then(function(e){return d.parseJson(e)})},console.warn)},t.sendDataToBot=function(e,t){var n="agents/"+e+"/invoke";return d.post("invoke",n,{body:JSON.stringify(t)}).then(function(e){return d.parseJson(e).then(void 0,console.warn).catch(function(e){})})},t.sendLocalSystemMessage=function(e,t,n){var i=new Date,r=p.getDomain()+"users/ME/conversations/"+e+"/messages/"+i.getTime(),a={id:i.getTime()+"",from:"",messagetype:"SystemMessage",originalarrivaltime:i.toISOString(),content:t};n&&(a.customType=n);var s={resource:a,resourceLink:r,resourceType:"NewMessage"};o.getPolling().sendLocalMessage(s)},t.getMyPresence=function(){return o.getPolling().authorization.then(function(){return d.get("getPresence","users/ME/presenceDocs/messagingService?view=expanded").then(function(e){return e.ok||e.json?e.json():null})})},t}return r(t,e),t.prototype.fetchRecentConversations=function(e,t){var n=this,i=this._fetchRecentsPromise?this._fetchRecentsPromise.status:void 0;if(i===s.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var r;return this._fetchRecentsPromise&&this._fetchRecentsPromise.status===s.PromiseStatus.Pending||(this._fetchRecentsPromise=new s.CancelablePromise),r=e,o.getPolling().authorization.then(function(){var e={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent"};r&&Object.assign(e,{startTime:r}),n.syncState?Object.assign(e,{syncState:n.syncState}):Object.assign(e,{targetType:"All|InviteFree|Agent"});var i=d.addGetParamsToUrl("users/ME/conversations",e);d.get("fetchRecents",i).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||d.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState),n.allConversations=n.allConversations.concat(e.conversations),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){l.default.throwError(c.ErrorCodes.ERR_PARSE_RESPONSE,"fetchRecentConversations::getConversationsPage unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)},function(e){n._fetchRecentsPromise.cancel(e,n.allConversations)})}),this._fetchRecentsPromise.promise},t.prototype.fetchMeProperties=function(){return o.getPolling().authorization.then(function(){return d.get("fetchMeProperties","users/ME/properties").then(function(e){return d.parseJson(e)})})},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var i={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",startTime:n},r=d.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",i);return o.getPolling().authorization.then(function(){return d.get("fetchMessages",r).then(function(e){return d.parseJson(e).then(function(e){return e})})})},t.prototype.fetchConversation=function(e){var t=d.addGetParamsToUrl("users/ME/conversations/"+e,{view:"msnp24Equivalent",targetType:"All"});return d.get("fetchConversation",t).then(function(e){return d.parseJson(e).catch(function(e){return e})})},t.prototype.deleteConversation=function(e){var t="users/ME/conversations/"+e+"/messages";return d.del("deleteConversation",t)},t.prototype.sendMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages";return o.getPolling().authorization.then(function(){return d.post("sendMessage",n,{body:JSON.stringify(t)}).then(function(e){return d.parseJson(e)})})},t.prototype.editMessage=function(e,t,n,i){var r="users/ME/conversations/"+e+"/messages/"+t,o={messagetype:n,content:i};return d.put("edit",r,{body:JSON.stringify(o)})},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t;return d.del("deleteMessage",n)},t.prototype.enableJoining=function(e,t){void 0===t&&(t=!0);var n=d.addGetParamsToUrl("threads/"+e+"/properties",{name:"joiningenabled"}),i={body:JSON.stringify({joiningenabled:t})};return d.put("enableJoining",n,i)},t.prototype.discloseHistory=function(e,t){void 0===t&&(t=!0);var n=d.addGetParamsToUrl("threads/"+e+"/properties",{name:"historydisclosed"}),i={body:JSON.stringify({historydisclosed:t})};return d.put("historyDisclosed",n,i)},t.prototype.fetchThread=function(e){var t=d.addGetParamsToUrl("threads/"+e,{view:"msnp24Equivalent"});return d.get("fetchThread",t).then(function(e){return d.parseJson(e)})},t.prototype.createThread=function(e){var t={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify({members:e})};return d.post("thread","threads",t)},t.prototype.setConversationTopic=function(e,t){var n=d.addGetParamsToUrl("threads/"+e+"/properties",{name:"topic"});return o.getPolling().authorization.then(function(){return d.put("setTopic",n,{body:JSON.stringify({topic:t})})})},t.prototype.addParticipant=function(e,t,n){var i="threads/"+e+"/members/"+t,r=n?"Admin":"User";return o.getPolling().authorization.then(function(){return d.put("addParticipant",i,{body:JSON.stringify({role:r})})})},t.prototype.removeParticipant=function(e,t){var n="threads/"+e+"/members/"+t;return o.getPolling().authorization.then(function(){return d.del("removeParticipant",n,{body:""})})},t.prototype.acceptConversation=function(e){var t=d.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationstatus"});return d.put("acceptConversation",t,{body:JSON.stringify({conversationstatus:"Accepted"})})},t.prototype.blockConversation=function(e){var t=d.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationblocked"});return d.put("blockConversation",t,{body:JSON.stringify({conversationblocked:"true"})})},t.prototype.updateConsumptionHorizon=function(e,t){var n=d.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"consumptionhorizon"});return d.put("consumptionHorizon",n,{body:JSON.stringify({consumptionhorizon:t})})},t.prototype.getUsersPresence=function(e){e.length>10&&e.splice(10);var t=d.addGetParamsToUrl("users/ME/contacts/ALL/presenceDocs/messagingService",{cMri:e});return o.getPolling().authorization.then(function(){return d.get("getUsersPresence",t).then(function(e){return e.json().then(function(e){return e.Responses})})})},t.prototype.setMessageProperty=function(e,t,n,i){var r=this.messageProperties(e,t,n),o={};return o[n]=JSON.stringify(i),d.put(a.default.CHAT_SERVICE_COMMANDS.SET_MESSAGE_PROPERTY,r,{body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})},t.prototype.messageProperties=function(e,t,n){return"users/ME"+("/conversations"+("/"+e+"/messages")+("/"+t+"/properties"))+"?name="+n},t.prototype.removeMessageProperty=function(e,t,n,i){var r=this.messageProperties(e,t,n),o={};return o[n]=JSON.stringify(i),d.del(a.default.CHAT_SERVICE_COMMANDS.REMOVE_MESSAGE_PROPERTY,r,{body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})},t.prototype.subscribeContactPresence=function(e){var t=this;return a.default.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),h[e]?Promise.resolve():o.getPolling().authorization.then(function(){return o.getPolling().subscribeContactPresence(e).then(function(){return t.getUsersPresence([e]).then(function(t){u.default.persons.handlePresenceData(e,t[0].Payload)})})})):Promise.resolve()},t.prototype.unsubscribeContactPresence=function(e){return o.getPolling().unsubscribeContactPresence(e)},t.prototype.setMyPresence=function(e){return f.some(function(t){return t===e})?o.getPolling().authorization.then(function(){return d.put("setPresence","users/ME/presenceDocs/messagingService",{body:JSON.stringify({status:e})})}):Promise.reject("Unsupported presence")},t.prototype.setEndpointPresence=function(){return o.getPolling().authorization.then(function(){return o.getPolling().setEndpointPresence()})},t}(o.ConversationWebApi);t.ConversationConsumerWebApi=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(138));var i=n(105);t.startEndpointActivation=i.startActivation,t.stopEndpointActivation=i.stopActivation;var r=n(140);t.recents=r.recents},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(6),o=n(13),a=n(3),s=n(105),c=n(139),l=n(264),u=n(140);t.PAGE_SIZE=100,t.SYNC_STATE_LINK_REGEX=/syncState=([^&]+)/,t.getPolling=function(){if(!i){var e=r.default.get.backend===o.MessagingBackend.TEAMS;i=e?new l.PollingTeams:new c.Polling}return i};var d=function(){function e(){this.resetCallbacks=[],this.allConversations=[],this.syncState="",this.updateConsumptionHorizonToLastMessage=function(e){}}return e.prototype.recents=function(){return u.recents()},e.prototype.subscribeConversation=function(e,n,i,r){var o=this;return t.getPolling().subscribeConversation(e,n,i).then(function(){return r?o.fetchConversation(e):Promise.reject("No fetch conversation properties")})},e.prototype.unsubscribeConversation=function(e){t.getPolling().unsubscribeConversation(e)},e.prototype.subscribeResource=function(e,n){return t.getPolling().subscribeResource(e,n)},e.prototype.unsubscribeResource=function(e){t.getPolling().unsubscribeResource(e)},e.prototype.startEndpointActivation=function(){s.startActivation()},e.prototype.stopEndpointActivation=function(){s.stopActivation()},e.prototype.addResetSubscriber=function(e){e&&this.resetCallbacks.push(e)},e.prototype.reset=function(){return this.allConversations=[],this.syncState="",this.resetCallbacks.forEach(function(e){e()}),a.default.telemetryManager.flushAll(),t.getPolling().reset().then(null,function(){})},e.prototype.getSyncState=function(e){if(!e||!t.SYNC_STATE_LINK_REGEX.test(e))return"";var n=e.match(t.SYNC_STATE_LINK_REGEX);return n?n[1]:""},e}();t.ConversationWebApi=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(62),r=n(4),o=n(244),a=n(2),s=n(17),c=n(10),l=n(66),u=n(0),d=n(11),p=n(261),h=n(262),f=n(263),g=n(54),m=n(7),_=n(3),v=n(105),y=n(53),S=n(47),E="supportsMessageProperties",T=5e3,C=3,I=1,A=2,b=2e3,O={get:function(e){if(e)try{var t=JSON.parse(sessionStorage.getItem(l.SessionStorageKeys.Endpoint)||"");if(t&&t.validUntil>Date.now()&&e===t.username)return t.value}catch(e){}return O.invalidate(),""},set:function(e,t){var n={username:e,value:t,validUntil:Date.now()+6e5};sessionStorage.setItem(l.SessionStorageKeys.Endpoint,JSON.stringify(n))},invalidate:function(){sessionStorage.removeItem(l.SessionStorageKeys.Endpoint)}},R=function(){function e(){var t=this;this._handledConversations={},this._handledResourceTypes={},this._isPolling=!1,this._followedContacts={},this.reset=function(){return v.stopActivation(),t._waitingForRetry=!1,t._handledConversations={},t._handledResourceTypes={},t._followedContacts={},t._stopPolling(),t._authPromise.promise.then(null,function(){}).catch(),t._authPromise.cancel(),O.invalidate(),t._removeEndpoint()},this.subscribeConversation=function(e,n,i){return t._handledConversations[e]?d.default.throwError(c.ErrorCodes.INFO_CONVERSATION_ALREADY_SUBSCRIBED,"Conversation is already subscribed",null,e):t._handledConversations[e]={eventHandler:n,backfillCallback:i},t._endpointCreationPromise&&!t._endpointCreationPromise.isCanceled||t._startPollingSequence(),t._endpointCreationPromise.promise},this.unsubscribeConversation=function(e){t._handledConversations[e]&&delete t._handledConversations[e]},this.subscribeContactPresence=function(e){return t._followedContacts[e]?Promise.resolve():(t._followedContacts[e]=!0,!t._endpointCreationPromise||t._endpointCreationPromise.isCanceled?t._startPollingSequence():t._subscriptionId&&t._updateSubscription(),t._endpointCreationPromise.promise)},this.unsubscribeContactPresence=function(e){t._followedContacts[e]&&(delete t._followedContacts[e],t._endpointCreationPromise.status===s.PromiseStatus.Resolved&&t._updateSubscription())},this.subscribeResource=function(e,n){return t._handledResourceTypes[e]&&d.default.throwError(c.ErrorCodes.ERR_RESOURCE_ALREADY_HANDLED,"Resource with that name was already handled",e),t._handledResourceTypes[e]=n,Promise.resolve()},this.unsubscribeResource=function(e){t._handledResourceTypes[e]&&delete t._handledResourceTypes[e]},this.sendLocalMessage=function(e){var n={eventMessages:[e]};t._handlePollData(n)},this._poll=function(e){t._isPolling||(t._pollingRetryInterval&&t._pollingRetryInterval.reset(),t._pollingRetryInterval=new g.FixedTimeout(t._poll.bind(t,e),T),t._isPolling=!0,t._waitingForRetry=!1,t._pollingPromise=new s.CancelablePromise(y.post("polling","users/ME/endpoints/SELF/subscriptions/"+e+"/poll",{body:JSON.stringify({})})),t._pollingPromise.promise.then(function(n){t._isPolling=!1,n.ok||404===n.status?(t._pollingFailedCount=0,n.json().then(function(n){t._pollingPromise.isCanceled||(t._handlePollData(n),729===n.errorCode?(O.invalidate(),t._startPollingSequence()):450===n.errorCode?(t._subscribeToEndpoint(),t.triggerBackfilling()):t._endpointCreationPromise&&t._endpointCreationPromise.status===s.PromiseStatus.Resolved&&t._poll(e))}).catch(function(n){t._poll(e)})):t.retryPollingIfNeeded(n,e)},function(e){t._isPolling=!1,t.retryPollingIfNeeded()}))},this._handlePollData=function(e){if(e&&e.eventMessages){e.eventMessages.forEach(function(e){!function(e){var n=e.resourceType,i=t._handledResourceTypes[n];i&&i(S.getConversationIdFromUrl(e.resourceLink),e.resource)}(e),"NewMessage"===e.resourceType||"MessageUpdate"===e.resourceType||"ConversationUpdate"===e.resourceType?function(e){var n=S.getConversationIdFromUrl(e.resourceLink),i=t._handledConversations[n],r=i&&i.eventHandler,o=e.resource,a=S.getConversationIdFromUrl(o.from),s=h.ThreadNotifications.instance;a&&!s.empty&&p.default.detectConversationType(a)===m.ConversationType.AGENT&&s.notify(p.default.getNormalizeId(a),n,o.content);r&&r(e.resourceType,o)}(e):"UserPresence"===e.resourceType&&function(e){var n=S.getConversationIdFromUrl(e.resourceLink);if(!n&&e.resource&&e.resource.selfLink&&(n=S.getConversationIdFromUrl(e.resource.selfLink)),n){var i=_.default.mePerson.mri===n;(t._followedContacts[n]||i)&&_.default.persons.handlePresenceData(n,e.resource)}}(e)})}},this.retryPollingIfNeeded=function(e,n){if(!t._pollingPromise.isCanceled){if(t._pollingFailedCount>=C)return t._startPollingSequence(),void t.triggerBackfilling();t._pollingFailedCount++,e&&"Timeout"===e.statusText?t._poll(n):(t._pollingRetryInterval.start(),t.triggerBackfilling())}},this.triggerBackfilling=function(){for(var e in t._handledConversations){if(t._handledConversations.hasOwnProperty(e))t._handledConversations[e].backfillCallback()}},this._startPollingSequence=function(e){if(t._endpointCreationPromise&&t._endpointCreationPromise.status===s.PromiseStatus.Pending)return t._endpointCreationPromise.promise;if(t._isPolling)return Promise.resolve();if(t._waitingForRetry&&!e)return Promise.resolve();t._endpointRetryInterval.reset(),f.stop(),t._pollingFailedCount=0,t._pollingRetryInterval&&t._pollingRetryInterval.reset(),t._pollingRemoved=!1,t._authPromise.status!==s.PromiseStatus.Pending&&(t._authPromise=new s.CancelablePromise);return t._endpointCreationPromise=new s.CancelablePromise(t._createEndpoint().then(function(e){f.reset(),e.json().then(function(e){if(!t._endpointCreationPromise.isCanceled){if(!(e.subscriptions&&e.subscriptions.length>0))return t._subscribeToEndpoint();t._poll(e.subscriptions[0].id)}})},function(){t._endpointCreationPromise.isCanceled||(t._endpointFailedCount++,t._waitingForRetry=!0,t._endpointFailedCount>=I?(f.execute(t._startPollingSequence.bind(t,!0)),t._endpointFailedCount>=A&&window.swc.API.triggerEvent(r.ApiEvents.ChatServiceUnavailable)):t._endpointRetryInterval.start())})),t._endpointCreationPromise.promise},this._storeEpid=function(t){var n=(t=t||"").match(/endpoints\/(%7B[\da-z\-]+%7D)/),i=n&&n[1]||e._epid;i&&(e._epid=i,_.default.storage.setItem("skype|epid",e._epid))},this._createEndpoint=function(){var e={endpointFeatures:"Agent,InviteFree"},n=function(e){t._storeEpid(e.headers.get("location"));var n=t._authPromise.resolve.bind(t._authPromise);return setTimeout(n,1),_.default.isActive()&&v.startActivation(),t._setEndpointProperty(E,!0),t.setEndpointPresence(),u.swc.API.triggerEvent(r.ApiEvents.EndpointRegistered),e},i=o.default.mePerson?o.default.mePerson.id:"",a=O.get(i);if(a){return y.put("endpointCreation",a,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}},!0).then(n).catch(function(e){return O.invalidate(),t._createEndpoint()})}return y.post("endpointCreation","users/ME/endpoints",{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(function(e){var t=e.headers.get("location");return O.set(i,t),e}).then(n)},this._requestSubscription=function(){var e={channeltype:"httpLongPoll",interestedResources:t._getInterestedResources()};return y.post("endpointSubscription","users/ME/endpoints/SELF/subscriptions",{body:JSON.stringify(e)})},this.setEndpointPresence=function(){var t={id:"messagingService",privateInfo:{epname:"skype"},epname:"skype",publicInfo:{capabilities:"video|audio",nodeInfo:"",skypeNameVersion:"skype.com",type:1},version:a.default.getClientVersion(),selfLink:"uri",type:"EndpointPresenceDoc"};return y.put("setEndpointPresence","users/ME/endpoints/"+e._epid+"/presenceDocs/messagingService",{body:JSON.stringify(t)})},this.modifySubscription=function(){var e={interestedResources:t._getInterestedResources()};if(void 0===t._subscriptionId)return Promise.resolve();var n="users/ME/endpoints/SELF/subscriptions/"+t._subscriptionId+"?name=interestedResources",i=e.interestedResources.length;return y.put("endpointSubscription",n,{body:JSON.stringify(e)}).then(function(e){e&&!e.ok&&d.default.throwError(c.ErrorCodes.ERR_UPDATE_SUBSCRIPTION,"Unable to update subscription. Number of followed contacts: "+i,e)},function(e){d.default.throwError(c.ErrorCodes.ERR_UPDATE_SUBSCRIPTION,"Unable to update subscription. Number of followed contacts: "+i,e)})},e._epid=_.default.storage.getItem("skype|epid"),this._authPromise=new s.CancelablePromise,this._endpointRetryInterval=new g.FixedTimeout(this._startPollingSequence.bind(this,!0),T),this._pollingFailedCount=0,this._endpointFailedCount=0,this._updateSubscription=i(this.modifySubscription.bind(this),b,{leading:!0}),h.ThreadNotifications.init()}return Object.defineProperty(e.prototype,"authorization",{get:function(){return this._startPollingSequence(),this._authPromise.promise},enumerable:!0,configurable:!0}),e.prototype._setEndpointProperty=function(e,t){var n={};return n[e]=t,y.put("endpointProperties","users/ME/endpoints/SELF/properties?name="+E,{body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})},e.prototype._getInterestedResources=function(){var e=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties"];return Object.getOwnPropertyNames(this._followedContacts).forEach(function(t){e.push("/v1/users/ME/contacts/"+t)}),e},e.prototype._subscribeToEndpoint=function(){var e=this;return this._requestSubscription().then(function(t){if(!e._endpointCreationPromise.isCanceled){var n=(t.headers.get("location")||"").match(/\/(\d+)$/);n?(e._subscriptionId=n[1],e._poll(n[1])):e._startPollingSequence()}},function(t){if(!t||!t.json)return e._waitingForRetry=!0,void e._endpointRetryInterval.start();t.json().then(function(t){!t||729!==t.errorCode&&201!==t.errorCode||(729===t.errorCode&&O.invalidate(),e._startPollingSequence())},function(){})})},e.prototype._removeEndpoint=function(){if(this._pollingRemoved)return Promise.resolve();function t(){y.reset(),e._epid=null}return this._pollingRemoved=!0,e._epid||(e._epid=_.default.storage.getItem("skype|epid")),e._epid?y.del("deleteEndpoint","users/ME/endpoints/"+e._epid).then(t,t):(y.reset(),Promise.resolve())},e.prototype._stopPolling=function(){this._endpointRetryInterval.reset(),this._pollingRetryInterval&&this._pollingRetryInterval.reset(),this._pollingFailedCount=0,this._endpointFailedCount=0,this._endpointCreationPromise&&this._endpointCreationPromise.cancel(),this._pollingPromise&&(this._pollingPromise.cancel(),this._isPolling=!1)},e}();t.Polling=R},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(6),o=n(17),a=n(40),s=n(13),c=n(0),l=n(42),u=n(3),d=n(3),p=n(275),h=100,f=15,g=3,m=2592e6,_=function(){function e(){var e=this;this.allConversationsMap={},this.viewPort=[],this.unseen=[],this.unreadConversationsCountPromise=new o.CancelablePromise,this.unreadConversationsPromise=new o.CancelablePromise,this.unreadConversations=new a.ObservableCollection,this.boundNewMessageUpdate=this.newMessageHandler.bind(this),this.boundConversationUpdate=this.conversationUpdateHandler.bind(this),this._lastRequestedRecentsNumber=0,this._failedFetchCount=0,this._pageNumber=0,this.getConversations=function(t){if(e._lastRequestedRecentsNumber=e._lastRequestedRecentsNumber>t?e._lastRequestedRecentsNumber:t,e.fetchPagePromise&&e.fetchPagePromise.status===o.PromiseStatus.Pending)return e.fetchPagePromise.promise;if(e.fetchPagePromise&&t<=e.unseen.length){var n={conversations:e.moveToRead(t),hasMoreConversations:!!e.unseen.length};return Promise.resolve(n)}if(e.fetchPagePromise)return e._lastRequestedRecentsNumber=t,e.syncRecents.status===o.PromiseStatus.Pending?(e.fetchPagePromise=new o.CancelablePromise,e.fetchPagePromise.promise):Promise.resolve({conversations:e.moveToRead(t),hasMoreConversations:!1});var i=function(t){if(function(t,n){if(e.fetchPagePromise&&(e.processRecentConversations(t),e.fetchPagePromise.status===o.PromiseStatus.Pending)){if(n&&e.unseen.length<e._lastRequestedRecentsNumber)return;var i={conversations:e.moveToRead(e._lastRequestedRecentsNumber),hasMoreConversations:n};e.fetchPagePromise.resolve(i)}}(t.conversations,t.hasMoreConversations),e.fetchPagePromise)return t.hasMoreConversations?void setTimeout(function(){d.default.webApi.fetchRecentConversations(0,h).then(i,r)},e.getTimeoutInterval(e._pageNumber++)):(e.syncRecents.resolve(t),void e.resolveUnreadConversationsCount())},r=function(t){e.fetchPagePromise&&(e._failedFetchCount++,e.fetchPagePromise.status===o.PromiseStatus.Pending&&e.fetchPagePromise.cancel(t),e._failedFetchCount>=g?(e._failedFetchCount=0,e.syncRecents.cancel()):d.default.webApi.fetchRecentConversations(0,h).then(i,r))};e._lastRequestedRecentsNumber=t;d.default.webApi.fetchRecentConversations(0,f).then(i,r);return e.fetchPagePromise=new o.CancelablePromise,e.syncRecents=new o.CancelablePromise,e.unreadConversationsCountPromise.status!==o.PromiseStatus.Pending&&(e.unreadConversationsCountPromise=new o.CancelablePromise,e._pageNumber=0),e.fetchPagePromise.promise},this.isCurrentIdentity=function(e){return l.default.normalizePersonId(e)===d.default.signInManager.currentUserName},this.isLeftGroupConversation=function(t){var n=!1,i=!1;if(t.threadProperties&&t.threadProperties.members)try{JSON.parse(t.threadProperties.members).forEach(function(t){"string"==typeof t&&e.isCurrentIdentity(t)&&(i=!0),t&&t.MemberMri&&e.isCurrentIdentity(t.MemberMri)&&(i=!0)}),n=!i}catch(e){}return n},this._isLastMsgOlderThenMonth=function(e){return Date.now()-m>new Date(e.originalarrivaltime).getTime()},this._shouldRegisterAsUnread=function(t){return t.isUnread&&!t.alertsOff&&!e._isLastMsgOlderThenMonth(t.lastMessage)},this.unreadConversationsPromise.promise.then(function(){u.default.notificationsManager.registerUnreadConversationsSummary(e.unreadConversations)},function(e){}),d.default.webApi.addResetSubscriber(this.reset.bind(this))}return e.prototype.getAllConversations=function(){return this.allConversationsMap},e.prototype.getTimeoutInterval=function(e){return e<1?1:(this.resolveUnreadConversationsCount(),1e3)},e.prototype.moveToRead=function(e){e>this.unseen.length&&(e=this.unseen.length);var t=this.unseen.splice(0,e);return this.viewPort=this.viewPort.concat(t),t},e.prototype.moveToReadByIndex=function(e){var t=this.unseen.splice(e,1);return this.viewPort=this.viewPort.concat(t),t},e.prototype.addConversationToMap=function(e,t){if(void 0===t&&(t=!1),!e||!e.lastMessage.originalarrivaltime)return null;var n=new p.default(e);return n.isGroup&&this.isLeftGroupConversation(n)?null:(n.subscribe("isUnread",this.conversationUnreadHandler.bind(this,n)),this._shouldRegisterAsUnread(n)&&this.conversationUnreadHandler(n),this.allConversationsMap[e.id]=n,t?this.viewPort.length>0?this.viewPort.splice(0,0,n):this.unseen.splice(0,0,n):this.unseen=this.unseen.concat(n),n)},e.prototype.processRecentConversations=function(e){var t=this;e&&e.length&&(e.forEach(function(e){e.lastMessage&&(e.properties.conversationblocked&&"true"===e.properties.conversationblocked.toLocaleLowerCase()||t.allConversationsMap[e.id]||t.addConversationToMap(e))}),this.unseen.sort(function(e,t){return t.lastMessage.originalarrivaltime>e.lastMessage.originalarrivaltime?1:-1}))},e.prototype.resolveUnreadConversationsCount=function(){this.unreadConversationsCountPromise.status===o.PromiseStatus.Pending&&(this.unreadConversationsCountPromise.resolve(this.unreadConversations.length),this.unreadConversationsPromise.resolve(this.unreadConversations),c.swc.API.triggerEvent(i.ApiEvents.UnreadConversationsUpdate,this.unreadConversations.length))},e.prototype.conversationUnreadHandler=function(e){for(var t=-1,n=0;n<this.unreadConversations.length;n++){this.unreadConversations[n].id===e.id&&(t=n)}this._shouldRegisterAsUnread(e)&&-1===t?this.unreadConversations.pushObservable(e):!e.isUnread&&t>-1&&this.unreadConversations.spliceObservable(t,1),this.unreadConversationsCountPromise.status!==o.PromiseStatus.Pending&&c.swc.API.triggerEvent(i.ApiEvents.UnreadConversationsUpdate,this.unreadConversations.length)},e.prototype.getUnreadConversationsCount=function(){return this.unreadConversationsCountPromise.promise},e.prototype.getUnreadConversations=function(){return this.unreadConversationsPromise.promise},e.prototype.subscribeUpdates=function(e){return this.externalResourceCallback=e,d.default.isZombie=!this.externalResourceCallback,this.updatesSubscriptionPromise?this.updatesSubscriptionPromise:(d.default.webApi.subscribeResource("ConversationUpdate",this.boundConversationUpdate),this.updatesSubscriptionPromise=d.default.webApi.subscribeResource("NewMessage",this.boundNewMessageUpdate),this.updatesSubscriptionPromise)},e.prototype.unsubscribeUpdates=function(){return this.externalResourceCallback=null,d.default.webApi.unsubscribeResource("NewMessage")},e.prototype.newMessageHandler=function(e,t){if(!this.isIgnoredType(t.messagetype)&&(r.default.get.backend!==s.MessagingBackend.TEAMS||"chat"===t.threadtype)){var n=this.allConversationsMap[e];if(n){for(var i=-1,o=0;o<this.unseen.length;o++)if(this.unseen[o].id===n.id){i=o;break}i>-1&&this.viewPort.length>0?this.moveToReadByIndex(i):0===this.viewPort.length&&(this.unseen.splice(i,1),this.unseen.splice(0,0,n)),n.updateFromMessage(t)}else{var a={id:e,targetLink:new URL(t.conversationLink),properties:{consumptionhorizon:"",picture:"",lastimreceivedtime:""},version:parseInt(t.version,10),lastMessage:t};n=this.addConversationToMap(a,!0),d.default.webApi.fetchConversation(e).then(this.conversationPropertiesHandler.bind(this)),n.isGroup&&d.default.webApi.fetchThread(e).then(this.threadPropertiesHandler.bind(this))}this.externalResourceCallback&&this.externalResourceCallback(e,n)}},e.prototype.conversationPropertiesHandler=function(e){this.allConversationsMap[e.id].update(e)},e.prototype.threadPropertiesHandler=function(e){this.allConversationsMap[e.id].updateThread(e)},e.prototype.conversationUpdateHandler=function(e,t){var n=this.allConversationsMap[e];n&&n.update(t)},e.prototype.isIgnoredType=function(e){return"Control/ClearTyping"===e||"Control/Typing"===e},e.prototype.getConversation=function(e){return this.allConversationsMap[e]},e.prototype.reset=function(){this.fetchPagePromise&&this.fetchPagePromise.cancelQuitely(),this.fetchPagePromise=null,this.unreadConversationsCountPromise.cancelQuitely(),this.unreadConversationsPromise.cancelQuitely(),this.unseen.forEach(function(e){return e.dispose()}),this.unseen=[],this.viewPort.forEach(function(e){return e.dispose()}),this.viewPort=[],this.allConversationsMap={},this._lastRequestedRecentsNumber=0},e}();t.RecentsManager=_;var v=null;t.recents=function(){return v||(v=new _),v}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.lastReadMessageTimestamp=-1,this.modificationTime=-1,this.lastReadMessageId="",this.value="",e&&this.set(e)}return e.prototype.set=function(e){if(e){var t=e.split(";");this.lastReadMessageTimestamp=Number(t[0]),this.modificationTime=Number(t[1]),this.lastReadMessageId=t[2],this.value=e}},e}();t.ConsumptionHorizon=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(281),a={retryCount:3,timeout:12e4,policy:""},s=function(e,t,n,o){var s;return s=o?o+t:i.default.CONTACTS_HOST_URL+t,r.default("contacts-"+e,a,s,n)};t.get=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",s(e,t,i).then(function(e){return e.json()})})},t.getRaw=function(e,t,n){return o.getHeaders().then(function(i){n&&Object.getOwnPropertyNames(n).forEach(function(e){i.append(e,n[e])});var r={method:"GET"};return r.headers=i,r.cache="no-cache",s(e,t,r)})},t.post=function(e,t,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var o={method:"POST"};return o.body=n,o.headers=r,s(e,t,o,i)})},t.put=function(e,t,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"PUT"};return r.body=n,r.headers=i,s(e,t,r)})},t.deleteMethod=function(e,t){return o.getHeaders().then(function(n){var i={method:"DELETE"};return i.headers=n,s(e,t,i)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),r=n(10),o=n(11),a=n(3),s=function(){function e(){var e=this;this._rawContacts=[],this._rawContactIds={},this.fetchMyContacts=function(t,n){if(e._fetchContactsPromise)return e._fetchContactsPromise.promise;var s=a.default.webApi.fetchRecentConversations().then(function(t){var n=t;if(!n)return o.default.throwError(r.ErrorCodes.ERR_FETCH_CONTACTS_TEAMS,"Unable to fetch contacts"),{};if(!n.users)return{contacts:[],count:0,scope:"",duration:0};var i=a.default.mePerson;return n.users.forEach(function(t){if(t.mri===i.mri)return i.displayName=t.displayName,void(i.email=t.userPrincipalName);e._rawContacts.push({id:t.mri,person_id:t.mri,type:t.type,display_name:t.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",name:{first:t.givenName,surname:t.surname,nickname:"",company:""},mri:t.mri,email:t.userPrincipalName,objectId:t.objectId}),e._rawContactIds[t.mri]=!0}),{contacts:e._rawContacts,count:n.users.length,scope:"",duration:0}},function(t){e._fetchContactsPromise=null,o.default.throwError(r.ErrorCodes.ERR_FETCH_CONTACTS_TEAMS,"Unable to fetch contacts",t)});return e._fetchContactsPromise=new i.CancelablePromise(s),e._fetchContactsPromise.promise},this.getContact=function(t,n){var i=e._rawContacts.filter(function(e){return e.mri.indexOf(n)>-1});return Promise.resolve(i.length?i[0]:void 0)},this.addContact=function(t,n,i){return i&&!e._rawContactIds[i.mri]&&e._rawContacts.push(i),Promise.resolve()},this.blockContact=function(e,t,n){return Promise.resolve()},this.unblockContact=function(e){return Promise.resolve()},this.dispose=function(){},this.getContactByObjectId=function(t){var n;return e._rawContacts.some(function(e){return t===e.objectId&&(n=e,!0)}),n?Promise.resolve(n):e.fetchContactById(t)}}return e.prototype.getContactByMri=function(e){var t=this._rawContacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._rawContacts},enumerable:!0,configurable:!0}),e.prototype.getBlockedList=function(){return Promise.resolve([])},e.prototype.getContactByMriIfPresent=function(e){return""},e.prototype.fetchContactById=function(t){var n=this;return a.default.stratusService.fetchShortProfile([t]).then(function(t){return e.createContactFromShortProfile(t[0])}).then(function(e){return n.addContact(e.mri,"",e),e})},e.createContactFromShortProfile=function(e){return{id:e.mri,person_id:e.mri,type:e.type,display_name:e.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",mri:e.mri,email:e.email,objectId:e.objectId}},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=n(17),s=n(29),c=n(35),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.searchSkypeDirectory=function(e){return this._searchPromise&&this._searchPromise.status===a.PromiseStatus.Pending&&(this._searchPromise.cancel(),this._searchPromise=null),this._searchKey=e,this._searchPromise=new a.CancelablePromise(this.getServices().skypeGraphService.fetchProfiles(e)),this._searchPromise.promise},t.prototype.searchInContacts=function(e){var t=this,n=e?c.default.normalizeString(e.toLowerCase()):"",i=function(e){return e&&e.contacts?e.contacts.filter(function(e){var t=c.default.normalizeString(e.name).toLowerCase(),i=e.skypeid.toLowerCase();return t.indexOf(n)>-1||i.indexOf(n)>-1}):[]};return this.getServices().signInManager.onceSignedIn().then(function(){return t.getServices().contactsManager.fetchMyContacts().then(i,function(e){return[]})})},t.prototype.searchAgents=function(e){var t=this;return new Promise(function(n,i){return t.getServices().agentsService.searchAgents(e).then(function(e){if(e&&e.agentDescriptions){var t=e.agentDescriptions.map(function(e){return{skypeid:"28:"+e.agentId,name:e.displayName,avatar:e.userTileSmallUrl||e.userTileStaticUrl||"",type:s.ContactType.Agent}});n(t)}else n([])})})},t}(o.default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(18),s=n(52),c=n(11),l=n(14),u=n(43),d=n(3),p=n(10),h="guest:",f=function(e){function t(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var r=e.call(this)||this;r._id=t,r._displayName="",r._isAgent=!1,r._isGuest=!1,r._isPstn=!1,r._isBlocked=!1,r._avatarData="",r._email="",r._setAvatarDataIfValidUrl=function(e,t){s.default.loadAvatarUri(e,function(e){r.avatarData=e},t)},r.getPersonData=function(){if(r.displayName&&r.avatarData&&r._isFilled)return Promise.resolve();if(r._isFilled=!0,r.isAgent||r.isPstn)return Promise.resolve();if(r._ongoingStratusRequest)return r._ongoingStratusRequest;var e=function(e){c.default.throwError(p.ErrorCodes.ERR_RESOLVE_USER_DETAILS,"Unable to resolve user details",e)};if(r._isMePerson){r._ongoingStratusRequest=d.default.stratusService.fetchMeProperties().then(function(e){if(e){var t=e.firstname||"";t+=e.lastname?" "+e.lastname:"",r.displayName=t||r.displayName;var n=e.avatarUrl||e.avatarData;r._setAvatarDataIfValidUrl(n)}},e)}else{if(!r.shouldFetchProfile())return Promise.resolve();r._ongoingStratusRequest=d.default.stratusService.fetchPerson(r._id).then(function(e){var t=(e=e||[]).filter(function(e){return e.username===r._id||e.username===r._mri})[0];if(t){var n=t.displayname?t.displayname:"",i=t.username?t.username:"",o=n||i;o&&(r.displayName=o),r._id===r._mri&&(r._mri=(r.isAgent?"28:":"8:")+r._id),t.avatarUrl&&r._setAvatarDataIfValidUrl(t.avatarUrl,function(){}),t.avatarData&&(r.avatarData=t.avatarData)}else c.default.throwError(p.ErrorCodes.ERR_RESOLVE_USER_DETAILS,"Unable to resolve user details")},e)}return r._ongoingStratusRequest},r.getDataFromContactsService=function(){return r._ongoingContactsRequest?r._ongoingContactsRequest:r.isPstn?Promise.resolve():(r._ongoingContactsRequest=d.default.signInManager.getSkypeToken().then(function(){var e=d.default.signInManager.currentUserName;return e.indexOf("guest")>-1||r.isGuest||r._isMePerson?r._fetchDisplayNameAndAvatar():d.default.contactsService.getContact(e,r._mri).then(function(e){if(e){var t=e.avatar,n=e.display_name;return t||(t=e.profile?e.profile.avatar_url:""),n&&(r.displayName=n),t?r._setAvatarDataIfValidUrl(t):r._fetchDisplayNameAndAvatar(),r._ongoingContactsRequest=null,""}return r._ongoingContactsRequest=null,r._fetchDisplayNameAndAvatar()},function(){return r._ongoingContactsRequest=null,r._fetchDisplayNameAndAvatar()})},function(){return r._ongoingContactsRequest=null}),r._ongoingContactsRequest)},r._mri=r._id,r._mri.indexOf("https://");var o=u.default.normalizePersonId(r._id);return o!==r._id&&(r._id=o),r._isAgent=n||r._mri.indexOf("28:")>-1,r._isGuest=r._id.indexOf(h)>-1,r._isPstn=r._mri.indexOf("4:")>-1,d.default.contactsService.getBlockedList().then(function(e){if(e){var t=r._mri;r.isBlocked=e.filter(function(e){return e.mri===t}).length>0}}),r._description="",r._isMePerson=r._id===d.default.signInManager.currentUserName||u.default.normalizePersonId(r._id)===d.default.signInManager.currentUserName,i&&r.fetchDisplayNameAndAvatar(),r}return r(t,e),Object.defineProperty(t.prototype,"isAgent",{get:function(){return this._isAgent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPstn",{get:function(){return this._isPstn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",this._isBlocked))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGuest",{get:function(){return this._isGuest},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mri",{get:function(){return this._mri},set:function(e){this._mri=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName},set:function(e){e&&e!==this._displayName&&(this._displayName=l.default.parseTopic(e),this.publish("displayName",this._displayName))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this._description},set:function(e){e!==this._description&&(this._description=e,this.publish("description",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatarData",{get:function(){return this._avatarData},set:function(e){e!==this._avatarData&&(this._avatarData=e,this.publish("avatarData",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extraLargeAvatarUrl",{get:function(){return this.extraLargeAvatarUrl},set:function(e){e!==this._extraLargeAvatarUrl&&(this._extraLargeAvatarUrl=e,this.publish("extraLargeAvatarUrl",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"email",{get:function(){return this._email},set:function(e){e!==this._email&&(this._email=e,this.publish("email",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presenceStatus",{get:function(){return this._presenceStatus},set:function(e){this._presenceStatus!==e&&(this._presenceStatus=e,this.publish("presenceStatus",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFilled",{get:function(){return this._isFilled},enumerable:!0,configurable:!0}),t.prototype.fetchDisplayNameAndAvatar=function(){return this.isFilled?Promise.resolve():this.getDataFromContactsService()},t.prototype._fetchDisplayNameAndAvatar=function(){var e=this;return this._isFilled=!0,this.isAgent?d.default.agentsService.getAgentDetails(this._id).then(function(t){if(t&&t.agentDescriptions&&1===t.agentDescriptions.length){var n=t.agentDescriptions[0].displayName;e._description=t.agentDescriptions[0].description,e._setAvatarDataIfValidUrl(t.agentDescriptions[0].userTileExtraLargeUrl),n&&(e.displayName=n)}return e._displayName}):this.getPersonData().then(function(){return e.displayName})},t.prototype.shouldFetchProfile=function(){return this._mri.indexOf("8:")>-1&&(!o.default.get.isTeams()||o.default.get.isTeams()&&!this._displayName)},t}(a.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(11),a=n(307),s=function(){function e(){var e=this;this._pesManager=null,this._isLoading=!1,this._setLoadingFinished=function(){e._isLoading=!1},this.canRenderConfigItems=function(){return e._pesManager.canRenderConfigItems()},this.getConfiguration=function(){return new Promise(function(t,n){e.config?t(e.config):e.init().then(function(n){t(e.config)})})},this._pesManager=new a.default}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isLoading||this._pesManager.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._pesManager.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return this._pesManager.emoticonMap},enumerable:!0,configurable:!0}),e.prototype.initSkype=function(){var e=this;return this.getConfigurationPromise?this.getConfigurationPromise:(this._isLoading=!0,this.getConfigurationPromise=new Promise(function(t,n){i.default.instance.MePersonManager.fetch().then(function(n){e._pesManager.isInitialized||e._pesManager.init(n.id).then(function(n){e.config=n,e._setLoadingFinished(),t(e.config)},e._setLoadingFinished)},function(t){e._setLoadingFinished(),n(t),o.default.throwError(r.ErrorCodes.ERR_FETCH_ME_PERSON_AND_LOAD_PES,"Unable to fetch me person and load PES",t)})}),this.getConfigurationPromise)},e.prototype.init=function(){return this.initSkype()},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={version:"1.0.0.0",urls:["https://config.edge.skype.com"]};!function(e){e.Skype="Skype",e.SWC="SkypeWebControl"}(t.EcsClient||(t.EcsClient={})),function(e){e.Prod="Prod",e.Int="INT",e.Dogfood="DF",e.PPE="PPE"}(t.Environment||(t.Environment={})),t.configLoader=function(e,t,n){return new Promise(function(a,s){var c=o(e,i.version,t),l=0,u=function(){if(l<c.length){n&&{Authorization:n};var t=c[l++];r(e,t).then(function(e){return e?a(e):u()}).catch(function(e){return u()})}else{s("Unable to fetch config from ECS - "+e)}};u()})};var r=function(e,t){return new Promise(function(n,i){var r=encodeURIComponent("jsonSwcEcsFetch"+e+Date.now()),o=document.querySelector("body"),a=document.createElement("script"),s=-1===t.indexOf("?")?"?":"&";a.src=""+t+s+"callback="+r;var c=function(){delete window[r],o.removeChild(a)};window[r]=function(e){clearTimeout(l),c(),n(e)};var l=setTimeout(function(){c(),i("ECS timed out")},1e4);o.appendChild(a)})},o=function(e,t,n){var r,o,a=[],s=(r=n,o=[],Object.keys(r).forEach(function(e){o.push(encodeURIComponent(e)+"="+encodeURIComponent(r[e]))}),o.join("&"));return i.urls.forEach(function(n){a.push(n+"/config/v1/"+e+"/"+t+(s?"?"+s:""))}),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SMALL="small",e.LARGE="large",e.EXTRA_LARGE="extraLarge",e.SUPER_LARGE="superLarge"}(t.ITEM_SIZES||(t.ITEM_SIZES={})),t.STATIC_MEDIA_INFO={firstFrame:0,framesCount:1,fps:1},function(e){e.camel="drawState",e.dash="draw-state"}(t.DRAW||(t.DRAW={}))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(44),a=n(73),s=n(11),c=n(5),l=n(36),u=n(8),d=n(10),p=function(e){function t(t){var n=e.call(this,"kpi_message_sent",t)||this;return n.index=0,n}return r(t,e),t.prototype.getSharedCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);t.push(c.TelemetryPropertyValue.Create("timeSent",this.timeToSend)),t.push(c.TelemetryPropertyValue.Create("status",this.status||u.NA)),t.push(c.TelemetryPropertyValue.Create("errorCode",this.errorCode||u.NA)),t.push(c.TelemetryPropertyValue.Create("errorMessage",this.errorMessage||u.NA)),t.push(c.TelemetryPropertyValue.Create("messageLength",this.messageLength||0)),t.push(c.TelemetryPropertyValue.Create("messageType",this.getMessageType())),t.push(c.TelemetryPropertyValue.Create("index",this.index+"")),t.push(c.TelemetryPropertyValue.Create("isContact",this.isContact||u.NA));var n=u.NA;switch(this.origin){case o.ActionTrigger.BUTTON_SEND_CLICK:n="button";break;case o.ActionTrigger.KEYPRESS_ENTER:n="enter";break;case o.ActionTrigger.WELCOME_MESSAGE:n="welcome";break;case o.ActionTrigger.ADDON:n="addon";break;default:n=this.origin?this.origin+"":u.NA}return t.push(c.TelemetryPropertyValue.Create("origin",n)),t},t.prototype.getCustomProperties=function(){return this.getSharedCustomProperties()},t.prototype.getMessageType=function(){switch(this.messageType){case a.MessageType.TEXT:return"text";case a.MessageType.IMAGE:return"image";case a.MessageType.FILE:return"file";case a.MessageType.SWIFT:return"swift";case a.MessageType.EMOTICON:return"emoticon";case a.MessageType.QUICK_REPLY:return"quick reply";case a.MessageType.UNDETERMINED:return u.NA;default:s.default.throwError(d.ErrorCodes.ERR_UNKNOWN_MESSAGE_TYPE,"Unknown Message type:"+this.messageType)}return u.NA},t}(l.ConversationDataEvent);t.MessageSentEvent=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(36),s=n(8),c=function(e){function t(t){var n=e.call(this,"kpi_message_received",t)||this;return n.messageType=s.NA,n}return r(t,e),t.prototype.getCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);return t.push(o.TelemetryPropertyValue.Create("messageType",this.messageType)),t},t}(a.ConversationDataEvent);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20);t.NOTICE_CONTENT_TYPE={GENERIC:"application/vnd.microsoft.notice",USER:"application/vnd.microsoft.notice.avatar"};var r=function(){return function(e,t){this.id=e.campaignGuid||e.campaignId||i.guid.generate(),this.type=t,this.language=e.language,this.clientVersion=e.clientVersion,this.platformList=e.platformList,this.userTagging=e.userTagging,this.validUntilTimestamp=e.validUntilTimestamp?new Date(e.validUntilTimestamp):null,this.experimentName=e.experimentName,this.contentCategory=e.contentCategory,this.telemetry=e.telemetry}}();t.default=r},function(e,t){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}}),[Element.prototype,CharacterData.prototype].forEach(function(e){e.hasOwnProperty("nextElementSibling")||Object.defineProperty(e,"nextElementSibling",{configurable:!0,enumerable:!0,get:function(){for(var e=this;e=e.nextSibling;)if(1===e.nodeType)return e;return null},set:void 0})})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(155))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Skype="skype",e.Aad="aad"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){var e=this;this.getDataPart=function(e){var t=e.substring(e.indexOf(".")+1);return t.substring(0,t.indexOf("."))},this.retrieveMeName=function(t){return t&&e.getTokenData(t).skypeid||""},this.getTokenData=function(t){return JSON.parse(atob(e.getDataPart(t)))}}}();t.default=i},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e){e.exports={area_text_insertText:"Type to chat...",search:"Search",search_no_results_found:"No results found",search_results:"{resultscount} RESULTS","_search_results.comment":'{Locked="{resultscount}"}',clear_search_text:"Clear",text_bots:"Bots","_text_bots.comment":"Header for search in bots directory",text_people:"People","_text_people.comment":"Header for search in contacts directory",text_favorites_contacts:"Favorites","_text_favorites_contacts.comment":"Header for Favorites contacts in contact list",text_contacts:"Contacts","_text_contacts.comment":"Header for Contact from Contacts list",text_chats:"Chats",text_all:"All",new_chat_header:"New Chat",new_chat_enter_group_name:"Enter group name...",new_chat_header_select_who_to_chat_with:"SELECT WHO YOU WOULD LIKE TO CHAT WITH",new_chat_header_to:"To:",new_chat_button_confirm_selection:"Done",new_chat_button_remove_selection:"Remove",new_chat_text_start_chat_with:"Start chat with {participant}","_new_chat_text_start_chat_with.comment":'{Locked="{participant}"}',right_now:"Right now",time_minutes_ago:"{minutes} min ago",emoticon_picker_open:"Open Emoticon picker",emoticon_picker_close:"Close Emoticon picker","_area_text_insertText.comment":"Placeholder text in chat input field",area_text_disabled:"Currently unable to chat.","_area_text_disabled.comment":"Text displayed to user in chat input field in case chatting is not possible",action_button_send:"Send","_action_button_send.comment":"? Tooltip for Send (message) button",joinedConversation:"{participant} joined this conversation","_joinedConversation.comment":'System notification in chat {Locked="{participant}"}',unread_messages:"Unread messages","_unread_messages.comment":"System notification in chat about unread messages",wasAdded:"{participant} added {contact} to this conversation","_wasAdded.comment":'System notification in chat {Locked="{participant}"} {Locked="{contact}"}',hasLeftConversation:"{participant} has left this conversation","_hasLeftConversation.comment":'System notification in chat {Locked="{participant}"}  ',wasRemoved:"{participant} has removed {removedParticipant} from this conversation","_wasRemoved.comment":'System notification in chat  {Locked="{participant}"} {Locked="{removedParticipant}"} ',historyClosed:"{participant} has made the chat history visible to everyone","_historyClosed.comment":'System notification in chat {Locked="{participant}"} ',historyDisclosed:"{participant} has hidden the conversation history from new participants","_historyDisclosed.comment":'System notification in chat {Locked="{participant}"} ',joiningEnabled:"{participant} enabled joining this conversation","_joiningEnabled.comment":'System notification in chat {Locked="{participant}"} ',joiningDisabled:"{participant} disabled joining this conversation","_joiningDisabled.comment":'System notification in chat {Locked="{participant}"} ',threadPictureUpdated:"{participant} has changed the conversation picture","_threadPictureUpdated.comment":'System notification in chat {Locked="{participant}"} ',roleUpdated:"{who} updated {whom}'s role to {role}","_roleUpdated.comment":'System notification in chat {Locked="{who}"}{Locked="{whom}"} {Locked="{role}"}  ',topicUpdated:"{participant} has changed the conversation topic to '{topic}'","_topicUpdated.comment":'System notification in chat {Locked="{participant}"} {Locked="{topic}"}',chatBlocked:"Conversation is blocked","_chatBlocked.comment":"System notification in chat",waitingForReply:"You need to wait for {user_name}'s reply to continue chatting.","_waitingForReply.comment":'System notification in chat {Locked="{user_name}"}',ms_service_privacy_agreement:"By chatting below, you agree to the {0}Microsoft services agreement{1} and {2}privacy statement{3}.","_ms_service_privacy_agreement.comment":'terms of use text {Locked="{0}"} {Locked="{1}"} {Locked="{2}"} {Locked="{3}"}',s_title:"Sent you a message","_s_title.comment":"String used for Swift card title in case the card does not have its own",s_card:"Card","_s_card.comment":"Swift card",s_cards:"Cards","_s_cards.comment":"Swift cards",s_vat:"VAT","_s_vat.comment":"VAT in swift cards",s_tax:"Tax","_s_tax.comment":"Tax in swift cards",s_totalPrice:"Total","_s_totalPrice.comment":"Total price in swift cards",s_unsupported:"This card is currently not supported on this version of Skype.","_s_unsupported.comment":"Text displayed when using old version of Skype",s_unsupported_button:"Next","_s_unsupported_button.comment":"Button text displayed when user is using old version of Skype",s_learnMore:"Learn more","_s_learnMore.comment":"Text of the card title displayed when card is unsupported",s_showImageTitle:"Enlarge image","_s_showImageTitle.comment":"Some of pictures in swift cards can be enlarged upon clicking on them. This is a tooltip text for such pictures.",s_signInTitle:"Connect","_s_signInTitle.comment":"Text of the card title displayed for Sign in cards",s_prevCard:"Show previous","_s_prevCard.comment":"Button tooltip for showing previous card in Carousel cards",s_nextCard:"Show next","_s_nextCard.comment":"Button tooltip for showing next card in Carousel cards",s_showAll:"Show all","_s_showAll.comment":"Button text for showing all cards",s_showLess:"Show less","_s_showLess.comment":"Button text for showing less cards",mediaPlayer_play:"Play","_mediaPlayer_play.comment":"Play button in swift media",mediaPlayer_pause:"Pause","_mediaPlayer_pause.comment":"Pause button in swift media",videoPlayer_fullscreen:"Fullscreen","_videoPlayer_fullscreen.comment":"Tooltip on the button to switch to Fullscreen mode on swift card video player",videoPlayer_exitFullscreen:"Exit fullscreen","_videoPlayer_ExitFullscreen.comment":"Tooltip on the button to exit Fullscreen mode on swift card video player",videoPlayer_button_mute:"Mute","_videoPlayer_button_mute.comment":"Tooltip on the button to mute on swift card video player",videoPlayer_button_unmute:"Unmute","_videoPlayer_button_unmute.comment":"Tooltip on the button to unmute on swift card video player",videoPlayer_button_turnOnVideo:"Turn on video","_videoPlayer_button_turnOnVideo.comment":"Tooltip on the video button displayed when my video is off during call",videoPlayer_button_turnOffVideo:"Turn off video","_videoPlayer_button_turnOffVideo.comment":"Tooltip on the video button displayed when my video is on during call",videoPlayer_button_turnOnIncomingVideo:"Turn on incoming video","_videoPlayer_button_turnOnIncomingVideo.comment":"Tooltip on the incoming video button displayed when incoming video is off during call",videoPlayer_button_turnOffIncomingVideo:"Turn off incoming video","_videoPlayer_button_turnOffIncomingVideo.comment":"Tooltip on the incoming video button displayed when incoming video is on during call",videoPlayer_button_endCall:"End call","_videoPlayer_button_endCall.comment":"Tooltip on the end call button during call",videoPlayer_button_startScreenSharing:"Share screen","_videoPlayer_button_startScreenSharing.comment":"(Action) Tooltip on the screen sharing button displayed when screen sharing is off during call",videoPlayer_button_stopScreenSharing:"Stop sharing","_videoPlayer_button_stopScreenSharing.comment":"Tooltip on the screen sharing button displayed when screen sharing is on during call",calling_button_toggleChat:"Toggle chat","_calling_button_toggleChat.comment":"Tooltip on the chat button during call",calling_button_dock:"Dock","_calling_button_dock.comment":"Tooltip on the dock button during call",calling_button_fullscreen:"Fullscreen","_calling_button_fullscreen.comment":"Tooltip on the fullscreen button during call",calling_button_settings:"Settings","_calling_button_settings.comment":"Tooltip on the settings button during call",calling_button_acceptWithAudio:"Accept with audio","_calling_button_acceptWithAudio.comment":"Tooltip on the accept button for incoming call",calling_button_acceptWithVideo:"Accept with video","_calling_button_acceptWithVideo.comment":"Tooltip on the accept button for incoming call",calling_button_reject:"Reject","_calling_button_reject.comment":"Tooltip on the reject button for incoming call",calling_settings_devices:"Devices","_calling_settings_devices.comment":"Title for calling devices settings",calling_settings_cameras:"Cameras","_calling_settings_cameras.comment":"Title for calling cameras select",calling_settings_microphones:"Microphones","_calling_settings_microphones.comment":"Title for calling microphones select",calling_settings_speakers:"Speakers","_calling_settings_speakers.comment":"Title for calling speakers select",calling_participants_close:"Close","_calling_participants_close.comment":"Title for call participants list closing button  (action)",calling_button_startAudio:"Start audio call","_calling_button_startAudio.comment":"Title for start call button (action)",calling_button_startVideo:"Start video call","_calling_button_startVideo.comment":"Title for start call button  (action)",calling_rate_request:"How would you rate the quality of this call?","_calling_rate_request.comment":"Question on call rate screen",accessibility_swift_action_prefix:"Click to {swiftAction}","_accessibility_swift_action_prefix.comment":'Tooltip on the button to unmute on swift card video player {Locked="{swiftAction}"}',header_termsOfUse:"Terms of use","_header_termsOfUse.comment":"Link to Terms of use",header_privacyPolicy:"Privacy policy","_header_privacyPolicy.comment":"Link to Privacy policy",m_unsupported:"This message type is currently not supported. Go to http://web.skype.com for full experience","_m_unsupported.comment":'Text displayed in chat when receiving unsupported message {Locked="http://web.skype.com"}',builder_botId:"Bot ID","_builder_botId.comment":"Bot ID text on Builder page",builder_buttonStyle:"Button style","_builder_buttonStyle.comment":"Button style text on Builder page",builder_buttonImage:"Button image","_builder_buttonImage.comment":"Button image text on Builder page",builder_buttonLabel:"Button label","_builder_buttonLabel.comment":"Button label text on Builder page",builder_colors:"Colors","_builder_colors.comment":"Colors text on Builder page",builder_message:"Message","_builder_message.comment":"Message text on Builder page",builder_theme:"Theme","_builder_theme.comment":"Theme text on Builder page",builder_code:"Code","_builder_code.comment":"Code word on Builder page",builder_copy:"Copy","_builder_copy.comment":"Copy word on the copy button on Builder page",builder_light:"Light","_builder_light.comment":"Light word on the copy button on Builder page",builder_dark:"Dark","_builder_dark.comment":"Dark word on the copy button on Builder page",sending:"Sending","_sending.comment":"Displayed while sending a message to SWC",failed:"Failed","_failed.comment":"Displayed when a message delivery failed",sign_in_welcome:"Please sign in to start chatting","_sign_in_welcome.comment":"Message in chatlog prompting user to sign in when in chat with 1:1",sign_in:"Sign in","_sign_in.comment":"Text on Button when in chat with 1:1",sign_in_cancel:"Cancel","_sign_in_cancel.comment":"Link in chat with 1:1",send_message:"Send message","_send_message.comment":"aria label for send (message) button",send_file:"Send file","_send_file.comment":"aria label for send (file) button",close_window:"Close window","_close_window.comment":"aria label for button which closes window",say_hi_to_a_bot:"Say hi to a bot",hi:"hi","_hi.comment":"message 'hi' sent to bot","_say_hi_to_a_bot.comment":"aria label for the button which when clicked submits say hi message",sign_in_to_save_your_chat:"Sign in to save your chat","_sign_in_to_save_your_chat.comment":"aria label for the button which when clicked submits say hi message",click_here_to_switch_accounts_aria_label:"Click here to switch accounts","_click_here_to_switch_accounts_aria_label.comment":"aria label for the button which when clicked switches accounts",you_cannot_sign_in_when_guest_only_mode_enabled:"You cannot sign in when guest only mode enabled","_you_cannot_sign_in_when_guest_only_mode_enabled.comment":"aria label displayed in guest only mode",say_hi:"Say 'hi'","_say_hi.comment":"Text displayed in chat.",or_text:" or ","_or_text.comment":"Part of Welcome message displayed in chat. The spaces at the beginning and at the end is necessary",sign_in_text:"sign in","_sign_in_text.comment":"Part of Welcome message displayed in chat.",to_save_your_chat:" to save your chat.","_to_save_your_chat.comment":"Part of Welcome message displayed in chat. The space before sentence is necessary",welcome_back:"Welcome back, {displayName}","_welcome_back.comment":'Text which appears in chat after user logs in {Locked="{displayName}"}',welcome_back_text:"Welcome back, ","_welcome_back_text.comment":"Text which appears in chat after user logs in. the space at the end is necessary",click_here_to_switch_account:"{0}Click here{1} to switch accounts","_click_here_to_switch_account.comment":'Text which appears after clicking on username in chat {Locked="{0}"} {Locked="{1}"}',click_here_text:"Click here","_click_here_text.comment":"Text which appears after clicking on username in chat",to_switch_accounts:" to switch accounts.","_to_switch_accounts.comment":"Text which appears after clicking on username in chat. Space at the beginning is necessary.",they_are_speaking:"They are speaking {theirLanguage}","_they_are_speaking.comment":'For example: They are speaking English {Locked="{theirLanguage}"}',you_are_speaking:"You are speaking {myLanguage}","_you_are_speaking.comment":'For example: You are speaking French {Locked="{myLanguage}"}',typingIndicator:"{typingMessage} is responding...","_typingIndicator.comment":'Message displayed after you submit a message to bot. For example: Swift bot is responding... {Locked="{typingMessage}"}',typingIndicatorHuman:"{typingMessage} is typing...","_typingIndicatorHuman.comment":'Message displayed when somebody is writing a message to a chat. For example: Anna is typing... {Locked="{typingMessage}"}',typingIndicatorOnLoad:"Loading...","_typingIndicatorOnLoad.comment":"Message displayed while conversation data is loading",recentlistChats:"Recent chats",recentlistChats_loading:"Loading chats...","_recentlistChats_loading.comment":"Chats loading label before list of chats is loaded",recentlist_new_conversation:"New Conversation",recentList_seeAllInSkype:"See All in Skype",recentList_welcome_heading:"Welcome to the new Skype",recentList_welcome_text_outlook:'Check it out by clicking the "{beforePlus}+{afterPlus}" at the top to start a new chat.',recentList_sorting_select_unread:"Unread","_recentList_sorting_select_unread.comment":"Recenlist select to filter unread items only",recentList_sorting_select_time:"Time","_recentList_sorting_select_time.comment":"Recenlist select to filter based on time",conversation_add_people_to_chat:"Add to group chat",button_add_participants:"Add",button_create_new_chat:"Create",conversation_remove_people_to_chat:"Chat participants",conversation_show_people_in_chat:"Participants","_conversation_show_people_in_chat.comment":"Title for view showing list of participants in conversation",callee_unavailable:"The person you're trying to call may not be available","_callee_unavailable.comment":"Text displayed to user when trying to call unavailable participant",calling_screen_calling:"CALLING...",calling_screen_incoming:"INCOMING CALL",calling_screen_onhold:"CALL ON HOLD...",message_text_ongoingCall:"Ongoing call","_message_text_ongoingCall.comment":"Message displayed to user on ongpoing call",message_text_startedCall:"Call",message_text_startedGroupCall:"Group call",message_text_endedCall:"Call ended",message_text_endedGroupCall:"Group call ended",message_text_missedCall:"Missed call",message_text_missedGroupCall:"Missed group call",message_text_noAnswerCall:"Call, no answer",message_text_noAnswerGroupCall:"Group call, no answer",message_text_hours:"h","_message_text_hours.comment":"Shortcut for hour",message_text_minutes:"m","message_text_minutes.comment":"Shortcut for minute",message_text_seconds:"s","message_text_seconds.comment":"Shortcut for second",message_text_photo:"photo","message_text_photo.comment":"Text displayed in message preview for image",message_text_you_have_left_the_conversation:"You have left the conversation",reactions_see_who_reacted_text:"See who reacted with emoticon {key}",reactions_you_text:"(you)",icon_text_message_was_edited:"This message has been edited",text_cancel_editing_message:"Cancel edit",deviceconsent_legend:"Click allow to give microphone and camera access.","_deviceconsent_legend.comment":"Text explaning the user how to grant access to microphone and camera.",roster_menu_item_create_group:"Create a group",roster_menu_delete_conversation:"Delete conversation",roster_menu_block_contact:"Block contact","_roster_menu_block_contact.comment":"Menu item in pop up to block current contact",roster_menu_unblock_contact:"Unblock contact","_roster_menu_unblock_contact.comment":"Menu item in pop up to unblock current contact",roster_menu_leave_conversation:"Leave conversation",roster_menu_report_a_problem:"Report a problem",roster_menu_get_help:"Get help",roster_menu_send_feedback:"Send feedback",confirm_dialog_delete_conversation_header:"Delete chat",confirm_dialog_delete_conversation_text:"Are you sure you want to delete this chat?",confirm_dialog_leave_conversation_header:"Leave chat",confirm_dialog_leave_conversation_text:"Are you sure you want to leave this chat?",confirm_dialog_delete_msg_header:"Remove message",confirm_dialog_edit_msg_header:"Edit message",confirm_dialog_delete_msg_text:"Are you sure you want to remove this message?",confirm_dialog_block_contact_header:"Block this contact?","_confirm_dialog_block_contact_header.comment":"Ask user if he wants to block current contact",confirm_dialog_block_report_abuse_checkbox:"Report abuse from this person","_confirm_dialog_block_report_abuse_checkbox.comment":"Ask user if he wants to report abuse from this person",confirm_dialog_block_select_abuse_reason:"Select a reason","_confirm_dialog_block_select_abuse_reason.comment":"Ask user to select abude resaon",confirm_dialog_report_abuse_spam_reason_text:"Spam","_confirm_dialog_report_abuse_spam_reason_text.comment":"Report spam as abuse reason",confirm_dialog_report_abuse_pornography_reason_text:"Contains nudity or pornography","_confirm_dialog_report_abuse_pornography_reason_text.comment":"The reason to report abuse is that content from contact contains nudity or pornography",confirm_dialog_report_abuse_child_exploitation_reason_text:"Child exploitation","_confirm_dialog_report_abuse_child_exploitation_reason_text.comment":"The reason to report abuse is child exploitation",confirm_dialog_report_abuse_harassment_reason_text:"Harassment or threats","_confirm_dialog_report_abuse_harassment_reason_text.comment":"he reason to report abuse is that content from contact contains harassment or threats",open_menu_dialog_text:"Open menu",btn_confirm_leave:"Leave",btn_confirm_deletion:"Delete",btn_confirm_removal:"Remove",btn_confirm_blocking:"Block","_btn_confirm_blocking.comment":"Text on the button to block contact",translator_active:"Translator: {0}active{1}","_translator_active.comment":'Message displayed when translator is active {Locked="{0}"} {Locked="{1}"}',scroll_to_bottom:"Scroll to bottom","_scroll_to_bottom.comment":"After user scrolls in chat to the top, a button appears with that text",crMessage:"Hi, I would like to add you to my contacts.","_cr_message.comment":"Message in chat",no_connection:"No connection","_no_connection.comment":"Message displayed in chat when there is no internet connection",message_failed:"Unable to send a message. Please try again later","_message_failed.comment":"Unable to send a message. Service currently is not available",polling_failed:"Service is currently unavailable","_polling_failed.comment":"Service currently is not available. Please try again later",notification_summary:"You have {count} unread conversation",notification_summary_few:"You have {count} unread conversation",notification_summary_few_comment:"Text of notification that appears right after user loggs in if he has unread conversations","_notification_summary.comment":'Text of notification that appears right after user loggs in if he has some unread conversations. {Locked="{count}"}',notification_summary_many:"You have {count} unread conversations","_notification_summary_many.comment":'Text of notification that appears right after user loggs in if he has some unread conversations {Locked="{count}"}',notification_reminder:"Unread chats: {name}","_notification_reminder.comment":'Text of notification when user has more than 2 new unread messages in a chat{Locked="{name}"}',notification_reminder_desc:"{count} unread chat","notification_reminder_desc.comment":'Text of the notification description when user has more than 2 new unread messages in a chat{Locked="{count}"}',notification_reminder_desc_many:"{count} unread chats","notification_reminder_desc_many.comment":'Text of notification when user has more than 2 new unread messages in few chats {Locked="{count}"}',separator:",","_separator.comment":"Separator between words",file_sent:"Sent a file","_file_sent.comment":"Message that showed in notification was a file was sent in conversation",pic_sent:"Sent a picture","_pic_sent.comment":"Message that showed in notification was a picture was sent in conversation",open:"Open","_open.comment":"Open something, for example a chat",open_client_descr:"Open Skype client","_open_client_descr.comment":"Description for Open Skype client button",accept:"Accept","_accept.comment":"Accept a call button",accept_descr:"Accept the call","_accept_descr.comment":"Description to Accept button",ignore:"Ignore","_ignore.comment":"Ignore text",ignore_descr:"Ignore the call","_ignore_descr.comment":"Description for Ignore call button",ignore_summary_notificaton_descr:"Ignore notifications from Skype client for some time","_ignore_summary_notificaton_descr.comment":"Description for Ignore notifications from Skype client button",ignore_reminder_notificaton_descr:"Ignore unread message reminder notification","_ignore_reminder_notificaton_descr.comment":"Description for Ignore current notifications from Skype client button",ignore_unread_notificaton_descr:"Ignore unread message notification","_ignore_unread_notificaton_descr.comment":"Description for Ignore current notifications from Skype client button",msn_signin_screen_title:"Skype on MSN","_msn_signin_screen_title.comment":"MSN sign-in screen - title",msn_signin_screen_contacts:"See who's online","_msn_signin_screen_contacts.comment":"MSN sign-in screen - contacts label",msn_signin_screen_recents:"Notifications and missed messages","_msn_signin_screen_recents.comment":"MSN sign-in screen - recent items label: missed calls, messages...",msn_signin_screen_calling_messaging:"Voice calls and chats","_msn_signin_screen_calling_messaging.comment":"MSN sign-in screen - messaging and calling label",msn_signin_screen_connect:"Start connecting your Skype","_msn_signin_screen_connect.comment":"MSN sign-in screen - connect skype title",msn_signin_screen_connect_description:"Connecting Skype with MSN requires a Microsoft account to get set up.","_msn_signin_screen_connect_description.comment":"MSN sign-in screen - connect description: what is needed to connect Skype",msn_signin_screen_sign_in_has_account:"Already have a Microsoft account?","_msn_signin_screen_sign_in_has_account.comment":"MSN sign-in screen - user already has an account label",msn_signin_screen_sign_in_button:"SIGN IN","_msn_signin_screen_sign_in_button.comment":"MSN sign-in screen - sign in button text",msn_signin_screen_sign_in_no_account:"Don't have a Microsoft account?","_msn_signin_screen_sign_in_no_account.comment":"MSN sign-in screen - user doesn't have an account yet label",msn_signin_screen_create_account_button:"CREATE NOW","_msn_signin_screen_create_account_button.comment":"MSN sign-in screen - create an account button text",date_monday:"Mon",date_tuesday:"Tue",date_wednesday:"Wed",date_thursday:"Thu",date_friday:"Fri",date_saturday:"Sat",date_sunday:"Sun",powered_by_skype:"Powered by Skype",do_not_have_account:"Do not have an account?","_do_not_have_account.comment":"Message showed on the login page for people who want to register.",sign_up:"Sign up!","_sign_up.comment":"Message shown for the action of signing up for a Skype account.",mark_all_conversations_as_read:"Mark all as read","_mark_all_conversations_as_read.comment":"Message displayed on button that marks all the conversations as read.",show_options:"Show options","_show_options.comment":"Message displayed on hover for action of displaying options",confirm_mark_all_as_read_header:"Mark all as read","_confirm_mark_all_as_read_header.comment":"Message for confirmation dialog header.",confirm_mark_all_as_read_text:"Are you sure you want to mark all conversations as read?","_confirm_mark_all_as_read_text.comment":"Confirmation message for marking all as read.",btn_confirm_marking_as_read:"Yes","_btn_confirm_marking_as_read.comment":"Message on marking button.",show_incoming_video_button:"Show incoming video","_show_incoming_video_button.comment":"Message on button that triggers the action of showing incoming videos.",hide_incoming_video_button:"Hide incoming video","_hide_incoming_video_button.comment":"Message on button that triggers the action of hiding incoming videos."}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(108),r=function(){function t(){}return t.prototype.load=function(t,n){var r=this,o=(new XMLHttpRequest,t+"/"+n+"/Strings.json");return new Promise(function(t,n){return e(o).then(function(e){return e.json().then(function(e){r._translations=e,i.default.merge(e),t()},n)})})},t}();t.default=new r}).call(this,n(61))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(11),o={af:"af",am:"am",ar:"ar",as:"as",az:"az",be:"be",bg:"bg",bn:"bn",bs:"bs",chr:"chr",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",eu:"eu",fa:"fa",fi:"fi",fil:"fil",fr:"fr",ga:"ga",gd:"gd",gl:"gl",gu:"gu",ha:"ha",he:"he",hi:"hi",hr:"hr",hu:"hu",hy:"hy",id:"id",ig:"ig",is:"is",it:"it",iw:"iw",ja:"ja",ka:"ka",kk:"kk",km:"km",kn:"kn",ko:"ko",kok:"kok",ku:"ku",ky:"ky",lb:"lb",lt:"lt",lv:"lv",mi:"mi",ml:"ml",mn:"mn",mr:"mr",ms:"ms",ne:"ne",nl:"nl",nn:"nn",nb:"nb",no:"no",nso:"nso",or:"or",pa:"pa",pl:"pl",prs:"prs",pt_br:"pt-br",pt_pt:"pt-pt",qps:"qps",qut:"qut",quz:"quz",ro:"ro",ru:"ru",rw:"rw",sd:"sd",si:"si",sl:"sl",sk:"sk",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",tg:"tg",th:"th",ti:"ti",tk:"tk",tn:"tn",tr_tr:"tr-tr",tt:"tt",ug:"ug",uk:"uk",ur:"ur",uz:"uz",vi:"vi",wo:"wo",xh:"xh",yo:"yo",zh:"zh",zu:"zu"},a={group0:{languages:[o.ja,o.id,o.ko,o.tr_tr,o.vi,o.zh,o.az,o.ig,o.fa,o.ka,o.km,o.kn,o.ms,o.prs,o.th,o.tt,o.ug,o.wo,o.yo]},group1:{languages:[o.bg,o.ca,o.cy,o.da,o.de,o.el,o.en,o.es,o.et,o.fi,o.he,o.hu,o.it,o.iw,o.nb,o.nl,o.no,o.pt_pt,o.qps,o.sv,o.af,o.as,o.bn,o.chr,o.eu,o.gl,o.gu,o.ha,o.hy,o.is,o.kk,o.kok,o.ku,o.ky,o.lb,o.mi,o.ml,o.mn,o.mr,o.ne,o.nn,o.or,o.pa,o.qut,o.quz,o.rw,o.sd,o.si,o.sq,o.sw,o.ta,o.te,o.tk,o.tn,o.ur,o.xh,o.zu]},group2:{languages:[o.fr,o.pt_br,o.am,o.fil,o.hi,o.nso,o.tg,o.ti,o.uz]},group3:{languages:[o.lv]},group4:{languages:[o.gd]},group5:{languages:[o.ro]},group6:{languages:[o.lt]},group7:{languages:[o.ru,o.uk,o.hr,o.sr,o.be,o.bs,o.sl]},group8:{languages:[o.cs,o.sk]},group9:{languages:[o.pl]},group11:{languages:[o.ga]},group12:{languages:[o.ar]}},s=function(){function e(){}return e.prototype.init=function(e){void 0===e&&(e=o.en);var t=e.replace("-","_").toLowerCase();if(!o[t]){var n=t.split("_");1===n.length&&r.default.throwError(i.ErrorCodes.ERR_UNSUPPORTED_LANGUAGE,"Unsupported language:"+e),t=n[0]}this._currentLocale=t},e.prototype.getPluralSuffix=function(e){var t,n=null,i="";for(t in a)-1!==a[t].languages.indexOf(this._currentLocale)&&(n=t);switch(n){case"group0":i=1===e?"":"_few";break;case"group1":i=1===e?"":"_many";break;case"group2":i=e>1?"_many":"";break;case"group3":i=e%10==1&&e%100!=11?"":0===e?"_few":"_many";break;case"group4":i=1===e||11===e?"":2===e||12===e?"_few":"_many";break;case"group5":i=1===e?"":0===e||e%100>0&&e%100<20?"_few":"_many";break;case"group6":i=e%10==1&&e%100!=11?"":e%10>=2&&(e%100<10||e%100>=20)?"_many":"_few";break;case"group7":i=e%10==1&&e%100!=11?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group8":i=1===e?"":e>=2&&e<=4?"_few":"_many";break;case"group9":i=1===e?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group11":i=1===e?"":e>=2&&e<=10?"_few":"_many";break;case"group12":i=1===e?"":2===e?"_few":"_many";break;default:i=""}return i},e}();t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(13),a=n(120),s=n(14),c=n(220),l=n(221),u=n(224),d=n(225),p=n(228),h=n(229),f=n(230),g=n(231),m=n(232),_=n(233),v=n(234),y=n(235),S=n(236),E=n(237),T=n(238),C=n(239),I=function(){function e(){this._processors=[],this._xmmFallbackProcessor=new C.default,this._processors.push(new E.default),this._processors.push(new c.default),this._processors.push(new u.default),this._processors.push(new v.default),this._processors.push(new T.default),this._processors.push(new _.default),this._processors.push(new h.default),this._processors.push(new g.default),this._processors.push(new y.default),this._processors.push(new l.default),this._processors.push(new f.default),this._processors.push(new p.default),this._processors.push(new m.default),this._processors.push(new d.default)}return Object.defineProperty(e.prototype,"teamsFileProcessor",{get:function(){return this._teamsFileProcessor||(this._teamsFileProcessor=new S.default),this._teamsFileProcessor},enumerable:!0,configurable:!0}),e.prototype.handle=function(e,t){var n,r=0;for(e.contentOriginal&&e.contentOriginal!==e.content?e.content=e.contentOriginal:e.contentOriginal=e.contentOriginal||e.content;!n&&r<this._processors.length;)n=this._processors[r].process(e,t),r++;return i.default.get.isTeams(),n||(n=this._xmmFallbackProcessor.process(e)),n},e.prototype.generateOutgoing=function(e){for(var t,n=0;!t&&n<this._processors.length;)t=this._processors[n].generate(e),n++;return t},e.prototype.updateExistingMessage=function(e,t,n){if(!t||e.senderId!==t.senderId)return e;var c=0===t.content.indexOf(r.default.MSG_DELETED_CLASSIC_SKYPE),l=0===e.content.indexOf(r.default.MSG_DELETED_CLASSIC_SKYPE),u=t.skypeEditedId&&c,d=t.version>e.version,p=t.originalTimestamp>e.originalTimestamp,h=d||p;return p&&n&&(e.content=u?s.default.extractMsgContent(t.content):t.content,e.timestamp=t.timestamp,e.originalTimestamp=t.originalTimestamp),e.status=t.status,t.skypeEditedId?t.editedTimestamp&&a.default.updateMessageProperties(e,t):a.default.updateMessageProperties(e,t),t.isEdited&&(e.isEdited=!0,l&&(e.content=s.default.extractMsgContent(e.content)),(t.editedTimestamp>e.timestamp||h)&&(e.content=t.content)),e.isEdited&&!p&&n&&(e.timestamp=t.timestamp),t.isDeleted&&(e.isDeleted=!0),i.default.get.backend===o.MessagingBackend.TEAMS&&(e.isDeleted=t.isDeleted),e},e.prototype.isTypingIndicator=function(e){return"Control/Typing"===e.messagetype||"Control/ClearTyping"===e.messagetype},e}();t.default=I},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(58),s=n(0),c=n(1),l=n(15),u=n(27),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/AddMember"!==e.messagetype)return null;var n=new u.default(this._createMessageModel.bind(this),this._generateContent,e);n._subscribeOnceToPersonsName(n._initiator),n._targets.forEach(n._subscribeOnceToPersonsName);var i=this.parseContentFor(e.content,"target"),r=c.default.instance.Persons.getPerson(i),l=t.conversation.participants;if(!t.isHistory&&i&&l&&!l.some(function(e){return e.person.id===r.id})){var d=new a.default(r);l.pushObservable(d),r.isAgent&&s.swc.API.triggerEvent(o.ApiEvents.BotAddedToThread,r.id)}return t.conversation.isOneOnOne&&(n._messageModel.content=""),n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id;return e._isSelfAction()?c.default.instance.i18n.fetch("joinedConversation",{participant:"<b>"+t+"</b>"}):c.default.instance.i18n.fetch("wasAdded",{participant:"<b>"+t+"</b>",contact:"<b>"+e._targets.filter(function(t){return t.id!==e._initiator.id}).map(function(e){return e.displayName||e.id}).join("</b>, <b>")+"</b>"})},t}(l.default);t.default=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(222),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){return(o.default.ECS.showEngagementCampaings&&"PopCard"===e.messagetype||"Notice"===e.messagetype)&&a.default.instance.register(e,t),null},t}(n(15).default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(2),o=n(0),a=n(223),s=12096e5,c=function(){function e(){var e=this;this.register=function(t,n){var r,s;if(e._isSupported(n.conversation)&&e._isWithinTwoWeeks(t)){try{s=JSON.parse(t.content)}catch(e){}if(s&&s.length){switch(t.messagetype){case"Notice":r=new a.default(s[0],t.messagetype)}e._isInValid(r.validUntilTimestamp)||r&&o.swcWindow.swc.API.triggerEvent(i.CampaignEvents.SHOW,r)}}},this._isSupported=function(t){return t.isAgent&&e._isConversationWithConciergeBot(t.id)},this._isInValid=function(e){return Date.now()>e.getTime()},this._isWithinTwoWeeks=function(e){var t=Date.now()-s;return new Date(e.originalarrivaltime).getTime()>t},this._isConversationWithConciergeBot=function(e){return e===r.default.CONCIERGE_BOT_MRI||e===r.default.CONCIERGE_BOT_DF_MRI},this.unregister=function(e){o.swcWindow.swc.API.triggerEvent(i.CampaignEvents.DISMISS,e)}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}();t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.campaignId=t.campaignId,i.schemaVersion=t.schemaVersion,i.attachment=t.attachments&&t.attachments.length?t.attachments[0]:null,i}return r(t,e),t}(n(151).default);t.default=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(15),s=n(27),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/DeleteMember"!==e.messagetype)return null;var n=new s.default(this._createMessageModel.bind(this),this._generateContent,e);if(n._subscribeOnceToPersonsName(n._initiator),n._targets.forEach(function(e){n._subscribeOnceToPersonsName(e),t.conversation&&e===o.default.instance.MePersonManager.mePerson&&(t.conversation.isChatEnabled=!1)}),!1===t.isHistory)for(var i=this.parseContentFor(e.content,"target"),r=o.default.instance.Persons.getPerson(i),a=0;a<t.conversation.participants.length;a++){if(t.conversation.participants[a].person.id===r.id){t.conversation.participants.spliceObservable(a,1);break}}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id;return e._isSelfAction()?o.default.instance.i18n.fetch("hasLeftConversation",{participant:"<b>"+t+"</b>"}):o.default.instance.i18n.fetch("wasRemoved",{participant:"<b>"+t+"</b>",removedParticipant:"<b>"+e._targets.map(function(e){return e.displayName||e.id}).join("</b>, <b>")+"</b>"})},t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(112),s=n(14),c=n(1),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getCallEventContentByType=function(e,t){var n=(e.conversationId||e.conversationid||"").indexOf("@thread.skype")>-1||!!e.threadtopic,i=e.content.replace(/\r?\n/g,""),r=null,c=o.CustomMessageType.Call;if(i.indexOf("<partlist")>-1){var l=/(<partlist alt ?= ?"">\s*<\/partlist>)|(<partlist type="started")/.test(i),u=/(^<ended)|(<partlist type="ended")/.test(i),d=/<partlist type="missed"/.test(i),p=new RegExp('<part identity="(\\d+:)?'+t+'">.*?</part>',"g"),h=new RegExp("<duration>([\\d|\\.]+)</duration>"),f=i.match(p.source),g=i.match(h.source),m=!!f&&!!f[0],_=g?parseInt(g[1],10):0,v=a.getCallMessage({isGroup:n,isMyself:m,isStarted:l,isEnded:u,isMissed:d,duration:_});r=v.message,c=v.messageType}return{content:s.default.getMessageSanitizedContent(r),contentType:c}},t}return r(t,e),t.prototype.process=function(e){if("Event/Call"!==e.messagetype&&"Signal/Flamingo"!==e.messagetype)return null;var t=this._createMessageModel(e,"",!0),n=c.default.instance.MePersonManager.mePerson,i=this._getCallEventContentByType(e,n.id);return t.content=i.content,t.isDeleted=!1,t.isEdited=!1,t.customType=i.contentType,null==i.content?null:t},t}(n(15).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._callback=e,this._duration=0,this._isGoing=!1}return e.prototype.start=function(){var e=this,t=Date.now();this._isGoing=!0;var n=function(){if(e._isGoing){var i=Date.now(),r=Math.floor((i-t)/1e3);e._duration!==r&&(e._duration=r,e._callback(r)),window.setTimeout(n,500)}};n()},e.prototype.reset=function(){this._isGoing=!1,this._duration=0,this._callback(this._duration)},e}();t.Duration=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(7);t.getCallMessage=function(e){var t=null,n=r.CustomMessageType.Call,o=e.isGroup?"GroupCall":"Call";if(e.isStarted)t=i.default.instance.i18n.fetch("message_text_ongoingCall"),n=r.CustomMessageType.Call;else if(e.isEnded&&e.isMyself){var a=e.duration?"<span>"+function(e){var t="",n=Math.round(e/3600);if(n>0){var r=i.default.instance.i18n.fetch("message_text_hours");t+=n+r+" "}e%=3600;var o=Math.round(e/60);if(o>0){var a=i.default.instance.i18n.fetch("message_text_minutes");t+=o+a+" "}var s=e%60;if(s>0){var c=i.default.instance.i18n.fetch("message_text_seconds");t+=s+c}return t.trim()}(e.duration)+"</span>":"";t=e.duration?i.default.instance.i18n.fetch("message_text_ended"+o)+" "+a:i.default.instance.i18n.fetch("message_text_noAnswer"+o),n=r.CustomMessageType.CallEnd}else(e.isMissed||e.isEnded&&!e.isMyself)&&(t=i.default.instance.i18n.fetch("message_text_missed"+o),n=e.isGroup?r.CustomMessageType.MissedGroupCall:r.CustomMessageType.MissedCall);return{message:t,messageType:n}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(14),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);if(!t)return null;var r=new c;return r.uri=t[1],r.uriObjectType=i?i[1]:null,r.xmmType=n?n[1].split(".")[0]:null,r},t.isValidFileMessage=function(e){return null===e||null===e.uri||!("File"===e.xmmType)},t.createFileContent=function(e){return'<LwcFile url="'+e.uri+'" size="'+e.size+'" originalName="'+e.originalName+'"></LwcFile>'},t}return r(t,e),t.prototype.process=function(e){if(-1===["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_AudioMsg","RichText/Media_Card"].indexOf(e.messagetype))return null;var t=e.content,n=this.parseRawMessage(t);if(!n)return e.content=a.default.getMessageSanitizedContent(e.content),this._createMessageModel(e);if(this.isValidFileMessage(n))return null;var i=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),r=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=i?i[1]:"0",n.originalName=r?r[1]:null;var s=this._createMessageModel(e);return s.type=o.MessageType.LwcFile,s.content=this.createFileContent(n),s},t.prototype.generate=function(e){if("RichText/Media_GenericFile"!==e.messagetype)return null;var t=e.content,n=this.parseRawMessage(t);if(this.isValidFileMessage(n))return null;var i=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),r=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=i?i[1]:"0",n.originalName=r?r[1]:null;var a=this._generateOutgoingModel(e);return a.type=o.MessageType.LwcFile,a.content=this.createFileContent(n),a},t}(n(15).default);t.default=s;var c=function(){return function(){}}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(15),s=n(27),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("ThreadActivity/HistoryDisclosedUpdate"!==e.messagetype)return null;var t=new s.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t._subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id;return"false"===this._getUpdateValue(e)?o.default.instance.i18n.fetch("historyDisclosed",{participant:"<b>"+n+"</b>"}):o.default.instance.i18n.fetch("historyClosed",{participant:"<b>"+n+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i),r=e.match(/<originalname[^>]*?\sv=\"([^"]+?)\"/i);if(!t)return null;var o=new s;return o.filename=r?r[1]:null,o.uri=t[1],o.uriObjectType=i?i[1]:null,o.xmmType=n?n[1].split(".")[0]:null,o},t.isValidImageMessage=function(e){return null===e||null===e.uri||!("Picture"===e.xmmType||"photo"===e.uriObjectType)},t.createImageContent=function(e){return'<LwcImage url="'+e.uri+'" filename="'+e.filename+'" ></LwcImage>'},t}return r(t,e),t.prototype.process=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(!t&&e.skypeeditedid)return this._createMessageModel(e);if(this.isValidImageMessage(t))return null;var n=this._createMessageModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t.prototype.generate=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(this.isValidImageMessage(t))return null;var n=this._generateOutgoingModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t}(n(15).default);t.default=a;var s=function(){return function(){}}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(15),s=n(27),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("ThreadActivity/JoiningEnabledUpdate"!==e.messagetype)return null;var t=new s.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t._subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id;return"true"===this._getUpdateValue(e)?o.default.instance.i18n.fetch("joiningEnabled",{participant:"<b>"+n+"</b>"}):o.default.instance.i18n.fetch("joiningDisabled",{participant:"<b>"+n+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("SystemMessage"!==e.messagetype)return null;var t=o.default.getMessageSanitizedContent(e.content);return this._createMessageModel(e,t,!0)},t}(n(15).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(15),s=n(27),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/PictureUpdate"!==e.messagetype)return null;var n=new s.default(this._createMessageModel.bind(this),this._generateContent,e);if((n._subscribeOnceToPersonsName(n._initiator),t.conversation&&t.conversation.messages&&t.conversation.messages.length)&&t.conversation.messages[t.conversation.messages.length-1].timestamp<n._messageModel.timestamp){var i=this.getNewPicture(e.content);t.conversation.avatar=i||t.conversation.avatar}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id;return o.default.instance.i18n.fetch("threadPictureUpdated",{participant:"<b>"+t+"</b>"})},t.prototype.getNewPicture=function(e){var t=e.match(/URL@([^<]+)(?=<\/value>)/g);return t?t[0].replace("URL@",""):null},t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(7),s=n(15),c=n(27),l={admin:a.ParticipantRole.Admin,user:a.ParticipantRole.User},u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._updateParticipantRoles=function(e,t,n){var i=l[n.toLowerCase()];t.forEach(function(t){e.participants.forEach(function(e){var n=e.person.id;t.id===n&&(e.role=i)})})},t}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/RoleUpdate"!==e.messagetype)return null;var n=this._getRole(e.content),i=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,n),e);return i._subscribeOnceToPersonsName(i._initiator),i._targets.forEach(i._subscribeOnceToPersonsName),t.conversation&&t.conversation.participants&&this._updateParticipantRoles(t.conversation,i._targets,n),i._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=t._targets[0].displayName||t._targets[0].id;return o.default.instance.i18n.fetch("roleUpdated",{who:"<b>"+n+"</b>",whom:"<b>"+i+"</b>",role:"<b>"+e+"</b>"})},t.prototype._getRole=function(e){var t=e.match(/<role>(.+)<\/role>/i);return t?t[1]:""},t}(s.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(7),s=n(25),c=n(35),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getTitle=function(e){var t=e.content.match(/<Title>(.*)<\/Title>/i);return t?t[1]:o.default.instance.i18n.fetch("s_title",{mesageType:e.messagetype})},t}return r(t,e),t.prototype.process=function(e){if("RichText/Media_Card"!==e.messagetype)return null;var t=this._getTitle(e),n=e.content.match(/<Swift b64="([^"]+)"\s*\/>/i);try{var i=c.default.b64DecodeUnicode(n[1]);e.content='<SwiftCard Swift="'+encodeURIComponent(i)+'">'+s.default.dompurify.sanitize(t,{ALLOWED_TAGS:[]})+"</SwiftCard>"}catch(e){return null}var r=this._createMessageModel(e);r.type=a.MessageType.SwiftCard;try{r.content=decodeURIComponent(e.content)}catch(e){return null}return r},t}(n(15).default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.createFileContent=function(e){return"<LwcSharepointFile>"+JSON.stringify(e)+"</LwcSharepointFile>"},t}return r(t,e),t.prototype.process=function(e){var t=this;if(!e.properties||!e.properties.files)return null;var n=JSON.parse(e.properties.files),i=this._createMessageModel(e);return i.type=o.MessageType.LwcFile,n.forEach(function(e){i.content+=t.createFileContent(e)}),i},t}(n(15).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(51),a=n(14),s=/<context reason=\"customAad\">.*<\/context>/g,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("RichText"!==e.messagetype&&"Text"!==e.messagetype&&"InviteFreeRelationshipChanged/Initialized"!==e.messagetype&&"RichText/Html"!==e.messagetype)return null;e.content||(e.content="");var n=e.content,i=n.match(s);i&&i[0]&&(n=n.replace(i[0],"")),e.content=n;var r=this._createMessageModel(e);return r.content=o.default.parse(r.content),r.content=a.default.getMessageSanitizedContent(r.content,t),r},t.prototype.generate=function(e){return"RichText"!==e.messagetype?null:this._generateOutgoingModel(e)},t}(n(15).default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(14),s=n(15),c=n(27),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/TopicUpdate"!==e.messagetype)return null;e.threadtopic&&t.conversation&&(t.conversation.topic=a.default.parseTopic(e.threadtopic));var n=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return n._subscribeOnceToPersonsName(n._initiator),n._messageModel},t.prototype._generateContent=function(e,t){var n=this.parseContentFor(e,"value"),i=t._initiator.displayName||t._initiator.id;return n=n?a.default.parseTopic(n):"",o.default.instance.i18n.fetch("topicUpdated",{participant:"<b>"+i+"</b>",topic:"<i>"+n+"</i>"})},t}(s.default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=n(1),s=n(7),c=["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_FlikMsg","RichText/Media_Card","RichText/Contacts","RichText/Location","RichText/Files","RichText/Sms","Event/SkypeVideoMessage","Event/SkypeAudioMessage"],l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if(c.indexOf(e.messagetype)<0)return null;var t=e.content.match(/^<uriobject[^>]*?>(.*?)<\/uriobject>$/i);if(!t){var n=a.default.instance.i18n.fetch("m_unsupported"),i=this._createMessageModel(e,n);return i.type=s.MessageType.Unsupported,i}var r=o.default.getMessageSanitizedContent(t[1]);return this._createMessageModel(e,r)},t}(n(15).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.implode=function(e){return e.join(",")},e.explode=function(e){return e?e.replace(/\s/g,"").split(","):[]},e.find=function(t,n){return e.explode(t).indexOf(n)>-1},e.add=function(t,n,i){if(!i||!e.find(t,n)){var r=e.explode(t);r.push(n),t=e.implode(r)}return t},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(4),o=n(45),a=n(0);!function(e){e[e.replace=1]="replace"}(i=t.Rule||(t.Rule={}));var s=function(){function e(e,t,n){var i=this;this.pattern=e,this.rule=t,this.replace=function(e){return e.replace(i.pattern,i.replacer)},this.replacer=function(e){for(var t=e.length,n="",r=i.replacement;t--;)n+=r;return n},this.replacement=n}return Object.defineProperty(e.prototype,"replacement",{get:function(){return this.char?String.fromCharCode(this.char):void 0},set:function(e){this.char=e?e.charCodeAt(0):this.char},enumerable:!0,configurable:!0}),e}();t.Mask=s;var c=function(){function e(){var e=this;this.masks=[],this.setupProxy=function(){var t=a.swc.API;t.registerEvent(r.ApiEvents.invoke.registerMask,function(t){e.register(t,i.replace,"#")}),t.registerEvent(r.ApiEvents.invoke.unregisterMask,function(t){e.unregister(t)})},o.ProxyConnector.instance.connect("messageMasking",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!this.masks.length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t,n){var i=this.masks.find(function(n){return n.pattern==e&&n.rule==t});i?i.replacement!=n&&(i.replacement=n):this.masks.push(new s(e,t,n))},e.prototype.unregister=function(e,t){this.masks.forEach(function(n,i,r){n.pattern!=e||t&&n.rule!==t||r.splice(i,1)})},e.prototype.shouldMask=function(e){if(this.empty)return!1;for(var t,n=0,i=this.masks;n<i.length;n++){var r=i[n];if(t=e.search(r.pattern)>-1)break}return t},e.prototype.process=function(e){return this.masks.forEach(function(t){return e=t.replace(e)}),e},e}();t.Masks=c},function(e,t,n){"use strict";
/*!
 *  LogFactory.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(131);function s(e){if(null===e)return-1;for(var t=0,n=e.length-1;n>=0;n--)t=37*t+e.charCodeAt(n)|0;var i="__auf_literal:";for(n=i.length-1;n>=0;n--)t=37*t+i.charCodeAt(n)|0;return t}!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(o||(o={}));var c,l=function(){function e(e,t){this._level=a.LogLevel.Debug4,this._threshold=255,this._safe=o.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?o.Inherited_Safe:o.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===o.Safe||this._safe===o.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){c.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Trace,s(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug6,s(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug5,s(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug4,s(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug3,s(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug2,s(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug1,s(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Warning,s(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Error,s(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Fatal,s(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.MetaData,s(e),e].concat(t))},e}(),u=function(){function e(){}return e.instance=function(){return c},e.levelToString=function(e){return e<=a.LogLevel.Trace?"TRACE":e<=a.LogLevel.Debug6?"DEBUG6":e<=a.LogLevel.Debug5?"DEBUG5":e<=a.LogLevel.Debug4?"DEBUG4":e<=a.LogLevel.Debug3?"DEBUG3":e<=a.LogLevel.Debug2?"DEBUG2":e<=a.LogLevel.Debug1?"DEBUG1":e<=a.LogLevel.Warning?"WARN":e<=a.LogLevel.Error?"ERROR":e<=a.LogLevel.Fatal?"FATAL":(a.LogLevel.MetaData,"META")},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();function d(e,t){for(var n=t.name();n.length>0;){if(e[n])return e[n];var i=n.lastIndexOf(".");n=i<0?"":n.substr(0,i)}return e[""]?e[""]:a.LogLevel.Debug4}function p(e,t){var n=255;return t.forEach(function(t){var i=255;t.appender.levels()?i=Math.min(i,d(t.appender.levels(),e)):t.appender.receiveAll()||(i=Math.min(i,e.level())),n=Math.min(n,i)}),n}u._levelFromString={TRACE:a.LogLevel.Trace,DEBUG6:a.LogLevel.Debug6,DEBUG5:a.LogLevel.Debug5,DEBUG4:a.LogLevel.Debug4,DEBUG3:a.LogLevel.Debug3,DEBUG2:a.LogLevel.Debug2,DEBUG1:a.LogLevel.Debug1,WARN:a.LogLevel.Warning,ERROR:a.LogLevel.Error,FATAL:a.LogLevel.Fatal,META:a.LogLevel.MetaData},t.LogFactory=u;var h=function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new l("",null),t}return r(t,e),t.prototype.toHex=function(e){return(4294967296+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var n=this._nextId++;return t&a.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:n}):this._appenders.push({appender:e,handle:n}),this.recalcComponentThresholds(),n},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,n,i){for(var r=[],o=4;o<arguments.length;o++)r[o-4]=arguments[o];if(e.isEnabled(t)){var a={timestamp:(new Date).getTime(),component:e,level:t};this._appenders.forEach(function(o){(function(e,t,n){return!!e.appender.receiveAll()||(e.appender.levels()?n>=d(e.appender.levels(),t):n>=t.level())})(o,e,t)&&o.appender.log(a,n,i,r)})}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var n in this._components)this.parent(n).name()===e&&t.push(this._components[n]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new l(e,this.parent(e));this._components[e]=t;var n=p(t,this._appenders);return t._setThreshold(n),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){e.safety()!==o.Inherited_Safe&&e.safety()!==o.Inherited_Unsafe||(e.setSafety(t),n.setSafetyRecursive(e.name(),t))})},t.prototype.declareComponentSafe=function(e,t){var n=this.component(e);-1!==this._componentBlacklist.indexOf(n.name())?n.setSafety(o.Blacklisted_Unsafe):n.setSafety(t?o.Safe:o.Unsafe),this.setSafetyRecursive(e,t?o.Inherited_Safe:o.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),n.setExtendedInfoRecursive(e.name(),t))})},t.prototype.declareComponentExtendedInfo=function(e,t){var n=this.component(e);n.setExtendedInfo(t),this.setExtendedInfoRecursive(n.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],n=p(t,this._appenders);t._setThreshold(n)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var n in this._components){(o=this._components[n])._setLevel(t);var i=p(o,this._appenders);o._setThreshold(i)}else{var r=e.name()+".";e._setLevel(t);i=p(e,this._appenders);for(var n in e._setThreshold(i),this._components){var o;if((o=this._components[n]).name().substr(0,r.length)===r){o._setLevel(t);var a=p(o,this._appenders);o._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var n=this._components[t];-1!==this._componentBlacklist.indexOf(n.name())&&n.setSafety(o.Blacklisted_Unsafe)}},t}(u);c=new h},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(65);n(114),n(87),n(64);var r=n(3),o=i.default.build("SkypeWebControl",window);t.default=o.services=o.services||r.default},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(5),s=n(36),c=n(8);var l=function(e){function t(t,n){var i,r,a=e.call(this,t,(i=n.threadId||n.callerMri,r={},o.default.conversations.get(i,r)))||this;return a.id=n.callId,a.endpointId=n.endpointId,a.call=n,a.origin=c.NA,a}return r(t,e),t.prototype.getCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);return t.push(a.TelemetryPropertyValue.Create("direction",this.direction)),t.push(a.TelemetryPropertyValue.Create("origin",this.origin)),t.push(a.TelemetryPropertyValue.Create("id",this.id)),t.push(a.TelemetryPropertyValue.Create("endpointId",this.endpointId)),t},t}(s.ConversationDataEvent);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(36),s=n(8),c=function(e){function t(t,n){var i=e.call(this,"kpi_file_upload",t)||this,r=n.name.match(/\.([a-zA-Z\d]*)$/i);return i.size=n.size,i.fileType=r?r[1]:s.NA,i}return r(t,e),t.prototype.getCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);return t.push(o.TelemetryPropertyValue.Create("size",this.size)),t.push(o.TelemetryPropertyValue.Create("type",this.fileType)),t.push(o.TelemetryPropertyValue.Create("ttc",this.ttc)),t.push(o.TelemetryPropertyValue.Create("status",this.status)),t.push(o.TelemetryPropertyValue.Create("contentType",this.getContentType())),t},t.prototype.getContentType=function(){switch(this.fileType){case"png":case"jpg":case"gif":case"bmp":case"tiff":return"Picture";case"avi":case"mp4":case"mkv":case"wmv":case"m4v":return"Video";case"mp3":case"cda":case"m4a":case"wav":return"Audio";case"xls":case"xlsx":case"xlsm":case"doc":case"docx":case"ppt":case"pptx":return"MSOffice";case"zip":case"rar":case"ace":case"7z":case"dmg":return"Archive";case"exe":case"msi":case"iso":return"Binary";case"html":case"htm":case"txt":return"Text";case"pdf":return"Pdf";default:return"Other"}},t}(a.ConversationDataEvent);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){void 0===t&&(t=!1);var n=e.call(this)||this;return n._useAms=!1,n._amsService=n.getServices().amsService,n._sharepointService=n.getServices().sharepointService,n._useAms=!!t,n._authenticated=!1,n}return r(t,e),t.prototype.sendFile=function(e,t){return this._useAms?this.sendFileViaAms(e,t):this.sendFileViaSharepoint(e,t)},t.prototype.sendFileViaAms=function(t,n){return e.prototype.sendFile.call(this,t,n)},t.prototype.sendFileViaSharepoint=function(t,n){var i=this;if(this._amsService.isDocumentTypeImage(n.type))return e.prototype.sendFile.call(this,t,n);return this._sharepointService.uploadFile(n).then(function(e){var n=i.getServices().contactsService,r=[];t.members.forEach(function(e){r.push(n.getContact("",e.id))});Promise.all(r).then(function(n){var r=[];n.forEach(function(e){e&&e.email&&r.push(e.email)}),i._sharepointService.shareFile(e.objectUrl,r).then(function(n){return r=[{"@type":"http://schema.skype.com/File",version:2,id:(i=e).objectId,baseUrl:i.siteInfo.siteUrl,type:i.type,title:i.title,state:"active",objectUrl:i.objectUrl,providerData:'{"code":null,"type":0}',itemid:i.objectId,fileName:i.title,fileType:i.type,fileInfo:{fileUrl:i.objectUrl,siteUrl:i.siteInfo.siteUrl,serverRelativeUrl:i.siteInfo.relativeUrl},botFileProperties:{},filePreview:{},fileChicletState:{serviceName:"p2p",state:"active"}}],void t.sendFileAsProperty({files:r});var i,r})})}),Promise.resolve()},t}(n(135).default);t.TeamsAmsManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(250),a=n(102),s="imgt1",c="imgpsh_fullsize",l="original",u=0,d=500,p=3,h=function(){return function(){var e=this;this.createNewDocument=function(t,n){var i={type:e.getDocumentTypeFromContentType(n.type),permissions:{}};return i.filename=n.name,i.permissions[t]=[o.Permission[o.Permission.read]],a.post("createNewDocument","objects",JSON.stringify(i)).then(function(e){return e.json()})},this.sendFile=function(t,n){var i="objects/"+t+"/content/"+(e.isDocumentTypeImage(n.type)?"imgpsh":"original");return a.putData("sendFile",i,n)},this.downloadPictureThumbnail=function(t){var n=i.default.AMS_HOST_URL+"objects/"+t;return new Promise(function(t){e.getViewStatus(n,s).then(function(e){a.getData("downloadPictureThumbnail",e).then(t)})})},this.downloadFile=function(t){return new Promise(function(n){e.getViewStatus(t,l).then(function(e){return a.getData("downloadPicture",e).then(n)})})},this.downloadPicture=function(t){var n=i.default.AMS_HOST_URL+"objects/"+t;return new Promise(function(t){e.getViewStatus(n,c).then(function(e){return a.getData("downloadPicture",e).then(t)})})},this.getPictureThumbnail=function(e){return new Promise(function(t){return a.get("getPictureThumbnail",e).then(function(e){return a.parseJson(e)}).then(t)})},this.authenticate=function(){return new Promise(function(e){r.default.signInManager.getSkypeToken().then(function(t){var n="skypetoken="+t;return a.postForm("authenticate","skypetokenauth",n).then(e)},function(){})})},this.logout=function(){return a.get("logout","skypetokenauth/expire")},this.isDocumentTypeImage=function(e){return-1!==e.indexOf("image")},this.getDocumentTypeFromContentType=function(t){return e.isDocumentTypeImage(t)?"pish/image":"sharing/file"},this.getViewStatus=function(t,n,i,r){void 0===i&&(i=u),void 0===r&&(r=p);var o=t+"/views/"+n,s=o+"/status";if(0===r)return Promise.reject({});var c=function(a){if(a.view_location)return Promise.resolve(a.view_location);var s=a.scan&&"in progress"!==a.scan.status&&"ready"!==a.scan.status,c="ready"===a.view_state&&!a.scan,l="ready"===a.view_state&&a.scan&&"passed"===a.scan.status;return a.status_location&&!a.view_state?(t=a.status_location.replace("/views/"+n+"/status",""),e.getViewStatus(t,n,i,r)):c||l?Promise.resolve(o):"failed"===a.view_state||s?Promise.reject({}):"expired"!==a.content_state?e.getViewStatus(t,n,d,r):Promise.reject({})},l=function(o){return 401===o.status||403===o.status?(r--,e.authenticate().then(function(){return e.getViewStatus(t,n,i,r)})):Promise.reject({})};return new Promise(function(e){setTimeout(e,i)}).then(function(){return a.getJson("getViewStatus",s).then(c,l)})}}}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.read=0]="read"}(t.Permission||(t.Permission={}))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(57),a=n(5),s=n(8);t.NA="n/a";var c=function(e){function t(t,n,i,r,a){var s=e.call(this,"service_qos")||this;return s.ttsSuccess=0,s.ttsFailure=0,s.successCount=0,s.totalCount=0,s.serviceName=t,s.requestLength=i,s.responseStatus=r,s.requestType=a,n&&(s.protocol=o.default.extractProtocol(n),s.domain=o.default.extractHostname(n),s.path=o.default.extractPath(n),s.queryParams=o.default.extractQuery(n)),s}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(a.TelemetryPropertyValue.Create("serviceName",this.serviceName)),e.push(a.TelemetryPropertyValue.Create("protocol",this.protocol)),e.push(a.TelemetryPropertyValue.Create("domain",this.domain)),e.push(a.TelemetryPropertyValue.Create("path",this.path)),e.push(a.TelemetryPropertyValue.Create("queryParams",this.queryParams)),e.push(a.TelemetryPropertyValue.Create("requestLength",this.requestLength)),e.push(a.TelemetryPropertyValue.Create("responseStatus",this.responseStatus)),e.push(a.TelemetryPropertyValue.Create("requestType",this.requestType)),e.push(a.TelemetryPropertyValue.Create("successCount",this.successCount)),e.push(a.TelemetryPropertyValue.Create("totalCount",this.totalCount)),e.push(a.TelemetryPropertyValue.Create("ttsSuccess",this.ttsSuccess)),e.push(a.TelemetryPropertyValue.Create("ttsFailure",this.ttsFailure)),e},t}(s.TelemetryEvent);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(3),s=n(5),c=function(e){function t(){return e.call(this,"service_fault_qos")||this}return r(t,e),t.report=function(e,n,i,r){n=n||{};var s=new t;s.serviceName=e,s.errorCode=n.status,s.errorMessage=n.statusText||n.message,n.headers&&"function"==typeof n.headers.get&&(s.contextId=n.headers.get("contextid")||n.headers.get("X-Skype-Caller")||n.headers.get("X-Skype-Request-Id")),s.setServiceHost(n.url||r),s.tts=i,s.isZombie=a.default.isZombie;try{o.swc.services.telemetryManager.sendEvent(s)}catch(e){}},t.prototype.getCustomProperties=function(){var e=new Array;return e.push(s.TelemetryPropertyValue.Create("serviceName",this.getProperty(this.serviceName))),e.push(s.TelemetryPropertyValue.Create("errorCode",this.getProperty(this.errorCode))),e.push(s.TelemetryPropertyValue.Create("errorMessage",this.getProperty(this.errorMessage))),e.push(s.TelemetryPropertyValue.Create("isZombie",this.getProperty(this.isZombie))),e.push(s.TelemetryPropertyValue.Create("serviceHost",this.getProperty(this.serviceHost))),e.push(s.TelemetryPropertyValue.Create("contextId",this.getProperty(this.contextId))),e.push(s.TelemetryPropertyValue.Create("tts",this.getProperty(this.tts))),e},t.prototype.setServiceHost=function(e){var t;e&&(t=(t=(t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0]).split("?")[0],this.serviceHost=t)},t}(n(8).TelemetryEvent);t.ServiceFaultEvent=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(3);t.getHeaders=function(){var e=new Headers,t=i.default.getClientVersion();return new Promise(function(n){r.default.signInManager.getSkypeToken().then(function(r){e.append("Authorization","skype_token "+r),i.default.ECS.version&&e.append("X-MS-Client-Version",t),n(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(255),o=function(){function e(){var e=this;this._agents={},this.addAgentToContacts=function(e,t){var n="relationship/"+t+"/"+e;return r.put("addAgentToContacts",n)},this.getAgentDetails=function(t){if(e._agents[t])return Promise.resolve({agentDescriptions:[e._agents[t]]});var n="agents?agentId="+t;return r.get("getAgentDetails",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=i.default.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})},this.searchAgents=function(t){var n="agents?q="+t;return r.get("searchAgents",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=i.default.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})}}return Object.defineProperty(e.prototype,"agents",{get:function(){return this._agents},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(256),a={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n){return r.default("aps-"+e,a,i.default.APS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,o)})},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(o){var s={method:"PUT"};return s.body=n,s.headers=o,function(e,t,n){return r.default("aps-"+e,a,i.default.APS_HOST_URL+t,n)}(e,t,s)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.getHeaders=function(){var e=new Headers;return new Promise(function(t){i.default.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),e.append("Pragma","no-cache"),e.append("Cache-Control","no-cache, no-store, must-revalidate"),t(e)},function(){})})},t.putHeaders=function(){var e=new Headers;return new Promise(function(t){i.default.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(258),o=function(){function e(){this.arrayBufferToBase64=function(e){var t="";return[].slice.call(new Uint8Array(e)).forEach(function(e){return t+=String.fromCharCode(e)}),window.btoa(t)},this.authenticate()}return e.prototype.authenticate=function(){var e=this;if(this.authenticationPromise)return this.authenticationPromise;return this.authenticationPromise=r.postRaw("cookie","/beta/imageauth/cookie"),this.authenticationPromise.then(function(){setTimeout(function(){e.authenticationPromise=null},54e4)}),this.authenticationPromise},e.prototype.fetchAvatars=function(e,t){var n=this,i="/beta/users/"+e+"/profilepicturev2",o={displayname:t,voidCache:"true"},a=r.addGetParamsToUrl(i,o);return this.authenticate().then(function(){return r.getRaw("avatars",a).then(n.getValueFromBuffer.bind(n))},this.resetAuth.bind(this))},e.prototype.fetchMergedAvatars=function(e){var t=this,n=e.filter(function(e){return e.userId!==i.default.mePerson.mri});n.length>4&&(n=n.slice(0,3));var o="/beta/users/mergedProfilePicturev2?usersInfo="+encodeURIComponent(JSON.stringify(n))+"&size=HR64x64&voidCache=true";return this.authenticate().then(function(){return r.getRaw("mergedAvatars",o).then(t.getValueFromBuffer.bind(t))},this.resetAuth.bind(this))},e.prototype.resetAuth=function(){this.authenticationPromise=null},e.prototype.getValueFromBuffer=function(e){var t=this;return e.arrayBuffer().then(function(e){return"data:image/jpeg;base64,"+t.arrayBufferToBase64(e)})},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(259),a={retryCount:3,timeout:12e4,policy:""},s=function(e,t,n){return r.default("avatar-"+e,a,i.default.AVATAR_SERVICE_URL+t,n)};t.get=function(e,n){return t.getRaw(e,n).then(function(e){return e.json()})},t.getRaw=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",i.credentials="include",s(e,t,i)})},t.post=function(e,n){return t.postRaw(e,n).then(function(e){return e.json()})},t.postRaw=function(e,t){var n="cookie"===e;return o.getHeaders(n).then(function(n){var i={method:"POST"};return i.headers=n,i.cache="no-cache",i.credentials="include",s(e,t,i)})};var c=n(104);t.addGetParamsToUrl=c.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(13),a=n(3);t.getHeaders=function(e){return void 0===e&&(e=!1),i.default.get.backend===o.MessagingBackend.TEAMS?a.default.signInManager.aad().then(function(t){var n=new Headers;return e&&n.append("authorization",t),n.append("x-ms-client-type","web"),n.append("x-ms-user-type","user"),n}):new Promise(function(e){a.default.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",r.default.getClientVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(6),o=n(2),a=n(13),s=n(3),c=!1,l=function(e){return{value:null,expiry:null,failureCount:e.value?e.failureCount+1||1:e.failureCount||0}};t.handleRegTokenExpiry=function(e){var t=403===e.status&&(!e.headers||"Quarantine limit Exceeded"!==e.headers.get("StatusText")),n=401===e.status;return t||n?(i=l(i),s.default.storage.setItem(o.default.SKYPE_REGTOKEN_KEY,JSON.stringify(i)),s.default.signInManager.checkAuthFailuresCount(i.failureCount),Promise.reject(e)):Promise.resolve(e)},t.handleSkypeTokenExpiry=function(e){return 401===e.status?(s.default.signInManager.logout("services:401"),Promise.reject(e)):Promise.resolve(e)},t.processHeaders=function(e){var t=e.headers.get("set-registrationtoken");if(t){var n=t.match(/registrationToken=(.+); expires=(\d+)/);n&&(i.value=n[1],i.expiry=parseInt(n[2],10),i.expiry<1e10&&(i.expiry*=1e3),delete i.failureCount,s.default.storage.setItem(o.default.SKYPE_REGTOKEN_KEY,JSON.stringify(i)))}return e},t.getHeaders=function(){c&&i.expiry<Date.now()&&(i=l(i));var e={};r.default.get.backend===a.MessagingBackend.TEAMS&&(e["x-ms-user-type"]="user",e["x-ms-client-type"]="web");var t=function(){return i.value?(e.RegistrationToken="registrationToken="+i.value,Promise.resolve(e)):new Promise(function(t,n){s.default.signInManager.getSkypeToken().then(function(n){e.Authentication="skypetoken="+n,t(e)},function(){return n()})})};return c?t():s.default.signInManager.onceSignedIn().then(function(){return function(){var e,t=null;if(!i){try{t=sessionStorage.getItem(o.default.SKYPE_REGTOKEN_KEY)}catch(e){}if(t)try{e=JSON.parse(t)}catch(e){}i=e&&e.value&&e.expiry?e:{value:null,expiry:null}}c=!0}(),t()})},t.reset=function(){i={value:null,expiry:null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),r=n(11),o=n(26),a=n(10),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return i.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=i.ConversationType.JOIN,i.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=i.ConversationType.AGENT,i.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=i.ConversationType.GROUP,i.ConversationType.GROUP;if(/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,"")))return this.typeMapppings[e]=i.ConversationType.PHONE,i.ConversationType.PHONE;return/^(99:)?([A-Z]|[a-z][^\.])+([\S])*\.(cwA|dAA)/i.test(e)?(this.typeMapppings[e]=i.ConversationType.DIRECT_LINE,i.ConversationType.DIRECT_LINE):(this.typeMapppings[e]=i.ConversationType.PERSON,i.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case i.ConversationType.PERSON:return o.SDKMode.PERSON;case i.ConversationType.AGENT:return o.SDKMode.BOT;case i.ConversationType.JOIN:return o.SDKMode.JOIN_URL;case i.ConversationType.DIRECT_LINE:return o.SDKMode.DIRECT_LINE_TOKEN;case i.ConversationType.PHONE:return o.SDKMode.PHONE;case i.ConversationType.GROUP:return o.SDKMode.THREAD}return o.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case o.SDKMode.PERSON:return"8";case o.SDKMode.BOT:return"28";case o.SDKMode.THREAD:return"19";case o.SDKMode.DIRECT_LINE_TOKEN:return"99";case o.SDKMode.PHONE:return"4";default:r.default.throwError(a.ErrorCodes.ERR_DEFINE_CONVERSATION_PREFIX,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return i.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return i.ConversationType.PHONE;case"8":return i.ConversationType.PERSON;case"19":return i.ConversationType.GROUP;case"28":return i.ConversationType.AGENT;case"99":return i.ConversationType.DIRECT_LINE;default:return i.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(45),o=function(){function e(){var e=this;this.registrations={},this.setupProxy=function(){e.events.registerEvent(i.ApiEvents.threadNotificationsProxy.reg,function(t){return e.register(t.botId,t.conversationId)}),e.events.registerEvent(i.ApiEvents.threadNotificationsProxy.unreg,function(t){return e.unregister(t.botId,t.conversationId)})},this.events=window.swc.API,r.ProxyConnector.instance.connect("threadNotifications",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!Object.keys(this.registrations).length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){var n=this.registrations[e]=this.registrations[e]||[];t&&-1===n.indexOf(t)&&n.push(t)},e.prototype.unregister=function(e,t){var n=this.registrations[e];if(n)if(t){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}else delete this.registrations[e]},e.prototype.notify=function(e,t,n){var r=this.registrations[e];!r||r.length&&-1===r.indexOf(t)||this.events.triggerEvent(i.ApiEvents.threadNotificationsProxy.notify,{botId:e,message:n})},e}();t.ThreadNotifications=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=null,o=1;function a(){i&&clearTimeout(i)}t.execute=function(e){a(),null===r&&(r=1e3),i=setTimeout(e,r+.5*Math.random()*r),r<12e4&&(r*=++o)},t.stop=function(){a()},t.reset=function(){a(),r=null,o=1}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=n(10),s=n(11),c=n(265),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setEndpointPresence=function(){if(o.getServices().signInManager.isAadSupported())try{var e=o.getServices().mePerson.mri;c.presence.subscribe(e,t.handleNotifications),c.presence.startPolling()}catch(e){s.default.throwError(a.ErrorCodes.ERR_UNIFIED_PRESENCE_FAILED,"Presence init failed.")}return Promise.resolve()},t.handleNotifications=function(e){e.etagMatch||("Self"===e.presence.sourceNetwork&&e.presence.deviceType===c.DeviceType.Desktop?o.getServices().notificationsManager.disableNotifications():o.getServices().notificationsManager.enableNotifications())},t}return r(t,e),t.prototype._getInterestedResources=function(){return["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL","/v1/users/ME/contacts/ALL"]},t}(n(139).Polling);t.PollingTeams=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(266);!function(e){e.Mobile="Mobile",e.Desktop="Desktop",e.Web="Web"}(t.DeviceType||(t.DeviceType={}));var r=function(){function e(){var e=this;this.subscriptions={},this.start=function(){e.pollInterval||(e.pollInterval=setInterval(e.poll,2e4))},this.stop=function(){clearInterval(e.pollInterval),e.pollInterval=void 0},this.getUsers=function(){return Object.keys(e.subscriptions).map(function(t){return{mri:t,etag:e.subscriptions[t].etag||""}})},this.handlePoll=function(t){return t.forEach(function(t){e.subscriptions.hasOwnProperty(t.mri)&&(e.subscriptions[t.mri].etag=t.etag,e.subscriptions[t.mri].handlers.forEach(function(e){return e(t)}))}),t},this.poll=function(){var n=e.getUsers();return n?t.presence.pollPresence(n).then(e.handlePoll):Promise.resolve([])}}return e.get=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.subscribe=function(e,t){this.subscriptions[e]||(this.subscriptions[e]={handlers:[]}),this.subscriptions[e].handlers.push(t)},e}();t.presence={getMeEndpoints:function(){return i.get("Presence.getMeEndpoints","/me/endpoints")},pollPresence:function(e){return i.post("Presence.pollPresence","/presence/getpresence",JSON.stringify(e))},subscribe:function(e,t){r.get().subscribe(e,t)},startPolling:function(){r.get().start()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(21),o=n(10),a=n(11),s=n(20),c=n(3),l=n(55),u=n(16),d={baseUrl:"https://presence.teams.microsoft.com/v1"},p={retryCount:3,timeout:12e4,policy:""},h=function(e,t,n){return u.default("presence-"+e,p,d.baseUrl+t,n).then(function(i){if(404===i.status){var r=i.headers.get("location");if(r){var o=/^(https:\/\/[^\/]+\/v1)/g.exec(r)[0];return d.baseUrl=o,u.default("presence-"+e,p,d.baseUrl+t,n)}}return i})},f=function(e){void 0===e&&(e=l.AadAudience.Presence);return r.getServices().signInManager.isAadSupported()?Promise.all([c.default.signInManager.aad(e),c.default.signInManager.getSkypeToken()]).then(function(e){var t=e[0],n=(e[1],new Headers);return n.append("Authorization",t),n.append("Accept","application/json"),n.append("x-skype-client",i.default.getClientVersion()),n.append("x-ms-correlation-id",s.guid.generate()),n.append("x-ms-client-type","Web"),n.append("x-ms-client-version",i.default.getClientVersion()),n.append("x-ms-client-user-agent","swc"),n.append("content-type","application/json;charset=UTF-8"),n.append("BehaviorOverride","redirectAs404"),n}):(a.default.throwError(o.ErrorCodes.ERR_UNIFIED_PRESENCE_NO_AAD,"Unable to get AAD Token"),Promise.reject("Unable to get AAD Token"))};t.post=function(e,t,n){return f().then(function(i){return h(e,t,{method:"POST",cache:"no-cache",headers:i,body:n}).then(function(e){return e.json()})})},t.get=function(e,t){return f().then(function(n){var i={method:"GET"};return i.headers=n,h(e,t,i).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=this;this.execCallback=function(){if(n._callback){var e=n.reset.bind(n);return n._callback().then(e,e)}return n.reset(),Promise.resolve()},this.reset=function(){n._callback=null,n._toRelogin=!1},this.setContext(e,t)}return e.prototype.setContext=function(e,t){this._toRelogin=e,this._callback=t},Object.defineProperty(e.prototype,"canRelogin",{get:function(){return this._toRelogin},enumerable:!0,configurable:!0}),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o={retryCount:3,timeout:12e4,policy:""},a=function(){function e(){}return e.getGuestToken=function(t){var n={name:t};return new Promise(function(t,i){e.request("POST","users/guests/lwc",n).then(function(e){e.json().then(function(e){t(e)}).catch(function(e){i(e)})},function(e){i(e)})})},e.request=function(e,t,n){var a={};a.method=e,a.body=JSON.stringify(n);var s=new Headers;return s.append("Content-Type","application/json"),s.append("X-Skype-Caller",i.default.getUiVersion()),a.headers=s,r.default("scom-invite",o,i.default.INVITE_HOST_URL+t,a)},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o={retryCount:3,timeout:12e4,policy:""},a=function(){function e(){}return e.exchangeForSkypeToken=function(e){var t={method:"post",headers:{Authorization:e,"x-ms-client-type":"web","x-ms-user-type":"user"}};return r.default("teams-exchange",o,i.default.TEAMS_URL+"beta/auth/skypetoken",t)},e.fetchGuestTokenForTenant=function(e){var t={method:"post",body:JSON.stringify({tenantId:e})};return r.default("teams-anonymout",o,i.default.TEAMS_AUTH_URL+"v1.0/authz/visitor",t)},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(8),s=function(e){function t(){return e.call(this,"qos_signin_complete")||this}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(o.TelemetryPropertyValue.Create("status",this.status)),e.push(o.TelemetryPropertyValue.Create("origin",this.authOrigin)),e.push(o.TelemetryPropertyValue.Create("ttc",this.ttc>=0?this.ttc:a.NA)),e.push(o.TelemetryPropertyValue.Create("errorMessage",this.errorMessage||a.NA)),e},t}(a.TelemetryEvent);t.SignInEvent=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(8),s=function(e){function t(){return e.call(this,"qos_signout_complete")||this}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(o.TelemetryPropertyValue.Create("status",this.status||a.NA)),e.push(o.TelemetryPropertyValue.Create("origin",this.origin||a.NA)),e.push(o.TelemetryPropertyValue.Create("ttc",this.ttc>=0?this.ttc:a.NA)),e.push(o.TelemetryPropertyValue.Create("errorMessage",this.errorMessage||a.NA)),e},t}(a.TelemetryEvent);t.SignOutEvent=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.Cache=10]="Cache",e[e.SilentLogin=20]="SilentLogin",e[e.Popup=30]="Popup",e[e.Guest=40]="Guest",e[e.UserLogout=50]="UserLogout",e[e.External=60]="External",e[e.WX=70]="WX",e[e.AAD=80]="AAD"}(t.AuthSource||(t.AuthSource={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.isRelogin=!1}return e.prototype.reset=function(){this.isRelogin=!1,this.signoutPromise=null},e}();t.default=i},function(e,t){!function(){"use strict";var e,t,n,i,r,o,a,s,c,l,u,d,p,h,f,g,m,_,v;void 0===window.SKYPE&&(window.SKYPE={}),window.SKYPE.login=window.SKYPE.login||{},window.SKYPE.login.Silent=(n={qa:"https://a.qa.lw.skype.net",live:"https://a.lw.skype.com"},i=null,r={},o=null,a=null,s="",c=!1,l=!1,u=null,d={env:"live",client_id:null,redirect_uri:null},p=function(e,t){if(null===u&&(u=window.location.host.match(/^(pre|dev|qa).*\.net$/)||document.cookie.indexOf("debug")>-1||window.location.search.indexOf("debug")>-1),u)try{if("object"==typeof t){var n=[];for(var i in t)"skypetoken"===i?n.push(i+": <HIDDEN>"):n.push(i+": "+JSON.stringify(t[i]));e+=" - "+n.join(", ")}else"string"==typeof t&&(e+=" - "+t);e="[silentlogin.js] - "+e}catch(e){}},h=function(e){if(p("Received message from "+e.origin),a&&e.origin===a){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){}p("Message data",t);var n=t.state||null;if(s===n){for(var i in window.clearTimeout(o),r={},t)t.hasOwnProperty(i)&&(r[i]=t[i]);g()}else p("State "+n+" doesn't match the last submitted state "+s)}},f=function(){i&&(e.removeChild(i),i=null)},g=function(){p("Calling callback function",r),l=!1,"function"==typeof t&&t(r)},m=function(){f(),(r={}).error="timeout",g()},_=function(){var e=(new Date).getTime(),t=n;s="silentloginsdk_"+e;var i={response_type:"postmessage",client_id:d.client_id,partner:"999",redirect_uri:d.redirect_uri,state:s,_accept:"1.0",_nc:e};return(a=t[d.env]||t.live)+"/login/silent?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(i)},{init:function(e){if("object"==typeof e)for(var t in(e=e||{}).hasOwnProperty("callback")&&v(e.callback),d)e.hasOwnProperty(t)&&(d[t]=e[t]);return c||(c=!0,window.addEventListener?window.addEventListener("message",h,!1):window.attachEvent("onmessage",h)),this},setCallback:v=function(e){return"function"==typeof e&&(t=e),this},load:function(){if(!l){if(function(){if(!d.client_id)throw"[silentlogin.js] client_id not initialized. Call init() first.";d.redirect_uri||(d.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)}(),l=!0,!("postMessage"in window&&"object"==typeof JSON&&JSON.parse))return r={error:"unsupported_browser"},void g();var t;window.clearTimeout(o),o=window.setTimeout(m,2e4),t=_(),f(),void 0===e&&(e=document.body||document.head||document.getElementsByTagName("head")[0]),(i=document.createElement("iframe")).frameBorder=0,i.width="1px",i.height="1px",i.style.display="none",i.style.visibility="hidden",i.id="silentLoginFrame"+Math.floor(10*Math.random()+1),i.setAttribute("src",t),e.appendChild(i),p("Created iFrame: "+t)}},getSkypetoken:function(){return r.skypetoken||null},getFullResponse:function(){return r}})}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(6),s=n(18),c=n(40),l=n(13),u=n(0),d=n(14),p=n(42),h=n(3),f=n(141),g=n(58),m=n(276),_=n(47),v={Text:1,RichText:1,"RichText/UriObject":1,"RichText/Media_GenericFile":1,"Event/Call":1,"Signal/Flamingo":1,"RichText/Html":1},y={"Event/Call":1,"Signal/Flamingo":1},S={CallEndMsg:1,MissedCallMsg:1,MissedGroupCallMsg:1,CallMsg:1},E=function(e){function t(t){var n=e.call(this)||this;return n._avatar="",n._isBlocked=!1,n._contentRegisteredToHitAlert=function(e){var t=!1,i=e.alertmatches?e.alertmatches.split(" "):[];if(I(e))for(var r=n.lastMessage.content&&n.lastMessage.content.toLowerCase(),o=0;o<i.length;o++)r.indexOf(i[o].toLowerCase())>-1&&(t=!0);return t},n._showNotification=function(e){return!(!n.isUnread||n.isBlocked)&&(!!n._contentRegisteredToHitAlert(e)||!n.alertsOff)},n._isConversationUnread=function(e,t,i){return!n.isPstn&&(i.customType&&S[i.customType]?n._isUnread:!!v[i.messagetype]&&(!C(i)&&(!!i.content&&(!t.consumptionhorizon&&"AcceptPendingRecipient"===t.conversationstatus||!T(t.consumptionhorizon,i)&&(!y[i.messagetype]||n._isUnread)))))},n._isRawConversationUnread=function(e){return n._isConversationUnread(e.id,e.properties,e.lastMessage)},n._id=t.id,n.isPstn=n._id.indexOf("4:")>-1,n.isAgent=n.id.indexOf("28:")>-1||n.id.indexOf("99:")>-1,n._lastMessage=t.lastMessage,n._isUnread=n._isRawConversationUnread(t),n._properties=t.properties,n._alertsOff=I(t.properties),n._isBlocked=A(t.properties),n._threadProperties=t.threadProperties,n._participants=new c.ObservableCollection,n.fillWithData(t),n}return r(t,e),t.prototype.setTeamsTitle=function(e){var t=this;if(!e||!e.topic)return this.topic;var n=e.topic;n&&n.indexOf(h.default.mePerson.mri)>-1&&(n=(n=n.replace(h.default.mePerson.mri+", ","")).replace(", "+h.default.mePerson.mri,""));var i=n&&n.match(/\d+\:?[a-zA-Z]{0,}\:[a-zA-Z0-9\-_]+/g),r=n;return i&&i.forEach(function(e){var n=h.default.persons.getPerson(e,!0);if(n.displayName)r=r.replace(e,n.displayName);else{var i=function(){n.unsubscribe("displayName",i),t.topic=t.topic.replace(e,n.displayName)};n.subscribe("displayName",i)}}),this.topic=r||this.topic,this.topic},t.prototype.setTeamsGroupAvatar=function(e){e&&!this.avatar&&(this._groupAvatarHelper||(this._groupAvatarHelper=new m.default(this)),this._groupAvatarHelper.members=e,this._groupAvatarHelper.fetch())},t.prototype.fillWithData=function(e){var t=this;if(this.isGroup){var n=e.threadProperties&&e.threadProperties.picture?e.threadProperties.picture:"";if(n?this.avatar=n:a.default.get.backend===l.MessagingBackend.TEAMS&&e.members&&this.setTeamsGroupAvatar(e.members),a.default.get.backend===l.MessagingBackend.TEAMS?this.setTeamsTitle(e.threadProperties):this.topic=e.threadProperties?e.threadProperties.topic:"",e.threadProperties&&e.threadProperties.members){var i=void 0;try{i=JSON.parse(e.threadProperties.members)}catch(e){}if(!i||!i.length)return;i.forEach(function(e){if("string"==typeof e){var n=h.default.persons.getPerson(e,!0);if(!t.participants.some(function(e){return e.person.id===n.id})){var i=new g.default(n);t.participants.pushObservable(i),n.isAgent&&u.swc.API.triggerEvent(o.ApiEvents.BotAddedToThread,n.id)}}})}}else{var r=h.default.persons.getPerson(e.id,!0);r&&(this.avatar=r.avatarData,this.topic=r.displayName||r.id,this.isBlocked=r.isBlocked,r.subscribe("displayName",function(e){t.topic=e}),r.subscribe("avatarData",function(e){t.avatar=e}),r.subscribe("isBlocked",function(e){t.isBlocked=e}))}this.members=e.members},t.prototype.update=function(e){this._id===e.id&&(e.threadProperties&&(this.topic=a.default.get.backend===l.MessagingBackend.TEAMS?this.setTeamsTitle(e.threadProperties):e.threadProperties.topic||this.topic,e.threadProperties.picture&&(this.avatar=e.threadProperties.picture||this.avatar)),this._properties=e.properties||this._properties,this._threadProperties=e.threadProperties||this._threadProperties,this.isBlocked=A(e.properties),this.updateLastMessage(this._properties,e.lastMessage))},t.prototype.updateThread=function(e){this._id===e.id&&(this.members=e.members,e.properties&&(this.topic=a.default.get.backend===l.MessagingBackend.TEAMS?this.setTeamsTitle(e.properties):e.properties.topic||this.topic,e.properties.picture&&(this.avatar=e.properties.picture.replace("URL@","")||this.avatar),this._historyDisclosed=e.properties.historydisclosed,this._threadProperties=e.properties),a.default.get.backend===l.MessagingBackend.TEAMS&&e.members&&this.setTeamsGroupAvatar(e.members))},t.prototype.updateFromMessage=function(e){this.updateLastMessage(this._properties,e),"ThreadActivity/TopicUpdate"===e.messagetype&&(this.topic=e.threadtopic)},t.prototype.updateLastMessage=function(e,t){var n=this;this.lastMessage=t,this.alertsOff=I(e),this.isUnread=this._isConversationUnread(this.id,e,this.lastMessage),this._showNotification(e)&&setTimeout(function(){n.isUnread&&n._isConversationUnread(n.id,n._properties,n.lastMessage)&&h.default.notificationsManager.registerUnreadMessage(n,t)},3e3)},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topic",{get:function(){return this._topic},set:function(e){e!==this._topic&&(this._topic=d.default.parseTopic(e),this.publish("topic",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"threadProperties",{get:function(){return this._threadProperties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"members",{get:function(){return this._members},set:function(e){this._members=e,this.publish("members",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alertsOff",{get:function(){return this._alertsOff},set:function(e){e!==this._alertsOff&&(this._alertsOff=e,this.publish("alertsOff",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnread",{get:function(){return this._isUnread},set:function(e){e!==this._isUnread&&(this._isUnread=e,this.publish("isUnread",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this._avatar},set:function(e){(e=p.default.resolveConversationAvatar(this.isGroup,e))&&e!==this._avatar&&(this._avatar=e,this.publish("avatar",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastMessage",{get:function(){return this._lastMessage},set:function(e){this._lastMessage=e,this.publish("lastMessage",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGroup",{get:function(){return/^19:/.test(this.id)},enumerable:!0,configurable:!0}),t.prototype.setConsumptionHorizon=function(e){this._properties.consumptionhorizon=e},t}(s.default);t.ConversationObservable=E,t.default=E;var T=function(e,t){if(!e)return!1;var n=new f.ConsumptionHorizon;n.set(e);var i=t.skypeeditedid||t.clientmessageid||t.messageid||t.id||"0",r=n.lastReadMessageId===i||""===n.lastReadMessageId||n.lastReadMessageId===t.id,o=new Date(t.originalarrivaltime).getTime();t.skypeeditedid&&+t.skypeeditedid>0&&(o=new Date(+t.skypeeditedid).getTime());var a=n.lastReadMessageTimestamp>=o;return r||a},C=function(e){return!!e.from&&_.normalizePersonId(d.default.getSenderIdFromUrl(e.from))===h.default.signInManager.currentUserName},I=function(e){return!!e.alerts&&/false/i.test(e.alerts)},A=function(e){return!!e.conversationblocked&&"true"===e.conversationblocked.toLocaleLowerCase()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=function(){function e(e){var t=this;this.conversation=e,this.missingNamesCount=0,this.timeout=-1,this.displayNameHanlder=function(e,n){t.missingNamesCount--,0===t.missingNamesCount&&t.fetchMergedAvatar(t._selectedPeople)},this.fetchMergedAvatar=function(e){clearTimeout(t.timeout);var n=e.map(function(e){return e.unsubscribe("displayName",t.bindedDsiplayNameHandler),{userId:e.mri,displayName:e.displayName}});i.default.avatarService.fetchMergedAvatars(n).then(function(e){t.conversation.avatar=e||t.conversation.avatar},function(e){})},this.bindedDsiplayNameHandler=this.displayNameHanlder.bind(this)}return e.prototype.fetch=function(){var e=this,t=this.members.filter(function(e){return e.id!==i.default.mePerson.mri});this.members.length>4&&(t=t.slice(0,3)),this._selectedPeople=t.map(function(t){var n=i.default.persons.getPerson(t.id,!0);return n.displayName||(e.missingNamesCount++,n.subscribe("displayName",e.bindedDsiplayNameHandler)),n}),this.missingNamesCount>0?this.timeout=setTimeout(function(){if(e.missingNamesCount>0){var t=e._selectedPeople.filter(function(e){return!!e.displayName});t.length&&e.fetchMergedAvatar(t)}},5e3):this.fetchMergedAvatar(this._selectedPeople)},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(137),s=n(17),c=n(10),l=n(11),u=n(19),d=n(16),p=n(278),h=n(3),f=n(136),g=n(106),m=n(53),_=[g.ThreadType.Chat,g.ThreadType.SfbInterop],v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.guessThreadType=function(e,t){return 1===t||-1!==e.indexOf("@sfb.unq.gbl.spaces")?g.ThreadType.SfbInterop:g.ThreadType.Chat},t.fetchMessagesByLink=function(e){return-1===e.indexOf("startTime")&&(e=u.default.appendQueryParam(e,"startTime",0)),a.getPolling().authorization.then(function(){return m.getWithDomain("fetchMessagesByLink",e).then(function(e){return m.parseJson(e)})},console.warn)},t}return r(t,e),t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._fetchRecentsPromise&&this._fetchRecentsPromise.status===s.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var i=h.default.signInManager.aad("https://chatsvcagg.teams.microsoft.com").then(function(i){return h.default.signInManager.onceSignedIn().then(function(){return d.default("teams-recents",{retryCount:1,timeout:12e4,policy:""},"https://chatsvcagg.teams.microsoft.com/api/v1/teams/users/me/chats?isPrefetch=false&enableMembershipSummary=false",{method:"get",headers:{Authorization:i,"x-ms-client-type":"web","x-ms-user-type":"user"}}).then(function(i){return i?i.json&&i.json().then(function(e){var t=[],i=[],r={};return e.forEach(function(e){var o=n.toSkypeConversation(e);t.push(o),e.members.forEach(function(e){!r[e.mri]&&e.displayName&&(r[e.mri]=!0,i.push(e))})}),{conversations:t,users:i,_metadata:{},hasMoreConversations:!1}},function(i){return n.fetchRecentConversationsFallback(e,t)}):n.fetchRecentConversationsFallback(e,t)},function(i){return n.fetchRecentConversationsFallback(e,t)})},function(){n._fetchRecentsPromise.cancel(),n._fetchRecentsPromise=null})},function(){});return this._fetchRecentsPromise=new s.CancelablePromise(i),this._fetchRecentsPromise.promise},t.prototype.toSkypeConversation=function(e){var t=e.consumptionHorizon,n=t?t.timeStamp+";"+t.originalArrivalTime+";"+t.clientMessageId:void 0,i=e.lastMessage;return{id:e.id,lastMessage:{id:i.id,clientmessageid:i.clientMessageId,from:i.from,messagetype:i.messageType,originalarrivaltime:i.originalArrivalTime,content:i.content,composetime:i.composeTime,version:i.version+"",messageid:i.id},isOneOnOne:e.isOneOnOne,properties:{consumptionhorizon:n,picture:"",lastimreceivedtime:""},threadProperties:{topic:e.title,picture:"",historydisclosed:!0,threadType:this.guessThreadType(e.id,e.interopType)},version:e.version,members:e.members.map(function(e){return{id:e.mri,role:e.role,name:e.displayName}})}},t.prototype.fetchRecentConversationsFallback=function(e,t){var n=this;if(void 0===e&&(e=1),void 0===t&&(t=100),!this._fetchRecentsPromise||this._fetchRecentsPromise.status!==s.PromiseStatus.Pending){return Promise.resolve({conversations:[],_metadata:{},hasMoreConversations:!1})}var i={view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",pageSize:t,startTime:e};this.syncState?i.syncState=this.syncState:i.targetType="Passport|Skype|Lync|Thread|Agent|ShortCircuit|PSTN|SmsMms|Flxt|NotificationStream|Highlights|Cast|CortanaBot|ModernBots|InviteFree";var r=m.addGetParamsToUrl("users/ME/conversations",i);return m.get("fetchRecents-teams",r).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||m.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.threadProperties&&(t=e.threadProperties.threadType,_.some(function(e){return e===t}));var t});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){l.default.throwError(c.ErrorCodes.ERR_PARSE_RESPONSE2,"fetchRecentConversationsFallback unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)}),this._fetchRecentsPromise=new s.CancelablePromise,this._fetchRecentsPromise.promise},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var i={pageSize:t,view:"msnp24Equivalent|supportsMessageProperties",startTime:n},r=m.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",i);return a.getPolling().authorization.then(function(){return m.get("fetchMessages",r).then(function(e){return m.parseJson(e).then(function(e){return e})})})},t.prototype.sendMessage=function(t,n){var i=o({},n,{messagetype:n.messagetype===g.MessagePayloadType.RichText?g.MessagePayloadType.RichTextHtml:n.messagetype});if(p.isInteropEnabled(t)){if(n.messagetype===g.MessagePayloadType.ControlTyping||n.messagetype===g.MessagePayloadType.ControlClearTyping)return Promise.reject("Typing not supported in SFB");i=p.addInteropDataToMessage(t,n)}return e.prototype.sendMessage.call(this,t,i)},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t,i=m.addGetParamsToUrl(n,{behavior:"softDelete"});return m.del("deleteMessage",i)},t.prototype.addParticipant=function(e,t,n){var i="threads/"+e+"/members",r={members:[{id:t,role:"Admin",shareHistoryTime:-1}]};return m.post("addParticipant",i,{body:JSON.stringify(r)})},t.prototype.createThread=function(e){e.forEach(function(e){return e.role="Admin"});var t={members:e,properties:{chatFilesIndexId:2,threadType:"chat"}};2===e.length&&(t.properties=o({},t.properties,{fixedRoster:!0,uniquerosterthread:!0}));var n={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify(t)};return m.post("thread","threads",n)},t}(f.ConversationConsumerWebApi);t.ConversationTeamsWebApi=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(279))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),r=n(106);t.isInteropEnabled=function(e){return-1!==e.indexOf("@sfb.unq.gbl.spaces")},t.addInteropDataToMessage=function(e,t){try{var n=i.getServices().conversations.get(e,{}),c=a(n).email,l=s(n).mri;return t={clientmessageid:t.clientmessageid,content:t.content,contenttype:t.contenttype,messagetype:r.MessagePayloadType.Text,amsreferences:t.amsreferences||[],imdisplayname:t.imdisplayname,properties:{importance:"",interopType:"receiverSfB",subject:null},fromSipUri:"sip:"+c,toSipUri:"sip:"+o(l)}}catch(e){}return t};var o=function(e){var t=i.getServices().contactsService.getContactByMri(e);return t?t.email:void 0},a=function(e){return e.selfParticipant.person},s=function(e){var t,n=e.selfParticipant.person.mri;return e.participants.some(function(e){return e.person.mri!==n&&(t=e.person,!0)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(23),o=n(17),a=n(3),s=n(142),c=function(){function e(){var e=this;this._contactsByEmail=[],this._haveAllContactsByEmail=!1,this.fetchContactsByMail=function(t,n,i){void 0===t&&(t=100),void 0===n&&(n=10);var r=0;if(e._fetchContactsByMailPromise)return i&&i(e._contactsByEmail),e._fetchContactsByMailPromise.promise;var s=new Promise(function(o,s){var c=function(){if(!e._fetchContactsByMailPromise||!e._fetchContactsByMailPromise.isCanceled){a.default.microsoftGraphService.fetchCommonEmails(t,r*t).then(function(a){if(!e._fetchContactsByMailPromise.isCanceled)if(a&&a.value){if(0===a.value.length)return void(e._haveAllContactsByEmail=!0);var l=[];a.value.forEach(function(e){e.scoredEmailAddresses.forEach(function(e){l.push(e.address)})}),e.getContactsByEmail(l).then(function(a){if(!e._fetchContactsByMailPromise.isCanceled){if(!a.ok){var u={code:a.status,message:a.statusText};return s(u),void(e._fetchContactsByMailPromise=null)}a.json().then(function(u){return function(u){if(!u)return e._haveAllContactsByEmail=!0,void(e._contactsByEmail?o(e._contactsByEmail):(s({status:a.status,statusText:a.statusText}),e._fetchContactsByMailPromise=null));i&&i(u.contacts),e._contactsByEmail=e._contactsByEmail.concat(u.contacts),e._haveAllContactsByEmail=e._haveAllContactsByEmail||e._contactsByEmail.length>=n||l.length<t,e._haveAllContactsByEmail?o(e._contactsByEmail):(r++,c())}(u)},function(t){s(t),e._fetchContactsByMailPromise=null})}}).catch(function(e){s(e)})}else e._contactsByEmail?o(e._contactsByEmail):(s({status:0,statusText:"No emails to get skypeIds"}),e._fetchContactsByMailPromise=null)}).catch(function(e){s(e)})}};a.default.signInManager.onceSignedIn().then(c.bind(e))});return e._fetchContactsByMailPromise=new o.CancelablePromise(s),e._fetchContactsByMailPromise.promise},a.default.signInManager.subscribe("state",function(t){t===r.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchContactsByMailPromise",{get:function(){return this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.promise},enumerable:!0,configurable:!0}),e.prototype.getContactsByEmail=function(e){var t={Emails:e};return s.post("fetchContactsByEmail","scdemaillookup",JSON.stringify(t),i.default.CONTACTS_SCD_HOST_URL)},e.prototype.dispose=function(){this._contactsByEmail=[],this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.status===o.PromiseStatus.Pending&&this._fetchContactsByMailPromise.cancel(),this._fetchContactsByMailPromise=null},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(2);t.getHeaders=function(){return new Promise(function(e){i.default.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),n.append("X-Skype-Caller",r.default.getUiVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(2),o=n(23),a=n(17),s=n(10),c=n(13),l=n(11),u=n(283),d=n(3),p=n(284),h=n(142),f=n(42),g="X-Skype-Continuation-Token",m=function(){function e(){var e=this;this._contacts=[],this._groups=[],this._blocklist=[],this._pendingContactFetching={},this._haveAllContacts=!1,this.fetchMyContacts=function(t,n){void 0===t&&(t=100);var i=new u.default,r=Date.now(),o=0;if(e._fetchContactsPromise)return n&&n(e._contacts),e._fetchContactsPromise.promise;var c=new p.ContactsInfo,h=new Promise(function(a,u){var p=function(h){if(o++,!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){var f=Date.now(),m=d.default.signInManager.currentUserName;e.fetchContacts(m,t,h).then(function(h){if(!e._fetchContactsPromise.isCanceled){if(!h.ok){var m={code:h.status,message:h.statusText};return l.default.throwError(s.ErrorCodes.ERR_FETCH_CONTACTS_MAIN,"Unable to fetch contacts",m),u(m),void(e._fetchContactsPromise=null)}h.json().then(function(s){return function(s){if(e._haveAllContacts=!0,!s)return e._contacts?a(c):(u({status:h.status,statusText:h.statusText}),e._fetchContactsPromise=null),i.status=h.status,i.pages=o,void d.default.telemetryManager.sendEvent(i);s.duration=Date.now()-f,c.update(s);var l={"If-None-Match":"/"};n&&n(s.contacts);var m=h.headers.get(g);return m?(l[g]=m,p(l)):(s.contacts=e._contacts=c.contacts.getItems(),s.groups=e._groups=c.groups.getItems(),s.blocklist=e._blocklist=c.blocklist.getItems(),s.scope=c.firstScope,s.duration=c.duration,a(s),i.ttl=Date.now()-r,i.total=s.contacts.length,i.blocked=s.blocklist.length,i.groups=s.groups.length,i.agents=c.filter(28).length,i.pstn=c.filter(4).length,i.person=c.filter(8).length,i.status=h.status,i.pages=o,i.pageSize=t,d.default.telemetryManager.sendEvent(i),void e.createPersonForAllContacts())}(s)},function(t){l.default.throwError(s.ErrorCodes.ERR_FETCH_CONTACTS_MAIN,"Unable to fetch contacts",t),u(t),e._fetchContactsPromise=null,i.status=h.status,i.error=t,d.default.telemetryManager.sendEvent(i)})}})}};d.default.signInManager.onceSignedIn().then(p.bind(e))});return e._fetchContactsPromise=new a.CancelablePromise(h),e._fetchContactsPromise.promise},this.fetchContacts=function(e,t,n){if(void 0===t&&(t=100),i.default.get.backend===c.MessagingBackend.TEAMS)return Promise.resolve({status:200,statusText:"Aad is here"});var r="users/"+encodeURIComponent(e)+"?page_size="+t+"&reason=default";return h.getRaw("fetchContacts",r,n)},this.getContact=function(t,n){if(e._fetchContactsPromise&&e._fetchContactsPromise.status===a.PromiseStatus.Pending)return e._fetchContactsPromise.promise.then(function(){for(var t,i=0;i<e._contacts.length;i++)if(e._contacts[i].mri===n){t=e._contacts[i];break}return t});if(e._pendingContactFetching[n])return e._pendingContactFetching[n];for(var i,r=0;r<e._contacts.length;r++)if(e._contacts[r].mri===n){i=e._contacts[r];break}return i?(delete e._pendingContactFetching[n],Promise.resolve(i)):e._haveAllContacts?Promise.resolve():(e._pendingContactFetching[n]=new Promise(function(i,r){e.fetchContact(t,n).then(function(t){return t.json().then(function(t){var r,o=t.contacts||[];t.contacts&&t.contacts.length&&e._contacts.push(o),delete e._pendingContactFetching[n];for(var a=0;a<o.length;a++)if(o[a].mri&&o[a].mri===n){r=o[a];break}i(r)},function(t){delete e._pendingContactFetching[n],l.default.throwError(s.ErrorCodes.ERR_FETCH_CONTACT_MAIN,"Unable to fetch contact",t),r(t)})},function(t){delete e._pendingContactFetching[n],l.default.throwError(s.ErrorCodes.ERR_FETCH_CONTACT_MAIN,"Unable to fetch contact",t)})}),e._pendingContactFetching[n])},this.fetchContact=function(e,t){if(i.default.get.backend===c.MessagingBackend.TEAMS)return Promise.resolve({status:200,statusText:"Aad is here"});var n=f.default.normalizePersonId(t),r="users/"+e+"/contacts?$filter=mri%2Fnamespace+eq+%27"+f.default.parsePersonId(t).type+"%27+and+mri%2Fidentifier+eq+%27"+n+"%27";return h.getRaw("fetchContact",r)},d.default.signInManager.subscribe("state",function(t){t===o.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchMyContactsPromise",{get:function(){return this._fetchContactsPromise&&this._fetchContactsPromise.promise},enumerable:!0,configurable:!0}),e.prototype.addContact=function(e,t){var n="users/"+d.default.signInManager.currentUserName+"/contacts",i={mri:e,greeting:t};return h.post("addContact",n,JSON.stringify(i))},e.prototype.blockContact=function(e,t,n){var i=this;void 0===t&&(t=!0),void 0===n&&(n="spam");var o=d.default.signInManager.currentUserName,a="users/"+o+"/contacts/blocklist/"+e,s={delete_contact:!1,report_abuse:t,ui_version:r.default.getUiVersion(),reason:n};return this.invalidateCache(),t?h.put("blockContact",a,JSON.stringify(s)).then(function(){return i.reportAbuse(o,e,n)}):h.put("blockContact",a,JSON.stringify(s))},e.prototype.reportAbuse=function(e,t,n){void 0===n&&(n="spam");var i="users/"+e+"/contacts/"+t+"/report",o={ui_version:r.default.getUiVersion(),reason:n,report_context:"contact_request",content:{hash:"af94h"}};return h.post("reportAbuse",i,JSON.stringify(o))},e.prototype.unblockContact=function(e){var t="users/"+d.default.signInManager.currentUserName+"/contacts/blocklist/"+e;return this.invalidateCache(),h.deleteMethod("unblockContact",t)},e.prototype.invalidateCache=function(){this._fetchContactsPromise&&(this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null),this.fetchMyContacts()},e.prototype.getContactByMriIfPresent=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0].display_name:null},e.prototype.getContactByMri=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},e.prototype.createPersonForAllContacts=function(){var e=this;return this._fetchContactsPromise?this._fetchContactsPromise.promise.then(function(){e._contacts.forEach(function(e){var t=d.default.persons.getPerson(e.mri||e.id,!1);t.displayName=e.display_name,t.avatarData=e.avatar_url,t.isBlocked=e.blocked})}):Promise.resolve()},e.prototype.getBlockedList=function(){return this._fetchContactsPromise?this._fetchContactsPromise.promise.then(function(e){return e.blocklist}):Promise.resolve()},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._contacts},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._contacts=[],this._groups=[],this._blocklist=[],this._fetchContactsPromise&&this._fetchContactsPromise.status===a.PromiseStatus.Pending&&this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null},e}();t.default=m},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=function(e){function t(){return e.call(this,"contacts_load_qos")||this}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(o.TelemetryPropertyValue.Create("total",this.total)),e.push(o.TelemetryPropertyValue.Create("blocked",this.blocked)),e.push(o.TelemetryPropertyValue.Create("groups",this.groups)),e.push(o.TelemetryPropertyValue.Create("pstn",this.pstn)),e.push(o.TelemetryPropertyValue.Create("person",this.person)),e.push(o.TelemetryPropertyValue.Create("agents",this.agents)),e.push(o.TelemetryPropertyValue.Create("pages",this.pages)),e.push(o.TelemetryPropertyValue.Create("pageSize",this.pages)),e.push(o.TelemetryPropertyValue.Create("ttl",this.ttl)),e.push(o.TelemetryPropertyValue.Create("status",this.status)),e.push(o.TelemetryPropertyValue.Create("error",this.error)),e.push(o.TelemetryPropertyValue.Create("successful",this.status<400||!this.error)),e},t}(n(8).TelemetryEvent);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.items=[],this.key=e}return e.prototype.reset=function(){this.items=[]},e.prototype.add=function(e,t){var n=this;e&&(e.forEach(function(e){n.items=n.items.filter(function(t){return t[n.key]!==e[n.key]})}),t&&(e=e.filter(function(e){return!e.deleted})),this.items=this.items.concat(e))},e.prototype.getItems=function(){return this.items},e.prototype.getItemsByType=function(e){return this.items.filter(function(t){return 0===t.person_id.indexOf(e+":")})},e}(),r=function(){function e(){this.callCount=0,this.contacts=new i("mri"),this.blocklist=new i("mri"),this.groups=new i("id"),this.duration=0,this.firstScope=""}return e.prototype.reset=function(){this.firstScope="",this.contacts.reset(),this.groups.reset(),this.blocklist.reset()},e.prototype.update=function(e){this.callCount++,e&&(this.callCount>1&&"full"===e.scope&&this.reset(),e.scope&&!this.firstScope&&(this.firstScope=e.scope),this.contacts.add(e.contacts,!0),this.groups.add(e.groups,!1),this.blocklist.add(e.blocklist,!0))},e.prototype.filter=function(e){return this.contacts.getItemsByType(e)},e}();t.ContactsInfo=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(23),s=n(21),c=n(32),l=n(43),u=n(35),d=100,p="8:echo123",h=function(e){function t(){var t=e.call(this)||this;return t._contactsData={contacts:[],blocked:[],groups:[]},t._fetchContactsResolved=!1,t.fetchMyContacts=function(e){return t._fetchContactsResolved?new Promise(function(e){e(t._contactsData)}):t._contactsService.fetchMyContacts(d).then(function(e){if(!t._fetchContactsResolved){var n=e.contacts.filter(function(e){return!(e.mri.indexOf("4:")>-1)&&e.mri!==p});t._contactsData.groups=e.groups,t._contactsData.contacts=n.map(function(e){return{skypeid:e.mri,name:e.display_name,favorite:e.favorite,normalized_name:u.default.normalizeString(e.display_name),avatar:e.profile&&e.profile.avatar_url?e.profile.avatar_url:"",type:l.default.getContactType({mri:e.mri})}}),e.blocklist&&(t._contactsData.blocked=e.blocklist.map(function(e){return{skypeid:e.mri}})),t._fetchContactsResolved=!0}return t._contactsData},function(e){})},t.isPersonContact=function(e){return new Promise(function(n,i){t._isPersonContactPromiseRejectCallback=i,o.default.instance.SignInManager.getSkypeToken().then(function(i){var r=o.default.instance.SignInManager.currentUserName;if(o.default.instance.SignInManager.userIdentityType===c.IdentityType.GUEST)return n(!0);t._contactsService.getContact(r,e).then(function(i){t._isPersonContactPromiseRejectCallback=null,n(t.isContact(i,e))},function(e){t._isPersonContactPromiseRejectCallback(!1),t._isPersonContactPromiseRejectCallback=null})},t._isPersonContactPromiseRejectCallback.bind(t,{source:"onSigninFailed"}))})},t.addContact=function(e,n){return t._contactsService.addContact(e,n)},t.blockContact=function(e,n,i){return t._contactsService.blockContact(e,n,i)},t.unblockContact=function(e){return t._contactsService.unblockContact(e)},t.getBlockedlist=function(){return t._contactsService.getBlockedList()},t.signinStateChangedHandler=function(){o.default.instance.SignInManager.state===a.SigninState.SignedOut&&(t._contactsService.dispose(),t._isPersonContactPromiseRejectCallback&&t._isPersonContactPromiseRejectCallback({source:"signout"}),t._contactsData={blocked:[],groups:[],contacts:[]},t._fetchContactsResolved=!1)},t.isContact=function(e,t){return!!e&&(!!e&&e.mri===t&&e.authorized)},t._contactsService=t.getServices().contactsService,t._outlookContactsService=t.getServices().outlookContactsService,o.default.instance.SignInManager.subscribe("state",t.signinStateChangedHandler),t}return r(t,e),t.prototype.dispose=function(){this._contactsService.dispose(),this._isPersonContactPromiseRejectCallback&&this._isPersonContactPromiseRejectCallback({source:"onDispose"}),o.default.instance.SignInManager.unsubscribe("state",this.signinStateChangedHandler)},t}(s.default);t.SkypeContactsManager=h,t.default=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._searchAadDirectory=function(e){return t._searchPromise&&t._searchPromise.status===o.PromiseStatus.Pending&&(t._searchPromise.cancel(),t._searchPromise=null),t._searchKey=e,t._searchPromise=new o.CancelablePromise(t.getServices().teamsGraphService.fetchProfiles(e)),t._searchPromise.promise},t}return r(t,e),t.prototype.searchSkypeDirectory=function(e){var t=function(e){return{nodeProfileData:{avatarUrl:"",city:"",contactType:"",country:"",countryCode:"",language:"",state:"",name:e.displayName,skypeId:e.mri,jobTitle:e.jobTitle,department:e.department,location:e.userLocation},nodeAnnotation:"",nodeConnectionData:{distance:0,mutualFriendCount:0}}},n=function(e){return!!e.mri};return this._searchAadDirectory(e).then(function(e){return{requestId:"",results:e.filter(n).map(t)}})},t}(n(144).default);t.TeamsSearchManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(54),r=n(11),o=n(107),a=n(288),s=n(10),c="polling_failed",l=function(){function e(e,t){var n=this;this.watermark="",this.pollingForWatermarkPromise={},this.initPolling=function(e,t){var a=0,l=0;n._clearPollingTimeout();var u=function(d,p){if(!n.pollingForWatermarkPromise[d]){a++;var h="conversations/"+e+"/activities"+n.watermark,f=n.helper.createParams("GET",n.token),g=n.helper.sendRequest("polling",h,f);n.pollingForWatermarkPromise[d]=g,g.then(function(c){n.helper.isStatusForbidden(c)?l++:c.json().then(function(e){l=0;var r=!1;e.activities=e.activities||{};for(var s=0;s<e.activities.length;s++){var c=e.activities[s];t&&c&&(r=t(c))}if(e.watermark&&(n.watermark="?watermark="+e.watermark),delete n.pollingForWatermarkPromise[d],r||p)return n.pollingTimeout||(n.pollingTimeout=new i.FixedTimeout(u.bind(n,n.watermark,!0),o.CONTINUOUS_POLLING_INTERVAL)),void n.pollingTimeout.start();a<o.MAX_POLLING_RETRIES&&setTimeout(u.bind(n,n.watermark),o.POLLING_INTERVAL)},function(t){delete n.pollingForWatermarkPromise[d],r.default.throwError(s.ErrorCodes.ERR_PARSE_POLLING,"[DL_v3] Unable to parse polling response",t,e)})},function(t){delete n.pollingForWatermarkPromise[d],l>=o.MAX_RETRY_ATTEMPTS?"function"==typeof n.systemMessageCallback&&n.systemMessageCallback(c):(l++,n.pollingTimeout||(n.pollingTimeout=new i.FixedTimeout(u.bind(n,n.watermark,!0),o.CONTINUOUS_POLLING_INTERVAL)),n.pollingTimeout.start(),r.default.throwError(s.ErrorCodes.ERR_INIT_POLLING,"[DL_v3] Unable to init polling",t,e))})}};u(n.watermark)},this.helper=new a.Helper(t?o.V3_BING_HOST_URL:o.V3_HOST_URL);var l=e.split(":");this.token=l.length>1?l[1]:l[0]}return e.prototype.getToken=function(e){var t=this,n=this.helper.createParams("POST",e);return this.helper.sendRequest("getToken","tokens/generate",n).then(function(e){"function"==typeof e.json?e.json().then(function(n){t.updateRefreshTokenTimeout(e)}):t.updateRefreshTokenTimeout(e)})},e.prototype.createConversation=function(){var e=this,t=this.helper.createParams("POST",this.token);return this.helper.sendRequest("createConversation","conversations",t).then(function(t){return e.helper.isStatusForbidden(t)?Promise.reject("Not authorized"):t.json().then(function(t){return e.updateRefreshTokenTimeout(t),t.conversationId},function(t){r.default.throwError(s.ErrorCodes.ERR_CREATE_CONVERSATION,"[DL_v3] Unable to createConversation",t,e.token)})})},e.prototype.setSystemMessagesHandler=function(e){this.systemMessageCallback=e},e.prototype.postMessage=function(e,t,n,i){var a=this;return void 0===i&&(i=0),new Promise(function(c,l){var u=a.helper.createParams("POST",a.token,a.buildPostMessageBody(e,t,n)),d="conversations/"+t+"/activities";a.helper.sendRequest("postMessage",d,u).then(function(r){return a.helper.isStatusForbidden(r)?i>=o.MAX_RETRY_ATTEMPTS?void("function"==typeof a.systemMessageCallback&&a.systemMessageCallback("message_failed")):a.refreshToken().then(function(){return a.postMessage(e,t,n,i+1)}):c(r)},function(e){l(e),r.default.throwError(s.ErrorCodes.ERR_SEND_MESSAGE,"[DL_v3] Unable to sendMessage",e,t)})})},e.prototype._clearPollingTimeout=function(){this.pollingTimeout&&(this.pollingTimeout.reset(),this.pollingTimeout=null)},e.prototype.dispose=function(){this._clearPollingTimeout()},e.prototype.refreshToken=function(){var e=this;return this.helper.sendRequest("refreshToken","tokens/refresh",this.helper.createParams("POST",this.token)).then(function(t){return t.json().then(function(n){return e.updateRefreshTokenTimeout(n),t},function(e){r.default.throwError(s.ErrorCodes.ERR_PARSE_JSON,"[DL_v3] Unable to parse json with token refresh timeout")})},function(e){r.default.throwError(s.ErrorCodes.ERR_SET_TOKEN_REFRESH_TIMEOUT,"[DL_v3] Unable to set token refresh timeout",e)})},e.prototype.buildPostMessageBody=function(e,t,n){return JSON.stringify({type:"message",text:e,from:{id:"user"},channelData:n.channelData})},e.prototype.updateRefreshTokenTimeout=function(e){if(e.expires_in){e.token&&(this.token=e.token),this.refreshTokenTimeout&&clearTimeout(this.refreshTokenTimeout);var t=1e3*(e.expires_in-20);this.refreshTokenTimeout=setTimeout(this.refreshToken.bind(this),t)}else r.default.throwError(s.ErrorCodes.ERR_SET_TOKEN_REFRESH_TIMEOUT,"[DL_v3] Unable to set token refresh timeout")},e}();t.DirectLineV3=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(11),o=n(107),a=n(10),s={retryCount:3,timeout:12e4,policy:""},c=function(){function e(e){var t=this;this.baseUrl=e,this.createParams=function(e,n,i){var r=t.baseUrl===o.V3_HOST_URL||t.baseUrl===o.V3_BING_HOST_URL?"Bearer":"BotConnector",a=new Headers;a.append("Authorization",r+" "+n),a.append("Content-Type","text/json;charset=UTF-8"),a.append("Accept","application/json");var s={};return s.method=e||"POST",s.headers=a,i&&(s.body=i),s}}return e.prototype.sendRequest=function(e,t,n){return i.default("dl-"+e,s,this.baseUrl+t,n)},e.prototype.isStatusForbidden=function(e){return(401===e.status||403===e.status||404===e.status)&&(r.default.throwError(a.ErrorCodes.ERR_GET_CONVERSATION_ID,"Unable to get conversation id, we are DONE. Probably wrong token/secret key.",e),!0)},e}();t.Helper=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(290),r=function(){return function(){this.addAgentToContacts=function(e){var t="api/v1/bots/add/"+e;return i.put("addAgentToContacts",t)}}}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(291),a={retryCount:3,timeout:12e4,policy:""},s=function(e,t,n){return r.default("joinAgents-"+e,a,i.default.AGENTS_HOST_URL+t,n)};t.getResponse=function(e,t){return s(e,t)},t.get=function(e,t){var n={method:"GET"};return function(e,t,n){return r.default("joinAgents-"+e,a,i.default.AGENTS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,n)},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,s(e,t,r)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.putHeaders=function(){var e=new Headers;return new Promise(function(t){i.default.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(6),a={retryCount:3,timeout:12e4,policy:""},s=function(){function e(){}return e.auth=function(e){void 0===e&&(e="customer");var t=new Headers;t.append("Content-Type","application/json");var n={body:JSON.stringify({name:e,lang:"en",greeniddc:"none"})},o=Object.assign({},n);return o.method="POST",o.headers=t,o.cache="no-cache",r.default("join-auth",a,i.default.WX_HOST_URL,o).then(function(e){return e.json()})},e.join=function(e,t){void 0===t&&(t="guest"),0!==e.indexOf("19:")&&(e="19:"+e),0===t.length&&(t="guest");var n=new Headers;n.append("Content-Type","application/json"),n.append("Accept","application"),n.append("Accept-Language","en-US,en;");var s={body:JSON.stringify({name:t,threadId:e,longId:"swc",shortId:"swc",flowId:o.default.get.sessionId})},c=Object.assign({},s);return c.method="POST",c.headers=n,c.cache="no-cache",r.default("join-join",a,i.default.INVITE_HOST_URL_INT+"users/guests/light",c).then(function(e){return e.json()})},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t,!1,!0)||this;return n._isMePerson=!0,n}return r(t,e),Object.defineProperty(t.prototype,"msaId",{get:function(){return this._msaId},set:function(e){e&&(this._msaId=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"personalFileSite",{get:function(){return this._personalFileSite},set:function(e){e&&(this._personalFileSite=e)},enumerable:!0,configurable:!0}),t}(n(145).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(295),r=function(){function e(){}return e.prototype.fetchCommonEmails=function(e,t){void 0===e&&(e=10),void 0===t&&(t=0);var n="people/?$top="+e+"&$skip="+t+"&$Select=scoredEmailAddresses";return i.get("scoredMails",n).then(function(e){return e})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(296),a={retryCount:3,timeout:12e4,policy:""},s=function(e,t,n){return r.default("msGraph-"+e,a,i.default.MS_GRAPH_URL+t,n)};t.postWithoutHeaders=function(e,t,n){var i={method:"GET",cache:"no-cache"};return n&&(i.headers=n),s(e,t,i).then(function(e){return e.json()})},t.get=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",s(e,t,i).then(function(e){return e.json()})},function(e){})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(104),o=n(20),a=n(59),s=n(3),c={clientID:i.default.MS_APP_CLIENT_ID,graphScopes:["People.Read","openid","profile"]},l=function(){return function(e,t,n){var i=JSON.parse(window.sessionStorage.getItem(e)),r=Math.round((new Date).getTime()/1e3);if(i){if(i.expiresIn>r)return Promise.resolve(i.token);window.sessionStorage.removeItem(e)}return new Promise(function(r,o){var a;i&&(a=i.token),n(a).then(function(n){var i={expiresIn:t(n),token:n};window.sessionStorage.setItem(e,JSON.stringify(i)),r(n)}).catch(o)})}("skype|graphAccessToken"+a.hashCode(s.default.signInManager.currentUserName),function(e){return Math.round((new Date).getTime()/1e3)+ +e.expires_in},function(){return new Promise(function(e,t){var n=s.default.signInManager.currentUserName,a=o.guid.generate(),l=i.default.MS_AUTHORIZE_URL,u=i.default.MS_APP_REDIRECT_URL_DEMO;window.location.hostname.toLowerCase().indexOf("outlook")>=0&&(u=i.default.MS_APP_REDIRECT_URL_OUTLOOK);var d={response_type:"token",scope:c.graphScopes.join(" "),client_id:c.clientID,username:n,nonce:a,redirect_uri:u},p=r.addGetParamsToUrl(l,d),h=function(n){if(n.data){window.removeEventListener("message",h);var i=n.data;if(-1!==i.indexOf("access_token")){var r={};i.split("&").forEach(function(e){var t=e.split("="),n=t[0],i=t[1];r[n]=decodeURIComponent(i)}),e(r)}t(i)}};window.addEventListener("message",h),window.open(p,"_blank",i.default.LOGIN_POPUP_FEATURES)})})};t.getHeaders=function(){return new Promise(function(e,t){var n=new Headers;l().then(function(t){n.append("Authorization",[t.token_type,t.access_token].join(" ")),e(n)}).catch(function(e){t(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(10),o=n(0),a=n(11),s=n(33),c=n(3),l=n(298),u=n(299),d=n(300),p=n(301),h={"Event/Call":1,"Signal/Flamingo":1},f=function(){function e(){this.activeCallNotifications={},this.idOfShowedMessageNotifications={},this.everOpenedChats={},this.notifications=[],this.unreadMessageObserver=new p.default,this.isEnabled=!0}return e.prototype.enableNotifications=function(){this.isEnabled=!0},e.prototype.disableNotifications=function(){this.isEnabled=!1},e.prototype.registerUnreadMessage=function(e,t){if(!this.idOfShowedMessageNotifications[t.id]&&!this.isOpenedConversation(e.id)&&!h[t.messagetype]){var n=this.unreadMessageObserver.getNotification(e,t);n&&(this.idOfShowedMessageNotifications[t.id]=!0,this.notifications.push(n),this.showNotifications())}},e.prototype.registerUnreadConversationsSummary=function(e){if(d.default.isEnabled&&0!==e.length&&!d.default.isIgnored()){var t=this.getUnreadConversationsNotification(e);t?this.notifications.push(t):a.default.throwError(r.ErrorCodes.ERR_CREATE_SUMMARY_NOTIFICATION,"Unable to create summary notification"),this.showNotifications()}},e.prototype.registerCall=function(e){var t=new u.default(e),n=t.getNotification();n?(this.activeCallNotifications[t.callId]=n,o.swc.API.triggerEvent(i.ApiEvents.ReceivedNotification,n)):a.default.throwError(r.ErrorCodes.ERR_CREATE_CALL_NOTIFICATION,"Unable to create call notification")},e.prototype.callStateHandler=function(e){this.activeCallNotifications[e.id]&&(this.activeCallNotifications[e.id].hide(),delete this.activeCallNotifications[e.id])},e.prototype.setOpenedConversations=function(e){this.everOpenedChats=e,c.default.setEverOpenedChats(e)},e.prototype.isOpenedConversation=function(e){var t=this.everOpenedChats[e];return t&&t.onStage},e.prototype.showNotifications=function(){if(this.isEnabled)for(var e=this.notifications.length,t=0;t<e;t++){var n=this.notifications.pop();o.swc.API.triggerEvent(i.ApiEvents.ReceivedNotification,n),c.default.telemetryManager.sendEvent(new l.default(n.type))}else this.notifications=[]},e.prototype.getUnreadConversationsNotification=function(e){var t=s.LocalStorage.getItem("swc-recentslastseen");if(!t)return new d.default(e);var n=e.filter(function(e){return new Date(e.lastMessage.originalarrivaltime).getTime()>+t});return n.length?new d.default(n):null},e}();t.default=f},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=function(e){function t(t){var n=e.call(this,"notification_created")||this;return n.notificationType=t,n}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(o.TelemetryPropertyValue.Create("type",this.notificationType)),e},t}(n(8).TelemetryEvent);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(21),o=n(0),a=n(49),s=n(71),c=n(72),l=function(){function e(e){this._callInfo=e,this.reject=function(e){var t={id:e.callId,reject:!0,callerMri:e.callerMri||""};o.swc.API.triggerEvent(i.ApiEvents.RejectCall,t),r.getServices().telemetryManager.sendEvent(new s.default("Calling","Ignore"))},this.accept=function(e){if(o.swc.ChatContent){var t=e.mri,n={ConversationId:t||"",ExecuteCall:{id:e.callId,accept:!0,callerMri:t||""}};o.swc.API.triggerEvent(i.ApiEvents.StartChat,n),r.getServices().telemetryManager.sendEvent(new s.default("Calling","Accept"))}}}return Object.defineProperty(e.prototype,"callId",{get:function(){return this._callInfo.callId},enumerable:!0,configurable:!0}),e.prototype.getNotification=function(){var e=new c.Notification;return e.type="Calling",e.title=this._callInfo.displayName||"",e.description="Incoming call",e.avatarUrl=this._callInfo.avatar,e.actions=this.getActions(this._callInfo),e},e.prototype.getActions=function(e){var t=this;return[{type:"Accept",title:a.default.fetch("accept"),description:a.default.fetch("accept_descr"),action:function(){t.accept(e)}},{type:"Ignore",title:a.default.fetch("ignore"),description:a.default.fetch("ignore_descr"),action:function(){t.reject(e)}}]},e}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(2),s=n(0),c=n(59),l=n(49),u=n(71),d=n(3),p=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/,h=function(e){function t(n){var i=e.call(this)||this;return i.type="Summary",i.description=l.default.fetch("notification_summary",{count:n.length}),i.avatarUrl=i.getAvatar(n)||a.default.DEFAULT_AVATAR_URI,i.actions=i.getActions(),t.isEnabled=!1,t.setIgnoreToStorage(),i}return r(t,e),t.prototype.getAvatar=function(e){var t=e.filter(function(e){return!e.isGroup}),n=t.length>0?t[0]:e[0];if(n.avatar&&n.avatar.match(p))return n.avatar;var i=n.isGroup?void 0:n.id.replace(/^\d+:/,""),r=i?encodeURIComponent(i):"thread",o="https://avatar.skype.com/v1/"+"avatars/${contactId}/public?returnDefaultImage=false&cacheHeaders=true".replace("${contactId}",r);return o=o.replace("returnDefaultImage=false","returnDefaultImage=true")},t.prototype.getActions=function(){return[{type:"Accept",title:l.default.fetch("open"),description:l.default.fetch("open_client_descr"),action:function(){s.swc.API.triggerEvent(o.ApiEvents.OpenRecentList),d.default.telemetryManager.sendEvent(new u.default("Summary","Accept"))}},{type:"Ignore",title:l.default.fetch("ignore"),description:l.default.fetch("ignore_summary_notificaton_descr"),action:function(){d.default.telemetryManager.sendEvent(new u.default("Summary","Ignore"))}}]},t.setIgnoreToStorage=function(){try{var e=60*(a.default.ECS.sumToastDelayMin||0)*1e3,t={ignoreUntil:Date.now()+(0===e?864e5:e),id:c.hashCode(d.default.signInManager.currentUserName)};d.default.localStorage.setItem("swc|notificationIgnore",JSON.stringify(t))}catch(e){}},t.isIgnored=function(){try{var e=d.default.localStorage.getItem("swc|notificationIgnore"),t=c.hashCode(d.default.signInManager.currentUserName);if(e){var n=JSON.parse(e);if(!n.id||n.id!=t)return d.default.localStorage.removeItem("swc|notificationIgnore"),!1;if(!n.ignoreUntil||isNaN(n.ignoreUntil))return!1;if(n.ignoreUntil>Date.now())return!0}return!1}catch(e){return!1}},t.isEnabled=!0,t}(n(72).Notification);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(302),o=n(303),a=function(){function e(){var e=this;this.unreadConversations={},this.freshUnreadConversations={},i.default.webApi.recents().getUnreadConversations().then(function(t){t.forEach(function(t){e.unreadConversations[t.id]=100}),t.subscribe(function(t,n){n.newItems&&n.newItems.forEach(function(t){e.freshUnreadConversations[t.id]=0}),n.oldItems&&n.oldItems.forEach(function(t){delete e.unreadConversations[t.id],delete e.freshUnreadConversations[t.id]})})})}return e.prototype.getNotification=function(e,t){if(!this.canShow(e,t))return null;if(!this.isAllowedByUnread(e.id)){if(3===this.freshUnreadConversations[e.id]){var n=Object.getOwnPropertyNames(this.freshUnreadConversations).map(function(e){return i.default.webApi.recents().getConversation(e)});return new r.default(n,e)}return null}var a=new o.default(e,t);return a&&a.description?a:null},e.prototype.canShow=function(e,t){return!e.isBlocked},e.prototype.isAllowedByUnread=function(e){return!this.unreadConversations[e]&&(void 0===!this.freshUnreadConversations[e]?(this.freshUnreadConversations[e]=0,!0):(this.freshUnreadConversations[e]++,this.freshUnreadConversations[e]<3))},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(47),s=n(49),c=n(3),l=n(71),u=n(72),d=window,p=function(e){function t(n,i){var r=e.call(this)||this;return r.type="UnreadMessage",r.title=r.getTitle(n),r.description=t.getDescription(n),r.actions=r.getActions(i),r.sender="",r.avatarUrl=t.getAvatar(i),r}return r(t,e),t.prototype.getTitle=function(e){var t="",n=s.default.fetch("separator");return e.forEach(function(e){if(e.isGroup)t+=""===t?e.topic:n+" "+e.topic;else{var i=c.default.contactsService.getContactByMriIfPresent(e.id)||a.normalizePersonId(e.id);t+=""===t?i:n+" "+i}}),t},t.getDescription=function(e){return s.default.fetch("notification_reminder_desc",{count:e.length})},t.getAvatar=function(e){return e.avatar||o.default.DEFAULT_AVATAR_URI},t.prototype.getActions=function(e){return[{type:"Accept",title:s.default.fetch("open"),description:s.default.fetch("open_client_descr"),action:function(){d.swc.SDK.Chat.startChat({ConversationId:e.id}),c.default.telemetryManager.sendEvent(new l.default("Reminder","Accept"))}},{type:"Ignore",title:s.default.fetch("ignore"),description:s.default.fetch("ignore_reminder_notificaton_descr"),action:function(){c.default.telemetryManager.sendEvent(new l.default("Reminder","Ignore"))}}]},t}(u.Notification);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(14),s=n(47),c=n(49),l=n(3),u=n(71),d=n(72),p=n(25),h=function(e){function t(n,i){var r=e.call(this)||this;return r.type="UnreadMessage",r.title=t.getTitle(n,i),r.description=t.getDescription(i),r.actions=r.getActions(n),r.sender=t.getSender(n,i),r.avatarUrl=t.getAvatar(n,i),r}return r(t,e),t.getTitle=function(e,t){return e.isGroup?e.topic:l.default.contactsService.getContactByMriIfPresent(e.id)||s.normalizePersonId(e.id)},t.getDescription=function(e){switch(e&&e.content&&(e.content=e.content.replace(/&apos;/g,"'")),e.messagetype){case"Text":case"RichText":return p.default.dompurify.sanitize(e.content,{ALLOWED_TAGS:[]});case"RichText/UriObject":return c.default.fetch("pic_sent");case"RichText/Media_GenericFile":return c.default.fetch("file_sent");case"Event/Call":return c.default.fetch(t.getCallMessage(e.content));default:return p.default.dompurify.sanitize(e.content,{ALLOWED_TAGS:[]})}},t.getCallMessage=function(e){return/<partlist type="missed"="/.test(e)?"message_text_missedCall":(/<partlist type="ended"="/.test(e),"message_text_endedCall")},t.getAvatar=function(e,t){var n=e.avatar||o.default.DEFAULT_AVATAR_URI;return n=n.replace("returnDefaultImage=false","returnDefaultImage=true")},t.prototype.getActions=function(e){return[{type:"Accept",title:c.default.fetch("open"),description:c.default.fetch("open_client_descr"),action:function(){window.swc.SDK.Chat.startChat({ConversationId:e.id}),l.default.telemetryManager.sendEvent(new u.default("UnreadMessage","Accept"))}},{type:"Ignore",title:c.default.fetch("ignore"),description:c.default.fetch("ignore_unread_notificaton_descr"),action:function(){l.default.telemetryManager.sendEvent(new u.default("UnreadMessage","Ignore"))}}]},t.getSender=function(e,t){if(!e.isGroup)return"";if(!t.from)return"";var n=a.default.getSenderIdFromUrl(t.from),i=s.normalizePersonId(n);return l.default.contactsService.getContactByMriIfPresent(n)||i},t}(d.Notification);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(305);t.ping=function(){return i.sendRequest("ping","GET","/swc")},t.getExistingCompanies=function(){return i.sendRequest("getCompanies","GET","/companies")},t.createCompany=function(e,t){var n={businessName:e,description:t};return i.sendRequest("createCompany","POST","/swc",{body:JSON.stringify(n)})},t.setCompanyEnabledStatusTo=function(e){return i.sendPutRequest("enableCompany","/swc/status",{body:JSON.stringify({enabled:e})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(306),a={retryCount:3,timeout:12e4,policy:""},s=function(e,t,n){return r.default("oa-"+e,a,i.default.OA_URL+t,n)},c=function(e,t,n){e.append("Content-Type","application/json");var i=Object.assign({},n);return i.method=t,i.headers=e,i.cache="no-cache",i};t.sendRequest=function(e,t,n,i){return o.getHeaders().then(function(r){return s(e,n,c(r,t,i)).then(function(e){return e.json()})})},t.sendPutRequest=function(e,t,n){return o.getHeaders().then(function(i){return s(e,t,c(i,"PUT",n))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.postHeaders=function(){return new Promise(function(e){i.default.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){i.default.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(109),o=n(0),a=n(308),s=n(309),c=n(312),l=n(313),u=function(){function e(){this._isInitialized=!1,this.canRenderConfigItems=function(){return a.default.canRenderConfigItems()}}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return r.shortcutIdMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return r.idEmoticonMap},enumerable:!0,configurable:!0}),e.prototype.init=function(e){var t=this;return new Promise(function(n,r){c.default.init(e).then(function(e){var r=a.default.init(e);s.default.register(r),l.default.updateCache(r),r.items&&r.items.forEach(function(e){e.background=l.default.getUrlFromCache(e.id)}),l.default.isRunning()||l.default.start(),n(r),t._isInitialized=!0,o.swc.API.triggerEvent(i.ApiEvents.PesConfigInitialized)}).catch(function(){r()})})},e}();t.default=u},function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var r=n(109),o=n(19),a=n(34),s=n(110),c=function(){function e(){this._configuration={countryCode:"",tabsRoot:"",itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[],emoticonPreviewItem:null}}return e.prototype.canRenderConfigItems=function(){return this._configuration.items.length>0},e.prototype.init=function(e){var t=this._processItems(e);t.forEach(function(e){r.idEmoticonMap[e.id]=e});var n=this._processPacks(e,t),o=e.tabs?this._resolveTabsFromSections(e,n):this._makeTabsFromPacks(n,e.packsRoot);return this._configuration=i({},e,{packs:n,tabs:o,items:t},{emoticonPreviewItem:t[0]}),this._configuration},e.prototype._processPacks=function(e,t){return e.packs.map(function(e){var n=[];return e.items.forEach(function(e){var i=t.find(function(t){return t.id===e});i&&n.push(i)}),i({},e,{items:n})})},e.prototype._resolveTabsFromSections=function(e,t){var n=this;return e.tabs.map(function(r){var o=[];return r.sections.forEach(function(e){var n=t.find(function(t){return t.id===e.pack});n&&n.items&&n.items.length&&o.push(n)}),i({},r,{packs:o,type:a.default.itemTypes.tab.id,thumbnailUrl:n._createThumbnailUrl(r.id,e.tabsRoot)})})},e.prototype._createThumbnailUrl=function(e,t){var n=(t||"#")+"/"+e+"/views/thumbnail";return n=s.rewriteUrls(n,a.default.pesCDNAuthentication.rewriteRules)},e.prototype._makeTabsFromPacks=function(e,t){var n=this,i=[];return e?(e.forEach(function(e){if(!n._isFeaturedPack(e)){var r=n._createTabFromPack(e,t);i.push(r)}}),e.forEach(function(e){if(n._isFeaturedPack(e)){var r=e.title.replace(a.default.FEATURED_IN_PREFIX,""),o=i.find(function(e){return e.title===r});o?(e.isHidden=!1,o.packs.unshift(e)):!1===e.isHidden&&(e.title=r,o=n._createTabFromPack(e,t),i.push(o))}}),i):i},e.prototype._createTabFromPack=function(e,t){var n=this._createThumbnailUrl(e.id,t),r=i({},e,{type:a.default.itemTypes.tab.id,thumbnailUrl:n,packs:[e],sections:[{pack:e.id}],glyphBgColor:"",isDiscoverable:!1,badgeETag:""});return delete r.isSponsored,delete r.items,r},e.prototype._isFeaturedPack=function(e){return 0===(e.title||"").indexOf(a.default.FEATURED_IN_PREFIX)},e.prototype._processItems=function(e){var t=this,n=e.countryCode;return e.items.filter(function(e){return e.type===a.default.itemTypes.emoticon.id&&(!(n&&e.excludedCountries&&e.excludedCountries.indexOf(n)>=0)&&!(n&&e.includedCountries&&e.includedCountries.length&&e.includedCountries.indexOf(n)<0))}).map(function(n){var r={staticHtmlClass:n.id,staticExtraLargeHtmlClass:n.id+" extraLarge",animatedExtraLargeHtmlClass:n.id+" extraLarge animated",background:""},o=e.emoticonsRoot+"/"+n.id+"/views/",a=t._getEmoticonURLs(o,n.etag),s=i({},n,r,a,{descriptionUpperCase:n.description.toUpperCase(),views:[]});return delete s.includedCountries,delete s.excludedCountries,s})},e.prototype._getEmoticonURLs=function(e,t){return e=s.rewriteUrls(e,a.default.pesCDNAuthentication.rewriteRules),{smallStaticUrl:this._buildUrl(e+a.default.profiles.emoticons.getSmall(),t),largeStaticUrl:this._buildUrl(e+a.default.profiles.emoticons.getLarge(),t),extraLargeStaticUrl:this._buildUrl(e+a.default.profiles.emoticons.getExtraLarge(),t),superLargeStaticUrl:this._buildUrl(e+a.default.profiles.emoticons.getSuperLarge(),t),smallUrl:this._buildUrl(e+a.default.profiles.emoticons.getSmallAnimated(),t),largeUrl:this._buildUrl(e+a.default.profiles.emoticons.getLargeAnimated(),t),extraLargeUrl:this._buildUrl(e+a.default.profiles.emoticons.getExtraLargeAnimated(),t),superLargeUrl:this._buildUrl(e+a.default.profiles.emoticons.getSuperLargeAnimated(),t)}},e.prototype._buildUrl=function(e,t){return o.default.setQueryParameters(e,{etag:t})},e}();t.default=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(109),r=n(34),o=n(310),a=n(311),s=function(){function e(){}return e.prototype.register=function(e){var t=this._getArtifacts(e),n="";i.clearShortcutMap(),t.encodingMaps.forEach(function(e){switch(e.type){case r.default.itemTypes.emoticon.id:i.shortcutIdMap[e.shortcut]=e.id;break;case r.default.itemTypes.tab.id:case r.default.itemTypes.moji.id:case r.default.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),t.pesStyles.forEach(function(e){n+=e}),this._registerStyles(n)},e.prototype._getArtifacts=function(e){var t=[],n=[],i=[];return e.tabs&&e.tabs.forEach(function(e){var r=a.default.getResources(e);t.push(r.styleDef),n.unshift(r.prefetchUrls[0]),e.packs.forEach(function(e){e.items.forEach(function(e){var r=o.default.getResources(e);r&&(t.push(r.styleDef),i.push.apply(i,r.encoderMaps),n.push.apply(n,r.prefetchUrls))})})}),{pesStyles:t,prefetchUrls:n,encodingMaps:i}},e.prototype._registerStyles=function(e){var t,n,i=document.getElementById("pesStyles");return i||(n=document.head,(i=document.createElement("style")).id="pesStyles",i.type="text/css"),i.styleSheet?i.styleSheet.cssText=e:(t=document.createTextNode(e),i.firstChild&&i.removeChild(i.firstChild),i.appendChild(t)),n&&n.appendChild(i),e},e}();t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==i.default.itemTypes.emoticon.id)return null;var t=e.shortcuts.map(function(t){return{shortcut:t,id:e.id,type:i.default.itemTypes.emoticon.id}});return{styleDef:"",prefetchUrls:[e.smallUrl,e.smallStaticUrl,e.largeUrl,e.largeStaticUrl,e.extraLargeUrl,e.extraLargeStaticUrl,e.superLargeUrl,e.superLargeStaticUrl],encoderMaps:t}},e}();t.default=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==i.default.itemTypes.tab.id)return null;var t="\n.swx .tab_id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",{styleDef:t+="} \n",prefetchUrls:[e.thumbnailUrl]}},e}();t.default=new r},function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(10),a=n(102),s=n(116),c=n(147),l=n(16),u=n(6),d=n(11),p=n(34),h=n(110),f={retryCount:3,timeout:12e4,policy:""},g=function(){function e(){}return e.prototype.init=function(e){var t=this;return this._initPromise?this._initPromise:(u.default.get.pesLanguageLocale=s.default.getPesLocale(u.default.get.currentLocale||r.default.LOCALE),this._initPromise=c.configLoader(c.EcsClient.Skype,{id:e}).then(function(e){var n=e.SkypePersonalization?e.SkypePersonalization.pes_config:null,r=e.Headers?e.Headers.CountryCode:null;return n||t._throwUncaughtError("No config URL",e),t._fetchConfiguration(n).then(function(e){return i({},e,{countryCode:r})})}).catch(function(e){t._throwUncaughtError("",e)}),this._initPromise)},e.prototype._throwUncaughtError=function(e,t){var n=t&&"string"==typeof t?t:JSON.stringify(t);d.default.throwError(o.ErrorCodes.ERR_PES_CONFIG_LOAD,"[PES] configSync, url "+e+", error "+n)},e.prototype._fetchConfiguration=function(e){var t=this;return this._fetch(this._getLocalizedUrl(e)).catch(function(){return t._fetch(e)}).catch(function(n){return t._throwUncaughtError(e,n)})},e.prototype._fetch=function(e){var t=this;return e=h.rewriteUrls(e,p.default.pesCDNAuthentication.rewriteRules),Promise.resolve(l.default("pes-CDNTokenFromSkypeToken",f,e,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json, text/javascript"}}).then(function(e){return a.parseJson(e)}).catch(function(n){return t._throwUncaughtError(e,n)}))},e.prototype._getLocalizedUrl=function(e){var t=u.default.get.pesLanguageLocale||r.default.PES_LOCALE;return e.replace("/default","/"+t)},e}();t.default=new g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),r=n(34),o=n(314),a=n(148),s=function(){function e(){this._isRunning=!1,this._pixelRatio=1,this._lastDrawTimestamp=-1313,this._lastBoundsTimestamp=-1313,this._refreshTime=0,this._bounds={},this.BOUNDS_REFRESH_TIMEOUT=100,this._imageCache={}}return e.prototype.isRunning=function(){return this._isRunning},e.prototype.start=function(){var e=i.default.getWindow();"devicePixelRatio"in e&&(this._pixelRatio=e.devicePixelRatio),this._isRunning=!0,this._lastDrawTimestamp=-1313,e.requestAnimationFrame(this.draw.bind(this))},e.prototype.stop=function(){this._isRunning=!1},e.prototype.updateCache=function(e){var t=this,n=0;e.items.forEach(function(i){if(!t._imageCache[i.id]&&i.type===r.default.itemTypes.emoticon.id){t._imageCache[i.id]=new o.default(e.emoticonsRoot,i);var a=i.media;a&&a.default&&a.default.fps>n&&(n=a.default.fps)}}),0!==n&&(this._refreshTime=Math.floor(1e3/n))},e.prototype.getUrlFromCache=function(e){var t="";for(var n in this._imageCache)if(this._imageCache[n].id===e){var i=this._imageCache[n].largeStatic;t=i?i.url:"";break}return t},e.prototype.draw=function(e){var t=this;if(e-this._lastDrawTimestamp>=this._refreshTime){this._lastDrawTimestamp=e;var n=this.getEmoticonCanvases(),r=e-this._lastBoundsTimestamp>this.BOUNDS_REFRESH_TIMEOUT;r&&(this._lastBoundsTimestamp=e),Array.prototype.forEach.call(n,function(n){r&&delete t._bounds[n.id],t._bounds[n.id]||(t._bounds[n.id]=n.getBoundingClientRect());var o=t._bounds[n.id];if(!(o.width<=2)&&i.default.isInViewport(o)){r&&t.setDimensionsIfNeeded(n,o);var a="itemId",s="item-id",c="isAnimated",l="is-animated",u=i.default.readDataset(n,a,s),d=t._imageCache[u],p="true"===i.default.readDataset(n,c,l);try{d&&t.drawEmoticon(n,d,o.width,p,e/1e3)}catch(e){}}})}this._isRunning&&i.default.getWindow().requestAnimationFrame(this.draw.bind(this))},e.prototype.getEmoticonCanvases=function(){return document.querySelectorAll(".swc span.emoticon canvas")},e.prototype.drawEmoticon=function(e,t,n,i,o){t[(n<=r.default.frameHeights.emoticons.SMALL?a.ITEM_SIZES.SMALL:n<=r.default.frameHeights.emoticons.LARGE?a.ITEM_SIZES.LARGE:n<=r.default.frameHeights.emoticons.EXTRA_LARGE?a.ITEM_SIZES.EXTRA_LARGE:a.ITEM_SIZES.SUPER_LARGE)+(i?"Animated":"Static")].draw(e,o)},e.prototype.setDimensionsIfNeeded=function(e,t){var n=t.width*this._pixelRatio;e.width===n&&e.height===n||(e.width=n,e.height=n)},e}();t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),r=n(148),o=n(315),a=function(){return function(e,t){this.id=t.id,this.smallAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SMALL,!0),t.media.default),this.largeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.LARGE,!0),t.media.default),this.extraLargeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.EXTRA_LARGE,!0),t.media.default),this.superLargeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SUPER_LARGE,!0),t.media.default),this.smallStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SMALL,!1),r.STATIC_MEDIA_INFO),this.largeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.LARGE,!1),r.STATIC_MEDIA_INFO),this.extraLargeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.EXTRA_LARGE,!1),r.STATIC_MEDIA_INFO),this.superLargeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SUPER_LARGE,!1),r.STATIC_MEDIA_INFO)}}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.isLoaded=!1,this.isLoading=!1,this.url=e,this.mediaInfo=t}return e.prototype.draw=function(e,t){var n=this;if(!this.isLoading)if(this.isLoaded){var i=e.getContext("2d"),r=this.image.naturalWidth;i.clearRect(0,0,e.width,e.width);var o=void 0;o=1===this.mediaInfo.framesCount?0:Math.floor(t*this.mediaInfo.fps)%this.mediaInfo.framesCount,i.drawImage(this.image,0,r*o,r,r,0,0,e.width,e.width)}else this.image=new Image,this.isLoading=!0,this.image.onload=function(){n.isLoading=!1,n.isLoaded=!0,n.draw(e,t)},this.image.src=this.url},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._teamsEmotes={smile:{unicode:"smile",unicode_alternates:":smile:",name:"emoticon_smile_name",shortname:"(smile)",shortcuts:":),:-),:=),(smile),(Smile)",category:"emoticons",keywords:"emoticon_smile_keywords",link:"smile_20.png",linkAnim:"smile_20_anim.png"},laugh:{unicode:"laugh",unicode_alternates:":laughing:",name:"emoticon_laugh_name",shortname:"(laugh)",shortcuts:":D,:-D,:=D,:d,:-d,:=d,(laugh),(Laugh),:>,:->,(lol),(LOL),(Lol)",category:"emoticons",keywords:"emoticon_laugh_keywords",link:"laugh_20.png",linkAnim:"laugh_20_anim.png"},heart:{unicode:"heart",unicode_alternates:":heart:",name:"emoticon_heart_name",shortname:"(heart)",shortcuts:"(heart),(Heart),<3",category:"emoticons",keywords:"emoticon_heart_keywords",link:"heart_20.png",linkAnim:"heart_20_anim.png"},kiss:{unicode:"kiss",unicode_alternates:":kiss:",name:"emoticon_kiss_name",shortname:"(kiss)",shortcuts:"(kiss),(Kiss),:*,:-*,:=*,(xo)",category:"emoticons",keywords:"emoticon_kiss_keywords",link:"kiss_20.png",linkAnim:"kiss_20_anim.png"},sad:{unicode:"sad",unicode_alternates:":slight_frown:",name:"emoticon_sad_name",shortname:"(sad)",shortcuts:":(,:-(,:=(,(sad),(Sad),:<,:-<",category:"emoticons",keywords:"emoticon_sad_keywords",link:"sad_20.png",linkAnim:"sad_20_anim.png"},tongueout:{unicode:"tongueout",unicode_alternates:":stuck_out_tongue:",name:"emoticon_tongueout_name",shortname:"(tongueout)",shortcuts:":P,:-P,:=P,:p,:-p,:=p,(tongueout),(Tongueout)",category:"emoticons",keywords:"emoticon_tongueout_keywords",link:"tongueout_20.png",linkAnim:"tongueout_20_anim.png"},wink:{unicode:"wink",unicode_alternates:":wink:",name:"emoticon_wink_name",shortname:"(wink)",shortcuts:";),;-),;=),(wink),(Wink)",category:"emoticons",keywords:"emoticon_wink_keywords",link:"wink_20.png",linkAnim:"wink_20_anim.png"},cry:{unicode:"cry",unicode_alternates:":cry:",name:"emoticon_cry_name",shortname:"(cry)",shortcuts:";(,;-(,;=(,(cry),(Cry),:'(",category:"emoticons",keywords:"emoticon_cry_keywords",link:"cry_20.png",linkAnim:"cry_20_anim.png"},inlove:{unicode:"inlove",unicode_alternates:":heart_eyes:",name:"emoticon_inlove_name",shortname:"(inlove)",shortcuts:"(inlove),(Inlove),(love),(Love),:],:-]",category:"emoticons",keywords:"emoticon_inlove_keywords",link:"inlove_20.png",linkAnim:"inlove_20_anim.png"},hug:{unicode:"hug",unicode_alternates:":hugging:",name:"emoticon_hug_name",shortname:"(hug)",shortcuts:"(hug),(Hug),(bear),(Bear)",category:"emoticons",keywords:"emoticon_hug_keywords",link:"hug_20.png",linkAnim:"hug_20_anim.png"},cwl:{unicode:"cwl",unicode_alternates:":joy:",name:"emoticon_cwl_name",shortname:"(cwl)",shortcuts:"(cwl),(Cwl),(cryingwithlaughter),(Cryingwithlaughter)",category:"emoticons",keywords:"emoticon_cwl_keywords",link:"cwl_20.png",linkAnim:"cwl_20_anim.png"},lips:{unicode:"lips",unicode_alternates:":lips:",name:"emoticon_lips_name",shortname:"(lips)",shortcuts:"(lips),(Lips)",category:"emoticons",keywords:"emoticon_lips_keywords",link:"lips_20.png",linkAnim:"lips_20_anim.png"},blush:{unicode:"blush",unicode_alternates:":blush:",name:"emoticon_blush_name",shortname:"(blush)",shortcuts:':$,:-$,:=$,:">,(blush),(Blush)',category:"emoticons",keywords:"emoticon_blush_keywords",link:"blush_20.png",linkAnim:"blush_20_anim.png"},surprised:{unicode:"surprised",unicode_alternates:":open_mouth:",name:"emoticon_surprised_name",shortname:"(surprised)",shortcuts:":O,:-O,:=O,:o,:-o,:=o,(surprised),(Surprised)",category:"emoticons",keywords:"emoticon_surprised_keywords",link:"surprised_20.png",linkAnim:"surprised_20_anim.png"},penguin:{unicode:"penguin",unicode_alternates:":penguin:",name:"emoticon_penguin_name",shortname:"(penguin)",shortcuts:"(penguin),(Penguin),(dancingpenguin),(Dancingpenguin),(penguindance),(Penguindance)",category:"emoticons",keywords:"emoticon_penguin_keywords",link:"penguin_20.png",linkAnim:"penguin_20_anim.png"},yes:{unicode:"yes",unicode_alternates:":thumbsup:",name:"emoticon_yes_name",shortname:"(yes)",shortcuts:"(y),(Y),(yes),(Yes)",category:"emoticons",keywords:"emoticon_yes_keywords",link:"yes_20.png",linkAnim:"yes_20_anim.png"},cool:{unicode:"cool",unicode_alternates:":sunglasses:",name:"emoticon_cool_name",shortname:"(cool)",shortcuts:"(cool),(Cool),8-),8=),B-),B=)",category:"emoticons",keywords:"emoticon_cool_keywords",link:"cool_20.png",linkAnim:"cool_20_anim.png"},rofl:{unicode:"rofl",unicode_alternates:":laughing:",name:"emoticon_rofl_name",shortname:"(rofl)",shortcuts:"(rofl),(Rofl),(rotfl),(Rotfl)",category:"emoticons",keywords:"emoticon_rofl_keywords",link:"rofl_20.png",linkAnim:"rofl_20_anim.png"},cat:{unicode:"cat",unicode_alternates:":cat:",name:"emoticon_cat_name",shortname:"(cat)",shortcuts:"(cat),(Cat),(@),(meow),(Meow),(kitty),(Kitty)",category:"emoticons",keywords:"emoticon_cat_keywords",link:"cat_20.png",linkAnim:"cat_20_anim.png"},monkey:{unicode:"monkey",unicode_alternates:":monkey_face:",name:"emoticon_monkey_name",shortname:"(monkey)",shortcuts:"(monkey),(Monkey),(ape),(Ape),:(|)",category:"emoticons",keywords:"emoticon_monkey_keywords",link:"monkey_20.png",linkAnim:"monkey_20_anim.png"},hi:{unicode:"hi",unicode_alternates:":wave:",name:"emoticon_hi_name",shortname:"(hi)",shortcuts:"(wave),(Wave),(hi),(Hi),(HI),(bye),(Bye),(BYE)",category:"emoticons",keywords:"emoticon_hi_keywords",link:"hi_20.png",linkAnim:"hi_20_anim.png"},snowangel:{unicode:"snowangel",unicode_alternates:":snowman:",name:"emoticon_snowangel_name",shortname:"(snowangel)",shortcuts:"(snowangel),(Snowangel)",category:"emoticons",keywords:"emoticon_snowangel_keywords",link:"snowangel_20.png",linkAnim:"snowangel_20_anim.png"},flower:{unicode:"flower",unicode_alternates:":blossom:",name:"emoticon_flower_name",shortname:"(flower)",shortcuts:"(flower),(Flower)",category:"emoticons",keywords:"emoticon_flower_keywords",link:"flower_20.png",linkAnim:"flower_20_anim.png"},giggle:{unicode:"giggle",unicode_alternates:":joy:",name:"emoticon_giggle_name",shortname:"(giggle)",shortcuts:"(chuckle),(Chuckle),(giggle),(Giggle)",category:"emoticons",keywords:"emoticon_giggle_keywords",link:"giggle_20.png",linkAnim:"giggle_20_anim.png"},devil:{unicode:"devil",unicode_alternates:":smiling_imp:",name:"emoticon_devil_name",shortname:"(devil)",shortcuts:"(devil),(Devil)",category:"emoticons",keywords:"emoticon_devil_keywords",link:"devil_20.png",linkAnim:"devil_20_anim.png"},party:{unicode:"party",unicode_alternates:":tada:",name:"emoticon_party_name",shortname:"(party)",shortcuts:"(party),(Party),<O),<o),<:o)",category:"emoticons",keywords:"emoticon_party_keywords",link:"party_20.png",linkAnim:"party_20_anim.png"},worry:{unicode:"worry",unicode_alternates:":worried:",name:"emoticon_worry_name",shortname:"(worry)",shortcuts:"(worry),(Worry),:S,:s,:-s,:-S,:=s,:=S,(worried),(Worried)",category:"emoticons",keywords:"emoticon_worry_keywords",link:"worry_20.png",linkAnim:"worry_20_anim.png"},champagne:{unicode:"champagne",unicode_alternates:":champagne:",name:"emoticon_champagne_name",shortname:"(champagne)",shortcuts:"(champagne),(Champagne),(sparkling),(Sparkling)",category:"emoticons",keywords:"emoticon_champagne_keywords",link:"champagne_20.png",linkAnim:"champagne_20_anim.png"},sun:{unicode:"sun",unicode_alternates:":sun_with_face:",name:"emoticon_sun_name",shortname:"(sun)",shortcuts:"(sun),(Sun)",category:"emoticons",keywords:"emoticon_sun_keywords",link:"sun_20.png",linkAnim:"sun_20_anim.png"},star:{unicode:"star",unicode_alternates:":star:",name:"emoticon_star_name",shortname:"(star)",shortcuts:"(star),(Star)",category:"emoticons",keywords:"emoticon_star_keywords",link:"star_20.png",linkAnim:"star_20_anim.png"},polarbear:{unicode:"polarbear",unicode_alternates:":bear:",name:"emoticon_polarbear_name",shortname:"(polarbear)",shortcuts:"(polarbear),(Polarbear),(polarbearhug),(Polarbearhug)",category:"emoticons",keywords:"emoticon_polarbear_keywords",link:"polarbear_20.png",linkAnim:"polarbear_20_anim.png"},dull:{unicode:"dull",unicode_alternates:":unamused:",name:"emoticon_dull_name",shortname:"(dull)",shortcuts:"|-(,|(,|=(,(dull),(Dull)",category:"emoticons",keywords:"emoticon_dull_keywords",link:"dull_20.png",linkAnim:"dull_20_anim.png"},speechless:{unicode:"speechless",unicode_alternates:":astonished:",name:"emoticon_speechless_name",shortname:"(speechless)",shortcuts:":|,:-|,:=|,(speechless),(Speechless)",category:"emoticons",keywords:"emoticon_speechless_keywords",link:"speechless_20.png",linkAnim:"speechless_20_anim.png"},wonder:{unicode:"wonder",unicode_alternates:":thinking_face:",name:"emoticon_wonder_name",shortname:"(wonder)",shortcuts:":^),(wonder),(Wonder)",category:"emoticons",keywords:"emoticon_wonder_keywords",link:"wonder_20.png",linkAnim:"wonder_20_anim.png"},angry:{unicode:"angry",unicode_alternates:":angry:",name:"emoticon_angry_name",shortname:"(angry)",shortcuts:"(angry),(Angry),:@,:-@,:=@,x(,x-(,X(,X-(,x=(,X=(,;@,;-@",category:"emoticons",keywords:"emoticon_angry_keywords",link:"angry_20.png",linkAnim:"angry_20_anim.png"},puke:{unicode:"puke",unicode_alternates:":face_with_thermometer:",name:"emoticon_puke_name",shortname:"(puke)",shortcuts:"(puke),(Puke),:&,:-&,:=&,+o(",category:"emoticons",keywords:"emoticon_puke_keywords",link:"puke_20.png",linkAnim:"puke_20_anim.png"},facepalm:{unicode:"facepalm",unicode_alternates:":tired_face:",name:"emoticon_facepalm_name",shortname:"(facepalm)",shortcuts:"(facepalm),(Facepalm),(fail),(Fail)",category:"emoticons",keywords:"emoticon_facepalm_keywords",link:"facepalm_20.png",linkAnim:"facepalm_20_anim.png"},sweat:{unicode:"sweat",unicode_alternates:":sweat:",name:"emoticon_sweat_name",shortname:"(sweat)",shortcuts:"(:|,(sweat),(Sweat)",category:"emoticons",keywords:"emoticon_sweat_keywords",link:"sweat_20.png",linkAnim:"sweat_20_anim.png"},holidayspirit:{unicode:"holidayspirit",unicode_alternates:":christmas_tree:",name:"emoticon_holidayspirit_name",shortname:"(holidayspirit)",shortcuts:"(holidayspirit),(Holidayspirit),(crazyxmas),(Crazyxmas),(crazychristmas),(Crazychristmas)",category:"emoticons",keywords:"emoticon_holidayspirit_keywords",link:"holidayspirit_20.png",linkAnim:"holidayspirit_20_anim.png"},sleepy:{unicode:"sleepy",unicode_alternates:":sleepy:",name:"emoticon_sleepy_name",shortname:"(sleepy)",shortcuts:"|-),I-),I=),(snooze),(Snooze),(sleepy),(Sleepy)",category:"emoticons",keywords:"emoticon_sleepy_keywords",link:"sleepy_20.png",linkAnim:"sleepy_20_anim.png"},bow:{unicode:"bow",unicode_alternates:":bow:",name:"emoticon_bow_name",shortname:"(bow)",shortcuts:"(bow),(Bow)",category:"emoticons",keywords:"emoticon_bow_keywords",link:"bow_20.png",linkAnim:"bow_20_anim.png"},makeup:{unicode:"makeup",unicode_alternates:":lipstick:",name:"emoticon_makeup_name",shortname:"(makeup)",shortcuts:"(makeup),(Makeup),(kate),(Kate)",category:"emoticons",keywords:"emoticon_makeup_keywords",link:"makeup_20.png",linkAnim:"makeup_20_anim.png"},cash:{unicode:"cash",unicode_alternates:":moneybag:",name:"emoticon_cash_name",shortname:"(cash)",shortcuts:"(cash),(Cash)",category:"emoticons",keywords:"emoticon_cash_keywords",link:"cash_20.png",linkAnim:"cash_20_anim.png"},lipssealed:{unicode:"lipssealed",unicode_alternates:":zipper_mouth_face:",name:"emoticon_lipssealed_name",shortname:"(lipssealed)",shortcuts:":x,:-x,:X,:-X,:#,:-#,:=x,:=X,:=#,(lipssealed),(Lipssealed)",category:"emoticons",keywords:"emoticon_lipssealed_keywords",link:"lipssealed_20.png",linkAnim:"lipssealed_20_anim.png"},shivering:{unicode:"shivering",unicode_alternates:":cold_sweat:",name:"emoticon_shivering_name",shortname:"(shivering)",shortcuts:"(shivering),(Shivering),(cold),(Cold),(freezing),(Freezing)",category:"emoticons",keywords:"emoticon_shivering_keywords",link:"shivering_20.png",linkAnim:"shivering_20_anim.png"},cake:{unicode:"cake",unicode_alternates:":birthday:",name:"emoticon_cake_name",shortname:"(cake)",shortcuts:"(cake),(Cake)",category:"emoticons",keywords:"emoticon_cake_keywords",link:"cake_20.png",linkAnim:"cake_20_anim.png"},headbang:{unicode:"headbang",unicode_alternates:":confounded:",name:"emoticon_headbang_name",shortname:"(headbang)",shortcuts:"(headbang),(Headbang),(banghead),(Banghead)",category:"emoticons",keywords:"emoticon_headbang_keywords",link:"headbang_20.png",linkAnim:"headbang_20_anim.png"},dance:{unicode:"dance",unicode_alternates:":dancer:",name:"emoticon_dance_name",shortname:"(dance)",shortcuts:"o/,:D/,:d/,(dance),(Dance)",category:"emoticons",keywords:"emoticon_dance_keywords",link:"dance_20.png",linkAnim:"dance_20_anim.png"},wasntme:{unicode:"wasntme",unicode_alternates:":see_no_evil:",name:"emoticon_wasntme_name",shortname:"(wasntme)",shortcuts:"(wasntme),(Wasntme),(wm),(Wm)",category:"emoticons",keywords:"emoticon_wasntme_keywords",link:"wasntme_20.png",linkAnim:"wasntme_20_anim.png"},hungover:{unicode:"hungover",unicode_alternates:":face_with_head_bandage:",name:"emoticon_hungover_name",shortname:"(hungover)",shortcuts:"(morningafter),(Morningafter),(hungover),(Hungover)",category:"emoticons",keywords:"emoticon_hungover_keywords",link:"hungover_20.png",linkAnim:"hungover_20_anim.png"},yawn:{unicode:"yawn",unicode_alternates:":sleeping:",name:"emoticon_yawn_name",shortname:"(yawn)",shortcuts:"(yawn),(Yawn)",category:"emoticons",keywords:"emoticon_yawn_keywords",link:"yawn_20.png",linkAnim:"yawn_20_anim.png"},gift:{unicode:"gift",unicode_alternates:":gift:",name:"emoticon_gift_name",shortname:"(gift)",shortcuts:"(gift),(Gift)",category:"emoticons",keywords:"emoticon_gift_keywords",link:"gift_20.png",linkAnim:"gift_20_anim.png"},angel:{unicode:"angel",unicode_alternates:":angel:",name:"emoticon_angel_name",shortname:"(angel)",shortcuts:"(angel),(Angel)",category:"emoticons",keywords:"emoticon_angel_keywords",link:"angel_20.png",linkAnim:"angel_20_anim.png"},xmastree:{unicode:"xmastree",unicode_alternates:":christmas_tree:",name:"emoticon_xmastree_name",shortname:"(xmastree)",shortcuts:"(xmastree),(Xmastree),(christmastree),(Christmastree)",category:"emoticons",keywords:"emoticon_xmastree_keywords",link:"xmastree_20.png",linkAnim:"xmastree_20_anim.png"},brokenheart:{unicode:"brokenheart",unicode_alternates:":broken_heart:",name:"emoticon_brokenheart_name",shortname:"(brokenheart)",shortcuts:"(brokenheart),(Brokenheart)",category:"emoticons",keywords:"emoticon_brokenheart_keywords",link:"brokenheart_20.png",linkAnim:"brokenheart_20_anim.png"},think:{unicode:"think",unicode_alternates:":thinking:",name:"emoticon_think_name",shortname:"(think)",shortcuts:"(think),(Think),:-?,:?,:=?,*-)",category:"emoticons",keywords:"emoticon_think_keywords",link:"think_20.png",linkAnim:"think_20_anim.png"},clap:{unicode:"clap",unicode_alternates:":clap:",name:"emoticon_clap_name",shortname:"(clap)",shortcuts:"(clap),(Clap)",category:"emoticons",keywords:"emoticon_clap_keywords",link:"clap_20.png",linkAnim:"clap_20_anim.png"},punch:{unicode:"punch",unicode_alternates:":punch:",name:"emoticon_punch_name",shortname:"(punch)",shortcuts:"(punch),(Punch),*|,*-|",category:"emoticons",keywords:"emoticon_punch_keywords",link:"punch_20.png",linkAnim:"punch_20_anim.png"},envy:{unicode:"envy",unicode_alternates:":angry:",name:"emoticon_envy_name",shortname:"(envy)",shortcuts:"(envy),(Envy)",category:"emoticons",keywords:"emoticon_envy_keywords",link:"envy_20.png",linkAnim:"envy_20_anim.png"},handshake:{unicode:"handshake",unicode_alternates:":ok_hand:",name:"emoticon_handshake_name",shortname:"(handshake)",shortcuts:"(handshake),(Handshake)",category:"emoticons",keywords:"emoticon_handshake_keywords",link:"handshake_20.png",linkAnim:"handshake_20_anim.png"},nod:{unicode:"nod",unicode_alternates:":thumbsup:",name:"emoticon_nod_name",shortname:"(nod)",shortcuts:"(nod),(Nod)",category:"emoticons",keywords:"emoticon_nod_keywords",link:"nod_20.png",linkAnim:"nod_20_anim.png"},nerdy:{unicode:"nerdy",unicode_alternates:":nerd:",name:"emoticon_nerdy_name",shortname:"(nerdy)",shortcuts:"(nerd),(Nerd),8-|,B-|,8|,B|,8=|,B=|,(nerdy),(Nerdy)",category:"emoticons",keywords:"emoticon_nerdy_keywords",link:"nerdy_20.png",linkAnim:"nerdy_20_anim.png"},emo:{unicode:"emo",unicode_alternates:":cry:",name:"emoticon_emo_name",shortname:"(emo)",shortcuts:"(emo),(Emo)",category:"emoticons",keywords:"emoticon_emo_keywords",link:"emo_20.png",linkAnim:"emo_20_anim.png"},muscle:{unicode:"muscle",unicode_alternates:":muscle:",name:"emoticon_muscle_name",shortname:"(muscle)",shortcuts:"(flex),(Flex),(muscle),(Muscle)",category:"emoticons",keywords:"emoticon_muscle_keywords",link:"muscle_20.png",linkAnim:"muscle_20_anim.png"},mmm:{unicode:"mmm",unicode_alternates:":thinking_face:",name:"emoticon_mmm_name",shortname:"(mmm)",shortcuts:"(mm),(Mm),(mmm),(Mmm),(mmmm),(Mmmm)",category:"emoticons",keywords:"emoticon_mmm_keywords",link:"mmm_20.png",linkAnim:"mmm_20_anim.png"},ok:{unicode:"ok",unicode_alternates:":ok_hand:",name:"emoticon_ok_name",shortname:"(ok)",shortcuts:"(ok),(OK),(oK),(Ok),(okay),(Okay)",category:"emoticons",keywords:"emoticon_ok_keywords",link:"ok_20.png",linkAnim:"ok_20_anim.png"},highfive:{unicode:"highfive",unicode_alternates:":raised_hand:",name:"emoticon_highfive_name",shortname:"(highfive)",shortcuts:"(highfive),(Highfive),(hifive),(Hifive),(h5),(H5)",category:"emoticons",keywords:"emoticon_highfive_keywords",link:"highfive_20.png",linkAnim:"highfive_20_anim.png"},turkey:{unicode:"turkey",unicode_alternates:":turkey:",name:"emoticon_turkey_name",shortname:"(turkey)",shortcuts:"(turkey),(Turkey),(turkeydance),(Turkeydance),(thanksgiving),(Thanksgiving)",category:"emoticons",keywords:"emoticon_turkey_keywords",link:"turkey_20.png",linkAnim:"turkey_20_anim.png"},call:{unicode:"call",unicode_alternates:":calling:",name:"emoticon_call_name",shortname:"(call)",shortcuts:"(call),(Call)",category:"emoticons",keywords:"emoticon_call_keywords",link:"call_20.png",linkAnim:"call_20_anim.png"},movember:{unicode:"movember",unicode_alternates:":guardsman:",name:"emoticon_movember_name",shortname:"(movember)",shortcuts:"(movember),(Movember),(mo),(Mo),(november),(November),(moustache),(Moustache),(mustache),(Mustache),(bowman),(Bowman),:{",category:"emoticons",keywords:"emoticon_movember_keywords",link:"movember_20.png",linkAnim:"movember_20_anim.png"},dog:{unicode:"dog",unicode_alternates:":dog:",name:"emoticon_dog_name",shortname:"(dog)",shortcuts:"(dog),(Dog),:o3,(&)",category:"emoticons",keywords:"emoticon_dog_keywords",link:"dog_20.png",linkAnim:"dog_20_anim.png"},coffee:{unicode:"coffee",unicode_alternates:":coffee:",name:"emoticon_coffee_name",shortname:"(coffee)",shortcuts:"(coffee),(Coffee)",category:"emoticons",keywords:"emoticon_coffee_keywords",link:"coffee_20.png",linkAnim:"coffee_20_anim.png"},poke:{unicode:"poke",unicode_alternates:":point_right:",name:"emoticon_poke_name",shortname:"(poke)",shortcuts:"(poke),(Poke),(nudge),(Nudge)",category:"emoticons",keywords:"emoticon_poke_keywords",link:"poke_20.png",linkAnim:"poke_20_anim.png"},swear:{unicode:"swear",unicode_alternates:":angry:",name:"emoticon_swear_name",shortname:"(swear)",shortcuts:"(swear),(Swear)",category:"emoticons",keywords:"emoticon_swear_keywords",link:"swear_20.png",linkAnim:"swear_20_anim.png"},donttalktome:{unicode:"donttalktome",unicode_alternates:":angry:",name:"emoticon_donttalktome_name",shortname:"(donttalktome)",shortcuts:"(donttalk),(Donttalk),(donttalktome),(Donttalktome)",category:"emoticons",keywords:"emoticon_donttalktome_keywords",link:"donttalktome_20.png",linkAnim:"donttalktome_20_anim.png"},fingerscrossed:{unicode:"fingerscrossed",unicode_alternates:":pray:",name:"emoticon_fingerscrossed_name",shortname:"(fingerscrossed)",shortcuts:"(yn),(Yn),(fingers),(Fingers),(fingerscrossed),(Fingerscrossed),(crossedfingers),(Crossedfingers)",category:"emoticons",keywords:"emoticon_fingerscrossed_keywords",link:"fingerscrossed_20.png",linkAnim:"fingerscrossed_20_anim.png"},rainbow:{unicode:"rainbow",unicode_alternates:":rainbow:",name:"emoticon_rainbow_name",shortname:"(rainbow)",shortcuts:"(rainbow),(Rainbow)",category:"emoticons",keywords:"emoticon_rainbow_keywords",link:"rainbow_20.png",linkAnim:"rainbow_20_anim.png"},headphones:{unicode:"headphones",unicode_alternates:":headphones:",name:"emoticon_headphones_name",shortname:"(headphones)",shortcuts:"(headphones),(Headphones)",category:"emoticons",keywords:"emoticon_headphones_keywords",link:"headphones_20.png",linkAnim:"headphones_20_anim.png"},waiting:{unicode:"waiting",unicode_alternates:":alarm_clock:",name:"emoticon_waiting_name",shortname:"(waiting)",shortcuts:"(waiting),(Waiting),(forever),(Forever),(impatience),(Impatience)",category:"emoticons",keywords:"emoticon_waiting_keywords",link:"waiting_20.png",linkAnim:"waiting_20_anim.png"},festiveparty:{unicode:"festiveparty",unicode_alternates:":tada:",name:"emoticon_festiveparty_name",shortname:"(festiveparty)",shortcuts:"(festiveparty),(Festiveparty),(partyxmas),(Partyxmas)",category:"emoticons",keywords:"emoticon_festiveparty_keywords",link:"festiveparty_20.png",linkAnim:"festiveparty_20_anim.png"},bandit:{unicode:"bandit",unicode_alternates:":spy:",name:"emoticon_bandit_name",shortname:"(bandit)",shortcuts:"(bandit),(Bandit)",category:"emoticons",keywords:"emoticon_bandit_keywords",link:"bandit_20.png",linkAnim:"bandit_20_anim.png"},heidy:{unicode:"heidy",unicode_alternates:":hamster:",name:"emoticon_heidy_name",shortname:"(heidy)",shortcuts:"(squirrel),(Squirrel),(heidy),(Heidy)",category:"emoticons",keywords:"emoticon_heidy_keywords",link:"heidy_20.png",linkAnim:"heidy_20_anim.png"},beer:{unicode:"beer",unicode_alternates:":beer:",name:"emoticon_beer_name",shortname:"(beer)",shortcuts:"(beer),(Beer),(bricklayers),(Bricklayers)",category:"emoticons",keywords:"emoticon_beer_keywords",link:"beer_20.png",linkAnim:"beer_20_anim.png"},doh:{unicode:"doh",unicode_alternates:":dizzy_face:",name:"emoticon_doh_name",shortname:"(doh)",shortcuts:"(doh),(Doh)",category:"emoticons",keywords:"emoticon_doh_keywords",link:"doh_20.png",linkAnim:"doh_20_anim.png"},bomb:{unicode:"bomb",unicode_alternates:":bomb:",name:"emoticon_bomb_name",shortname:"(bomb)",shortcuts:"(bomb),(Bomb),(explosion),(Explosion),(explode),(Explode),@=",category:"emoticons",keywords:"emoticon_bomb_keywords",link:"bomb_20.png",linkAnim:"bomb_20_anim.png"},happy:{unicode:"happy",unicode_alternates:":smile:",name:"emoticon_happy_name",shortname:"(happy)",shortcuts:"(happy),(Happy)",category:"emoticons",keywords:"emoticon_happy_keywords",link:"happy_20.png",linkAnim:"happy_20_anim.png"},ninja:{unicode:"ninja",unicode_alternates:":spy:",name:"emoticon_ninja_name",shortname:"(ninja)",shortcuts:"(ninja),(Ninja)",category:"emoticons",keywords:"emoticon_ninja_keywords",link:"ninja_20.png",linkAnim:"ninja_20_anim.png"}},t.getConfiguration=function(){return new Promise(function(e,n){t.config?e(t.config):t.init().then(function(t){e(t)})})},t}return r(t,e),t.prototype._filterConfiguration=function(e){var t=Object.keys(this._teamsEmotes),n=function(e){for(var n in t)if(t[n]===e)return!0;return!1};for(var i in e.items=e.items.filter(function(e){return n(e.id)}),e.packs)e.packs[i].items=e.packs[i].items.filter(function(e){return n(e.id)});return e},t.prototype.init=function(){var e=this;return new Promise(function(t,n){e.initSkype().then(function(n){e.config=e._filterConfiguration(n),t(e.config)})})},t}(n(146).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(20),o=n(53),a=n(3),s=n(318),c=n(319),l=function(){function e(){this.updateFileName=function(e,t){var n="$1 ("+t+")$2";return e.replace(/^(.+)(\.[\w\d]+)$/g,n)},this.checkFile=function(e){var t=a.default.mePerson.personalFileSite.personalRootFolderUrl.match(/^https?:\/\/[^\/]+(.*)\/?$/),n=(t[0],{parentServerRelativeUrl:t[1]+"/Microsoft Teams Chat Files",itemName:e,createBlankFile:!1,overwrite:!1}),r=o.addGetParamsToUrl(i.default.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files",n);return new Promise(function(e,t){s.post("api.teams.microsoft.com",r,"").then(function(n){if(n.errorCode&&"FilenameCollision"===n.errorCode)return t(n);e(n)})})},this.downloadFile=function(e){var t="_api/web/GetFileByServerRelativeUrl('"+e.fileInfo.serverRelativeUrl+"')/GetPreAuthorizedAccessUrl(1)";return s.get("SharepointService.downloadFile",""+e.baseUrl+t).then(function(e){return s.getData("SharepointService.downloadFile",e.value)})}}return e.prototype.uploadFile=function(e){var t=this,n=function(i,r){return void 0===r&&(r=0),new Promise(function(o){t.checkFile(i).then(function(e){return o(e.value)}).catch(function(i){return n(t.updateFileName(e.name,++r),r).then(o)})})};return new Promise(function(t,i){n(e.name).then(function(n){return function(e,n){var o=a.default.mePerson.personalFileSite,s=r.guid.generate(),l="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/StartUpload(uploadId=guid'"+s+"')",u="@folder='"+n.siteInfo.relativeUrl+"'&@file='"+n.title+"'",d=""+o.personalSiteUrl+l+"?"+u,p=function(t){var i="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/FinishUpload(uploadId=guid'"+s+"',fileOffset="+e.size+")",r=""+o.personalSiteUrl+i+"?"+u;c.post(r,"").then(function(){return t(n)})};c.post(d,e).then(function(){return p(t)}).catch(function(){return p(i)})}(e,n)})})},e.prototype.shareFile=function(e,t){var n=i.default.SHAREPOINT_URL+"_api/SP.Sharing.DocumentSharingManager.UpdateDocumentSharingInfo",r={additiveMode:!1,customMessage:"Shared a file",includeAnonymousLinksInNotification:!0,resourceAddress:e,sendServerManagedNotification:!1,userRoleAssignments:t.map(function(e){return{Role:2,UserId:e}}),validateExistingPermissions:!1};return c.postJson(n,JSON.stringify(r))},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(102),o=n(3),a=n(55),s=n(16),c={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,i){return t.getHeaders().then(function(t){return function(e,t,n){return s.default("sharepoint-"+e,c,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.getHeaders=function(e){return void 0===e&&(e=a.AadAudience.SpacesApi),new Promise(function(t){Promise.all([o.default.signInManager.aad(e),o.default.signInManager.getSkypeToken()]).then(function(e){var n=e[0],r=e[1],o=new Headers;o.append("Authorization",n),o.append("x-skypetoken",r),o.append("x-skype-client",i.default.getClientVersion()),t(o)})})},t.get=function(e,n){var i=n.match(/^(https?:\/\/[^\/]+).*\/?$/),o=(i[0],i[1]);return t.getHeaders(o).then(function(t){var i={method:"GET"};return i.headers=t,i.headers.append("Accept","application/json"),r.request(e,n,i).then(function(e){return e.json()})})},t.getData=function(e,t){var n=new Headers;n.append("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch, br");var i={method:"GET"};return i.headers=n,r.request(e,t,i).then(function(e){return e.blob()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(55),a=n(16),s={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return a.default("sharepoint-"+e,s,t,n)};t.postJson=function(e,n){return t.getHeaders("application/json").then(function(t){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:t,body:n}).then(function(e){try{return e.json()}catch(t){return e}})})},t.post=function(e,n){return t.getHeaders().then(function(t){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:t,body:n}).then(function(e){try{return e.json()}catch(t){return e}})})},t.getHeaders=function(e){return new Promise(function(t){r.default.signInManager.aad(o.SHAREPOINT_AAD_AUD).then(function(n){var r=new Headers;r.append("Authorization",n),r.append("x-skype-client",i.default.getClientVersion()),r.append("Accept","application/json"),e&&r.append("content-type",e),t(r)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(10),o=n(11),a=n(20),s=n(147),c=n(3),l=n(321),u=function(){function e(){this._profiles={}}return e.prototype.fetchProfiles=function(e){var t=this;return this.getEcsConfig().then(function(){var n="?requestid="+t.getAppDataParams()+"&locale="+i.default.LOCALE+"&searchstring="+e;return l.get("namesearch",n).then(function(e){return e&&e.results.forEach(function(e){var t=c.default.persons.getPerson(e.nodeProfileData.skypeId,!1,!1);t.displayName=e.nodeProfileData.name,t.avatarData=e.nodeProfileData.avatarUrl}),e})},this.searchV1.bind(this,e))},e.prototype.searchV1=function(e){var t="search/v1.1/namesearch/swx/?requestid="+this.getAppDataParams()+"&locale="+i.default.LOCALE+"&searchstring="+e;return l.get("namesearch",t)},e.prototype.getAppDataParams=function(){return[i.default.APPNAME,i.default.ECS.version,a.guid.generate()].join("-")},e.prototype.getEcsConfig=function(){if(e.getEcsConfigPromise)return e.getEcsConfigPromise;var t={id:c.default.signInManager.currentUserName};return e.getEcsConfigPromise=s.configLoader(s.EcsClient.Skype,t).then(function(e){i.default.ECS_GRAPH_ETAG=e.Headers.ETag;var t=e.PeopleSearch?e.PeopleSearch:void 0;if(t&&t.v2Endpoint&&(i.default.ECS_GRAPH_URL=t.v2Endpoint),t&&t.serviceSettings){var n=t.serviceSettings;i.default.ECS_GRAPH_SERVICE_SETTINGS="experiment="+n.experiment+";geoProximity="+n.geoProximity}},function(e){throw o.default.throwError(r.ErrorCodes.ERR_GET_ADVANCED_SEARCH_PARAMS,"Unable to get advanced search params",e),e}),e.getEcsConfigPromise},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(322),a={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,o.cache="no-cache",function(e,t,n){return r.default("skypegraph-"+e,a,i.default.ECS_GRAPH_URL+t,n)}(e,t,o).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(3);t.getHeaders=function(){return new Promise(function(e){r.default.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",i.default.getClientVersion()),i.default.ECS_GRAPH_ETAG&&n.append("x-ecs-etag",i.default.ECS_GRAPH_ETAG),i.default.ECS_GRAPH_SERVICE_SETTINGS&&n.append("x-skypegraphservicesettings",i.default.ECS_GRAPH_SERVICE_SETTINGS),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(324),o=function(){function e(){this.timeout=0,this.idInQueue=[]}return e.prototype.fetchMeProperties=function(){return r.get("fetchMeProfiles","users/self/profile")},e.prototype.fetchPerson=function(e){var t=this;return this.idInQueue.push(e),10!==this.idInQueue.length?this.idInQueue.length>1?this.idInQueuePromise:(this.idInQueuePromise=new Promise(function(e,n){t.lastCreatedRequest=function(){t.fetchPersons(t.idInQueue).then(e,n),t.idInQueue=[],clearTimeout(t.timeout)},t.timeout=setTimeout(t.lastCreatedRequest,2e3)}),this.idInQueuePromise):(this.lastCreatedRequest(),this.idInQueuePromise)},e.prototype.getAvatarUrl=function(e){return i.default.STRATUS_DOMAIN_HOST_URL+"users/"+e+"/profile/avatar?cacheHeaders=1"},e.prototype.fetchPersons=function(e){var t={usernames:e};return r.post("fetchPersons","batch/profiles",JSON.stringify(t))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(16),o=n(325),a={retryCount:3,timeout:12e4,policy:""},s=function(e,t,n){return r.default("stratus-"+e,a,i.default.STRATUS_DOMAIN_HOST_URL+t,n)};t.put=function(e,t,n){return o.putHeaders().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,s(e,t,r)})},t.post=function(e,t,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"POST"};return r.body=n,r.headers=i,s(e,t,r).then(function(e){return e.json()})})};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return r.default("stratus-"+e,a,(o||i.default.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.json()})}(e,t,o)})},t.getData=function(e,t){return o.getDataHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return r.default("stratus-"+e,a,(o||i.default.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.blob()})}(e,t,o)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(3);function o(e){var t=new Headers;return e&&t.append("X-Skypetoken",e),t.append("X-Stratus-Caller",i.default.getUiVersion()),t}t.putHeaders=function(){return new Promise(function(e){r.default.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Content-Type","application/x-www-form-urlencoded"),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){r.default.signInManager.getSkypeToken().then(function(t){var n=o(t);e(n)},function(){})})},t.getProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","application/json, text/javascript"),e(t)})},t.getDataHeaders=function(){return new Promise(function(e){r.default.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Accept","image/webp,image/*,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch"),e(n)},function(){})})},t.getDataProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","image/webp,image/*,*/*;q=0.8"),t.append("Accept-Encoding","gzip, deflate, sdch"),e(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(143),o=n(3),a=n(16),s=function(){function e(){this.ongoingRequest={}}return e.prototype.fetchMeProperties=function(){return Promise.resolve()},e.prototype.fetchShortProfile=function(e){return o.default.signInManager.aad().then(function(t){return a.default("teams-shortProfile",{retryCount:1,timeout:12e4,policy:""},i.default.TEAMS_PROFILE_URL+"api/mt/amer/beta/users/fetchShortProfile?isMailAddress=false&enableGuest=true&skypeTeamsInfo=true",{method:"post",headers:{Authorization:t,"x-ms-client-type":"web","x-ms-user-type":"user","content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json?e.json().then(function(e){return e.value}):Promise.reject("Unable to fetch person")})})},e.prototype.fetchPerson=function(e){var t=this,n=e.indexOf("8:")>-1?e:"8:"+e;return this.ongoingRequest[n]?this.ongoingRequest[n]:(this.ongoingRequest[n]=new Promise(function(e,r){o.default.signInManager.aad().then(function(s){a.default("teams-shortProfile",{retryCount:1,timeout:12e4,policy:""},i.default.TEAMS_PROFILE_URL+"api/mt/amer/beta/users/fetchShortProfile?isMailAddress=false&enableGuest=true&skypeTeamsInfo=true",{method:"post",headers:{Authorization:s,"x-ms-client-type":"web","x-ms-user-type":"user","content-type":"application/json"},body:JSON.stringify([n])}).then(function(i){i.json&&i.json().then(function(t){var n=t.value.map(function(e){return o.default.avatarService.fetchAvatars(t.value[0].mri,t.value[0].displayName)});Promise.all(n).then(function(n){var i=t.value.map(function(e,t){return{avatarUrl:"",username:e.mri,displayname:e.displayName,avatarData:n[t]}});e(i)})},function(e){delete t.ongoingRequest[n],r(e)})},function(e){delete t.ongoingRequest[n],r(e)})},r)}),this.ongoingRequest[n])},e.prototype.saveContactInfo=function(e){o.default.contactsService.addContact(e.mri,"",r.default.createContactFromShortProfile(e))},e.prototype.getAvatarUrl=function(e){return""},e.prototype.fetchPersons=function(e){return Promise.resolve([])},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(328),o=function(){function e(){}return e.prototype.fetchProfiles=function(e){if(e.length>3){return new Promise(function(t){r.post("search","https://teams.microsoft.com/api/mt/amer/beta/users/search?includeDLs=true&includeBots=true&enableGuest=true&skypeTeamsInfo=true",e).then(function(e){e.value&&e.value.forEach(function(e){if(e.mri){var t=i.default.persons.getPerson(e.mri,!1,!1);t.displayName=e.displayName,t.email=e.email,t.description=e.jobTitle,i.default.avatarService.fetchAvatars(e.mri,e.displayName).then(function(e){e&&(t.avatarData=e)})}}),t(e.value)})})}return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(55),a=n(16),s={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,i){return t.getHeaders().then(function(t){return function(e,t,n){return a.default("teamsgraph-"+e,s,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.getHeaders=function(){return new Promise(function(e){Promise.all([r.default.signInManager.aad(o.SKYPE_AAD_AUD),r.default.signInManager.getSkypeToken()]).then(function(t){var n=t[0],r=t[1],o=new Headers;o.append("Authorization",n),o.append("x-skypetoken",r),o.append("x-skype-client",i.default.getClientVersion()),e(o)})})}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(2),s=n(24),c=n(5),l=n(8),u=function(e){function t(){var t=e.call(this,"kpi_inapp_activity_start")||this;return t.foregroundStartTime="",t}return r(t,e),t.send=function(e){o.default.signInManager.getSkypeToken().then(function(){var n=new t;n.entryPoint=e,n.foregroundStartTime=Date.now()+"",n.userName=o.default.signInManager.currentUserName,o.default.telemetryManager.sendEvent(n)},function(){}).catch()},t.prototype.getCustomProperties=function(){var e=new Array;return e.push(c.TelemetryPropertyValue.Create("Foreground_Start_Time",this.foregroundStartTime||l.NA)),e.push(c.TelemetryPropertyValue.Create("Entry_Point",this.entryPoint||l.NA)),e.push(c.TelemetryPropertyValue.Create("Skype_InitiatingUser_Username",this.userName||l.NA)),e.push(c.TelemetryPropertyValue.Create("Platform_Uiversion",a.default.getUiVersion())),e.push(c.TelemetryPropertyValue.Create("DeviceInfo_OsVersion",s.default.getOsVersion())),e.push(c.TelemetryPropertyValue.Create("Client_Name","SWC")),e.push(c.TelemetryPropertyValue.Create("ETag",l.NA)),e},t}(l.TelemetryEvent);t.default=u},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=function(){function t(){}return t.translate=function(e,t,n){var i="https://dev.microsofttranslator.com/api/skype/translate?from="+e+"&to="+t+"&text="+n;return this._requestWithToken(i)},t.detect=function(t){var n="https://f3cc4fc2.ngrok.io/detect?text="+t;return new Promise(function(t,i){return e(encodeURI(n),{method:"GET"}).then(function(e){e.json().then(function(e){var n=e.string.$t.split("-")[0];t(n)}).catch(function(e){i(e)})},function(e){i(e)})})},t.getLanguages=function(){return this._requestWithToken("https://dev.microsofttranslator.com/api/languages")},t._requestWithToken=function(t){var n=new Headers,r={};return new Promise(function(o,a){i.default.signInManager.getSkypeToken().then(function(i){return n.append("Content-Type","application/x-www-form-urlencoded"),n.append("X-Skypetoken",i),n.append("X-ScenarioId","FF63883DDDED40068EC45030A601460C"),r.method="GET",r.headers=n,e(encodeURI(t),r).then(function(e){e.json().then(function(e){o(e)}).catch(function(e){a(e)})},function(e){a(e)})})})},t}();t.default=r}).call(this,n(61))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(332),r=function(){function e(){this._conversations={}}return e.prototype.get=function(e,t){return this._conversations.hasOwnProperty(e)||(this._conversations[e]=new i.default(e,t)),this._conversations[e]},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(111),a=n(4),s=n(1),c=n(18),l=n(40),u=n(10),d=n(13),p=n(26),h=n(0),f=n(46),g=n(11),m=n(31),_=n(333),v=n(7),y=n(334),S=n(335),E=n(25),T=n(141),C=function(e){function t(t,n){var i=e.call(this)||this;return i._definition=n,i.backend=d.MessagingBackend.UNDETERMINED,i.isAgent=function(){return!!i.id&&("28"===i.id.split(":")[0]||"99"===i.id.split(":")[0])},i.isGroup=function(){return!!i.id&&0===i.id.indexOf("19:")},i.isPerson=function(){return!!i.id&&(0===i.id.indexOf("8:")||0===i.id.indexOf("2:"))},i.messagesReceived=0,i.messagesSent=0,i.sdkMode=p.SDKMode.UNDEFINED,i._contextAad="",i._isChatEnabled=!0,i._topic="",i._alertsOff=!1,i.sendLiveState=function(){return i._messagingService.sendLiveState()},i.download=function(e){return i.externalDownload&&h.swc.API.triggerEvent(a.ApiEvents.conversationProxy.resDownload,{refId:i.refId,url:e})},i.setupProxy=function(){var e=function(e){return e===i.id};i._isOneOnOne||h.swc.API.registerEvent(a.ApiEvents.conversationProxy.connected,function(t){e(t.id)&&i.heartBeat&&(t.connected?i.heartBeat.connect():i.heartBeat.disconnect())}),h.swc.API.registerEvent(a.ApiEvents.conversationProxy.regMessageReceived,function(t){e(t.id)&&(i.refId=i.refId||t.refId,i.messageReceivedProxied=!0)}),h.swc.API.registerEvent(a.ApiEvents.conversationProxy.regDownload,function(t){e(t.id)&&(i.refId=i.refId||t.refId,i.externalDownload=!0)})},i._id=t,i.sdkMode=m.default.getSdkModeFromId(i._id),i._messages=new l.ObservableCollection,i._allMessages=new l.ObservableCollection,i._participants=new l.ObservableCollection,i._messagingService=i.isDirectLineBackend()?new y.default(i):new S.default(i),i._isControlOpen=!1,i._consumptionHorizon=new T.ConsumptionHorizon,i._unreadMessagesCount=0,i.isActive=!0,i._isOneOnOne=i.getConversationType()!==v.ConversationType.GROUP,i._isOneOnOne||(i.heartBeat=new _.HeartBeat(i.sendLiveState)),i.setupProxy(),i.members=[],i}return r(t,e),Object.defineProperty(t.prototype,"allMessages",{get:function(){return this._allMessages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this._avatar},set:function(e){((e=f.default.resolveConversationAvatar(this.isGroup(),e))||e!==this._avatar)&&(this._avatar=e,this.publish("avatar",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"consumptionHorizon",{get:function(){return this._consumptionHorizon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contextAad",{get:function(){return this._contextAad},set:function(e){e=(e=E.default.dompurify.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]})).replace(/["()\'/+*`~!@#$%^\[\]:=]/g,""),this._contextAad=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e,this.publish("definition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},set:function(e){var t=e&&e!==this._isActive;this._isActive=e,t&&this.markAsRead()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChatEnabled",{get:function(){return this._isChatEnabled},set:function(e){e!==this._isChatEnabled&&(this._isChatEnabled=e,this.publish("isChatEnabled",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isControlOpen",{get:function(){return this._isControlOpen},set:function(e){this._isControlOpen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isNew",{get:function(){return this._isNew},set:function(e){e!==this._isNew&&(this._isNew=e,this.publish("isNew",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOneOnOne",{get:function(){return this._isOneOnOne},set:function(e){this._isOneOnOne!==e&&(this._isOneOnOne="true"===e,this.publish("isOneOnOne",this._isOneOnOne))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnderQuarantine",{get:function(){return this._isUnderQuarantine},set:function(e){e!==this._isUnderQuarantine&&(this._isUnderQuarantine=e,this.publish("isUnderQuarantine",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"members",{get:function(){return this._members},set:function(e){this._members=e,this.publish("members",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selfParticipant",{get:function(){return this._selfParticipant},set:function(e){e!==this._selfParticipant&&(this._selfParticipant=e,this.publish("selfParticipant",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topic",{get:function(){return this._topic},set:function(e){e!==this._topic&&(this._topic=e,this.publish("topic",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unreadMessagesCount",{get:function(){return this._unreadMessagesCount},set:function(e){this._unreadMessagesCount!==e&&(this._unreadMessagesCount=e,this.publish("unreadMessagesCount",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alertsOff",{get:function(){return this._alertsOff},set:function(e){e!==this._alertsOff&&(this._alertsOff=e,this.publish("alertsOff",e))},enumerable:!0,configurable:!0}),t.prototype.addBotToThread=function(e){this._messagingService.addBotToThread(e)},t.prototype.addParticipant=function(e){this._messagingService.addParticipantToThread(e)},t.prototype.deleteConversation=function(){return this._messagingService.deleteConversation(this.id)},t.prototype.deleteMessage=function(e){return this._messagingService.deleteMessage(e)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._contextAad="",this._messages&&(this._messages.forEach(function(e){e.dispose()}),this._messages.dispose(),this._messages.spliceObservable(0,this._messages.length)),this._participants.dispose(),this._isDisposed=!0,this._messagingService.dispose()},t.prototype.editMessage=function(e,t){return this._messagingService.editMessage(e,t)},t.prototype.getBackend=function(){if(this.backend!==d.MessagingBackend.UNDETERMINED)return this.backend;switch(this.id.split(":")[0]){case"8":case"28":case"19":this.backend=d.MessagingBackend.SKYPE;break;case"99":this.backend=d.MessagingBackend.DIRECT_LINE;break;default:return d.MessagingBackend.UNDETERMINED}return this.backend},t.prototype.getConversationType=function(){if(0===this._id.indexOf("http"))return v.ConversationType.JOIN;if(this.isDirectLineBackend())return v.ConversationType.AGENT;switch(this._id.split(":")[0]){case"4":return v.ConversationType.PHONE;case"8":return v.ConversationType.PERSON;case"28":case"99":return v.ConversationType.AGENT;case"19":return v.ConversationType.GROUP;default:return v.ConversationType.UNDEFINED}},t.prototype.getReceviedMessagesCount=function(){return 0},t.prototype.getSentMessagesCount=function(){return 0},t.prototype.isDirectLineBackend=function(){return this.getBackend()===d.MessagingBackend.DIRECT_LINE},t.prototype.isSkypeBackend=function(){return this.getBackend()===d.MessagingBackend.SKYPE},t.prototype.isWithMe=function(){return this.getConversationType()===v.ConversationType.PERSON&&m.default.isEqual(this.id,s.default.instance.SignInManager.currentUserName)},t.prototype.loadMoreMessages=function(){return this._messagingService.loadMoreMessages(this)},t.prototype.markAsRead=function(){this._messagingService.markAsRead()},t.prototype.removeMessageProperty=function(e,t,n,i){return this._messagingService.removeMessageProperty(e,t,n,i)},t.prototype.removeParticipant=function(e){return this._messagingService.removeParticipantFromThread(e)},t.prototype.sendDataToBot=function(e){if(this.getConversationType()===v.ConversationType.GROUP){var t=this.participants.filter(function(e){return e.person.isAgent});if(t.length>0)return this._messagingService.sendDataToBot(m.default.toFullIdentifier(t[0].person.id),e)}return this.isAgent()?this._messagingService.sendDataToBot(this.id,e):Promise.resolve()},t.prototype.sendFile=function(e){return h.swc.API.triggerEvent(a.ApiEvents.OnMessageSent,{type:o.default.File}),this._messagingService.sendFile(e)},t.prototype.sendFileAsProperty=function(e){return h.swc.API.triggerEvent(a.ApiEvents.OnMessageSent,{type:o.default.Card}),this._messagingService.sendFileAsProperty(e)},t.prototype.sendImage=function(e){return h.swc.API.triggerEvent(a.ApiEvents.OnMessageSent,{type:o.default.File}),this._messagingService.sendImage(e)},t.prototype.sendMessage=function(e,t,n){this._messagingService.sendMessage(e,t,n),h.swc.API.triggerEvent(a.ApiEvents.OnMessageSent,{type:o.default.Text})},t.prototype.sendSwift=function(e){return h.swc.API.triggerEvent(a.ApiEvents.OnMessageSent,{type:o.default.Card}),this._messagingService.sendSwift(e)},t.prototype.setIsTyping=function(e){this._messagingService.setIsTyping(e)},t.prototype.setMessageProperty=function(e,t,n,i){return this._messagingService.setMessageProperty(e,t,n,i)},t.prototype.setParticipantTyping=function(e,t){var n=this._participants.filter(function(t){return t.person.id===e});n.length&&(n[0].isTyping=t)},t.prototype.setTopic=function(e){this._messagingService.setConversationTopic(e)},t.prototype.start=function(){var e=this;return this._isDisposed=!1,this._messagingService.startConversation().then(function(){e._isLoaded=!0,e.publish("isLoaded",!0)},function(t){g.default.throwError(u.ErrorCodes.ERR_START_CONVERSATION,"Unable to start conversation",t,e.id)})},t.prototype.startGuestConversation=function(){return this.isAgent()?this._messagingService.startGuestConversation():Promise.resolve()},t.prototype.update=function(e){this._id===e.id&&(this.properties=e.properties||this.properties,this.threadProperties=e.threadProperties||this.threadProperties,this.isBlocked=I(e.properties),this.updateConsumptionHorizon(this.properties.consumptionhorizon),this.alertsOff=A(e.properties))},t.prototype.updateConsumptionHorizon=function(e){e&&e!==this._consumptionHorizon.value&&this._consumptionHorizon.set(e)},t.prototype.messageReceived=function(e,t){var n={type:e,messageType:t};h.swc.API.triggerEvent(a.ApiEvents.OnMessageReceived,n),this.messageReceivedProxied&&h.swc.API.triggerEvent(a.ApiEvents.conversationProxy.messageReceived,{refId:this.refId,message:n})},t}(c.default);t.default=C;var I=function(e){return!!e.conversationblocked&&"true"===e.conversationblocked.toLocaleLowerCase()},A=function(e){return!!e.alerts&&/false/i.test(e.alerts)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.callback=e}return e.prototype.connect=function(){this.timer||(this.callback(),this.timer=setInterval(this.callback,3e4))},e.prototype.disconnect=function(){clearInterval(this.timer)},e}();t.HeartBeat=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),r=n(111),o=n(4),a=n(50),s=n(88),c=n(1),l=n(21),u=n(44),d=n(10),p=n(73),h=n(51),f=n(118),g=n(14),m=n(107),_=n(54),v=n(7),y=n(75),S=n(58),E=n(81),T=n(149),C=n(11),I=n(150),A=function(){function e(e){var t=this;this.conversation=e,this._encoder=new a.default([],[new s.URLDomTransformer]),this._failedAttemptsCount=0,this.enquedMessages=new Array,this.isMessageProcessed=function(e){return 0!==t.sentMessages.length&&t.sentMessages.some(function(t){return t.content===e})},this.onMessageReceiveHandler=function(e){var n=!1,a=e.text?t._encoder.encode(e.text):null;if(!a&&!e.attachments&&!e.channelData)return n;if(a&&0===a.length&&e.attachments&&0===e.attachments.length&&e.channelData&&e.channelData.attachments&&0===e.channelData.attachments.length)return n;if("user"===(e.from.id||e.from.name||e.from))return n;n=!0,t.conversation.topic||(t.conversation.topic=e.from.name||"");var s=t.parseRaw(e);t.conversation.messages.pushObservable(s);var l=new I.default(t.conversation);return l.messageType=s.type,c.default.instance.TelemetryService.sendEvent(l),t.conversation.participants[0].isTyping=!1,i.default.triggerEvent(o.ApiEvents.OnMessageReceived,{type:r.default.getReceivedMessageType(s.type)}),n},this.sentMessages=[],this.conversation||C.default.throwError(d.ErrorCodes.ERR_CONVERSATION_MISSING,"conversation is missing"),this.conversation.id||C.default.throwError(d.ErrorCodes.DBG_DL_REQUIRES_TOKEN,"Directline mode requires token"),this.conversation.avatar=this.conversation.avatar||this.createDefaultAvatar(),this.directLineApi=l.loadServices().then(function(e){return e.createDirectLineService(t.conversation.id,t.conversation.definition.BingDLApi)})}return e.prototype.addBotToThread=function(e){},e.prototype.addParticipantToThread=function(e){},e.prototype.deleteConversation=function(e){return null},e.prototype.deleteMessage=function(e){return null},e.prototype.dispose=function(){this.directLineApi.then(function(e){e.dispose()}),this._postMessageTimeout&&this._postMessageTimeout.reset()},e.prototype.editMessage=function(e,t){return null},e.prototype.getUnreadMessagesCount=function(){return 0},e.prototype.loadMoreMessages=function(e){return Promise.reject("not implemented")},e.prototype.markAsRead=function(){},e.prototype.removeMessageProperty=function(e,t,n,i){return null},e.prototype.removeParticipantFromThread=function(e){return Promise.reject("not implemented")},e.prototype.sendDataToBot=function(e,t){return Promise.resolve()},e.prototype.sendFile=function(e){return Promise.reject("not implemented")},e.prototype.sendFileAsProperty=function(e){return Promise.reject({})},e.prototype.sendImage=function(e){return Promise.reject("not implemented")},e.prototype.sendMessage=function(e,t,n){var i=this;this.conversation.participants[0].isTyping=!0;var r={channelData:this.conversation.definition.Payload,payload:n};if(e=(e=e||"").trim(),this.lastMessage=new y.default(!1,r),this.lastMessage.processedContent=n?n.title:null,this.lastMessage.content=e?this._encoder.encode(e):"",this.lastMessage.direction=v.Direction.Outgoing,this.lastMessage.type=v.MessageType.UserMessage,t===u.ActionTrigger.SUGGESTED_ACTION&&n.image){var o='<img src="'+encodeURI(n.image)+'" />';this.lastMessage.imageContent=o?g.default.getMessageSanitizedContent(h.default.parse(o)):""}e.length>0&&this.conversation.messages.pushObservable(this.lastMessage);var a=new T.MessageSentEvent(this.conversation);return a.origin=t,a.messageLength=this.lastMessage.content.length,a.messageType=p.MessageType.TEXT,this.enquedMessages.push({message:this.lastMessage,event:a}),this.enquedMessages.length>=1&&(this.lastDequeue=new Promise(function(e,t){i._postMessageTimeout&&i._postMessageTimeout.reset(),i._postMessageTimeout=new _.FixedTimeout(i.dequeueMessages.bind(i,e),5e3),i.dequeueMessages(e)})),this.lastDequeue},e.prototype.sendSwift=function(e){var t=e.value;return t?this.sendMessage(t,u.ActionTrigger.SUGGESTED_ACTION,e):Promise.reject("swift - Cannot send empty payload")},e.prototype.setConversationTopic=function(e){},e.prototype.setIsTyping=function(e){},e.prototype.setMessageProperty=function(e,t,n,i){return null},e.prototype.startConversation=function(){var e=this;return new Promise(function(t,n){var i=Date.now();e.directLineApi.then(function(r){r.setSystemMessagesHandler(e.addLocalSystemMessage.bind(e)),r.createConversation().then(function(n){r.initPolling(n,e.onMessageReceiveHandler);var o=c.default.instance.Persons.createEmptyPerson(n);e.conversation.participants.pushObservable(new S.default(o)),e.conversation.id=n;var a=new E.ConversationLoadEvent(e.conversation);a.timeToLoad=Date.now()-i,c.default.instance.TelemetryService.sendEvent(a),t()},function(t){e.addLocalSystemMessage("polling_failed"),n(t)})},n)})},e.prototype.startGuestConversation=function(){return Promise.reject("not implemented")},e.prototype.stopListeningConversation=function(){},e.prototype._convertDirectlineToSwiftTypes=function(e){var t,n=e.thumbnailUrl?e.thumbnailUrl:"",i=!!e.autoPlay&&e.autoPlay,r=!!e.loop&&e.loop,o=e.name?e.name:"";switch(e.contentType){case"image/png":case"image/jpg":case"image/jpeg":case"image/gif":t={content:{image:{url:e.contentUrl},title:o},contentType:"application/vnd.microsoft.card.hero"};break;case"audio/mpeg":case"audio/mp4":t={content:{media:[{url:e.contentUrl}],autoloop:r,image:{url:n},title:o},contentType:"application/vnd.microsoft.card.audio"};break;case"video/mp4":t={content:{media:[{url:e.contentUrl}],autoloop:r,autostart:i,title:o},contentType:"application/vnd.microsoft.card.video"};break;default:t=e}return t},e.prototype.addLocalSystemMessage=function(e){this.conversation.participants.length&&(this.conversation.participants[0].isTyping=!1);c.default.instance.i18n.fetch(e)},e.prototype.createDefaultAvatar=function(){var e=Math.floor(11*Math.random());return"https://bot-framework.azureedge.net/bot-icons-v1/bot-framework-default-"+(e=0===e?1:e)+".png"},e.prototype.dequeueMessages=function(e){var t=this;var n=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n&&!n.isSending)return n}return null}(this.enquedMessages);if(n){n.isSending=!0;var i=n.message,r=n.event;r.timeToSend=Date.now();var o=n.message.payload||this.conversation.definition.Payload;this.directLineApi.then(function(a){a.postMessage(i.content,t.conversation.id,o).then(function(i){r.timeToSend=Date.now()-r.timeToSend,r.status=i.status,t._failedAttemptsCount=0,a.initPolling(t.conversation.id,t.onMessageReceiveHandler),t.sentMessages.push(n.message),c.default.instance.TelemetryService.sendEvent(r),t.enquedMessages.splice(0,1),t.dequeueMessages(e)},function(e){if(n.isSending=!1,t._failedAttemptsCount++,r.timeToSend=Date.now()-r.timeToSend,r.status=e.status,c.default.instance.TelemetryService.sendEvent(r),t._failedAttemptsCount>=m.MAX_RETRY_ATTEMPTS)return t.addLocalSystemMessage("message_failed"),void(t._failedAttemptsCount=0);t._postMessageTimeout.start()})})}else e()},e.prototype.getSwiftCardType=function(e,t){var n={carousel:"message/card.carousel",multiline:"message/card.multiline",card:"message/card"};return n[e.attachmentLayout]?n[e.attachmentLayout]:t.length>1?n.multiline:n.card},e.prototype.parseRaw=function(e){var t=this,n=new y.default(!1),i=e.text?e.text:"",r=e.from.id||e.from,o=e.attachments&&e.attachments.length>0||e.channelData&&e.channelData.attachments&&e.channelData.attachments.length>0;if(n.direction="guest"===e.from||"guest"===e.from.id||"user"===e.from||"user"===e.from.id?v.Direction.Outgoing:v.Direction.Incoming,e.suggestedActions&&e.suggestedActions.actions&&e.suggestedActions.actions.forEach(function(e){n.suggestedActions.pushObservable(new f.default(e,t.conversation,r))}),"system"===e.from&&(n.type=v.MessageType.SystemMessage),o){var a=void 0;e.attachments&&e.attachments.length>0?a=e.attachments:e.channelData.attachments&&e.channelData.attachments.length>0&&(a=e.channelData.attachments);var s=this.getSwiftCardType(e,a);a&&a.length>0&&(a=a.map(function(e){return t._convertDirectlineToSwiftTypes(e)}));var c={content:i,summary:"",attachments:a,type:s};n.content='<SwiftCard Swift="'+JSON.stringify(c)+'"></SwiftCard>',n.type=v.MessageType.SwiftCard,n.senderId=r}else e.text&&(n.content=this._encoder.encode(i));return n},e}();t.default=A},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(111),r=n(4),o=n(6),a=n(50),s=n(1),c=n(219),l=n(17),u=n(40),d=n(44),p=n(336),h=n(10),f=n(32),g=n(73),m=n(13),_=n(51),v=n(106),y=n(25),S=n(81),E=n(150),T=n(149),C=n(337),I=n(0),A=n(118),b=n(240),O=n(11),R=n(31),P=n(241),N=n(14),w=n(70),M=n(43),k=n(120),D=n(54),L=n(7),U=n(58),x=/(^|\s)(https?:\/\/[^\s]*\.(?:png\?\d+|png|jpg\?\d+|jpg|jpeg\?\d+|jpeg|gif))($|<|\s)/gim,F={ALLOWED_TAGS:["img","a"],ALLOWED_ATTR:["target","src","alt","class","href"]},H=/<a href="([^"]+)"( target="([^"]+)")?>([^<]+)<\/a>/g,G=730,j=5e3,B=3e3,V=!0,W=window,q=function(){function e(e){var t=this;this.conversation=e,this._encoder=new a.default(null,null),this._handleMessageResource=function(e,n){if(t._messageTypesHandler.isTypingIndicator(n)&&n.from){var r=M.default.normalizePersonId(N.default.getSenderIdFromUrl(n.from));e.setParticipantTyping(r,"Control/Typing"===n.messagetype)}else{var o=n.contentOriginal&&0===n.contentOriginal.trim().length;if(n.content&&0!==n.content.trim().length||!o||n.skypeeditedid){t._setHistoryParamToCache(e.id);var a=t.processNewMessage(e,n,null,!1);if(a&&a.direction===L.Direction.Incoming){var c=N.default.getSenderIdFromUrl(n.from);(r=M.default.normalizePersonId(c))&&e.setParticipantTyping(r,!1);var l=new E.default(t.conversation);l.messageType=a.type,s.default.instance.TelemetryService.sendEvent(l),e.messagesReceived++,t._updateUnreadMessageCounter(e,a),e.messageReceived(i.default.getReceivedMessageType(a.type),a.type)}}}},this._updateUnreadMessageCounter=function(e,n){if(e.isControlOpen)t.updateConsumptionHorizonToLastMessage(),e.unreadMessagesCount=0;else if(n.isDeleted){var i=n.originalTimestamp.getTime();!(e.consumptionHorizon.lastReadMessageTimestamp>=i)&&e.unreadMessagesCount>0&&e.unreadMessagesCount--}else n.isEdited||e.unreadMessagesCount++},this._isFetched=!1,this._isTeamsBackend=o.default.get.backend===m.MessagingBackend.TEAMS,this._isUseEditMessageClassic=function(){return V&&o.default.get.backend!==m.MessagingBackend.TEAMS},this._messageToBotWasSent=!1,this._pendingContactRequest=!1,this._quarantineCountDown=-1,this.checkConversationStatus=function(e){return t.isConversationNotFoundError(e)?Promise.resolve():s.default.instance.WebApi.fetchConversation(t.conversation.id).then(function(e){if(!t.isConversationNotFoundError(e)){if(t.isConversationBlocked(e))return t.conversation.isBlocked=!0,void(t.conversation.isChatEnabled=!1);switch(e.properties.conversationstatus){case"Accepted":return t.conversation.isUnderQuarantine=!1,t.conversation.isChatEnabled=!0,void(t._quarantineCountDown=-1);case"AcceptPendingSender":break;case"AcceptPendingRecipient":return t._pendingContactRequest=!0,t.conversation.isUnderQuarantine=!1,void(t.conversation.isChatEnabled=!0);default:return}t.checkIfBuddy()}},function(e){t.isConversationNotFoundError(e)||O.default.throwError(h.ErrorCodes.ERR_CHECK_CONVERSATION_STATUS,"Unable to check Conversation Status",e)})},this.checkIfBuddy=function(){t._checkContactTimeout||(t._checkContactTimeout=D.build(t.checkConversationStatus.bind(t),j)),t._checkContactTimeout.start()},this.fetchUserMessages=function(e){return new Promise(function(n,i){s.default.instance.WebApi.fetchMessages(t.conversation.id).then(function(i){t._messagesHandler(t.conversation,e,i),t._isFetched=!0,n(i)},function(e){t.onConversationLoadingFinished(),i(e)})})},this.isConversationBlocked=function(e){return!!e.properties.conversationblocked&&"true"===e.properties.conversationblocked.toLocaleLowerCase()},this.isConversationNotFoundError=function(e){return!(!e||e.errorCode!==G)&&(t.conversation.isChatEnabled=!0,t._quarantineCountDown=0,!0)},this.isOneToOneOrBot=function(){return t.conversation.isPerson()||t.conversation.isAgent()},this.startConversationWithBot=function(e){void 0===e&&(e=!0);var n=t.conversation.id,i=t.conversation.id.slice(3),r=t;if(0===t.conversation.participants.length){var o=new U.default(s.default.instance.Persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(o)}return t.executeWhenSignedIn(function(){s.default.instance.ContactsManager.isPersonContact(n).then(function(n){n?(r.subscribeToConversation(),t.conversation.isChatEnabled=!0,s.default.instance.SignInManager.userIdentityType===f.IdentityType.GUEST&&(t.conversation.isNew=!0,t.conversation.startGuestConversation()),t.conversation.definition.Payload&&t.conversation.sendDataToBot({payload:t.conversation.definition.Payload})):(t.conversation.isChatEnabled=!1,t.conversation.isNew=!0,e&&s.default.instance.AgentsManager.addAgent(i),t._checkContactTimeout=D.build(function(){r.startConversationWithBot(!1)},B),t._checkContactTimeout.start())},function(e){O.default.throwError(h.ErrorCodes.ERR_START_CONVERSATION_WITH_BOT,"Unable to start conversation with bot",e,n)})})},this.startConversationWithPerson=function(){t.conversation.id.slice(2);if(0===t.conversation.participants.length){var e=new U.default(s.default.instance.Persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(e)}return t.executeWhenSignedIn(function(){return s.default.instance.ContactsManager.isPersonContact(t.conversation.id).then(function(e){return e?(t.conversation.isNew=!1,s.default.instance.WebApi.subscribeContactPresence(t.conversation.id),t.subscribeToConversation()):(t.conversation.isNew=!0,t.subscribeToConversation().then(t.checkConversationStatus.bind(t)))})})},this.startGroupConversation=function(){var e=function(){return s.default.instance.WebApi.fetchThread(t.conversation.id).then(function(e){if(e.properties){var n=e.properties;e.members&&(n.members=e.members),t.updateConversationProperties(n);var i=n.joiningenabled,o=n.capabilities,a=!o||0===o.length;if(t._isTeamsBackend){var c=n.fixedRoster&&n.uniquerosterthread;t.conversation.isOneOnOne=c}else t.conversation.isOneOnOne=-1===e.id.indexOf("19:");var l=t.isMember(s.default.instance.SignInManager.currentUserName,e);!a||i||t._isTeamsBackend&&l?t.subscribeToConversation():O.default.throwError(h.ErrorCodes.INFO_JOIN_GROUP_DISABLED,"Joining to a group conversation is disabled",{},t.conversation.id);var u=t.conversation.participants,d=!u.length;e.members.forEach(function(e){var t=s.default.instance.Persons.getPerson(e.id,!0);if(d||!u.some(function(e){return e.person.id===t.id})){var n=new U.default(t,e);u.pushObservable(n),t.isAgent&&I.swc.API.triggerEvent(r.ApiEvents.BotAddedToThread,t.id)}}),s.default.instance.MePersonManager.fetch().then(function(e){u.forEach(function(n){e.id===n.person.id&&(t.conversation.selfParticipant=n)})})}else t.subscribeToConversation();return t.conversation.members=e.members,e},function(e){O.default.throwError(h.ErrorCodes.ERR_FETCH_THREAD,"Unable to fetch a thread",e,t.conversation.id)})};return t.executeWhenSignedIn(function(){e().then(function(n){var i,r="8:"+s.default.instance.SignInManager.currentUserName;t.isMember(s.default.instance.SignInManager.currentUserName,n)||(i=r,s.default.instance.WebApi.addParticipant(t.conversation.id,i).then(null,function(e){O.default.throwError(h.ErrorCodes.ERR_JOIN_CONVERSATION,"Unable to join conversation",e,t.conversation.id)})).then(e.bind(t))})})},this.subscribeToConversation=function(){var e=t,n=t.currentUserHasHistory(e.conversation.id),i=s.default.instance.SignInManager.userIdentityType===f.IdentityType.SKYPE||n;I.swc.API.triggerEvent(r.ApiEvents.OnConversationReady,{id:t.conversation.id});var o=new S.ConversationLoadEvent(t.conversation);return s.default.instance.TelemetryService.sendEvent(o),s.default.instance.WebApi.subscribeConversation(t.conversation.id,t._eventHandler.bind(t,t.conversation),function(){return t._backfilllingHandler(!0)},i).then(function(i){if(t.isConversationNotFoundError(i))return i;i&&i.properties&&i.properties.consumptionhorizon&&t.conversation.updateConsumptionHorizon(i.properties.consumptionhorizon),i&&i.threadProperties&&t.updateConversationProperties(i.threadProperties,!0);var r=t.isConversationBlocked(i);if(t.conversation.isBlocked=r,t.conversation.isChatEnabled=!r,s.default.instance.SignInManager.userIdentityType!==f.IdentityType.SKYPE)return n?t.fetchUserMessages(Date.now()):(e.onConversationLoadingFinished(),i);t.fetchUserMessages(Date.now())},function(n){t._messageToBotWasSent?t.fetchUserMessages(Date.now()):e.onConversationLoadingFinished()})},this.sendFile=function(e){return t.sendMessageToService(t.createMessageData({content:e,messagetype:v.MessagePayloadType.RichTextMedia_GenericFile}),t.getMessageEvent(g.MessageType.FILE))},this.sendFileAsProperty=function(e){return t.sendMessageToService(t.createMessageData({content:"",messagetype:v.MessagePayloadType.RichTextHtml,properties:JSON.stringify(e)}),t.getMessageEvent(g.MessageType.TEXT))},this.sendImage=function(e){return t.sendMessageToService(t.createMessageData({content:e,messagetype:v.MessagePayloadType.RichTextUriObject}),t.getMessageEvent(g.MessageType.IMAGE))},this.sendSwift=function(e){return t.sendMessageToService(t.createMessageData({content:e.title,properties:e.value||e,messagetype:v.MessagePayloadType.RichText,processedcontent:e.title}),t.getMessageEvent(g.MessageType.SWIFT))},this.sendLiveState=function(){return t.sendMessageToService(t.createMessageData({content:"",messagetype:v.MessagePayloadType.ControlLiveState}))},this.setIsTyping=function(e){return t.sendMessageToService(t.createMessageData({content:"",messagetype:e?v.MessagePayloadType.ControlTyping:v.MessagePayloadType.ControlClearTyping}))},e||O.default.throwError(h.ErrorCodes.ERR_CONVERSATION_MISSING,"conversation is missing"),this._messageTypesHandler=new c.default,this._firstMessagePopulationPromise=new l.CancelablePromise,s.default.instance.MePersonManager.fetch(),this._backfilllingHandler=this.backFillLostMessges.bind(this),w.get().subscribe("isOnline",this._backfilllingHandler)}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return s.default.instance.MePersonManager.mePerson},enumerable:!0,configurable:!0}),e.prototype.isMember=function(e,t){var n="8:"+e;return t&&t.members&&t.members.some(function(e){return e.id===n})},e.prototype.addBotToThread=function(e){s.default.instance.WebApi.addParticipant(this.conversation.id,"28:"+e).then(function(e){},function(t){O.default.throwError(h.ErrorCodes.ERR_ADD_BOT_TO_CONVERSATION,"Unable to add bot to conversation",t,e)})},e.prototype.addParticipantToThread=function(e){s.default.instance.WebApi.addParticipant(this.conversation.id,e).then(function(e){},function(t){O.default.throwError(h.ErrorCodes.ERR_ADD_PERSON_TO_CONVERESATION,"Unable to add participant to conversation",t,e)})},e.prototype.createConversation=function(e){e&&s.default.instance.WebApi.createThread([])},e.prototype.deleteConversation=function(e){return s.default.instance.WebApi.deleteConversation(e)},e.prototype.deleteMessage=function(e){return this._isUseEditMessageClassic()?this.editMessageClassicWay(e):s.default.instance.WebApi.deleteMessage(this.conversation.id,e.id)},e.prototype.dispose=function(){this._messageToBotWasSent=!1,this.stopListeningConversation(),this._checkContactTimeout&&(this._checkContactTimeout.reset(),this._checkContactTimeout=null),this._firstMessagePopulationPromise.status===l.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.promise.then(null,function(){}),this._firstMessagePopulationPromise.cancel()),this._firstMessagePopulationPromise=new l.CancelablePromise,w.get().unsubscribe("isOnline",this._backfilllingHandler)},e.prototype.mask=function(e,t){var n=P.Masks.instance;return n&&n.shouldMask(e)&&(e=n.process(e),t&&(t.tags=t.tags||"",t.tags=b.default.add(t.tags||"","masked",!0))),e},e.prototype.editMessage=function(e,t){t=this.mask(t);var n=this._encoder.encode(t,this.conversation,this.mePerson);return _.default.parse(n),this._isUseEditMessageClassic()?this.editMessageClassicWay(e,n):s.default.instance.WebApi.editMessage(this.conversation.id,e.id,e.rawMessageType,n)},e.prototype.getUnreadMessagesCount=function(){return this.conversation.unreadMessagesCount},e.prototype.loadMoreMessages=function(e){return this._backwardLink?s.default.instance.WebApi.fetchMessagesByLink(this._backwardLink).then(this._messagesHandler.bind(this,e,Date.now())):Promise.resolve()},e.prototype.markAsRead=function(){(s.default.instance.SignInManager.userIdentityType===f.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage()},e.prototype.removeMessageProperty=function(e,t,n,i){return s.default.instance.WebApi.removeMessageProperty(e,t,n,i)},e.prototype.removeParticipantFromThread=function(e){return s.default.instance.WebApi.removeParticipant(this.conversation.id,e).then(function(e){},function(t){O.default.throwError(h.ErrorCodes.ERR_REMOVE_PERSON_FROM_CONVERSATION,"Unable to remove participant from conversation",t,e)})},e.prototype.sendDataToBot=function(e,t){var n={name:"SWC",conversation:{id:this.conversation.isGroup()?this.conversation.id:s.default.instance.SignInManager.currentUserName},value:t};return this._messageToBotWasSent=!0,s.default.instance.WebApi.sendDataToBot(e,n)},e.prototype.sendMessage=function(e,t,n){var i=this.getMessageEvent(g.MessageType.TEXT);i.messageLength=e.length,i.origin=t,n=n||{},e=this.mask(e,n);var r=this._encoder.encode(e,this.conversation,this.mePerson),o=_.default.parse(r),a=this.createMessageData({content:o,messagetype:v.MessagePayloadType.RichText,"Has-Mentions":this.messageContainsMention(r)});return Object.keys(n).length&&(a.properties=n),this.sendMessageToService(a,i)},e.prototype.setConversationTopic=function(e){s.default.instance.WebApi.setConversationTopic(this.conversation.id,e)},e.prototype.setMessageProperty=function(e,t,n,i){return s.default.instance.WebApi.setMessageProperty(e,t,n,i)},e.prototype.startConversation=function(){return this.isOneToOneOrBot()?this.conversation.isPerson()?this.startConversationWithPerson():this.startConversationWithBot():this.startGroupConversation()},e.prototype.startGuestConversation=function(){var e={name:"startConversation",conversation:{id:R.default.toFullIdentifier(s.default.instance.SignInManager.currentUserName)},value:{}};return s.default.instance.WebApi.sendDataToBot(this.conversation.id,e)},e.prototype.stopListeningConversation=function(){s.default.instance.WebApi.unsubscribeConversation(this.conversation.id)},e.prototype._eventHandler=function(e,t,n){switch(t){case"NewMessage":case"MessageUpdate":this._handleMessageResource(e,n);break;case"ConversationUpdate":this._isFetched||this.fetchUserMessages(Date.now()),e.update(n)}},e.prototype._messagesHandler=function(e,t,n){var i=this;if(e.messages)if(n){Date.now();this._backwardLink=n._metadata.backwardLink;var r=new u.ObservableCollection;n.messages.forEach(function(t){i.processNewMessage(e,t,r,!0)}),r.sortObservable(function(e,t){return e.timestamp.getTime()>t.timestamp.getTime()?1:-1});var o,a=new C.MessagesFetchEvent(this.conversation);a.messageCount=n.messages.length,a.status=200,a.timeToFetch=Date.now()-t,s.default.instance.TelemetryService.sendEvent(a),(o=e.messages).pushObservable.apply(o,r),this.onConversationLoadingFinished()}else this.onConversationLoadingFinished();else this.onConversationLoadingFinished()},e.prototype._setHistoryParamToCache=function(e){if(s.default.instance.SignInManager.userIdentityType!==f.IdentityType.SKYPE&&!this.currentUserHasHistory(e)){var t=s.default.instance.Storage.getItem("skype|hasHistory")||"";t=""===t?e:t+";"+e,s.default.instance.Storage.setItem("skype|hasHistory",t)}},e.prototype._triggerCustomAction=function(e){var t=e.content;if(t){var n=/<swc-event>(?:<name>([\s\S]*)<\/name>)[\s]?(?:<action>([\s\S]*)<\/action>)[\s]?(?:<data>([\s\S]*)<\/data>)<\/swc-event>/i,i=t.match(n);if(i&&!(i.length<3)){var r=i[1],o=i[2],a=i[3];o&&o.toLowerCase()===p.default.DELIVERED.toLowerCase()&&(r&&W.swc.API.triggerEvent(r,a),e.content=t.replace(n,""))}}},e.prototype.backFillLostMessges=function(e){var t=this;if(!this._backfilllingPromise||this._backfilllingPromise.status!==l.PromiseStatus.Pending){var n=this;this._backfilllingPromise=new l.CancelablePromise(s.default.instance.WebApi.fetchMessages(this.conversation.id)),this._backfilllingPromise.promise.then(function(e){e.messages&&e.messages.sort(function(e,t){var n=new Date(e.originalarrivaltime),i=new Date(t.originalarrivaltime);return n>i?1:n<i?-1:0}),n._messagesHandler(t.conversation,Date.now(),e)},function(e){})}},e.prototype.currentUserHasHistory=function(e){return(s.default.instance.Storage.getItem("skype|hasHistory")||"").indexOf(e)>=0||this.conversation.isGroup()},e.prototype.editMessageClassicWay=function(e,t){void 0===t&&(t="");var n={messagetype:e.rawMessageType,content:t,skypeeditedid:e.clientMessageId?e.clientMessageId:e.key};return s.default.instance.WebApi.sendMessage(this.conversation.id,n)},e.prototype.executeWhenSignedIn=function(e){return s.default.instance.SignInManager.getSkypeToken().then(function(t){return e()})},e.prototype.filterMessagesByKey=function(e,t){return e.filter(function(e){return e.key===t})[0]},e.prototype.getExistingMessage=function(e,t,n){var i=n!==t,r=this.filterMessagesByKey(n,e.key);return r||(i&&(r=this.filterMessagesByKey(t,e.key)),r)},e.prototype.mapSuggestedActionsArray=function(e,t,n){e.forEach(function(e){t.suggestedActions.pushObservable(n(e))})},e.prototype.messageContainsMention=function(e){return/<at id="(.*?)">.*?<\/at>/g.test(e).toString().toLowerCase()},e.prototype.onConversationLoadingFinished=function(){this._firstMessagePopulationPromise.status===l.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.resolve(),(s.default.instance.SignInManager.userIdentityType===f.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage()),S.ConversationLoadEvent.isAvailable&&(S.ConversationLoadEvent.isAvailable=!1)},e.prototype.processNewMessage=function(e,t,n,i){function r(t){return t.title&&(t.title=this._encoder.decode(this._encoder.encode(t.title))),new A.default(t,e,o.senderId)}this._triggerCustomAction(t),n=n||e.messages;var o=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:i});if("Control/LiveState"===t.messagetype)return null;if(!o)return null;k.default.parseMessageProperties(o,t),o.status=L.DeliveryStatus.Sent,t.suggestedActions&&t.suggestedActions.actions&&this.mapSuggestedActionsArray(t.suggestedActions.actions,o,r.bind(this)),t.properties&&t.properties.suggestedActions&&t.properties.suggestedActions.actions&&this.mapSuggestedActionsArray(t.properties.suggestedActions.actions,o,r.bind(this));var a,s,c=this.getExistingMessage(o,n,e.messages);if((a=o)&&"SystemMessage"===a.type)return c?(o.isEdited=!0,this._messageTypesHandler.updateExistingMessage(c,o,i),o):(n.pushObservable(o),o);if(!this._isTeamsBackend&&!c&&o.skypeEditedId)return(s=this.filterMessagesByKey(e.allMessages,o.key))?this._messageTypesHandler.updateExistingMessage(s,o,i):e.allMessages.pushObservable(o),o;if(!c&&!o.skypeEditedId&&(s=this.filterMessagesByKey(e.allMessages,o.key)))return this._messageTypesHandler.updateExistingMessage(s,o,i),n.pushObservable(s),s;if(x.test(o.content)&&(o.content=o.content.replace(x,"$1"+y.default.dompurify.sanitize('<a class="replacedImg" href="$2" target="_blank"><img src="$2" alt=""></a>',F)+"$3")),H.test(o.content)){var l=o.content.match(H);l&&!l[2]&&(o.content=o.content.replace(l[0],y.default.dompurify.sanitize(l[0],F)))}return c?this._messageTypesHandler.updateExistingMessage(c,o,i):n.pushObservable(o),o},e.prototype.getMessageEvent=function(e){var t=new T.MessageSentEvent(this.conversation);return t.messageType=e,t},e.prototype.createMessageData=function(e){var t={contenttype:"text",composetime:(new Date).toISOString(),clientmessageid:Date.now().toString()};return Object.assign(t,e||{})},e.prototype.sendMessageToService=function(e,t){var n=this,i=-1!==e.messagetype.indexOf("Control");this._quarantineCountDown>=0&&!i&&(this._quarantineCountDown++,this.conversation.isChatEnabled=this.conversation.isChatEnabled&&this._quarantineCountDown<10,this.checkIfBuddy()),this._pendingContactRequest&&!i&&(this._pendingContactRequest=!1,s.default.instance.WebApi.acceptConversation(this.conversation.id));var r,o=this.mePerson;o&&o.displayName&&(e.imdisplayname=o.displayName),t&&t.messageType===g.MessageType.SWIFT||(r=this._messageTypesHandler.generateOutgoing(e));var a=Date.now(),c=this.conversation.isAgent()&&"RichText"===e.messagetype&&w.get().isOnline;r&&this.conversation.messages.pushObservable(r),c&&this.conversation.participants.length&&(this.conversation.participants[0].isTyping=!0);return this.conversation.contextAad&&(e.content+='<context reason="customAad">'+this.conversation.contextAad+"</context>"),s.default.instance.WebApi.sendMessage(this.conversation.id,e).then(function(e){r&&(r.status=L.DeliveryStatus.Sent),t&&(t.origin!==d.ActionTrigger.TYPING&&(n.conversation.messagesSent++,n.updateConsumptionHorizonToLastMessage()),t.index++,t.timeToSend=Date.now()-a,t.status=200,s.default.instance.TelemetryService.sendEvent(t))},function(e){r&&(r.status=L.DeliveryStatus.Failed),t&&(t.status=e.status,t.errorCode=e.errorCode,t.errorMessage=e.message,t.timeToSend=Date.now()-a,s.default.instance.TelemetryService.sendEvent(t)),804===e.errorCode&&(n.conversation.isChatEnabled=!1,n.conversation.isUnderQuarantine=!0,n.checkIfBuddy()),c&&n.conversation.participants.length&&(n.conversation.participants[0].isTyping=!1)})},e.prototype.updateConsumptionHorizonToLastMessage=function(){if(0!==this.conversation.messages.length&&this.conversation.isActive&&s.default.instance.isFocused){var e=this.conversation.messages[this.conversation.messages.length-1],t=e.timestamp.getTime()+";"+(new Date).getTime()+";"+e.key;this.conversation.consumptionHorizon.lastReadMessageTimestamp>=e.timestamp.getTime()||s.default.instance.WebApi.updateConsumptionHorizon(this.conversation.id,t).then(this.conversation.updateConsumptionHorizon.bind(this.conversation,t))}},e.prototype.updateConversationProperties=function(e,t){var n=this;if(void 0===t&&(t=!1),e){if(e.topic){if(!this.conversation.topic&&t){var i=this.mePerson;i&&e.topic.indexOf(i.id)>-1&&(e.topic=e.topic.replace(i.mri+", ",""),e.topic=e.topic.replace(", "+i.mri,""),e.topic=e.topic.replace(i.id+", ",""),e.topic=e.topic.replace(", "+i.id,"")),this.conversation.participants.forEach(function(t){var n=t.person.displayName;n&&(e.topic=e.topic.replace(t.person.mri,n),e.topic=e.topic.replace(t.person.id,n))})}this.conversation.topic=N.default.parseTopic(e.topic)}if(e.picture&&(this.conversation.avatar=e.picture.replace("URL@","")),this._isTeamsBackend&&e.members){var r=[];if(e.members.forEach(function(e){if(!s.default.instance.MePersonManager.isMe(e.id)){var t=s.default.instance.Persons.getPerson(e.id);t.displayName&&r.push({userId:e.id,displayName:t.displayName})}}),0===r.length)return;s.default.instance.SignInManager.isAadSupported()&&s.default.instance.AvatarService.fetchMergedAvatars(r).then(function(e){e&&(n.conversation.avatar=e)})}}},e}();t.default=q},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.DELIVERED="delivered",e.CLICK="click",e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=function(e){function t(t){return e.call(this,"kpi_messages_fetch",t)||this}return r(t,e),t.prototype.getCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);return t.push(o.TelemetryPropertyValue.Create("timeToFetch",this.timeToFetch)),t.push(o.TelemetryPropertyValue.Create("status",this.status)),t.push(o.TelemetryPropertyValue.Create("messageCount",this.messageCount)),t.push(o.TelemetryPropertyValue.Create("numberOfRetries",this.getProperty(this.numberOfRetries))),t},t}(n(36).ConversationDataEvent);t.MessagesFetchEvent=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(43),r=n(113),o=n(145),a=n(3),s=function(){function e(){var e=this;this.persons={},this.subscribedPresenceStatus={},this.subscribeToUserStatus=function(t,n){if(!t||!n)return Promise.resolve(!1);if(e.subscribedPresenceStatus[t])return Promise.resolve(!0);var i=function(){return delete e.subscribedPresenceStatus[t],Promise.resolve(!1)},o=n.bind(null,t);return e.subscribedPresenceStatus[t]=o,a.default.initPromise.then(function(){return a.default.signInManager.onceSignedIn().then(function(){var n=a.default.signInManager.currentUserName,s=e.getMri(t);return a.default.contactsService.getContact(n,s).then(function(t){if(!t)return!1;var n=e.getPerson(s);return n.subscribe("presenceStatus",o),a.default.webApi.subscribeContactPresence(s),n.presenceStatus&&n.presenceStatus!==r.PresenceStatus.Undefined&&o(n.presenceStatus),!0},i)},i)},i)}}return e.prototype.getPerson=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=this.persons[e];if(!r){var s=i.default.normalizePersonId(e);r=this.persons[s]}var c=a.default.mePerson,l=c&&(e===c.mri||e===c.id||e.indexOf(c.msaId)>-1);return!r&&c&&l&&(r=this.persons[c.mri],e=c.mri,l=!0,r||(r=c)),r||(r=this.persons[e]=new o.default(e,n,t)),r.isFilled||!t||l||r.fetchDisplayNameAndAvatar(),r},e.prototype.dispose=function(){var e=this;Object.getOwnPropertyNames(this.persons).forEach(function(t){e.persons[t].dispose()}),this.persons={},this.subscribedPresenceStatus={}},e.prototype.createEmptyPerson=function(e){var t=new o.default(e,!1,!1);return this.persons[t.id]=t,t},e.prototype.handlePresenceData=function(e,t){var n=this.getPerson(e),i=t.status;n.presenceStatus=i},e.prototype.unsubscribeFromUserStatus=function(e){if(!e||!this.subscribedPresenceStatus[e])return!1;var t=this.getMri(e);return this.getPerson(t).unsubscribe("presenceStatus",this.subscribedPresenceStatus[e]),delete this.subscribedPresenceStatus[e],!0},e.prototype.getUserStatus=function(e){var t=this;if(!e)return Promise.resolve(null);var n=function(){return Promise.resolve(null)};return a.default.initPromise.then(function(){return a.default.signInManager.onceSignedIn().then(function(){var i=a.default.signInManager.currentUserName,o=t.getMri(e);return a.default.contactsService.getContact(i,o).then(function(e){if(!e)return null;var n=t.getPerson(o);return n.presenceStatus&&n.presenceStatus!==r.PresenceStatus.Undefined?n.presenceStatus:a.default.webApi.getUsersPresence([o]).then(function(e){var t=e[0];return t.Payload&&t.Payload.status})},n)},n)},n)},e.prototype.subscribeToMyStatus=function(e){var t=this;return a.default.initPromise.then(function(){return a.default.signInManager.onceSignedIn().then(function(){var n=a.default.mePerson;return n.subscribe("presenceStatus",e),a.default.webApi.subscribeContactPresence(n.mri),t.subscribedPresenceStatus[n.id]=e,!0},function(e){return Promise.resolve(!1)})},function(e){return Promise.resolve(!1)})},e.prototype.getMyStatus=function(){return a.default.mePerson.presenceStatus},e.prototype.setMyStatus=function(e){return a.default.webApi.setMyPresence(e).then(function(e){return e.ok?Promise.resolve(!0):Promise.resolve(!1)},function(e){return Promise.resolve(!1)})},e.prototype.getMri=function(e){return-1===e.indexOf("8:")?"8:"+e:e},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(133),r=n(8),o=n(30),a=n(5),s=n(103),c=n(3),l=function(){function e(){this._ariaTelemetryService=new i.AriaTelemetryService,this._commonProperties=[],this.flushAll=s.default().flushAll.bind(s.default())}return e.prototype.sendEvent=function(e){this.addCommonProperties(e),this._ariaTelemetryService.sendEvent(e)},e.prototype.setCommonProperty=function(e,t,n){this._commonProperties.push(a.TelemetryPropertyValue.Create(e,t,n?o.PIIType.Identity:o.PIIType.NotSet))},e.prototype.addCommonProperties=function(e){e.identityType=a.TelemetryPropertyValue.Create("identitytype",this.getIdentityType()),this._commonProperties.forEach(function(t){e[t.key]=t})},e.prototype.getIdentityType=function(){if(!c.default.signInManager)return r.NA;var t=c.default.signInManager.userIdentityType.valueOf();return e.identityType[t]||"Unknown"},e.identityType={0:"UNDEFINED",10:r.NA,100:"Guest",200:"Skype",300:"Guest"},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(21),r=n(20),o=function(e){if(e.indexOf("_")>-1){var t=e.split("_");return t[t.length-1]}return e.replace("8:orgid:","")},a=function(e){try{var t=[o(i.getServices().mePerson.mri),o(e)].sort().join("_");return Promise.resolve("19:"+t+"@unq.gbl.spaces")}catch(e){}return Promise.resolve(void 0)};t.generateOneToOneConversationId=function(e){try{if(r.guid.isGuid(e))return function(e){try{var t=i.getServices().contactsService;if(t.getContactByObjectId)return t.getContactByObjectId(e).then(function(e){return a(e.mri)})}catch(e){}return Promise.resolve(void 0)}(e);if(t.isEnterpriseUserMri(e))return a(e)}catch(e){}return Promise.resolve(void 0)},t.isEnterpriseUserMri=function(e){return/^8:orgid:[^@]+$/.test(e)}},function(e,t,n){"use strict";
/*!
 *  index.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(131)),i(n(242)),i(n(383)),i(n(342)),i(n(387))},function(e,t,n){"use strict";
/*!
 *  Appenders.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(131),s=n(242),c=function(){function e(e){this._formatter=e||new d}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();function l(e){return(4294967296+e).toString(16).substr(-8)}function u(e,t){return(1e12+e).toString(10).substr(-t)}t.AbstractLogAppender=c,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(o=t.SLF_Flags||(t.SLF_Flags={}));var d=function(){function e(e){void 0===e&&(e=4294967295),this._flags=e}return e.prototype.format=function(e,t,n,i){var r="";if(this._flags&o.FullDate)r+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&o.Timestamp){var c=new Date(e.timestamp);r+=u(c.getHours(),2)+":"+u(c.getMinutes(),2)+":"+u(c.getSeconds(),2)+"."+u(c.getMilliseconds(),2)+" "}return this._flags&o.LogId&&(r+="[#"+l(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&o.Level&&(r+="["+s.LogFactory.levelToString(e.level)+"] "),this._flags&o.Component&&(r+="["+e.component.name()+"] "),n||""===n?r+a.vsprintf(n,i):r+l(t)+": "+i.join(" ")},e}();t.StandardLogFormatter=d;var p=console,h=console.log||function(){},f=console.info||h,g=console.warn||f,m=console.error||g,_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.log=function(e,t,n,i){i=i.slice(0);var r=e.level<=a.LogLevel.Debug3?h:e.level<=a.LogLevel.Debug1?f:e.level<=a.LogLevel.Warning?g:m;if(-1===t){var o=this.formatter().format(e,t,"",[]);"string"==typeof i[0]&&(o+=i.shift()),r.apply(p,[o].concat(i))}else{for(var s=void 0,c=[];s=n.match(/\s*%@\s*$/);)n=n.substr(0,n.length-s[0].length),c.unshift(i.pop());o=this.formatter().format(e,t,n,i);r.apply(p,[o].concat(c))}},t}(c);t.ConsoleAppender=_;var v=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,n,i){this._chained.log(e,t,n,i)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=v;var y=function(e){function t(t,n){var i=e.call(this,t)||this;return i._levels=n,i}return r(t,e),t.prototype.levels=function(){return this._levels},t}(v);t.wrapAppenderWithLogLevels=function(e,t){return new y(e,t)}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(67),c=function(e){function t(t){var n=e.call(this,t)||this;return n._onClick=function(e){e.stopPropagation(),n.props.onClick&&n.props.onClick()},n.state={topic:"",avatarUrl:""},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.call;t&&t.getThreadInfo().then(function(t){e.setState({topic:t.displayName,avatarUrl:t.avatar})})},t.prototype.render=function(){return a.createElement("div",{className:"avatar avatarContainer",onClick:this._onClick},a.createElement(s.BasicAvatar,{title:this.state.topic,avatarUrl:this.state.avatarUrl,onClick:this.props.onClick}))},t}(o.Component);t.CallAvatar=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onClick=function(e){e.stopPropagation(),t.props.onClick(e)},t}return r(t,e),t.prototype.render=function(){return a.createElement("button",{id:this.props.id,title:this.props.title,className:this.props.className,onClick:this._onClick,dangerouslySetInnerHTML:{__html:this.props.content}})},t}(o.Component);t.CallingButton=s},function(e,t,n){var i=n(84),r=n(85),o=n(63).Buffer,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function c(){this.init(),this._w=s,r.call(this,64,56)}function l(e,t,n){return n^e&(t^n)}function u(e,t,n){return e&t|n&(e|t)}function d(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function p(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function h(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}i(c,r),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,o=0|this._c,s=0|this._d,c=0|this._e,f=0|this._f,g=0|this._g,m=0|this._h,_=0;_<16;++_)n[_]=e.readInt32BE(4*_);for(;_<64;++_)n[_]=0|(((t=n[_-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+n[_-7]+h(n[_-15])+n[_-16];for(var v=0;v<64;++v){var y=m+p(c)+l(c,f,g)+a[v]+n[v]|0,S=d(i)+u(i,r,o)|0;m=g,g=f,f=c,c=s+y|0,s=o,o=r,r=i,i=y+S|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=c+this._e|0,this._f=f+this._f|0,this._g=g+this._g|0,this._h=m+this._h|0},c.prototype._hash=function(){var e=o.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c},function(e,t,n){var i=n(84),r=n(85),o=n(63).Buffer,a=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function c(){this.init(),this._w=s,r.call(this,128,112)}function l(e,t,n){return n^e&(t^n)}function u(e,t,n){return e&t|n&(e|t)}function d(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function p(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function h(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function g(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function _(e,t){return e>>>0<t>>>0?1:0}i(c,r),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._ah,i=0|this._bh,r=0|this._ch,o=0|this._dh,s=0|this._eh,c=0|this._fh,v=0|this._gh,y=0|this._hh,S=0|this._al,E=0|this._bl,T=0|this._cl,C=0|this._dl,I=0|this._el,A=0|this._fl,b=0|this._gl,O=0|this._hl,R=0;R<32;R+=2)t[R]=e.readInt32BE(4*R),t[R+1]=e.readInt32BE(4*R+4);for(;R<160;R+=2){var P=t[R-30],N=t[R-30+1],w=h(P,N),M=f(N,P),k=g(P=t[R-4],N=t[R-4+1]),D=m(N,P),L=t[R-14],U=t[R-14+1],x=t[R-32],F=t[R-32+1],H=M+U|0,G=w+L+_(H,M)|0;G=(G=G+k+_(H=H+D|0,D)|0)+x+_(H=H+F|0,F)|0,t[R]=G,t[R+1]=H}for(var j=0;j<160;j+=2){G=t[j],H=t[j+1];var B=u(n,i,r),V=u(S,E,T),W=d(n,S),q=d(S,n),z=p(s,I),K=p(I,s),Y=a[j],J=a[j+1],X=l(s,c,v),Q=l(I,A,b),$=O+K|0,Z=y+z+_($,O)|0;Z=(Z=(Z=Z+X+_($=$+Q|0,Q)|0)+Y+_($=$+J|0,J)|0)+G+_($=$+H|0,H)|0;var ee=q+V|0,te=W+B+_(ee,q)|0;y=v,O=b,v=c,b=A,c=s,A=I,s=o+Z+_(I=C+$|0,C)|0,o=r,C=T,r=i,T=E,i=n,E=S,n=Z+te+_(S=$+ee|0,$)|0}this._al=this._al+S|0,this._bl=this._bl+E|0,this._cl=this._cl+T|0,this._dl=this._dl+C|0,this._el=this._el+I|0,this._fl=this._fl+A|0,this._gl=this._gl+b|0,this._hl=this._hl+O|0,this._ah=this._ah+n+_(this._al,S)|0,this._bh=this._bh+i+_(this._bl,E)|0,this._ch=this._ch+r+_(this._cl,T)|0,this._dh=this._dh+o+_(this._dl,C)|0,this._eh=this._eh+s+_(this._el,I)|0,this._fh=this._fh+c+_(this._fl,A)|0,this._gh=this._gh+v+_(this._gl,b)|0,this._hh=this._hh+y+_(this._hl,O)|0},c.prototype._hash=function(){var e=o.allocUnsafe(64);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(18),s=n(0),c=n(427),l=n(348),u=function(e){function t(t){var n=e.call(this)||this;return n.MAX_STAGE_CAPACITY=4,n.MIN_STAGE_CAPACITY=1,n._subs=[],n._isIncomingVideoEnabled=!0,n._isBlockedPromise=Promise.resolve(!1),n._call=t,n._callStage=new c.CallStage(n._call,function(e){return n.publish("stage",e)}),n.toggleRoster(!1),n.setThreadId(t.threadId),n._subs.push(n._call.changed(function(){n._callStage.updateParticipants(n._call.participants),n.publish("isIncomingVideoAvailable",n.isIncomingVideoAvailable),n.publish("isVideoOn",n.isVideoOn),n.setThreadId(n._call.threadId)}),n._call.on("callStateChanged",function(){n._isBlockedPromise=new Promise(function(e){l.ConversationUtils.resolveBlockedState(n.mri,n.isGroup).then(function(t){e(t),t||n.publish("state",n._call.state)})})})),n}return r(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._call.state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._threadId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"callerMri",{get:function(){return this._call.callerMri},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mri",{get:function(){return this.isGroup?this.threadId:this.callerMri||this.threadId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGroup",{get:function(){return this.threadId&&l.ConversationUtils.isGroup(this.threadId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPstn",{get:function(){return l.ConversationUtils.isPstn(this.mri)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"callId",{get:function(){return this._call.callId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isScreenSharingOn",{get:function(){return this._call.isScreenSharingOn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVideoOn",{get:function(){return this._call.isVideoOn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMuted",{get:function(){return this._call.isMuted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isIncomingVideoEnabled",{get:function(){return this._isIncomingVideoEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isIncomingVideoAvailable",{get:function(){return this._callStage.isVideoAvailable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"correlationId",{get:function(){var e=this._call.signalingSession;return e?e.correlationId:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"terminatedReason",{get:function(){return this._call.terminatedReason},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"failureType",{get:function(){return this._call.failureType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forwardingDestinationType",{get:function(){return this._call.forwardingDestinationType},enumerable:!0,configurable:!0}),t.prototype.isBlocked=function(){return this._isBlockedPromise},t.prototype.isOnStage=function(){var e=s.swc.ChatContent;return e&&e.isOnStage(this.mri)},t.prototype.dispose=function(){this._subs.forEach(function(e){return e.dispose()}),this.setThreadId(void 0),this._call=null,this._callStage.dispose()},t.prototype.addSub=function(e){this._subs.push(e)},t.prototype.callCalee=function(e,t){var n=this;this._call.init({threadId:e,mediaPeerType:0}),this._call.addParticipant(e).then(function(){n._callStage.updateParticipants(n._call.participants),n.publish("isIncomingVideoAvailable",n.isIncomingVideoAvailable)}),this._call.start({ringOthers:!0,withVideo:t}).catch(function(e){}),this._toggleVideoPreview(t)},t.prototype.callGroup=function(e,t){this._call.init({threadId:e,mediaPeerType:2}),this._call.start({ringOthers:!1,withVideo:t}).catch(function(e){}),this._toggleVideoPreview(t)},t.prototype.stop=function(){return 7!==this._call.state&&6!==this._call.state?this._call.stop().then(function(){return!0}).catch(function(e){return!1}):Promise.resolve(!1)},t.prototype.accept=function(e){this._call.accept({withVideo:e}).catch(function(e){}),this._toggleVideoPreview(e)},t.prototype.reject=function(){this._call.reject().catch(function(e){})},t.prototype.getRawCall=function(){return this._call},t.prototype.toggleRoster=function(e){var t=e?this.MAX_STAGE_CAPACITY:this.MIN_STAGE_CAPACITY;this._callStage.setMaxStageCapacity(t)},t.prototype.toggleIncomingVideo=function(){this._isIncomingVideoEnabled=!this._isIncomingVideoEnabled,this._callStage.toggleIncomingVideo(this._isIncomingVideoEnabled),this.publish("isIncomingVideoEnabled",this._isIncomingVideoEnabled)},t.prototype.stopVideo=function(){var e=this;this._call.stopVideo().then(function(){e._toggleVideoPreview(!1)}).catch(function(e){})},t.prototype.startVideo=function(){var e=this;this._call.startVideo().then(function(){e._toggleVideoPreview(!0)}).catch(function(e){})},t.prototype.getThreadInfo=function(){var e=this.isGroup,t=this.mri,n={callId:this.callId,callerMri:this.callerMri,mri:t},i=function(e){return o({},n,{avatar:e.avatarUrl,displayName:e.topic.replace(/&apos;/g,"'")})};return e?l.ConversationUtils.getThreadProps(t).then(i):l.ConversationUtils.getPersonProps(t).then(i)},t.prototype.mute=function(){var e=this;this._call.mute().then(function(){e.publish("isMuted",!0)}).catch(function(t){e.publish("isMuted",e.isMuted)})},t.prototype.unmute=function(){var e=this;this._call.unmute().then(function(){e.publish("isMuted",!1)}).catch(function(t){e.publish("isMuted",e.isMuted)})},t.prototype.startScreenSharing=function(){var e=this;this._call.startScreenSharing().then(function(){e.publish("isScreenSharingOn",!0)}).catch(function(t){e.publish("isScreenSharingOn",e.isScreenSharingOn)}),this.publish("isScreenSharingOn",!0)},t.prototype.stopScreenSharing=function(){var e=this;this._call.stopScreenSharing().then(function(){e.publish("isScreenSharingOn",!1)}).catch(function(t){e.publish("isScreenSharingOn",e.isScreenSharingOn)}),this.publish("isScreenSharingOn",!1)},t.prototype._toggleVideoPreview=function(e){this.publish("isVideoOn",e)},t.prototype.setThreadId=function(e){this._threadId!==e&&(this._threadId=e,this.publish("threadId",this.threadId),this.publish("mri",this.mri))},t}(a.default);t.CallWrapper=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(){}return e.resolveBlockedState=function(e,t){return new Promise(function(n,r){if(t)n(!1);else{var o=i.default.instance.Persons.getPerson(e);i.default.instance.ContactsManager.getBlockedlist().then(function(e){var t=!!e&&e.filter(function(e){return e.mri===o.mri}).length>0;n(t)})}})},e.getPersonProps=function(e){var t=i.default.instance.Persons.getPerson(e,!0);return this.getPersonNamePromise(t,e).then(function(e){return{topic:e,avatarUrl:t.avatarData}})},e.getPersonNamePromise=function(e,t){return new Promise(function(n){if(e.displayName&&e.displayName!==t.substring(t.indexOf(":")+1))n(e.displayName);else{var i=function(){n(e.displayName),e.unsubscribe("displayName",i)};e.subscribe("displayName",i)}})},e.getThreadProps=function(e){var t=this;return new Promise(function(n,r){i.default.instance.WebApi.fetchThread(e).then(function(e){var i=e.properties.picture;if(i&&(i=i.replace("URL@","")),e.properties.topic)n({avatarUrl:i,topic:e.properties.topic});else{var r="",o=e.members,a=o&&o.length;a?o.forEach(function(e){t.getDisplayName(e.id).then(function(e){r+=e,--a?r+=", ":n({avatarUrl:i,topic:r})})}):n({avatarUrl:i,topic:e.properties.topic})}},function(){return r()})})},e.getDisplayName=function(e){var t=i.default.instance.Persons.getPerson(e);return this.getPersonNamePromise(t,e)},e.isPstn=function(t){return e.testMri(t,"4")},e.isGroup=function(e){return e.indexOf("@thread.skype")>-1},e.testMri=function(e,t){return e.split(":",1)[0]===t},e}();t.ConversationUtils=r},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=this;Object.defineProperty(t,"__esModule",{value:!0});var r=n(65);n(87),n(64);var o=n(371),a=n(93),s=r.default.build("SkypeWebControl",window);t.default=(r.default.alias(s,"swc"),void(s.Calling&&s.Calling.deferred?a.default.execute(s,"Calling",new o.default,i):s.Calling=s.Calling||new o.default))},function(e,t,n){"use strict";var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),o=n(9),a=n(4),s=n(6),c=n(2),l=n(1),u=n(23),d=n(134),p=n(17),h=n(372),f=n(373),g=n(374),m=n(375),_=n(378),v=n(121),y=n(0),S=n(340),E=n(24),T=n(379),C=n(395),I=n(396),A=n(416),b=n(426),O=n(347),R=n(348),P=n(428),N=n(430),w=n(431),M=n(112);y.swcWindow.ariaTelemetry=y.swcWindow.ariaTelemetry||n(115);var k=function(){function e(){var e=this;if(this.initialized=!1,this.GUIDE_DELAY=1800,this.threadId="",this._initializing=!1,this.rejectCallById=function(t){e._callRegistry.findCallById(t).reject()},this.acceptCallById=function(t,n){var i=e._callRegistry.findCallById(t);e._acceptCall(i,!!n)},this.acceptCallByThreadId=function(t,n){var i=e._callRegistry.findCallByThreadId(t);return!!i&&(e._acceptCall(i,!!n),!0)},this.acceptCall=function(t,n){var i=new O.CallWrapper(t.getCall());e._acceptCall(i,!!n)},this.on=function(e,t){return y.swc.API.registerEvent(e,t)},this.startCall=function(t,n,i,r){void 0===i&&(i={});return e._displayGuide(),e._devices.deviceEnumerationPromise.then(function(){return e._getDevicePermissionsPromise({audio:!0,video:!!n})}).then(function(i){e._removeGuide(),y.swc.API.triggerEvent(a.ApiEvents.DevicesPermissions,i),n&&!i.video&&(n=!1);var o=i.audio?function(){if((r=void 0!==r?r:R.ConversationUtils.isGroup(t))?(e.threadId=t||e.threadId,e.calleeId=""):(e.calleeId=t||e.calleeId,e.threadId=""),!e.calleeId&&!e.threadId)return null;e._startCall(!!n,"external");var i=e._callRegistry.currentCall;return new w.SWCall(i.getRawCall())}():null;return Promise.resolve(o)})},this.signInStateHandler=function(t,n){t===u.SigninState.SignedIn&&l.default.instance.MePersonManager.fetch().then(function(t){e.getStack(t.id,n)},function(e){}),t===u.SigninState.SigningOut&&(e.initialized=!1,e._stack&&e._stack.reset&&e._stack.reset(),e._callRegistry&&e._callRegistry.dispose(),e._callRegistry=null)},this._getDevicePermissionsPromise=function(t){return E.default.getDeviceType()===E.DeviceType.Mobile?Promise.resolve(t):e._devices.askDevicePermission(t)},this._onCallThreadIdChange=function(t){var n=e._callRegistry.currentCall;n&&t&&n.threadId===t&&y.swc.API.triggerEvent(a.ApiEvents.StartChat,{ConversationId:n.mri,ExecuteCall:{id:n.callId,accept:!0,callerMri:n.mri||""}})},this._onExitFullscreen=function(){e._callingKPI.fullscreenTime.stop();var t=e._callRegistry.currentCall;e._sendCallTelemetry(t,h.CallingEventName.ToggleFullscreen)},this._onEnterFullscreen=function(){e._callingKPI.fullscreenTime.start(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.Fullscreen));var t=e._callRegistry.currentCall;e._sendCallTelemetry(t,h.CallingEventName.ToggleFullscreen)},this._showCallingScreen=function(t){e._showContainerElement(),y.swc.API.triggerEvent(a.ApiEvents.UpdateCallingScreen,t),y.swc.API.triggerEvent(a.ApiEvents.InappActivityStarted,"Opened")},this._processCallStates=function(t){var n={callId:t.correlationId,id:t.callId,status:t.state,reason:t.terminatedReason,failure:t.failureType,mri:t.mri};switch(y.swc.API.triggerEvent(a.ApiEvents.CallStatusChanged,n),e.callStatusCallback&&e.callStatusCallback(t.state),t.state){case 1:e._callingKPI=new f.CallingKPIEvent(t.getRawCall()),e._callingKPI.direction="incoming",e._callingKPI.ringTime.start(),y.swc.API.triggerEvent(a.ApiEvents.OnCallStart,{direction:"incoming"}),t.isOnStage()||e._showNotification(t);break;case 2:e._callingKPI.setupTime.stop(),e._callingKPI.connectTime.start(),e._callingKPI.origin=e._callOrigin;break;case 3:e._audioPlayer.stopAll(),e._callingKPI.ringTime.stop(),e._callingKPI.connectTime.stop(),e._callingKPI.audioTime.start(),t.isVideoOn&&e._callingKPI.videoTime.start(),y.swc.API.triggerEvent(a.ApiEvents.OnCallConnect);break;case 7:e._callingKPI.stopAll(),e._onCallFinished(t),e._audioPlayer.stopAll(),e._audioPlayer.play(C.CallingSound.Ended,!1),e._onMaximize();break;case 6:e._callingKPI.cancelTime.start()}e._sendCallMessage(t),e._sendCallTelemetry(t,h.CallingEventName.StateChanged)},this._onCallFinished=function(t){var n=A.CallRateUtils.shouldShowCallRate(t,e._callingKPI.audioTime.time);e._updateCallingComponent({displayCallRate:n}),n||e._closeCalling(t)},this._stopCall=function(){var t=e._callRegistry.currentCall;t&&(t.stop(),e._sendCallTelemetry(t,h.CallingEventName.StopCall),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.StopCall)))},this._toggleVideo=function(){var t=e._callRegistry.currentCall;t&&(t.isVideoOn?(t.stopVideo(),e._callingKPI.videoTime.stop(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.VideoOff))):(t.startVideo(),e._callingKPI.videoTime.start(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.VideoOn))),e._sendCallTelemetry(t,h.CallingEventName.ToggleVideo))},this._toggleAudio=function(){var t=e._callRegistry.currentCall;t&&(t.isMuted?(t.unmute(),e._callingKPI.muteTime.stop(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.AudioOff))):(t.mute(),e._callingKPI.muteTime.start(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.AudioOn))),e._sendCallTelemetry(t,h.CallingEventName.ToggleAudio))},this._toggleScreenSharing=function(){var t=e._callRegistry.currentCall;t&&(t.isScreenSharingOn?(t.stopScreenSharing(),e._callingKPI.screenSharingTime.stop(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.ScreenSharingOn))):(t.startScreenSharing(),e._callingKPI.screenSharingTime.start(),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.ScreenSharingOff))),e._sendCallTelemetry(t,h.CallingEventName.ToggleScreenSharing))},this._toggleIncomingVideo=function(){e._callRegistry.currentCall.toggleIncomingVideo()},this._acceptCall=function(t,n){e._audioPlayer.stop(C.CallingSound.Ringing),e._displayGuide(),e._devices.deviceEnumerationPromise.then(function(){return e._getDevicePermissionsPromise({audio:!0,video:!!n})}).then(function(i){e._removeGuide(),y.swc.API.triggerEvent(a.ApiEvents.DevicesPermissions,i);var r=e._callRegistry.currentCall;i.audio&&!r&&(e._callRegistry.currentCall=t,n&&!i.video&&(n=!1),t.accept(n),e._sendCallTelemetry(t,h.CallingEventName.AcceptCall,n))})},this._rejectCall=function(t){e._audioPlayer.stop(C.CallingSound.Ringing),t.reject();var n=e._callRegistry.currentCall;n&&e._sendCallTelemetry(n,h.CallingEventName.RejectCall)},this._onMinimize=function(){var t=e._callRegistry.currentCall;if(t){var n=t.threadId;y.swc.API.triggerEvent(a.ApiEvents.CallingLayoutChanged,{action:"minimize",mri:n}),l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.SwitchToChat))}},this._onMaximize=function(){var t=e._callRegistry.currentCall;if(t){var n=t.threadId;y.swc.API.triggerEvent(a.ApiEvents.CallingLayoutChanged,{action:"maximize",mri:n})}},this._onDock=function(){var t=e._callRegistry.currentCall;t&&(y.swc.API.triggerEvent(a.ApiEvents.CallLayoutChanged,"dock"),e._sendCallTelemetry(t,h.CallingEventName.DockVideo))},this._onUndock=function(){var t=e._callRegistry.currentCall;t&&(y.swc.API.triggerEvent(a.ApiEvents.CallLayoutChanged,"undock"),e._sendCallTelemetry(t,h.CallingEventName.UndockVideo))},!c.default.ECS){var t,n,i="%%%ENVIRONMENT%%%";c.default.ECS={frameless:!!s.default.get.frameless+"",ariaTenantId:(n="8025e5036b77483783612070662d3127-d2fcc34c-3b1d-4fdd-8759-7d2b573371c8-6859",-1===n.indexOf("%%%")?n:"12d14245508842999e0a2b5b085d77b8-fbc1a11b-cedf-49e2-9e83-51bb383e5fc6-7084"),ariaServicesTenantId:"",signalingTenantId:"",mdscTenantId:"",trouterTenantId:"",version:"%%%VERSION%%%",connectPageUrl:(t="%%%VERSION%%%","https://swc.cdn.skype.com/v/"+(t=-1===t.indexOf("%%%")?"0.24.4":t)+"/connect-prod.min.html"),loaderUrl:"",environment:i.indexOf("%%%")>-1?"int":i,domain:"",notificationToastsSupport:"",hideRecentsFooter:"",disableSendingReactions:[],reactionPacks:[],showEngagementCampaings:!1,sumToastDelayMin:0}}}return e.prototype.init=function(e,t,n,i,r,o,c,u,p){var h=this;if(!this._initializing&&!this.initialized){this._initializing=!0,s.default.get.copy(o),this._audioPlayer=new C.CallingAudioPlayer,this.element=e,this._selectedDevices=p,r&&(this.callStatusCallback=r.onCallStatusChange||null,this.registryUpdateCallback=r.onRegistryUpdate||null),l.default.initServices({skypeTokenProvider:n});var f=function(){d.default.init()};return l.default.instance.setManagersInit(f),l.default.instance.SignInManager.subscribe("state",function(e){h.signInStateHandler(e,i)}),f(),y.swc.API.registerEvent(a.ApiEvents.invoke.startCall,function(e){return h.startCall(e.id,e.withVideo,e.callParams,e.isGroup)}),y.swc.API.registerEvent(a.ApiEvents.invoke.stopCall,function(){return h._stopCall()}),this.getStack(t,i)}},e.prototype.getStack=function(t,n){var i=this;if(this._callingStackPromise&&this._callingStackPromise.status===p.PromiseStatus.Pending)return this._callingStackPromise.promise;var r={service:new _.default,logger:new m.default},o=l.default.instance.SignInManager.getSkypeToken.bind(l.default.instance.SignInManager);return this._callingStackPromise=new p.CancelablePromise(T.build(o,r,e.getClientInfo()).then(function(e){i.initialized=!0,i.setup(e,t,o,n)})),this._callingStackPromise.promise},e.prototype.setup=function(e,t,n,i,r){var o=this;this._stack=e,this._callRegistry=new b.CallRegistry(e,t,n),r?this.threadId=i:this.calleeId=i;var s=e.getDeviceManager();this._devices=new P.Devices(s,this._selectedDevices),this._setupCallingComponent(),this._callRegistry.subscribe("incomingCalls",function(e){o._updateIncomingCalls(e)}),this._callRegistry.subscribe("callStateChanged",function(e){o._processCallStates(e)}),this._callRegistry.subscribe("currentCall",function(e){var t={currentCall:e};e&&(t.displayCallRate=!1,e.subscribe("threadId",o._onCallThreadIdChange)),o._updateCallingComponent(t)}),this._callRegistry.subscribe("callDeleted",function(e){e.unsubscribe("threadId",o._onCallThreadIdChange),l.default.instance.TelemetryService.sendEvent(o._callingKPI);var t={isSuccessfull:2===e.getRawCall().failureType};y.swc.API.triggerEvent(a.ApiEvents.OnCallEnd,t)}),l.default.instance.SignInManager.prelogoutActions.push(T.stop.bind(T))},e.prototype._setupCallingComponent=function(){var e=this;this._callingComponentProperties={currentCall:this._callRegistry.currentCall,devices:this._devices,incomingCalls:[],displayCallRate:!1,onStartCall:function(t){e._startCall(t,"ui")},onAcceptCall:this._acceptCall,onRejectCall:this._rejectCall,onVideoToggle:this._toggleVideo,onAudioToggle:this._toggleAudio,onScreenSharingToggle:this._toggleScreenSharing,onHangup:this._stopCall,onIncomingVideoToggle:this._toggleIncomingVideo,onDockToggle:function(t){t?e._onDock():e._onUndock()},onRosterToggle:function(t){var n=e._callRegistry.currentCall;n&&n.toggleRoster(t)},onFullscreenToggle:function(t){t?e._onEnterFullscreen():e._onExitFullscreen()},onChatToggle:function(t){t?e._onMinimize():e._onMaximize()},onSettingsToggle:function(e){e&&l.default.instance.TelemetryService.sendEvent(new v.UserActionEvent(v.UserActionType.MediaSettings))},onCallRate:function(t){var n=e._callRegistry.currentCall;t&&l.default.instance.TelemetryService.sendEvent(new g.CallRateEvent(t,n.getRawCall())),e._closeCalling(n)}},this._renderCallingComponent()},e.prototype._renderCallingComponent=function(){var e=o.createElement(I.CallingComponent,this._callingComponentProperties);r.render(e,this.element)},e.prototype._updateCallingComponent=function(e){this._callingComponentProperties=i({},this._callingComponentProperties,e),this._renderCallingComponent()},e.prototype._showContainerElement=function(){this.element&&(this.element.style.display="block")},e.getClientInfo=function(){return"Web CallSignalingAgent(PluginLess/"+c.default.getClientInfo()+")"},e.prototype.dispose=function(){this._stopCall()},e.prototype._showNotification=function(e){e.isBlocked().then(function(t){t||e.getThreadInfo().then(function(e){l.default.instance.NotificationsManager.registerCall(e)})})},e.prototype._sendCallMessage=function(e){var t=e.isGroup;if(!t){var n=e===this._callRegistry.currentCall||!e.callerMri,i=Math.round(this._callingKPI.audioTime.time/1e3),r=3===e.state,o=7===e.state,a=o&&1!==e.terminatedReason,s=M.getCallMessage({isGroup:t,isMyself:n,isStarted:r,isEnded:o,isMissed:a,duration:i});(S.isEnterpriseUserMri(e.mri)?S.generateOneToOneConversationId(e.mri):Promise.resolve(e.mri)).then(function(e){l.default.instance.WebApi.sendLocalSystemMessage(e,s.message,s.messageType)})}},e.prototype._closeCalling=function(e){var t=this;this._updateCallingComponent({currentCall:null,displayCallRate:!1}),this._hideContainerElement(),setTimeout(function(){t._callRegistry.deleteCall(e)},0)},e.prototype._hideContainerElement=function(){var e=this.element.parentElement;e&&e.classList.remove("no-transition"),r.render(null,this.element),this.element.style.display="none"},e.prototype._sendCallTelemetry=function(e,t,n){var i=e.getRawCall(),r=new h.default(i);r.eventName=t,r.withVideo=!!n,r.direction=this._callingKPI.direction,r.origin=this._callOrigin,l.default.instance.TelemetryService.sendEvent(r)},e.prototype._updateIncomingCalls=function(e){if(this._updateCallingComponent({incomingCalls:e}),e.length)for(var t=0,n=e;t<n.length;t++){var i=n[t];y.swc.API.triggerEvent(a.ApiEvents.IncomingCall,new w.SWCall(i.getRawCall())),this.registryUpdateCallback&&this.registryUpdateCallback(i),this._showCallingScreen(i.mri),s.default.get.suppressBackgroundRinging&&!i.isOnStage()||this._audioPlayer.play(C.CallingSound.Ringing)}else this._audioPlayer.stop(C.CallingSound.Ringing)},e.prototype._startCall=function(e,t){var n=this;if(!this._callRegistry.currentCall){this._showCallingScreen(this.threadId||this.calleeId),this._audioPlayer.play(C.CallingSound.Dialing,!1).then(function(){n._audioPlayer.play(C.CallingSound.Ringback)}),this._callOrigin=t,this._callRegistry.createAndCall(this.threadId||this.calleeId,!!this.threadId,e);var i=this._callRegistry.currentCall;this._callingKPI=new f.CallingKPIEvent(i.getRawCall()),this._callingKPI.direction="outgoing",this._callingKPI.setupTime.start(),this._sendCallTelemetry(i,h.CallingEventName.StartCall,e),y.swc.API.triggerEvent(a.ApiEvents.OnCallStart,{direction:"outgoing"})}},e.prototype._displayGuide=function(){var e=this;s.default.get.displayDeviceGuide&&E.default.isChrome()&&!this.guideTimeout&&(this.guideTimeout=setTimeout(function(){var t=e.element.parentElement,n=t?t.getBoundingClientRect():{left:400,top:300,width:200,height:100};e.guide=e.guide||new N.Guide;var i=l.default.instance.i18n.fetch("deviceconsent_legend");e.guide.show(i,n)},this.GUIDE_DELAY))},e.prototype._removeGuide=function(){this.guideTimeout&&window.clearTimeout(this.guideTimeout),this.guide&&this.guide.hide()},e}();t.default=k},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(246),s=n(8);!function(e){e.StateChanged="stateChanged",e.StartCall="startCall",e.StopCall="stopCall",e.ToggleVideo="toggleVideo",e.ToggleAudio="toggleAudio",e.ToggleScreenSharing="toggleScreenSharing",e.AcceptCall="acceptCall",e.RejectCall="rejectCall",e.DockVideo="dockVideo",e.UndockVideo="undockVideo",e.ToggleFullscreen="toggleFullscreen"}(t.CallingEventName||(t.CallingEventName={}));var c=function(e){function t(n){var i=e.call(this,"calling",n)||this;return i.callState=n.state,i.failureState=t.failureTypeMap[n.failureType],n.participants[0]&&(i.participantState=t.participantStateMap[n.participants[0].state],i.participantStateReason=t.participantStateReasonMap[n.participants[0].stateReason]),i}return r(t,e),t.prototype.getCustomProperties=function(){var t=e.prototype.getCustomProperties.call(this);return t.push(o.TelemetryPropertyValue.Create("state",this.getCallState())),t.push(o.TelemetryPropertyValue.Create("eventName",this.eventName)),t.push(o.TelemetryPropertyValue.Create("withVideo",this.withVideo||this.call.isVideoOn)),t.push(o.TelemetryPropertyValue.Create("isMuted",this.call.isMuted)),t.push(o.TelemetryPropertyValue.Create("failureState",this.failureState||s.NA)),t.push(o.TelemetryPropertyValue.Create("participantState",this.participantState||s.NA)),t.push(o.TelemetryPropertyValue.Create("participantStateReason",this.participantStateReason||s.NA)),t},t.prototype.getCallState=function(){var e=t.callStateMap[this.callState];return a.default.story+=this.eventName+"_"+e+";",e},t.callStateMap=["None","Notified","Connecting","Connected","LocalHold","RemoteHold","Disconnecting","Disconnected","Observing","EarlyMedia"],t.participantStateMap=["None","Connecting","Ringing","Connected","Disconnected","OnHold","EarlyMedia"],t.participantStateReasonMap=["None","AddingFailed","NoResponse","Declined","NotReachable","Blocked","NotFriendOrAuthorized","CallLimitReached","CallNotFound","NetworkError","MediaError","OtherError","PstnInsufficientFunds","PstnSkypeoutAccountBlocked","PstnCouldNotConnectToSkypeProxy","PstnBlockedByUs","PstnBlockedRegulatoryIndia","PstnInvalidNumber","PstnNumberForbidden","Busy","PstnCallTerminated","PstnNumberUnavailable","PstnEmergencyCallDenied","Cancelled","Dropped","PstnNoSubscriptionCover"],t.failureTypeMap=["CallSetupFailed","CallDropped","Undefined"],t}(a.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(5),s=n(246),c=n(8),l=function(){function e(){this._startTime=0,this._time=0}return e.prototype.start=function(){this._startTime=Date.now()},e.prototype.stop=function(){this._startTime&&(this._time+=Date.now()-this._startTime,this._startTime=0)},Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){switch(void 0===t&&(t="none"),t){case"none":return this.time+"";case"min":return e.round(this.time/1e3/60)+"";case"sec":return e.round(this.time/1e3)+""}return""},e.round=function(e){return Math.round(100*(e+1e-5))/100},e}(),u=function(e){function t(t){var n=e.call(this,"calling_kpi",t)||this;return n.ringTime=new l,n.setupTime=new l,n.connectTime=new l,n.cancelTime=new l,n.videoTime=new l,n.audioTime=new l,n.muteTime=new l,n.fullscreenTime=new l,n.screenSharingTime=new l,s.default.story="",n}return r(t,e),t.prototype.stopAll=function(){this.ringTime.stop(),this.setupTime.stop(),this.connectTime.stop(),this.cancelTime.stop(),this.videoTime.stop(),this.audioTime.stop(),this.muteTime.stop(),this.fullscreenTime.stop(),this.screenSharingTime.stop()},t.prototype.getCustomProperties=function(){var n=e.prototype.getCustomProperties.call(this);n.push(a.TelemetryPropertyValue.Create("ringTime",this.ringTime.toString())),n.push(a.TelemetryPropertyValue.Create("setupTime",this.setupTime.toString())),n.push(a.TelemetryPropertyValue.Create("connectTime",this.connectTime.toString())),n.push(a.TelemetryPropertyValue.Create("cancelTime",this.cancelTime.toString())),n.push(a.TelemetryPropertyValue.Create("videoTime",this.videoTime.toString())),n.push(a.TelemetryPropertyValue.Create("videoTimeSec",this.videoTime.toString("sec"))),n.push(a.TelemetryPropertyValue.Create("videoTimeMin",this.videoTime.toString("min"))),n.push(a.TelemetryPropertyValue.Create("audioTime",this.audioTime.toString())),n.push(a.TelemetryPropertyValue.Create("audioTimeSec",this.audioTime.toString("sec"))),n.push(a.TelemetryPropertyValue.Create("audioTimeMin",this.audioTime.toString("min"))),n.push(a.TelemetryPropertyValue.Create("muteTime",this.muteTime.toString())),n.push(a.TelemetryPropertyValue.Create("screenSharingTime",this.screenSharingTime.toString())),n.push(a.TelemetryPropertyValue.Create("screenSharingTimeSec",this.screenSharingTime.toString("sec"))),n.push(a.TelemetryPropertyValue.Create("screenSharingTimeMin",this.screenSharingTime.toString("min"))),n.push(a.TelemetryPropertyValue.Create("fullscreenTime",this.fullscreenTime.toString())),n.push(a.TelemetryPropertyValue.Create("isSuccessfull",this.isSuccessfull()));var i=t.terminatedReason[this.call.terminatedReason]||c.NA;return n.push(a.TelemetryPropertyValue.Create("terminatedReason",i)),n.push(a.TelemetryPropertyValue.Create("story",s.default.story)),n.push(a.TelemetryPropertyValue.Create("parentProtocol",o.default.get.parentProtocol)),n},t.prototype.isSuccessfull=function(){return 2===this.call.failureType&&!!t.terminatedReasonWIthSuccess[this.call.terminatedReason]},t.terminatedReason=["0 - Undefined","1 - Success","2 - NoNgcEndpoint","3 - NetworkError","4 - MediaError","5 - BadRequest","6 - CallEstablishmentTimeout","7 - CallSetupError","8 - NoPermission","9 - Missed","10 - Declined","11 - Busy","12 - Cancelled","13 - Dropped","14 - PstnInsufficientFunds","15 - PstnSkypeoutAccountBlocked","16 - PstnCouldNotConnectToSkypeProxy","17 - PstnBlockedByUs","18 - PstnBlockedRegulatoryIndia","19 - PstnInvalidNumber","20 - PstnNumberForbidden","21 - PstnCallTerminated","22 - PstnNumberUnavailable","23 - PstnEmergencyCallDenied","24 - CallNotFound","25 - LocalError","26 - NotAcceptableHere","27 - CallForwarded","28 - CallForwardedToVoicemail","29 - SkypeTokenError","30 - CallAccepted","31 - LocalHttpStackError","32 - UnknownError","33 - PstnNoSubscriptionCover"],t.terminatedReasonWIthSuccess={1:"Success",10:"Declined",12:"Cancelled"},t}(s.default);t.CallingKPIEvent=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(1),s=n(5),c=function(e){function t(t,n){var i=e.call(this,"mdsc_call_quality_feedback")||this;return i.score=t,i.callId=n.callId,i.endpointId=n.endpointId,i}return r(t,e),t.prototype.getCustomProperties=function(){var e=[];return e.push(s.TelemetryPropertyValue.Create("call_mos_score",this.score)),e.push(s.TelemetryPropertyValue.Create("call_mos_score_tracking_reason","random")),e.push(s.TelemetryPropertyValue.Create("call_id",this.callId)),e.push(s.TelemetryPropertyValue.Create("endpoint_id",this.endpointId)),e.push(s.TelemetryPropertyValue.Create("participant_id",a.default.instance.MePersonManager.mePerson.id)),e.push(s.TelemetryPropertyValue.Create("appVersion",o.default.getUiVersion())),e},t}(n(8).TelemetryEvent);t.CallRateEvent=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(1),o=n(376),a=n(98),s=n(377),c=new a.default(i.default.ECS&&i.default.ECS.trouterTenantId||"708a9eb9fe2646fe8f4c37b7eee2e3da-9b97485a-57b9-43a8-8177-07ca7a653a30-6706"),l=function(){function e(e){void 0===e&&(e=[]),this._namespace=e}return e.prototype.createChild=function(t,n){return new e(this._namespace.concat(["string"==typeof t?function(){return t}:t]))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("warn",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("error",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},Object.defineProperty(e.prototype,"_prefix",{get:function(){return this._namespace.map(function(e){return e()}).join("/")},enumerable:!0,configurable:!0}),e.prototype.reportError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(t&&0!==t.length)try{var i=new o.CallingError;i.level=e,i.namespace=this._prefix,i.message=t.join("; "),r.default.instance.TelemetryService.sendEvent(i)}catch(e){}},e.prototype.reportEvent=function(e,t){var n=new s.TrouterEvent(e,t);c.sendEvent(n.convert())},e}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=n(5),s=function(e){function t(){return e.call(this,"calling_error")||this}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(a.TelemetryPropertyValue.Create("namespace",this.namespace)),e.push(a.TelemetryPropertyValue.Create("message",this.message)),e.push(a.TelemetryPropertyValue.Create("level",this.level)),e},t}(o.TelemetryEvent);t.CallingError=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),s=n(24),c=n(5),l=function(e){function t(t,n){var i=e.call(this,t)||this;return i.properties=n,i.properties.AppInfo_Version=o.default.getUiVersion(),i.properties["DeviceInfo.BrowserName"]=s.default.getBrowserName(),i.properties["DeviceInfo.BrowserVersion"]=s.default.getBrowserVersion(),i.properties["DeviceInfo.OsName"]=s.default.getOsName(),i.properties["DeviceInfo.OsVersion"]=s.default.getOsVersion(),i.properties["DeviceInfo.Id"]=s.default.getDeviceId().replace(/-/g,""),i.properties.ua="SWC",i}return r(t,e),t.prototype.getCustomProperties=function(){var e=this,t=[];return Object.keys(this.properties).forEach(function(n){var i=e.properties[n];"string"!=typeof i&&"number"!=typeof i?t.push(c.TelemetryPropertyValue.Create(n,i.value,i.piiKind)):t.push(c.TelemetryPropertyValue.Create(n,i))}),t},t.prototype.convert=function(){var e=this,t=new a.swcWindow.ariaTelemetry.EventProperties;return t.name=this.name,t.eventType=this.type,t.timestamp=this.timestamp,this.getEventProperties().forEach(function(n){e.addProperty(t,n)}),t},t.prototype.addProperty=function(e,t){e.setProperty(t.key,t.value+"",t.type)},t}(n(8).TelemetryEvent);t.TrouterEvent=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(98),s=n(5),c=n(8),l=new a.default(o.default.ECS&&o.default.ECS.mdscTenantId||"1cae5691997646c98b01d15beddae7a3-50acf4d2-4619-485a-80d4-42143f615c6d-7038"),u=new a.default(o.default.ECS&&o.default.ECS.signalingTenantId||"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413"),d=function(){function e(){}return e.prototype.sendEvent=function(e,t){var n=new p(e,t);u.sendEvent(n.convert())},e.prototype.sendEvents=function(e){e.forEach(function(e){var t=0===e.eventName.indexOf("mdsc_")?e.eventName:"mdsc_"+e.eventName,n=new p(t,e.props);l.sendEvent(n.convert())})},e}();t.default=d;var p=function(e){function t(t,n){var i=e.call(this,t)||this;return i.properties=n,i.properties.uiVersion=o.default.getUiVersion(),i.properties.ui_version=o.default.getUiVersion(),i}return r(t,e),t.prototype.getCustomProperties=function(){var e=this,t=new Array;return Object.keys(this.properties).forEach(function(n){var i=e.properties[n];"string"!=typeof i&&"number"!=typeof i?t.push(s.TelemetryPropertyValue.Create(n,i.value,i.piiKind)):t.push(s.TelemetryPropertyValue.Create(n,i))}),t},t.prototype.convert=function(){var e=this,t=new window.ariaTelemetry.EventProperties;return t.name=this.name,t.eventType=this.type,t.timestamp=this.timestamp,this.getEventProperties().forEach(function(n){e.addProperty(t,n)}),t},t.prototype.addProperty=function(e,t){e.setProperty(t.key,t.value+"",t.type)},t}(c.TelemetryEvent);t.PluginlessStackEvent=p},function(e,t,n){"use strict";var i=n(380),r=n(6),o=n(392),a=n(393);n(341);var s=new(function(){function e(){this._trouterService=new a.Trouter}return e.prototype._getClientInformation=function(){return"Web CallSignalingAgent(PluginLess/999/0.0.0.0//swc/ os=U; osVer=U; proc=U; deviceType=U; browser=U; browserVer=U)"},e.prototype._getTrouterSettings=function(){return{version:"0.0.0",productName:"swc",incomingCalls:{trouterServiceUrl:"https://go.trouter.io/v4/a",registrarServiceUrl:"https://prod.registrar.skype.com/v2/registrations",registrarTtlInSeconds:360,registrarRefreshTimeoutInMs:35e4,trouterReadyTimeoutInMs:6e4,trouterConnectTimeoutInMs:2e4,maxRegistrationTimeInMs:864e5,pnhAppId:"skype",pnhTemplate:"SkypeWebNGC_1.7"},telemetry:{jSkypeTenantToken:"dummy-not-used",skypeConcoreToken:""}}},e.prototype._initTrouter=function(){this._trouterService.init(this._logger,this._getPlatformName(),this._getTrouterSettings(),this._tokenProvider,(new i.HttpRequestDispatcherImplementation).requestDispatcherImpl);var e={sessionId:r.default.get.sessionId};return this._trouterService.start(e),this._trouterService.getTrouterUrlAsync()},e.prototype._getTelemetryService=function(){var e=this;return{getCallingAdapter:function(){return{sendEvent:e._telemetryService.sendEvent}},sendEvents:function(t){return e._telemetryService.sendEvents(t),Promise.resolve(null)}}},e.prototype._getSignalingAgentConfig=function(){return{conversationServiceUrl:"https://api.conv.skype.com/conv/",trouterUrlGetter:this._trouterService,logger:this._logger,skypeToken:this._tokenProvider,languageCode:"en",clientInformation:this._clientInfo,emergencyCallCountry:"",doHostlessCalling:!0,shouldServiceSendCallEventMessages:!0,shouldServiceSendNGCUpgradeMessages:!0,brokerEnabledOutgoing:!0,brokerEnabledIncoming:!0,brokerRequestBatching:!0,supportsHostlessGroupCalls:!0,isGVCOutgoingEnabled:!0,isGVCJoiningEnabled:!0,serverMuteUnmute:!0,isWebRtcEnabled:"true",httpRequestDispatcher:new i.HttpRequestDispatcherImplementation,telemetryManager:this._getTelemetryService().getCallingAdapter(),autoJoinOnConflict:!0,cloudScreenSharingFlag:"enabled"}},e.prototype._getAppStateProvider=function(){return{isOnline:function(){return!0}}},e.prototype._getMediaAgentConfig=function(){return{debug:!0,numVideoChannelsGvc:6,requestTimeoutMs:3e4,preferSdesSrtp:!0,webrtcOutgoingScreenSharingEnabled:!0,ortcOutgoingScreenSharingEnabled:!0}},e.prototype._getMediaAgentFactoryConfig=function(e){return{logger:this._logger,tokenProvider:this._tokenProvider,telemetryAdapter:this._getTelemetryService().getCallingAdapter(),configProvider:e,settings:this._getMediaAgentConfig(),appStateProvider:this._getAppStateProvider()}},e.prototype._getPlatformName=function(){return"chrome"},e.prototype._getConfig=function(){return{signalingAgentConfig:this._getSignalingAgentConfig(),mediaAgentFactoryConfig:this._getMediaAgentFactoryConfig(o.testConfigProvider),trouterService:this._trouterService,logger:this._logger,telemetryService:this._getTelemetryService(),platformType:this._getPlatformName()}},e.prototype.build=function(e,t,n){var r=this;return this._tokenProvider=e,this._telemetryService=t.service,this._logger=t.logger,this._clientInfo=n||this._getClientInformation(),this._initTrouter().then(function(){var e=r._getConfig();return i.pluginlessStackFactory.build(e)})},e.prototype.stop=function(){this._trouterService.stop()},e}());e.exports=s},function(e,t,n){var i;i=function(e,t,n,i){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=248)}([function(e,t,n){"use strict";var i=n(79),r=n(1),o=["response","responseText","responseURL","status","statusText","timeout","withCredentials","stack","message","name"];function a(e,t){if(!e)throw new Error("Assert failed"+(void 0!==t?":"+t:""))}function s(e,t){if(!e||" "===e)throw new Error("AssertNotNullOrEmpty failed. "+(void 0!==t?": "+t:""))}function c(e,t){if(!e)throw new Error("AssertNotNull failed. "+(void 0!==t?": "+t:""))}function l(e,t){var n=t.toString().toLowerCase();return-1<e.map(function(e){return e.toString().toLowerCase()}).indexOf(n)}function u(e,t){return void 0===t&&(t=!1),e instanceof Error?e.toString():t?JSON.stringify(e):JSON.stringify(e,o,4)}t.is1to1Mri=function(e){return!!e.match(/^8:/)},t.stripMri=function(e){return e.replace(/^\d+:/,"")},t.newGuid=function(){for(var e,t="",n=0;n<36;){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[n];switch(e=n%8==0?4294967295*Math.random()|0:e>>4,i){case"x":t+="0123456789abcdef"[15&e];break;case"y":t+="0123456789abcdef"[3&e|8];break;case"4":case"-":t+=i}n++}return t},t.assert=a,t.assertNotNullOrEmpty=s,t.assertNotNull=c,t.assertCallEndReason=function(e){if(s(e,"callEndReason cannot be null or empty"),void 0===e.code||void 0===e.subCode||void 0===e.phrase||e.code<0||e.subCode<0||" "===e.phrase)throw new Error("callEndReason must specify code, subCode and phrase. Invalid reason : "+u(e))},t.getMediaTypes=function(e){c(e,"MediaTypes passed cannot be null"),a(e.length>0,"Atleast one mediaType must be specified");var t=[],n=r.default.MEDIA_TYPES;for(var i in n)l(e,n[i])&&t.push(n[i]);return t},t.stringContains=function(e,t){return e.indexOf(t)>-1},t.stringEndsWith=function(e,t){return e.length>=t.length&&e.indexOf(t,e.length-t.length)>-1},t.arrayContains=l,t.getPrintableObject=u,t.tryAddNewKeyToHashTable=function(e,t,n){return!e.hasOwnProperty(t)&&(e[t]=n,!0)},t.tryRemoveKeyFromHashTable=function(e,t){return!!e.hasOwnProperty(t)&&(delete e[t],!0)},t.getHashTableCount=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},t.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},t.getErrorForXHRFailure=function(e){if(!e)return{telemetryEndSubCode:r.default.CALL_END_CODE.UNKNOWN_ERROR,error:r.default.CALL_END_UNKNOWN_ERROR};var t;if("object"==typeof e.response)t=e.response;else try{t=JSON.parse(e.response)}catch(e){}return isNaN(e.status)||e.status!==r.default.CALL_END_CODE.NOT_FOUND?e.skypeTokenError?{telemetryEndSubCode:r.default.CALL_END_CODE.SKYPE_TOKEN_ERROR,error:r.default.CALL_END_SKYPE_TOKEN_ERROR}:t&&t.operationFailure?{telemetryEndSubCode:t.operationFailure.code,error:t.operationFailure}:t&&t.code?{telemetryEndSubCode:t.code,error:t}:isNaN(e.status)||0!==e.status?{telemetryEndSubCode:r.default.CALL_END_CODE.NETWORK_ERROR,error:r.default.CALL_END_NETWORK_ERROR}:{telemetryEndSubCode:r.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,error:r.default.CALL_END_LOCAL_HTTP_STACK_ERROR}:{telemetryEndSubCode:r.default.CALL_END_CODE.NOT_FOUND,error:r.default.RESOURCE_NOT_FOUND_ERROR}},t.isDuplicateMessage=function(e,t){if(e&&t){var n=e[r.default.HEADERS.ORIGINAL_MESSAGE_ID]||null,i=e[r.default.HEADERS.MESSAGE_ID]||null;if(i&&l(t,i)||n&&l(t,n))return!0;t.length>9&&t.shift(),t.push(n||i)}return!1},t.cacheMessageResult=function(e,t,n){if(e&&t){var i=e[r.default.HEADERS.ORIGINAL_MESSAGE_ID]||e[r.default.HEADERS.MESSAGE_ID]||null;i&&(t[i]=n)}},t.getMessageResultFromCache=function(e,t){return e&&t[e[r.default.HEADERS.ORIGINAL_MESSAGE_ID]||e[r.default.HEADERS.MESSAGE_ID]||null]||null},t.isEncodedMessage=function(e){return e&&e.hasOwnProperty(r.default.HEADERS.CONTENT_ENCODING)},t.isMessageEncodingSupported=function(e){return e&&r.default.KNOWN_PAYLOAD_ENCODINGS.hasOwnProperty(e[r.default.HEADERS.CONTENT_ENCODING].toUpperCase())},t.parseRawHttpMessage=function(e){for(var t,n=e.split(/\r?\n/),i=n.shift().split(" "),r=i[0],o=i[1]||"",a={};t=n.shift().trim();)try{var s=_.chain(t.split(":")).map(function(e){return _.trim(e)}).value(),c=s[0],l=s[1];a[c]=l}catch(e){throw new Error("Malformed header: "+t+e)}return{url:o,headers:a,method:r,body:n.join("")}},t.decodeMessage=function(e){var t=atob(e);return i.inflate(t,{to:"string"})},t.defer=function(){var e,t,n=!0;return{isPending:function(){return n},promise:new Promise(function(n,i){e=n,t=i}),resolve:function(t){n&&(e(t),n=!1)},reject:function(e){n&&(t(e),n=!1)}}}},function(e,t,n){"use strict";t.URL_PATH={MEDIA_ACKNOWLEDGEMENT:"/call/mediaAcknowledgement/",MEDIA_REJECTION:"/call/rejection/",ACKNOWLEDGEMENT:"/call/acknowledgement/",MEDIA_RENEGOTIATION:"/call/mediaRenegotiation/",REPLACE:"/call/replacement/",PROGRESS:"/call/progress/",MEDIA_ANSWER:"/call/mediaAnswer/",NEW_MEDIA_OFFER:"/call/newMediaOffer/",REDIRECTION:"/call/redirection/",BALANCE_UPDATE:"/call/balanceUpdate/",ACCEPT:"/call/acceptance/",CONTROL_VIDEO_STREAMING:"/call/controlVideoStreaming/",DOMINANT_SPEAKER_INFO:"/call/dominantSpeakerInfo/",CSRC_INFO:"/call/csrcInfo/",END:"/call/end/",RETARGET_COMPLETION:"/call/retargetCompletion/",TRANSFER:"/call/transfer/",TRANSFER_ACCEPTANCE:"/call/transferAcceptance/",TRANSFER_COMPLETION:"/call/transferCompletion/",CONV_END:"/conversation/end/",CONV_UPDATE:"/conversation/update/",CONV_ROSTER_UPDATE:"/conversation/rosterUpdate/",CONV_ADD_PARTICIPANT_SUCCESS:"/conversation/addParticipantSuccess/",CONV_ADD_PARTICIPANT_FAILURE:"/conversation/addParticipantFailure/",CONV_NUDGE_PARTICIPANT_SUCCESS:"/conversation/nudgeParticipantSuccess/",CONV_NUDGE_PARTICIPANT_FAILURE:"/conversation/nudgeParticipantFailure/",CONV_ADMIT_PARTICIPANT_SUCCESS:"/conversation/admitParticipantSuccess/",CONV_ADMIT_PARTICIPANT_FAILURE:"/conversation/admitParticipantFailure/",CONV_REMOVE_PARTICIPANT_SUCCESS:"/conversation/removeParticipantSuccess/",CONV_REMOVE_PARTICIPANT_FAILURE:"/conversation/removeParticipantFailure/",CONV_ADD_MODALITY_SUCCESS:"/conversation/addModalitySuccess/",CONV_ADD_MODALITY_FAILURE:"/conversation/addModalityFailure/",CONV_CONTENT_SHARING_UPDATE:"/conversation/contentSharingUpdate/",CONV_CONTENT_SHARING_END:"/conversation/contentSharingEnd/",CONV_LIGHT_WEIGHT_MEETING_UPDATE:"/conversation/lightWeightMeetingUpdate/",CONV_LIGHT_WEIGHT_MEETING_END:"/conversation/lightWeightMeetingEnd/",CONV_BROADCAST_UPDATE:"/conversation/broadcastUpdate/",CONV_CONFIRM_UNMUTE:"/conversation/confirmUnmute/",CONV_UNMUTE_SUCCESS:"/conversation/unmuteSuccess/",CONV_UNMUTE_FAILURE:"/conversation/unmuteFailure/"},t.PAYLOAD_PROPERTY={CALL_NOTIFICATION:"callNotification",MEDIA_ANSWER:"mediaAnswer",MEDIA_ACKNOWLEDGEMENT:"mediaAcknowledgement",CALL_ACCEPTANCE:"callAcceptance",CALL_END:"callEnd",CALL_PROGRESS:"callProgress",CALL_ACCEPTANCE_ACKNOWLEDGEMENT:"callAcceptanceAcknowledgement",MEDIA_NEGOTIATION:"mediaNegotiation",MEDIA_NEGOTIATION_FAILURE:"mediaNegotiationFailure",BALANCE_UPDATE:"balanceUpdate",RETARGET_COMPLETED:"retargetCompleted",CALL_TRANSFER:"callTransfer",TRANSFER_COMPLETION:"transferCompletion",TRANSFER_ACCEPTANCE:"transferAcceptance"},t.__esModule=!0,t.default={INCOMING_MESSAGE_ORIGIN:{TROUTER:"Trouter",BROKER:"Broker"},INVITATION_TYPE:{NUDGE:"nudge"},KNOWN_PAYLOAD_ENCODINGS:{GZIP:!0},WEBRTC_NOTIFICATION_TYPE:{CONTROL_VIDEO_STREAMING:"ControlVideoStreaming",DOMINANT_SPEAKER_INFO:"DominantSpeakerInfo",CSRC_INFO:"CsrcInfo"},PARTICIPANT_AUDIO_STATE:{CONNECTING:"Connecting",RINGING:"Ringing",CONNECTED:"Connected",OTHER:"Other"},HEADERS:{MESSAGE_ID:"X-Microsoft-Skype-Message-ID",ORIGINAL_MESSAGE_ID:"X-Microsoft-Skype-Original-Message-ID",CONTENT_ENCODING:"X-Microsoft-Skype-Content-Encoding",CORRELATION_ID:"X-Microsoft-Skype-Chain-ID",CONTENT_SHARING_CORRELATION_ID:"X-Microsoft-Skype-ContentSharing-Chain-ID",CLIENT_USER_AGENT:"X-Microsoft-Skype-Client",SKYPE_TOKEN:"X-Skypetoken",CACHE_SKYPE_TOKEN:"X-CacheSkypeToken",BROKER_USE_BATCHING_HEADER_NAME:"X-UseBatching",CONTENT_TYPE:"Content-Type"},KNOWN_BOTS:{VOICEMAIL_BOT_ID:"28:14524421-25b4-403a-a0f7-e62d4379cabc"},HTTP_STATUS_CODES:{OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,PRECONDITION_FAILED:412,UNPROCESSABLE_ENTITY:422,INTERNAL_SERVER_ERROR:500,CONFLICT:409},CALL_END_SKYPE_TOKEN_ERROR:{code:495,subCode:4507,phrase:"CallEndReasonSkypeTokenFetchError"},CALL_END_LOCAL_HTTP_STACK_ERROR:{code:496,subCode:4520,phrase:"LocalHTTPStackError"},CALL_END_UNKNOWN_ERROR:{code:497,subCode:4502,phrase:"CallEndReasonUnknownError"},CALL_END_NETWORK_ERROR:{code:490,subCode:4502,phrase:"CallEndReasonNetworkError"},CALL_END_LOCAL_DECLINE:{code:486,subCode:4508,phrase:"LocalDecline"},RESOURCE_NOT_FOUND_ERROR:{code:404,subCode:404,phrase:"ResourceNotFound"},CALL_STATUS:{IDLE:"Idle",RINGING:"Ringing",CONNECTING:"Connecting",CONNECTED:"Connected",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly",LOCAL_TERMINATED:"LocalTerminated",REMOTE_TERMINATED:"RemoteTerminated"},MEDIA_TYPES:{AUDIO:"Audio",VIDEO:"Video",SCREEN_SHARER:"ScreenSharer",SCREEN_VIEWER:"ScreenViewer"},MUTE_SCOPE:{MYSELF:"Myself",EVERYONE_ELSE:"EveryoneElse",SPECIFIED_PARTICIPANTS:"SpecifiedParticipants"},URL_BASE:{CALLAGENT:"callAgent"},LINKS:{HANGUP:"hangup",MEDIA_REJECTION:"mediaRejection",MEDIA_ANSWER:"mediaAnswer",MEDIA_RENEGOTIATION:"mediaRenegotiation",ACCEPT:"accept",ATTACH:"attach",REJECT:"reject",REDIRECT:"redirect",REPLACE:"replace",TRANSFER:"transfer",NEW_OFFER:"newOffer",TRANSFER_ACCEPTANCE:"transferAcceptance",TRANSFER_COMPLETION:"transferCompletion",CONVERSATION_CONTROLLER:"conversationController",ADD_PARTICIPANT:"addParticipant",ADD_PARTICIPANT_AND_MODALITY:"addParticipantAndModality",LEAVE:"leave",NOTIFICATION_LINKS:"notificationLinks",REMOVE_PARTICIPANT:"removeParticipant",KEEPALIVE:"keepAlive",ADD_MODALITY:"AddModality",REMOVE_MODALITY:"RemoveModality",CONTENT_SHARING_CONTROLLER:"contentSharingController",CONTENT_SHARING_TAKE_CONTROL:"contentSharingTakeControl",CONTENT_SHARING_UPDATE_SESSION_STATE:"contentSharingUpdateSessionState",CONTENT_SHARING_UPDATE_PARTICIPANT_STATE:"contentSharingUpdateParticipantState",CONTENT_SHARING_NOTIFICATION_LINKS:"contentSharingNotificationLinks",CONTENT_SHARING_LEAVE:"contentSharingLeave",LIGHT_WEIGHT_MEETING_CONTROLLER:"lightWeightMeetingController",MUTE:"mute",UNMUTE:"unmute",ADMIT:"admit",CONTROL_VIDEO_STREAMING:"controlVideoStreaming",UPDATE_ENDPOINT_STATE:"updateEndpointState",UPDATE_ENDPOINT_METADATA:"updateEndpointMetadata"},CONTENT_TYPE:{JSON:"application/json",SDP:"application/sdp"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:"conversation",LOBBY_CALL_CONTROLLER:"lobby"},SIGNALING_FSM_STATE:{IDLE:"Idle",INCOMING:"Incoming",WAITING_CALL_ACCEPTANCE_ACK:"WaitingCallAcceptanceAck",OUTGOING:"Outgoing",CONNECTED:"Connected",OUTGOING_FOR_ROSTER_ONLY:"OutgoingForRosterOnly",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:"Idle",CALL_CONNECTED:"Connected",INCOMING_RENEGOTIATION:"IncomingRenegotiation",OUTGOING_RENEGOTIATION:"OutgoingRenegotiation",RENEGOTIATION_GLARE:"RenegotiationGlare"},CONTENT_SHARING_FSM_STATE:{IDLE:"Idle",CONTENT_SHARING_START_INITIATED:"ContentSharingStartInitiated",CONTENT_SHARING_JOIN_INITIATED:"ContentSharingJoinInitiated",CONTENT_SHARING_LEAVE_INITIATED:"ContentSharingLeaveInitiated",CONTENT_SHARING_DELETE_INITIATED:"ContentSharingDeleteInitiated",CONTENT_SHARING_CONNECTED:"ContentSharingConnected"},LIGHT_WEIGHT_MEETING_FSM_STATE:{IDLE:"Idle",LIGHT_WEIGHT_MEETING_JOIN_INITIATED:"LightWeightMeetingJoinInitiated",LIGHT_WEIGHT_MEETING_CONNECTING:"LightWeightMeetingConnecting",LIGHT_WEIGHT_MEETING_CONNECTED:"LightWeightMeetingConnected"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:"AddParticipant",NUDGE_PARTICIPANT:"NudgeParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",CALL_ME_BACK:"CallMeBack",INCOMING_CALL_ESTABLISHMENT:"IncomingCallEstablishment",OUTGOING_CALL_ESTABLISHMENT:"OutgoingCallEstablishment",MEDIA_ANSWER:"MediaAnswer",MEDIA_ANSWER_ACKNOWLEDGEMENT:"MediaAnswerAcknowledgement",ADD_MODALITY:"AddModality",UNMUTE:"Unmute",LIGHT_WEIGHT_MEETING_JOIN:"LightWeightMeetingJoin"},TIMEOUT_VALUES_IN_SECONDS:{ADD_PARTICIPANT_TIMEOUT:130,REMOVE_PARTICIPANT_TIMEOUT:60,INCOMING_CALL_ESTABLISHMENT_TIMEOUT:75,OUTGOING_CALL_ESTABLISHMENT_TIMEOUT:90,MEDIA_ANSWER_TIMEOUT:35,MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT:15,ADD_MODALITY_TIMEOUT:65,UNMUTE_TIMEOUT:35,LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT:45,ADMIT_PARTICIPANT_TIMEOUT:30},CALL_END_CODE:{REJECT:603,SUCCESS:0,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CONF_PARTICIPANT_COUNT_LIMIT_REACHED:413,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,ATC_CONTROLLER_FAILURE:581,GLARE_ERROR:491,NOT_FOUND:404,SKYPE_TOKEN_ERROR:495,LOCAL_HTTP_STACK_ERROR:496,DECODING_FAILED:407},CALL_END_SUB_CODE:{SUCCESS:0,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,SKYPE_TOKEN_ERROR:4507,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,UNMUTE_REQUEST_TIMEOUT:4509,UNMUTE_REQUEST_REJECTED:4510,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,GLARE_ERROR:10029,CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:5014,UNABLE_TO_GENERATE_MEETUP_ID:5015,CALL_ENDED_BY_PLATFORM_AGENT:7e3,LOCAL_HTTP_STACK_ERROR:4520,BEACON:4521,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110,MEDIA_OFFER_PROCESSING_ERROR:3111,LIGHTWEIGHTMEETING_JOIN_FAILED:3200,LIGHTWEIGHTMEETING_JOIN_TIMEOUT:3201,LIGHTWEIGHTMEETING_START_CALL_FAILED:3202},CALL_END_PHRASE:{UNKNOWN:"CallEndReasonUnknown",MEDIA_ERROR:"CallEndReasonMediaError",MEDIA_OFFER_TIMEOUT:"CallEndReasonMediaOfferTimeout",MEDIA_FINAL_ANSWER_TIMEOUT:"CallEndReasonMediaFinalAnswerTimeout",MEDIA_ANSWER_ERROR:"CallEndReasonMediaAnswerError",MEDIA_FINAL_ANSWER_ERROR:"CallEndReasonFinalAnswerError",MEDIA_PERMISSION_ERROR:"CallEndReasonMediaPermissionError",MEDIA_RENEGOTIATION_ERROR:"CallEndReasonRenegotiationError",MEDIA_DROP_DURING_CONNECT:"CallEndReasonMediaDropDuringConnectError",MEDIA_DROP_AFTER_CONNECT:"CallEndReasonMediaDropAfterConnectError",MEDIA_OFFER_PROCESSING_ERROR:"CallEndReasonMediaOfferProcessingError",AUDIO_ERROR:"CallEndReasonAudioDeviceError",BAD_NOTIFICATION_PAYLOAD:"BadCallNotificationPayload",NETWORK_ERROR:"CallEndReasonNetworkError",LOCAL_USER_INITIATED:"CallEndReasonLocalUserInitiated",REMOTE_USER_INITIATED:"CallEndReasonRemoteUserInitiated",ESTABLISHMENT_TIMEOUT:"CallEndReasonEstablishmentTimeout",PARTICIPANT_REMOVAL_TIMEOUT:"CallParticipantRemovalTimeout",LOCAL_ERROR:"CallEndReasonLocalError",CALL_UPDATE_ERROR:"CallEndReasonCallUpdateError",P2P_FORK_CONNECTED:"CallEndReasonP2pForkConnected",P2P_FORK_FORWARDED:"CallEndReasonP2pForkForwarded",P2P_FORK_FORWARDED_TO_VOICEMAIL:"CallEndReasonP2pForkForwardedToVoiceMail",P2P_FALLBACK_FOR_SCREENSHARING:"CallEndReasonP2pFallbackForScreensharing",P2P_FALLBACK_FOR_GROUPCALL:"CallEndReasonP2pFallbackForGroupCall",P2P_FALLBACK_FOR_CALL_ASSIMILATION:"CallEndReasonP2pFallbackForCallAssimilation",P2P_FALLBACK_FOR_TRANSLATION:"CallEndReasonP2pFallbackForCallTranslation",P2P_FORK_REJECTED:"CallEndReasonP2pForkRejected",TROUTER_CONNECTION_DROPPED:"CallEndReasonTrouterConnectionDropped",REMOVED_FROM_CALL:"CallEndReasonRemovedFromCall",TRANSFER_COMPLETION_TIMEOUT:"CallEndReasonTransferCompletionTimeout",CALL_DOES_NOT_EXIST:"CallEndReasonCallDoesNotExist",ATTACH_ACTION_FAILED:"CallEndReasonAttachActionFailed",ATTACH_FAILED:"CallEndReasonAttachFailed",CONVERSATION_ESTABLISHMENT_FAILED:"CallEndReasonConversationEstablishmentFailed",CONV_END_FROM_SERVICE:"CallEndReasonConversationEndReceivedFromService",CONV_END_FROM_SERVICE_WITH_ERROR:"CallEndReasonConversationEndReceivedFromServiceWithError",SERVICE_ERROR:"CallEndReasonServiceError",CONFLICT:"CallEndReasonConflict",CALL_ALREADY_IN_P2P:"CallEndReasonCallAlreadyExistsInP2p",CONV_END_NO_MODALITY:"ConversationEndNoModalityConnected",CONV_END_FOR_ALL_INITIATED:"ConversationEndForAllInitiated",RENEGOTIATION_IN_PROGRESS:"NegotiationIsInProgress",ADD_PARTICIPANT_URL_MISSING:"AddParticipantUrlMissing",ADMIT_PARTICIPANT_URL_MISSING:"AdmitParticipantUrlMissing",UNABLE_TO_GENERATE_MEETUP_ID:"Unable to generate GroupChat meetup id.",ENDED_BY_PMA:"Call ended by media agent.",OWNERSHIP_RESOLUTION_CONFLICT:"Conversation cannot be created due to a failure to resolve ownership.",CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:"This conversation has ended since we were unable to determine a potential host for the group call.",UNMUTE_REQUEST_TIMEOUT:"UnmuteRequestTimeout",UNMUTE_REQUEST_REJECTED:"UnmuteRequestRejected",LIGHT_WEIGHT_MEETING_JOIN_FAILED:"LightWeightMeetingJoinFailed",LIGHT_WEIGHT_MEETING_END_RECEIVED_FROM_SERVICE:"LightWeightMeetingEndReasonEndReceivedFromService",LIGHT_WEIGHT_MEETING_TIMEOUT:"LightWeightMeetingTimeout",LIGHT_WEIGHT_MEETING_START_FAILED:"LightWeightMeetingStartFailed"}}},function(e,t,n){"use strict";var i=n(3);function r(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}t.forOwn=r,t.forOwnRec=function e(t,n){for(var i in t)t.hasOwnProperty(i)&&("object"==typeof t[i]?e(t[i],n):n(t[i],i,t))},t.average=function(e){var t=0;return e.forEach(function(e){return t+=e}),t/=e.length},t.find=function(e,t){var n;return e.some(function(i,r){return!!t(i,r,e)&&(n=i,!0)}),n},t.findIndex=function(e,t){var n;return e.some(function(i,r){return!!t(i,r,e)&&(n=r,!0)}),n},t.remove=function(e,t){for(var n=!1,i=e.length;i-- >0;)t(e[i],i,e)&&(e.splice(i,1),n=!0);return n},t.values=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},t.assign=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},t.isEmpty=function(e){return!Object.keys(e).length},t.shallowClone=function(e){var t={};return r(e,function(e,n){t[n]=e}),t},t.deepClone=function e(t){var n;if(!t||"object"!=typeof t)return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var i=0,o=t.length;i<o;i++)n[i]=e(t[i]);return n}if(t instanceof Object)return n={},r(t,function(t,i){n[i]=e(t)}),n;throw new Error("Unable to copy: "+t)},t.uniqueId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+e()+"4"+e().substring(1)+"b"+e().substring(1)+e()+e()+e()},t.deepEqual=function e(t,n){var i,r=typeof t,o=typeof n;if(t===n)return!0;if(r!==o||"object"!==r&&"function"!==r)return!1;if(null===t||null===n)return t===n;if(t instanceof Date&&n instanceof Date)return+t==+n;if(t instanceof Map&&n instanceof Map)return function(e,t){var n;if(e.size!==t.size)return!1;var i=!0;return e.forEach(function(e,r){((n=t.get(r))!==e||void 0===n&&!t.has(r))&&(i=!1)}),i}(t,n);for(i in t)if(!(i in n&&e(t[i],n[i])))return!1;for(i in n)if(!(i in t&&e(t[i],n[i])))return!1;return!0},t.weakCompareObject=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},t.getMaxSubstring=function(e,t){return t.reduce(function(t,n){var i=e.includes(n)?n.length:0;return t.length<i?n:t},"")},t.throwIfNotSupported=function(e,t){if(-1===t.indexOf(e)){var n=new Error(e+" mediaContent.contentType is not supported");throw n.name=i.default.MEDIA_ERROR.incompatibleOffer,n}},t.noop=Function.prototype,t.mapToString=function(e){var t={};return e.forEach(function(e,n){t[n.toString()]=e}),JSON.stringify(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MEDIA_STATE:{send:"sendonly",receive:"recvonly",sendReceive:"sendrecv",inactive:"inactive"},MEDIA_DEVICE_KIND:{audioInput:"audioinput",audioOutput:"audiooutput",videoInput:"videoinput"},MEDIA_DEVICE:{camera:"camera",microphone:"microphone",speaker:"speaker",defaultId:"default",communicationsId:"communications",defaultDeviceLabel:"Default"},MEDIA_ERROR:{constraintNotSatisfiedError:"ConstraintNotSatisfiedError",iceConnectionError:"iceConnectionError",srtpError:"srtpError",permissionDeniedError:"permissionDeniedError",internalError:"internalError",sourceUnavailableError:"SourceUnavailableError",devicesNotFoundError:"DevicesNotFoundError",noDeviceSelected:"noDeviceSelected",noNetworkError:"noNetworkError",incompatibleOffer:"IncompatibleOffer",mediaStreamRequestError:"MediaStreamRequestError",extensionNotFoundError:"ExtensionNotFoundError",sharingCancelledError:"SharingCancelledError",chromeRuntimeNotDefinedError:"ChromeRuntimeNotDefinedError"},RENEGOTIATION_ERROR:{local:"local",glare:"glare",signaling:"signaling",media:"media",escalation:"escalation"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:"main-audio",video:"main-video",sharing:"applicationsharing-video",data:"data"},MEDIA_TYPE:{audio:"audio",video:"video",data:"x-data"},MODALITY:{audio:"audio",video:"video",sharing:"sharing",data:"data"},ICE_TRANSPORT_POLICY:{all:"all",relay:"relay"},EXTENSION_TYPE:{dominantSpeakerHistory:"dominantSpeakerHistory",videoStreamControl:"videoStreamControl"},RENDERER_TYPE:{video:"video",sharing:"sharing"},CONTENT_TYPE:{SDP:"application/sdp"},ALLOWED_CONTENT_TYPES:{SDP_ONLY:["application/sdp"],SDP_NGC:["application/sdp","application/sdp-ngc-0.5","application/sdp-ngc-1.0"]},STREAMING_STATE:{created:"created",started:"started",active:"active",inactive:"inactive",stopped:"stopped",removed:"removed",failed:"failed"},DISPLAY_SOURCE_ID:"display"}},function(e,t,n){"use strict";var i=n(0),r=n(1);t.get=function(e,t){return i.assertNotNullOrEmpty(t,"trailingPath cannot be null"),i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(e.baseMessagingChannelUrl,"messaging channel url is not set"),e.baseMessagingChannelUrl+r.default.URL_BASE.CALLAGENT+"/"+e.sessionId+t},t.getIdFromUrl=function(e){var t=e.match(new RegExp("/"+i.escapeRegExp(r.default.URL_BASE.CALLAGENT)+"/+([^/]+)","i"));return t?t[1]:null}},function(e,t,n){"use strict";var i=void 0;if("undefined"!=typeof window&&"undefined"!=typeof navigator&&(i=window,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.attachMediaStream=function(e,t){void 0!==e.srcObject?e.srcObject=t:void 0!==e.src&&(e.src=window.URL.createObjectURL(t))},window.detachMediaStream=function(e){if(void 0!==e.srcObject)e.srcObject=null;else if(void 0!==e.src&&e.src){var t=e.src;e.src="",window.URL.revokeObjectURL(t)}},void 0!==navigator.mozGetUserMedia&&void 0!==window.mozRTCPeerConnection?navigator.getUserMedia=function(e,t,n){return navigator.mediaDevices.getUserMedia(e).then(t).catch(n)}:void 0!==navigator.webkitGetUserMedia&&"undefined"!=typeof webkitRTCPeerConnection&&(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=function(e,t,n){var i=function(e){e&&e.deviceId&&e.deviceId.exact&&(e.mandatory||(e.mandatory={}),e.mandatory.sourceId=e.deviceId.exact,delete e.deviceId)};return e&&(i(e.audio),i(e.video)),navigator.webkitGetUserMedia(e,t,n)}),"undefined"!=typeof RTCIceGatherer)){var r=function(){return Promise.resolve()};RTCRtpSender.prototype.getStats||(RTCRtpSender.prototype.getStats=r),RTCRtpSender.prototype.msGetStats||(RTCRtpSender.prototype.msGetStats=r),RTCRtpReceiver.prototype.getStats||(RTCRtpReceiver.prototype.getStats=r),RTCRtpReceiver.prototype.msGetStats||(RTCRtpReceiver.prototype.msGetStats=r),RTCIceTransport.prototype.getStats||(RTCIceTransport.prototype.getStats=r),RTCIceTransport.prototype.msGetStats||(RTCIceTransport.prototype.msGetStats=r),RTCRtpReceiver.prototype.getContributingSources||(RTCRtpReceiver.prototype.getContributingSources=function(){return[]}),RTCRtpReceiver.prototype.requestSendCSRC||(RTCRtpReceiver.prototype.requestSendCSRC=function(){})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={window:i}},function(t,n){t.exports=e},function(e,t,n){"use strict";t.EVENTS={HANDLE_MEDIA_ACKNOWLEDGEMENT:"HandleMediaAcknowledgement",HANDLE_MEDIA_NEGOTIATION_FAILURE:"HandleMediaNegotiationFailure",HANDLE_MEDIA_ANSWER:"HandleMediaAnswer",HANDLE_MEDIA_ANSWER_FAILED:"HandleMediaAnswerFailed",HANDLE_MEDIA_OFFER:"HandleMediaOffer",REJECT_RENEGOTIATION:"RejectRenegotiation",HANDLE_RETARGET_COMPLETED:"HandleRetargetCompleted",HANDLE_MEDIA_ANSWER_TIMEOUT:"HandleMediaAnswerTimeout",HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT:"HandleMediaAcknowledgementTimeout",ACCEPT_RENEGOTIATION:"AcceptRenegotiation",START_RENEGOTIATION:"StartRenegotiation",ADD_MODALITY_TIMEOUT:"AddModalityTimeout",ADD_PARTICIPANT:"AddParticipant",ADD_PARTICIPANT_TIMEOUT:"AddParticipantTimeout",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT_PARTICIPANT_TIMEOUT:"AdmitParticipantTimeout",CALL_ME_BACK:"CallMeBack",CALL_ME_BACK_TIMEOUT:"CallMeBackTimeout",REMOVE_PARTICIPANT:"RemoveParticipant",REMOVE_PARTICIPANT_TIMEOUT:"RemoveParticipantTimeout",HANDLE_ADD_PARTICIPANT_SUCCESS:"HandleAddParticipantSuccess",HANDLE_ADD_PARTICIPANT_FAILURE:"HandleAddParticipantFailure",HANDLE_ADMIT_PARTICIPANT_SUCCESS:"HandleAdmitParticipantSuccess",HANDLE_ADMIT_PARTICIPANT_FAILURE:"HandleAdmitParticipantFailure",HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE:"HandleAddParticipantModalityFailure",HANDLE_REMOVE_PARTICIPANT_SUCCESS:"HandleRemoveParticipantSuccess",HANDLE_REMOVE_PARTICIPANT_FAILURE:"HandleRemoveParticipantFailure",HANDLE_ROSTER_UPDATE:"HandleRosterUpdate",HANDLE_CONVERSATION_UPDATE:"HandleConversationUpdate",SET_SUBJECT:"SetSubject",GET_MEETING_INFO:"GetMeetingInfo",GET_EMERGENCY_CONTENT:"GetEmergencyContent",SET_MULTIPARTY:"SetMultiparty",SET_THREADID:"SetThreadId",SET_CALLOPTIONS:"SetCallOptions",SET_TRANSFER_CONTEXT:"SetTransferContext",START_CALL:"StartCall",JOIN_CALL:"JoinCall",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",HANDLE_INCOMING_CALL:"HandleIncomingCall",END_CALL:"EndCall",END_WITH_BEACON:"EndWithBeacon",CONFLICTED_CALL:"ConflictedCall",SET_PROVISIONAL_ANSWER:"SetProvisionalAnswer",SET_PROVISIONAL_ANSWER_FAILED:"SetProvisionalAnswerFailed",ACCEPT_CALL:"AcceptCall",HANDLE_CALL_ACCEPTANCE_ACK:"HandleCallAcceptanceAck",HANDLE_CALL_ACCEPTANCE:"HandleCallAcceptance",HANDLE_CALL_ACCEPTANCE_SYNC:"HandleCallAcceptanceSync",HANDLE_CALL_ACCEPTANCE_FAILED:"HandleCallAcceptanceFailed",HANDLE_CALL_ESTABLISHMENT_TIMEOUT:"HandleCallEstablishmentTimeout",HANDLE_CALL_END:"HandleCallEnd",HANDLE_CALL_PROGRESS:"HandleCallProgress",TROUTER_URL_CHANGED:"TrouterUrlChanged",TROUTER_STATE_CHANGED:"TrouterStateChanged",TROUTER_URL_CHANGED_TO_INVALID:"TrouterUrlChangedToInvalid",TROUTER_URL_UPDATE_FAILED:"TrouterUrlUpdateFailed",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",ACCEPTED_BEFORE_RINGING:"AcceptedBeforeRinging",LEAVE_CONTENT_SHARING:"LeaveContentSharing",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",JOIN_CONTENT_SHARING:"JoinContentSharing",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",HANDLE_CONTENT_SHARING_UPDATE:"HandleContentSharingUpdate",HANDLE_CONTENT_SHARING_END:"HandleContentSharingEnd",CONTENT_SHARING_START_FROM_ROSTER:"ContentSharingStartFromRoster",CONTENT_SHARING_END_FROM_ROSTER:"ContentSharingEndFromRoster",HANDLE_ADD_MODALITY_SUCCESS:"HandleAddModalitySuccess",HANDLE_ADD_MODALITY_FAILURE:"HandleAddModalityFailure",START_LIGHT_WEIGHT_MEETING:"StartLightWeightMeeting",JOIN_LIGHT_WEIGHT_MEETING:"JoinLightWeightMeeting",HANDLE_LIGHT_WEIGHT_MEETING_UPDATE:"HandleLightWeightMeetingUpdate",HANDLE_LIGHT_WEIGHT_MEETING_END:"HandleLightWeightMeetingEnd",HANDLE_LIGHT_WEIGHT_MEETING_UPDATE_FAILURE:"HandleLightWeightMeetingUpdateFailure",HANDLE_LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT:"HandleLightWeightMeetingJoinTimeout",UPDATE_BROADCAST_DETAILS:"UpdateBroadcastDetails",MUTE:"Mute",NUDGE_PARTICIPANT_TIMEOUT:"NudgeParticipantTimeout",UNMUTE:"Unmute",UNMUTE_TIMEOUT:"UnmuteTimeout",HANDLE_UNMUTE_CONFIRM:"HandleUnmuteConfirm",HANDLE_UNMUTE_SUCCESS:"HandleUnmuteSuccess",HANDLE_UNMUTE_FAILURE:"HandleUnmuteFailure",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",HANDLE_CONTROL_VIDEO_STREAMING:"HandleControlVideoStreaming",HANDLE_DOMINANT_SPEAKER_INFO:"HandleDominantSpeakerInfo",HANDLE_CSRC_INFO:"HandleCsrcInfo",SEND_WEBRTC_MEDIA_NOTIFICATION:"SendWebRtcMediaNotification",HANDLE_BALANCE_UPDATE:"HandleBalanceUpdate",TRANSFER_CALL:"TransferCall",PARK_CALL:"ParkCall",HANDLE_TRANSFER_ACCEPTANCE:"HandleTransferAcceptance",HANDLE_TRANSFER_ACCEPTANCE_FAILED:"HandleTransferAcceptanceFailed",HANDLE_TRANSFER_COMPLETION:"HandleTransferCompletion",HANDLE_TRANSFER_COMPLETION_FAILED:"HandleTransferCompletionFailed",HANDLE_TRANSFER_REQUESTED:"HandleTransferRequested",HANDLE_PARK_REQUESTED:"HandleParkRequested",HANDLE_CALL_TRANSFER_TIMEOUT:"HandleCallTransferTimeout",DUPLICATE_MESSAGE_IGNORED:"DuplicateMessageIgnored",CORRELATION_ID_UPDATED:"CorrelationIdUpdated",UNKNOWN_MESSAGE_TYPE:"UnkownMessageType",FAILED_TO_HANDLE_MESSAGE:"FailedToHandleMessage",TROUTER_DECODE_PAYLOAD_FAILURE:"TrouterDecodePayloadFailure",UPDATE_ENDPOINT_STATE:"UpdateEndpointState",BROKER_DECODE_PAYLOAD_FAILURE:"BrokerDecodePayloadFailure",BROKER_SUBSCRIPTION_TIMEOUT:"BrokerSubscriptionTimeout",BROKER_SUBSCRIPTION_SUCCESSFUL:"BrokerSubscriptionSuccessful",BROKER_SUBSCRIPTION_FAILED:"BrokerSubscriptionFailed",FAILED_TO_HANDLE_TROUTER_MESSAGE:"FailedToHandleTrouterMessage",FAILED_TO_HANDLE_BROKER_MESSAGE:"FailedToHandleBrokerMessage",BROKER_DISABLED_SUBSCRIBE_URL_PRESENT:"BrokerDisabledSubscribeUrlPresent",CONNECTED:"Connected",IN_LOBBY:"InLobby",MESSAGE_MISSING_BODY:"MessageMissingBody",BROADCAST_STATE_CHANGED:"BroadcastStateChanged",HANDLE_CALL_NOTIFICATION:"HandleCallNotification",HANDLE_INCOMING_CALL_REPLACEMENT:"HandleIncomingCallReplacement",HANDLE_PSTN_BALANCE_UPDATE:"HandlePstnBalanceUpdate",IGNORE_OLD_ROSTER:"IgnoreOldRoster",HANDLE_MEDIA_ACK:"HandleMediaAck",HANDLE_MEDIA_PROVISIONAL_ACK:"HandleMediaProvisionalAck",UPDATE_CALL_STATUS:"UpdateCallStatus",SEND_ATTACH:"SendAttach",REQUEST_NEW_OFFER:"RequestNewOffer",HANDLE_NEW_OFFER:"HandleNewOffer",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",UPDATE_CONVERSATION_LINKS_SUCCESS:"UpdateConversationLinksSuccess",UPDATE_CONVERSATION_LINKS_FAILED:"UpdateConversationLinksFailed",PROCESS_INITIAL_OFFER:"ProcessInitialOffer",SEND_PROGRESS:"SendProgress",SEND_PROGRESS_FAILED:"SendProgressFailed",PROCESS_CALL_ACCEPTANCE:"ProcessCallAcceptance",ACCEPTANCE_USER_IN_LOBBY:"AcceptanceUserInLobby",REJECT_INCOMING_CALL:"RejectIncomingCall",SEND_KEEP_ALIVE:"SendKeepAlive",SEND_KEEP_ALIVE_FAILED:"SendKeepAliveFailed"},t.NETWORK_REQUESTS={SEND_MEDIA_ANSWER:"SendMediaAnswer",START_RENEGOTIATION:"StartRenegotiation",SEND_MEDIA_ACKNOWLEDGEMENT:"SendMediaAcknowledgement",SEND_MEDIA_REJECTION:"SendMediaRejection",ADD_PARTICIPANT:"AddParticipant",NUDGE_PARTICIPANT:"NudgeParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",BROKER_SUBSCRIBE:"BrokerSubscribe",CALL_ME_BACK:"CallMeBack",SEND_ACCEPTANCE:"SendAcceptance",SEND_ACCEPTANCE_ACKNOWLEDGEMENT:"SendAcceptanceAcknowledgement",END_CALL:"EndCall",CANCEL_CALL:"CancelCall",REJECT_CALL:"RejectCall",JOIN_CONVERSATION:"JoinConversation",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",LEAVE_CONVERSATION:"LeaveConversation",DELETE_CONVERSATION:"DeleteConversation",PLACE_CALL:"PlaceCall",PLACE_NUDGE_CALL:"PlaceNudgeCall",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",SEND_CALL_ATTACH:"SendCallAttach",SEND_CALL_PROGRESS:"SendCallProgress",SEND_KEEP_ALIVE:"SendKeepAlive",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",PLACE_LIGHT_WEIGHT_MEETING_CALL:"PlaceLightWeightMeetingCall",JOIN_CONTENT_SHARING:"JoinContentSharing",JOIN_LIGHT_WEIGHT_MEETING:"JoinLightWeightMeeting",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS:"UpdateContentSharingNotificationLinks",MUTE:"Mute",UNMUTE:"Unmute",SEND_CONTROL_VIDEO_STREAMING:"SendControlVideoStreaming",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",SEND_TRANSFER_REQUEST:"SendTransferRequest",SEND_PARK_REQUEST:"SendParkRequest",TRANSFER_ACCEPTANCE:"TransferAcceptance",TRANSFER_COMPLETION:"TransferCompletion",UPDATE_ENDPOINT_STATE:"UpdateEndpointState",REQUEST_NEW_OFFER:"RequestNewOffer",UPDATE_ENDPOINT_METADATA:"UpdateEndpointMetadata"};t.__esModule=!0,t.default={EVENT_SOURCE:{TROUTER:"Trouter",BROKER:"Broker",UDP:"UDP",LOCAL:"Local"},SOURCE:{NGC_SOURCE:"SkypeConcore"},EVENT_TYPE:{CONVERSATION_CALL_MODALITY:"skypecosi_concore_web_csa_conversation_callmodality",CONVERSATION_CONTENT_SHARING:"skypecosi_concore_web_csa_conversation_contentsharing",CONVERSATION_HTTP_REQUEST:"skypecosi_concore_web_csa_conversation_httprequest"},EXTENSIONS:{DATA_VERSION:"DataVersion",DIRECTION:"Direction",CONTENT_SHARING_DIRECTION:"ContentSharingDirection",CONNECTED_DURATION_IN_MS:"ConnectedDurationInMsecs",TIME_TO_RING_IN_MS:"TimeToRingInMsecs",CALL_TERMINATING_END:"CallTerminatingEnd",NETWORK_REQUESTS_PENDING:"NetworkRequestsPending",NETWORK_REQUESTS_COMPLETED:"NetworkRequestsCompleted",LOCAL_OPERATIONS_PERFORMED:"LocalOperationsPerformed",TROUTER_WAIT_OPERATIONS:"TrouterWaitOperations",CALL_START_TIME:"CallStartTime",CALL_END_TIME:"CallEndTime",IS_GROUP_CALL:"IsGroupCall",IS_HOSTLESS_CALL:"IsHostLessCall",IS_CAST_CALL:"IsCastCall",IS_MEETUP_CALL:"IsMeetupCall",IS_ON_BEHALF_OF_CALL:"IsOnBehalfOfCall",CALL_END_CODE:"Code",CALL_END_SUB_CODE:"SubCode",CONTENT_SHARING_END_CODE:"ContentSharingEndReasonServiceCode",CONTENT_SHARING_END_SUB_CODE:"ContentSharingEndReasonServiceSubCode",CONVERSATION_SERVICE_URL:"ConversationServiceUrl",CONTENT_SHARING_SERVICE_URL:"ContentSharingServiceUrl",MEETING_INFO:"MeetingInfo",RESULT_VALUE:"ResultValue",RESULT_DETAIL:"ResultDetail",RESULT_CODE:"ResultCode",LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS:"LocalOfferAnswerGenerationTimestamps",SELF_PARTICIPANT_ROLE:"SelfParticipantRole",CALLER_TYPE:"Caller_Type",CALLEE_TYPE:"Callee_Type",CALL_TYPE:"Call_Type",TEST_CONTEXT_ID:"Test_Context_Id",OUTGOING_MODALITIES:"Outgoing_Modalities",INCOMING_MODALITIES:"Incoming_Modalities",VBSS_OPERATIONS:"VBSS_Operations",CHANGING_CORRELATION_ID_NEW_ID:"ChangingCorrelationId_NewId",CHANGING_CORRELATION_ID_OLD_ID:"ChangingCorrelationId_OldId",MESSAGING_CHANNEL:"MessagingChannel",EVENT_TIMESTAMP_BAG:"EventTimestampBag",NETWORK_REQUESTS_BAG:"NetworkRequestBag",CLIENT_INFORMATION:"ClientInformation"},MESSAGING_CHANNEL:{TROUTER:"Trouter",BROKER:"Broker"},SIGNALING_CONFIG:"JsCsaConfig",SIGNALING_CONFIG_FLAGS:{BROKER_OUTGOING_ENABLED:"BrokerOutgoingEnabled",BROKER_INCOMING_ENABLED:"BrokerIncomingEnabled",BROKER_REQUEST_BATCHING_ENABLED:"BrokerRequestBatchingEnabled",BROKER_EXCLUSIVELY_ENABLED:"BrokerExclusivelyEnabled",SUPPORTS_COMPRESSED_PAYLOAD:"SupportsCompressedPayload",SYNC_TROUTER_RESPONSE:"SyncTrouterResponse",SERVER_MUTE_UNMUTE:"serverMuteUnmute",HANDLE_OFFER_FROM_NOTIFICATION:"handleMediaOfferFromPushNotification",HANDLE_NEW_OFFER_REQUEST:"handleNewOfferRequest",SEND_PROGRESS_FROM_CC:"sendProgressFromCC"},CONTEXT_ID:{CORRELATION_ID:"CorrelationId",SHARED_CORRELATION_ID:"SharedCorrelationId",SIGNALING_SESSION_ID:"SignalingSessionId",THREAD_ID:"ThreadId",TEAMS_MESSAGEID:"TeamsMessageId",TEAMS_MEETINGINFO:"TeamsMeetingInfo",ENDPOINT_ID:"EndpointId",PARTICIPANT_ID:"ParticipantId",DATA_VERSION:"DataVersion",CONTENT_SHARING_ID:"ContentSharingSessionId",CONTENT_SHARING_CORRELATION_ID:"ContentSharingCorrelationId"},CALL_TERMINATING_END:{LOCAL:"Local",REMOTE:"Remote"},RESULT_VALUE:{SUCCESS:"Success",FAILURE:"Failure"},DIRECTION:{INCOMING:"Incoming",OUTGOING:"Outgoing"},ROLE:{CALLER:"caller",CALLEE:"callee",JOIN:"join",JOIN_FOR_ROSTER_ONLY:"joinForRosterOnly",JOIN_FOR_LIGHT_WEIGHT_MEETING:"joinForLightWeightMeeting",START_FOR_LIGHT_WEIGHT_MEETING:"startForLightWeightMeeting"},VBSS_OPERATION:{START:"Start",STOP:"Stop",REJECTED:"Rejected",REMOTE_START:"RemoteStart",TIMEOUT:"Timeout",CALL_END:"CallEnd"},LOCAL_OFFER_ANSWER_OPERATIONS:{INITIAL_OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",INITIAL_OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",FINAL_ANSWER_PROCESSING_STARTED:"FinalAnswerProcessingStarted",FINAL_ANSWER_PROCESSING_ENDED:"FinalAnswerProcessingEnded",PROVISIONAL_ANSWER_PROCESSING_STARTED:"ProvisonalAnswerProcessingStarted",PROVISIONAL_ANSWER_PROCESSING_ENDED:"ProvisonalAnswerProcessingEnded",NEGOTIATION_COMPLETED:"NegotiationCompleted",INITIAL_OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",INITIAL_OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",FINAL_ANSWER_GENERATION_STARTED:"FinalAnswerGenerationStarted",FINAL_ANSWER_GENERATION_ENDED:"FinalAnswerGenerationEnded",PROVISIONAL_ANSWER_GENERATION_STARTED:"ProvisionalAnswerGenerationStarted",PROVISIONAL_ANSWER_GENERATION_ENDED:"ProvisionalAnswerGenerationEnded",RENEGOTIATION_OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",RENEGOTIATION_OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",RENEGOTIATION_ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",RENEGOTIATION_ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",RENEGOTIATION_OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",RENEGOTIATION_OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",RENEGOTIATION_ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",RENEGOTIATION_ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"},TROUTER_WAIT_OPERATION:{STARTED:"Started",ENDED:"Ended",FAILED:"Failed"}}},function(e,t,n){"use strict";var i=n(3),r=n(2);function o(e){switch(e){case i.default.MEDIA_STATE.send:return i.default.MEDIA_STATE.receive;case i.default.MEDIA_STATE.receive:return i.default.MEDIA_STATE.send;default:return e}}function a(e,t){var n=s(e)&&s(t),r=c(e)&&c(t);return n&&r?i.default.MEDIA_STATE.sendReceive:n?i.default.MEDIA_STATE.send:r?i.default.MEDIA_STATE.receive:e===i.default.MEDIA_STATE.inactive&&t||e&&t===i.default.MEDIA_STATE.inactive?i.default.MEDIA_STATE.inactive:void 0}function s(e){return e===i.default.MEDIA_STATE.send||e===i.default.MEDIA_STATE.sendReceive}function c(e){return e===i.default.MEDIA_STATE.receive||e===i.default.MEDIA_STATE.sendReceive}function l(e,t,n){var i=s(e)&&s(t)||!s(e)&&!s(n),r=c(e)&&c(t)||!c(e)&&!c(n);return i&&r}t.negotiateDirectionality=a,t.invertModalities=function(e){var t={},n=o(e.audio);n&&(t.audio=n);var i=o(e.video);i&&(t.video=i);var r=o(e.sharing);r&&(t.sharing=r);var a=o(e.data);return a&&(t.data=a),t},t.removeSendDirectionality=function(e){return e===i.default.MEDIA_STATE.sendReceive?i.default.MEDIA_STATE.receive:void 0},t.hasSendDirectionality=s,t.hasReceiveDirectionality=c,t.isOnHold=function(e){return e.audio===i.default.MEDIA_STATE.inactive},t.negotiateModalities=function(e,t){var n={},i=a(e.audio,t.audio);i&&(n.audio=i);var r=a(e.video,t.video);r&&(n.video=r);var o=a(e.sharing,t.sharing);o&&(n.sharing=o);var s=a(e.data,t.data);return s&&(n.data=s),n},t.areNegotiatedDirectionsAcceptable=function(e,t,n){return l(e.audio,t.audio,n.audio)&&l(e.video,t.video,n.video)&&l(e.sharing,t.sharing,n.sharing)},t.areNegotiatedDirectionsFulfilled=function(e,t){function n(e,t){var n=s(e)===s(t),i=c(e)===c(t);return n&&i}return n(e.audio,t.audio)&&n(e.video,t.video)&&n(e.sharing,t.sharing)},t.getSrtpInfo=function(e){var t={dtls:!1,sdes:!1};return t.dtls=!!e.fingerprint,e.media.forEach(function(e){t.dtls=t.dtls||!!e.fingerprint,t.sdes=t.sdes||!!e.crypto}),t},t.excludePassiveModalities=function(e,t,n){if(!t||r.isEmpty(t))return e;var i={};return r.forOwn(e,function(r,o){(function(e,t,n,i){if(!t[n])return!0;if(e){if(!(s(i)||e[n]&&e[n]===i))return!1}else if(t[n]===i)return!1;return!0})(n,t,o,r)&&(i[o]=e[o])}),i}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:null})},t.prototype.on=function(e,t){return this.subscribe({changed:null,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t){var n,i=this;return n=this.on(e,this._fromEventCallback(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.dispose(),i._toEventCallback(t).apply(void 0,e)}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t._raiseEventImpl.apply(t,[String(e)].concat(n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){var i;return n.on&&n.on.name===e&&(i=n.on).handler.apply(i,t)})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(91).EventSourceImpl);t.default=o},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:null})},t.prototype.on=function(e,t){return this.subscribe({changed:null,on:{name:e,handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t){var n,i=this;return n=this.on(e,this._fromEventCallback(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.dispose(),i._toEventCallback(t).apply(void 0,e)}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t._raiseEventImpl.apply(t,[e].concat(n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){return n.on&&n.on.name===e&&(i=n.on).handler.apply(i,t);var i})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(106).EventSourceImpl);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){var i;e.exports=function e(t,n,r){function o(s,c){if(!n[s]){if(!t[s]){var l="function"==typeof i&&i;if(!c&&l)return i(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return o(n||e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof i&&i,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){var t="*"===e.payload?"%s":"%d";return"rtcp-fb:"+t+" x-message %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return null!=e.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:"rtcp-mux"},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:"rtcp-rsize"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"label",reg:/^label:(\S*)/,format:"label:%s"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){var t="*"===e.payload?"%s":"%d";return"x-signaling-fb:"+t+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],2:[function(e,t,n){var i=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=i(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=i(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=e("./grammar"),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),i=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return r(c,i,a)}}),t.media=n,t};var s=function(e,t){var n=t.split("=");return 2===n.length&&(e[n[0]]=i(n[1])),e};n.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(s,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(i),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t}},{"./grammar":1}],3:[function(e,t,n){var i=e("./grammar"),r=/%[sdv%]/g,o=function(e,t,n){var i=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,o=[e+"="+i];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?o.push(n[t.name][s]):o.push(n[t.names[a]])}else o.push(n[t.name]);return function(e){var t=1,n=arguments,i=n.length;return e.replace(r,function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})}.apply(null,o)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,r=t.innerOrder||s,c=[];return n.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})}),e.media.forEach(function(e){c.push(o("m",i.m[0],e)),r.forEach(function(t){i[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})})}),c.join("\r\n")+"\r\n"}},{"./grammar":1}],"sdp-transform":[function(e,t,n){var i=e("./parser"),r=e("./writer");n.write=r,n.parse=i.parse,n.parseFmtpConfig=i.parseFmtpConfig,n.parsePayloads=i.parsePayloads,n.parseRemoteCandidates=i.parseRemoteCandidates},{"./parser":2,"./writer":3}]},{},[])("sdp-transform")},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(i)},function(e,t,n){"use strict";var i;!function(e){e[e.Pending=0]="Pending",e[e.Rejected=1]="Rejected",e[e.Resolved=2]="Resolved"}(i=t.SettablePromiseState||(t.SettablePromiseState={}));var r=function(){function e(){var e=this;this.stateInt=i.Pending,this.promiseInt=new Promise(function(t,n){e.resolveInt=t,e.rejectInt=n})}return Object.defineProperty(e.prototype,"state",{get:function(){return this.stateInt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolve",{get:function(){var e=this;return this.stateInt=i.Resolved,function(t){return e.resolveInt(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){var e=this;return this.stateInt=i.Rejected,function(t){return e.rejectInt(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this.promiseInt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPending",{get:function(){return this.stateInt==i.Pending},enumerable:!0,configurable:!0}),e}();t.SettablePromise=r},function(e,t,n){"use strict";var i=n(5);function r(){return"undefined"!=typeof RTCPeerConnection}function o(){return"undefined"!=typeof RTCIceGatherer}function a(){return!!navigator.getDisplayMedia}function s(){return!0}t.isAudioOutputSelectionSupported=function(){return void 0!==i.default.window.HTMLAudioElement.prototype.setSinkId&&!o()},t.hasWebRtc=r,t.hasOrtc=o,t.isOutgoingScreenSharingSupportedEdge=a,t.isOutgoingScreenSharingSupportedChrome=s,t.isOutgoingScreenSharingSupported=function(){return o()&&a()||r()&&!0}},function(e,t,n){"use strict";var i=n(3),r=n(2);function o(e,t,n){e.rtp&&e.rtp.some(function(i,r){var o=i.payload;if(t.name.toLowerCase()!==i.codec.toLowerCase()||t.rate!==i.rate||t.encoding!==i.encoding||t.payload&&t.payload!==i.payload)return!1;var a={rtp:i};e.fmtp=e.fmtp||[];var s=e.fmtp.some(function(e){return i.payload===e.payload&&(a.fmtp=e,!0)});e.rtcpFb=e.rtcpFb||[],a.rtcpFb=e.rtcpFb.filter(function(e){return e.payload===i.payload&&(a.rtcpFb=e,!0)});var c=a.rtcpFb.length>0;if(null===n(a))e.payloads=e.payloads.toString().split(" ").filter(function(e){return i.payload!==+e}).join(" "),e.fmtp=e.fmtp.filter(function(e){return i.payload!==e.payload}),e.rtp.splice(r,1);else{if(a.rtp.payload!==o){var l=a.rtp.payload;e.payloads=e.payloads.toString().split(" ").map(function(e){return+e===o?l:+e}).join(" "),a.fmtp&&(a.fmtp.payload=l),a.rtcpFb&&a.rtcpFb.forEach(function(e){return e.payload=l}),e.fmtp.filter(function(e){return e.config&&e.config.indexOf("apt="+o)>-1}).forEach(function(e){return e.config=e.config.replace("apt="+o,"apt="+l)})}!s&&a.fmtp&&e.fmtp.push(a.fmtp),!c&&a.rtcpFb&&a.rtcpFb.forEach(function(t){return e.rtcpFb.push(t)})}return!0})}function a(e){if(e.label){if(i.default.MEDIA_LABEL.audio===e.label)return i.default.MODALITY.audio;if(i.default.MEDIA_LABEL.video===e.label)return i.default.MODALITY.video;if(i.default.MEDIA_LABEL.sharing===e.label)return i.default.MODALITY.sharing;if(i.default.MEDIA_LABEL.data===e.label)return i.default.MODALITY.data}else{if(i.default.MEDIA_TYPE.audio===e.type)return i.default.MODALITY.audio;if(i.default.MEDIA_TYPE.video===e.type)return i.default.MODALITY.video;if(i.default.MEDIA_TYPE.data===e.type)return i.default.MODALITY.data}return null}t.updatePayload=function(e,t,n){if(e.rtp){var i=e.rtp.filter(function(e){return e.payload===t})[0];i&&o(e,{name:i.codec,rate:i.rate,payload:i.payload},function(e){return e.rtp.payload=n,e})}},t.forCodec=o,t.removeCodec=function(e,t){var n=-1;if(e.rtp.forEach(function(e,i){t.codec.toLowerCase()===e.codec.toLowerCase()&&t.rate===e.rate&&t.encoding===e.encoding&&(n=i)}),n>=0&&e.rtp.length>1){var i=e.rtp[n].payload;e.rtp.splice(n,1),e.payloads=e.payloads.split(" ").filter(function(e){return i!==+e}).join(" "),e.fmtp=e.fmtp&&e.fmtp.filter(function(e){return i!==e.payload})}},t.getModality=a,t.getLabelForModality=function(e){return i.default.MODALITY.audio===e?i.default.MEDIA_LABEL.audio:i.default.MODALITY.video===e?i.default.MEDIA_LABEL.video:i.default.MODALITY.sharing===e?i.default.MEDIA_LABEL.sharing:i.default.MODALITY.data===e?i.default.MEDIA_LABEL.data:null},t.getModalities=function(e){return e.media.reduce(function(e,t){if(0!==t.port){var n=a(t);if(!(n in e)){var r=t.direction?t.direction.toLowerCase():i.default.MEDIA_STATE.sendReceive;e[n]=r}}return e},{})},t.getTypeFromModality=function(e){switch(e){case i.default.MODALITY.audio:return i.default.MEDIA_TYPE.audio;case i.default.MODALITY.video:case i.default.MODALITY.sharing:return i.default.MEDIA_TYPE.video;case i.default.MODALITY.data:return i.default.MEDIA_TYPE.data;default:return null}},t.getBundle=function(e){var t;if(e.groups){var n=r.find(e.groups,function(e){return"BUNDLE"===e.type});if(n){var i=n.mids.split(" ")[0];t=r.find(e.media,function(e){var t="number"==typeof e.mid?e.mid.toString():e.mid;return i===t})}}return t||null}},function(e,t,n){"use strict";var i=n(2),r=function(){function e(e){var t=this;this.fmtpString=e,this.parameters={},e&&e.split(";").forEach(function(e){var n=e.split("=");t.parameters[n[0]]=n[1]})}return e.prototype.setIfMissing=function(e,t){this.contains(e)||(this.parameters[e]=t)},e.prototype.get=function(e){return this.parameters[e]},e.prototype.names=function(){return Object.keys(this.parameters)},e.prototype.contains=function(e){return this.parameters.hasOwnProperty(e)},e.prototype.toString=function(){var e="";return i.forOwn(this.parameters,function(t,n){e+=(e?";":"")+n,void 0!==t&&(e+="="+t)}),e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new r(e)}}},function(e,t,n){"use strict";var i=n(13),r=function(){function e(e){this.logger=e,this.queue=Promise.resolve()}return e.prototype.add=function(e){var t,n=this;t=e instanceof i.SettablePromise?function(){return e.promise}:e;var r=this.queue.then(t);return this.queue=r.catch(function(e){n.logger.safe.error("Error from promiseQueue! "+e)}),r},e}();t.PromiseQueue=r},function(e,t,n){"use strict";var i=n(3),r=n(8),o=n(2);function a(e,t){return e.toLowerCase()===t.toLowerCase()}function s(e){return e.enabled?e.send&&e.recv?i.default.MEDIA_STATE.sendReceive:e.send?i.default.MEDIA_STATE.send:e.recv?i.default.MEDIA_STATE.receive:i.default.MEDIA_STATE.inactive:null}function c(e){if(e===i.default.MEDIA_LABEL.audio)return i.default.MEDIA_TYPE.audio;if(e===i.default.MEDIA_LABEL.video)return i.default.MEDIA_TYPE.video;if(e===i.default.MEDIA_LABEL.sharing)return i.default.MEDIA_TYPE.video;throw new Error("unsupported label: "+e)}function l(e,t){for(var n=0;n<e.length;n++)if(e[n].descr.label===t)return e[n].descr;return{enabled:!1,type:c(t),label:t,send:!1,recv:!1}}function u(e,t){return o.find(t,function(t){if(t.preferredPayloadType===+e)return!0})}function d(e,t){return o.find(t,function(t){if(a(t.name,e))return!0})}function p(e,t){return u(e,t).name}function h(e,t){function n(e){return{send:/send:(\S+)/.exec(e)[1].split(","),recv:/recv:(\S+)/.exec(e)[1].split(",")}}var i={send:[],recv:[]},r=n(t);if(n(e).send.forEach(function(e){-1!==r.send.indexOf(e)&&i.send.push(e)}),n(e).recv.forEach(function(e){-1!==r.recv.indexOf(e)&&i.recv.push(e)}),i.send.length||i.recv.length){var o="app";return o=i.send.length?o+" send:"+i.send.join(","):o,o=i.recv.length?o+" recv:"+i.recv.join(","):o}return null}function f(e,t){var n=[];return e.forEach(function(e){t.forEach(function(t){if(e.type===t.type)if("x-message"===e.type){var i=h(e.parameter,t.parameter);i&&n.push({type:"x-message",parameter:i})}else e.parameter===t.parameter&&n.push(e)})}),n}function g(e,t,n,i,r,o){return a="",h=e.codecs,f=[],h.forEach(function(e){f.push(m(e.name,e.preferredPayloadType,e.clockRate,e.numChannels,e.rtcpFeedback,e.parameters,e.ptime,e.maxptime))}),s=f,d=e.headerExtensions,p=[],d.forEach(function(e){p.push(_(e.uri,e.preferredId,e.preferredEncrypt))}),c=p,l=function(e,t){var n=[];return n.push(S(e,0,0,t,1)),n}(t,o),u=v(n,"",i,r),{muxId:a||"",codecs:s,headerExtensions:c,encodings:l,rtcp:u,degradationPreference:"balanced"};var a,s,c,l,u,d,p,h,f}function m(e,t,n,i,r,o,a,s){return{name:e,payloadType:t,clockRate:n,numChannels:i,rtcpFeedback:r,parameters:o,ptime:a,maxptime:s}}function _(e,t,n){return{uri:e,id:t,encrypt:n}}function v(e,t,n,i){return{ssrc:e,cname:t,reducedSize:n,mux:i}}function y(e){return e.some(function(e){return a(e.name,"rtx")})}function S(e,t,n,i,r,o,a,s,c,l,u,d,p,h){return{ssrc:e.min,ssrcRange:e,codecPayloadType:t,fec:n,rtx:i?{ssrc:i}:0,priority:r||1,maxBitrate:o,minQuality:a||0,framerateBias:s||.5,resolutionScale:c||1,framerateScale:l||1,active:d||!0,encodingId:p,dependencyEncodingId:h}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={groupsToSdp:function(e){return e.groups&&0!==e.groups.length?[{mids:e.groups.join(" "),type:"BUNDLE"}]:null},getStateFromDescr:s,getDescrFromState:function(e,t,n){var o=function(e,t){return t===i.default.MEDIA_LABEL.audio?e.audio:t===i.default.MEDIA_LABEL.video?e.video:t===i.default.MEDIA_LABEL.sharing?e.sharing:null}(e,t);return{enabled:!!o,mediaId:n,type:c(t),label:t,send:r.hasSendDirectionality(o),recv:r.hasReceiveDirectionality(o),needsTransport:!1}},getCodecIndexByPayload:function(e,t){return o.findIndex(t,function(t){if(t.preferredPayloadType===e)return!0})},getTransportIndexById:function(e,t){return o.findIndex(e,function(e){if(e.transportId===t)return!0})},findDescrFromMedia:l,getModalitiesFromMedia:function(e){var t={},n=l(e,i.default.MEDIA_LABEL.audio),r=l(e,i.default.MEDIA_LABEL.video),o=l(e,i.default.MEDIA_LABEL.sharing);return n.enabled&&(t.audio=s(n)),r.enabled&&(t.video=s(r)),o.enabled&&(t.sharing=s(o)),t},findMatchingSdesParams:function(e,t){for(var n=0;n<t.length;++n)for(var i=t[n],r=0;r<e.length;++r){var a=e[r];if(c=a,l=(s=i).keyParams[0],u=c.keyParams[0],s.cryptoSuite===c.cryptoSuite&&l.mkiLength===u.mkiLength&&l.mkiValue===u.mkiValue)return{localSdesParams:o.shallowClone(a),remoteSdesParams:o.shallowClone(i)}}var s,c,l,u;return null},matchXMessage:h,matchRtpCaps:function(e,t,n,i){var r=null;return e&&t&&(r={codecs:function(e,t,n,i){var r=[];if(e&&t)return e.filter(function(e){return!a(e.name,"rtx")}).forEach(function(e){for(var s=0;s<t.length;s++){var c=t[s];if(a(e.name,c.name)&&a(e.kind,c.kind)&&e.numChannels===c.numChannels&&e.clockRate===c.clockRate){var l=o.shallowClone(i?c:e);l.preferredPayloadType=n?e.preferredPayloadType:c.preferredPayloadType,l.rtcpFeedback=f(e.rtcpFeedback,c.rtcpFeedback),r.push(l);break}}}),e.filter(function(e){return a(e.name,"rtx")}).forEach(function(s){for(var c=0;c<t.length;c++){var l=t[c];if(a(s.name,l.name)&&a(s.kind,l.kind)&&s.numChannels===l.numChannels&&s.clockRate===l.clockRate&&a(p(s.parameters.apt,e),p(l.parameters.apt,t))){var h=o.shallowClone(i?l:s);h.preferredPayloadType=n?s.preferredPayloadType:l.preferredPayloadType,h.parameters.apt=d(u(s.parameters.apt,e).name,r).preferredPayloadType,r.push(h);break}}}),r}(e.codecs,t.codecs,n,i),headerExtensions:function(e,t){var n=[];return e&&t&&e.forEach(function(e){for(var i=0;i<t.length;i++){var r=t[i];e.kind===r.kind&&e.uri===r.uri&&n.push(e)}}),n}(e.headerExtensions,t.headerExtensions),fecMechanisms:e.fecMechanisms.filter(function(e){return-1!==t.fecMechanisms.indexOf(e)})}),r},matchRtcpFeedback:f,getSendParams:g,getRecvParams:function(e,t,n,i,r,o){return g(e,t,n,i,r,o)},RTCRtpCodecParameters:m,RTCRtpHeaderExtensionParameters:_,RTCRtcpParameters:v,hasRtx:y,getRtxSsrc:function(e,t,n,i){return y(e.codecs)?i?t.rtxSsrc:n.rtxSsrc:0},RTCRtpEncodingParameters:S,getCodecByName:d}},function(e,t,n){"use strict";var i=function(){return function(){var e=this;this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e.startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e.startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e.startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}}();t.Stopwatch=i,t.build=function(){return new i}},function(e,t,n){"use strict";var i,r,o,a,s,c,l=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var u,d,p,h,f,g=n(6),m=n(50);!function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(u=t.PiiKind||(t.PiiKind={})),function(e){e[e.CallStateChanged=0]="CallStateChanged",e[e.TrouterStateChanged=1]="TrouterStateChanged",e[e.MultiPartyModeSet=2]="MultiPartyModeSet",e[e.MediaRetargetSucceeded=3]="MediaRetargetSucceeded",e[e.MediaRetargetFailed=4]="MediaRetargetFailed"}(d=t.CallEvent||(t.CallEvent={})),function(e){e[e.StartModality=0]="StartModality",e[e.StopModality=1]="StopModality",e[e.StreamStateChanged=2]="StreamStateChanged"}(p=t.MediaEvent||(t.MediaEvent={})),function(e){e[e.SelectSource=0]="SelectSource",e[e.AttachSource=1]="AttachSource",e[e.DetachSource=2]="DetachSource"}(h=t.MediaSenderEvent||(t.MediaSenderEvent={})),function(e){e[e.Available=0]="Available",e[e.Subscribe=1]="Subscribe",e[e.Subscribed=2]="Subscribed",e[e.Unsubscribe=3]="Unsubscribe",e[e.Unsubscribed=4]="Unsubscribed",e[e.RenderingStarted=5]="RenderingStarted",e[e.RenderingStopped=6]="RenderingStopped"}(f=t.MediaReceiverEvent||(t.MediaReceiverEvent={}));var _=function(){return function(e,t){this.value=e,this.piiKind=t}}(),v=function(){function e(){}return e.agentEnvironmentId="agent_environment_id",e.callContextId="call_context_id",e.participantId="participant_id",e.endpointId="endpoint_id",e.mediaLegId="media_leg_id",e.webMediaConfigIds="web_media_config_ids",e}();t.Props=v;var y=function(){function e(){}return e.diagnostics="MediaDiagnostic",e.qoeStats="QoE",e.ortcReports="ortc_reports",e.webrtcSession="webrtc_session",e.mediaSession="pluginless_modality_session",e.callSession="pluginless_call_session",e}();t.Events=y;var S=function(){function e(e){this.eventName=e,this.ended=!1,this.events=[]}return e.prototype.setLocalUserId=function(e){this.localUserId=e},e.prototype.start=function(){this.ended||(this.startTime=Date.now())},e.prototype.end=function(e){void 0===e&&(e=0),this.ended||(this.ended=!0,this.resultCode=e)},e.prototype.asStatsRecord=function(e){var t=this;if(void 0===e&&(e={}),g.isEmpty(this.events))return null;var n=g.uniqBy(this.events,function(e){return JSON.stringify(e)}).map(function(e){var n,i=((n={})[e.type]=e.timestamp-t.startTime,n);return g.isEmpty(e.data)||(i.data=e.data),i});return{name:this.eventName,record:g.assign({LocalUser:this.localUserId,ResultCode:String(this.resultCode),EventTimestampBag:JSON.stringify({eventStart:this.startTime,events:n})},e)}},e.prototype.add=function(e){!this.ended&&e.type&&(g.isUndefined(this.startTime)&&(this.startTime=Date.now()),g.isUndefined(e.timestamp)&&(e.timestamp=Date.now()),this.events.push(e))},e}(),E=function(e){function t(){return e.call(this,y.callSession)||this}return l(t,e),t.prototype.callStateChanged=function(n){e.prototype.add.call(this,{type:d[d.CallStateChanged],data:t.callStateToString[n]||n})},t.prototype.event=function(t){e.prototype.add.call(this,{type:d[t]})},t.callStateToString=((r={})[0]="None",r[1]="Notified",r[2]="Connecting",r[3]="Connected",r[4]="LocalHold",r[5]="RemoteHold",r[6]="Disconnecting",r[7]="Disconnected",r[8]="Observing",r[10]="Lobby",r),t}(S);t.CallStats=E;var T=function(e){function t(n,i){var r=e.call(this,y.mediaSession)||this;return r.mediaType=n,r.mediaDirection=i,r.streamDirection=t.mediaDirectionToStream[r.mediaDirection],r}return l(t,e),t.prototype.addEvent=function(t,n){e.prototype.add.call(this,{type:t,data:n})},t.prototype.lifecycle=function(e){this.addEvent(p[e])},t.prototype.streamStateChanged=function(e,n){void 0===n&&(n=this.streamDirection);var i=p[p.StreamStateChanged];this.addEvent(i,{state:t.streamStateToString[e],direction:t.streamDirectionToString[n]})},t.prototype.asStatsRecord=function(n){return void 0===n&&(n={}),e.prototype.asStatsRecord.call(this,g.assign({MediaType:t.mediaTypeToString[this.mediaType],Role:t.mediaDirectionToRole[this.mediaDirection]},n))},t.streamStateToString={created:"StreamCreated",started:"StreamStarted",active:"StreamActive",inactive:"StreamInactive",stopped:"StreamStopped",removed:"StreamRemoved",failed:"StreamFailed"},t.streamDirectionToString={send:"Send",receive:"Receive"},t.mediaTypeToString=((o={})[0]="Audio",o[1]="Video",o[3]="ScreenShare",o[4]="Data",o),t.mediaDirectionToRole=((a={})[1]="Receiver",a[2]="Sender",a[4]="Bidirectional",a),t.mediaDirectionToStream=((s={})[1]="receive",s[2]="send",s),t}(S);t.MediaModalityStats=T;var C=function(e){function t(){return e.call(this,0,4)||this}return l(t,e),t.prototype.start=function(){e.prototype.start.call(this),e.prototype.lifecycle.call(this,p.StartModality)},t.prototype.stop=function(){e.prototype.lifecycle.call(this,p.StopModality)},t}(T);t.AudioStats=C;var I=function(e){function t(t){var n=e.call(this,t,2)||this;return n.mediaType=t,n}return l(t,e),t.prototype.start=function(){e.prototype.start.call(this),e.prototype.lifecycle.call(this,p.StartModality)},t.prototype.stop=function(){e.prototype.lifecycle.call(this,p.StopModality)},t.prototype.event=function(t){e.prototype.addEvent.call(this,h[t])},t}(T);t.MediaSenderStats=I;var A=function(e){function t(t,n){var i=e.call(this,t,1)||this;return i.mediaType=t,i.remoteParticipantId=n,i.rendererCounter=0,i}return l(t,e),t.prototype.newRendererId=function(){return this.rendererCounter+=1,String(this.rendererCounter)},t.prototype.event=function(t,n){e.prototype.addEvent.call(this,f[t],{rendererId:n})},t.prototype.asStatsRecord=function(){return e.prototype.asStatsRecord.call(this,{TargetUser:this.remoteParticipantId})},t}(T);t.MediaReceiverStats=A;var b=function(){function e(){this.allStats=[],this.ended=!1}return e.prototype.setLocalUserId=function(e){this.localUserId=e},Object.defineProperty(e.prototype,"call",{get:function(){return this.callStats||this.startCall()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audio",{get:function(){return this.audioStats||this.newSession(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this.videoStats||this.newSession(1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenShare",{get:function(){return this.sharingStats||this.newSession(3)},enumerable:!0,configurable:!0}),e.prototype.renderer=function(e,t){var n=this.renderingStats[t];return n||(n=this.renderingStats[t]=this.receive(e,t)),n},e.prototype.startCall=function(){return this.callStats=new E,this.callStats.start(),this.addStats(this.callStats)},e.prototype.endCall=function(e){void 0===e&&(e=0),this.ended=!0,this.call.end(e),this.allStats.forEach(function(e){return e.end()})},e.prototype.newSession=function(e){var t;switch(e){case 0:t=this.audioStats=new C;break;case 1:t=this.videoStats=new I(e);break;case 3:t=this.sharingStats=new I(e)}return this.addStats(t)},e.prototype.receive=function(e,t){var n=new A(e,t);return n.start(),this.addStats(n)},e.prototype.buildStatsRecords=function(){return this.allStats.map(function(e){return e.asStatsRecord()}).filter(function(e){return!!e})},e.prototype.addStats=function(e){return this.ended?e:(this.allStats.push(e),e.setLocalUserId(this.localUserId),e)},e}();t.LocalStats=b;var O=function(){function e(){this.localStats=new b}return e.prototype.setCallId=function(e){this.callId=e},e.prototype.setParticipantId=function(e){this.participantId=e},e.prototype.setEndpointId=function(e){this.endpointId=e},e.prototype.setMediaLegId=function(e){this.mediaLegId=e},e.prototype.setMediaStats=function(e){this.mediaStats=e},e.prototype.setWebMediaConfigIds=function(e){this.webMediaConfigIds=e},e.prototype.buildFromMediaStats=function(){if(!this.mediaStats)return[];var e=[];return"OrtcMediaStats"===this.mediaStats.type?e=e.concat(this.buildEvents([this.mediaStats.data],y.ortcReports)):"WebRtcMediaStats"===this.mediaStats.type&&(e=e.concat(this.buildEvents([this.mediaStats.data],y.webrtcSession))),e},e.prototype.buildFromLocalStats=function(){var e=this;return g.flatten(this.localStats.buildStatsRecords().map(function(t){return e.buildEvents([t.record],t.name)}))},e.prototype.buildEvents=function(t,n){var i=this;return g.map(t,function(t){var r={};return r[v.agentEnvironmentId]=e.agentEnvironmentId,r[v.callContextId]=i.callId||"",r[v.participantId]=i.participantId||"",r[v.endpointId]=i.endpointId||"",r[v.mediaLegId]=i.mediaLegId||"",r[v.webMediaConfigIds]=i.webMediaConfigIds||"",{eventName:n,props:i.buildProps(t,null,r)}})},e.prototype.normalizeKey=function(e){return e.replace(/[^a-zA-Z0-9._]/g,"_")},e.prototype.createPiiValueFromMAStat=function(t,n){if(!(n in e.piiDict))throw new Error("unknown PII type");return new _(t,e.piiDict[n])},e.prototype.buildProps=function(e,t,n){var i=this;return g.keys(e).forEach(function(r){var o=i.normalizeKey(r),a=t?t+"_"+o:o,s=e[r];if(g.isString(s))n[a]=i.getPiiAwareValue(r,s);else if(g.isArray(s)){if(s.length>0){var c=s,l=c.map(function(e){return e.value}).toString();n[a]=i.createPiiValueFromMAStat(l,c[0].type)}}else if(g.isObject(s))if(s.__VALUE__){var u=s;n[a]=i.createPiiValueFromMAStat(u.value,u.type)}else i.buildProps(s,a,n)}),n},e.prototype.getPiiAwareValue=function(t,n){return e.piiProps.hasOwnProperty(t)?new _(n,e.piiProps[t]):n},e.prototype.build=function(){return g.flatten([this.buildFromMediaStats(),this.buildFromLocalStats()])},e.agentEnvironmentId=m.default.generate(),e.piiProps={IPAddr:u.IPV4AddressLegacy,MACAddr:u.IPV4AddressLegacy,IPAddress:u.IPV4AddressLegacy,OpaqueData:u.NotSet,LocalSite:u.IPV4AddressLegacy,RemoteSite:u.IPV4AddressLegacy,BaseAddress:u.IPV4AddressLegacy,LocalAddress:u.IPV4AddressLegacy,RemoteAddress:u.IPV4AddressLegacy,NetworkName:u.Fqdn,LocalUser:u.Identity,TargetUser:u.Identity},e.piiDict=((c={})[0]=u.NotSet,c[13]=u.IPV4AddressLegacy,c[4]=u.IPv6Address,c),e}();t.CallTelemetryBuilder=O},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(20);function s(e){switch(e){case 1:return"crop";case 0:return"stretch";case 2:default:return"fit"}}t.toMediaAgentScalingMode=s;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isRendering=!1,t.frameType=-1,t}return r(t,e),Object.defineProperty(t.prototype,"rendererType",{get:function(){return this.renderer.getType?function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;default:return-1}}(this.renderer.getType()):-1},enumerable:!0,configurable:!0}),t.prototype.captureFrame=function(e){throw new Error("Not implemented yet")},t.prototype.getStats=function(){return this.renderer.getStats?this.renderer.getStats():Promise.reject(new Error("Renderer does not support stats"))},t.prototype.setScalingMode=function(e){return this.renderer.setScalingMode(s(e)),Promise.resolve()},t.prototype.setVideoEffects=function(e){return Promise.reject(new Error("Not implemented yet"))},t.prototype.getVideoEffectsCapability=function(){return Promise.reject(new Error("Not implemented yet"))},t.prototype.dumpVideoSourceImages=function(){return Promise.reject(new Error("Not implemented"))},t.prototype.onVideoSizeChanged=function(e,t){this.streamSize={width:e,height:t},this.isRendering=e>0&&t>0,this.raiseChanged()},t}(o.default),l=function(e){function t(t,n){var i=e.call(this)||this;return i.renderer=n.createPreviewRenderer(t,{onVideoSizeChanged:i.onVideoSizeChanged.bind(i)}),i}return r(t,e),t.prototype.startVideoAsync=function(){return this.renderer.startVideoAsync()},t.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=null)},t}(c);t.LocalVideoRenderer=l;var u=function(e){function t(t,n,i){var r=e.call(this)||this;return r.rendererStats=i,r.rendererId=i.newRendererId(),r.renderer=n.createRemoteRenderer(t,{onVideoStateChanged:r.onVideoStateChanged.bind(r),onVideoSizeChanged:r.onVideoSizeChanged.bind(r)}),r}return r(t,e),t.prototype.onVideoStateChanged=function(e){this.rendererStats.streamStateChanged(e.stream)},t.prototype.onVideoSizeChanged=function(t,n){var i=this.isRendering;e.prototype.onVideoSizeChanged.call(this,t,n),this.isRendering!==i&&this.rendererStats.event(this.isRendering?a.MediaReceiverEvent.RenderingStarted:a.MediaReceiverEvent.RenderingStopped,this.rendererId)},t.prototype.subscribeVideoAsync=function(e,t){var n=this;void 0===t&&(t=!1),this.rendererStats.event(a.MediaReceiverEvent.Subscribe,this.rendererId);var i=this.renderer.subscribeVideoAsync(e,t);return i.then(function(){return n.rendererStats.event(a.MediaReceiverEvent.Subscribed,n.rendererId)}),i},t.prototype.dispose=function(){this.renderer&&(this.rendererStats.event(a.MediaReceiverEvent.Unsubscribe,this.rendererId),this.renderer.dispose(),this.rendererStats.event(a.MediaReceiverEvent.Unsubscribed,this.rendererId),this.renderer=null)},t}(c);t.RemoteVideoRenderer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getVersion=function(){return"2018.36.01.1"},e.getOvb=function(){return"a3758a6b6f55b7fc9c4ca516125aca0df2f6a2d1"},e}();t.TsCallingVersionProvider=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.streamDirections={send:"sendonly",receive:"recvonly",sendReceive:"sendrecv"},t.ngcStreamTypes={audio:"audio",video:"video",sharing:"applicationsharing-video",audioteleconference:"audio-teleconferencing"}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.requestDispatcherImpl=n(246),this.policy=n(247)}return e.prototype.getRequestOptions=function(e,t,n,i){return{headers:t||{},retry:this.policy,reporting:{serviceName:"ngcCallController-"+(e||"")},payload:n||null,timeout:i||null}},e.prototype.getAsync=function(e,t){return this.requestDispatcherImpl.get(e,t)},e.prototype.postAsync=function(e,t){return this.requestDispatcherImpl.post(e,t)},e.prototype.putAsync=function(e,t){return this.requestDispatcherImpl.put(e,t)},e.prototype.removeAsync=function(e,t){return this.requestDispatcherImpl.remove(e,t)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(245),r=n(25),o=function(){function e(){this.providers=[],this.initState={}}return e.getInstance=function(){return e.instance},e.prototype.init=function(e){var t=this;return Promise.resolve().then(function(){if(t.initState=t.providers.reduce(function(t,n){if(t.instance)return t;try{return{instance:n(e),errors:[]}}catch(e){return t.errors.push(e),t}},{errors:[],instance:void 0}),!t.initState.instance)throw t.initState.errors})},e.prototype.register=function(e){this.providers.push(e)},e.prototype.configure=function(e){if(this.config)throw new Error("media agent factory already configured");this.config=e},e.prototype.getAgent=function(){return this.mediaAgent||(this.mediaAgent=this.createAgent()),this.mediaAgent},e.prototype.reset=function(){this.config=null,this.mediaAgent=null},e.prototype.createAgent=function(){var e=this;if(!this.config)throw new Error("factory must be configured before trying to obtain media agent");var t={logger:this.config.logger,safeLogger:this.config.safeLogger,settings:this.config.settings,tokenProvider:this.config.tokenProvider,relayConfigProvider:function(){return e.config.configProvider.getRelayConfig()},mediaConfigProvider:function(){return e.config.configProvider.getSkypeConfig()},relayManager:this.config.relayManager||this.buildRelayManager()};return this.build(this.config.deviceEvents,t)},e.prototype.build=function(e,t){if(this.initState.instance)return this.initState.instance.build(e,t);throw new Error("no media agent provider available on current platform")},e.prototype.buildRelayManager=function(){var e=this,t=this.config.httpRequestDispatcher||new r.default;return i.build({logger:this.config.logger,tokenProvider:this.config.tokenProvider,configProvider:function(){return e.config.configProvider.getRelayConfig()},request:{get:function(e,n){return t.getAsync(e,t.getRequestOptions("GET",n?n.headers:{},null))},isOnline:this.config.appStateProvider.isOnline}})},e.instance=new e,e}();t.default=o},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.CALL_ENDED="CallEnded",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.RECONNECT="Reconnect",e.RENEGOTIATE="Renegotiate",e.RENEGOTIATE_OFFER="RenegotiateOffer",e.UPDATE_MEDIA_STATUS="UpdateMediaStatus",e.SET_MEDIA_MODALITIES="SetMediaModalities",e.SET_VIDEO_CONTAINER="SetVideoContainer",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.SET_LOCAL_VIDEO="SetLocalVideo",e.SET_VIDEO_EFFECTS="SetVideoEffects",e.GET_VIDEO_EFFECTS_CAPABILITIES="GetVideoEffectsCapabilities",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.CALL_TRANSFER_IN_PROGRESS="CallTransferInProgress",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.ON_TRANSFER_REQUESTED="OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="OnTransferRequestedInvalid",e.GET_CALL_REPLACEMENT_DETAILS="GetCallReplacementDetails",e.GET_TECHNICAL_INFORMATION_JSON="GetTechnicalInformationJson",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.START_LIGHTWEIGHT_MEETING="StartLightweightMeeting",e.JOIN_LIGHTWEIGHT_MEETING="JoinLightweightMeeting",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.SET_CALL_STATE="SetCallState",e.SET_TRANSFER_STATE="SetTransferState",e.SET_PARK_STATE="SetParkState",e.SET_MUTED="SetMuted",e.SET_MUTED_SPEAKER="SetMutedSpeaker",e.SET_SCREEN_SHARING="SetScreenSharing",e.CONNECT_CALL="ConnectCall",e.WAIT_FOR_ANSWER="WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="SignalingStateChanged",e.WEB_ON_OFFER="WebOnOffer",e.WEB_ON_ANSWER="WebOnAnswer",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="ElectronWaitForRinging",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.ELECTRON_START_SCREEN_SHARING="ElectronStartScreenSharing",e.ELECTRON_SLIMCORE_READY="ElectronSlimcoreReady"}(t.CALL_OPERATIONS||(t.CALL_OPERATIONS={})),function(e){e.SET_PARTICIPANT_STATE="SetParticipantState",e.UPDATE_PARTICIPANT_STREAM="UpdateParticipantStream",e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.PARTICIPANT_JOINED="ParticipantJoined",e.PARTICIPANT_UPDATED="ParticipantUpdated",e.ADMIT_PARTICIPANT="AdmitParticipant",e.SELF_PARTICIPANT_UPDATED="SelfParticipantUpdated",e.CALL_ME_BACK="CallMeBack"}(t.PARTICIPANT_OPERATIONS||(t.PARTICIPANT_OPERATIONS={})),function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState",e.SET_CONTENT_SHARING_STATUS="SetContentSharingStatus"}(t.CONTENT_SHARING_OPERATIONS||(t.CONTENT_SHARING_OPERATIONS={})),t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12"}},function(e,t,n){"use strict";var i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.jsCallEndCodes={Cancel:487,Reject:603,NoNgcEndpoint:480,Forbidden:403,PreconditionFailed:412,Success:0,BadRequest:400,NotFound:404,NotAcceptable:406,Timeout:408,Conflict:409,MediaError:410,ConfParticipantCountLimitReached:413,CallAccepted:450,CallForwarded:451,CallForwardedToVoicemail:452,P2pRejectCall:453,P2pFallbackForScreensharing:460,P2pFallbackDueToGroupCall:461,CallLegEndedOnService:470,CallDoesNotExist:481,NotAcceptableHere:488,NetworkError:490,GlareError:491,SkypeTokenError:495,LocalHttpStackError:496,UnknownError:497,LocalError:498,ServiceUnavailable:500,CallModalityFailure:580},t.jsCallEndSubCodes={InsufficientCapabilities:5204,PolicyRestriction:5448,UserBlocked:10005,SharingStolenError:10029,MediaDropDuringConnect:3100,MediaDropAfterConnect:3101,MediaAnswerProcessingError:3102,MediaFinalAnswerProcessingError:3103,MediaOfferTimeout:3104,MediaFinalAnswerTimeout:3105,MediaOfferNull:3106,MediaAudioDeviceError:3107,MediaRenegotiationError:3108,MediaPermissionError:3109,MediaUnknownError:3110,MediaOfferProcessingError:3111,RemovedFromConversation:5e3,DeniedInLobby:5854,RemovedFromCall:5300,TimedOutInLobby:5855},t.responseCodeMap=((i={})[t.jsCallEndCodes.Success]=1,i[t.jsCallEndCodes.Cancel]=12,i[t.jsCallEndCodes.Reject]=10,i[t.jsCallEndCodes.NoNgcEndpoint]=2,i[t.jsCallEndCodes.Timeout]=6,i[t.jsCallEndCodes.CallAccepted]=30,i[t.jsCallEndCodes.NotFound]=24,i[t.jsCallEndCodes.CallDoesNotExist]=46,i[t.jsCallEndCodes.NotAcceptable]=5,i[t.jsCallEndCodes.BadRequest]=5,i[t.jsCallEndCodes.MediaError]=4,i[t.jsCallEndCodes.ConfParticipantCountLimitReached]=59,i[t.jsCallEndCodes.CallModalityFailure]=4,i[t.jsCallEndCodes.NetworkError]=3,i[t.jsCallEndCodes.LocalHttpStackError]=31,i[t.jsCallEndCodes.LocalError]=25,i[t.jsCallEndCodes.CallForwarded]=27,i[t.jsCallEndCodes.CallForwardedToVoicemail]=28,i[t.jsCallEndCodes.SkypeTokenError]=29,i[t.jsCallEndCodes.ServiceUnavailable]=7,i[t.jsCallEndCodes.Conflict]=7,i[t.jsCallEndCodes.GlareError]=7,i[t.jsCallEndCodes.CallLegEndedOnService]=7,i[t.jsCallEndCodes.NotAcceptableHere]=26,i[t.jsCallEndCodes.UnknownError]=32,i[t.jsCallEndCodes.Forbidden]=8,i[t.jsCallEndCodes.PreconditionFailed]=65,i),t.pstnConsumerResponseCodeMap=((r={})[9401]=33,r[9422]=33,r[6102]=1,r[6423]=14,r[9402]=14,r[9432]=14,r[6519]=3,r[9403]=15,r[9410]=36,r[9411]=37,r[1e3]=2,r[9407]=17,r[13430]=18,r[6009]=19,r[10484]=19,r[10604]=19,r[10404]=19,r[10420]=19,r[10403]=20,r[17401]=20,r[10408]=9,r[10486]=11,r[10600]=11,r[10686]=11,r[10487]=21,r[10500]=3,r[10501]=3,r[10502]=3,r[10503]=3,r[10504]=3,r[10480]=22,r[10482]=22,r[10603]=10,r[13406]=23,r[13416]=23,r),t.pstnEnterpriseResponseCodeMap=((o={})[500]=39,o[403]=41,o[404]=42,o[480]=40,o),function(e){e[e.CallTerminationSubCodeSipGWMin=2e5]="CallTerminationSubCodeSipGWMin",e[e.CallTerminationSubCodeSipGWMax=299999]="CallTerminationSubCodeSipGWMax"}(t.PstnTerminationCode||(t.PstnTerminationCode={})),function(e){e[e.CallTerminationSubCodeSipGWMin=4e5]="CallTerminationSubCodeSipGWMin",e[e.CallTerminationSubCodeSipGWMax=499999]="CallTerminationSubCodeSipGWMax"}(t.EnterpisePstnTerminationCode||(t.EnterpisePstnTerminationCode={})),function(e){e[e.Unmuted=0]="Unmuted",e[e.ServerMuted=1]="ServerMuted",e[e.Muted=2]="Muted"}(t.ParticipantMuteState||(t.ParticipantMuteState={}))},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(14),o=n(5);var a=function(e){function t(t){var n=e.call(this)||this;return n.window=o.default.window,n.lastNotifiedVideoWidth=0,n.lastNotifiedVideoHeight=0,n.onVideoDataUpdated=function(){if(n.sizeChangedListener){var e=n.video.videoWidth,t=n.video.videoHeight;(e<32||t<32)&&(e=t=0),n.lastNotifiedVideoWidth===e&&n.lastNotifiedVideoHeight===t||(n.lastNotifiedVideoWidth=e,n.lastNotifiedVideoHeight=t,n.sizeChangedListener(e,t))}n.video&&n.video.paused&&n.video.play()},n.onVideoError=function(){n.errorListener&&n.errorListener(n.video.error||"no video")},n.onVideoPaused=function(){r.hasOrtc()&&(n.window.attachMediaStream(n.video,null),n.window.attachMediaStream(n.video,n.stream)),n.video.play()},n.onContextMenu=function(e){e.preventDefault()},n.container=t,n.video=n.window.document.createElement("video"),n.video.style.width="100%",n.video.style.height="100%",n.initialize(),n}return i(t,e),t.prototype.onSizeChanged=function(e){this.sizeChangedListener=e},t.prototype.onError=function(e){this.errorListener=e},t.prototype.getVideoElement=function(){return this.video},t.prototype.getType=function(){return 0},t.prototype.dispose=function(){this.detachEventListeners(),this.video=null,this.stream=null},t.prototype.reattachEventListeners=function(){this.detachEventListeners(),this.attachEventListeners()},t.prototype.attachMediaStream=function(e){this.stream!==e&&(this.stream&&(e||this.container.removeChild(this.video),this.window.detachMediaStream(this.video)),e&&(this.video.hidden=0===e.getVideoTracks().length,this.window.attachMediaStream(this.video,e),this.stream||this.container.appendChild(this.video)),this.stream=e)},t.prototype.setScalingMode=function(e){this.video.style.objectFit=function(e){switch(e){case"crop":return"cover";case"stretch":return"fill";case"fit":default:return"contain"}}(e)},t.prototype.getMediaStream=function(){return this.stream},t.prototype.initialize=function(){this.video.autoplay=!0,this.video.muted=!0,this.attachEventListeners()},t.prototype.attachEventListeners=function(){this.video.addEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.addEventListener("timeupdate",this.onVideoDataUpdated),this.video.addEventListener("error",this.onVideoError),this.video.addEventListener("pause",this.onVideoPaused),this.video.addEventListener("contextmenu",this.onContextMenu)},t.prototype.detachEventListeners=function(){this.video.removeEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.removeEventListener("timeupdate",this.onVideoDataUpdated),this.video.removeEventListener("error",this.onVideoError),this.video.removeEventListener("pause",this.onVideoPaused),this.video.removeEventListener("contextmenu",this.onContextMenu),this.attachMediaStream(null)},t}(n(10).default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var i=16,r=function(){function e(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0),this.width=e,this.height=t,this.minBitrate=n,this.maxBitrate=r,this.fs=Math.ceil(e/i)*Math.ceil(t/i)}return e.prototype.toString=function(){return this.height+"p"},e}();t.ResolutionInfo=r;var o=function(){function e(){this.resolutions=[new r(320,180,2e4,2e5),new r(426,240,16e4,35e4),new r(480,270,25e4,5e5),new r(640,360,4e5,1e6),new r(852,480,8e5,14e5),new r(960,540,12e5,18e5),new r(1280,720,15e5,2e6),new r(1920,1080,18e5,1e8)]}return Object.defineProperty(e.prototype,"initialResolution",{get:function(){return this.resolutions[this.resolutions.length-1]},enumerable:!0,configurable:!0}),e.prototype.getResolution=function(e){for(var t=this.resolutions.length-1;t>=0;t--)if(this.resolutions[t].fs<=e)return this.resolutions[t];return this.resolutions[0]},e.prototype.getMaxFS=function(e,t){for(var n=Math.max(e,t),i=Math.min(e,t),r=0,o=this.resolutions;r<o.length;r++){var a=o[r];if(a.width>=n&&a.height>=i)return a.fs}return this.resolutions.slice(-1)[0].fs},e.prototype.getResolutionForBitrate=function(e){return{lowRes:this.resolutions.filter(function(t){return t.maxBitrate&&t.maxBitrate>=e}).shift(),highRes:this.resolutions.filter(function(t){return t.minBitrate&&t.minBitrate<=e}).pop()}},e.prototype.getResolutions=function(){return this.resolutions},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";!function(e){e[e.SSRC_UPDATED=0]="SSRC_UPDATED",e[e.CODEC_PARAMS_UPDATED=1]="CODEC_PARAMS_UPDATED"}(t.VideoCapabilitiesEventType||(t.VideoCapabilitiesEventType={})),function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(t.MediaChannelType||(t.MediaChannelType={}))},function(e,t,n){"use strict";var i=n(3),r=n(8);t.Helper=r;var o=n(136);t.MediaAgent=o.default,t.Constants=i.default},function(e,t,n){"use strict";var i=n(0),r=function(){function e(e){this.id=e.id,this.displayName=e.displayName||" ",this.languageId=e.languageId||null,this.endpointDetails=e.endpointDetails||[],this.acceptedBy=e.acceptedBy,this.role=e.role,this.tenantId=e.tenantId}return e.isInLobby=function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.endpointId===t&&r.isLobby)return!0}return!1},e.isServerMuted=function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.endpointId===t&&r.mediaStreams){for(var o=0,a=r.mediaStreams;o<a.length;o++){var s=a[o];if("audio"===s.type)return void 0!==s.serverMuted&&s.serverMuted}break}}return!1},e.fromWireParticipant=function(t){return i.assertNotNull(t,"invalid wireParticipant"),i.assertNotNullOrEmpty(t.id,"participant must have valid Id"),new e({id:t.id,displayName:t.displayName,languageId:t.languageId,acceptedBy:t.acceptedBy})},e.fromRoster=function(t){i.assertNotNull(t,"invalid rosterParticipant"),i.assertNotNullOrEmpty(t.details.id,"participant must have valid Id");var n,r=!1,o=!1,a=!1,s=t.endpoints;return n=Object.keys(s).map(function(e){var t=[];return s[e].call&&(r=!0,t=s[e].call.mediaStreams?s[e].call.mediaStreams:null),s[e].lwj&&(o=!0),s[e].lobby&&(a=!0,t=s[e].lobby.mediaStreams?s[e].lobby.mediaStreams:null),{endpointId:e,participantId:s[e].participantId||null,clientVersion:s[e].clientVersion||null,endpointMetadata:s[e].endpointMetadata||null,originalId:s[e].originalId||null,contentSharing:s[e].contentSharing||null,capabilities:s[e].capabilities||null,endpointType:s[e].endpointType||"default",mediaStreams:t,lightWeightMeeting:s[e].lwj||null,isLobby:a,endpointState:s[e].endpointState||null}}),r||o||a?new e({id:t.details.id,displayName:t.details.displayName,languageId:t.details.languageId,role:t.role||"",tenantId:t.details.tenantId||"",endpointDetails:n||[],acceptedBy:t.acceptedBy||""}):null},e}();t.__esModule=!0,t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(9),s=n(38),c=new RegExp("/callAgent/","i"),l={INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_PSTN_NGC_CALL:111,INCOMING_SCREENSHARE_WITH_CHAT:119},u=function(){function e(e){this.signalingAgentProvider=e}return e.prototype.handleMessage=function(e){if(e.eventId)return{isHandled:!1};if(e.url.search(c)>-1){var t=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(e);return"number"==typeof t?{isHandled:!0,resultCode:t}:{isHandled:!0,resultCode:t.resultCode,responseBody:t.responseBody,responseHeaders:t.responseHeaders}}return{isHandled:!1}},e}(),d=function(){function e(e,t){this.callRegistry=e,this.recentInvitations=[],this.logger=t.createChild("IncomingCallMessageHandler")}return e.prototype.handleMessage=function(e){var t=this.handleIncomingCall(e);return t?{isHandled:t,resultCode:200}:{isHandled:t}},e.prototype.handleIncomingCall=function(e){if(!this.isIncomingCallMessage(e))return!1;var t=this.isCallTransferNotification(e)?this.buildTransferCallPayload(e):this.buildNGCCallPayload(e);if(!t)return!1;if(this.callRegistry.calls.some(function(e){return e.callId===t.convoCallId&&e.participantId===t.participantId}))return this.logger.log("Duplicate call filtered because it was in the call registry, callId = "+t.convoCallId+", participantId = "+t.participantId),!1;if(this.recentInvitations.some(function(e){return e.convoCallId===t.convoCallId&&e.participantId===t.participantId}))return this.logger.log("Duplicate call filtered because it was in the recent calls list, callId = "+t.convoCallId+", participantId = "+t.participantId),!1;5===this.recentInvitations.length&&this.recentInvitations.shift(),this.recentInvitations.push({convoCallId:t.convoCallId,participantId:t.participantId});var n=o.find(this.callRegistry.calls,function(e){return e.callId===t.convoCallId&&8===e.state});return n||(n=this.callRegistry.createCall(t.conversationId,t.convoCallId,t.participantId)),n.init({threadId:t.conversationId,messageId:t.messageId,mediaPeerType:2}),this.callRegistry.testEndpointMetadata?n.acknowledge(t,this.callRegistry.testEndpointMetadata):n.acknowledge(t),!0},e.prototype.isIncomingCallMessage=function(e){return Object.keys(l).some(function(t){return l[t]===e.eventId})||this.isCallTransferNotification(e)},e.prototype.isCallTransferNotification=function(e){return e.callNotification&&("transfer"===e.callNotification.callType||"replaces"===e.callNotification.callType)},e.prototype.buildTransferCallPayload=function(e){var t={body:{gp:btoa(JSON.stringify(e)),evt:l.INCOMING_SKYPE_NGC_CALL,nsp:void 0},callerId:e.callNotification.from.id,conversationId:null,convoCallId:e.debugContent.callId,isMultiParty:!1,ngcCall:!0,participantId:e.callNotification.to.participantId,transferorId:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.id,transferorType:e.callNotification.transferor&&e.callNotification.transferor.transferorType,transferorDisplayName:e.callNotification.transferor&&e.callNotification.transferor.details&&e.callNotification.transferor.details.displayName,callType:e.callNotification.callType,consultativeCallId:e.callNotification.consultativeCallId,messageId:null,callQueueInfo:e.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.log("Incoming transfer paylod",t),t},e.prototype.buildNGCCallPayload=function(e){var t;try{t=JSON.parse(atob(e.body.gp))}catch(e){return this.logger.error("Unable to parse incoming NGC call payload"),null}if(!t.callNotification)return this.logger.error("Missing callNotification in parsed incoming NGC call payload"),null;var n={conversationId:t.groupChat&&t.groupChat.threadId,messageId:t.groupChat&&t.groupChat.messageId,callerId:t.callNotification.from.id,isMultiParty:t.conversationInvitation.isMultiParty,convoCallId:t.debugContent.callId,participantId:t.debugContent.participantId,ngcCall:!0,body:e.body,transferorId:t.callNotification.transferor&&t.callNotification.transferor.details&&t.callNotification.transferor.details.id,transferorType:t.callNotification.transferor&&t.callNotification.transferor.transferorType,transferorDisplayName:t.callNotification.transferor&&t.callNotification.transferor.details&&t.callNotification.transferor.details.displayName,callType:t.callNotification.callType,callQueueInfo:t.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.log("Incoming NGC payload",n),n},e}(),p=function(e){function t(t,n,i,r,o,a,s){void 0===a&&(a={}),void 0===s&&(s=null);var c=e.call(this)||this;return c.trouterService=t,c.signalingAgentProvider=n,c.mediaAgent=i,c.logger=r,c.telemetryService=o,c.callSettings=a,c.ecsProvider=s,c.calls=[],c.testEndpointMetadata=null,c.addCallSubscriptionToMap=function(e,t){c.callSubscriptionsMap.set(e,(c.callSubscriptionsMap.get(e)||[]).concat(t))},c.callSubscriptionsMap=new Map,c}return r(t,e),t.prototype.init=function(e){var t=this;this.skypeIdentity=e,this.incomingCallMessageHandler=new d(this,this.logger),this.trouterService.registerMessageHandler(new u(this.signalingAgentProvider)),this.trouterService.registerMessageHandler(this.incomingCallMessageHandler),this.logger.info("Call registry init, endpointMetadata",this.testEndpointMetadata);try{this.beforeUnloadListener=function(){t.stopCallsWithBeacon()},window.addEventListener("beforeunload",this.beforeUnloadListener)}catch(e){this.logger.info("Not adding beforeunload listener: "+e)}return Promise.resolve(void 0)},t.prototype.uninit=function(){this.logger.info("Uninit() called.");try{window.removeEventListener("beforeunload",this.beforeUnloadListener)}catch(e){this.logger.info("Not removing beforeunload listener: "+e)}return Promise.resolve(void 0)},t.prototype.createCall=function(e,t,n,i){var r=this,o=new s.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,this.logger,this.telemetryService,this.skypeIdentity,this.callSettings,e,t,n,this.ecsProvider);this.calls.push(o),this.event("callAdded").raise(o),this.raiseChanged();var a=o.on("replacementRequested",function(e){r.incomingCallMessageHandler.handleMessage(e)});return this.addCallSubscriptionToMap(o,a),o},t.prototype.getCall=function(e,t){return this.logger.info("getCall("+e+")"),o.find(this.calls,function(n){return n.callId===e&&n.participantId===t})},t.prototype.deleteCall=function(e){var t=this.calls.indexOf(e);return-1!==t&&(this.callSubscriptionsMap.get(e).forEach(function(e){return e.dispose()}),this.callSubscriptionsMap.delete(e),this.calls.splice(t,1),this.event("callRemoved").raise(e),this.raiseChanged(),!0)},t.prototype.updateSkypeToken=function(e){this.logger.debug("CallRegistry.updateSkypeToken() called but not supported in the current set up.")},t.prototype.debugInformation=function(e){var t=e?"CallInformation\n * CallId="+e.callId:void 0;return Promise.resolve(t)},t.prototype.stopCallsWithBeacon=function(){for(var e=0,t=this.calls;e<t.length;e++){t[e].stopWithBeacon()}},t}(a.default);t.CallRegistry=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(9),s=n(21),c=function(e){function t(t,n){var i=e.call(this)||this;return i._deviceManager=t,n.onDevicesChanged=function(e){return i._raiseDevicesChanged(i._mapDevices(e))},t.on("onSelectedDevicesChanged",function(e){return i._raiseDevicesChanged()}),i}return r(t,e),Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return this._deviceManager.isAudioOutputSelectionSupported},enumerable:!0,configurable:!0}),t.prototype.askDevicePermission=function(e){return this._deviceManager.askDevicePermission?this._deviceManager.askDevicePermission(e):Promise.resolve({audio:!0,video:!0})},t.prototype.enumerateDevicesAsync=function(){var e=this;return this._deviceManager.enumerateDevicesAsync().then(function(t){return e._mapDevices(t)})},t.prototype.selectDevices=function(e){var t=o.assign({},this._deviceManager.getSelectedDevices(),e);this._deviceManager.selectDevices(t)},t.prototype.enableTtySupport=function(e){return Promise.reject(new Error("enable Tty is not supported in pluginless call"))},t.prototype.getSelectedDevices=function(){return this._deviceManager.getSelectedDevices()},t.prototype.getDeviceNameAsync=function(e){return this._deviceManager.getDeviceNameAsync(e)},t.prototype.setDeviceEffects=function(e,t){throw new Error("Not implemented")},t.prototype.getDeviceEffectsCapability=function(e,t){return 0},t.prototype.createPreviewRenderer=function(e,t){var n=new s.LocalVideoRenderer(e,this._deviceManager);return Promise.resolve().then(function(){return n.startVideoAsync()}).then(function(){return t&&n.setScalingMode(t.scalingMode),n})},t.prototype.createScreenSharingPreviewRenderer=function(e,t){return Promise.reject(new Error("Not yet supported"))},t.prototype._raiseDevicesChanged=function(e){var t=this;(e?Promise.resolve(e):this.enumerateDevicesAsync()).then(function(e){t.raiseChanged(),t.event("devicesChanged").raise(e)})},t.prototype._mapDevices=function(e){var t=this;return o.map(e,function(e){return t._mapDeviceDesc(e)})},t.prototype._mapDeviceDesc=function(e){var n=t._mapDeviceType(e.kind);return 1===n?{id:e.id,browserId:e.browserId,label:e.label,kind:n,position:t._mapCameraPosition(e.position)}:{id:e.id,browserId:"default_output_device"===e.browserId?"default":e.browserId,label:e.label,kind:n,isSystemDefault:!!e.isSystemDefault}},t._mapDeviceType=function(e){switch(e){case"camera":return 1;case"microphone":return 2;case"speaker":return 3;default:throw new Error("Invalid device type")}},t._mapCameraPosition=function(e){switch(e){case"front":return 1;case"back":return 2;case"external":return 3;default:return 0}},t}(a.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={NEGOTIATION_COMPLETED:"NegotiationCompleted",INITIAL:{OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"InitialAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"InitialAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",ANSWER_GENERATION_STARTED:"InitialAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"InitialAnswerGenerationEnded"},RENEGOTIATION:{OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"}},r=function(){function e(e,t,n){var r=this;this.mediaSession=e,this.signalingSession=t,this.mediaConstants=n,this.operationNames=i.INITIAL,this.configureModalitiesAsync=this.mediaSession.configureModalitiesAsync.bind(this.mediaSession),this.getAllowedModalities=this.mediaSession.getAllowedModalities&&this.mediaSession.getAllowedModalities.bind(this.mediaSession),this.rejectNegotiationAsync=this.mediaSession.rejectNegotiationAsync.bind(this.mediaSession),this.createRemoteRenderer=this.mediaSession.createRemoteRenderer.bind(this.mediaSession),this.getStatsAsync=this.mediaSession.getStatsAsync.bind(this.mediaSession),this.getLastKnownStats=this.mediaSession.getLastKnownStats.bind(this.getLastKnownStats),this.selectSharingSource=this.mediaSession.selectSharingSource?this.mediaSession.selectSharingSource.bind(this.mediaSession):function(){},this.muteInputAsync=this.mediaSession.muteInputAsync.bind(this.mediaSession),this.unmuteInputAsync=this.mediaSession.unmuteInputAsync.bind(this.mediaSession),this.muteOutputAsync=this.mediaSession.muteOutputAsync.bind(this.mediaSession),this.unmuteOutputAsync=this.mediaSession.unmuteOutputAsync.bind(this.mediaSession),this.terminate=this.mediaSession.terminate.bind(this.mediaSession);var o=this.getExtensionsManager();o&&o.configureExtension(this.mediaConstants.EXTENSION_TYPE.videoStreamControl,{sender:{send:function(e){return r.signalingSession?r.signalingSession.sendWebRtcMediaNotificationAsync(e):Promise.reject(new Error("no signaling session"))}}})}return e.prototype.processOfferAsync=function(e){var t=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_PROCESSING_STARTED),this.mediaSession.processOfferAsync(e).then(function(e){return t.signalingSession.setOfferAnswerGenerationTimestamps(t.operationNames.OFFER_PROCESSING_ENDED),e})},e.prototype.createAnswerAsync=function(e){var t=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_GENERATION_STARTED),this.mediaSession.createAnswerAsync(e).then(function(n){return t.signalingSession.setOfferAnswerGenerationTimestamps(t.operationNames.ANSWER_GENERATION_ENDED),e||(t.operationNames=i.RENEGOTIATION),n})},e.prototype.createOfferAsync=function(){var e=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_GENERATION_STARTED),this.mediaSession.createOfferAsync().then(function(t){return e.signalingSession.setOfferAnswerGenerationTimestamps(e.operationNames.OFFER_GENERATION_ENDED),t})},e.prototype.processAnswerAsync=function(e,t,n){var r=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_PROCESSING_STARTED),this.mediaSession.processAnswerAsync(e,t,n).then(function(){r.signalingSession.setOfferAnswerGenerationTimestamps(r.operationNames.ANSWER_PROCESSING_ENDED),r.operationNames=i.RENEGOTIATION})},e.prototype.completeNegotiationAsync=function(){var e=this;return this.mediaSession.completeNegotiationAsync().then(function(t){return e.signalingSession.setOfferAnswerGenerationTimestamps(i.NEGOTIATION_COMPLETED),t})},e.prototype.sendDtmf=function(e){return this.mediaSession.sendDtmf?this.mediaSession.sendDtmf(e):Promise.reject("Not Implemented")},e.prototype.getExtensionsManager=function(){return this.mediaSession.getExtensionsManager?this.mediaSession.getExtensionsManager():null},e.prototype.reconnectAsync=function(){return this.mediaSession.reconnectAsync()},e.prototype.completeEscalationAsync=function(){return this.mediaSession.completeEscalationAsync()},e.prototype.rejectEscalationAsync=function(e){return this.mediaSession.rejectEscalationAsync(e)},e.prototype.getAcceptedTypes=function(){return this.mediaSession.getAcceptedTypes()},e}();t.default=r},function(e,t,n){"use strict";var i,r,o,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},u=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},d=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var p,h,f=n(6),g=n(71),m=n(48),_=n(28),v=n(49),y=n(50),S=n(9),E=n(51),T=n(52),C=n(20),I=n(94),A=n(29),b=n(37),O=n(39),R=n(53),P=n(99),N=n(23),w=n(21),M=[1,2,9,10,11,12,30,27,28];!function(e){e[e.MediaCreateOffer=1]="MediaCreateOffer",e[e.SignalingStartNegotiation=2]="SignalingStartNegotiation",e[e.SignalingRenegotiationAnswer=3]="SignalingRenegotiationAnswer",e[e.MediaProcessAnswer=4]="MediaProcessAnswer",e[e.MediaProcessOffer=5]="MediaProcessOffer",e[e.MediaCreateAnswer=6]="MediaCreateAnswer",e[e.SignalingAcceptRenegotiation=7]="SignalingAcceptRenegotiation",e[e.SignalingMediaAcknowledgement=8]="SignalingMediaAcknowledgement"}(p||(p={})),function(e){e[e.Undefined=0]="Undefined",e[e.Hold=1]="Hold",e[e.Resume=2]="Resume"}(h||(h={}));var k=((r={})[0]=[1,2,8,6,10],r[1]=[2,6,7,10],r[2]=[3,6,7,9,10],r[3]=[6,7,4,5,10],r[6]=[7],r[7]=[],r[8]=[1,10,2,6,7],r[4]=[6,7,3,5,10],r[5]=[6,7,3,4,10],r[9]=[3,6,7,10],r[10]=[3,6,7,9,4,5,10],r),D="CallEndReasonMediaError",L="CallEndReasonMediaPermissionError",U="CallEndReasonMediaDropDuringConnectError",x="CallEndReasonMediaDropAfterConnectError",F="CallEndReasonMediaOfferProcessingError",H="RetargetNotSupported",G=((o={})[0]="Audio",o[1]="Video",o[3]="ScreenShare",o[4]="Data",o),j=function(e){function t(n,i,r,o,a,s,c,l,u,d){var p=e.call(this)||this;return p.signalingAgent=n,p.mediaAgent=i,p.logger=r,p.telemetryService=o,p.currentUserSkypeIdentity=a,p.callSettings=s,p.threadId=c,p.ecsProvider=d,p.participants=[],p.isServerMuted=!1,p.isSpeakerMuted=!1,p.isVideoOn=!1,p.isScreenSharingOn=!1,p.callStartedAt=null,p.callHeldAt=null,p.callType=-1,p.failureType=2,p.contentSharingSessions=[],p.endpoints={endpointDetails:[]},p.remoteRequestedHoldState=!1,p.requestedHoldState=!1,p.requestedAudioState=!0,p.requestedVideoState=!1,p.requestedScreenSharingState=!1,p.canToggleAudio=!0,p.canToggleVideo=!0,p.canToggleScreenSharing=!0,p.isHoldInProgress=!1,p.callSetupFailed=!1,p.isSomeoneSharing=!1,p.isSomeoneStreamingVideo=!1,p.skipSharingModality=!1,p.skipVideoModality=!1,p.callGotConnected=!1,p.mediaRelayWhiteListingIssue=!1,p.sharedScreen=null,p.disposed=!1,p._isAudioStreamConnected=!1,p._wasAudioStreamConnected=!1,p._callInLobby=!1,p._callIsSetupComplete=!1,p._transferState=0,p._parkState=0,p._muteState=A.ParticipantMuteState.Unmuted,p._origin=0,p.startVM=function(e,n,i,r){var o=t.createMediaContent(n);return p.signalingSession.startOutgoingCall(o,i,{voicemailResourcePath:e.callVoicemailStartOptions.voicemailResourcePath,voicemailItemId:e.callVoicemailStartOptions.voicemailItemId,callToVoicemail:!0},Date.now()-r)},p.startOutgoingCall=function(e,n,i,r){var o=t.createMediaContent(n),a=1==(1&e.callStartOptions.muteFlags);a&&p.muteUnmute(!0);var s={suppressDialout:!e.callStartOptions.ringOthers,onBehalfOf:p.onBehalfOfMri,muted:a,invitationType:e.invitationType,participantsToNudge:e.participantsToNudge,routingFlags:e.callStartOptions.routingFlags,parkContext:e.parkContext,pickupCode:e.pickupCode};return p.signalingSession.startOutgoingCall(o,i,s,Date.now()-r)},p.joinGivenConversation=function(e,n,i,r,o){var a=t.createMediaContent(n),s=1==(1&e.callStartOptions.muteFlags);return s&&p.muteUnmute(!0),p.signalingSession.joinGivenConversation(o,p.callId,a,i,Date.now()-r,{muted:s})},p.executeCallTransfer=function(e,t){p._setTransferState(1);var n=p._callOperationHandler.createPendingOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS);return t?p.signalingSession.transferCallAsync(e,t):p.signalingSession.transferCallAsync(e),n},p._getCallEndOperation=function(){return p._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.STOP_CALL)?p._callOperationHandler.waitForOperation(_.CALL_OPERATIONS.STOP_CALL):p._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.REJECT)?p._callOperationHandler.waitForOperation(_.CALL_OPERATIONS.REJECT):Promise.resolve()},p._onAcknowledgeError=function(e){p.logger.error("failed acknowledging call, callId = "+p.callId,e);var t=7;throw e&&"IncompatibleOffer"===e.name&&(t=47),p.callTelemetry.updateOperationData(_.CALL_OPERATIONS.ACKNOWLEDGE,{error:e}),p.stopInternal(t),e},p._onAcknowledgeSuccess=function(){return p.logger.debug("acknowledge done"),{code:1,success:!0}},p._processOfferedModalities=function(e){p.handleOfferedModalities(e);var t=1===p.callType?{modalityOverride:e}:void 0;return p.updateMediaModalities(t)},p._processOffer=function(e){return p.mediaSession.processOfferAsync(e)},p._handleOfferProcessingError=function(e){return e&&"IncompatibleOffer"===e.name&&p.signalingSession.supportsNewOfferRequest()?(p.newOfferRequestDeferred=m.defer(),p.attachToCallAndGetOffer.promise.then(function(){return p.mediaSession.rejectNegotiationAsync(e)}).then(function(){return p.signalingSession.requestNewOffer(p.mediaSession.getAcceptedTypes())}).then(function(){return p.newOfferRequestDeferred.promise}).then(p._processOffer)):Promise.reject(e)},p._trySendProvisionalMediaAnswer=function(){return Promise.resolve(void 0).then(function(){return p.mediaSession.createAnswerAsync(!0)}).then(function(e){return e.blob?(p.mediaAcknowledgmentOperation=p._callOperationHandler.createPendingOperation(_.CALL_OPERATIONS.MEDIA_ACKNOWLEDGMENT),p.signalingSession.setProvisionalAnswerAsync(t.createMediaContent(e)).then(function(){return p.mediaAcknowledgmentOperation})):Promise.resolve(void 0)})},p.checkForCallIdUpdate=function(e){if(p.callId!==e){p.setCallId(e);try{p.event("callIdChanged").raise(p.callId)}catch(e){p.logger.error("Error raising call ID change: "+e)}p.callStats.setCallId(p.callId),p.raiseChanged()}},p.handleRemoteParticipantStateInOneToOneCall=function(){if(1===p.callType&&3===p.state){var e=p.participants[0];e&&e.setState(3)}},p.handleRemoteParticipantJoinedInOneToOneCall=function(e){if(1===p.callType&&3===p.state){var t=p.participants.filter(function(t){return t.id===e.id})[0];t?t.setState(3):p.logger.warn("HanldeRemoteParticipantJoinedInOneToOneCall: unable to find particpant "+e.id)}},p.handleRemoteParticipantStateInObservingCall=function(e,t){var n=t.endpointDetails&&t.endpointDetails[0].isLobby;if(8===p.state){var i=n?7:3;e.setState(i)}},p._setTransferState=function(e){p.transferState!==e&&(p.logger.log("Transfer: state set: "+e),p._transferState=e,p.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_TRANSFER_STATE,{state:e}),p.raiseChanged())},p._setParkState=function(e){p.parkState!==e&&(p.logger.log("Parking: state set: "+e),p._parkState=e,p.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_PARK_STATE,{state:e}),p.raiseChanged())},p.updateLocalParticipantEndpoints=function(e){var t=[];f.each(e,function(e){t.push({clientVersion:e.clientVersion,participantId:e.participantId,endpointId:e.endpointId,endpointType:e.endpointType,endpointMetadata:e.endpointMetadata,originalId:e.originalId,mediaStreams:e.mediaStreams,capabilities:e.capabilities})}),p.endpoints.endpointDetails=t},p.state=0,p.terminatedReason=0,p.callStats=new C.CallTelemetryBuilder,p.callTelemetry=new v.default(p.logger),p.collectCallStatsDeferred=m.defer(),p.setCallId(l),p.setThreadId(c),p.setParticipantId(u),p.logger=p.logger.createChild(function(){return"PluginlessCall["+p.callId+"]"}),p.initializeSignalingSession(u),p.logger.info("Call created with participantId "+p.participantId),p.streamManager=new R.PluginlessCallStreamManager(p.participantId,null,p.callStats.localStats,p.logger),p._callOperationHandler=new T.default(p.logger,p.callTelemetry),p._participantOperationHandler=new T.default(p.logger,p.callTelemetry),p}return a(t,e),Object.defineProperty(t.prototype,"callId",{get:function(){return this._callId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transferState",{get:function(){return this._transferState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parkState",{get:function(){return this._parkState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participantId",{get:function(){try{this._participantId=this.signalingSession.participantManager.localParticipant.participantId||this._participantId}catch(e){this.logger.error("Error updating participantId: "+e)}return this._participantId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this.localSignalingParticipant.role},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMuted",{get:function(){return this._muteState===A.ParticipantMuteState.Muted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tenantId",{get:function(){return this.localSignalingParticipant.tenantId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaLegId",{get:function(){return this._mediaLegId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isIncomingOneOnOneVideoCall",{get:function(){return 1===this.callType&&this.isSomeoneStreamingVideo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaStreams",{get:function(){return this.streamManager.streams},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChanged())},enumerable:!0,configurable:!0}),t.prototype.setMediaLegId=function(e){this._mediaLegId=e,this.callStats.setMediaLegId(e)},t.prototype.setCallId=function(e){this.callTelemetry.setCallId(e),this._callId=e},t.prototype.setEndpointId=function(e){this._endpointId=e,this.callTelemetry.setEndpointId(e),this.callStats.setEndpointId(e)},t.prototype.setFailureType=function(e){this.callTelemetry.setFailureType(e),this.failureType=e},t.prototype.setParticipantId=function(e){this._participantId=e,this.callTelemetry.setParticipantId(this.participantId)},t.prototype.setThreadId=function(e){this.logger.log("Set threadId:"+e),this.threadId=e,this.callTelemetry.setThreadId(e)},t.prototype.setMessageId=function(e){this.logger.log("Set messageId:"+e),this.messageId=e,this.callTelemetry.setMesageId(e)},t.prototype.setCallType=function(e){this.logger.log("Set callType:"+e),this.callType=e,this.callTelemetry.setCallType(e)},t.prototype.init=function(e){var t={teamsMessageId:e.messageId,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration,meetingInfo:e.meetingInfo,emergencyContent:e.emergencyContent?JSON.parse(e.emergencyContent):void 0,broadcastContext:e.broadcastContext,endpointMetadata:e.endpointMetadata};this.setMessageId(e.messageId),this.onBehalfOfMri=e.onBehalfOf,e.threadId&&(this.setThreadId(e.threadId),this.signalingSession.setThreadId(e.threadId)),this.signalingSession.setCallOptions(t),this.setupSharingEventHandlers(),e.transferContext&&(this.logger.log("Transfer: Call.init, set transferContext",e.transferContext),this.signalingSession.setTransferContext(e.transferContext.context),1===e.transferContext.transferType&&(this._origin=2),0!==e.transferContext.transferType&&e.transferContext.transferType||(this._origin=1),e.transferContext.context.callAcceptanceCallback?this._transferredCallAcceptanceCallback=e.transferContext.context.callAcceptanceCallback:this.logger.warn("Transfer: Missing transferred call acceptance callback")),this.raiseChanged()},t.prototype.setVideoContainer=function(e,t){var n=this;return this.localVideoContainer=e,e?this.isVideoOn?this.startVideoSafe("setVideoContainer").then(function(){t&&n.localVideoRenderer.setScalingMode(w.toMediaAgentScalingMode(t.scalingMode))}):Promise.resolve():this.stopVideo()},t.prototype.startVideo=function(e){return this.startStopVideo(!0)},t.prototype.stopVideo=function(e){return this.startStopVideo(!1)},t.prototype.setVideoEffects=function(e){return Promise.reject(60)},t.prototype.getVideoEffectsCapability=function(){return Promise.reject(60)},t.prototype.dumpVideoSourceImages=function(){return Promise.reject(60)},t.prototype.hold=function(e){return 4===this.state?(this.logger.warn("Trying to put a call on hold which is already held state, early resolving the promise"),Promise.resolve(void 0)):3===this.state||5===this.state||10===this.state?this.setHold(!0):(this.logger.warn("Trying to hold a call in an invalid state: "+this.state),Promise.reject("Trying to hold a call in an invalid state: "+this.state))},t.prototype.unhold=function(e){return 3===this.state?(this.logger.warn("Trying to resume a call which is already in connected state, early resolving the promise"),Promise.resolve(void 0)):4===this.state?(this.isSomeoneStreamingVideo=!0,this.setHold(!1)):(this.logger.warn("Trying to resume a call in an invalid state: "+this.state),Promise.reject("Trying to resume a call in an invalid state: "+this.state))},t.prototype.updateEndpointMetadata=function(e){return this.signalingSession.updateEndpointMetadata(e)},t.prototype.sendDtmfTone=function(e){if(this.mediaSession){var t=this.toneToString(e);return t?(this.logger.info("DtmfTone: <omitted>"),Promise.resolve(this.mediaSession.sendDtmf(t))):Promise.reject(new Error("Unsupported DtmfTone"))}return Promise.reject(new Error("no mediaSession"))},t.prototype.setAudioUsageMode=function(e){return Promise.reject(60)},t.prototype.setHold=function(e){var t=this;if(!this.canToggleAudio||this.callHoldResumeDeferred)return Promise.reject(new Error("can not set hold as it is already in progress"));this.callHoldResumeDeferred=m.defer(),this.isHoldInProgress=e,this.canToggleAudio=!1,this.canToggleVideo=!1,this.canToggleScreenSharing=!1,this.requestedHoldState=e;var n=function(){t.canToggleAudio=!0,t.canToggleScreenSharing=!0,t.canToggleVideo=!0};return Promise.resolve().then(function(){return e||t.prepareModalitiesForResume(),t.updateMediaModalities()}).then(function(n){e&&t.prepareModalitiesForHold(),t.updateVideoState(n),t.updateScreenSharingState(n),e&&5===t.state&&t.setCallState(4)}).then(n,function(i){var r=e?_.CALL_OPERATIONS.HOLD:_.CALL_OPERATIONS.UNHOLD;t.callTelemetry.updateOperationData(r,{error:i}),t.logger.error("Failed setting hold state to "+e,i),n(),t.callHoldResumeDeferred.reject(new Error("Failed setting hold state to "+e)),t.callHoldResumeDeferred=null}),this.callHoldResumeDeferred.promise},t.prototype.transferCall=function(e){return this.logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)},t.prototype.callBlindTransfer=function(e){return this.executeCallTransfer(e)},t.prototype.callSafeTransfer=function(e){return this.executeCallTransfer(e)},t.prototype.callConsultativeTransfer=function(e){var t=e.getCallReplacementDetails(),n=e.participants[0]&&e.participants[0].id;return this.executeCallTransfer(n,t)},t.prototype.park=function(e){var t=1===e?"sharedLinePark":"teamPark";this._setParkState(1);var n=this._callOperationHandler.waitForOperation(_.CALL_OPERATIONS.PARK_CALL);return this.signalingSession.parkCallAsync(t),n},t.prototype.getCallReplacementDetails=function(){return this.signalingSession.getCallReplacementDetails()},t.prototype.getTechnicalInformationJson=function(){return Promise.reject(60)},t.prototype.prepareModalitiesForResume=function(){return u(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.requestedScreenSharingState&&this.mediaSession.selectSharingSource(this.sharedScreen,this.sharingEventHandlers),this.requestedVideoState?[4,this.turnOnLocalVideoPreview()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.prepareModalitiesForHold=function(){return u(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.turnOffLocalVideoPreview()];case 1:return e.sent(),[2]}})})},t.prototype.updateVideoState=function(e){this.setVideoOn(e.video===this.mediaAgent.constants.MEDIA_STATE.sendReceive||e.video===this.mediaAgent.constants.MEDIA_STATE.send)},t.prototype.updateScreenSharingState=function(e){this.setScreenSharingOn(e.sharing===this.mediaAgent.constants.MEDIA_STATE.send)},t.prototype.setupSharingEventHandlers=function(){var e=this;this.sharingEventHandlers={onSharingStateChanged:function(n){e.callStats.localStats.screenShare.streamStateChanged(n);var i={mediaType:3,mediaDirection:1,mediaStreamState:t.streamingStatetoMediaStreamState(n)};e.event("mediaStreamStateChanged").raise(i),"stopped"===n&&e.stopScreenSharing(),e.logger.log("Sharing stream state moved to "+n)},onSharingSourceLost:function(){e.stopScreenSharing()}}},t.prototype.waitForMediaStream=function(e){var t=this.callSettings.startModalityMediaTimeoutInMs>0?m.timedDefer(this.callSettings.startModalityMediaTimeoutInMs,G[e]+" media connection timed out after "+this.callSettings.startModalityMediaTimeoutInMs+"ms"):m.defer(),n=this.on("mediaStreamStateChanged",function(n){if(f.isMatch(n,{mediaType:e,mediaDirection:1}))switch(n.mediaStreamState){case 2:case 1:t.resolve();break;case 3:t.reject(new Error(G[e]+" stream was stopped"));break;case 4:t.reject(new Error(G[e]+" stream failed"))}}),i=function(){return n.dispose()};return t.promise.then(i,function(e){throw i(),e})},t.prototype.startScreenSharing=function(e){var t=this,n=e&&e.getId();if(!this.canToggleScreenSharing)return Promise.reject(new Error("cannot start screen sharing"));this.screenSharingRenegotiationDeferred&&(this.logger.error("StartScreenSharing called before the renegotiation deferred for the previous one has been closed."),this.screenSharingRenegotiationDeferred.resolve()),this.screenSharingRenegotiationDeferred=m.defer(),this.callStats.localStats.newSession(3),this.callStats.localStats.screenShare.start(),this.requestedScreenSharingState=!0,this.skipSharingModality&&(this.logger.info("Sharing modality was skipped till now. Adding it now."),this.skipSharingModality=!1),this.canToggleScreenSharing=!1;var i=function(){t.canToggleScreenSharing=!0};return this.mediaAgent.getScreenSharingManager().enumerateScreensAsync().then(function(e){if(0===e.length)throw new Error("unable to start screen sharing, no screens to share");if(t.sharedScreen=f.find(e,function(e){return!n||e.getId()===n}),!t.sharedScreen)throw new Error("unable to start screen sharing, invalid monitorId");t.callStats.localStats.screenShare.event(C.MediaSenderEvent.SelectSource),t.mediaSession.selectSharingSource(t.sharedScreen,t.sharingEventHandlers);var r=t.waitForMediaStream(3),o=new Promise(function(e,n){Promise.all([r,t.screenSharingRenegotiationDeferred.promise]).then(e).catch(n)});return t.updateMediaModalities().then(function(){return t.setScreenSharingOn(!0),i(),o.then(function(){})})}).catch(function(e){t.callTelemetry.updateOperationData(_.CALL_OPERATIONS.START_SCREEN_SHARING,{error:e}),t.setScreenSharingOn(!1),t.requestedScreenSharingState=!1,i(),t.mediaSession.selectSharingSource(null);var n=e.error;throw n&&n.code===A.jsCallEndCodes.GlareError&&n.subCode===A.jsCallEndSubCodes.SharingStolenError?(t.callStats.localStats.screenShare.stop(),t.logger.log("expected starting screen sharing failure. Stolen screen sharing: ",e)):t.logger.error("failed starting screen sharing",e),e})},t.prototype.stopScreenSharing=function(){var e=this;if(!this.canToggleScreenSharing)return Promise.reject(new Error("cannot stop screen sharing"));this.callStats.localStats.screenShare.stop(),this.screenSharingRenegotiationDeferred&&(this.screenSharingRenegotiationDeferred.reject({reason:1}),this.screenSharingRenegotiationDeferred=null),this.requestedScreenSharingState=!1,this.canToggleScreenSharing=!1;var t=function(){e.canToggleScreenSharing=!0};return this.updateMediaModalities().then(function(){return e.setScreenSharingOn(!1)}).then(t,function(n){throw e.callTelemetry.updateOperationData(_.CALL_OPERATIONS.STOP_SCREEN_SHARING,{error:n}),t(),n})},t.prototype.shareSystemSound=function(e){return Promise.reject(60)},t.prototype.mute=function(){return this.muteUnmute(!0)},t.prototype.unmute=function(){return this.muteUnmute(!1)},t.prototype.muteSpeaker=function(){return this.muteUnmuteSpeaker(!0)},t.prototype.unmuteSpeaker=function(){return this.muteUnmuteSpeaker(!1)},t.prototype.muteParticipants=function(e,n){var i=this;this.logger.info("muteParticipants: muteScope: "+e+", callParticipants count: "+n.length);var r=t.convertMuteScope(e);if(void 0===r)return this.logger.error("Unrecognized "+e+" callId: "+this.callId),Promise.reject(new Error("Unrecognized muteScope"));var o=[];return n.forEach(function(e){o.push(e.id)}),Promise.resolve().then(function(){return i.signalingSession.muteAsync(r,o)}).catch(function(e){throw i.callTelemetry.updateOperationData(_.CALL_OPERATIONS.MUTE_PARTICIPANTS,{error:e}),i.logger.error("callMuteParticipants() failed, callId = "+i.callId+", error = "+e),e})},t.prototype.startAudio=function(e){return u(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:if(3!==this.state)return this.logger.error("Cannot startAudio when call is not connected"),[2,Promise.reject(60)];if(this.requestedAudioState=!0,!this.requestedVideoState)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.turnOnLocalVideoPreview()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),this.logger.error("Error turning on video preview before enabling audio: "+e),[2,Promise.reject(25)];case 4:return[2,this.startStopAudio(!0)]}})})},t.prototype.stopAudio=function(e){return u(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:return 3!==this.state?(this.logger.error("Cannot stopAudio when call is not connected"),[2,Promise.reject(60)]):(this.requestedAudioState=!1,[4,this.startStopAudio(!1)]);case 1:return e=t.sent(),[4,this.turnOffLocalVideoPreview()];case 2:return t.sent(),[2,e]}})})},t.prototype.setMaxVideoChannels=function(e){return Promise.reject(60)},t.prototype.stop=function(e){return void 0===e&&(e=!1),6===this.state?(this.logger.warn("Trying to stop a call which is already Disconnecting, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnecting state"))):7===this.state?(this.logger.warn("Trying to stop a call which is already Disconnected, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnected state"))):this.disposed?Promise.reject("Call already ended"):this.stopInternal(0,e)},t.prototype.stopInternal=function(e,t){var n=this;return void 0===e&&(e=0),void 0===t&&(t=!1),6===this.state?(this.logger.warn("Trying to stop a call which is already Disconnecting, callId = "+this.callId),this.disconnectingPromise):7===this.state?(this.logger.warn("Trying to stop a call which is already Disconnected, callId = "+this.callId),this.disconnectingPromise):(this.setCallState(6),this.disconnectingPromise=Promise.all([this.signalingSession.endAsync(this.getRejectionInfoFromTerminatedReason(e),t),this.cleanUp()]).catch(function(e){throw n.callTelemetry.updateOperationData(_.CALL_OPERATIONS.STOP_CALL,{error:e}),n.logger.error("Error when stopping the call, callId = "+n.callId+", error = "+e),n.setCallState(7),e}).then(function(){return Promise.resolve(void 0)}),this.disconnectingPromise)},t.prototype.cleanUp=function(){var e=this;if(this.disposeLocalVideoRenderer(),this.localVideoContainer=null,this.disposed||!this.mediaSession)return Promise.resolve(void 0);this.disposed=!0,this.disposeContentSharingSessions(),this._getCallEndOperation().then(function(){e._callOperationHandler.rejectPendingOperations(61),e._participantOperationHandler.rejectPendingOperations(47),e.callTelemetry.setTerminationState(e.state),e.callTelemetry.setTerminationReason(e.terminatedReason),e.reportCallStats()});var t=this.mediaSession;this.mediaSession=null,this.streamManager.setMediaSession(this.mediaSession);var n=t.terminate();return this.isVideoOn=!1,n.then(function(){return e.collectCallStats(t)},function(n){var i=function(){return Promise.reject(n)};return e.collectCallStats(t).then(i,i)})},t.prototype.createContentSharingSession=function(e,t,n,i){var r=this;this.logger.info("Create content sharing session");var o=new P.default(this.callTelemetry,this.logger.createChild("PluginlessContentSharingSession"),this.signalingSession,e,t,i,n);return this.contentSharingSessions.push(o),o.changed(function(){return r.removeContentSessionIfEnded(o)}),this.event("contentSharingChanged").raise(),Promise.resolve(o)},t.prototype.stopWithBeacon=function(){return 6===this.state||7===this.state||this.signalingSession.endWithBeacon()},t.prototype.disposeContentSharingSessions=function(){var e=this;this.contentSharingSessions.forEach(function(t){t.dispose(),e.removeContentSessionIfEnded(t)}),this.event("contentSharingChanged").raise()},t.prototype.removeContentSessionIfEnded=function(e){7!==e.contentSharingStatus&&8!==e.contentSharingStatus||(this.logger.info("stopping the content sharing session."),f.remove(this.contentSharingSessions,function(t){return t.contentSharingGuid===e.contentSharingGuid}).length&&this.event("contentSharingChanged").raise())},t.prototype.getRejectionInfoFromTerminatedReason=function(e){switch(e){case 53:case 4:return{code:A.jsCallEndCodes.MediaError,subCode:this._wasAudioStreamConnected?A.jsCallEndSubCodes.MediaDropAfterConnect:A.jsCallEndSubCodes.MediaDropDuringConnect,phrase:this._wasAudioStreamConnected?x:U};case 47:return{code:A.jsCallEndCodes.MediaError,subCode:A.jsCallEndSubCodes.MediaOfferProcessingError,phrase:F};case 38:return{code:A.jsCallEndCodes.MediaError,subCode:A.jsCallEndSubCodes.MediaRenegotiationError,phrase:H};case 25:return{code:A.jsCallEndCodes.UnknownError,subCode:A.jsCallEndSubCodes.MediaUnknownError,phrase:D};case 58:return{code:A.jsCallEndCodes.MediaError,subCode:A.jsCallEndSubCodes.MediaPermissionError,phrase:L}}return null},t.prototype.acknowledge=function(e,t){var n=this;if(0!==this.state&&8!==this.state)throw new Error("Trying to acknowledge a call that has already been acted on");if(this.attachToCallAndGetOffer=m.defer(),this.logger.debug("acknowledging..."),this.setCallType(e.isMultiParty?2:1),this.callTelemetry.setDirection(v.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLEE),this.callerMri=e.callerId,this.transferorMri=e.transferorId,this.transferorType=e.transferorType,this.transferorDisplayName=e.transferorDisplayName,this.incomingCallType=e.callType,this.consultativeCallId=e.consultativeCallId,this.callQueueInfo=e.callQueueInfo,this.callStats.localStats.startCall(),this.signalingSession.processIncomingCallRequest(e,t),this.signalingAgent.resolvePotentialCallConflict(this.signalingSession)===this.signalingSession)return Promise.reject({code:7,success:!1});this.signalingSession.sendAttachToCall().then(function(){return n.setCallState(1)}),this.initializeMediaSession(),this.callStats.setParticipantId(this.participantId),this.onBehalfOfMri=this.signalingSession.onBehalfOf;var i=this.signalingSession.getInitialMediaOfferFromIncomingCallPayload();return(i?Promise.resolve(i):this.attachToCallAndGetOffer.promise).then(this._processOffer).catch(this._handleOfferProcessingError).then(this._processOfferedModalities).then(this._trySendProvisionalMediaAnswer).then(this._onAcknowledgeSuccess).catch(this._onAcknowledgeError)},t.prototype.accept=function(e){return u(this,void 0,void 0,function(){var n,i,r,o,a;return d(this,function(s){switch(s.label){case 0:if(1!==this.state)throw new Error("Only calls in Notified state can be accepted");n=this._callOperationHandler.createPendingOperation(_.CALL_OPERATIONS.CONNECT_CALL),this.callStats.localStats.audio.start(),this.setMuted(e.muted?A.ParticipantMuteState.Muted:A.ParticipantMuteState.Unmuted),this.setCallState(2),s.label=1;case 1:return s.trys.push([1,9,,10]),void 0===e.answerMediaType&&(e.answerMediaType=e.withVideo?1:0),1!==e.answerMediaType||this.skipVideoModality?[3,3]:[4,this.startVideoSafe("accept call")];case 2:s.sent(),s.label=3;case 3:return 2===e.answerMediaType&&(this.requestedAudioState=!1),[4,this.updateMediaModalities()];case 4:return i=s.sent(),r=this.getSignalingMediaTypes(i),[4,this.mediaSession.createAnswerAsync(!1)];case 5:return o=s.sent(),[4,this.signalingSession.acceptAsync(t.createMediaContent(o),r)];case 6:return s.sent(),[4,n];case 7:return s.sent(),this.handleRemoteParticipantStateInOneToOneCall(),[4,this.completeNegotiationAsync()];case 8:return s.sent(),[3,10];case 9:throw a=s.sent(),this.callTelemetry.updateOperationData(_.CALL_OPERATIONS.ACCEPT,{error:a}),this.logger.error("failed accepting call, callId = "+this.callId,a),a;case 10:return[2]}})})},t.prototype.reject=function(){return 1!==this.state?Promise.reject(60):this.stopInternal()},t.prototype.join=function(e,t){return void 0===t&&(t={}),this.callTelemetry.setDirection(v.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.JOIN),this.joinOrStartCall({callStartOptions:t},this.joinGivenConversation,e.conversationUrl)},t.prototype.start=function(e){return void 0===e&&(e={}),this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),this.joinOrStartCall({callStartOptions:e},this.startOutgoingCall)},t.prototype.startCallToVoicemail=function(e){return this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),this.joinOrStartCall({callVoicemailStartOptions:e},this.startVM)},t.prototype.joinCallWithoutCallModality=function(e,t){return void 0===t&&(t={}),this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.SUBSCRIBE),0!==this.state?(this.logger.warn("Trying to subscribe to a call that has already been acted on"),Promise.reject(60)):(this.setCallState(8),this.signalingSession.subscribeToCall(e.conversationUrl,this.callId))},t.prototype.joinLightWeightMeeting=function(e,t){return void 0===t&&(t={}),this.callTelemetry.setDirection(v.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.JOIN_FOR_LIGHT_WEIGHT_MEETING),Promise.reject(60)},t.prototype.startLightWeightMeeting=function(e){return void 0===e&&(e={}),this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),Promise.reject(60)},t.prototype.startCallWithNudge=function(e,t){if(void 0===t&&(t={}),this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),this.logger.info("startCallWithNudge for participants: "+e),this.participants.length)return Promise.reject(48);var n={};return n.callStartOptions=t,n.invitationType=g.CA_CONSTANTS.INVITATION_TYPE.NUDGE,n.participantsToNudge=e,this.joinOrStartCall(n,this.startOutgoingCall)},t.prototype.startAndUnpark=function(e,t,n){var i=this;void 0===n&&(n={}),this.callTelemetry.setDirection(v.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(v.SELF_PARTICIPANT_ROLE.CALLER),this.logger.info("startAndUnpark for context: "+e+", pickupCode :"+t);var r={};return r.callStartOptions=n,r.parkContext=0===e?_.UNPARK_CODE.PARK:_.UNPARK_CODE.SHARED_LINE,r.pickupCode=t,this.addParticipant("4:"+r.parkContext).catch(function(e){return i.logger.log("Failed to add participant to unparked call")}),this.joinOrStartCall(r,this.startOutgoingCall)},t.prototype.admitParticipant=function(e){var t=this.generateAliasedMri(e),n=this.getParticipant(t);return n?this.admitParticipantToCall(n):Promise.reject(43)},t.prototype.callMeBack=function(e,t){var n=this.generateAliasedMri("8:"+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri);return this.addCallMeBackParticipant(e,t||n)},t.prototype.addParticipant=function(e,t){return void 0===t&&(t={}),u(this,void 0,void 0,function(){var n,i;return d(this,function(r){switch(r.label){case 0:return this.logger.info("addParticipant - participantId: "+e+", payload: "+t),n=this.generateAliasedMri(e,t.sipUri),i=this.getOrCreateParticipant(n),this.raiseChanged(),0!==i.state&&4!==i.state?[3,2]:[4,this.addParticipantToCall(i,t.participantInvitationData,t.threadId,t.messageId)];case 1:r.sent(),r.label=2;case 2:return[2,i]}})})},t.prototype.nudgeParticipants=function(e,t,n){return void 0===n&&(n={}),this.logger.info("nudgeParticipants: context = "+e),2!==this.state&&3!==this.state?Promise.reject(48):this.signalingSession.nudgeParticipantsAsync(t,n.participantInvitationData,n.threadId,n.messageId)},t.prototype.removeParticipant=function(e){return this.signalingSession.removeParticipantAsync({id:e})},Object.defineProperty(t.prototype,"dominantSpeakerInfo",{get:function(){return this.internalDominantSpeakerInfo||{speakerList:this.participants.filter(function(e){return 3===e.state}).map(function(e){return e.id}),timestamp:null}},set:function(e){this.internalDominantSpeakerInfo=e},enumerable:!0,configurable:!0}),t.prototype.disposeLocalVideoRenderer=function(){return this.localVideoRenderer&&(this.localVideoRenderer.dispose(),this.localVideoRenderer=null),Promise.resolve(void 0)},t.prototype.startVideoSafe=function(e){var t=this;return this.startVideo().catch(function(n){t.logger.warn("Could not start video from "+e+": callId = "+t.callId,n)})},t.prototype.rejectPromiseChain=function(){this.stop().then(function(){throw new Error("Prevent further actions on existing call")})},t.prototype.joinOrStartCall=function(e,t,n){return u(this,void 0,void 0,function(){var i,r,o,a,s,c,l,u,p,h,f;return d(this,function(d){switch(d.label){case 0:if(0!==this.state&&8!==this.state)throw new Error("Trying to start a call that has already been acted on");if(this.signalingAgent.resolvePotentialCallConflict(this.signalingSession)===this.signalingSession)return[2,Promise.reject(57)];i=Date.now(),this.callStats.localStats.startCall(),this.callStats.localStats.audio.start(),this.setCallType(1===this.participants.length&&8!==this.state?1:2),this.skipSharingModality=1===this.callType,this.logger.debug("Call Start: skipSharingModality="+this.skipSharingModality),this.setCallState(2),this.initializeMediaSession(),1!==this.callType||n||this.isOneToOnePSTNCall()||e.callVoicemailStartOptions||(this.isSomeoneStreamingVideo=!0),r=this._callOperationHandler.createPendingOperation(_.CALL_OPERATIONS.CONNECT_CALL),o=this._callOperationHandler.createPendingOperation(_.CALL_OPERATIONS.WAIT_FOR_ANSWER),a=e.callStartOptions,s=!!a&&(a.muted||1==(1&a.muteFlags)),this.setMuted(s?A.ParticipantMuteState.Muted:A.ParticipantMuteState.Unmuted),d.label=1;case 1:return d.trys.push([1,13,,14]),a?a.withVideo||4===a.videoDirection?[4,this.startVideoSafe("call start")]:[3,3]:[3,4];case 2:d.sent(),d.label=3;case 3:3===a.audioDirection&&(this.requestedAudioState=!1),2===a.screenshareDirection&&(this.requestedScreenSharingState=!0),d.label=4;case 4:return[4,this.updateMediaModalities()];case 5:return d.sent(),[4,this.mediaSession.createOfferAsync()];case 6:return c=d.sent(),l=this.getSignalingMediaTypes(this.calculateModalityDirections()),t(e,c,l,i,n),[4,this.muteUnmute(s)];case 7:return d.sent(),[4,this.muteUnmuteSpeaker(this.isSpeakerMuted)];case 8:return d.sent(),[4,o];case 9:return u=d.sent(),[4,this.mediaSession.processAnswerAsync(u,!1)];case 10:return d.sent(),[4,r];case 11:return d.sent(),[4,this.completeNegotiationAsync()];case 12:return p=d.sent(),this.logger.debug("completeNegotiationAsync => "+p),[3,14];case 13:throw h=d.sent(),this.callTelemetry.updateOperationData(_.CALL_OPERATIONS.CONNECT_CALL,{error:h}),f=0,h&&"permissionDeniedError"===h.type&&(f=58),this.callSetupFailed=!0,this.logger.error("Error in joinOrStartCall(), callId = "+this.callId,h),this.stopInternal(f,!1),f;case 14:return[2]}})})},t.prototype.addCallMeBackParticipant=function(e,n){var i=this,r=this._participantOperationHandler.waitForOperation(_.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),o={id:e,assertedId:n};return this.signalingSession.callMeBackAsync(o).then(function(){i.logger.debug("successfully executed call me back, participantId = "+e+", callId = "+i.callId),i._participantOperationHandler.resolveOperation(_.PARTICIPANT_OPERATIONS.CALL_ME_BACK,0,e)}).catch(function(n){i.callTelemetry.updateOperationData(_.PARTICIPANT_OPERATIONS.CALL_ME_BACK,{error:n},e),i.logger.debug("Call me back failed, participantId = "+e+", callId = "+i.callId+", error = "+n);var r=n.endCode?I.getTerminationCode(n.endCode.code,n.endCode.subCode):0,o=t.getParticipantReasonFromTerminatedReason(r);i._participantOperationHandler.rejectOperation(_.PARTICIPANT_OPERATIONS.CALL_ME_BACK,o,e)}),r},t.prototype.addParticipantToCall=function(e,n,i,r){return u(this,void 0,void 0,function(){var o,a,s,c,l,u;return d(this,function(d){switch(d.label){case 0:e.setState(1),o={id:e.mri},this.logger.debug("starting adding participant to call, participantId = "+e.id+", callId = "+this.callId),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.signalingSession.addParticipantAsync(o,n,i,r)];case 2:return a=d.sent(),this.logger.debug("successfully added participant to call, participantId = "+e.id+", callId = "+this.callId),this.signalingNotifications.onParticipantJoined(a),this.callTelemetry.recordOperationSuccess(_.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,null,e.id),[2,a];case 3:throw s=d.sent(),this.callTelemetry.updateOperationData(_.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:s},e.id),this.logger.debug("Participant was not added to call, participantId = "+e.id+", callId = "+this.callId+", error = "+s),l={reason:c=1},s.endCode&&(u=I.getTerminationCode(s.endCode.code,s.endCode.subCode),c=t.getParticipantReasonFromTerminatedReason(u),l.reason=c,l.code=s.endCode.code,l.subCode=s.endCode.subCode,e.callEndDiagnosticsInfo={callControllerCode:s.endCode.code,callControllerSubCode:s.endCode.subCode}),this.callTelemetry.recordOperationFailure(_.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,c,e.id),this._removeParticipant(o,c),c;case 4:return[2]}})})},t.prototype.admitParticipantToCall=function(e){var n=this,i={id:e.mri};return this.logger.debug("starting admitting participant to call, participantId = "+e.id+", callId = "+this.callId),this.signalingSession.admitParticipantAsync(i).then(function(){n.logger.debug("successfully admitted participant to call, participantId = "+e.id+", callId = "+n.callId)}).catch(function(i){n.callTelemetry.updateOperationData(_.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,{error:i},e.id),n.logger.debug("Participant was not admitted to call, participantId = "+e.id+", callId = "+n.callId+", error = "+i);var r=i.endCode?I.getTerminationCode(i.endCode.code,i.endCode.subCode):0,o=t.getParticipantReasonFromTerminatedReason(r);return Promise.reject(o)})},t.prototype.isOneToOnePSTNCall=function(){return 1===this.callType&&1===this.participants.length&&f.startsWith(this.participants[0].id,"4:")},t.prototype.updateMediaModalities=function(e){return void 0===e&&(e={}),u(this,void 0,void 0,function(){var t;return d(this,function(n){switch(n.label){case 0:return t=e.modalityOverride?e.modalityOverride:this.requestedHoldState||this.remoteRequestedHoldState?this.getMediaModalitiesForHold():this.calculateModalityDirections(e.offered),this.logger.info("Updating media modalities: "+JSON.stringify(t)),[4,this.mediaSession.configureModalitiesAsync(t)];case 1:return n.sent(),[2,t]}})})},t.prototype.calculateModalityDirections=function(e){var t={audio:this.calculateAudioDirection(),video:this.calculateVideoDirection(e?e.video:void 0),sharing:this.calculateSharingDirection()};return"inactive"===t.audio&&(t.video="inactive"),this.deleteExtraneousModalities(t),t},t.prototype.calculateAudioDirection=function(){return this.requestedAudioState?this.mediaSession.getAllowedModalities().audio.some(function(e){return e===N.streamDirections.send||e===N.streamDirections.sendReceive})?"sendrecv":"recvonly":"inactive"},t.prototype.calculateVideoDirection=function(e){var t=this.requestedVideoState,n=this.isSomeoneStreamingVideo||2===this.callType;return e&&(t=t&&("sendrecv"===e||"sendonly"===e),n=n&&("sendrecv"===e||"recvonly"===e)),t&&n?"sendrecv":t?"sendonly":n?"recvonly":"inactive"},t.prototype.calculateSharingDirection=function(){return this.requestedScreenSharingState?"sendonly":this.isSomeoneSharing||2===this.callType?"recvonly":void 0},t.prototype.getMediaModalitiesForHold=function(){var e={audio:"inactive",video:"inactive",sharing:"inactive"};return this.deleteExtraneousModalities(e),e},t.prototype.deleteExtraneousModalities=function(e){this.skipVideoModality&&(this.logger.info("deleteExtraneousModalities: skipping videoModality"),delete e.video),this.skipSharingModality&&(this.logger.info("deleteExtraneousModalities: skipping sharingModality"),delete e.sharing)},t.prototype.getSignalingMediaTypes=function(e){var t,n=this;return[e.audio&&"Audio",(t=e.video,(t===n.mediaAgent.constants.MEDIA_STATE.send||t===n.mediaAgent.constants.MEDIA_STATE.sendReceive)&&"Video"),e.sharing===this.mediaAgent.constants.MEDIA_STATE.send?"ScreenSharer":e.sharing===this.mediaAgent.constants.MEDIA_STATE.receive?"ScreenViewer":null].filter(function(e){return!!e})},t.createMediaContent=function(e){var t={blob:e.blob,contentType:e.contentType,mediaLegId:e.mediaLegId};return e.newOffer&&(t.newOffer=!0),t},t.prototype.generateAliasedMri=function(e,t){var n=e;return t&&(n+=";aliases=2:"+t),n},t.prototype.initializeSignalingSession=function(e){var n=this;if(!this.signalingSession){var i=g.CA_CONSTANTS.CALL_STATUS;this.localSignalingParticipant={id:this.generateAliasedMri("8:"+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri),displayName:this.currentUserSkypeIdentity.displayName,endpointDetails:[],languageId:null,participantId:e,endpointId:null},this.callStats.localStats.setLocalUserId(this.localSignalingParticipant.id),this._callOperationHandler&&this._callOperationHandler.resetOperationChain(),this.signalingNotifications={onCallStatusChanged:function(e,t){var r="onCallStatusChanged status: "+e;if(t&&(r+=", reason: "+JSON.stringify(t),void 0!==t.code&&(n.callEndDiagnosticsInfo={callControllerCode:t.code,callControllerSubCode:t.subCode})),n.logger.debug(r),n.callTelemetry.recordEvent(_.CALL_OPERATIONS.SIGNALING_STATE_CHANGED,{status:e,reason:t}),e===i.CONNECTING)n._transferredCallAcceptanceCallback&&(n.logger.info("Transfer: Invoke call acceptance callback for original call"),n._transferredCallAcceptanceCallback());else if(e===i.RINGING)2===n.audioStreamState?(n.setCallState(9),n.participants.forEach(function(e){return e.setState(6)})):n.participants.forEach(function(e){return e.setState(2)});else if(e===i.CONNECTED){n._callIsSetupComplete=!0;var o=f.find(n.localSignalingParticipant.endpointDetails,function(e){return n._endpointId===e.endpointId});o&&o.isLobby&&(n._callInLobby=!0),n._callInLobby?(n.logger.info("Call is inlobby.  Override Connected state from signaling agent"),n.setCallState(10)):(n.setCallState(3),n.handleRemoteParticipantStateInOneToOneCall()),n._callOperationHandler.maybeResolveOperation(_.CALL_OPERATIONS.CONNECT_CALL),n._reportTsCallingTelemetry(!0)}else if(e===i.LOCAL_TERMINATED||e===i.REMOTE_TERMINATED){var a=n.callSetupFailed?7:I.convertReason(t);1!==a&&(n.mediaRelayWhiteListingIssue&&(a=53),n.logger.error("Call "+n.callId+" terminated. Reject reason: "+JSON.stringify(t))),n.setCallState(7,a),n.participants.forEach(function(e){return e.setState(4)}),n.disconnectingPromise=n.cleanUp().catch(function(e){n.logger.error("Error when cleaning up the call, callId = "+n.callId+", error = "+e)})}},onOffer:function(e){n.logger.debug("onOffer: "+JSON.stringify(f.omit(e,"mediaContent"))),n.setMediaLegId(e.mediaContent.mediaLegId),n.callTelemetry.recordEvent(_.CALL_OPERATIONS.WEB_ON_OFFER,{isRenegotiation:!!e.renegotiation}),e.transferor&&e.transferor.details&&e.transferor.details.id&&(n.transferorMri=e.transferor.details.id),e.transferor&&e.transferor.transferorType&&(n.transferorType=e.transferor.transferorType),e.transferor&&e.transferor.details&&e.transferor.details.displayName&&(n.transferorDisplayName=e.transferor.details.displayName),e.renegotiation?(n.logger.debug("onOffer -> scheduling renegotiation"),n._callOperationHandler.executeChained(function(){return n.renegotiateOffer(e.mediaContent)},_.CALL_OPERATIONS.RENEGOTIATE_OFFER)):(n.logger.debug("onOffer -> resolving offer promise"),n.attachToCallAndGetOffer.resolve(e.mediaContent))},onNewOffer:function(e){n.newOfferRequestDeferred?(n.logger.debug("onOffer -> resolving offer promise"),n.newOfferRequestDeferred.resolve(e.mediaContent)):n.logger.warn("onNewOffer callback received but new offer was not requested")},onAnswer:function(e){n.logger.debug("onAnswer: "+JSON.stringify(f.omit(e,"mediaContent"))),n.setMediaLegId(e.mediaContent.mediaLegId),n.callTelemetry.recordEvent(_.CALL_OPERATIONS.WEB_ON_ANSWER,{isRenegotiation:!!e.renegotiation}),e.renegotiation?(n.logger.debug("onAnswer -> resolving renegotiation promise"),n.renegotiationAnswerDeferred.resolve(e.mediaContent)):(n.logger.debug("onAnswer -> resolving final answer promise"),e.provisional?n.mediaSession.processAnswerAsync(e.mediaContent,!0,e.remoteEndpointId):(n._callOperationHandler.maybeResolveOperation(_.CALL_OPERATIONS.WAIT_FOR_ANSWER,e.mediaContent),n.handleRemoteParticipantStateInOneToOneCall()))},onMediaAcknowledgementSuccess:function(e){n.logger.debug("onMediaAcknowledgementSuccess isRenegotiation: "+e),n._callOperationHandler.resolveOperation(_.CALL_OPERATIONS.MEDIA_ACKNOWLEDGMENT)},onMediaAcknowledgementFailure:function(e,t){n.logger.debug("onMediaAcknowledgementFailure isRenegotiation: "+e+" reason: "+t),n._callOperationHandler.rejectOperation(_.CALL_OPERATIONS.MEDIA_ACKNOWLEDGMENT,t)},onMediaRenegotiationRejection:function(e){n.logger.debug("onMediaRenegotiationRejection reason: "+e),n.renegotiationAnswerDeferred.reject(e)},onSelfParticipantUpdated:function(e){n.logger.info("onSelfParticipantUpdated"),n.updateLocalParticipant(e);var i=t.getStreamsFromEndpoints(e.endpointDetails);n.streamManager.updateStreams(i),n.raiseChanged()},onParticipantUpdated:function(e){n.logger.debug("onParticipantUpdated: "+JSON.stringify(e));var i=n.getOrCreateParticipant(e.id);if(i.displayName=e.displayName,2===n.callType){var r=t.getStreamsFromEndpoints(e.endpointDetails);i.updateStreams(r),i.updateIsServerMuted(e),n.updateCallParticipantFromSignalingParticipant(i,e)}else i.setState(3);i.processParticipantDetails(e),n.updateMediaStatus(),n.callTelemetry.recordOperationSuccess(_.PARTICIPANT_OPERATIONS.PARTICIPANT_UPDATED,v.getEndpointInformationForTelemetry(e.endpointDetails),i.id),n.event("participantUpdated").raise(i),n.raiseChangedDeferred()},onParticipantRemoved:function(e){n.callTelemetry.recordOperationSuccess(_.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,null,e.id),n._removeParticipant(e),n.updateMediaStatus()},onParticipantJoined:function(e){var i=n.getOrCreateParticipant(e.id);if(i.displayName=e.displayName,0===i.state&&i.setState(1),2===n.callType){var r=e.endpointDetails&&[e.endpointDetails[0]],o=t.getStreamsFromEndpoints(r);i.updateStreams(o),i.updateIsServerMuted(e),n.updateCallParticipantFromSignalingParticipant(i,e),n.updateMediaStatus()}else n.handleRemoteParticipantJoinedInOneToOneCall(e),n.handleRemoteParticipantStateInObservingCall(i,e),e.acceptedBy&&e.acceptedBy!==e.id&&(i.acceptedBy=e.acceptedBy);n.callTelemetry.recordOperationSuccess(_.PARTICIPANT_OPERATIONS.PARTICIPANT_JOINED,v.getEndpointInformationForTelemetry(e.endpointDetails),i.id),i.processParticipantDetails(e),n.raiseChangedDeferred()},getRemoteParticipantCollection:function(){return n.participants.map(function(e){return e.toCafeParticipant()})},onReTargetCompletedSuccess:function(){n.callStats.localStats.call.event(C.CallEvent.MediaRetargetSucceeded),n.mediaSession.completeEscalationAsync().then(function(){n.updateCallType(2)}).catch(function(e){n.logger.error("Complete escalation failed: "+e),n.stopInternal(25)})},onReTargetCompletedFailure:function(e){n.logger.debug("onReTargetCompletedFailure: "+e),n.callStats.localStats.call.event(C.CallEvent.MediaRetargetFailed),n.mediaSession.rejectEscalationAsync(e)},onChatModalitySetupFailed:function(e){n.logger.debug("onChatModalitySetupFailed: "+e)},onConversationUpdated:function(e){n.setMessageId(e.teamsMessageId),n.setThreadId(e.threadId),n.raiseChanged()},onMeetingDetailsUpdated:function(e){n.meetingDetails=e,n.raiseChanged()},onBroadcastDetailsUpdated:function(e){e&&(n.broadcastMeeting&&n.broadcastMeeting.metadataChanged(JSON.stringify(e)),n.broadcastMetadata=e,n.raiseChanged())},onTransferRequested:function(e){n.logger.log("Transfer: onTransferRequested",e);var t="",i="",r=0;try{t=e.target.id,i=e.transferor.details.id,(e&&"teamPark"===e.parkType||"sharedLinePark"===e.parkType)&&(r=1)}catch(e){return n.callTelemetry.recordEvent(_.CALL_OPERATIONS.ON_TRANSFER_REQUESTED_INVALID),void n.signalingSession.signalTransferCompletedAsync({code:I.getCSAEndCode(7)})}var o={transferContext:{transferorMri:i,targetMri:t,transferType:r,context:{target:e.target,transferor:e.transferor,newCallModalities:e.newCallModalities,links:e.links,replacementDetails:e.replacementDetails,isConsultative:e.isConsultative,callAcceptanceCallback:function(){n.logger.log("Transfer: callAcceptanceCallback called"),n.signalingSession.signalTransferAcceptedAsync()}}},onCompleted:function(e){n.logger.log("Transfer: onCompleted called"),n.signalingSession.signalTransferCompletedAsync({code:I.getCSAEndCode(e)})}};n.callTelemetry.recordEvent(_.CALL_OPERATIONS.ON_TRANSFER_REQUESTED,{transferType:r}),n.event("transferRequested").raise(o)},onTransferAccepted:function(){n.logger.log("Transfer: onTransferAccepted"),n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS)&&n._setTransferState(2),n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.BLIND_TRANSFER)&&n._callOperationHandler.maybeResolveOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS),n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.PARK_CALL)&&n._setParkState(2)},onTransferCompleted:function(e){n.logger.log("Transfer: onTransferCompleted");var t=e.transferCompletion,i=I.convertReason(t);if(t&&(n.logger.log("Transfer: Call Transfer Code: "+t.code),0===t.code))return n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS)&&(n._callOperationHandler.resolveOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS),n._setTransferState(3)),void(n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.PARK_CALL)&&(e.unparkContent&&void 0!==e.unparkContent.pickupCode?(n._callOperationHandler.resolveOperation(_.CALL_OPERATIONS.PARK_CALL,e.unparkContent.pickupCode),n._setParkState(3)):(n._callOperationHandler.rejectOperation(_.CALL_OPERATIONS.PARK_CALL,32),n._setParkState(4))));n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS)&&(n._callOperationHandler.rejectOperation(_.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS,i),n._setTransferState(4)),n._callOperationHandler.hasPendingOperation(_.CALL_OPERATIONS.PARK_CALL)&&(n._callOperationHandler.rejectOperation(_.CALL_OPERATIONS.PARK_CALL,i),n._setParkState(4))},onIncomingCallReplacement:function(e){n.logger.log("Transfer: onIncomingCallReplacement"),e.callNotification.callType="replaces",e.callNotification.consultativeCallId=n.callId,n.event("replacementRequested").raise(e)},onContentSharingStopped:function(e){n.logger.debug("ScreenSharing: onContentSharingStopped");for(var t=0,i=n.contentSharingSessions;t<i.length;t++){var r=i[t];r.contentSharingGuid===e.correlationId&&(r.contentSharingStatus=7)}},onContentSharingStarted:function(e){n.logger.debug("ScreenSharing: onContentSharingStarted");var t=new P.default(n.callTelemetry,n.logger.createChild("ContentSharingSession"),n.signalingSession,e.correlationId||y.default.generate(),e.contentIdentifier,e.sessionState,e.subject,e.sessionId);t.contentSharingStatus=2,n.contentSharingSessions.push(t),t.changed(function(){return n.removeContentSessionIfEnded(t)}),n.event("contentSharingChanged").raise()},onContentSharingUpdated:function(e){n.logger.debug("ScreenSharing: onContentSharingUpdated");var t=f.find(n.contentSharingSessions,function(t){return t.contentSharingGuid===e.correlationId});t?(e.presenter&&(t.presenterId=e.presenter),e.subject&&t.subject!==e.subject&&(t.subject=e.subject),e.sessionState&&t.contentSharingState!==e.sessionState&&(t.contentSharingState=e.sessionState),3===t.contentSharingStatus&&n.localSignalingParticipant.id!==e.presenter?t.contentSharingStatus=5:5===t.contentSharingStatus&&n.localSignalingParticipant.id===e.presenter&&(t.contentSharingStatus=3)):n.logger.warn("onContentSharingUpdated: session not found")},onWebRtcMediaNotification:function(e,t){var i=n.mediaSession&&n.mediaSession.getExtensionsManager?n.mediaSession.getExtensionsManager():null;i&&i.processNotification(e,t)},onCorrelationIdUpdated:function(e){return n.checkForCallIdUpdate(e)},onUnmuteRequested:function(e){},onCallForwarded:function(e){e&&e.destinationType!==n.forwardingDestinationType&&(n.forwardingDestinationType=e.destinationType,n.raiseChanged())},onPSTNBalanceUpdate:function(e){}};var r=Object.create(this.localSignalingParticipant);this.signalingSession=this.signalingAgent.getNewSignalingSession(r,this.signalingNotifications,this.callId),this.setCallId(this.callId||this.signalingSession.correlationId),this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&(this.setEndpointId(this.signalingSession.participantManager.localParticipant.endpointId),this.callStats.setParticipantId(this.participantId))}},t.prototype.raiseChangedDeferred=function(){var e=this;this.raiseChangedDefer||(this.raiseChangedDefer=f.defer(function(){delete e.raiseChangedDefer,e.raiseChanged()}))},t.getStreamsFromEndpoints=function(e){return e?(e.forEach(function(e){return f.forEach(e.mediaStreams,function(t){t.participantId=e.participantId,t.endpointId=e.endpointId})}),f.flatMap(e,function(e){return e&&e.mediaStreams||[]})):[]},t.prototype.initializeMediaSession=function(){var e=this;if(!this.mediaSession){var n={onSessionErrorOccurred:function(t){e.logger.error("onSessionErrorOccurred: "+JSON.stringify(t));var n=[e.mediaAgent.constants.MEDIA_ERROR.iceConnectionError,e.mediaAgent.constants.MEDIA_ERROR.internalError];f.includes(n,t.type)&&e.event("mediaConnectionFailed").raise()},onNegotiationRequired:function(){e.logger.info("onNegotiationRequired"),3!==e.state&&4!==e.state&&5!==e.state&&10!==e.state||e._callOperationHandler.executeChained(function(){return e.renegotiate()},_.CALL_OPERATIONS.RENEGOTIATE)},onContributingSourcesChanged:function(t){e.participants.forEach(function(e){var n=t.indexOf(e.audio.id)>=0?1:0;e.updateVoiceLevel(n)})},onDominantSpeakerChanged:function(t,n){e.logger.info("onDominantSpeakerChanged, speakerList = "+t+", timestamp = "+n);var i=[];t.forEach(function(t){var n=f.find(e.participants,function(e){return e.audio.id===t});n&&i.push(n.id)}),e.dominantSpeakerInfo={speakerList:i,timestamp:n},e.raiseChanged()},onAudioStateChanged:function(n,i){e.logger.debug("onAudioStateChanged: "+JSON.stringify(n)),e.callStats.localStats.audio.streamStateChanged(n.stream,n.direction);var r=t.streamingStatetoMediaStreamState(n.stream);if(e.audioStreamState=r,r){2===r&&2===e.state&&(e.setCallState(9),e.participants.forEach(function(e){return e.setState(6)}));var o={mediaType:0,mediaDirection:t.streamingDirectionToMediaDirectionMapping(n.direction),mediaStreamState:r};if(e.event("mediaStreamStateChanged").raise(o),0===o.mediaDirection&&(e.isAudioStreamConnected=f.includes([2,1],o.mediaStreamState)),f.includes([3,4],o.mediaStreamState))if(e.logger.error("audio stream state changed to "+n.stream+" with reason "+i),!i||["timeout","connection-dropped","connectivity-check-failure"].indexOf(i)>=0){e.event("mediaConnectionFailed").raise();var a=e.mediaRelayWhiteListingIssue?53:4;e.stopInternal(a)}}},onAudioQualityChanged:function(n){var i={type:t.convertQualityEventType(n.type),value:t.convertQualityLevel(n.value),isLocalSource:n.isLocalSource,mediaType:t.convertMediaType(n.mediaType)};32===i.type&&(e.mediaRelayWhiteListingIssue=!0,e.event("mediaConnectionWhitelistingWarning").raise()),e.event("callQualityChanged").raise(i)}};2===this.callType&&this.callStats.localStats.call.event(C.CallEvent.MultiPartyModeSet),this.mediaSession=new b.default(this.mediaAgent.createSession(n,this.signalingSession.correlationId,{isConference:2===this.callType}),this.signalingSession,this.mediaAgent.constants),this.streamManager.setMediaSession(this.mediaSession),this.participants.forEach(function(t){t.setMediaSession(e.mediaSession)})}},t.prototype.renegotiate=function(){return u(this,void 0,void 0,function(){var e,n,i,r,o,a,s,c,l,u;return d(this,function(d){switch(d.label){case 0:this.renegotiationAnswerDeferred=m.defer(),d.label=1;case 1:d.trys.push([1,11,,12]),d.label=2;case 2:return d.trys.push([2,8,,10]),e=this.inLocalHold()?this.getMediaModalitiesForHold():this.calculateModalityDirections(),[4,t.executePhase(p.MediaCreateOffer,this.mediaSession.createOfferAsync())];case 3:return n=d.sent(),i=this.getSignalingMediaTypes(e),[4,t.executePhase(p.SignalingStartNegotiation,this.signalingSession.startRenegotiationAsync(t.createMediaContent(n),i))];case 4:return d.sent(),[4,t.executePhase(p.SignalingRenegotiationAnswer,this.renegotiationAnswerDeferred.promise)];case 5:return r=d.sent(),[4,t.executePhase(p.MediaProcessAnswer,this.mediaSession.processAnswerAsync(r,!1))];case 6:return d.sent(),[4,this.completeNegotiationAsync()];case 7:return o=d.sent(),this.onNegotiationCompletion(o,!0,e),[3,10];case 8:if(a=d.sent(),this.onNegotiationFailure(a,!0,e),!a.phase)throw a;return this.logger.error("Error in renegotiate(), callId = "+this.callId,a.error),s="unknown",c=this.mediaAgent.constants.RENEGOTIATION_ERROR,s=c.local,a.phase!==p.SignalingRenegotiationAnswer&&a.phase!==p.SignalingStartNegotiation||(l=415,a.error.code===A.jsCallEndCodes.GlareError&&a.error.subCode===A.jsCallEndSubCodes.SharingStolenError?(this.event("sharingStolen"),s=c.glare):s=a.error.code===l?c.media:c.signaling),this.callHoldResumeDeferred&&(this.callHoldResumeDeferred.reject(new Error("Error in renegotiate() -> rejecting hold for callId = "+this.callId+", reason="+s)),this.callHoldResumeDeferred=null,this.isHoldInProgress=!1),this.logger.warn("Error in renegotiate() -> rejecting media negotiation with reason "+s),[4,this.mediaSession.rejectNegotiationAsync(s)];case 9:return d.sent(),[3,10];case 10:return[3,12];case 11:return u=d.sent(),this.logger.error("Unexpected error in renegotiate(), callId = "+this.callId,u),this.logger.warn("Unexpected error in renegotiate() -> stopping call"),this.rejectPromiseChain(),[3,12];case 12:return[2]}})})},t.prototype.invertDirectionality=function(e){switch(e){case this.mediaAgent.constants.MEDIA_STATE.sendReceive:return N.streamDirections.sendReceive;case this.mediaAgent.constants.MEDIA_STATE.send:return N.streamDirections.receive;case this.mediaAgent.constants.MEDIA_STATE.receive:return N.streamDirections.send;default:return null}},t.prototype.completeNegotiationAsync=function(){var e=this;return this.mediaSession.completeNegotiationAsync().then(function(t){var n=1===e.callType,i=e.participants[0];return n&&i&&i.updateStreams([{type:N.ngcStreamTypes.audio,direction:e.invertDirectionality(t.activeModalities.audio),sourceId:null,serverMuted:!1},{type:N.ngcStreamTypes.video,direction:e.invertDirectionality(t.activeModalities.video),sourceId:null,serverMuted:!1},{type:N.ngcStreamTypes.sharing,direction:e.invertDirectionality(t.activeModalities.sharing),sourceId:null,serverMuted:!1}]),t})},t.executePhase=function(e,t){return new Promise(function(n,i){t.then(n).catch(function(t){return i({phase:e,error:t})})})},t.prototype.renegotiateOffer=function(e){return u(this,void 0,void 0,function(){var n,i,r,o,a,s,c,l,u;return d(this,function(d){switch(d.label){case 0:if(this.mediaAcknowledgmentOperation=this._callOperationHandler.createPendingOperation(_.CALL_OPERATIONS.MEDIA_ACKNOWLEDGMENT),e.newOffer&&(!this.mediaAgent.getCapabilities().retargeting||e.escalationOccurring&&4===this.state))return this.logger.error("Retarget offer received, but pluginless has no support for retarget"),this.stopInternal(38),[2];d.label=1;case 1:return d.trys.push([1,12,,20]),[4,t.executePhase(p.MediaProcessOffer,this.mediaSession.processOfferAsync(e))];case 2:return n=d.sent(),this.remoteRequestedHoldState=this.getRenegotiationOfferType(n)===h.Hold,this.handleOfferedModalities(n),this.getRenegotiationOfferType(n)!==h.Resume?[3,4]:[4,this.prepareModalitiesForResume()];case 3:d.sent(),d.label=4;case 4:return[4,this.updateMediaModalities({offered:n})];case 5:return i=d.sent(),this.getRenegotiationOfferType(n)!==h.Hold?[3,7]:[4,this.prepareModalitiesForHold()];case 6:d.sent(),d.label=7;case 7:return this.updateVideoState(i),this.isRenegotiationHoldOrResume(i)&&this.updateScreenSharingState(i),[4,t.executePhase(p.MediaCreateAnswer,this.mediaSession.createAnswerAsync(!1))];case 8:return r=d.sent(),o=this.getSignalingMediaTypes(i),a=t.createMediaContent(r),[4,t.executePhase(p.SignalingAcceptRenegotiation,this.signalingSession.acceptRenegotiationAsync(a,o))];case 9:return d.sent(),[4,t.executePhase(p.SignalingMediaAcknowledgement,this.mediaAcknowledgmentOperation)];case 10:return d.sent(),[4,this.completeNegotiationAsync()];case 11:return s=d.sent(),this.onNegotiationCompletion(s,!1,n),[3,20];case 12:c=d.sent(),d.label=13;case 13:if(d.trys.push([13,18,,19]),!c.phase)throw c;return l=c,this.logger.error("Error in renegotiateOffer(), callId = "+this.callId,l.error),l.phase!==p.SignalingAcceptRenegotiation&&l.phase!==p.SignalingMediaAcknowledgement?[3,15]:(this.logger.warn("Error in renegotiateOffer() -> rejecting media negotiation"),[4,this.mediaSession.rejectNegotiationAsync(this.mediaAgent.constants.RENEGOTIATION_ERROR.signaling)]);case 14:return d.sent(),[2];case 15:return this.logger.warn("Error in renegotiateOffer() -> rejecting media/signaling negotiation"),[4,this.mediaSession.rejectNegotiationAsync(this.mediaAgent.constants.RENEGOTIATION_ERROR.local)];case 16:return d.sent(),[4,this.signalingSession.rejectRenegotiationAsync()];case 17:return d.sent(),[3,19];case 18:return u=d.sent(),this.logger.error("Unexpected error in renegotiateOffer(), callId = "+this.callId,u),this.logger.warn("Unexpected error in renegotiateOffer() -> stopping call"),this.rejectPromiseChain(),[3,19];case 19:return[3,20];case 20:return[2]}})})},t.prototype.updateCallType=function(e){(this.logger.info("updateCallType: currentValue: "+this.callType+", newValue: "+e),2!==e&&this.logger.error("Escalating to wrong state: "+this.callType+" -> "+e),e!==this.callType)&&(this.participants[0].updateStreams([{type:N.ngcStreamTypes.audio,direction:"inactive",sourceId:null,serverMuted:!1},{type:N.ngcStreamTypes.video,direction:"inactive",sourceId:null,serverMuted:!1},{type:N.ngcStreamTypes.sharing,direction:"inactive",sourceId:null,serverMuted:!1}]),this.setCallType(e),this.raiseChanged())},t.prototype.collectCallStats=function(e){var t=this,n=function(){return t.collectCallStatsDeferred.resolve()};return e.getStatsAsync().then(function(e){if(t.callStats.setMediaStats(e),t.ecsProvider){var n=t.ecsProvider.getEcsConfig("ConfigIDs","SkypeWebMedia");n&&t.callStats.setWebMediaConfigIds(n)}}).then(n,n)},t.prototype._reportTsCallingTelemetry=function(e){var t=e?"skypecosi_concore_web_ts_calling_call_setup_session":"skypecosi_concore_web_ts_calling_in_call_session";this.telemetryService.getCallingAdapter().sendEvent(t,this.callTelemetry.getEvent()),e&&this.callTelemetry.switchToInCallTelemetry()},t.prototype.reportCallStats=function(){var e=this;return this.callStats.localStats.endCall(this.terminatedReason),this.collectCallStatsDeferred.promise.then(function(){e.telemetryService.sendEvents(e.callStats.buildFromMediaStats()),e.callStats.buildFromLocalStats().forEach(function(t){e.telemetryService.getCallingAdapter().sendEvent("skypecosi_concore_web_"+t.eventName,t.props)}),e.event("statsReported").raise(),e._reportTsCallingTelemetry(!e._callIsSetupComplete)})},t.prototype.onLocalPreviewSizeChanged=function(e,t){this.logger.debug("onLocalPreviewSizeChanged: "+e+"x"+t)},t.prototype.onLocalPreviewStateChanged=function(e){this.logger.debug("onLocalPreviewStateChanged: "+e),this.callStats.localStats.video.streamStateChanged(e.stream)},t.prototype.configureVideoModalitiesAsync=function(e){return u(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return this.mediaSession?[4,this.updateMediaModalities()]:(this.logger.warn("Tried to configure modalities after call end"),[2,Promise.resolve()]);case 1:return t.sent(),e||this.turnOffLocalVideoPreview(),this.setVideoOn(e),[2]}})})},t.prototype.turnOffLocalVideoPreview=function(){return this.disposeLocalVideoRenderer()},t.prototype.turnOnLocalVideoPreview=function(){var e=this;return this.requestedVideoState&&this.localVideoContainer?(this.disposeLocalVideoRenderer(),m.asap(function(){e.localVideoRenderer=e.mediaAgent.getDeviceManager().createPreviewRenderer(e.localVideoContainer,{onVideoSizeChanged:function(t,n){return e.onLocalPreviewSizeChanged(t,n)},onVideoStateChanged:function(t){return e.onLocalPreviewStateChanged(t)}})}).then(function(){return e.localVideoRenderer.startVideoAsync()})):Promise.reject("could not start video preview: requestedVideoState="+this.requestedVideoState+", localVideoContainer="+this.localVideoContainer)},t.prototype.startStopVideo=function(e){var t=this;if(!this.canToggleVideo)return e===this.requestedVideoState?this.videoTogglePromise.then(function(){t.turnOnLocalVideoPreview()}):(this.logger.error("startStopVideo: video switching is in progress "+e),Promise.reject({reason:1}));e?(this.callStats.localStats.newSession(1),this.callStats.localStats.video.start()):this.callStats.localStats.video.stop(),this.logger.debug("startStopVideo "+e),e&&this.skipVideoModality&&(this.logger.info("Video modality was skipped till now. Adding it now."),this.skipVideoModality=!1),this.canToggleVideo=!1;var n=function(){t.canToggleVideo=!0};return this.requestedVideoState=e,this.videoTogglePromise=Promise.resolve().then(function(){return!!e&&(t.localVideoContainer||(t.localVideoContainer=document.createElement("div")),t.turnOnLocalVideoPreview().then(function(){return!0}))}).then(function(e){return t.configureVideoModalitiesAsync(e)}).catch(function(e){return t.configureVideoModalitiesAsync(!1).then(function(){throw e})}).then(n,function(e){throw n(),e}),this.videoTogglePromise},t.prototype.startStopAudio=function(e){return u(this,void 0,void 0,function(){var t,n;return d(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.updateMediaModalities()];case 1:return t=i.sent(),this.updateVideoState(t),[3,3];case 2:return n=i.sent(),this.logger.error("startStopAudio (send audio "+e+") failed with error "+n),[2,9];case 3:return[2,0]}})})},t.prototype.handleServerMutedState=function(){this.isServerMuted||this._muteState!==A.ParticipantMuteState.ServerMuted||(this.logger.info("handleServerMutedState is unmuting, as we are no longer server muted"),this.muteUnmute(!1,!1)),this.isServerMuted&&this._muteState===A.ParticipantMuteState.Unmuted&&(this.logger.info("handleServerMutedState is muting, as we are unmuted"),this.muteUnmute(!0,!1))},t.prototype.muteUnmute=function(e,t){return void 0===t&&(t=!0),u(this,void 0,void 0,function(){var n,i,r,o;return d(this,function(a){switch(a.label){case 0:this.logger.info("muteUnmute, value = "+e+" isMuted = "+this.isMuted+" isServerMuted = "+this.isServerMuted),n=e?A.ParticipantMuteState.Muted:A.ParticipantMuteState.Unmuted,a.label=1;case 1:return a.trys.push([1,8,,9]),this.mediaSession&&this.mediaSession.getAllowedModalities?(i=this.isMuted||this.isServerMuted,r=this.mediaSession.getAllowedModalities().audio.some(function(e){return e===N.streamDirections.send||e===N.streamDirections.sendReceive}),i&&r||!i&&!r?(this.logger.log("updating audio modalities"),[4,this.updateMediaModalities()]):[3,3]):[3,3];case 2:a.sent(),a.label=3;case 3:return e?[4,this.mediaSession.muteInputAsync()]:[3,5];case 4:return a.sent(),[3,7];case 5:return[4,this.mediaSession.unmuteInputAsync()];case 6:a.sent(),a.label=7;case 7:return t?(this.setMuted(n),e?this.signalingSession.muteAsync("Myself"):this.signalingSession.unmuteAsync()):e&&this.setMuted(A.ParticipantMuteState.ServerMuted),[3,9];case 8:throw o=a.sent(),this.logger.error("muteUnmute "+e+" callId: "+this.callId+" failed with error: "+o),e&&this.setMuted(n),o;case 9:return[2]}})})},t.prototype.muteUnmuteSpeaker=function(e){return u(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return this.logger.info("muteUnmuteSpeaker, value = "+e+" isSpeakerMuted = "+this.isSpeakerMuted),this.setSpeakerMuted(e),this.mediaSession?e?[4,this.mediaSession.muteOutputAsync()]:[3,2]:[3,4];case 1:return t.sent(),[3,4];case 2:return[4,this.mediaSession.unmuteOutputAsync()];case 3:t.sent(),t.label=4;case 4:return[2]}})})},t.prototype.getParticipant=function(e){return this.participants.filter(function(t){return t.isSameParticipantsMri(e)})[0]},t.prototype.getOrCreateParticipant=function(e){var t=this,n=this.getParticipant(e);return n||((n=new O.PluginlessCallParticipant(e,this.mediaSession,this.logger,this.callStats.localStats,this.callTelemetry)).changed(function(){return t.onParticipantChanged(n)}),this.participants.push(n),this.event("participantAdded").raise(n),this.monitorCallStart(),n)},t.prototype.onParticipantChanged=function(e){var t=this;f.each(e.streams[1],function(e){t.isScreenSharingOn&&e.isAvailable&&(t.stopScreenSharing(),t.logger.log("ParticipantChanged: Cleaning up local screenshare because remote screenshare is running"),t.event("sharingStolen").raise())})},t.prototype.setCallState=function(e,t){if(void 0===t&&(t=0),this.state!==e){var n=k[this.state].indexOf(e)>=0;if(this.logger.info("Attempting to change CallState "+this.state+" -> "+e+", terminatedReason: "+this.terminatedReason+" for call "+this.callId),n||(this.logger.error("Invalid state transition "+this.state+"->"+e+" attempted for call "+this.callId),7===e)){if(this.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_CALL_STATE,{state:e,reason:t}),this.state=e,this.callStats.localStats.call.callStateChanged(e),7===e&&(this.terminatedReason=t,!f.includes(M,t))){var i=44===this.terminatedReason,r=55===this.terminatedReason,o=56===this.terminatedReason;this.setFailureType(!this.callGotConnected||!this._wasAudioStreamConnected||i||r||o?0:1)}3===e&&(this.callGotConnected=!0,this.callHeldAt=null),this.callIsHeld()&&!this.callHeldAt&&(this.callHeldAt=new Date),this.callHoldResumeDeferred&&(this.isHoldInProgress&&3!==e&&5!==e?(4===e?this.callHoldResumeDeferred.resolve():this.callHoldResumeDeferred.reject(new Error("Call state changed to "+e+" instead of LocalHold")),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null):this.inLocalHold()||(3===e||5===e||10===e?this.callHoldResumeDeferred.resolve():this.callHoldResumeDeferred.reject(new Error("Call state changed to "+e+" instead of Connected")),this.callHoldResumeDeferred=null)),this.logger.info("CallState changed to "+e+", terminatedReason: "+this.terminatedReason+" failureType: "+this.failureType),this.monitorCallStart(),this.event("callStateChanged").raise(),this.raiseChanged()}}},t.prototype.setVideoOn=function(e){this.logger.debug("setVideoOn("+e+")"),this.isVideoOn=e,this.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_LOCAL_VIDEO,{value:e}),this.raiseChanged()},t.prototype.setScreenSharingOn=function(e){this.logger.debug("setScreenSharingOn("+e+")"),this.isScreenSharingOn=e,this.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_SCREEN_SHARING,{value:e}),this.event("userActivityChanged").raise(),this.raiseChanged()},t.prototype.setMuted=function(e){this._muteState=e,this.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_MUTED,{value:e}),this.logger.info("setMuted participantMuteState:"+e+", isMuted: "+this.isMuted),this.raiseChanged()},t.prototype.setSpeakerMuted=function(e){this.logger.debug("setSpeakerMuted("+e+")"),this.isSpeakerMuted=e,this.raiseChanged()},t.prototype.monitorCallStart=function(){3===this.state&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},t.prototype._removeParticipant=function(e,t){void 0===t&&(t=0),this.logger.debug("removeParticipant: "+e);var n=f.remove(this.participants,function(t){return t.isSameParticipantsMri(e.id)})[0];n?(n.setState(4,t),this.event("participantRemoved").raise(n)):this.logger.error("removeParticipant: unable to remove participant "+e.id),this.raiseChanged()},t.prototype.handleOfferedModalities=function(e){var t=this.mediaAgent.constants.MEDIA_STATE;this.skipVideoModality=!e.hasOwnProperty("video"),this.skipSharingModality=!e.hasOwnProperty("sharing"),this.logger.debug("offered modalities: "+JSON.stringify(e)),e.sharing===t.receive&&(this.requestedScreenSharingState=!1),this.isSomeoneSharing=e.sharing===t.receive,this.isSomeoneStreamingVideo=e.video===t.receive||e.video===t.sendReceive},t.prototype.getRenegotiationOfferType=function(e){if(e)if(5===this.state){if("sendrecv"===e.audio)return h.Resume}else if(this.modalitiesAreHold(e))return h.Hold;return h.Undefined},t.prototype.isRenegotiationHoldOrResume=function(e){return this.getRenegotiationOfferType(e)===h.Hold||this.getRenegotiationOfferType(e)===h.Resume},t.prototype.onNegotiationCompletion=function(e,t,n){void 0===n&&(n={}),this.logger.debug("NegotiationCompleted: byLocal="+t+", result="+JSON.stringify(e));var i=1===this.callType;if(i){var r=this.modalitiesAreHold(e.activeModalities)?5:3;this.participants[0].setState(r),this.logger.debug("OnNegotiationCompletion: participant[0] state set to "+r)}this.isSomeoneSharing=f.some(this.participants,function(e){return f.some(e.streams[1],function(e){return e.isAvailable})}),this.isSomeoneStreamingVideo=f.some(this.participants,function(e){return f.some(e.streams[0],function(e){return e.isAvailable})});var o=this.modalitiesAreHold(e.configuredModalities),a=this.modalitiesAreHold(e.activeModalities);t?this.requestedHoldState&&o&&a?this.setCallState(4):!o&&a?this.setCallState(5):o&&!a?(this.logger.warn("This is not expected. This means remote party responded with audio=active for hold request"),this.setCallState(4)):o||a||this._callInLobby||this.setCallState(3):4===this.state||this._callInLobby||this.setCallState(i&&5===this.participants[0].state?5:3);var s=n&&n.sharing===this.mediaAgent.constants.MEDIA_STATE.send,c=e&&e.activeModalities&&e.activeModalities.sharing===this.mediaAgent.constants.MEDIA_STATE.send;this.screenSharingRenegotiationDeferred&&s&&c&&(this.screenSharingRenegotiationDeferred.resolve(),this.screenSharingRenegotiationDeferred=null)},t.prototype.updateMediaStatus=function(){return u(this,void 0,void 0,function(){var e,t,n,i;return d(this,function(r){switch(r.label){case 0:for(this.isSomeoneSharing=!1,this.isSomeoneStreamingVideo=!1,e=0,t=this.participants;e<t.length&&(n=t[e],this.isSomeoneSharing||(this.isSomeoneSharing=f.some(n.streams[1],function(e){return e.isAvailable})),this.isSomeoneStreamingVideo||(this.isSomeoneStreamingVideo=f.some(n.streams[0],function(e){return e.isAvailable})),!this.isSomeoneSharing||!this.isSomeoneStreamingVideo);e++);return this.mediaSession?[4,this.updateMediaModalities()]:[3,2];case 1:i=r.sent(),this.callTelemetry.recordEvent(_.CALL_OPERATIONS.SET_MEDIA_MODALITIES,i),r.label=2;case 2:return[2]}})})},t.prototype.onNegotiationFailure=function(e,t,n){this.logger.error("NegotiationFailure: byLocal="+t+", error="+e);var i=n&&n.sharing===this.mediaAgent.constants.MEDIA_STATE.send;this.screenSharingRenegotiationDeferred&&i&&(this.screenSharingRenegotiationDeferred.reject(e),this.screenSharingRenegotiationDeferred=null)},t.getParticipantReasonFromTerminatedReason=function(e){switch(e){case 1:return 0;case 9:return 2;case 10:return 3;case 2:return 4;case 24:return 8;case 3:return 9;case 4:return 10;case 14:return 12;case 0:return 11;case 15:return 13;case 16:return 14;case 17:return 15;case 18:return 16;case 19:return 17;case 20:return 18;case 11:return 19;case 21:return 20;case 22:return 21;case 23:return 22;case 33:return 25;case 36:return 26;case 37:return 27;case 41:return 30;case 39:return 28;case 42:return 31;case 40:return 29;case 43:return 32;case 44:return 33;case 45:return 34;case 46:return 35;case 47:return 36;case 48:return 37;case 49:return 38;case 50:return 39;case 51:return 40;case 52:return 41;case 54:return 42;case 55:return 44;case 56:return 45;case 12:return 23;case 59:return 46;case 61:return 47;case 62:return 49;case 63:return 50;case 64:return 5;case 65:return 51;case 8:return 52;default:return 11}},t.prototype.updateCallParticipantFromSignalingParticipant=function(e,t){if(t.endpointDetails&&t.endpointDetails[0].isLobby)e.setState(7);else{var n=t.endpointDetails&&t.endpointDetails[0].mediaStreams;if(n&&n.length>0){var i=n.every(function(e){return"inactive"===e.direction})?5:3;1===this.state&&(i=2),e.setState(i)}}},t.prototype.updateLocalParticipant=function(e){var t=this;this.localSignalingParticipant.endpointDetails=e.endpointDetails,this.localSignalingParticipant.role=e.role,this.localSignalingParticipant.tenantId=e.tenantId,this.callTelemetry.setTenantId(e.tenantId);var n=!1,i=f.find(this.localSignalingParticipant.endpointDetails,function(e){return t._endpointId===e.endpointId});i&&i.isLobby&&(n=!0),e.endpointDetails&&this.updateLocalParticipantEndpoints(e.endpointDetails);var r=i&&i.mediaStreams,o=r&&r.filter(function(e){return"audio"===e.type||"audio-teleconferencing"===e.type});if(o&&o.length>0){var a=o.some(function(e){return e.serverMuted});a!==this.isServerMuted&&(this.isServerMuted=a,this.callTelemetry.recordEvent(_.PARTICIPANT_OPERATIONS.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted}),this.event("serverMutedChanged").raise(a)),this.handleServerMutedState()}this._callInLobby=n,n&&this._callIsSetupComplete&&!this.callIsHeld()&&this.setCallState(10),n||!this._callIsSetupComplete||this.callIsHeld()||this.setCallState(3)},t.prototype.modalitiesAreHold=function(e){return!(e.audio&&"inactive"!==e.audio||e.video&&"inactive"!==e.video||e.sharing&&"inactive"!==e.sharing)},t.prototype.toneToString=function(e){switch(e){case 0:return"0";case 1:return"1";case 2:return"2";case 3:return"3";case 4:return"4";case 5:return"5";case 6:return"6";case 7:return"7";case 8:return"8";case 9:return"9";case 10:return"*";case 11:return"#";default:return null}},t.streamingStatetoMediaStreamState=function(e){switch(e){case"started":return 0;case"active":return 2;case"inactive":return 1;case"stopped":return 3;case"failed":default:return 4}},t.streamingDirectionToMediaDirectionMapping=function(e){switch(e){case"send":return 1;case"receive":return 0;default:return}},t.convertMuteScope=function(e){switch(e){case 0:return"EveryoneElse";case 1:return"SpecifiedParticipants";default:return}},t.prototype.callIsHeld=function(){return 4===this.state||5===this.state},t.prototype.inLocalHold=function(){return this.isHoldInProgress||4===this.state},t.prototype.reconnect=function(){return this.mediaSession.reconnectAsync()},t.prototype.provideCallQualityFeedback=function(e,t,n,i){return Promise.resolve(void 0)},t.convertQualityEventType=function(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9;case 10:return 10;case 11:return 11;case 12:return 12;case 13:return 13;case 14:return 14;case 15:return 15;case 16:return 16;case 17:return 17;case 18:return 18;case 19:return 19;case 20:return 20;case 21:return 21;case 22:return 22;case 23:return 23;case 24:return 24;case 25:return 25;case 26:return 26;case 27:return 27;case 28:return 28;case 29:return 29;case 30:return 30;case 31:return 31;case 32:return 32;case 33:return 33;case 34:return 34;case 35:return 35;case 36:return 36;case 37:return 37;case 38:return 38;case 39:return 39;case 40:return 40;default:return}},t.convertQualityLevel=function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;default:return}},t.convertMediaType=function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return}},s([E.callOperation(_.CALL_OPERATIONS.INITIALIZE,{type:E.OPERATION_TYPE.SYNC}),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],t.prototype,"init",null),s([E.callOperation(_.CALL_OPERATIONS.SET_VIDEO_CONTAINER),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],t.prototype,"setVideoContainer",null),s([E.callOperation(_.CALL_OPERATIONS.START_VIDEO),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"startVideo",null),s([E.callOperation(_.CALL_OPERATIONS.STOP_VIDEO),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"stopVideo",null),s([E.callOperation(_.CALL_OPERATIONS.SET_VIDEO_EFFECTS),c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",Promise)],t.prototype,"setVideoEffects",null),s([E.callOperation(_.CALL_OPERATIONS.GET_VIDEO_EFFECTS_CAPABILITIES),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"getVideoEffectsCapability",null),s([E.callOperation(_.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"dumpVideoSourceImages",null),s([E.callOperation(_.CALL_OPERATIONS.HOLD),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"hold",null),s([E.callOperation(_.CALL_OPERATIONS.UNHOLD),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"unhold",null),s([E.callOperation(_.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"updateEndpointMetadata",null),s([E.callOperation(_.CALL_OPERATIONS.SEND_DTMF_TONE,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",Promise)],t.prototype,"sendDtmfTone",null),s([E.callOperation(_.CALL_OPERATIONS.SET_AUDIO_USAGE),c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",Promise)],t.prototype,"setAudioUsageMode",null),s([E.callOperation(_.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0}),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"callBlindTransfer",null),s([E.callOperation(_.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0}),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"callSafeTransfer",null),s([E.callOperation(_.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0}),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],t.prototype,"callConsultativeTransfer",null),s([E.callOperation(_.CALL_OPERATIONS.PARK_CALL,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",Promise)],t.prototype,"park",null),s([E.callOperation(_.CALL_OPERATIONS.GET_CALL_REPLACEMENT_DETAILS,{type:E.OPERATION_TYPE.SYNC}),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Object)],t.prototype,"getCallReplacementDetails",null),s([E.callOperation(_.CALL_OPERATIONS.GET_TECHNICAL_INFORMATION_JSON),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"getTechnicalInformationJson",null),s([E.callOperation(_.CALL_OPERATIONS.START_SCREEN_SHARING),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],t.prototype,"startScreenSharing",null),s([E.callOperation(_.CALL_OPERATIONS.STOP_SCREEN_SHARING),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"stopScreenSharing",null),s([E.callOperation(_.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS),c("design:type",Function),c("design:paramtypes",[Boolean]),c("design:returntype",Promise)],t.prototype,"shareSystemSound",null),s([E.callOperation(_.CALL_OPERATIONS.MUTE),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"mute",null),s([E.callOperation(_.CALL_OPERATIONS.UNMUTE),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"unmute",null),s([E.callOperation(_.CALL_OPERATIONS.MUTE_SPEAKER),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"muteSpeaker",null),s([E.callOperation(_.CALL_OPERATIONS.UNMUTE_SPEAKER),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"unmuteSpeaker",null),s([E.callOperation(_.CALL_OPERATIONS.MUTE_PARTICIPANTS),c("design:type",Function),c("design:paramtypes",[Number,Array]),c("design:returntype",Promise)],t.prototype,"muteParticipants",null),s([E.callOperation(_.CALL_OPERATIONS.START_AUDIO),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"startAudio",null),s([E.callOperation(_.CALL_OPERATIONS.STOP_AUDIO),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"stopAudio",null),s([E.callOperation(_.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS),c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",Promise)],t.prototype,"setMaxVideoChannels",null),s([E.callOperation(_.CALL_OPERATIONS.STOP_CALL),c("design:type",Function),c("design:paramtypes",[Boolean]),c("design:returntype",Promise)],t.prototype,"stop",null),s([E.callOperation(_.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION),c("design:type",Function),c("design:paramtypes",[String,String,String,String]),c("design:returntype",Promise)],t.prototype,"createContentSharingSession",null),s([E.callOperation(_.CALL_OPERATIONS.STOP_CALL_WITH_BEACON,{type:E.OPERATION_TYPE.SYNC}),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Boolean)],t.prototype,"stopWithBeacon",null),s([E.callOperation(_.CALL_OPERATIONS.ACKNOWLEDGE,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object,String]),c("design:returntype",Promise)],t.prototype,"acknowledge",null),s([E.callOperation(_.CALL_OPERATIONS.ACCEPT,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],t.prototype,"accept",null),s([E.callOperation(_.CALL_OPERATIONS.REJECT),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"reject",null),s([E.callOperation(_.CALL_OPERATIONS.JOIN_CALL,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],t.prototype,"join",null),s([E.callOperation(_.CALL_OPERATIONS.START_CALL,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],t.prototype,"start",null),s([E.callOperation(_.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],t.prototype,"startCallToVoicemail",null),s([E.callOperation(_.CALL_OPERATIONS.SUBSCRIBE,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],t.prototype,"joinCallWithoutCallModality",null),s([E.callOperation(_.CALL_OPERATIONS.JOIN_LIGHTWEIGHT_MEETING,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],t.prototype,"joinLightWeightMeeting",null),s([E.callOperation(_.CALL_OPERATIONS.START_LIGHTWEIGHT_MEETING,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],t.prototype,"startLightWeightMeeting",null),s([E.callOperation(_.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Array,Object]),c("design:returntype",Promise)],t.prototype,"startCallWithNudge",null),s([E.callOperation(_.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[Number,String,Object]),c("design:returntype",Promise)],t.prototype,"startAndUnpark",null),s([E.participantOperation(_.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),l(0,E.operationId),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"admitParticipant",null),s([E.participantOperation(_.PARTICIPANT_OPERATIONS.CALL_ME_BACK),l(0,E.operationId),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],t.prototype,"callMeBack",null),s([E.participantOperation(_.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT),l(0,E.operationId),c("design:type",Function),c("design:paramtypes",[String,Object]),c("design:returntype",Promise)],t.prototype,"addParticipant",null),s([E.participantOperation(_.CALL_OPERATIONS.NUDGE_PARTICIPANTS),l(0,E.operationId),c("design:type",Function),c("design:paramtypes",[String,Array,Object]),c("design:returntype",Promise)],t.prototype,"nudgeParticipants",null),s([E.participantOperation(_.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),l(0,E.operationId),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],t.prototype,"removeParticipant",null),s([E.callOperation(_.CALL_OPERATIONS.UPDATE_MEDIA_STATUS,{type:E.OPERATION_TYPE.CHAINED}),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"updateMediaStatus",null),s([E.callOperation(_.CALL_OPERATIONS.RECONNECT),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],t.prototype,"reconnect",null),t}(S.default);t.default=j},function(e,t,n){"use strict";var i,r,o,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),c=n(28),l=n(49),u=n(9),d=n(53),p=n(23),h=((r={})[0]=[1],r[1]=[2,6,3,4,5,7],r[2]=[6,3,4],r[3]=[1,4,5],r[7]=[3,4],r[4]=[],r[5]=[3,4],r[6]=[3,4],r),f=((o={})[0]="Disconnected",o[1]="Connecting",o[2]="Ringing",o[3]="Connected",o[5]="Connected",o[4]="Disconnected",o[7]="Connecting",o),g=function(e){function t(t,n,i,r,o){var a=e.call(this)||this;return a.mri=t,a.callTelemetry=o,a.state=0,a.lightWeightMeetingRole=0,a.voiceLevel=0,a.isServerMuted=!1,a.endpointType="default",a.balanceUpdates={},a.recordTelemetryForStateChange=function(){var e={state:a.state,reason:a.stateReason,endpoints:[]};a.endpoints&&(e.endpoints=l.getEndpointInformationForTelemetry(a.endpoints.endpointDetails)),a.callTelemetry.recordEvent(c.PARTICIPANT_OPERATIONS.SET_PARTICIPANT_STATE,e)},a.id=a.mri,a.logger=i.createChild("PluginlessCallParticipant["+a.id+"]"),a.streamManager=new d.PluginlessCallStreamManager(a.id,n,r,a.logger),a}return a(t,e),Object.defineProperty(t.prototype,"audio",{get:function(){return this.streamManager.audio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streams",{get:function(){return this.streamManager.streams},enumerable:!0,configurable:!0}),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,state:this.state,isServerMuted:this.isServerMuted})},t.prototype.isSameParticipantsMri=function(e){return this.id===e},t.prototype.setMediaSession=function(e){this.streamManager.setMediaSession(e)},t.prototype.updateStreams=function(e){this.streamManager.updateStreams(e),this.callTelemetry.recordEvent(c.PARTICIPANT_OPERATIONS.UPDATE_PARTICIPANT_STREAM,e),this.raiseChanged()},t.prototype.updateIsServerMuted=function(e){if(s.isEmpty(e.endpointDetails))this._updateIsServerMuted(!1);else{var t=!1;s.each(e.endpointDetails,function(e){var n=function(t){return s.filter(e.mediaStreams,function(e){return e.type===t}).sort(d.PluginlessCallStreamManager.compareStreams)},i=n(p.ngcStreamTypes.audio)[0];i||(i=n(p.ngcStreamTypes.audioteleconference)[0]);var r=!(!i||!i.serverMuted)&&i.serverMuted,o=e.endpointState&&e.endpointState.state,a=o&&o.isMuted||!1;!1!==r||!1!==a||(t=!0)});var n=!t;this._updateIsServerMuted(n)}},t.prototype._updateIsServerMuted=function(e){e!==this.isServerMuted&&(this.isServerMuted=e,this.raiseChanged())},t.prototype.updateVoiceLevel=function(e){this.voiceLevel!==e&&(this.voiceLevel=e,this.raiseChanged())},t.prototype.setState=function(e,t){this.state!==e&&(h[this.state].indexOf(e)>=0||this.logger.error("Invalid state transition "+this.state+"->"+e+" attempted"),this.logger.debug("Participant setState: "+this.state+" -> "+e+" reason: "+this.stateReason+" -> "+t),this.state=e,this.stateReason=t,this.recordTelemetryForStateChange(),this.raiseChanged())},t.prototype.processParticipantDetails=function(e){var t=this;this.role=e.role,this.tenantId=e.tenantId,s.isEmpty(e.endpointDetails)||(this.endpoints={endpointDetails:[]},this.participantCapabilities={canConference:!1,canShareScreen:!1,canMerge:!1},s.each(e.endpointDetails,function(e){if(t.endpoints.endpointDetails.push({clientVersion:e.clientVersion,participantId:e.participantId,endpointId:e.endpointId,endpointType:e.endpointType,endpointMetadata:e.endpointMetadata,originalId:e.originalId,capabilities:e.capabilities,mediaStreams:e.mediaStreams}),e.capabilities&&(t.participantCapabilities.canConference||"enabled"!==e.capabilities.cloudAudioVideoConference||(t.participantCapabilities.canConference=!0),t.participantCapabilities.canShareScreen||"enabled"!==e.capabilities.cloudScreenSharing||(t.participantCapabilities.canShareScreen=!0),t.participantCapabilities.canMerge||"enabled"!==e.capabilities.cloudMerge||(t.participantCapabilities.canMerge=!0)),t.contentSharingRole=0,e.contentSharing&&e.contentSharing.sessionInformation){var n=e.contentSharing.sessionInformation;"attendee"===n.role?t.contentSharingRole=1:"presenter"===n.role&&(t.contentSharingRole=2)}}),this.raiseChanged())},t.prototype.toCafeParticipant=function(){return{audioState:f[this.state],mri:this.mri}},t.prototype.getSourceIdForMediaType=function(e){return-1},t}(u.default);t.PluginlessCallParticipant=g},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(22),s=n(35),c=n(36),l=n(95),u=n(26),d=n(100),p=n(41),h=n(101),f=function(e){function t(t,n){void 0===n&&(n=1);var i=e.call(this,t)||this;return i.callSupport=n,i}return r(t,e),t}(Error),g=function(){function e(e,t,n,i,r){this._callRegistry=new s.CallRegistry(e.trouterService,n,t,e.logger,e.telemetryService,e.callSettings,r),this._deviceManager=new c.default(t.getDeviceManager(),i),this._screenSharingManager=new p.default(t.getScreenSharingManager()),this._ecsProvider=r}return e.build=function(t,n){var i=u.default.getInstance();return i.init(t.platformType).catch(function(e){var t=e.some(function(e){return"incompatible_version"===e.reason});throw new f("PluginlessStack initialization failed",t?2:1)}).then(function(){var r={onDevicesChanged:function(){}},a=o.assign({},t.mediaAgentFactoryConfig,{deviceEvents:r});i.configure(a);var s=i.getAgent(),c=new h.SignalingAgentProvider(t.signalingAgentConfig,n);return n.on("OnECSChanged",function(){var e=n.getEcsConfig("SkypeWebMedia","mediaAgent");e?s.updateConfig(e,n.ETag):t.logger.warn("No SkypeWebMedia.mediaAgent config.")}),new e(t,s,c,r,n)}).catch(function(e){throw e instanceof f?e:new f(""+e)})},e.prototype.getCallRegistry=function(){return this._callRegistry},e.prototype.getDeviceManager=function(){return this._deviceManager},e.prototype.getScreenSharingManager=function(){return this._screenSharingManager},e.prototype.getSetup=function(){},e.prototype.getEcsProvider=function(){return this._ecsProvider},e.prototype.fireIntent=function(e,t){},e.prototype.getVersion=function(){return{build:a.TsCallingVersionProvider.getVersion(),ovb:a.TsCallingVersionProvider.getOvb()}},e}();t.PluginlessStack=g,t.pluginlessStackFactory={build:function(e){var t=new d.PluginlessEcsProvider;return l.initLogger(e,t),g.build(e,t)},registerProvider:function(e){u.default.getInstance().register(e)}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(9),s=function(){function e(e){this._sharingSource=e}return e.prototype.getId=function(){return this._sharingSource.getId()},e.prototype.getType=function(){return this.mapSharingSourceType(this._sharingSource.getType())},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t){return this._sharingSource.getPreviewAsync(e,t)},e.prototype.getDescription=function(){return this._sharingSource.getDescription()},e.prototype.getIcon=function(e,t){return this._sharingSource.getIcon(e,t)},e.prototype.getBounds=function(){},e.prototype.mapSharingSourceType=function(e){switch(e){case 1:return 1;case 2:return 2;default:throw new Error("Invalid sharing source type")}},e}(),c=function(e){function t(t){var n=e.call(this)||this;return n._screenSharingManager=t,n._screenSharingManager.onScreensChanged(function(){n.event("screensChanged").raise()}),n}return r(t,e),t.prototype.enumerateScreensAsync=function(){return this._screenSharingManager.enumerateScreensAsync().then(function(e){return o.map(e,function(e){return new s(e)})})},t.prototype.enumerateWindowsAsync=function(){return this._screenSharingManager.enumerateWindowsAsync().then(function(e){return o.map(e,function(e){return new s(e)})})},t}(a.default);t.default=c},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i=n(12),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new i.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function c(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,r,o,a,s=e.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,r,o,s=t||e.length,l=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)l[i++]=r;else if((o=a[r])>4)l[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return c(l,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.asap=function(e){return new Promise(function(t){t(e())})};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);t.TimeoutError=o;var a=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){this.timeoutId=setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId)},e}();t.Timer=a,t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.timedDefer=function(e,t){void 0===t&&(t="deferred timed out after "+e+"ms");var n={},i=new a(function(){return n.reject(new o(t))});return n.promise=new Promise(function(e,t){n.resolve=function(t){i.stop(),e(t)},n.reject=function(e){i.stop(),t(e)}}),i.start(e),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(22);!function(e){e.Pending="Pending",e.Success="Success",e.Failure="Failure"}(i||(i={})),function(e){e[e.Event=0]="Event",e[e.Operation=1]="Operation"}(r||(r={}));var a=function(){function e(e,t,n,o){this.eventName=e,this.eventStartTime=t,this.type=n,this.status=i.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===r.Event&&delete this.status,o&&this.data.push(o)}return e.prototype.recordSuccess=function(e){this.recordResult(!0,e)},e.prototype.recordFailure=function(e){this.recordResult(!1,e)},e.prototype.addData=function(e){this.data.push(e)},e.prototype.getEvent=function(){var e,t=this,n={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,data:this.data.map(function(e){return t.prepareData(e)}).filter(function(e){return""!==e})};return this.type===r.Event&&delete n.status,n.data.length||delete n.data,n.result||delete n.result,(e={})[this.eventName]=n,e},e.prototype.recordResult=function(e,t){this.status=e?i.Success:i.Failure,this.result=this.prepareData(t),this.duration=(new Date).getTime()-this.eventStartTimestamp},e.prototype.prepareData=function(e){var t=typeof e;if(void 0===e||null===e)return"";if("string"===t)return e;if("number"===t||"boolean"===t)return String(e);if("function"===t)return"";if(e instanceof Error)return e.toString();try{return JSON.stringify(e),e}catch(e){return"invalid"}},e}();!function(e){e.LOCAL="Local",e.REMOTE="Remote"}(t.CALL_TERMINATING_END||(t.CALL_TERMINATING_END={})),function(e){e.SUCCESS="Success",e.FAILURE="Failure"}(t.RESULT_VALUE||(t.RESULT_VALUE={})),function(e){e.INCOMING="Incoming",e.OUTGOING="Outgoing"}(t.DIRECTION||(t.DIRECTION={})),function(e){e.CALLER="caller",e.CALLEE="callee",e.JOIN="join",e.SUBSCRIBE="SUBSCRIBE",e.JOIN_FOR_LIGHT_WEIGHT_MEETING="joinForLightWeightMeeting",e.START_FOR_LIGHT_WEIGHT_MEETING="startForLightWeightMeeting"}(t.SELF_PARTICIPANT_ROLE||(t.SELF_PARTICIPANT_ROLE={}));var s=function(){function e(e){this.recordedEvents=[],this.callStartTime=(new Date).getTime(),this.inCallMode=!1,this.ongoingOperations={},this.tsCallingVersion=o.TsCallingVersionProvider.getVersion(),this.logger=e.createChild("CallTelemetry")}return e.prototype.setCallId=function(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e},e.prototype.setConsultativeCallId=function(e){this.consultativeCallId=e},e.prototype.setEndpointId=function(e){this.endpointId=e},e.prototype.setParticipantId=function(e){this.participantId=e},e.prototype.setThreadId=function(e){this.threadId=e},e.prototype.setMesageId=function(e){this.messageId=e},e.prototype.setTenantId=function(e){this.tenantId=e},e.prototype.setFailureType=function(e){this.failureType=e},e.prototype.setIsCast=function(e){this.isCast=e?"True":"False"},e.prototype.setRole=function(e){this.isAnonymous="admin"===e?"False":"True"},e.prototype.setCallType=function(e){this.callType=e},e.prototype.setDirection=function(e){this.direction=e},e.prototype.setSelfParticipantRole=function(e){this.selfParticipantRole=e},e.prototype.setTerminationState=function(e){this.terminationState=e},e.prototype.setTerminationReason=function(e){this.terminationReason=e},e.prototype.recordEvent=function(e,t){this.logger.debug("Event:",e,t);var n=new a(e,this.getEventStartTime(),r.Event,t);return this.pushToRecordedEvents(n),n},e.prototype.recordOperationSuccess=function(e,t,n){(void 0===t&&(t=null),this.logger.log("Event success:",e,n,t),this.hasOngoingEvent(e,n))?this.ongoingOperations[e][n].recordSuccess(t):this.recordOperation(e,n).recordSuccess(t);delete this.ongoingOperations[e][n]},e.prototype.recordOperationFailure=function(e,t,n){this.logger.log("Event failure:",e,n,t),this.hasOngoingEvent(e,n)?(this.ongoingOperations[e][n].recordFailure(t),delete this.ongoingOperations[e][n]):this.recordOperation(e,n).recordFailure(t)},e.prototype.recordOperation=function(e,t){var n;this.logger.debug("Event create:",e,t);var i=new a(e,this.getEventStartTime(),r.Operation);return this.ongoingOperations[e]||(this.ongoingOperations[e]={}),this.ongoingOperations[e]=t?((n={})[t]=i,n):i,this.pushToRecordedEvents(i),i},e.prototype.updateOperationData=function(e,t,n){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t);n?this.ongoingOperations[e][n]&&this.ongoingOperations[e][n].addData(t):this.ongoingOperations[e].addData(t)}catch(t){return void this.logger.log("Unable to update operation: "+e+" data")}},e.prototype.getEvent=function(){var e=function(e){return void 0===e?"":e};return{CorrelationId:e(this.currentCallId),PreviousCorrelationId:e(this.previousCallId),ConsultativeCallId:e(this.consultativeCallId),EndpointId:e(this.endpointId),ParticipantId:e(this.participantId),CallType:e(this.callType),Direction:e(this.direction),SelfParticipantRole:e(this.selfParticipantRole),IsAnonymous:e(this.isAnonymous),ThreadId:e(this.threadId),MessageId:e(this.messageId),TenantId:e(this.tenantId),FailureType:e(this.failureType),IsCast:e(this.isCast),TsCallingVersion:e(this.tsCallingVersion),TerminationState:e(this.terminationState),TerminationReason:e(this.terminationReason),EventTimestampBag:this.getEventTimestampBag()}},e.prototype.switchToInCallTelemetry=function(){this.recordedEvents=[],this.inCallMode=!0},e.prototype.pushToRecordedEvents=function(e){this.inCallMode&&this.recordedEvents.length>100&&this.recordedEvents.shift(),this.recordedEvents.push(e)},e.prototype.hasOngoingEvent=function(e,t){return this.ongoingOperations[e]?!!this.ongoingOperations[e][t]||(this.logger.warn("Unable to find event for name\\id "+e+"\\"+t),!1):(this.logger.warn("Unable to find event for name "+e),!1)},e.prototype.getEventStartTime=function(){return(new Date).getTime()-this.callStartTime},e.prototype.getEventTimestampBag=function(){var e=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents.map(function(e){return e.getEvent()})});return this.logger.log("Call eventTimestampBag "+e),e},e}();t.default=s,t.getEndpointInformationForTelemetry=function(e){return Array.isArray(e)?e.map(function(e){return{endpointId:e.endpointId,participantId:e.participantId}}):null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.generate=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},e}();t.default=i},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.CHAINED="Chained",e.SYNC="Sync",e.ASYNC="Async"}(i=t.OPERATION_TYPE||(t.OPERATION_TYPE={}));var r;!function(e){e[e.CALL=0]="CALL",e[e.PARTICIPANT=1]="PARTICIPANT"}(r||(r={})),t.callOperation=function(e,t){return o(r.CALL,e,t)},t.participantOperation=function(e,t){return o(r.PARTICIPANT,e,t)},t.operationId=function(e,t,n){if(e[t]._operationIdValue_)throw"can not specify more than one operation id";e[t]._operationIdValue_=n};var o=function(e,t,n){return function(r,o,s){var c=s.value,l=r[o]&&r[o]._operationIdValue_,u=n&&n.type||i.ASYNC;return s.value=function(){for(var r=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var d=void 0!==l?o[l]:void 0,p=a(this,e);if(p.logOperation.apply(p,["Operation:",t].concat(o)),n&&n.singular&&p.hasPendingOperation(t))return Promise.reject(60);var h=function(){return u===i.CHAINED?p.executeChained(c.bind.apply(c,[r].concat(o)),t,d):u===i.SYNC?p.executeSync(c.bind.apply(c,[r].concat(o)),t,d):p.execute(c.bind.apply(c,[r].concat(o)),t,d)};if(n&&n.type!==i.SYNC){var f=n&&n.waitFor;if(f&&p.hasPendingOperation(f))return p.waitForOperation(f).then(h,h)}return h()},s}},a=function(e,t){if(t===r.CALL)return e._callOperationHandler;if(t===r.PARTICIPANT)return e._participantOperationHandler;throw"Unsupported operation handler type!"}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(93),c=n(89),l=n(90),u=function(e){function t(t,n){var i=e.call(this,t)||this;return i.telemetryService=n,i.logSuccess=function(e,t,n){i._logger.log(e+" success, time="+n.duration()+", result "+(t?i.stringifyForLogging(t):"void"))},i.logFailure=function(e,t,n){i._logger.log(e+" failure, reason "+i.stringifyForLogging(t)+", time="+n.duration())},i.stringifyForLogging=function(e){var t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},i._logger=t.createChild("Operation"),i._chainedPromise=new l.default(i._logger.createChild("Chained")),i}return r(t,e),t.prototype.resetOperationChain=function(e){this._chainedPromise.reset(e)},t.prototype.executeSync=function(e,t,n){var i=this.getOperationInfo(t,n),r=s.build();this._logger.log("executeSync "+i);var o,a=this.telemetryService.recordOperation(t,n);try{o=e(),a.recordSuccess(o),this.logSuccess(i,o,r)}catch(e){a.recordFailure(e),this.logFailure(i,e,r)}return o},t.prototype.executeChained=function(e,t,n){return o(this,void 0,void 0,function(){return a(this,function(i){return[2,this.checkPendingOperationAndExecute(e,!0,t,n)]})})},t.prototype.execute=function(e,t,n){return o(this,void 0,void 0,function(){return a(this,function(i){return[2,this.checkPendingOperationAndExecute(e,!1,t,n)]})})},t.prototype.logOperation=function(e){for(var t,n=this,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];(t=this._logger).log.apply(t,["Operation:",e].concat(i.map(function(e){return n.stringifyForLogging(e)})))},t.prototype.checkPendingOperationAndExecute=function(e,t,n,i){var r=this,o=this.getOperationInfo(n,i),a=function(){return r.hasPendingOperation(n,i)?(r._logger.warn(o+" was already pending, returning existing operation"),r.waitForOperation(n,i)):null};return t?this._chainedPromise.chainPromise(function(){return a()||r.executeInternal(e,n,i)},n):a()||this.executeInternal(e,n,i)},t.prototype.executeInternal=function(e,t,n){return o(this,void 0,void 0,function(){var i,r,o,c,l,u;return a(this,function(a){switch(a.label){case 0:i=this.getOperationInfo(t,n),this._logger.log("execute "+i),r=s.build(),o=this.telemetryService.recordOperation(t,n),c=this.createPendingOperation(t,n),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e()];case 2:return l=a.sent(),o.recordSuccess(l),this.logSuccess(i,l,r),this.maybeResolveOperation(t,l,n),[3,4];case 3:return u=a.sent(),o.recordFailure(u),this.logFailure(i,u,r),this.maybeRejectOperation(t,u,n),[3,4];case 4:return[2,c]}})})},t.prototype.getOperationInfo=function(e,t){return e+(t?"\\"+t:"")},t}(c.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(102),o=n(103),a=n(23),s=n(55),c=function(){function e(e,t,n,i){this.participantId=e,this.mediaSession=t,this.localStats=n,this.streams={};var a=n.receive(1,e),c=n.receive(3,e);this.audio=new r.default(t,i);var l=new s.default(t,a,i),u=new o.default(t,c,i);this.streams[0]=[l],this.streams[1]=[u],this.logger=i.createChild("PluginlessCallStreamManager")}return e.prototype.setMediaSession=function(e){this.logger.info("setMediaSession"),this.mediaSession=e,[[this.audio],this.streams[0],this.streams[1]].forEach(function(t){return t.forEach(function(t){return t.setMediaSession(e)})})},e.prototype.updateStreams=function(t){this.logger.info("updateStreams");var n=function(n){return i.filter(t,function(e){return e.type===n}).sort(e.compareStreams)},r=n(a.ngcStreamTypes.audio)[0]||n(a.ngcStreamTypes.audioteleconference)[0];r&&this.audio.update(r),this.updateMediaStreams(n(a.ngcStreamTypes.video),0),this.updateMediaStreams(n(a.ngcStreamTypes.sharing),1)},e.compareStreams=function(e,t){var n="sendonly"===e.direction||"sendrecv"===e.direction,i="sendonly"===t.direction||"sendrecv"===t.direction;return n&&!i?-1:i&&!n?1:t.sourceId-e.sourceId},e.prototype.updateMediaStreams=function(e,t){var n=this,r=this.streams[t],a=r.filter(function(t){return!e.some(function(e){return e.sourceId===t.id})});a.forEach(function(e){return i.remove(r,e)}),a.length&&this.logger.info("updateMediaStreams: Removing "+a.length+" streams of type "+t),e.forEach(function(a,c){var l=i.find(r,function(e){return e.id===a.sourceId});l||(0===t?l=new s.default(n.mediaSession,n.localStats.receive(1,n.participantId),n.logger,a.sourceId):1===t&&(l=new o.default(n.mediaSession,n.localStats.receive(3,n.participantId),n.logger,a.sourceId)),n.logger.info("updateMediaStreams: Adding stream "+a.sourceId+" of type "+t),r.push(l)),l.update(a),l.rank=e.length-c})},e}();t.PluginlessCallStreamManager=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(23),s=function(e){function t(t,n,i){var r=e.call(this)||this;return r.mediaSession=t,r.isAvailable=!1,r.isStreaming=!1,r.id=i,r.logger=n.createChild("Stream["+r.id+"]"),r}return r(t,e),t.prototype.update=function(e){var t=void 0===e?{}:e,n=t.sourceId,i=void 0===n?null:n,r=t.direction,o=void 0===r?a.streamDirections.receive:r,s=t.participantId,c=void 0===s?null:s,l=t.endpointId,u=void 0===l?null:l;this.logger.info("update: sourceId="+i+", direction="+o+", participantId="+c+", endpointId="+u),this.id=i,this.isAvailable=o===a.streamDirections.sendReceive||o===a.streamDirections.send,this.participantId=c,this.endpointId=u,this.raiseChanged()},t.prototype.setMediaSession=function(e){this.logger.info("setMediaSession: "+e),this.mediaSession=e},t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t}(o.default);t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(20),a=n(21),s=function(e){function t(t,n,i,r){var o=e.call(this,t,i,r)||this;return o.rendererStats=n,o.type=0,o}return r(t,e),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},t.prototype.stop=function(){return Promise.resolve(void 0)},t.prototype.start=function(e,t){var n,i=this;this.logger.log("video start: target="+e+", options="+JSON.stringify(t));try{n=new a.RemoteVideoRenderer(e,this.mediaSession,this.rendererStats)}catch(e){return Promise.reject(e)}return t&&n.setScalingMode(t.scalingMode),this.attachRenderer(n,this.id).catch(function(e){throw n.dispose(),e}).then(function(){return i.isStreaming=!0,n})},t.prototype.update=function(t){e.prototype.update.call(this,t),this.logger.log("video update: stream="+JSON.stringify(t));var n=this.isAvailable;this.isAvailable&&this.isAvailable!==n&&this.rendererStats.event(o.MediaReceiverEvent.Available)},t.prototype.attachRenderer=function(e,t){return this.logger.log("video attachRenderer: videoRenderer="+e+", id="+t),e.subscribeVideoAsync(t)},t}(n(54).default);t.default=s},function(e,t){var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};t.asap=function(e){return new Promise(function(t){t(e())})};var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(Error);t.TimeoutError=i;var r=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){void 0!==this.timeoutId&&this.stop(),this.timeoutId=setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId),this.timeoutId=void 0},e}();t.Timer=r,t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.timedDefer=function(e,t){void 0===t&&(t="deferred timed out after "+e+"ms");var n={},o=new r(function(){return n.reject(new i(t))});return n.promise=new Promise(function(e,t){n.resolve=function(t){o.stop(),e(t)},n.reject=function(e){o.stop(),t(e)}}),o.start(e),n},t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},t.timeout=function(e,t,n){var i=new Promise(function(e,i){setTimeout(i.bind(null,new Error("Promise timed out"+(n?": "+n:"")+" after "+t+"ms")),t)});return Promise.race([e,i])}},function(e,t,n){"use strict";var i=function(){function e(e,t){this.onActiveSpeakersChanged=e,this.onDominantSpeakersChanged=t}return e.prototype.setStrategy=function(e){this.dshStrategy=e,this.dshStrategy&&this.dshStrategy.setOnDominantSpeakerChanged(this.onDominantSpeakerHistoryChanged.bind(this))},e.prototype.onContributingSourcesChanged=function(e){this.onActiveSpeakersChanged(e),this.dshStrategy&&this.dshStrategy.setSources(e)},e.prototype.onDominantSpeakerHistoryChanged=function(e){this.onDominantSpeakersChanged(e)},e.prototype.dispose=function(){this.dshStrategy&&(this.dshStrategy.dispose(),this.dshStrategy=null),this.onActiveSpeakersChanged=null,this.onDominantSpeakersChanged=null},e}();t.ActiveSpeakerManager=i},function(e,t,n){"use strict";var i=function(){function e(e){this.queue=[],this.logger=e}return e.prototype.cleanup=function(){this.queue.forEach(function(e){e.reject({notSent:e.tones})}),this.queue=[]},e.prototype.waitForNotification=function(e){var t=this;return e?(this.logger.unsafe.log("sending dtmf tones: ",e),new Promise(function(n,i){t.queue.push({tones:e,resolve:n,reject:i})})):Promise.reject(new Error("invalid input"))},e.prototype.toneSent=function(e){this.queue[0]&&(e===this.queue[0].tones[0]?(this.queue[0].tones=this.queue[0].tones.substr(1),""===this.queue[0].tones&&(this.queue[0].resolve(),this.queue.shift())):(this.queue[0].reject(new Error("sent tone does not match: expected '"+this.queue[0].tones[0]+"' got '"+e+"'")),this.queue.shift(),this.toneSent(e)))},e}();t.DTMFQueue=i},function(e,t,n){"use strict";var i=n(5),r=n(2),o=n(14),a=function(){function e(e){this.logger=e,this.window=i.default.window,this.isMuted=!1}return Object.defineProperty(e.prototype,"muted",{get:function(){return this.isMuted},set:function(e){this.audio&&(this.audio.autoplay=!e,e?this.audio.pause():this.audio.play()),this.isMuted=e},enumerable:!0,configurable:!0}),e.prototype.play=function(e){this.audio?this.window.detachMediaStream(this.audio):(this.audio=this.window.document.createElement("audio"),this.window.document.body.appendChild(this.audio),this.audio.autoplay=!this.isMuted,this.audio.addEventListener("error",this.onAudioError)),this.logger.safe.log("attaching stream to renderer stream ID: "+(e&&e.id)),this.window.attachMediaStream(this.audio,e),this.stream=e},e.prototype.stop=function(){this.audio&&(this.logger.safe.log("removing stream from renderer stream ID: "+(this.stream&&this.stream.id)),this.audio.removeEventListener("error",this.onAudioError),this.window.document.body.removeChild(this.audio),this.window.detachMediaStream(this.audio),this.audio=null,this.stream=null)},e.prototype.setOutputDevice=function(e){o.hasWebRtc()?this.audio&&this.audio.setSinkId&&e&&(this.logger.safe.log("setting audio output device ID to "+e),this.audio.setSinkId(e)):this.logger.safe.warn("setting output device is supported only with WebRTC")},e.prototype.getStream=function(){return this.stream},e.prototype.dispose=function(){this.stop()},e.prototype.onAudioError=function(e){e?this.logger.safe.error("error event occured: "+this.toString(e)):this.logger.safe.error("error event occured error: "+(this.audio?this.audio.error:"<no audio element>"))},e.prototype.toString=function(e){if(e){var t={};return r.forOwn(e,function(e,n){try{t[n]=t[n]="function"==typeof e?e():e}catch(e){t[n]="error: "+e}}),JSON.stringify(t)}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var i=n(5),r=function(){function e(e,t){this.window=i.default.window,this.videoElement=e,this.config=t,this.originalVideoElementSize={width:e.offsetWidth,height:e.offsetHeight}}return e.prototype.onSizeChange=function(e){var t=this;if(!this.elementSizeTrackingRef){var n=Math.floor(Math.random()*Math.abs(this.config.interval.max-this.config.interval.min))+this.config.interval.min;this.elementSizeTrackingRef=this.window.setInterval(function(){t.videoElementSizeChanged()&&(t.saveCurrentVideoElementSize(),e(t.videoElement.offsetWidth,t.videoElement.offsetHeight))},n)}},e.prototype.dispose=function(){this.elementSizeTrackingRef&&this.window.clearInterval(this.elementSizeTrackingRef)},e.prototype.videoElementSizeChanged=function(){return this.originalVideoElementSize.width!==this.videoElement.offsetWidth||this.originalVideoElementSize.height!==this.videoElement.offsetHeight},e.prototype.saveCurrentVideoElementSize=function(){this.originalVideoElementSize.width=this.videoElement.offsetWidth,this.originalVideoElementSize.height=this.videoElement.offsetHeight},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=4294967040,r=function(){function e(){this.ssrc=Math.floor(Math.random()*(i-1))+1}return e.prototype.nextAudioStreamSsrc=function(){return this.nextSsrc(0)},e.prototype.nextVideoStreamSsrc=function(){return this.nextSsrc(99)},e.prototype.nextSsrc=function(e){var t;do{t=this.ssrc,this.ssrc=(this.ssrc+e+1)%i,0===this.ssrc&&(this.ssrc=1)}while(t+e>i);return{min:t,max:t+e}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=n(5),r=function(){function e(e){this.logger=e}return e.prototype.getStream=function(e){var t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.log("Constraints to be applied: "+JSON.stringify(t)),new Promise(function(e,n){i.default.window.navigator.getUserMedia(t,e,n)})},e}();t.GumStreamProviderBase=r},function(e,t,n){"use strict";var i=function(){return function(){}}();i.SourceNone=-1,i.SourceAny=-2,t.MediaSourceIdentifiers=i},function(e,t,n){"use strict";var i=function(){function e(e,t){this.maxFS=e,this.maxFPS=t}return e.prototype.setMaxFS=function(e,t){return!(this.maxFS===e||(this.maxFS=e,!t))&&(t(this),!0)},e.prototype.getMaxFS=function(){return this.maxFS},e.prototype.getMaxFPS=function(){return this.maxFPS},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";var i;!function(e){e[e.Manual=0]="Manual",e[e.Automatic=1]="Automatic"}(i=t.SelectionType||(t.SelectionType={}));var r=function(){function e(){}return e.prototype.getSelectedDevice=function(e){return null},e}(),o=function(){function e(){}return e.prototype.getSelectedDevice=function(e){return e&&(e.find(function(e){return e.isSystemDefault})||e[0])},e}(),a=function(){function e(){}return e.getStrategy=function(e){switch(e){case i.Manual:return new r;case i.Automatic:return new o;default:return null}},e}();t.DeviceSelectionStrategyFactory=a},function(e,t,n){"use strict";var i=n(11),r=n(16),o=function(){function e(e){this.logger=e,this.logger=this.logger.createChild("rembModifier")}return e.prototype.getControlItem=function(){return this.controlItem},e.prototype.setControlItem=function(e){this.controlItem=e},e.prototype.dispose=function(){this.controlItem=null},e.prototype.setVideoControlMessage=function(e){this.controlItem=this.messageToControlItem(e)},e.prototype.modifyDescriptor=function(e){if(this.controlItem){var t=i.parse(e.sdp);if(t.media[1]){if(t.media[1].bandwidth)t.media[1].bandwidth[0].limit=this.controlItem.bandwidth;else{var n={limit:this.controlItem.bandwidth,type:"AS"};t.media[1].bandwidth=[n]}return e.sdp=i.write(t),e}this.logger.warn("video modality is disabled, skipping sdp modification, ",e)}},e.prototype.messageToControlItem=function(e){var t=r.default.build(e.controlVideoStreaming.controlInfo[0].fmtParams);if(t.contains("max-br")){var n=Math.round(1.2*+t.get("max-br"));return{sourceId:e.controlVideoStreaming.controlInfo[0].sourceId,streamMsid:e.controlVideoStreaming.controlInfo[0].streamMsid,bandwidth:n}}},e}();t.BandwidthControlModifier=o;var a=function(){function e(e,t){this.targetLabel=e,this.logger=t}return e.prototype.modifyDescriptor=function(e){var t=this,n=i.parse(e.sdp),r=n.media,o=r.findIndex(function(e){return e.ssrcs&&e.ssrcs.some(function(e){return"label"===e.attribute&&e.value===t.targetLabel})});if(this.lastMedia)this.logger.safe.log("Enabling ssrc "+this.targetLabel+" back"),r[this.lastMediaIndex]=this.lastMedia,this.lastMedia=void 0;else{if(-1===o)return this.logger.safe.warn("Modality for stream "+this.targetLabel+" not found"),e;this.logger.safe.log("Disabling ssrc "+this.targetLabel);var a=r[o];r[o]={type:a.type,port:0,protocol:a.protocol,payloads:"36"},this.lastMediaIndex=o,this.lastMedia=a}return e.sdp=i.write(n),e},e}();t.ModalityToggler=a},function(e,t,n){"use strict";var i=function(){function e(e){this.manager=null,this.extensionType=e}return e.prototype.initialize=function(e){e.manager&&(this.manager=e.manager),e.logger&&(this.logger=e.logger.createChild(this.extensionType))},e.prototype.dispose=function(){this.manager&&(this.manager=null),this.logger&&(this.logger.safe.log("disposed"),this.logger=null)},e.prototype.configure=function(e){this.options=e},e.prototype.getOptions=function(){return this.options},e.prototype.getType=function(){return this.extensionType},e}();t.ExtensionBase=i},function(e,t,n){"use strict";var i=n(131),r=n(2),o=function(){function e(){this.extensions=[],this.listeners={}}return e.prototype.dispose=function(){this.extensions.map(function(e){return e.dispose()}),this.extensions=[],this.listeners={}},e.prototype.addExtension=function(e,t){t.manager||(t.manager=this);var n=i.default.getExtension(e);n.initialize(t),this.extensions.push(n)},e.prototype.getExtension=function(e){return r.find(this.extensions,function(t){return t.getType()===e})},e.prototype.configureExtension=function(e,t){var n=this.getExtension(e);n&&n.configure(t)},e.prototype.processNotification=function(e,t){var n=this.listeners[e];n&&n.forEach(function(n){n.onNotification(e,t)})},e.prototype.addNotificationListener=function(e,t){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.prototype.removeNotificationListener=function(e,t){var n=this.listeners[t];if(n){var i=n.indexOf(e);i>=0&&n.splice(i,1),n.length||delete this.listeners[t]}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(5),r="rollback";function o(){var e=[].slice.apply(arguments),t=e[0]&&a(e[0].type);e.splice(0,t?1:0,null);var n=new(Function.prototype.bind.apply(i.default.window.RTCSessionDescription,e)),o=Object.getOwnPropertyDescriptor(i.default.window.RTCSessionDescription.prototype,"type");return Object.defineProperty(n,"type",{get:function(){return t?r:o.get.call(n)},set:function(e){(t=a(e))||o.set.call(n,e)}}),n}function a(e){return r===e}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return o}}},function(e,t,n){"use strict";var i=!0,r="enabled",o="undefined"==typeof RTCIceGatherer,a=!1,s=!1,c=!0,l=!0,u=!0,d=!1,p=!1,h=!0,f=!0,g=!0,m=!0,_=!0,v=!0,y=!1,S=!0,E=!1,T=!0;function C(e,t){return"boolean"==typeof e?e:t}t.__esModule=!0,t.default=function(e){e.cloudScreenSharingFlag="disabled"===e.cloudScreenSharingFlag?e.cloudScreenSharingFlag:r,e.serverMuteUnmute=C(e.serverMuteUnmute,g),e.isWebRtcEnabled=C(e.isWebRtcEnabled,o),e.shouldServiceSendNGCUpgradeMessages=C(e.shouldServiceSendNGCUpgradeMessages,c),e.isGVCOutgoingEnabled=C(e.isGVCOutgoingEnabled,i),e.handleRosterFromCreateAndJoin=C(e.handleRosterFromCreateAndJoin,S),e.supportsCompressedServicePayload=C(e.supportsCompressedServicePayload,l),e.supportsSynchronousTrouterResponse=C(e.supportsSynchronousTrouterResponse,u),e.supportsHostlessGroupCalls=C(e.supportsHostlessGroupCalls,h),e.doHostlessCalling=C(e.doHostlessCalling,a),e.brokerExclusively=C(e.brokerExclusively,y),e.brokerEnabledOutgoing=C(e.brokerEnabledOutgoing,m),e.brokerEnabledIncoming=C(e.brokerEnabledIncoming,_),e.brokerRequestBatching=C(e.brokerRequestBatching,v),e.handleMediaOfferFromPushNotification=C(e.handleMediaOfferFromPushNotification,T),e.handleNewOfferRequest=C(e.handleNewOfferRequest,E),e.autoJoinOnConflict=C(e.autoJoinOnConflict,f),e.endConflictedCall=C(e.endConflictedCall,d),e.autoResolveConflictedCall=C(e.autoResolveConflictedCall,p),e.shouldServiceSendCallEventMessages=C(e.shouldServiceSendCallEventMessages,s)}},function(e,t,n){"use strict";var i=n(34),r=n(73);t.DeviceType=r.DeviceType,t.TrouterState=r.TrouterState;var o=n(1);t.CA_CONSTANTS=o.default;var a=n(7);t.TM_CONSTANTS=a.default;var s=n(188);t.IncomingNotificationMessageHandler=s.default;var c=n(70);t.setDefaultsForSignalingConfig=c.default;var l=n(235);t.SignalingAgent=l.default;var u=n(241);t.HttpRequestDispatcher=u.default;var d=n(237);t.SkypeConCoreTelemetryManager=d.default,t.createParticipant=function(e){return new i.default(e)}},function(e,t){var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};t.asap=function(e){return new Promise(function(t){t(e())})};var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(Error);t.TimeoutError=i;var r=function(){function e(){}return e.build=function(e){return new o(e)},e}();t.TimerFactory=r;var o=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){if(this.timeoutId)throw new Error("Timer already started");return this.timeoutId=setTimeout(this.ontimeout,e),this},e.prototype.stop=function(){if(!this.timeoutId)throw new Error("Timer is not defined");clearTimeout(this.timeoutId),this.timeoutId=null},e}();t.Timer=o,t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.timedDefer=function(e,t){void 0===t&&(t="deferred timed out after "+e+"ms");var n={},r=new o(function(){return n.reject(new i(t))});return n.promise=new Promise(function(e,t){n.resolve=function(t){r.stop(),e(t)},n.reject=function(e){r.stop(),t(e)}}),r.start(e),n}},function(e,t,n){"use strict";!function(e){e[e.Desktop=1]="Desktop",e[e.Mobile=2]="Mobile",e[e.Tablet=8]="Tablet"}(t.DeviceType||(t.DeviceType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(33),s=n(92),c=n(26),l=function(e){function t(t,n){void 0===n&&(n="failure");var i=e.call(this,t)||this;return i.reason=n,i}return r(t,e),t}(Error),u=function(){function e(t){if(o.includes(e.supportedPlatforms,t))try{this.mediaAgentFactory=a.MediaAgent}catch(e){throw new l(""+e)}if(!this.mediaAgentFactory||!this.mediaAgentFactory.isPlatformSupported())throw new l(t+" not supported by browser provider","not_supported")}return e.prototype.build=function(e,t){o.defaults(t,{logger:new s.default,tokenProvider:function(){return Promise.resolve("")},relayConfigProvider:function(){},settings:{}});var n={getLogger:function(){return t.logger},getSafeLogger:function(){return t.safeLogger},getRelayManager:function(){return t.relayManager},settings:{debug:t.settings.debug,numVideoChannelsGvc:t.settings.numVideoChannelsGvc,enableReconnectChrome:!0,enableReconnectEdge:!0,ortcVideoRendererAggressiveStreamRefresh:!0,renegotiationAttempts:3,preferSdesSrtp:!0,iceDisconnectedTimeoutMs:3e4,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcScreensharingCapabilityMaxFS:8160,webrtcScreensharingCapabilityMaxFPS:1500,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcScreensharingCapabilityCheckIntervalMin:0,webrtcScreensharingCapabilityCheckIntervalMax:0,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:"app recv:dsh",webrtcVideoChannelSignalingFeedback:"app send:src recv:src,vc",webrtcNativeCpuOveruseDisabled:!0,webrtcResolutionManagerCooldownTimeout:15e3,webrtcResolutionManagerRetryDelay:5e3,webrtcMultiPartyVideoScaling:!0,activeSpeaker:{timeToPromote:3e3},mediaPortRanges:t.settings.mediaPortRanges,ortcPreferBundling:t.settings.ortcPreferBundling,webrtcAllowedMediaContentType:t.settings.webrtcAllowedMediaContentType||["application/sdp","application/sdp-ngc-0.5","application/sdp-ngc-1.0"],ortcAllowedMediaContentType:t.settings.ortcAllowedMediaContentType||["application/sdp","application/sdp-ngc-0.5","application/sdp-ngc-1.0"],webrtcMediaContentType:t.settings.webrtcMediaContentType||"application/sdp",ortcMediaContentType:t.settings.ortcMediaContentType||"application/sdp",webrtcOutgoingScreenSharingEnabled:t.settings.webrtcOutgoingScreenSharingEnabled||!0,ortcOutgoingScreenSharingEnabled:t.settings.ortcOutgoingScreenSharingEnabled||!0,chromeExtensionId:t.settings.chromeExtensionId}},i=this.mediaAgentFactory.build(n,e);return i.constants=this.mediaAgentFactory.constants,i},e.supportedPlatforms=["edge","chrome"],e}();t.default=u;var d=function(){return!!c.default&&(c.default.getInstance().register(function(e){return new u(e)}),!0)||setTimeout(d,0)};d()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(25);t.HttpRequestDispatcherImplementation=i.default;var r=n(40);t.pluginlessStackFactory=r.pluginlessStackFactory},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],u=!1,d=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&h())}function h(){if(!u){var e=s(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||u||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,o,a,s,c=1,l={},u=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){f(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){f(e.data)},i=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(r=d.documentElement,i=function(e){var t=d.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(f,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),i=function(t){e.postMessage(a+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return l[c]=r,i(c),c++},p.clearImmediate=h}function h(e){delete l[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(42),n(76))},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(77),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,n(42))},function(e,t,n){"use strict";var i={};(0,n(12).assign)(i,n(80),n(81),n(45)),e.exports=i},function(e,t,n){"use strict";var i=n(82),r=n(12),o=n(43),a=n(27),s=n(47),c=Object.prototype.toString,l=0,u=-1,d=0,p=8;function h(e){if(!(this instanceof h))return new h(e);this.options=r.assign({level:u,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(a[n]);if(t.header&&i.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=i.deflateSetDictionary(this.strm,f))!==l)throw new Error(a[n]);this._dict_set=!0}}function f(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}h.prototype.push=function(e,t){var n,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(u),s.next_out=0,s.avail_out=u),1!==(n=i.deflate(s,a))&&n!==l)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l):2!==a||(this.onEnd(l),s.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=h,t.deflate=f,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},function(e,t,n){"use strict";var i=n(85),r=n(12),o=n(43),a=n(45),s=n(27),c=n(47),l=n(83),u=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new l,i.inflateGetHeader(this.strm,this.header)}function p(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}d.prototype.push=function(e,t){var n,s,c,l,d,p,h=this.strm,f=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?h.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new r.Buf8(f),h.next_out=0,h.avail_out=f),(n=i.inflate(h,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&g&&(p="string"==typeof g?o.string2buf(g):"[object ArrayBuffer]"===u.call(g)?new Uint8Array(g):g,n=i.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===m&&(n=a.Z_OK,m=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==a.Z_STREAM_END&&(0!==h.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(h.output,h.next_out),l=h.next_out-c,d=o.buf2string(h.output,c),h.next_out=l,h.avail_out=f-l,l&&r.arraySet(h.output,h.output,c,l,0),this.onData(d)):this.onData(r.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(m=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=p,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},t.ungzip=p},function(e,t,n){"use strict";var i,r=n(12),o=n(87),a=n(44),s=n(46),c=n(27),l=0,u=1,d=3,p=4,h=5,f=0,g=1,m=-2,_=-3,v=-5,y=-1,S=1,E=2,T=3,C=4,I=0,A=2,b=8,O=9,R=15,P=8,N=286,w=30,M=19,k=2*N+1,D=15,L=3,U=258,x=U+L+1,F=32,H=42,G=69,j=73,B=91,V=103,W=113,q=666,z=1,K=2,Y=3,J=4,X=3;function Q(e,t){return e.msg=c[t],t}function $(e){return(e<<1)-(e>4?9:0)}function Z(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function ie(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function re(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-x?e.strstart-(e.w_size-x):0,l=e.window,u=e.w_mask,d=e.prev,p=e.strstart+U,h=l[o+a-1],f=l[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+a]===f&&l[n+a-1]===h&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<p);if(i=U-(p-o),o=p-U,i>a){if(e.match_start=t,a=i,i>=s)break;h=l[o+a-1],f=l[o+a]}}}while((t=d[t&u])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead}function oe(e){var t,n,i,o,c,l,u,d,p,h,f=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-x)){r.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=f?i-f:0}while(--n);t=n=f;do{i=e.prev[--t],e.prev[t]=i>=f?i-f:0}while(--n);o+=f}if(0===e.strm.avail_in)break;if(l=e.strm,u=e.window,d=e.strstart+e.lookahead,p=o,h=void 0,(h=l.avail_in)>p&&(h=p),n=0===h?0:(l.avail_in-=h,r.arraySet(u,l.input,l.next_in,h,d),1===l.state.wrap?l.adler=a(l.adler,u,h,d):2===l.state.wrap&&(l.adler=s(l.adler,u,h,d)),l.next_in+=h,l.total_in+=h,h),e.lookahead+=n,e.lookahead+e.insert>=L)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+L-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<L)););}while(e.lookahead<x&&0!==e.strm.avail_in)}function ae(e,t){for(var n,i;;){if(e.lookahead<x){if(oe(e),e.lookahead<x&&t===l)return z;if(0===e.lookahead)break}if(n=0,e.lookahead>=L&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-x&&(e.match_length=re(e,n)),e.match_length>=L)if(i=o._tr_tally(e,e.strstart-e.match_start,e.match_length-L),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=L){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(te(e,!1),0===e.strm.avail_out))return z}return e.insert=e.strstart<L-1?e.strstart:L-1,t===p?(te(e,!0),0===e.strm.avail_out?Y:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?z:K}function se(e,t){for(var n,i,r;;){if(e.lookahead<x){if(oe(e),e.lookahead<x&&t===l)return z;if(0===e.lookahead)break}if(n=0,e.lookahead>=L&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=L-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-x&&(e.match_length=re(e,n),e.match_length<=5&&(e.strategy===S||e.match_length===L&&e.strstart-e.match_start>4096)&&(e.match_length=L-1)),e.prev_length>=L&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-L,i=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-L),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=L-1,e.strstart++,i&&(te(e,!1),0===e.strm.avail_out))return z}else if(e.match_available){if((i=o._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return z}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<L-1?e.strstart:L-1,t===p?(te(e,!0),0===e.strm.avail_out?Y:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?z:K}function ce(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function le(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=A,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?H:W,e.adler=2===t.wrap?0:1,t.last_flush=l,o._tr_init(t),f):Q(e,m)}function ue(e){var t,n=le(e);return n===f&&((t=e.state).window_size=2*t.w_size,Z(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=L-1,t.match_available=0,t.ins_h=0),n}function de(e,t,n,i,o,a){if(!e)return m;var s=1;if(t===y&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),o<1||o>O||n!==b||i<8||i>15||t<0||t>9||a<0||a>C)return Q(e,m);8===i&&(i=9);var c=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*k),this.dyn_dtree=new r.Buf16(2*(2*w+1)),this.bl_tree=new r.Buf16(2*(2*M+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(D+1),this.heap=new r.Buf16(2*N+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*N+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=c,c.strm=e,c.wrap=s,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+L-1)/L),c.window=new r.Buf8(2*c.w_size),c.head=new r.Buf16(c.hash_size),c.prev=new r.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new r.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=n,ue(e)}i=[new ce(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(oe(e),0===e.lookahead&&t===l)return z;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,te(e,!1),0===e.strm.avail_out))return z;if(e.strstart-e.block_start>=e.w_size-x&&(te(e,!1),0===e.strm.avail_out))return z}return e.insert=0,t===p?(te(e,!0),0===e.strm.avail_out?Y:J):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),z)}),new ce(4,4,8,4,ae),new ce(4,5,16,8,ae),new ce(4,6,32,32,ae),new ce(4,4,16,16,se),new ce(8,16,32,32,se),new ce(8,16,128,128,se),new ce(8,32,128,256,se),new ce(32,128,258,1024,se),new ce(32,258,258,4096,se)],t.deflateInit=function(e,t){return de(e,t,b,R,P,I)},t.deflateInit2=de,t.deflateReset=ue,t.deflateResetKeep=le,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,f):m},t.deflate=function(e,t){var n,r,a,c;if(!e||!e.state||t>h||t<0)return e?Q(e,m):m;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===q&&t!==p)return Q(e,0===e.avail_out?v:m);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===H)if(2===r.wrap)e.adler=0,ne(r,31),ne(r,139),ne(r,8),r.gzhead?(ne(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ne(r,255&r.gzhead.time),ne(r,r.gzhead.time>>8&255),ne(r,r.gzhead.time>>16&255),ne(r,r.gzhead.time>>24&255),ne(r,9===r.level?2:r.strategy>=E||r.level<2?4:0),ne(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ne(r,255&r.gzhead.extra.length),ne(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=G):(ne(r,0),ne(r,0),ne(r,0),ne(r,0),ne(r,0),ne(r,9===r.level?2:r.strategy>=E||r.level<2?4:0),ne(r,X),r.status=W);else{var _=b+(r.w_bits-8<<4)<<8;_|=(r.strategy>=E||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(_|=F),_+=31-_%31,r.status=W,ie(r,_),0!==r.strstart&&(ie(r,e.adler>>>16),ie(r,65535&e.adler)),e.adler=1}if(r.status===G)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),ee(e),a=r.pending,r.pending!==r.pending_buf_size));)ne(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=j)}else r.status=j;if(r.status===j)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),ee(e),a=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ne(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===c&&(r.gzindex=0,r.status=B)}else r.status=B;if(r.status===B)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),ee(e),a=r.pending,r.pending===r.pending_buf_size)){c=1;break}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ne(r,c)}while(0!==c);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===c&&(r.status=V)}else r.status=V;if(r.status===V&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&ee(e),r.pending+2<=r.pending_buf_size&&(ne(r,255&e.adler),ne(r,e.adler>>8&255),e.adler=0,r.status=W)):r.status=W),0!==r.pending){if(ee(e),0===e.avail_out)return r.last_flush=-1,f}else if(0===e.avail_in&&$(t)<=$(n)&&t!==p)return Q(e,v);if(r.status===q&&0!==e.avail_in)return Q(e,v);if(0!==e.avail_in||0!==r.lookahead||t!==l&&r.status!==q){var y=r.strategy===E?function(e,t){for(var n;;){if(0===e.lookahead&&(oe(e),0===e.lookahead)){if(t===l)return z;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return z}return e.insert=0,t===p?(te(e,!0),0===e.strm.avail_out?Y:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?z:K}(r,t):r.strategy===T?function(e,t){for(var n,i,r,a,s=e.window;;){if(e.lookahead<=U){if(oe(e),e.lookahead<=U&&t===l)return z;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=L&&e.strstart>0&&(i=s[r=e.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){a=e.strstart+U;do{}while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<a);e.match_length=U-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=L?(n=o._tr_tally(e,1,e.match_length-L),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return z}return e.insert=0,t===p?(te(e,!0),0===e.strm.avail_out?Y:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?z:K}(r,t):i[r.level].func(r,t);if(y!==Y&&y!==J||(r.status=q),y===z||y===Y)return 0===e.avail_out&&(r.last_flush=-1),f;if(y===K&&(t===u?o._tr_align(r):t!==h&&(o._tr_stored_block(r,0,0,!1),t===d&&(Z(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ee(e),0===e.avail_out))return r.last_flush=-1,f}return t!==p?f:r.wrap<=0?g:(2===r.wrap?(ne(r,255&e.adler),ne(r,e.adler>>8&255),ne(r,e.adler>>16&255),ne(r,e.adler>>24&255),ne(r,255&e.total_in),ne(r,e.total_in>>8&255),ne(r,e.total_in>>16&255),ne(r,e.total_in>>24&255)):(ie(r,e.adler>>>16),ie(r,65535&e.adler)),ee(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?f:g)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==H&&t!==G&&t!==j&&t!==B&&t!==V&&t!==W&&t!==q?Q(e,m):(e.state=null,t===W?Q(e,_):f):m},t.deflateSetDictionary=function(e,t){var n,i,o,s,c,l,u,d,p=t.length;if(!e||!e.state)return m;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==H||n.lookahead)return m;for(1===s&&(e.adler=a(e.adler,t,p,0)),n.wrap=0,p>=n.w_size&&(0===s&&(Z(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new r.Buf8(n.w_size),r.arraySet(d,t,p-n.w_size,n.w_size,0),t=d,p=n.w_size),c=e.avail_in,l=e.next_in,u=e.input,e.avail_in=p,e.next_in=0,e.input=t,oe(n);n.lookahead>=L;){i=n.strstart,o=n.lookahead-(L-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+L-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--o);n.strstart=i,n.lookahead=L-1,oe(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=L-1,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,n.wrap=s,f},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,r,o,a,s,c,l,u,d,p,h,f,g,m,_,v,y,S,E,T,C,I,A,b;n=e.state,i=e.next_in,A=e.input,r=i+(e.avail_in-5),o=e.next_out,b=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,d=n.wnext,p=n.window,h=n.hold,f=n.bits,g=n.lencode,m=n.distcode,_=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{f<15&&(h+=A[i++]<<f,f+=8,h+=A[i++]<<f,f+=8),y=g[h&_];t:for(;;){if(h>>>=S=y>>>24,f-=S,0===(S=y>>>16&255))b[o++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=g[(65535&y)+(h&(1<<S)-1)];continue t}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}E=65535&y,(S&=15)&&(f<S&&(h+=A[i++]<<f,f+=8),E+=h&(1<<S)-1,h>>>=S,f-=S),f<15&&(h+=A[i++]<<f,f+=8,h+=A[i++]<<f,f+=8),y=m[h&v];n:for(;;){if(h>>>=S=y>>>24,f-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=m[(65535&y)+(h&(1<<S)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(T=65535&y,f<(S&=15)&&(h+=A[i++]<<f,(f+=8)<S&&(h+=A[i++]<<f,f+=8)),(T+=h&(1<<S)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=S,f-=S,T>(S=o-a)){if((S=T-S)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,I=p,0===d){if(C+=l-S,S<E){E-=S;do{b[o++]=p[C++]}while(--S);C=o-T,I=b}}else if(d<S){if(C+=l+d-S,(S-=d)<E){E-=S;do{b[o++]=p[C++]}while(--S);if(C=0,d<E){E-=S=d;do{b[o++]=p[C++]}while(--S);C=o-T,I=b}}}else if(C+=d-S,S<E){E-=S;do{b[o++]=p[C++]}while(--S);C=o-T,I=b}for(;E>2;)b[o++]=I[C++],b[o++]=I[C++],b[o++]=I[C++],E-=3;E&&(b[o++]=I[C++],E>1&&(b[o++]=I[C++]))}else{C=o-T;do{b[o++]=b[C++],b[o++]=b[C++],b[o++]=b[C++],E-=3}while(E>2);E&&(b[o++]=b[C++],E>1&&(b[o++]=b[C++]))}break}}break}}while(i<r&&o<s);i-=E=f>>3,h&=(1<<(f-=E<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=h,n.bits=f}},function(e,t,n){"use strict";var i=n(12),r=n(44),o=n(46),a=n(84),s=n(86),c=0,l=1,u=2,d=4,p=5,h=6,f=0,g=1,m=2,_=-2,v=-3,y=-4,S=-5,E=8,T=1,C=2,I=3,A=4,b=5,O=6,R=7,P=8,N=9,w=10,M=11,k=12,D=13,L=14,U=15,x=16,F=17,H=18,G=19,j=20,B=21,V=22,W=23,q=24,z=25,K=26,Y=27,J=28,X=29,Q=30,$=31,Z=32,ee=852,te=592,ne=15;function ie(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function re(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=T,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(ee),t.distcode=t.distdyn=new i.Buf32(te),t.sane=1,t.back=-1,f):_}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,re(e)):_}function ae(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,oe(e))):_}function se(e,t){var n,r;return e?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=r,r.window=null,(n=ae(e,t))!==f&&(e.state=null),n):_}var ce,le,ue=!0;function de(e){if(ue){var t;for(ce=new i.Buf32(512),le=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,ce,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,le,0,e.work,{bits:5}),ue=!1}e.lencode=ce,e.lenbits=9,e.distcode=le,e.distbits=5}function pe(e,t,n,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),i.arraySet(a.window,t,n-r,o,a.wnext),(r-=o)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=oe,t.inflateReset2=ae,t.inflateResetKeep=re,t.inflateInit=function(e){return se(e,ne)},t.inflateInit2=se,t.inflate=function(e,t){var n,ee,te,ne,re,oe,ae,se,ce,le,ue,he,fe,ge,me,_e,ve,ye,Se,Ee,Te,Ce,Ie,Ae,be=0,Oe=new i.Buf8(4),Re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _;(n=e.state).mode===k&&(n.mode=D),re=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,oe=e.avail_in,se=n.hold,ce=n.bits,le=oe,ue=ae,Ce=f;e:for(;;)switch(n.mode){case T:if(0===n.wrap){n.mode=D;break}for(;ce<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(2&n.wrap&&35615===se){n.check=0,Oe[0]=255&se,Oe[1]=se>>>8&255,n.check=o(n.check,Oe,2,0),se=0,ce=0,n.mode=C;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",n.mode=Q;break}if((15&se)!==E){e.msg="unknown compression method",n.mode=Q;break}if(ce-=4,Te=8+(15&(se>>>=4)),0===n.wbits)n.wbits=Te;else if(Te>n.wbits){e.msg="invalid window size",n.mode=Q;break}n.dmax=1<<Te,e.adler=n.check=1,n.mode=512&se?w:k,se=0,ce=0;break;case C:for(;ce<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(n.flags=se,(255&n.flags)!==E){e.msg="unknown compression method",n.mode=Q;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Q;break}n.head&&(n.head.text=se>>8&1),512&n.flags&&(Oe[0]=255&se,Oe[1]=se>>>8&255,n.check=o(n.check,Oe,2,0)),se=0,ce=0,n.mode=I;case I:for(;ce<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.time=se),512&n.flags&&(Oe[0]=255&se,Oe[1]=se>>>8&255,Oe[2]=se>>>16&255,Oe[3]=se>>>24&255,n.check=o(n.check,Oe,4,0)),se=0,ce=0,n.mode=A;case A:for(;ce<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}n.head&&(n.head.xflags=255&se,n.head.os=se>>8),512&n.flags&&(Oe[0]=255&se,Oe[1]=se>>>8&255,n.check=o(n.check,Oe,2,0)),se=0,ce=0,n.mode=b;case b:if(1024&n.flags){for(;ce<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}n.length=se,n.head&&(n.head.extra_len=se),512&n.flags&&(Oe[0]=255&se,Oe[1]=se>>>8&255,n.check=o(n.check,Oe,2,0)),se=0,ce=0}else n.head&&(n.head.extra=null);n.mode=O;case O:if(1024&n.flags&&((he=n.length)>oe&&(he=oe),he&&(n.head&&(Te=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,ee,ne,he,Te)),512&n.flags&&(n.check=o(n.check,ee,he,ne)),oe-=he,ne+=he,n.length-=he),n.length))break e;n.length=0,n.mode=R;case R:if(2048&n.flags){if(0===oe)break e;he=0;do{Te=ee[ne+he++],n.head&&Te&&n.length<65536&&(n.head.name+=String.fromCharCode(Te))}while(Te&&he<oe);if(512&n.flags&&(n.check=o(n.check,ee,he,ne)),oe-=he,ne+=he,Te)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=P;case P:if(4096&n.flags){if(0===oe)break e;he=0;do{Te=ee[ne+he++],n.head&&Te&&n.length<65536&&(n.head.comment+=String.fromCharCode(Te))}while(Te&&he<oe);if(512&n.flags&&(n.check=o(n.check,ee,he,ne)),oe-=he,ne+=he,Te)break e}else n.head&&(n.head.comment=null);n.mode=N;case N:if(512&n.flags){for(;ce<16;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(se!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Q;break}se=0,ce=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=k;break;case w:for(;ce<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}e.adler=n.check=ie(se),se=0,ce=0,n.mode=M;case M:if(0===n.havedict)return e.next_out=re,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=ce,m;e.adler=n.check=1,n.mode=k;case k:if(t===p||t===h)break e;case D:if(n.last){se>>>=7&ce,ce-=7&ce,n.mode=Y;break}for(;ce<3;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}switch(n.last=1&se,ce-=1,3&(se>>>=1)){case 0:n.mode=L;break;case 1:if(de(n),n.mode=j,t===h){se>>>=2,ce-=2;break e}break;case 2:n.mode=F;break;case 3:e.msg="invalid block type",n.mode=Q}se>>>=2,ce-=2;break;case L:for(se>>>=7&ce,ce-=7&ce;ce<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Q;break}if(n.length=65535&se,se=0,ce=0,n.mode=U,t===h)break e;case U:n.mode=x;case x:if(he=n.length){if(he>oe&&(he=oe),he>ae&&(he=ae),0===he)break e;i.arraySet(te,ee,ne,he,re),oe-=he,ne+=he,ae-=he,re+=he,n.length-=he;break}n.mode=k;break;case F:for(;ce<14;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(n.nlen=257+(31&se),se>>>=5,ce-=5,n.ndist=1+(31&se),se>>>=5,ce-=5,n.ncode=4+(15&se),se>>>=4,ce-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Q;break}n.have=0,n.mode=H;case H:for(;n.have<n.ncode;){for(;ce<3;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}n.lens[Re[n.have++]]=7&se,se>>>=3,ce-=3}for(;n.have<19;)n.lens[Re[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ie={bits:n.lenbits},Ce=s(c,n.lens,0,19,n.lencode,0,n.work,Ie),n.lenbits=Ie.bits,Ce){e.msg="invalid code lengths set",n.mode=Q;break}n.have=0,n.mode=G;case G:for(;n.have<n.nlen+n.ndist;){for(;_e=(be=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ve=65535&be,!((me=be>>>24)<=ce);){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(ve<16)se>>>=me,ce-=me,n.lens[n.have++]=ve;else{if(16===ve){for(Ae=me+2;ce<Ae;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(se>>>=me,ce-=me,0===n.have){e.msg="invalid bit length repeat",n.mode=Q;break}Te=n.lens[n.have-1],he=3+(3&se),se>>>=2,ce-=2}else if(17===ve){for(Ae=me+3;ce<Ae;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}ce-=me,Te=0,he=3+(7&(se>>>=me)),se>>>=3,ce-=3}else{for(Ae=me+7;ce<Ae;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}ce-=me,Te=0,he=11+(127&(se>>>=me)),se>>>=7,ce-=7}if(n.have+he>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Q;break}for(;he--;)n.lens[n.have++]=Te}}if(n.mode===Q)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Q;break}if(n.lenbits=9,Ie={bits:n.lenbits},Ce=s(l,n.lens,0,n.nlen,n.lencode,0,n.work,Ie),n.lenbits=Ie.bits,Ce){e.msg="invalid literal/lengths set",n.mode=Q;break}if(n.distbits=6,n.distcode=n.distdyn,Ie={bits:n.distbits},Ce=s(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ie),n.distbits=Ie.bits,Ce){e.msg="invalid distances set",n.mode=Q;break}if(n.mode=j,t===h)break e;case j:n.mode=B;case B:if(oe>=6&&ae>=258){e.next_out=re,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=ce,a(e,ue),re=e.next_out,te=e.output,ae=e.avail_out,ne=e.next_in,ee=e.input,oe=e.avail_in,se=n.hold,ce=n.bits,n.mode===k&&(n.back=-1);break}for(n.back=0;_e=(be=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ve=65535&be,!((me=be>>>24)<=ce);){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(_e&&0==(240&_e)){for(ye=me,Se=_e,Ee=ve;_e=(be=n.lencode[Ee+((se&(1<<ye+Se)-1)>>ye)])>>>16&255,ve=65535&be,!(ye+(me=be>>>24)<=ce);){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}se>>>=ye,ce-=ye,n.back+=ye}if(se>>>=me,ce-=me,n.back+=me,n.length=ve,0===_e){n.mode=K;break}if(32&_e){n.back=-1,n.mode=k;break}if(64&_e){e.msg="invalid literal/length code",n.mode=Q;break}n.extra=15&_e,n.mode=V;case V:if(n.extra){for(Ae=n.extra;ce<Ae;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}n.length+=se&(1<<n.extra)-1,se>>>=n.extra,ce-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;_e=(be=n.distcode[se&(1<<n.distbits)-1])>>>16&255,ve=65535&be,!((me=be>>>24)<=ce);){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(0==(240&_e)){for(ye=me,Se=_e,Ee=ve;_e=(be=n.distcode[Ee+((se&(1<<ye+Se)-1)>>ye)])>>>16&255,ve=65535&be,!(ye+(me=be>>>24)<=ce);){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}se>>>=ye,ce-=ye,n.back+=ye}if(se>>>=me,ce-=me,n.back+=me,64&_e){e.msg="invalid distance code",n.mode=Q;break}n.offset=ve,n.extra=15&_e,n.mode=q;case q:if(n.extra){for(Ae=n.extra;ce<Ae;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}n.offset+=se&(1<<n.extra)-1,se>>>=n.extra,ce-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Q;break}n.mode=z;case z:if(0===ae)break e;if(he=ue-ae,n.offset>he){if((he=n.offset-he)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Q;break}he>n.wnext?(he-=n.wnext,fe=n.wsize-he):fe=n.wnext-he,he>n.length&&(he=n.length),ge=n.window}else ge=te,fe=re-n.offset,he=n.length;he>ae&&(he=ae),ae-=he,n.length-=he;do{te[re++]=ge[fe++]}while(--he);0===n.length&&(n.mode=B);break;case K:if(0===ae)break e;te[re++]=n.length,ae--,n.mode=B;break;case Y:if(n.wrap){for(;ce<32;){if(0===oe)break e;oe--,se|=ee[ne++]<<ce,ce+=8}if(ue-=ae,e.total_out+=ue,n.total+=ue,ue&&(e.adler=n.check=n.flags?o(n.check,te,ue,re-ue):r(n.check,te,ue,re-ue)),ue=ae,(n.flags?se:ie(se))!==n.check){e.msg="incorrect data check",n.mode=Q;break}se=0,ce=0}n.mode=J;case J:if(n.wrap&&n.flags){for(;ce<32;){if(0===oe)break e;oe--,se+=ee[ne++]<<ce,ce+=8}if(se!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Q;break}se=0,ce=0}n.mode=X;case X:Ce=g;break e;case Q:Ce=v;break e;case $:return y;case Z:default:return _}return e.next_out=re,e.avail_out=ae,e.next_in=ne,e.avail_in=oe,n.hold=se,n.bits=ce,(n.wsize||ue!==e.avail_out&&n.mode<Q&&(n.mode<Y||t!==d))&&pe(e,e.output,e.next_out,ue-e.avail_out)?(n.mode=$,y):(le-=e.avail_in,ue-=e.avail_out,e.total_in+=le,e.total_out+=ue,n.total+=ue,n.wrap&&ue&&(e.adler=n.check=n.flags?o(n.check,te,ue,e.next_out-ue):r(n.check,te,ue,e.next_out-ue)),e.data_type=n.bits+(n.last?64:0)+(n.mode===k?128:0)+(n.mode===j||n.mode===U?256:0),(0===le&&0===ue||t===d)&&Ce===f&&(Ce=S),Ce)},t.inflateEnd=function(e){if(!e||!e.state)return _;var t=e.state;return t.window&&(t.window=null),e.state=null,f},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?_:(n.head=t,t.done=!1,f):_},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==M?_:n.mode===M&&r(1,t,i,0)!==n.check?v:pe(e,t,i,i)?(n.mode=$,y):(n.havedict=1,f):_},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(12),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,l,u,d,p){var h,f,g,m,_,v,y,S,E,T=p.bits,C=0,I=0,A=0,b=0,O=0,R=0,P=0,N=0,w=0,M=0,k=null,D=0,L=new i.Buf16(16),U=new i.Buf16(16),x=null,F=0;for(C=0;C<=15;C++)L[C]=0;for(I=0;I<c;I++)L[t[n+I]]++;for(O=T,b=15;b>=1&&0===L[b];b--);if(O>b&&(O=b),0===b)return l[u++]=20971520,l[u++]=20971520,p.bits=1,0;for(A=1;A<b&&0===L[A];A++);for(O<A&&(O=A),N=1,C=1;C<=15;C++)if(N<<=1,(N-=L[C])<0)return-1;if(N>0&&(0===e||1!==b))return-1;for(U[1]=0,C=1;C<15;C++)U[C+1]=U[C]+L[C];for(I=0;I<c;I++)0!==t[n+I]&&(d[U[t[n+I]]++]=I);if(0===e?(k=x=d,v=19):1===e?(k=r,D-=257,x=o,F-=257,v=256):(k=a,x=s,v=-1),M=0,I=0,C=A,_=u,R=O,P=0,g=-1,m=(w=1<<O)-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){y=C-P,d[I]<v?(S=0,E=d[I]):d[I]>v?(S=x[F+d[I]],E=k[D+d[I]]):(S=96,E=0),h=1<<C-P,A=f=1<<R;do{l[_+(M>>P)+(f-=h)]=y<<24|S<<16|E|0}while(0!==f);for(h=1<<C-1;M&h;)h>>=1;if(0!==h?(M&=h-1,M+=h):M=0,I++,0==--L[C]){if(C===b)break;C=t[n+d[I]]}if(C>O&&(M&m)!==g){for(0===P&&(P=O),_+=A,N=1<<(R=C-P);R+P<b&&!((N-=L[R+P])<=0);)R++,N<<=1;if(w+=1<<R,1===e&&w>852||2===e&&w>592)return 1;l[g=M&m]=O<<24|R<<16|_-u|0}}return 0!==M&&(l[_+M]=C-P<<24|64<<16|0),p.bits=O,0}},function(e,t,n){"use strict";var i=n(12),r=4,o=0,a=1,s=2;function c(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,u=1,d=2,p=29,h=256,f=h+1+p,g=30,m=19,_=2*f+1,v=15,y=16,S=7,E=256,T=16,C=17,I=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],b=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=new Array(2*(f+2));c(P);var N=new Array(2*g);c(N);var w=new Array(512);c(w);var M=new Array(256);c(M);var k=new Array(p);c(k);var D,L,U,x=new Array(g);function F(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function H(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function G(e){return e<256?w[e]:w[256+(e>>>7)]}function j(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function B(e,t,n){e.bi_valid>y-n?(e.bi_buf|=t<<e.bi_valid&65535,j(e,e.bi_buf),e.bi_buf=t>>y-e.bi_valid,e.bi_valid+=n-y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function V(e,t,n){B(e,n[2*t],n[2*t+1])}function W(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function q(e,t,n){var i,r,o=new Array(v+1),a=0;for(i=1;i<=v;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=W(o[s]++,s))}}function z(e){var t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<g;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*E]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function K(e){e.bi_valid>8?j(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Y(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function J(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&Y(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!Y(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function X(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?V(e,r,t):(V(e,(o=M[r])+h+1,t),0!==(a=A[o])&&B(e,r-=k[o],a),V(e,o=G(--i),n),0!==(a=b[o])&&B(e,i-=x[o],a))}while(s<e.last_lit);V(e,E,t)}function Q(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=_,n=0;n<c;n++)0!==o[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)J(e,o,n);r=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],J(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,J(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=v;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<_;n++)(o=c[2*c[2*(i=e.heap[n])+1]+1]+1)>f&&(o=f,g++),c[2*i+1]=o,i>l||(e.bl_count[o]++,a=0,i>=h&&(a=p[i-h]),s=c[2*i],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(u[2*i+1]+a)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>l||(c[2*r+1]!==o&&(e.opt_len+=(o-c[2*r+1])*c[2*r],c[2*r+1]=o),i--)}}(e,t),q(o,l,e.bl_count)}function $(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<c&&r===a||(s<l?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*T]++):s<=10?e.bl_tree[2*C]++:e.bl_tree[2*I]++,s=0,o=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4))}function Z(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(s<l)do{V(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(V(e,r,e.bl_tree),s--),V(e,T,e.bl_tree),B(e,s-3,2)):s<=10?(V(e,C,e.bl_tree),B(e,s-3,3)):(V(e,I,e.bl_tree),B(e,s-11,7));s=0,o=r,0===a?(c=138,l=3):r===a?(c=6,l=3):(c=7,l=4)}}c(x);var ee=!1;function te(e,t,n,r){B(e,(l<<1)+(r?1:0),3),function(e,t,n,r){K(e),r&&(j(e,n),j(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,i,r,o=new Array(v+1);for(n=0,i=0;i<p-1;i++)for(k[i]=n,e=0;e<1<<A[i];e++)M[n++]=i;for(M[n-1]=i,r=0,i=0;i<16;i++)for(x[i]=r,e=0;e<1<<b[i];e++)w[r++]=i;for(r>>=7;i<g;i++)for(x[i]=r<<7,e=0;e<1<<b[i]-7;e++)w[256+r++]=i;for(t=0;t<=v;t++)o[t]=0;for(e=0;e<=143;)P[2*e+1]=8,e++,o[8]++;for(;e<=255;)P[2*e+1]=9,e++,o[9]++;for(;e<=279;)P[2*e+1]=7,e++,o[7]++;for(;e<=287;)P[2*e+1]=8,e++,o[8]++;for(q(P,f+1,o),e=0;e<g;e++)N[2*e+1]=5,N[2*e]=W(e,5);D=new F(P,A,h+1,f,v),L=new F(N,b,0,g,v),U=new F(new Array(0),O,0,m,S)}(),ee=!0),e.l_desc=new H(e.dyn_ltree,D),e.d_desc=new H(e.dyn_dtree,L),e.bl_desc=new H(e.bl_tree,U),e.bi_buf=0,e.bi_valid=0,z(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,i){var c,l,p=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<h;t++)if(0!==e.dyn_ltree[2*t])return a;return o}(e)),Q(e,e.l_desc),Q(e,e.d_desc),p=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),Q(e,e.bl_desc),t=m-1;t>=3&&0===e.bl_tree[2*R[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),c=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=c&&(c=l)):c=l=n+5,n+4<=c&&-1!==t?te(e,t,n,i):e.strategy===r||l===c?(B(e,(u<<1)+(i?1:0),3),X(e,P,N)):(B(e,(d<<1)+(i?1:0),3),function(e,t,n,i){var r;for(B(e,t-257,5),B(e,n-1,5),B(e,i-4,4),r=0;r<i;r++)B(e,e.bl_tree[2*R[r]+1],3);Z(e,e.dyn_ltree,t-1),Z(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,p+1),X(e,e.dyn_ltree,e.dyn_dtree)),z(e),i&&K(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(M[n]+h+1)]++,e.dyn_dtree[2*G(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){B(e,u<<1,3),V(e,E,P),function(e){16===e.bi_valid?(j(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";(function(e){function n(e){return null!==e&&void 0!==e&&"function"==typeof e.then}function i(e){return null!==e&&void 0!==e&&"function"==typeof e.cancel}function r(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var o,a=[],s=void 0!==e;function c(t){a.push(t),1===a.length&&(s?e(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),r=!1;return t.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){r||(r=!0,t.resolve(e))},function(e){r||(r=!0,t.reject(e))}):r||(r=!0,t.resolve(e))}),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var i=this,r=new e;return r.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,i._cancelInternal(e)}),t.task=r,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:r._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),r.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack;var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?r(function(){var r=t.successFunc(o._storedResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?r(function(){var r=t.failFunc(o._storedErrResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole,t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,r=u(),a=e.length,s=Array(e.length);r.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})});var c=function(){0==--a&&(void 0!==t?r.reject(t):r.resolve(s))};return e.forEach(function(e,i){n(e)?e.then(function(e){s[i]=e,c()},function(e){void 0===t&&(t=void 0===e||e),c()}):(s[i]=e,c())}),r.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),i=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(i),{timedOut:!1,result:e}}),n.promise()])}}).call(t,n(78).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(48),o=function(){function e(e){var t=this;this._disposed=!1,this._logger=e.createChild("ASYNC"),this._endOperationDeferred=r.defer(),this._endOperationDeferred.promise.catch(function(e){t._logger.log("Rejected all operations")}),this._deferredOperations={},this._deferredOperationGroups={},this._logger=e}return e.prototype.registerPromise=function(e,t){var n=!1,i=function(){n=!0};t.then(i,i);var r=this._endOperationDeferred.promise.catch(function(t){if(!n)throw new Error("Operation "+e+" did not complete, reason:"+t)});return Promise.race([r,t])},e.prototype.createPendingOperation=function(e,t){var n=this,i=r.defer();if(this._logger.info("createDeferred operation:",e),this._disposed)return Promise.reject("This call already eneded, cant create more operations");if(t){if(this._deferredOperationGroups[e]||(this._deferredOperationGroups[e]={}),this._deferredOperationGroups[e][t])return this._logger.warn("Deferred operation with given name and operation id is already defined:"+e+"/"+t),Promise.reject(new Error("Deferred operation with given name is already defined:"+e+"/"+t));this._deferredOperationGroups[e][t]=i}else{if(this._deferredOperations[e])return this._logger.warn("Deferred operation with given name is already defined:"+e),Promise.reject(new Error("Deferred operation with given name is already defined:"+e));this._deferredOperations[e]=i}var o=this._endOperationDeferred.promise.catch(function(i){return n.hasPendingOperation(e,t)?Promise.reject(new Error("Operation "+e+" did not complete, reason:"+i)):Promise.resolve()});return Promise.race([o,i.promise])},e.prototype.hasPendingOperation=function(e,t){return t?!!this._deferredOperationGroups[e]&&!!this._deferredOperationGroups[e][t]:!!this._deferredOperations[e]},e.prototype.waitForOperation=function(e,t){return this._deferredOperations[e]?this._deferredOperations[e].promise:t&&this._deferredOperationGroups[e]&&this._deferredOperationGroups[e][t]?this._deferredOperationGroups[e][t].promise:Promise.reject("Unable to find deferred operation: "+e+"/"+t)},e.prototype.resolveOperation=function(e,t,n){if(this._logger.info("resolveDeferred operation:",e),!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(this._deferredOperations[e]){var i=this._deferredOperations[e].promise;return this._deferredOperations[e].resolve(t),delete this._deferredOperations[e],i}if(this._deferredOperationGroups[e]&&this._deferredOperationGroups[e][n]){i=this._deferredOperationGroups[e][n].promise;return this._deferredOperationGroups[e][n].resolve(t),delete this._deferredOperationGroups[e][n],i}return Promise.reject("Unable to resolve deferred operation "+e+"/"+n)},e.prototype.maybeResolveOperation=function(e,t,n){return this.hasPendingOperation(e,n)?this.resolveOperation(e,t,n):(this._logger.log("Maybe resolve deferred:",e," ",n," is undefined, ignoring"),Promise.resolve())},e.prototype.rejectOperation=function(e,t,n){if(this._logger.info("rejectDeferred operation:",e),!e)return Promise.reject("Unable to reject deferred operation with empty name");if(this._deferredOperations[e]){var i=this._deferredOperations[e].promise;return this._deferredOperations[e].reject(t),delete this._deferredOperations[e],i}if(this._deferredOperationGroups[e]&&this._deferredOperationGroups[e][n]){i=this._deferredOperationGroups[e][n].promise;return this._deferredOperationGroups[e][n].reject(t),delete this._deferredOperationGroups[e][n],i}return Promise.reject("Unable to reject deferred operation"+e+"/"+n)},e.prototype.maybeRejectOperation=function(e,t,n){return this.hasPendingOperation(e,n)?this.rejectOperation(e,t,n):(this._logger.log("Maybe reject deferred:",e," ",n," is undefined, ignoring"),Promise.resolve())},e.prototype.rejectPendingOperations=function(e){this._disposed=!0,this._logger.info("rejectPendingOperations reason:",e);var t=function(t){return t.reject(e)};i.each(this._deferredOperations,t),i.each(this._deferredOperationGroups,function(e){i.each(e,t)}),this._deferredOperations={},this._deferredOperationGroups={},this._endOperationDeferred.reject(e)},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=function(){function e(e){this._logger=e,this._promise=Promise.resolve(void 0)}return e.prototype.chainPromise=function(e,t,n,r){var o=this;return void 0===r&&(r=!1),this._logger.info("enqueueing "+t+" reset: "+r+" causeId: "+n),r&&this.reset(n),this._promise=this._promise.catch(i.noop).then(function(){return o._logger.info("begin "+t+" causeId: "+n),e()}),this._promise.then(function(){o._logger.info("finished "+t+" causeId: "+n)},function(e){o._logger.warn("failed "+t+" causeId: "+n+" error: "+e)}),this._promise},e.prototype.reset=function(e){this._logger.info("resetting causeId: "+e),this._promise=Promise.resolve(void 0)},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=function(){function e(){this.subscriptions=[]}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(){this.subscriptions=[]},e.prototype.raiseEvents=function(e){this.subscriptions.slice().forEach(function(t){return t.eventHandler&&e(t.eventHandler)})},e}();t.EventSourceImpl=r;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;i.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=null},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=function(){function e(){this._children=[],this._useConsoleLogger=!1}return e.prototype.createChild=function(t,n){var i=new e;return this._children.push(i),this._useConsoleLogger&&i.useConsoleLogger(),i},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.useConsoleLogger=function(){this._useConsoleLogger=!0,this.log=console.log,this.debug=console.log,this.info=console.log,this.warn=console.log,this.error=console.log,i.each(this._children,function(e){return e.useConsoleLogger()})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e._startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e._startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e._startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),e}();t.Stopwatch=i,t.build=function(){return new i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(29);function r(e,t){if(void 0===t&&(t=null),e===i.jsCallEndCodes.Success)switch(t){case i.jsCallEndSubCodes.RemovedFromConversation:case i.jsCallEndSubCodes.RemovedFromCall:return 44;case i.jsCallEndSubCodes.DeniedInLobby:return 55;case i.jsCallEndSubCodes.TimedOutInLobby:return 56;default:return 1}if(null!=t&&t>=i.PstnTerminationCode.CallTerminationSubCodeSipGWMin&&t<=i.PstnTerminationCode.CallTerminationSubCodeSipGWMax){var n=t-i.PstnTerminationCode.CallTerminationSubCodeSipGWMin;return i.pstnConsumerResponseCodeMap[n]?i.pstnConsumerResponseCodeMap[n]:0}if(null!=t&&t>=i.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMin&&t<=i.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMax)return i.pstnEnterpriseResponseCodeMap[e]?i.pstnEnterpriseResponseCodeMap[e]:43;if(e===i.jsCallEndCodes.Forbidden){if(t===i.jsCallEndSubCodes.UserBlocked)return 64;if(t===i.jsCallEndSubCodes.PolicyRestriction)return 62}else if(e===i.jsCallEndCodes.PreconditionFailed&&t===i.jsCallEndSubCodes.InsufficientCapabilities)return 63;return i.responseCodeMap[e]?i.responseCodeMap[e]:e}t.convertReason=function(e){return e?r(e.code,e.subCode):0},t.getTerminationCode=r,t.getCSAEndCode=function(e){if(1===e)return i.jsCallEndCodes.Success;var t=Object.keys(i.responseCodeMap).filter(function(t){return i.responseCodeMap[t]===e});if(t.length>=1)for(var n=0,r=t;n<r.length;n++){var o=r[n],a=parseInt(o);if(a&&i.responseCodeMap[a]===e)return a}return i.jsCallEndCodes.UnknownError}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),r=n(96),o=n(97),a=n(98);t.initLogger=function(e,t){if(!i.RootToolsManager.isDelegateSet()){var n=new r.RootToolsManagerDelegate(e.telemetryService,t);if(i.RootToolsManager.setDelegate(n),e.logger){var s=new a.RedirectingLogAppender(e.logger);i.LogFactory.instance().addAppender(s)}}e.logger=new o.TsCallingLogger("JS.TsCalling",!1),e.mediaAgentFactoryConfig.logger=new o.TsCallingLogger("JS.TsCalling.MediaAgentUnsafe",!1),e.mediaAgentFactoryConfig.safeLogger=new o.TsCallingLogger("JS.TsCalling.MediaAgent",!0),e.signalingAgentConfig.logger=new o.TsCallingLogger("JS.TsCalling.SignalingAgent",!1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),r=n(88),o=function(){function e(e,t){this._telemetryService=e,this._ecsProvider=t,this._ecsProvider.on("OnECSChanged",function(){return i.RootToolsManager.OnEcsChange()})}return e.prototype.fetchEcsConfig=function(e,t){var n=this;return r.Resolved().then(function(){return n._ecsProvider.getEcsConfig(e,t)})},e.prototype.sendTelemetry=function(e,t){this._telemetryService.sendEvents([{eventName:"rt_log",props:t}])},e}();t.RootToolsManagerDelegate=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),r=n(6),o=function(){function e(e,t,n){void 0===n&&(n=""),this.ulLogComponent=e,this.ulSafeComponent=t,this._getPrefix=r.isFunction(n)?n:function(){return n},this.logComponent=i.LogFactory.instance().component(this.ulLogComponent),i.LogFactory.instance().declareComponentSafe(this.ulLogComponent,t)}return e.prototype.createChild=function(t){var n=this,i=r.isFunction(t)?t:function(){return t};return new e(this.ulLogComponent,this.ulSafeComponent,function(){return n._getPrefix()?n._getPrefix()+"/"+i():i()})},e.prototype.log=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug2(null,t)},t)},e.prototype.debug=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug4(null,t)},t)},e.prototype.info=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug1(null,t)},t)},e.prototype.warn=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.warn(null,t)},t)},e.prototype.error=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.error(null,t)},t)},e.prototype._apply=function(e,t){void 0===t&&(t=[]),this._addPrefix(t),e(t.map(function(e){return r.isObject(e)?JSON.stringify(e):e}).join(", "))},e.prototype._addPrefix=function(e){if(e&&e[0]){var t=this._getPrefix()+" "+e[0];e[0]=t}},e}();t.TsCallingLogger=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(24),a=function(e){function t(t){var n=e.call(this,new o.StandardLogFormatter(o.SLF_Flags.Component))||this;return n._logger=t,n}return r(t,e),t.prototype.log=function(e,t,n,i){if(this._logger){var r=e.level<=o.LogLevel.Debug4?this._logger.debug:e.level<=o.LogLevel.Debug2?this._logger.log:e.level<=o.LogLevel.Debug1?this._logger.info:e.level<=o.LogLevel.Warning?this._logger.warn:this._logger.error;r&&r.apply(this._logger,[this.formatter().format(e,t,n,i)])}},t}(o.AbstractLogAppender);t.RedirectingLogAppender=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(9),l=n(28),u=n(51),d=n(52),p=n(29),h=function(e){function t(t,n,i,r,o,a,s,c){void 0===a&&(a="");var l=e.call(this)||this;return l.callTelemetry=t,l._logger=n,l.signalingSession=i,l.contentSharingGuid=r,l.contentSharingIdentity=o,l.state=a,l.subject=s,l.handleOperationFailure=function(e,t){l._logger.log("Error in "+t.operation+"(), contentSharingGuid = "+l.contentSharingGuid+", error = "+e);var n=l.getTerminatedReasonFromError(e);return t.updateStatusTo&&(l.contentSharingStatus=t.updateStatusTo),Promise.reject(n)},l.contentSharingStatus=0,l.contentSharingTerminationReason=null,l.contentSharingState=a,l._callOperationHandler=new d.default(l._logger,l.callTelemetry),c&&(l.sessionId=c),l}return r(t,e),Object.defineProperty(t.prototype,"contentSharingStatus",{get:function(){return this.status},set:function(e){if(this._logger.log("setContentSharingStatus. currentStatus: "+this.status+" newStatus: "+e),this.callTelemetry.recordEvent(l.CONTENT_SHARING_OPERATIONS.SET_CONTENT_SHARING_STATUS,{newStatus:e,oldStatus:this.status}),this.status!==e&&7!==this.status&&8!==this.status){if(this._logger.log("Changing content sharing status to: "+e),this.status=e,7===this.status||8===this.status){var t={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:n="Content sharing is disconnected"};this._logger.info(n),this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(t)}if(2===this.status||5===this.status){var n;t={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:n="Content sharing cannot be ended when not presenting"};this._logger.error(n),this._callOperationHandler.maybeRejectOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,t)}3===this.status&&(this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),this._callOperationHandler.maybeResolveOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)),this.raiseChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentSharingState",{get:function(){return this.state},set:function(e){this.state!==e&&(this.state=e,this.raiseChanged())},enumerable:!0,configurable:!0}),t.prototype.startContentSharing=function(){var e=this;if(0!==this.contentSharingStatus){var t="Content sharing cannot be started as it is not in the initial state",n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:t};return this._logger.error(t),Promise.reject(n)}return this._logger.log("Start content sharing for : "+this.contentSharingGuid),this.signalingSession.startContentSharingAsync(this.contentSharingIdentity,this.contentSharingState,this.subject,this.contentSharingGuid).then(function(t){e.sessionId=t.sessionId,e.contentSharingStatus=3,e.presenterId=e.signalingSession.participantManager.localParticipant.id}).catch(function(t){return e.handleOperationFailure(t,{operation:l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,updateStatusTo:8})}),this._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING)},t.prototype.joinContentSharing=function(){var e=this;if(2!==this.contentSharingStatus){var t="Content sharing cannot be joined as it is not in ringing state",n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:t};return this._logger.error(t),Promise.reject(n)}return this._logger.log("Join content sharing for : "+this.contentSharingGuid),this.signalingSession.joinContentSharingAsync(this.contentSharingGuid).then(function(t){return e.contentSharingStatus=4,e.contentSharingState=t.sessionState,e.presenterId=t.presenter,Promise.resolve()}).catch(function(t){return e.handleOperationFailure(t,{operation:l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,updateStatusTo:8})})},t.prototype.updateContentSharingSessionState=function(e,t){var n=this;if(3!==this.contentSharingStatus){var i="Cannot update session state as content sharing is not in presenting state",r={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:i};return this._logger.error(i),Promise.reject(r)}return this._logger.log("Update content sharing session state for : "+this.contentSharingGuid),this.signalingSession.updateContentSharingSessionStateAsync(this.contentSharingGuid,t).then(function(){return Promise.resolve()}).catch(function(t){return n.handleOperationFailure(t,{operation:l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,operationId:e})})},t.prototype.takeContentSharingControl=function(){var e=this;if(5!==this.contentSharingStatus){var t="Cannot take control of content sharing as it is not in viewing state",n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:t};return this._logger.error(t),Promise.reject(n)}return this._logger.log("Taking control of content sharing for : "+this.contentSharingGuid),this.signalingSession.takeContentSharingControlAsync(this.contentSharingGuid).then(function(){e.contentSharingStatus=3,e.presenterId=e.signalingSession.participantManager.localParticipant.id}).catch(function(t){return e.handleOperationFailure(t,{operation:l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL})}),this._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)},t.prototype.updateContentSharingParticipantStateToViewer=function(){var e=this;if(4!==this.contentSharingStatus){var t="Cannot update participant state as content sharing is not in connected state",n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:t};return this._logger.error(t),Promise.reject(n)}return this._logger.log("Update content sharing participant state for : "+this.contentSharingGuid),this.signalingSession.updateContentSharingParticipantStateAsync(this.contentSharingGuid).then(function(){return e.contentSharingStatus=e.presenterId===e.signalingSession.participantManager.localParticipant.id?3:5,Promise.resolve()}).catch(function(t){return e.handleOperationFailure(t,{operation:l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE})})},t.prototype.stopContentSharing=function(){var e=this;if(2===this.contentSharingStatus||4===this.contentSharingStatus||5===this.contentSharingStatus){var t="Incoming content sharing cannot be stopped",n={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:t};return this._logger.error(t),Promise.reject(n)}return this._logger.log("Stop content sharing for : "+this.contentSharingGuid),this.signalingSession.deleteContentSharingAsync(this.contentSharingGuid).then(function(){return e.contentSharingStatus=7,e._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)}).catch(function(t){return e.handleOperationFailure(t,{operation:l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING})})},t.prototype.dispose=function(){this._callOperationHandler.rejectPendingOperations({terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"}),this.contentSharingStatus=7,this.contentSharingState="",e.prototype.dispose.call(this)},t.prototype.getTerminatedReasonFromError=function(e){var t=e&&e.endCode&&e.endCode.code||0,n={terminatedReason:32,terminatedReasonCode:t,terminatedReasonSubCode:e&&e.endCode&&e.endCode.subCode||0,errorMessage:e};switch(t){case p.jsCallEndCodes.NotFound:n.terminatedReason=34,n.errorMessage="Active session not found on server"}return n},o([u.callOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"startContentSharing",null),o([u.callOperation(l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"joinContentSharing",null),o([u.callOperation(l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE),s(0,u.operationId),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"updateContentSharingSessionState",null),o([u.callOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"takeContentSharingControl",null),o([u.callOperation(l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"updateContentSharingParticipantStateToViewer",null),o([u.callOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"stopContentSharing",null),t}(c.default);t.default=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(22),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.config=null,t}return r(t,e),Object.defineProperty(t.prototype,"ETag",{get:function(){return this.etag},enumerable:!0,configurable:!0}),t.prototype.setEcsConfig=function(e){var t=this;return Promise.resolve().then(function(){t.config=JSON.parse(e.ecsBlob),t.etag=e.etag,t.event("OnECSChanged").raise()})},t.prototype.getEcsQueryParameters=function(){var e={};return e.CLRelease=a.TsCallingVersionProvider.getVersion(),Promise.resolve(JSON.stringify(e))},t.prototype.getEcsConfig=function(e,t){var n=this.config&&this.config[e];return t?n&&n[t]:n},t}(o.default);t.PluginlessEcsProvider=s},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(71),o=n(22);t.callSignalingAgentEcsNS="jscsa";var a=function(){function e(e,t){var n=this;this.signalingAgentConfig=e,this.ecsProvider=t,this.ecsProvider.on("OnECSChanged",function(){return n.onEcsUpdate()}),this.signalingAgent=new r.SignalingAgent(this.getSignalingAgentConfig())}return e.prototype.getSignalingAgent=function(){return this.signalingAgent},e.prototype.onEcsUpdate=function(){var e=this.ecsProvider.getEcsConfig(t.callSignalingAgentEcsNS);e&&(this.signalingAgentConfig=i({},this.signalingAgentConfig,e),this.signalingAgent.updateSignalingAgentConfig(this.getSignalingAgentConfig()))},e.prototype.getSignalingAgentConfig=function(){return this.signalingAgentConfig.clientInformation+="/TsCallingVersion="+o.TsCallingVersionProvider.getVersion()+"/Ovb="+o.TsCallingVersionProvider.getOvb(),this.signalingAgentConfig.handleRosterFromCreateAndJoin=!0,this.signalingAgentConfig},e}();t.SignalingAgentProvider=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n(54).default);t.default=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.type=1,o}return r(t,e),t.prototype.attachRenderer=function(e,t){return this.logger.info("attachRenderer: videoRenderer="+e+", id="+t),e.subscribeVideoAsync(t,!0)},t}(n(55).default);t.default=o},function(e,t,n){"use strict";var i=n(2),r=n(5),o=function(){return function(e){this.id=e,this.startTimestamp=0,this.totalTime=0}}(),a=function(){function e(e){this.sources=[],this.configProvider=e.configProvider,this.ping=this.setupTimer()}return e.prototype.setSources=function(e){var t=this,n=(e=e||[]).map(this.getOrCreateSource.bind(this)),i=this.excludeSources(this.sources,n);n.filter(function(e){return!t.isAlreadyActive(e)}).forEach(this.updateSourceTimestamp),i.forEach(function(e){t.updateTotalTime(e),t.resetStartTimestamp(e)}),this.ping||(this.ping=this.setupTimer())},e.prototype.setOnDominantSpeakerChanged=function(e){this.callback=e},e.prototype.dispose=function(){this.clearTimer(),this.sources=null,this.callback=null},e.prototype.excludeSources=function(e,t){return e.filter(function(e){return!t.some(function(t){return e.id===t.id})})},e.prototype.trigger=function(){if(this.hasAnyoneSpoken()){var e=this.sources.map(this.updateTotalTime).sort(function(e,t){return t.totalTime-e.totalTime}).map(function(e){return e.id});e.length&&!i.deepEqual(this.candidates,e)&&(this.candidates=e,this.callback&&this.callback(e)),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)}else this.clearTimer()},e.prototype.isAlreadyActive=function(e){return!!e.startTimestamp},e.prototype.setupTimer=function(){return r.default.window.setInterval(this.trigger.bind(this),this.configProvider.config.activeSpeaker.timeToPromote)},e.prototype.clearTimer=function(){this.ping&&(r.default.window.clearInterval(this.ping),this.ping=null)},e.prototype.getOrCreateSource=function(e){if(this.isExist(e))return this.sourceById(e);var t=new o(e);return this.sources.push(t),t},e.prototype.isExist=function(e){return this.sources.some(function(t){return e===t.id})},e.prototype.hasAnyoneSpoken=function(){return this.sources.some(function(e){return 0!==e.startTimestamp||0!==e.totalTime})},e.prototype.sourceById=function(e){return i.find(this.sources,function(t){return e===t.id})},e.prototype.updateSourceTimestamp=function(e){e.startTimestamp=Date.now()},e.prototype.updateTotalTime=function(e){return e.startTimestamp&&(e.totalTime+=Date.now()-e.startTimestamp),e},e.prototype.resetStartTimestamp=function(e){return e.startTimestamp=0,e},e.prototype.resetTotalTime=function(e){return e.totalTime=0,e},e}();t.DSHGeneratingStrategy=a},function(e,t,n){"use strict";var i=n(5),r=function(){function e(e){var t=this;this.configProvider=e,this.window=i.default.window,this.updateCapabilityOverrides(),e.on("configUpdated",function(){return t.updateCapabilityOverrides()})}return Object.defineProperty(e.prototype,"audio",{get:function(){return this.getCapability("audio")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this.getCapability("video")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screensharing",{get:function(){return this.getCapability("screensharing")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retargeting",{get:function(){return this.getCapability("retargeting")},enumerable:!0,configurable:!0}),e.prototype.updateCapabilityOverrides=function(){var e;this.configProvider.config.capabilities&&(this.hasOrtc()?e=this.configProvider.config.capabilities.ortc:this.hasWebRtc()&&(e=this.configProvider.config.capabilities.webrtc)),this.overrides=e||{}},e.prototype.hasMediaCapture=function(){return!!this.window.navigator.getUserMedia},e.prototype.getCapability=function(e){return void 0!==this.overrides[e]?!!this.overrides[e]:this.hasMediaCapture()&&(this.hasOrtc()||this.hasWebRtc())},e.prototype.hasWebRtc=function(){return void 0!==this.window.RTCPeerConnection},e.prototype.hasOrtc=function(){return void 0!==this.window.RTCIceGatherer},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=n(2),r=function(){function e(){this.subscriptions=[]}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(){this.subscriptions=[]},e.prototype.raiseEvents=function(e){this.subscriptions.slice().forEach(function(t){return t.eventHandler&&e(t.eventHandler)})},e}();t.EventSourceImpl=r;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;i.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=null},e}()},function(e,t,n){"use strict";n(33);var i=n(108),r=n(3),o=function(){function e(e,t,n,r,o,a){this.session=e,this.statistics=n,this.sessionOperationQueue=r,this.callback=o,this.sessionCallbacks=a,this.allowUFD=!1,this.reconnectGlare=!1,this.isEscalation=!1,this.reconnectQualityLevel=1,this.logger=t.getLogger(),this.settings=t.maContext.settings,this.session.callbacks=a,this.reconnectManagerMessageQueue=new i.default(a)}return e.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},e.prototype.getMainSession=function(){return this.session},e.prototype.getReconnectSession=function(){return this.reconnectSession},e.prototype.onIceDisconnect=function(){return this.logger.safe.info("reconnect attempt after iceDisconnect error"),this.allowUFD&&this.raiseReconnectEvent(3),this.statistics.registerReconnectAttempted(),this.reconnectAsync()},e.prototype.onTransportConnected=function(e){e&&(this.allowUFD&&this.raiseReconnectEvent(1),this.statistics.registerReconnectConnected()),this.allowUFD=!0},e.prototype.onNegotiationCompletedAsync=function(){return this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.isReconnecting()?(this.reconnectGlare=!1,this.statistics.registerRetargetCompleted(),this.isEscalation?Promise.resolve():this.completeReconnect()):this.reconnectGlare?(this.reconnectGlare=!1,this.reconnectAsync(),Promise.resolve()):void 0},e.prototype.onNegotiationRejectedAsync=function(e,t){var n=this;return this.statistics.registerRetargetRejected(),this.rejectReconnect().then(function(){t?n.reconnectAsync():e===r.default.RENEGOTIATION_ERROR.glare?(n.reconnectGlare=!0,n.glareTimer=setTimeout(function(){n.callback.onSessionErrorOccurred({type:r.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+e})},n.settings.reconnectGlareCallDropTimeout||1e4)):n.callback.onSessionErrorOccurred({type:r.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+e})})},e.prototype.reconnectAsync=function(){var e=this;return this.logger.safe.log("queueing reconnect"),this.sessionOperationQueue.queueOperation(function(){return e.logger.safe.log("starting reconnect"),e.reconnectCloneSession(),e.reconnectSession.muteInputAsync().then(function(){return e.reconnectSession.configureModalitiesAsync(e.session.getConfiguredModalities())}).then(function(){e.sessionOperationQueue.completeCurrentOperation()})})},e.prototype.acceptReconnectStartAsync=function(e){return this.logger.safe.log("accepting reconnect"),this.statistics.registerRetargetIncoming(),e&&(this.isEscalation=!0,this.statistics.registerEscalationStart()),this.reconnectCloneSession(e),this.reconnectSession.muteInputAsync()},e.prototype.acceptReconnectFinish=function(){var e=this.session.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(e).then(function(){return e})},e.prototype.isReconnecting=function(){return!!this.reconnectSession},e.prototype.reset=function(){this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.reconnectGlare=!1,this.session.callbacks=this.sessionCallbacks},e.prototype.cleanUp=function(){this.sessionCallbacks={},this.reset()},e.prototype.terminateAsync=function(){var e=this,t=function(){return e.terminateReconnectSessionAsync().then(function(){return e.cleanUp()},function(){return e.cleanUp()})};return this.session.terminate().then(t,t)},e.prototype.completeReconnect=function(){if(this.logger.safe.log("completing reconnect"),this.isEscalation&&(this.statistics.registerEscalationCompleted(),this.isEscalation=!1),this.reconnectSession){this.reconnectManagerMessageQueue.clear();var e=this.session;return this.session=this.reconnectSession,e.move(this.session),this.reconnectSession=null,e.terminate()}return Promise.resolve()},e.prototype.rejectReconnect=function(){if(this.logger.safe.log("rejecting reconnect"),this.isEscalation&&(this.statistics.registerEscalationRejected(),this.isEscalation=!1),this.reconnectSession){this.reconnectManagerMessageQueue.flush();var e=this.reconnectSession;return this.reconnectSession=null,e.terminate()}return Promise.resolve()},e.prototype.configureModalitiesAsync=function(e){return this.isReconnecting()?Promise.all([this.session.configureModalitiesAsync(e),this.reconnectSession.configureModalitiesAsync(e)]).then(function(){return Promise.resolve()}):this.session.configureModalitiesAsync(e)},e.prototype.canSendDtmf=function(){return this.session.canSendDtmf()},e.prototype.getExtensionsManager=function(){return this.session.getExtensionsManager()},e.prototype.muteInputAsync=function(){return this.session.muteInputAsync()},e.prototype.unmuteInputAsync=function(){return this.session.unmuteInputAsync()},e.prototype.muteOutputAsync=function(){return this.session.muteOutputAsync()},e.prototype.unmuteOutputAsync=function(){return this.session.unmuteOutputAsync()},e.prototype._deviceSelectionChanged=function(){this.session._deviceSelectionChanged(),this.isReconnecting()&&this.reconnectSession._deviceSelectionChanged()},e.prototype.reconnectCloneSession=function(e){void 0===e&&(e=!1),this.reconnectSession=this.session.clone(e),this.reconnectSession.callbacks=this.sessionCallbacks,this.session.callbacks=this.reconnectManagerMessageQueue.queueCallbacks},e.prototype.raiseReconnectEvent=function(e){if(this.reconnectQualityLevel!==e){this.reconnectQualityLevel=e;var t={type:5,value:e,isLocalSource:!0,mediaType:0};this.callback&&this.callback.onAudioQualityChanged&&this.callback.onAudioQualityChanged(t)}},e.prototype.terminateReconnectSessionAsync=function(){return this.reconnectSession?this.reconnectSession.terminate():Promise.resolve()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=function(){function e(e){this.initialCallbacks=e,this.queue=[],this.queueCallbacks={onTerminated:this.genCallback(this.initialCallbacks.onTerminated),onSessionErrorOccurred:this.genCallback(this.initialCallbacks.onSessionErrorOccurred),onNegotiationRequired:this.genCallback(this.initialCallbacks.onNegotiationRequired),onAudioStateChanged:this.genCallback(this.initialCallbacks.onAudioStateChanged),onAudioQualityChanged:this.genCallback(this.initialCallbacks.onAudioQualityChanged),onAudioHwSilentChanged:this.genCallback(this.initialCallbacks.onAudioHwSilentChanged),onTransportConnected:this.genCallback(this.initialCallbacks.onTransportConnected),onTransportInitialized:this.genCallback(this.initialCallbacks.onTransportInitialized),onScreenSharingIncomingDecoderFailed:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderFailed),onScreenSharingIncomingDecoderActive:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderActive),onScreenSharingIncomingDecoderReset:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderReset)}}return e.prototype.flush=function(){this.queue.forEach(function(e){e.method.apply(null,e.args)}),this.clear()},e.prototype.clear=function(){this.queue=[]},e.prototype.genCallback=function(e){var t=this;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return t.queue.push({method:e,args:n})}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(30),o=n(17),a=function(e){function t(t,n,i,r){var a=e.call(this,t)||this;return a.mediaStreamProvider=i,a.logger=r,a.isDisposed=!1,a.serialQueue=new o.PromiseQueue(a.logger.createChild("rendererQueue")),a.logger.safe.log("ctor"),a.onSizeChanged(n?n.onVideoSizeChanged:null),a}return i(t,e),t.prototype.dispose=function(){this.logger.safe.log("dispose"),this.isDisposed=!0,this.event("onRendererDisposed").raise(this),e.prototype.dispose.call(this),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null)},t.prototype.startVideoAsync=function(){var e=this;return this.event("onRendererStarted").raise(this),this.serialQueue.add(function(){return e.startVideo()})},t.prototype.attachStreamAsync=function(e){var t=this;return this.serialQueue.add(function(){return t.attachStream(e)})},t.prototype.startVideo=function(){var e=this;this.logger.safe.log("starting local video");var t=this.mediaStreamProvider.getAudioVideoStream();return t.start().then(function(){if(e.isDisposed)throw t.dispose(),new Error("local video renderer is disposed");e.attachStream(t)})},t.prototype.attachStream=function(t){var n=this;if(this.logger.safe.log("attach media stream "+(t&&t.streamId)),this.mediaStream!==t)try{this.mediaStream&&(e.prototype.reattachEventListeners.call(this),this.mediaStream.dispose(),this.mediaStream=null),t&&(t.onApplyConstraints=function(i){e.prototype.attachMediaStream.call(n,null),i.then(function(){e.prototype.attachMediaStream.call(n,t.rawStream)})},e.prototype.attachMediaStream.call(this,t.rawStream)),this.mediaStream=t}catch(e){throw t&&t.dispose(),e}},t}(r.default);t.LocalVideoRenderer=a},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(3),o=n(30),a=n(60),s=function(e){function t(t,n,i,r){var o=e.call(this,n)||this;return o.disposed=!1,o.logger=t.logger,o.configProvider=t.configProvider,o.subscriptionManager=t.subscriptionManager,o.rendererSizeChangedListener=r,o.onSizeChanged(i?i.onVideoSizeChanged:null),o.onError(i?i.onError:null),o}return i(t,e),t.prototype.subscribeVideoAsync=function(e,t){var n=this;return new Promise(function(i,o){n.rendererType=t?r.default.RENDERER_TYPE.sharing:r.default.RENDERER_TYPE.video,n.trackElementSizeChange(),n.unsubscribe();var a=n.subscriptionManager.subscribe(n.rendererType,e);n.subscription=a,n.logger.safe.info("subscribing renderer to type: "+a.getModality()+" msi: "+a.getMsi()),a.onMediaStreamChanged(function(e){n.attachMediaStream(e),n.logger.safe.info("subscribed renderer to type: "+a.getModality()+" msi: "+a.getMsi()+" on stream #"+(e?e.id:"none")),i()}),a.onError(function(e){n.logger.safe.error("failed to subscribe renderer "+e),o(e)})})},t.prototype.dispose=function(){this.disposed?this.logger.safe.warn("renderer already disposed"):(this.disposed=!0,this.unsubscribe(),this.sizeTracker&&this.sizeTracker.dispose(),e.prototype.dispose.call(this))},t.prototype.getModality=function(){return this.rendererType},t.prototype.trackElementSizeChange=function(){var e=this,t=this.rendererType===r.default.RENDERER_TYPE.sharing,n=t?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMin:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMin,i=t?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMax:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMax;n&&i?(this.sizeTracker=new a.default(this.getVideoElement(),{interval:{min:n,max:i}}),this.sizeTracker.onSizeChange(function(t,n){e.logger.safe.log("video renderer size changed to "+t+"x"+n),e.rendererSizeChangedListener(e,t,n)})):this.logger.safe.info("skipping video size tracking")},t.prototype.unsubscribe=function(){this.subscription&&(this.subscription.dispose(),this.subscription=null)},t}(o.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t,n){"use strict";var i=function(){function e(){}return e.prototype.getId=function(){return 0},e.prototype.getPreviewAsync=function(e,t){return Promise.resolve(null)},e.prototype.getDescription=function(){return"display"},e.prototype.getType=function(){return 1},e.prototype.getIcon=function(e,t){return Promise.resolve(null)},e}(),r=function(){function e(){this.sharingSource=new i}return e.prototype.onScreensChanged=function(e){return{dispose:function(){}}},e.prototype.enumerateScreensAsync=function(){return Promise.resolve([this.sharingSource])},e.prototype.enumerateWindowsAsync=function(){return Promise.resolve([])},e}();t.ScreenSharingManager=r},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(149),o=n(148),a=n(2),s=n(113),c=n(107),l=n(33),u=n(10),d=n(14),p=function(){function e(e,t){this.relayManager=e,this.sessionStatistics=t}return e.prototype.initialize=function(){},e.prototype.queryRelaysAsync=function(e,t){var n=this;return this.relayManager.queryRelaysAsync(e,t).then(function(e){return e.length>0&&n.sessionStatistics.setRelay(e[0]),e})},e.prototype.getStats=function(){return this.relayManager.getStats?this.relayManager.getStats():{unavailable:"1"}},e}(),h=function(e){function t(t,n,i,a,u){var d=e.call(this)||this;d.context=n,d.callback=a,d.configProvider=u,d.audioStreamStates=((h={})[l.Constants.STREAMING_STATE.inactive]=[l.Constants.STREAMING_STATE.active,l.Constants.STREAMING_STATE.failed],h[l.Constants.STREAMING_STATE.active]=[l.Constants.STREAMING_STATE.removed,l.Constants.STREAMING_STATE.stopped,l.Constants.STREAMING_STATE.failed],h),d.rejectedNegotiations=0,d.negotiationState=null,d.iceDisconnectedRetried=!1,d.audioStreamState=l.Constants.STREAMING_STATE.inactive,d.logger=n.getLogger(),d.statistics=new r.default,d.mediaLegId=o.default.build(),d.sessionOperationQueue=new s.default(d.logger),d.statistics.setId(i),d.configProvider&&(d.statistics.setETag(d.configProvider.ETag),d.configUpdateDisposable=d.configProvider.on("configUpdated",function(){return d.statistics.setETag(d.configProvider.ETag)})),n.config.isConference&&d.statistics.setMultiParty();var p=d.getSessionCallbacks();t.callbacks=p,t.relayManagerProvider=d;var h,f=d.getReconnectManagerCallbacks();return d.reconnectManager=new c.default(t,n,d.statistics,d.sessionOperationQueue,f,p),d.deviceManager=d.context.getDeviceManager(),d.deviceManagerDisposable=d.deviceManager.on("onDevicesPermissionChanged",function(e){return d._devicePermissionsChanged(e)}),d}return i(t,e),t.prototype.createOfferAsync=function(){var e=this;return this.sessionOperationQueue.queueOperation(function(){return e.statistics.negotiation.offering.started(),e.getCurrentSession().createOfferAsync().then(function(t){return e.updateSelectedDevices(),t.mediaLegId=e.mediaLegId.process(t.mediaLegId),e.reconnectManager.isReconnecting()&&(e.statistics.registerRetargetOutgoing(),t.newOffer=!0),t}).catch(function(t){throw e.statistics.setError(t),t})}).then(function(e){return e})},t.prototype.processOfferAsync=function(e){var t=this;return this.sessionOperationQueue.queueOperation(function(){return t.statistics.negotiation.answering.started(),t.mediaLegId.process(e.mediaLegId),(e.newOffer?t.reconnectManager.acceptReconnectStartAsync(e.escalationOccurring):Promise.resolve()).then(function(){return t.getCurrentSession().processOfferAsync(e)}).then(function(n){return e.newOffer?t.reconnectManager.acceptReconnectFinish():Promise.resolve(n)}).catch(function(e){throw t.statistics.setError(e),e})})},t.prototype.processAnswerAsync=function(e,t){var n=this;return this.getCurrentSession().processAnswerAsync(e,t).catch(function(e){throw n.statistics.setError(e),e})},t.prototype.completeNegotiationAsync=function(){var e=this;return this.rejectedNegotiations=0,this.getCurrentSession().completeNegotiationAsync().then(function(t){return e.negotiationState=t,e.statistics.setFinalAnswerTimestamp((new Date).getTime()),e.statistics.negotiation.current.completed(),e.reconnectManager.onNegotiationCompletedAsync()}).then(function(){return e.sessionOperationQueue.completeCurrentOperation(),e.negotiationState}).catch(function(t){throw e.statistics.setError(t),t})},t.prototype.rejectNegotiationAsync=function(e){var t=this,n=++this.rejectedNegotiations<=this.context.configProvider.config.renegotiationAttempts&&this.isRetriableError(e);return this.statistics.negotiation.current.rejected(),this.reconnectManager.reset(),(this.reconnectManager.isReconnecting()?this.reconnectManager.onNegotiationRejectedAsync(e,n).then(function(){return t.negotiationState}):this.getCurrentSession().rejectNegotiationAsync(e,n)).then(function(e){return t.negotiationState=e,t.sessionOperationQueue.completeCurrentOperation(),e}).catch(function(e){throw t.statistics.setError(e),e})},t.prototype.completeEscalationAsync=function(){return this.reconnectManager.completeReconnect()},t.prototype.rejectEscalationAsync=function(e){return this.reconnectManager.rejectReconnect()},t.prototype.terminate=function(){var e=this;this.statistics.terminated();var t=function(){return e.cleanUp()};return this.reconnectManager.terminateAsync().then(t,t)},t.prototype.getStatsAsync=function(){var e=this;return this.getMainSession().getStatsAsync().then(function(t){return e.prepareStats(t)})},t.prototype.getLastKnownStats=function(){return this.prepareStats(this.getMainSession().getLastKnownStats())},t.prototype.prepareStats=function(e){return this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.generateStatistics(e,this.mediaLegId)},t.prototype.createAnswerAsync=function(e){var t=this;return this.getCurrentSession().createAnswerAsync(e).then(function(e){return t.updateSelectedDevices(),e.mediaLegId=t.mediaLegId.process(e.mediaLegId),e}).catch(function(e){throw t.statistics.setError(e),e})},t.prototype.configureModalitiesAsync=function(e){return a.forOwn(e,function(t,n){t||delete e[n]}),this.reconnectManager.configureModalitiesAsync(e)},t.prototype.getAllowedModalities=function(){return this.deviceManager.getAllowedModalities()},t.prototype.createRemoteRenderer=function(e,t){return this.getMainSession().createRemoteRenderer(e,t)},t.prototype.sendDtmf=function(e){var t=this;return this.getMainSession().sendDtmf(e).then(function(e){return t.statistics.dtmfResult(!0),e}).catch(function(e){throw t.statistics.dtmfResult(!1),e})},t.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},t.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},t.prototype.muteInputAsync=function(){return this.statistics.setSwMute(!0),this.reconnectManager.muteInputAsync()},t.prototype.unmuteInputAsync=function(){return this.statistics.setSwMute(!1),this.reconnectManager.unmuteInputAsync()},t.prototype.muteOutputAsync=function(){return this.statistics.setSpeakerMute(!0),this.reconnectManager.muteOutputAsync()},t.prototype.unmuteOutputAsync=function(){return this.statistics.setSpeakerMute(!1),this.reconnectManager.unmuteOutputAsync()},t.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},t.prototype._deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},t.prototype._deviceListChanged=function(e){e&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged()},t.prototype._qualityChanged=function(e){this.statistics.registerQualityStateChangedEvent(e),this.callback&&this.callback.onAudioQualityChanged&&(2!==e.type||d.hasOrtc()||this.context.configProvider.config.webrtcStatNetworkDetectionEnabled)&&this.callback.onAudioQualityChanged(e)},t.prototype._devicePermissionsChanged=function(e){this.statistics.setSendModalities(this.getAllowedModalities())},t.prototype.registerDeviceTelemetryEvent=function(e){this.statistics.registerDeviceTelemetryEvent(e)},t.prototype.reconnectAsync=function(){return this.reconnectManager.reconnectAsync()},t.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},t.prototype.getRelayManager=function(){return this.relayManager||(this.relayManager=new p(this.context.maContext.getRelayManager(),this.statistics))},t.prototype.selectSharingSource=function(e,t){return this.reconnectManager.getCurrentSession().selectSharingSource(e,t)},t.prototype.cleanUp=function(){this.callback=null,this.configUpdateDisposable.dispose(),this.deviceManagerDisposable.dispose()},t.prototype.updateSelectedDevices=function(){var e=this,t=this.deviceManager.getSelectedDevices(),n=function(t){return t?e.deviceManager.getDeviceNameAsync(t).then(function(e){return e||"unknown"}):Promise.resolve("none")};Promise.all([n(t.microphone),n(t.speaker),n(t.camera)]).then(function(t){var n=t[0],i=t[1],r=t[2];e.statistics.setUsedDevices({microphone:n,speaker:i,camera:r})})},t.prototype.isRetriableError=function(e){return l.Constants.RENEGOTIATION_ERROR.signaling===e||l.Constants.RENEGOTIATION_ERROR.media===e},t.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},t.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},t.prototype.setAudioStreamState=function(e){this.isAudioStateValid(e)?this.raiseAudioStateChanged(e):this.logger.safe.error("audio state transition is invalid: "+this.audioStreamState+" -> "+e)},t.prototype.isAudioStateValid=function(e){return this.audioStreamStates[this.audioStreamState].indexOf(e)>=-1},t.prototype.raiseAudioStateChanged=function(e){if(this.logger.safe.log("audio state changed to "+e),this.callback.onAudioStateChanged){var t={content:"audio",direction:"receive",stream:e};this.callback.onAudioStateChanged(t)}},t.prototype.getReconnectManagerCallbacks=function(){var e=this;return{onAudioQualityChanged:function(t){e.callback.onAudioQualityChanged&&e.callback.onAudioQualityChanged(t)},onSessionErrorOccurred:function(t){e.setAudioStreamState(l.Constants.STREAMING_STATE.failed),e.callback.onSessionErrorOccurred&&(e.callback.onSessionErrorOccurred(t),e.whitelistingIssue&&e.iceDisconnectedRetried&&t.type===l.Constants.MEDIA_ERROR.iceConnectionError&&e._qualityChanged(e.whitelistingIssue))}}},t.prototype.getSessionCallbacks=function(){var e=this;return{onTerminated:function(){e.event("onTerminated").raise(e)},onSessionErrorOccurred:function(t){return!e.getCurrentSession().isReconnectSupported()||t.type!==l.Constants.MEDIA_ERROR.iceConnectionError||e.iceDisconnectedRetried?(e.setAudioStreamState(l.Constants.STREAMING_STATE.failed),e.callback.onSessionErrorOccurred(t),e.iceDisconnectedRetried&&t.type===l.Constants.MEDIA_ERROR.iceConnectionError&&e.whitelistingIssue&&e._qualityChanged(e.whitelistingIssue),e.statistics.setError(t),e.iceDisconnectedRetried?e.reconnectManager.rejectReconnect():Promise.resolve()):(e.iceDisconnectedRetried=!0,e.reconnectManager.onIceDisconnect())},onNegotiationRequired:this.callback.onNegotiationRequired,onAudioQualityChanged:function(t){32===t.type?e.whitelistingIssue=t:e._qualityChanged(t)},onAudioHwSilentChanged:function(t){e.statistics.setHwSilent(t)},onAudioStateChanged:function(t){e.setAudioStreamState(t)},onTransportConnected:function(){e.reconnectManager.onTransportConnected(e.iceDisconnectedRetried),e.iceDisconnectedRetried=!1,e.whitelistingIssue=void 0,e.statistics.setIceConnectedStateTimestamp((new Date).getTime())},onTransportInitialized:function(){e.statistics.setIceInitTimestamp((new Date).getTime())},onScreenSharingIncomingDecoderFailed:function(){e.statistics.registerSSIncomingDecoderFailed()},onScreenSharingIncomingDecoderActive:function(){e.statistics.registerSSIncomingDecoderActive()},onScreenSharingIncomingDecoderReset:function(){e.statistics.registerSSIncomingDecoderReset()}}},t}(u.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=h},function(e,t,n){"use strict";var i=n(17),r=n(13),o=function(){function e(e){this.logger=e,this.operationQueue=null,this.currentOperationDeferred=null,this.operationQueue=new i.PromiseQueue(this.logger)}return e.prototype.queueOperation=function(e){var t=this;this.logger.log("queueing operation");var n=new r.SettablePromise,i=this.operationQueue.add(function(){return t.currentOperationDeferred=n,e()});return this.operationQueue.add(n),i},e.prototype.completeCurrentOperation=function(){this.currentOperationDeferred&&(this.logger.log("completing operation"),this.currentOperationDeferred.resolve())},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(2),r=function(){function e(e,t){this.logger=e,this.deviceManager=t,this.mediaStreams=new Map,this.streamSubscriptions=new Map}return Object.defineProperty(e.prototype,"streams",{get:function(){return this.mediaStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaModalities",{get:function(){return this.modalities},enumerable:!0,configurable:!0}),e.prototype.start=function(e){return this.streamsRequestPromise&&i.deepEqual(this.modalities,e)?this.streamsRequestPromise:(this.streamsRequestPromise=this.startStreamsWithModalities(e),this.streamsRequestPromise)},e.prototype.stop=function(){this.logger.log("stopping media session"),this.mediaStreams.forEach(function(e){return e.dispose()}),this.mediaStreams.clear(),this.streamsRequestPromise=null},e.prototype.restart=function(e){return this.logger.log("refresh media session streams}"),this.stop(),i.deepEqual(this.modalities,e)||this.logger.error("refreshing media session with not the same modalities as it was created. Initial: "+i.mapToString(this.modalities)+", new: "+i.mapToString(e)),this.start(e)},e.prototype.startStreamsWithModalities=function(e){var t=this;this.logger.log("starting media session with modalities: "+i.mapToString(e)),this.modalities=e,this.matchStreamsWithModalities();var n=[];return this.mediaStreams.forEach(function(e){return n.push(e.start())}),Promise.all(n).then(function(){t.logger.log("Media streams started successfully: "+i.mapToString(e))}).catch(function(e){throw t.logger.error("Media stream starting failure: "+e),e})},e.prototype.matchStreamsWithModalities=function(){var e=this;this.modalities.forEach(function(t,n){var i=e.streams.get(n),r=e.modalities.get(n);if(r&&!i){var o=e.getStream(n);e.subscribeOnMediaStreamEvents(o),e.mediaStreams.set(n,o)}!r&&i&&(i.dispose(),e.mediaStreams.delete(n))})},e.prototype.subscribeOnMediaStreamEvents=function(e){var t=this;if(!this.streamSubscriptions.has(e)){var n=[];n.push(e.on("onStreamError",function(e,n){return t.onStreamError(e,n)})),this.streamSubscriptions.set(e,n)}},e.prototype.unsubscribeFromMediaStreamEvents=function(e){this.streamSubscriptions.has(e)&&(this.streamSubscriptions.get(e).forEach(function(e){return e.dispose()}),this.streamSubscriptions.delete(e))},e.prototype.getStream=function(e){var t=this.mediaStreams.get(e);return t||this.getStreamByMediaType(e)},e.prototype.getStreamByMediaType=function(e){switch(e){case 0:return this.deviceManager.getAudioStream();case 1:return this.deviceManager.getVideoStream();case 3:return this.deviceManager.getDisplayStream();default:throw new Error("Media type is not supported: "+e)}},e.prototype.getMediaTypeForStream=function(e){var t;return this.mediaStreams.forEach(function(n,i){n===e&&(t=i)}),t||this.logger.error("Media type is not found for stream: "+e),t},e.prototype.onStreamError=function(e,t){this.unsubscribeFromMediaStreamEvents(e),e.dispose();var n=this.getMediaTypeForStream(e);this.mediaStreams.delete(n),this.modalities.get(n)||this.logger.error("Modality with media type "+n+" is already switched off"),this.modalities.set(n,!1)},e}();t.SessionStreamsProvider=r},function(e,t,n){"use strict";var i=n(31),r=n(116),o=n(2),a=function(){function e(e){this.logger=e,this.initialConstraints={maxWidth:1920,minWidth:1920,maxHeight:1080,minHeight:1080,fps:30},this.resTable=new i.default}return e.prototype.createConstraintsObject=function(e){var t=this.convertConstraints(e.audio,{}),n=this.convertConstraints(e.video,this.initialConstraints);return new r.ConstraintsObject(t,n)},e.prototype.updateVideoDeviceId=function(e,t){if(!e.video||e.video.deviceId===t)return e;var n=this.cloneConstraints(e);return n.video.deviceId=t,n},e.prototype.updateVideoConstraints=function(e,t){if(!t.maxFS||!t.maxFPS)return e;var n=this.resTable.getResolution(t.maxFS);if(!this.isInRange(n.width,e.video.minWidth,e.video.maxWidth)||!this.isInRange(n.height,e.video.minHeight,e.video.maxHeight)||e.video.fps!==t.maxFPS){var i=this.cloneConstraints(e);return i.video.maxWidth=n.width,i.video.minWidth=n.width,i.video.maxHeight=n.height,i.video.minHeight=n.height,i.video.fps=t.maxFPS,i}return e},e.prototype.getKey=function(e){return e.video?o.isEmpty(e.video)?"video":e.video.deviceId&&e.video.minWidth&&e.video.minHeight?e.video.deviceId+"x"+e.video.minWidth+"x"+e.video.minHeight:e.video.minWidth&&e.video.minHeight?e.video.minWidth+"x"+e.video.minHeight:e.video.deviceId?""+e.video.deviceId:(this.logger.error("Cannot create key for constraints: "+e),""):"audio"},e.prototype.generatePolicies=function(e){var t=this;if(!e.video)return[e];var n=this.resTable.getResolutions().filter(function(t){return t.width<=e.video.maxWidth&&t.height<=e.video.maxHeight}).reverse().map(function(n){var i=t.cloneConstraints(e);return i.video.minWidth=n.width,i.video.minHeight=n.height,i}),i=e.audio,o={deviceId:e.video.deviceId},a=new r.ConstraintsObject(i,o);return n.push(a),this.logger.safe.log("Setting mandatory constraints: "+JSON.stringify(n)),n},e.prototype.convertConstraints=function(e,t){if(!e)return null;var n=o.deepClone(t),i=e.deviceId;return e&&i&&(n.deviceId=i),n},e.prototype.isInRange=function(e,t,n){return t<=e&&e<=n},e.prototype.cloneConstraints=function(e){var t=o.deepClone(e.video),n=o.deepClone(e.audio);return new r.ConstraintsObject(n,t)},e}();t.ConstraintsManager=a},function(e,t,n){"use strict";var i=function(){return function(e,t){this.audio=e,this.video=t}}();t.ConstraintsObject=i},function(e,t,n){"use strict";var i=n(141),r=n(160),o=n(14),a=function(){function e(){}return e.getStreamProvider=function(e,t,n){return e?o.hasOrtc()?o.isOutgoingScreenSharingSupportedEdge()&&new i.ORTCDisplayStreamProvider(n):o.isOutgoingScreenSharingSupportedChrome()&&new r.WebRTCDisplayStreamProvider(t,n):o.hasOrtc()?new i.ORTCMediaStreamProvider(n):new r.WebRTCMediaStreamProvider(n)},e}();t.GumStreamProviderFactory=a},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(119),o=n(13),a=n(117),s=n(10),c=n(3),l=n(2),u=n(5),d=n(14),p=function(e){function t(n,i,r,o,a){var s=e.call(this)||this;return s.constraintsManager=i,s.serialQueue=r,s.configProvider=a,s.clients=[],s.gumStreams={},s.clientGumStreams=[],s.streamsDump=[],s.isMutedInternal=!1,s.isHold=!1,s.streamId=t.streamGeneration++,s.logger=o.createChild("MediaStream:"+s.streamId),s.currentConstraints=s.constraintsManager.createConstraintsObject(n),s}return i(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.streamId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawStream",{get:function(){return this.currentGumStream},enumerable:!0,configurable:!0}),t.prototype.applyConstraints=function(e){if(this.currentGumStream){var t=this.constraintsManager.updateVideoConstraints(this.currentConstraints,e);if(!t)return Promise.resolve(!1);if(this.currentConstraints!==t)return this.currentConstraints=t,this.applyConstraintsInternal().then(function(){return!0})}return Promise.resolve(!1)},t.prototype.getClient=function(){var e;this.currentGumStream?(e=this.currentGumStream.clone(),this.clientGumStreams.push(((t={})[this.constraintsManager.getKey(this.currentConstraints)]=e,t))):this.clientGumStreams.push({});var t,n=new r.MediaStreamClient(this,e,this.logger.createChild("Client:"+this.constraintsManager.getKey(this.currentConstraints)));return this.clients.push(n),n},t.prototype.setMuted=function(e){this.isMutedInternal=e,this.clients.forEach(function(t){t.setMuted(e)}),this.enableDisableTracks()},t.prototype.isMuted=function(){return this.isMutedInternal},t.prototype.setHold=function(e){this.isHold=e,this.clients.forEach(function(t){t.setHold(e)}),this.enableDisableTracks()},t.prototype.disposeClient=function(e){var t=this.clients.indexOf(e);if(t>=0&&(this.clients.splice(t,1),this.streamsDump.push(this.clientGumStreams[t]),this.clientGumStreams.splice(t,1),0===this.clients.length))return this.dispose()},t.prototype.dispose=function(){var t=this;this.event("onStreamDisposing").raise(this),this.stopGumStream().then(function(){t.event("onStreamDisposed").raise(t)}).catch(function(e){t.event("onStreamError").raise(t,e)}).then(function(){e.prototype.dispose.call(t)})},t.prototype.start=function(){var e=this;return this.gumPromise||(this.currentConstraints.video&&!d.hasOrtc()?this.gumPromise=this.applyConstraintsInternal():this.gumPromise=this.updateGumStreamInternal(this.currentConstraints),this.gumPromise=this.gumPromise.then(function(){e.event("onStreamStarted").raise(e,e.currentConstraints)}).catch(function(t){throw e.event("onStreamError").raise(e,t),t})),this.gumPromise},t.prototype.hasAudio=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getAudioTracks().length},t.prototype.hasVideo=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length},t.prototype.hasDisplay=function(){return this.currentConstraints.video&&this.currentConstraints.video.deviceId===c.default.DISPLAY_SOURCE_ID},t.prototype.getVideoDeviceId=function(){return this.currentConstraints.video.deviceId},t.prototype.updateClients=function(e){var t=this,n=this.constraintsManager.getKey(e);this.clients.forEach(function(e,i){t.clientGumStreams[i][n]||(t.clientGumStreams[i][n]=t.currentGumStream.clone()),e.updateStream(t.clientGumStreams[i][n])})},t.prototype.applyConstraintsInternal=function(){var e=this;return new Promise(function(t,n){e.logger.safe.log("applying stream constraints: "+JSON.stringify(e.currentConstraints));var i=new o.SettablePromise;e.clients.forEach(function(e){e.onApplyConstraints&&e.onApplyConstraints(i.promise)}),t(e.serialQueue.add(function(){var t=e.constraintsManager.generatePolicies(e.currentConstraints);return e.gumPromise=e.updateGumStreamInternal(t[0]),t.slice(1).forEach(function(t){e.gumPromise=e.gumPromise.catch(function(n){if(c.default.MEDIA_ERROR.constraintNotSatisfiedError===n.type)return e.logger.safe.warn("could not obtain constrained media stream, will attempt weaker policy"),e.updateGumStreamInternal(t);throw n.constraints=t,n})}),e.gumPromise}).then(function(){return i.resolve()}).catch(function(t){throw e.logger.safe.error("failed to apply constraints: "+JSON.stringify(t.constraints)+" error: "+t),i.reject(t),t}))})},t.prototype.enableDisableTracks=function(){var e=this;this.currentGumStream&&this.currentGumStream.getTracks().forEach(function(t){void 0!==t.enabled&&(t.enabled=!("audio"===t.kind&&e.isMutedInternal||e.isHold),e.logger.safe.log("control media stream track kind: "+t.kind+" enabled: "+t.enabled+" muted: "+t.muted))})},t.prototype.getGumStreamProvider=function(e){var t=e.video&&e.video.deviceId===c.default.DISPLAY_SOURCE_ID;return a.GumStreamProviderFactory.getStreamProvider(t,this.configProvider,this.logger.createChild("DisplayStreamProvider"))},t.prototype.updateGumStreamInternal=function(e){var t=this;return Promise.resolve().then(function(){t.logger.safe.log("querying user media for stream: "+JSON.stringify(e));var n=t.gumStreams[t.constraintsManager.getKey(e)];return n||t.getGumStreamProvider(e).getStream(e)}).catch(function(n){throw t.decorateMediaStreamError(n,e)}).then(function(n){t.logger.safe.log("media stream acquired"),!e.audio&&n.getAudioTracks().length>0&&(n.getAudioTracks()[0].stop(),n=new u.default.window.MediaStream(n.getVideoTracks())),n.getAudioTracks().forEach(function(e){e.onended=function(e){t.logger.safe.log("Audio stream track ended: "+JSON.stringify(e.error&&e.error.name||e)),t.event("onStreamTrackEnded").raise(t,e)},e.onmute=function(){t.logger.safe.log("Audio stream track muted"),t.event("onStreamTrackMuted").raise(t,!0)},e.onunmute=function(){t.logger.safe.log("Audio stream track unmuted"),t.event("onStreamTrackMuted").raise(t,!1)},e.muted&&t.event("onStreamTrackMuted").raise(t,!0)}),t.currentConstraints=e,t.gumStreams[t.constraintsManager.getKey(e)]=n,t.currentGumStream=n,t.updateClients(e);var i=n.getVideoTracks()[0];i&&(i.onmute=function(n){t.logger.safe.error("Video stream track muted: "+JSON.stringify(e)+"; "+JSON.stringify(n))},i.onended=function(n){t.logger.safe.log("Video stream track ended: "+JSON.stringify(e)+"; "+JSON.stringify(n.error&&n.error.name||n)),t.event("onStreamTrackEnded").raise(t,n)}),t.enableDisableTracks(),t.logger.safe.log("media stream updated"),t.event("onStreamAcquired").raise(t,n,e)})},t.prototype.decorateMediaStreamError=function(e,t){var n;switch(e.name){case"SourceUnavailableError":case"TrackStartError":case"NotReadableError":n={type:c.default.MEDIA_ERROR.sourceUnavailableError,detail:"media device is already used by another process: "+e};break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":n={type:c.default.MEDIA_ERROR.constraintNotSatisfiedError,detail:"could not obtain constrained media stream: "+e};break;case"DevicesNotFoundError":case"NotFoundError":n={type:c.default.MEDIA_ERROR.devicesNotFoundError,detail:"specified device not found: "+e};break;case"NotAllowedError":case"PermissionDeniedError":case"PermissionDismissedError":n={type:c.default.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: "+e};break;case c.default.MEDIA_ERROR.extensionNotFoundError:n={type:c.default.MEDIA_ERROR.extensionNotFoundError,detail:"extension is not found: "+e};break;case c.default.MEDIA_ERROR.sharingCancelledError:n={type:c.default.MEDIA_ERROR.sharingCancelledError,detail:"screen sharing cancelled: "+e};break;case c.default.MEDIA_ERROR.chromeRuntimeNotDefinedError:n={type:c.default.MEDIA_ERROR.chromeRuntimeNotDefinedError,detail:"chrome runtime is not defined: "+e};break;default:n={type:c.default.MEDIA_ERROR.mediaStreamRequestError,detail:"media stream request error"+e}}return n.isAudio=!!t.audio,n.detail+=" constraints: "+JSON.stringify(JSON.stringify(t)),n},t.prototype.stopGumStream=function(){var e=this;return this.gumPromise?(this.logger.safe.log("queueing media stream stop"),this.serialQueue.add(function(){return e.stopGumStreamInternal()})):Promise.resolve()},t.prototype.stopOneGumStream=function(e){try{e.getTracks().forEach(function(e){e.onended=null,e.onmute=null,e.stop()}),this.logger.safe.log("media stream stopped")}catch(e){this.logger.safe.warn("failed to stop media stream: "+e)}},t.prototype.stopGumStreamInternal=function(){var e=this;this.currentGumStream&&(this.clientGumStreams.concat(this.streamsDump,[this.gumStreams]).forEach(function(t){return l.forOwn(t,function(t){return e.stopOneGumStream(t)})}),this.gumStreams={},this.clientGumStreams=[],this.streamsDump=[],this.currentGumStream=null)},t}(s.default);p.streamGeneration=0,t.MediaStreamInternal=p},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n,i){var r=e.call(this)||this;return r.mediaStream=t,r.logger=i,r.mediaStreamSubscriptions=[],r.isHold=!1,r.isMuted=r.mediaStream.isMuted(),r.subscribeOnMediaStreamEvents(),r.updateStream(n),r.logger.safe.log("ctor"),r}return i(t,e),Object.defineProperty(t.prototype,"streamId",{get:function(){return this.originalId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawStream",{get:function(){return this.gumStream},enumerable:!0,configurable:!0}),t.prototype.updateStream=function(e){e&&(this.originalId=e.id,this.gumStream=e,this.enableDisableTracks())},t.prototype.dispose=function(){this.logger.safe.log("dispose"),this.mediaStream&&(this.unsubscribeFromMediaStreamEvents(),this.mediaStream.disposeClient(this),this.mediaStream=null)},t.prototype.clone=function(){return this.mediaStream.getClient()},t.prototype.applyConstraints=function(e){return this.mediaStream.applyConstraints(e)},t.prototype.setMuted=function(e){this.isMuted=e||this.mediaStream.isMuted(),this.enableDisableTracks()},t.prototype.setHold=function(e){this.isHold=e,this.enableDisableTracks()},t.prototype.start=function(){return this.mediaStream.start()},t.prototype.hasAudio=function(){return this.mediaStream.hasAudio()},t.prototype.hasVideo=function(){return this.mediaStream.hasVideo()},t.prototype.getOriginalId=function(){return this.originalId},t.prototype.isSameStream=function(e){return this.originalId===e.getOriginalId()},t.prototype.subscribeOnMediaStreamEvents=function(){var e=this;this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamStarted",function(t,n){e.event("onStreamStarted").raise(e,n)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamDisposed",function(t){e.event("onStreamDisposed").raise(e)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamError",function(t,n){e.event("onStreamError").raise(e,n)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamTrackMuted",function(t,n){e.event("onStreamMuted").raise(e,n)})),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamTrackEnded",function(t,n){e.event("onStreamEnded").raise(e,n)}))},t.prototype.unsubscribeFromMediaStreamEvents=function(){this.mediaStreamSubscriptions.forEach(function(e){return e.dispose()}),this.mediaStreamSubscriptions=[]},t.prototype.enableDisableTracks=function(){var e=this;this.gumStream&&this.gumStream.getTracks().forEach(function(t){void 0!==t.enabled&&(t.enabled=!("audio"===t.kind&&e.isMuted||e.isHold))})},t}(n(10).default);t.MediaStreamClient=r},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(118),o=n(17),a=n(115),s=function(e){function t(t,n,i){var r=e.call(this)||this;return r.logger=t,r.deviceManager=n,r.configProvider=i,r.cachedStreamsSubs=new Map,r.cachedStreamsMap=new Map,r.constraintsManager=new a.ConstraintsManager(r.logger),r.mediaStreamSerialQueue=new o.PromiseQueue(r.logger),r.deviceManager.on("onDevicesChanged",function(e){return r.onDevicesChanged(e)}),r}return i(t,e),t.prototype.getMediaStream=function(e){var t=this;this.logger.safe.log("retrieving media stream: "+JSON.stringify(e));var n=this.getSuitableStream(e);n||(this.logger.safe.log("cached stream is not found. Creating a new one with constraints: "+JSON.stringify(e)),n=this.createCachedStream(e));var i=n.getClient();return i.start().catch(function(e){t.logger.safe.error("could not start media stream: "+n.id+", total streams: "+t.cachedStreamsMap.size+", error: "+JSON.stringify(e)),t.removeStream(n)}),i},t.prototype.getCachedStreams=function(){return this.cachedStreamsMap},t.prototype.getSuitableStream=function(e){var t,n=this;return this.cachedStreamsMap.forEach(function(i,r){n.isSuitable(r,e)&&(t=r)}),t&&this.cachedStreamsMap.get(t)},t.prototype.createCachedStream=function(e){var t=new r.MediaStreamInternal(e,this.constraintsManager,this.mediaStreamSerialQueue,this.logger,this.configProvider);return this.subscribeOnStreamEvents(t),this.logger.safe.log("created media stream, id: "+t.id+" total: "+this.cachedStreamsMap.size),this.cachedStreamsMap.set(e,t),t},t.prototype.subscribeOnStreamEvents=function(e){var t=this,n=[];n.push(e.on("onStreamDisposing",function(e){return t.onStreamDisposing(e)})),this.cachedStreamsSubs.set(e,n)},t.prototype.unsubscribeFromStreamEvents=function(e){this.cachedStreamsSubs.get(e).forEach(function(e){return e.dispose()}),this.cachedStreamsSubs.delete(e)},t.prototype.removeStream=function(e){this.logger.safe.log("release media stream generation: "+e.id+" cached: "+this.cachedStreamsMap.size),this.unsubscribeFromStreamEvents(e),this.cachedStreamsMap.delete(this.getConstraintsForStream(e)),this.cachedStreamsMap.size||this.event("onAllStreamsRemoved").raise()},t.prototype.getConstraintsForStream=function(e){var t;return this.cachedStreamsMap.forEach(function(n,i){e===n&&(t=i)}),t},t.prototype.isSuitable=function(e,t){var n=this.isAcceptable(e.audio,t.audio),i=this.isAcceptable(e.video,t.video);return n&&i},t.prototype.isAcceptable=function(e,t){return!e&&!t||e&&t&&e.deviceId===t.deviceId},t.prototype.isDeviceOutdated=function(e,t){return e&&e.deviceId&&!t.some(function(t){return t.deviceId===e.deviceId})},t.prototype.onStreamDisposing=function(e){this.logger.safe.log("onStreamDisposing event "+e.id),this.removeStream(e)},t.prototype.onDevicesChanged=function(e){var t=this;this.cachedStreamsMap.forEach(function(n,i){var r=t.isDeviceOutdated(i.audio,e),o=t.isDeviceOutdated(i.video,e);(r||o)&&t.cachedStreamsMap.delete(i)})},t}(n(10).default);t.MediaStreamManager=s},function(e,t,n){"use strict";var i=n(2),r=function(){function e(e){this.streams=[],this.listener=e}return e.prototype.add=function(e){this.streams.some(function(t){return t.getId()===e.getId()})||(this.streams.push(e),this.listener.streamAdded(e))},e.prototype.remove=function(e){var t;i.remove(this.streams,function(n){return n.getId()===e&&(t=n,!0)})&&this.listener.streamRemoved(t)},e.prototype.getStreams=function(){return this.streams},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=n(2),r=n(63),o=function(){function e(e){this.subscription=e}return e.prototype.getMsi=function(){return this.checkDisposed(),this.subscription.getMsi()},e.prototype.getModality=function(){return this.checkDisposed(),this.subscription.getModality()},e.prototype.onMediaStreamChanged=function(e){this.checkDisposed(),this.mediaStreamChanged=e,this.subscription.isStreamReady()&&this.notifyMediaStreamChanged()},e.prototype.onError=function(e){this.checkDisposed(),this.error=e},e.prototype.dispose=function(){this.subscription&&(this.subscription.dispose(this),this.subscription=null)},e.prototype.notifyMediaStreamChanged=function(){if(this.mediaStreamChanged){var e=this.subscription.getStream(),t=this.subscription.isStreamReady();this.mediaStreamChanged(e&&t?e.getMediaStream():null)}},e.prototype.notifyError=function(e){this.error&&this.error(e)},e.prototype.checkDisposed=function(){if(!this.subscription)throw new Error("subscription disposed")},e}(),a=function(){function e(e,t,n,i){this.modality=e,this.msi=t,this.disposeTimeout=n,this.onDisposed=i,this.clients=[],this.streamReady=!1}return e.prototype.client=function(){var e=new o(this);return this.clients.push(e),e},e.prototype.getMsi=function(){return this.msi},e.prototype.getStream=function(){return this.stream},e.prototype.isStreamReady=function(){return this.streamReady},e.prototype.getModality=function(){return this.modality},e.prototype.setStream=function(e){var t=this;e!==this.stream&&(this.stream&&(this.releaseStream(),this.notifyStreamChanged()),this.stream=e,e&&(this.streamReady=!1,e.requestSource(this.msi).then(function(){t.streamReady=!0,t.notifyStreamChanged()}).catch(function(e){t.notifyError(e)})))},e.prototype.notifyError=function(e){this.clients.forEach(function(t){return t.notifyError(e)})},e.prototype.disposeIfInactive=function(){this.clients.length||this.disposeNow()},e.prototype.dispose=function(e){var t=this;e?(i.remove(this.clients,function(t){return t===e}),this.clients.length||setTimeout(function(){return t.disposeIfInactive()},this.disposeTimeout)):(this.clients=[],this.disposeNow())},e.prototype.notifyStreamChanged=function(){this.clients.forEach(function(e){return e.notifyMediaStreamChanged()})},e.prototype.releaseStream=function(){this.stream&&(this.stream.requestSource(r.MediaSourceIdentifiers.SourceNone).catch(function(){}),this.streamReady=!1,this.stream=null)},e.prototype.disposeNow=function(){this.releaseStream(),this.onDisposed&&(this.onDisposed(),this.onDisposed=void 0)},e}(),s=function(){function e(e,t){this.subscriptions=[],this.logger=e.logger.createChild("subs"),this.configProvider=e.configProvider,this.setStreamProvider(t),this.logger.safe.log("created")}return e.prototype.setStreamProvider=function(e){var t=this;this.streamProvider=e,this.streamProvider.onStreamsChanged(function(){return t.streamsChanged()})},e.prototype.subscribe=function(e,t){var n=this;void 0===t&&(t=r.MediaSourceIdentifiers.SourceAny);var o=i.find(this.subscriptions,function(n){return n.getMsi()===t&&n.getModality()===e});if(!o){this.disposeInactiveSubscriptions(),this.logger.safe.log("creating new subscription #"+t+" for modality "+e),o=new a(e,t,this.configProvider.config.webrtcVideoSubscriptionDisposeTimeout,function(){n.logger.safe.log("disposing subscription #"+t),i.remove(n.subscriptions,function(e){return e===o}),n.streamsChanged()}),this.subscriptions.push(o);var s=this.getAvailableStream(e);s&&this.assignStream(o,s)}return o.client()},e.prototype.dispose=function(){this.subscriptions.concat().forEach(function(e){return e.dispose()}),this.streamProvider.onStreamsChanged(null),this.logger.safe.log("disposed")},e.prototype.disposeInactiveSubscriptions=function(){this.subscriptions.concat().forEach(function(e){e.getStream()&&e.disposeIfInactive()})},e.prototype.streamsChanged=function(){var e=this;this.subscriptions.forEach(function(t){if(!t.getStream()||e.isStreamRemoved(t.getStream())){var n=e.getAvailableStream(t.getModality());n?e.assignStream(t,n):e.resignStream(t)}})},e.prototype.getAvailableStream=function(e){var t=this.streamProvider.getStreams();return i.find(t,function(t){return e===t.getModality()&&t.getMsi()===r.MediaSourceIdentifiers.SourceNone})},e.prototype.isStreamRemoved=function(e){return!this.streamProvider.getStreams().some(function(t){return t===e})},e.prototype.assignStream=function(e,t){this.logger.safe.log("assigning stream #"+t.getId()+" to subscription #"+e.getMsi()),e.setStream(t)},e.prototype.resignStream=function(e){e.getStream()&&(this.logger.safe.log("removing stream from subscription #"+e.getMsi()),e.setStream(null))},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(2),o=n(3),a=n(10),s={activeSpeaker:{timeToPromote:3e3},devicePollingInterval:3e3,dtmf:{toneDuration:200,toneGap:100},mediaStreamHoldInterval:5e3,ortcAllowedMediaContentType:o.default.ALLOWED_CONTENT_TYPES.SDP_NGC,ortcMediaContentType:o.default.CONTENT_TYPE.SDP,ortcVideoCapabilityMaxFS:1200,ortcVideoCapabilityMaxFPS:3e3,ortcOutgoingScreenSharingEnabled:!1,webrtcContributingSourcesPollingInterval:1e3,webrtcIceGatheringTimeoutMs:1e4,webrtcAllowedMediaContentType:o.default.ALLOWED_CONTENT_TYPES.SDP_NGC,webrtcMediaContentType:o.default.CONTENT_TYPE.SDP,webrtcScreensharingCapabilityMaxFS:3600,webrtcScreensharingCapabilityMaxFPS:1500,webrtcStatHwSilentDetectionDuration:5,webrtcStatHwSilentDetectionLevel:7,webrtcStatPollInterval:1e3,webrtcStatStoredRecordsNumber:60,webrtcStatNetworkDetectionDuration:10,webrtcStatNetworkDetectionHysteresis:.01,webrtcStatNetworkDetectionBadLevel:.07,webrtcStatNetworkDetectionGoodLevel:.03,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcVideoStreamRecoverWaitTimeout:2e4,webrtcBandwidthPerVideoReceiver:2e5,webrtcQualitySlidingWindowPercentile:.3,webrtcQualitySlidingWindowSamples:20,webrtcVideoReceiversCount:1,webrtcStatNetworkDetectionEnabled:!1,webrtcVideoSubscriptionDisposeTimeout:2e3,webrtcOutgoingScreenSharingEnabled:!1,iceServerTransport:"udp,tcp",iceHostCandidateOnly:!1},c=function(e){function t(t,n){var i=e.call(this)||this;return i.sessionCount=0,i.initialSettings=r.deepClone(s),i.pendingSettings=null,i.logger=t.createChild("configProvider"),i.logger.safe.log("configProvider initialized"),n&&r.forOwn(n,function(e,t){return i.initialSettings[t]=e}),i.settings=i.initialSettings,i}return i(t,e),t.prototype.updateConfig=function(e,t){this.etag=t||this.etag;var n=r.deepClone(this.initialSettings);r.forOwn(e,function(e,t){return n[t]=e}),this.sessionCount>0?(this.pendingSettings=n,this.logSettings("pendingSettings updated",n)):(this.settings=n,this.event("configUpdated").raise(),this.logSettings("Settings updated",n))},t.prototype.updateSessionCount=function(e){this.sessionCount=e,0===e&&null!==this.pendingSettings&&(this.settings=r.deepClone(this.pendingSettings),this.pendingSettings=null,this.event("configUpdated").raise(),this.logSettings("Pending configuration applied",this.settings))},Object.defineProperty(t.prototype,"config",{get:function(){return this.settings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ETag",{get:function(){return this.etag},enumerable:!0,configurable:!0}),t.prototype.logSettings=function(e,t){var n={};r.forOwn(t,function(e,i){t[i]!==s[i]&&(n[i]=e)}),this.logger.safe.log(e+": "+JSON.stringify(n))},t}(a.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(126),o=n(65),a=n(10),s=n(3),c=n(14),l=n(2),u=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=n,i.deviceLists=new Map,i.subs=[],i.isDeviceListChanged=!1,i.isSelectedDeviceChanged=!1,i.configureList(s.default.MEDIA_DEVICE.camera,new r.DeviceList(null,i.logger.createChild("Cameras"))),i.configureList(s.default.MEDIA_DEVICE.microphone,new r.DeviceList(t,i.logger.createChild("Microphones"))),c.isAudioOutputSelectionSupported()&&i.configureList(s.default.MEDIA_DEVICE.speaker,new r.DeviceList(t,i.logger.createChild("Speakers"))),i}return i(t,e),t.prototype.updateDevices=function(e){this.deviceLists.forEach(function(t,n){var i=e.filter(function(e){return e.type===n});t.updateDevices(i)}),this.raiseEventsIfChanged()},t.prototype.getDevices=function(){var e=[];return this.deviceLists.forEach(function(t,n){t.getDevices()&&e.push.apply(e,t.getDevices())}),e},t.prototype.selectDevices=function(e){this.logger.safe.log("SelectDevices called with "+JSON.stringify(e)),this.deviceLists.forEach(function(t,n){e[n]&&t.selectDeviceId(e[n])}),this.raiseEventsIfChanged()},t.prototype.getSelectedDevices=function(){var e={camera:null,microphone:null,speaker:null};return this.deviceLists.forEach(function(t,n){e[n]=t.getSelectedDevice()}),e},t.prototype.updateActiveDevices=function(e){this.deviceLists.forEach(function(t,n){e[n]&&t.updateActiveDevice(e[n])}),this.raiseEventsIfChanged()},t.prototype.setCameraSelectionStrategy=function(e){this.deviceLists.get(s.default.MEDIA_DEVICE.camera).setSelectionStrategy(e)},t.prototype.isUpdateNeeded=function(){var e=!1;return this.deviceLists.forEach(function(t,n){t.isUpdateNeeded()&&(e=!0)}),e},t.prototype.configureList=function(e,t){var n=this;t.setSelectionStrategy(o.DeviceSelectionStrategyFactory.getStrategy(o.SelectionType.Automatic)),this.subs.push(t.on("onDevicesChanged",function(){return n.onDevicesChanged()})),this.subs.push(t.on("onSelectedDevicesChanged",function(){return n.onSelectedDevicesChanged()})),this.deviceLists.set(e,t)},t.prototype.raiseEventsIfChanged=function(){if(this.isSelectedDeviceChanged){var e=this.getSelectedDevices(),t=l.values(e).map(function(e){return e&&e.guid});this.logger.safe.log("Event onSelectedDevicesChanged with guids: "+JSON.stringify(t)),this.event("onSelectedDevicesChanged").raise(this,e),this.isSelectedDeviceChanged=!1}if(this.isDeviceListChanged){var n=this.getDevices();this.logger.safe.log("Event onDevicesChanged with: "+JSON.stringify(n)),this.event("onDevicesChanged").raise(this,n),this.isDeviceListChanged=!1}},t.prototype.onDevicesChanged=function(){this.isDeviceListChanged||(this.isDeviceListChanged=!0)},t.prototype.onSelectedDevicesChanged=function(){this.isSelectedDeviceChanged||(this.isSelectedDeviceChanged=!0)},t}(a.default);t.ComposedDeviceList=u},function(e,t,n){"use strict";var i=n(5),r=n(127),o=n(129),a=n(124),s=n(13),c=function(){function e(e,t){var n=this;this.configProvider=e,this.logger=t,this.window=i.default.window,this.deviceProvider=new o.DeviceProvider(this.logger),this.isInitializedPromise=new s.SettablePromise;var c=new r.DeviceListConverter(this.deviceProvider,this.logger.createChild("DeviceListConverter"));this.deviceList=new a.ComposedDeviceList(c,this.logger.createChild("DeviceList")),this.window.navigator.mediaDevices&&(this.window.navigator.mediaDevices.ondevicechange=function(){n.enableOnDeviceChangeCallbackSupport(),n.enumerateDevices()})}return Object.defineProperty(e.prototype,"list",{get:function(){return this.deviceList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.isInitializedPromise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPollingInProgress",{get:function(){return this.pollingInProgress},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){var e=this;this.enumerateDevices().then(function(){return e.isInitializedPromise.resolve()}).catch(function(){return e.isInitializedPromise.reject()})},e.prototype.enumerateDevices=function(){var e=this;return this.window.navigator&&this.window.navigator.mediaDevices&&this.window.navigator.mediaDevices.enumerateDevices?(this.enumerateDevicesPromise||(this.enumerateDevicesPromise=this.window.navigator.mediaDevices.enumerateDevices().catch(function(t){throw e.enumerateDevicesPromise=null,e.logger.safe.warn("error with enumerating devices:",t),t}).then(function(t){e.enumerateDevicesPromise=null;var n=t.map(function(t){return e.deviceProvider.createDevice(t)});e.deviceList.updateDevices(n)})),this.enumerateDevicesPromise):Promise.reject(new Error("device enumeration unsupported"))},e.prototype.getDeviceName=function(e){var t=this.deviceList.getDevices().find(function(t){return t.guid===e});return Promise.resolve(t?t.label:"")},e.prototype.startDevicePolling=function(){var e=this,t=this.configProvider.config.devicePollingInterval;if(0!==t&&!this.onDeviceChangeCallbackSupported&&!this.pollingTimer){var n=function(){e.logger.safe.log("Polling devices"),e.pollingInProgress=!0,e.enumerateDevices().then(function(){e.pollingInProgress=!1,e.pollingTimer=e.window.setTimeout(n,t)}).catch(function(t){throw e.pollingInProgress=!1,t})};this.logger.safe.log("starting device polling"),n()}},e.prototype.stopDevicePolling=function(){this.pollingTimer&&(this.logger.safe.log("stopping device polling"),this.window.clearTimeout(this.pollingTimer),this.pollingTimer=void 0)},e.prototype.enableOnDeviceChangeCallbackSupport=function(){this.onDeviceChangeCallbackSupported=!0,this.stopDevicePolling()},e}();t.DeviceEnumerator=c},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(2),o=function(e){function t(t,n){var i=e.call(this)||this;return i.deviceListConverter=t,i.logger=n,i.list=[],i.isSelectedAutomatically=!0,i}return i(t,e),t.prototype.updateDevices=function(e){var t=e;if(this.deviceListConverter&&(t=this.prioritizeDevices(this.deviceListConverter.convertDevices(e,this.list))),this.updateList(t)){var n=this.getDeviceToSelect();this.updateSelectedDevice(n)}},t.prototype.getDevices=function(){return this.list},t.prototype.selectDeviceId=function(e){this.isSelectedAutomatically=!1;var t=this.getDeviceToSelect(e);this.updateSelectedDevice(t)},t.prototype.getSelectedDevice=function(){return this.selectedDevice},t.prototype.updateActiveDevice=function(e){if(e)if(e.isMarkedDefault){var t=this.list.find(function(e){return e.isSystemDefault});t!==e.device&&(this.updateDefaultDevice(e.device,t),this.selectDeviceId(e.device.guid))}else this.checkSelectedDeviceIsActive(e.device)},t.prototype.setSelectionStrategy=function(e){this.selectionStrategy=e},t.prototype.isUpdateNeeded=function(){return this.list.some(function(e){return!e.label})},t.prototype.updateList=function(e){this.list&&this.migrateDeviceData(this.list,e);var t=!r.deepEqual(this.list,e);return t&&(this.list=e,this.event("onDevicesChanged").raise()),t},t.prototype.migrateDeviceData=function(e,t){e.forEach(function(e){var n=t.find(function(t){return t.guid===e.guid});n&&e.label&&!n.label&&(n.label=e.label)})},t.prototype.updateSelectedDevice=function(e){this.isSameDevice(e,this.selectedDevice)||(this.logger.safe.log("update selected device "+(this.selectedDevice&&this.selectedDevice.guid)+" -> "+(e&&e.guid)),this.selectedDevice=e,this.event("onSelectedDevicesChanged").raise())},t.prototype.getDeviceToSelect=function(e){var t=this,n=e&&this.list.find(function(t){return t.guid===e});if(!n){var i=this.list.some(function(e){return t.isSameDevice(e,t.selectedDevice)});!this.isSelectedAutomatically&&i?n=this.selectedDevice:(!(n=this.selectionStrategy.getSelectedDevice(this.list))&&i&&(n=this.selectedDevice),this.isSelectedAutomatically=!0),e&&this.logger.safe.error("selected device does not exist target: "+e+", selected: "+(n&&n.guid))}return n},t.prototype.prioritizeDevices=function(e){var t=e.find(function(e){return e.isSystemDefault});return t&&(e.splice(e.indexOf(t),1),e.unshift(t)),e},t.prototype.updateDefaultDevice=function(e,t){this.logger.safe.log("Swithing to new default device "+e.guid),e.isSystemDefault=!0,t&&this.list.splice(this.list.indexOf(t),1),this.list=this.prioritizeDevices(this.list),this.event("onDevicesChanged").raise()},t.prototype.checkSelectedDeviceIsActive=function(e){this.selectedDevice===e||this.selectedDevice&&e&&this.selectedDevice.guid===e.guid||this.logger.safe.error("Selected device is not active! selected: "+(this.selectedDevice&&this.selectedDevice.guid)+", active: "+(e&&e.guid))},t.prototype.isSameDevice=function(e,t){return!e&&!t||e&&t&&e.guid===t.guid},t}(n(10).default);t.DeviceList=o},function(e,t,n){"use strict";var i=n(3),r=n(2),o=function(){function e(){}return e.prototype.getDefaultDeviceCandidate=function(e,t){if(1===e.length)return e[0];var n,r=e.find(function(e){return e.isSystemDefault&&e.deviceId===i.default.MEDIA_DEVICE.defaultId});return r&&(n=this.deductDefaultDeviceFromDeviceAmount(e,r)||this.deductDefaultDeviceFromGroupId(e,r)||this.deductDefaultDeviceFromLabel(e,r)),n||this.deductDefaultDeviceFromPreviousDefaultDevice(e,t)},e.prototype.deductDefaultDeviceFromDeviceAmount=function(e,t){var n=e.filter(function(e){return e!==t});return 1===n.length&&n[0]},e.prototype.deductDefaultDeviceFromGroupId=function(e,t){return e.find(function(e){return e!==t&&e.groupId===t.groupId})},e.prototype.deductDefaultDeviceFromLabel=function(e,t){var n=e.map(function(e){return e!==t&&e.label}),i=r.getMaxSubstring(t.label,n);return e.find(function(e){return e!==t&&e.label&&e.label===i})},e.prototype.deductDefaultDeviceFromPreviousDefaultDevice=function(e,t){if(!t||!t.length)return null;var n=t.find(function(e){return e.isSystemDefault});return n&&e.find(function(e){return e.deviceId===n.deviceId})},e}(),a=function(){function e(e,t){this.deviceProvider=e,this.logger=t,this.deductor=new o}return e.prototype.convertDevices=function(e,t){return this.createDeviceList(e,t)},e.prototype.createDeviceList=function(e,t){if(!e||!e.length)return[];var n=this.filterOutCommunicationsDevices(e);return n=this.deductDefaultDevice(n,t),n=this.filterOutDevicesWithDefaultId(n),n=this.addSyntheticDefaultDeviceIfNeeded(n)},e.prototype.deductDefaultDevice=function(e,t){var n=this.deductor.getDefaultDeviceCandidate(e,t);return n?(n.isSystemDefault=!0,this.logger.safe.log("["+n.type+"] Default device is set to "+n.guid+" "+n.label)):this.logger.safe.log("["+JSON.stringify(e&&e[0].type)+"] Default device is not set}"),e},e.prototype.filterOutDevicesWithDefaultId=function(e){var t=e.filter(function(e){return e.deviceId!==i.default.MEDIA_DEVICE.defaultId});return t.find(function(e){return e.isSystemDefault})||this.logger.safe.log("["+JSON.stringify(t&&t[0].type)+"] No default devices left"),t},e.prototype.filterOutCommunicationsDevices=function(e){return e.filter(function(e){return e.deviceId!==i.default.MEDIA_DEVICE.communicationsId})},e.prototype.addSyntheticDefaultDeviceIfNeeded=function(e){var t=e.find(function(e){return e.isSystemDefault});return t||(t=this.deviceProvider.createDefaultDevice(e[0].type),e.push(t)),e},e}();t.DeviceListConverter=a},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(120),o=n(125),a=n(65),s=n(109),c=n(10),l=n(3),u=n(14),d=n(2),p=function(e){function t(t,n){var i=e.call(this)||this;return i.logger=t,i.configProvider=n,i.activeRenderers=[],i.audioDeviceInUseQualityLevel=1,i.videoDeviceInUseQualityLevel=1,i.localVideoRendererId=0,i.selectedDevices={camera:null,microphone:null,speaker:null},i.streamManagerSubscriptions=[],i.streamSubscriptions=new Map,i.rendererSubscriptions=new Map,i.allowedModalities={audio:[l.default.MEDIA_STATE.inactive,l.default.MEDIA_STATE.receive,l.default.MEDIA_STATE.send,l.default.MEDIA_STATE.sendReceive],video:[l.default.MEDIA_STATE.inactive,l.default.MEDIA_STATE.receive,l.default.MEDIA_STATE.send,l.default.MEDIA_STATE.sendReceive],sharing:[l.default.MEDIA_STATE.inactive,l.default.MEDIA_STATE.receive,l.default.MEDIA_STATE.send,l.default.MEDIA_STATE.sendReceive]},i.deviceEnumerator=new o.DeviceEnumerator(n,i.logger.createChild("DeviceEnumerator")),i.deviceList=i.deviceEnumerator.list,i.deviceList.on("onDevicesChanged",function(e,t){return i.onDevicesChanged(e,t)}),i.deviceList.on("onSelectedDevicesChanged",function(e,t){return i.onSelectedDevicesChanged(e,t)}),i.deviceEnumerator.initialize(),i.mediaStreamManager=new r.MediaStreamManager(i.logger.createChild("MediaStreamManager"),i,i.configProvider),i.subscribeOnStreamManagerEvents(i.mediaStreamManager),i}return i(t,e),Object.defineProperty(t.prototype,"devices",{get:function(){return this.deviceList.getDevices()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInitialized",{get:function(){return this.deviceEnumerator.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return u.isAudioOutputSelectionSupported()},enumerable:!0,configurable:!0}),t.prototype.createPreviewRenderer=function(e,t){var n=new s.LocalVideoRenderer(e,t,this,this.logger.createChild("LocalRenderer:"+this.localVideoRendererId++));return this.subscribeOnRendererEvents(n),n},t.prototype.askDevicePermission=function(e){var t,n=this,i=!1;return Promise.resolve().then(function(){return e||(e={audio:!0,video:n.hasCamera()}),(t=n.getMediaStream(e)).start()}).catch(function(t){n.logger.safe.warn("askDevicePermission: media stream not started! "+t),n.raiseTelemetryEvent("ask_device_permission_error",{constraints:e,result:t}),i=!0}).then(function(){var r={audio:!1,video:!1,sharing:!1};return t&&(r.audio=t.hasAudio(),r.video=t.hasVideo(),n.disposeMediaStreamLater(t)),n.handleDevicesPermissionChanged(r.audio,r.video,r.sharing),i||n.raiseTelemetryEvent("ask_device_permission_success",{constraints:e,result:r}),r})},t.prototype.getAllowedModalities=function(){return this.allowedModalities},t.prototype.getAudioStream=function(){return this.getMediaStream({audio:!0})},t.prototype.getVideoStream=function(){return this.getMediaStream({video:!0})},t.prototype.getAudioVideoStream=function(){return this.getMediaStream({audio:!0,video:!0})},t.prototype.getDisplayStream=function(){return this.getMediaStream({sharing:!0})},t.prototype.enumerateDevicesAsync=function(){var e=this;return this.isInitialized.promise.then(function(){return e.getDeviceDescriptions(e.devices)})},t.prototype.getDeviceNameAsync=function(e){var t=this.devices.find(function(t){return t.guid===e}),n=t&&t.label?t.label:"";return Promise.resolve(n)},t.prototype.selectDevices=function(e){this.deviceList.selectDevices(e)},t.prototype.getSelectedDeviceObjects=function(){return this.selectedDevices},t.prototype.getSelectedDevices=function(){return this.toSelectedDevices(this.deviceList.getSelectedDevices())},t.prototype.getOutputDeviceId=function(){return this.selectedDevices.speaker&&this.selectedDevices.speaker.deviceId},t.prototype.getDeviceDescriptions=function(e){return e.map(function(e){return e.toDeviceDesc()})},t.prototype.dispose=function(){this.unsubscribeFromStreamManagerEvents(this.mediaStreamManager),e.prototype.dispose.call(this)},t.prototype.enumerateDevices=function(){return this.deviceEnumerator.enumerateDevices()},t.prototype.toSelectedDevices=function(e){var t={};return Object.keys(e).forEach(function(n){e[n]&&(t[n]=e[n].guid)}),t},t.prototype.handleDevicesPermissionChanged=function(e,t,n){this.allowedModalities={audio:[l.default.MEDIA_STATE.inactive,l.default.MEDIA_STATE.receive],video:[l.default.MEDIA_STATE.inactive,l.default.MEDIA_STATE.receive],sharing:[l.default.MEDIA_STATE.inactive,l.default.MEDIA_STATE.receive]},e&&(this.allowedModalities.audio.push(l.default.MEDIA_STATE.send),this.allowedModalities.audio.push(l.default.MEDIA_STATE.sendReceive)),t&&(this.allowedModalities.video.push(l.default.MEDIA_STATE.send),this.allowedModalities.video.push(l.default.MEDIA_STATE.sendReceive)),this.event("onDevicesPermissionChanged").raise({audio:e,video:t,sharing:n})},t.prototype.getActiveDevices=function(e,t){var n=e.rawStream;if(n){var i=n.getAudioTracks()&&n.getAudioTracks()[0],r=n.getVideoTracks()&&n.getVideoTracks()[0];return{microphone:this.getActiveDevice(i,t.audio),camera:this.getActiveDevice(r,t.video)}}this.logger.safe.error("no gum stream found for media stream "+JSON.stringify(e))},t.prototype.getActiveDevice=function(e,t){var n=t&&t.deviceId===l.default.MEDIA_DEVICE.defaultId;if(e&&e.getSettings){var i=e.getSettings();if(i){var r=this.devices.find(function(e){return e.deviceId===i.deviceId});return r?(this.logger.safe.log("Active device found "+JSON.stringify(r)+" with id: "+i.deviceId),{device:r,isMarkedDefault:n}):(this.logger.safe.error("Active device not found","Device id from track: '"+i.deviceId+"', known devices: "+this.devices.map(function(e){return"["+e.label+" "+e.deviceId+"]"}),JSON.stringify(i),JSON.stringify(t)),null)}}return null},t.prototype.getStreamConstraints=function(e){return e&&{deviceId:e.deviceId}},t.prototype.hasCamera=function(){return d.values(this.devices).some(function(e){return e.type===l.default.MEDIA_DEVICE.camera})},t.prototype.getConstraints=function(e){if(!e.audio&&!e.video&&!e.sharing)throw new Error("requesting nothing");if(this.logger.safe.log("retrieving media stream: ",JSON.stringify(e)),e.sharing)return{audio:null,video:{deviceId:l.default.DISPLAY_SOURCE_ID}};var t=this.selectedDevices.microphone,n=this.selectedDevices.camera,i=e.audio&&t,r=e.video&&n;if(!i&&!r)throw{type:l.default.MEDIA_ERROR.noDeviceSelected,detail:"audio requested "+e.audio+", video requested: "+e.video+" Devices: "+JSON.stringify(this.devices)};var o=this.getStreamConstraints(t),a=this.getStreamConstraints(n);return{audio:e.audio&&o,video:e.video&&a}},t.prototype.getMediaStream=function(e){var t=this,n=this.getConstraints(e),i=this.mediaStreamManager.getMediaStream(n);return this.subscribeOnStreamEvents(i),i.start().then(function(){var e=i.hasAudio(),n=i.hasVideo();t.handleDevicesPermissionChanged(!0,!0,!0),e&&t.handleAudioDeviceInUse(1),n&&t.handleVideoDeviceInUse(1)}).catch(function(e){e.type!==l.default.MEDIA_ERROR.permissionDeniedError?e.type===l.default.MEDIA_ERROR.sourceUnavailableError&&(e.isAudio?t.handleAudioDeviceInUse(3):t.handleVideoDeviceInUse(3)):t.handleDevicesPermissionChanged(i.hasAudio(),i.hasVideo(),!0)}),i},t.prototype.subscribeOnStreamEvents=function(e){var t=this,n=[];n.push(e.on("onStreamStarted",function(e,n){return t.onStreamStarted(e,n)})),n.push(e.on("onStreamDisposed",function(e){return t.onStreamDisposed(e)})),n.push(e.on("onStreamEnded",function(e,n){return t.onStreamEnded(e,n)})),n.push(e.on("onStreamMuted",function(e,n){return t.onStreamMuted(e,n)})),n.push(e.on("onStreamError",function(e,n){return t.onStreamError(e,n)})),this.streamSubscriptions.set(e,n)},t.prototype.unsubscribeFromStreamEvents=function(e){this.streamSubscriptions.has(e)&&this.streamSubscriptions.get(e).forEach(function(e){return e.dispose()})},t.prototype.subscribeOnRendererEvents=function(e){var t=this,n=[];n.push(e.on("onRendererDisposed",function(e){return t.onRendererDisposed(e)})),n.push(e.on("onRendererStarted",function(e){return t.onRendererStarted(e)})),this.rendererSubscriptions.set(e,n)},t.prototype.unsubscribeFromRendererEvents=function(e){this.rendererSubscriptions.has(e)&&this.rendererSubscriptions.get(e).forEach(function(e){return e.dispose()})},t.prototype.subscribeOnStreamManagerEvents=function(e){var t=this,n=[];n.push(e.on("onAllStreamsRemoved",function(){return t.onAllStreamsRemoved()})),this.streamManagerSubscriptions=n},t.prototype.unsubscribeFromStreamManagerEvents=function(e){this.streamManagerSubscriptions.forEach(function(e){return e.dispose()})},t.prototype.updateRenderersAsync=function(){var e=this;if(this.activeRenderers.length)try{var t=this.getMediaStream({video:!0});return t.start().then(function(){e.activeRenderers.forEach(function(e){return e.attachStreamAsync(t)})})}catch(e){this.logger.safe.error("Cannot update renderer: "+e)}return Promise.resolve()},t.prototype.raiseQualityChanged=function(e,t,n){void 0===n&&(n=0);var i={type:e,value:t,isLocalSource:!0,mediaType:0};this.event("onQualityChanged").raise(i)},t.prototype.handleAudioDeviceInUse=function(e){1===e&&this.audioDeviceInUseQualityLevel===e||(this.audioDeviceInUseQualityLevel=e,this.raiseQualityChanged(39,e))},t.prototype.handleVideoDeviceInUse=function(e){1===e&&this.videoDeviceInUseQualityLevel===e||(this.videoDeviceInUseQualityLevel=e,this.raiseQualityChanged(33,e,1))},t.prototype.disposeMediaStreamLater=function(e){var t=this.configProvider.config.mediaStreamHoldInterval;setTimeout(function(){e.dispose()},t)},t.prototype.updateCameraSelectionStrategy=function(e){var t=a.DeviceSelectionStrategyFactory.getStrategy(e);this.deviceList.setCameraSelectionStrategy(t)},t.prototype.onSelectedDevicesChanged=function(e,t){var n=this.selectedDevices;this.selectedDevices=t,"camera"in n^"camera"in this.selectedDevices||"microphone"in n^"microphone"in this.selectedDevices||(this.event("onSelectedDevicesChanged").raise(this.toSelectedDevices(this.selectedDevices)),this.raiseTelemetryEvent("selected_devices_changed",this.toSelectedDevices(this.selectedDevices))),this.updateRenderersAsync()},t.prototype.onDevicesChanged=function(e,t){this.event("onDevicesChanged").raise(t),this.raiseTelemetryEvent("devices_changed",t)},Object.defineProperty(t.prototype,"isPollingInProgress",{get:function(){return this.deviceEnumerator.isPollingInProgress},enumerable:!0,configurable:!0}),t.prototype.raiseTelemetryEvent=function(e,t){this.event("onDeviceTelemetryEvent").raise({eventType:e,timestamp:Date.now(),payload:JSON.stringify(t)})},t.prototype.onStreamStarted=function(e,t){this.deviceEnumerator.startDevicePolling();var n=this.getActiveDevices(e,t);this.deviceList.updateActiveDevices(n),e.hasVideo()&&this.updateCameraSelectionStrategy(a.SelectionType.Manual),this.deviceList.isUpdateNeeded()&&this.enumerateDevices(),this.raiseTelemetryEvent("stream_added",{audio:e.hasAudio(),video:e.hasVideo()})},t.prototype.onStreamDisposed=function(e){this.unsubscribeFromStreamEvents(e),e.hasVideo()&&this.updateCameraSelectionStrategy(a.SelectionType.Automatic)},t.prototype.onStreamMuted=function(e,t){this.raiseQualityChanged(25,t?3:1)},t.prototype.onStreamEnded=function(e,t){t.error?(this.raiseTelemetryEvent("stream_ended_error",{constraints:{audio:e.hasAudio(),video:e.hasVideo()},error:{type:t.error.name,detail:t.error.message}}),"SourceUnavailableError"===t.error.name&&this.handleAudioDeviceInUse(3)):this.raiseTelemetryEvent("stream_ended",{audio:e.hasAudio(),video:e.hasVideo()})},t.prototype.onStreamError=function(e,t){this.raiseTelemetryEvent("stream_error",{constraints:{audio:e.hasAudio(),video:e.hasVideo()},error:t})},t.prototype.onAllStreamsRemoved=function(){this.deviceEnumerator.stopDevicePolling()},t.prototype.onRendererDisposed=function(e){d.remove(this.activeRenderers,function(t){return t===e}),this.unsubscribeFromRendererEvents(e)},t.prototype.onRendererStarted=function(e){this.activeRenderers.push(e)},t}(c.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=p},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(3),o=function(){function e(e,t,n,i){this.deviceId=e,this.label=t,this.kind=n,this.groupId=i,this.type=this.getType(this.kind),this.guid=this.getDeviceGuid(this.deviceId,this.type),this.isSystemDefault=this.isDefault(this.deviceId)}return e.prototype.toDeviceDesc=function(){return{id:this.guid,browserId:this.deviceId,label:this.label,kind:this.type}},e.prototype.getType=function(e){switch(e){case r.default.MEDIA_DEVICE_KIND.audioInput:return r.default.MEDIA_DEVICE.microphone;case r.default.MEDIA_DEVICE_KIND.audioOutput:return r.default.MEDIA_DEVICE.speaker;case r.default.MEDIA_DEVICE_KIND.videoInput:return r.default.MEDIA_DEVICE.camera;default:throw new Error("Device kind to recognized: "+e)}},e.prototype.isDefault=function(e){return e===r.default.MEDIA_DEVICE.defaultId},e.prototype.getDeviceGuid=function(e,t){return t+":"+e},e}(),a=function(e){function t(t,n,i,r){return e.call(this,t,n,i,r)||this}return i(t,e),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.isSystemDefault=this.isSystemDefault,t},t}(o);t.AudioDevice=a;var s=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.position="unknown",o}return i(t,e),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.position=this.position,t},t}(o);t.VideoDevice=s;var c=function(){function e(e){this.logger=e}return e.prototype.createDevice=function(e){switch(e.kind){case r.default.MEDIA_DEVICE_KIND.audioInput:case r.default.MEDIA_DEVICE_KIND.audioOutput:return new a(e.deviceId,e.label,e.kind,e.groupId);case r.default.MEDIA_DEVICE_KIND.videoInput:return new s(e.deviceId,e.label,e.kind,e.groupId);default:this.logger.safe.error("Device kind is not recognized: "+JSON.stringify(e))}},e.prototype.createDefaultDevice=function(e){var t={deviceId:r.default.MEDIA_DEVICE.defaultId,label:r.default.MEDIA_DEVICE.defaultDeviceLabel,kind:this.getKind(e),groupId:""};return this.createDevice(t)},e.prototype.getKind=function(e){switch(e){case r.default.MEDIA_DEVICE.microphone:return r.default.MEDIA_DEVICE_KIND.audioInput;case r.default.MEDIA_DEVICE.speaker:return r.default.MEDIA_DEVICE_KIND.audioOutput;case r.default.MEDIA_DEVICE.camera:return r.default.MEDIA_DEVICE_KIND.videoInput;default:throw new Error("Device type to recognized: "+e)}},e}();t.DeviceProvider=c},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(3),o=function(e){function t(){var t=e.call(this,r.default.EXTENSION_TYPE.dominantSpeakerHistory)||this;return t.callback=null,t}return i(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.manager.addNotificationListener(this,"DominantSpeakerInfo"),t&&t.callback&&(this.callback=t.callback)},t.prototype.dispose=function(){this.manager.removeNotificationListener(this,"DominantSpeakerInfo"),this.callback=null,e.prototype.dispose.call(this)},t.prototype.onNotification=function(e,t){if("DominantSpeakerInfo"===e){var n=t;this.processInfo(n)}},t.prototype.processInfo=function(e){this.callback&&this.callback(e.previousDominantSpeakerHistory)},t}(n(67).ExtensionBase);Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(130),r=n(134),o=n(3),a=function(){function e(){}return e.getExtension=function(e){switch(e){case o.default.EXTENSION_TYPE.dominantSpeakerHistory:return new i.default;case o.default.EXTENSION_TYPE.videoStreamControl:return new r.default;default:throw new Error("Extension of type "+e+" is not found")}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var i=function(){function e(){this.sequence=0}return e.prototype.getVideoControlMessage=function(e,t){return{controlVideoStreaming:{sequenceNumber:++this.sequence,globalTimestamp:(new Date).toString(),controlInfo:[{control:"start",sourceId:t,streamMsid:e}]}}},e}();t.VideoControlMessageGenerator=i;var r=function(){function e(e,t){this.logger=e,this.controlMessageGenerator=t}return e.prototype.dispose=function(){this.sender=null},e.prototype.configure=function(e){var t=e;this.sender=t.sender},e.prototype.requestSource=function(e,t){var n=this;return Promise.resolve().then(function(){if(n.checkConfigured()){var i=n.controlMessageGenerator.getVideoControlMessage(e,t);return n.logger.safe.log("sending video control message: "+i),n.sender.send(i)}n.logger.safe.warn("extension not configured with sender")})},e.prototype.checkConfigured=function(){return!!this.sender},e}();t.SourceRequester=r},function(e,t,n){"use strict";var i=n(66),r=n(16),o=function(){function e(e,t,n){this.logger=e,this.emulator=t,this.qualityManager=n,this.modifiers=[new i.BandwidthControlModifier(this.logger)]}return e.prototype.dispose=function(){this.modifiers&&(this.modifiers.forEach(function(e){return e.dispose()}),this.modifiers=null),this.emulator=null,this.logger=null},e.prototype.handleMessage=function(e){var t={controlVideoStreaming:e};return this.modifiers.forEach(function(e){return e.setVideoControlMessage(t)}),this.configureResolution(t),this.emulator.renegotiate(this.modifiers)},e.prototype.configureResolution=function(e){var t=e.controlVideoStreaming.controlInfo[0].fmtParams;this.logger.safe.log("Signaling FMTP: "+t);var n=r.default.build(t);n.contains("max-fs")&&this.qualityManager.setMaxCapabilities({maxFS:+n.get("max-fs"),maxFPS:+n.get("max-fps")/100})},e}();t.VideoStreamConfigurator=o},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(67),o=n(3),a=n(133),s=n(132),c=function(e){function t(){return e.call(this,o.default.EXTENSION_TYPE.videoStreamControl)||this}return i(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.subscribeListeners(),this.sourceRequester=new s.SourceRequester(t.logger,new s.VideoControlMessageGenerator),this.streamConfigurator=new a.VideoStreamConfigurator(t.logger,t.negotiationEmulator,t.qualityManager)},t.prototype.configure=function(t){e.prototype.configure.call(this,t),this.sourceRequester.configure(t)},t.prototype.requestSource=function(e,t){return this.sourceRequester.requestSource(e,t)},t.prototype.dispose=function(){this.unsubscribeListeners(),this.streamConfigurator.dispose(),this.sourceRequester.dispose(),e.prototype.dispose.call(this)},t.prototype.onNotification=function(e,t){"ControlVideoStreaming"===e&&this.streamConfigurator.handleMessage(t)},t.prototype.subscribeListeners=function(){this.manager.addNotificationListener(this,"ControlVideoStreaming")},t.prototype.unsubscribeListeners=function(){this.manager.removeNotificationListener(this,"ControlVideoStreaming")},t}(r.ExtensionBase);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},function(e,t,n){"use strict";var i=function(){function e(e,t){this.safe=e,this.unsafe=t,this.safe||(this.safe=this.unsafe)}return e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).log.apply(e,t)},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).warn.apply(e,t)},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).error.apply(e,t)},e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).debug.apply(e,t)},e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.unsafe).info.apply(e,t)},e.prototype.createChild=function(t){return new e(this.safe.createChild(t),this.unsafe.createChild(t))},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";var i=n(112),r=n(128),o=n(145),a=n(181),s=n(2),c=n(105),l=n(3),u=n(8),d=n(14),p=n(123),h=n(111),f=n(135),g=function(){function e(e,t){this.context=e,this.deviceManagerObserver=t,this.activeSessions=[],this.pendingDeviceTelemetryEvents=[],this.logger=new f.default(this.context.getSafeLogger&&this.context.getSafeLogger().createChild("MA",void 0,this.context.settings.debug),this.context.getLogger().createChild("MA",void 0,this.context.settings.debug)),this.configProvider=new p.default(this.logger,this.context.settings),this.context.configProvider=this.configProvider,this.deviceManager=new r.default(this.logger.createChild("DeviceManager"),this.configProvider),this.subscribeOnDeviceManagerEvents(),this.capabilities=new c.default(this.configProvider)}return e.prototype.createSession=function(e,t,n){var r=this,s=this.logger.createChild("Session",t),c={getDeviceManager:function(){return r.getDeviceManager()},getLogger:function(){return s},maContext:this.context,config:n||{},configProvider:this.configProvider},l=(d.hasOrtc()?o.default:a.default).build(c,t,e),u=new i.default(l,c,t,e,this.configProvider);for(u.on("onTerminated",function(e){return r.onSessionTerminated(e)}),this.activeSessions.push(u),this.configProvider.updateSessionCount(this.activeSessions.length);this.pendingDeviceTelemetryEvents.length>0;)u.registerDeviceTelemetryEvent(this.pendingDeviceTelemetryEvents.pop());return u},e.prototype.getDeviceManager=function(){return this.deviceManager},e.prototype.getCapabilities=function(){return this.capabilities},e.prototype.getScreenSharingManager=function(){return new h.ScreenSharingManager},e.prototype.updateConfig=function(e,t){this.configProvider.updateConfig(e,t)},e.prototype.subscribeOnDeviceManagerEvents=function(){var e=this;this.deviceManager.on("onDevicesChanged",function(t){return e.onDevicesChanged(t)}),this.deviceManager.on("onSelectedDevicesChanged",function(t){return e.onSelectedDevicesChanged(t)}),this.deviceManager.on("onQualityChanged",function(t){return e.onQualityChanged(t)}),this.deviceManager.on("onDeviceTelemetryEvent",function(t){return e.onDeviceTelemetryEvent(t)})},e.prototype.onDevicesChanged=function(e){var t=this,n=this.deviceManager.getDeviceDescriptions(e);this.activeSessions.forEach(function(e){return e._deviceListChanged(t.deviceManager.isPollingInProgress)}),this.deviceManagerObserver.onDevicesChanged(n)},e.prototype.onSelectedDevicesChanged=function(e){this.activeSessions.forEach(function(e){return e._deviceSelectionChanged()})},e.prototype.onQualityChanged=function(e){this.activeSessions.forEach(function(t){return t._qualityChanged(e)})},e.prototype.onDeviceTelemetryEvent=function(e){this.activeSessions.length>0?this.activeSessions.forEach(function(t){return t.registerDeviceTelemetryEvent(e)}):this.pendingDeviceTelemetryEvents.push(e)},e.prototype.onSessionTerminated=function(e){s.remove(this.activeSessions,function(t){return t===e}),this.configProvider.updateSessionCount(this.activeSessions.length)},e}(),m=function(){function e(){}return e.build=function(e,t){return new g(e,t)},e.isPlatformSupported=function(){return navigator.getUserMedia&&(d.hasOrtc()||d.hasWebRtc())},e}();m.constants=l.default,m.helper=u,Object.defineProperty(t,"__esModule",{value:!0}),t.default=m},function(e,t,n){"use strict";var i=n(56),r=n(2);function o(e,t,n,o){var a=e.logger.createChild("ChannelStats");this.getReport=function(){var e={};function s(t,n,o){if(t){var s=n+"."+(o?"msGetStats":"getStats"),c=new Promise(function(e){a.log(s,"start"),e(o?t.msGetStats():t.getStats())}).then(function(t){a.log(s,"complete"),e[n]=e[n]||{},r.forOwn(t,function(t){e[n][t.type||t.msType]=t})}).catch(function(e){a.warn(s,"failed:",e)});return i.timeout(c,5e3,s).catch(function(e){a.warn(s,"failed:",e)})}}return e.extended={mediaDiagnostic:{reason:function(){if(!t)return"CheckNotCompleted";var e=t.state;if("new"===e||"checking"===e||"connected"===e)return"CheckNotCompleted";if("completed"===e)return"CheckSucceed";if("failed"===e||"closed"===e)return"CheckFailed";if("disconnected"===e)return"MediaTimeout";return"Unknown DiagnosticReason"}()}},new Promise(function(i){Promise.all([s(t,"iceTransport",!1),s(t,"iceTransport",!0),s(n,"sender",!1),s(n,"sender",!0),s(o,"receiver",!1),s(o,"receiver",!0)]).then(function(){i(e)}).catch(function(t){a.error("getting statistics should never fail",t),i(e)})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t,n,i){return new o(e,t,n,i)}}},function(e,t,n){"use strict";var i=n(3),r=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};return e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==i.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId={exact:e.audio.deviceId})),e.video&&(t.video={},e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),e.video.minWidth&&(t.video.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.fps=e.video.fps)),t},e}();t.OrtcConstraintsAdapter=r},function(e,t,n){"use strict";var i=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={video:{}};return e.video.minWidth&&(t.video.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.fps=e.video.fps),t},e}();t.OrtcDisplayConstraintsAdapter=i},function(e,t,n){"use strict";var i=n(58),r=function(){function e(e){this.queue=new i.DTMFQueue(e.logger),this.configProvider=e.configProvider}return e.prototype.sendDtmf=function(e,t){return e?(this.syncSender(e),this.ortcSender.canInsertDTMF?(this.ortcSender.insertDTMF(this.ortcSender.toneBuffer+t,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(t)):Promise.reject(new Error("not available"))):Promise.reject(new Error("bad sender"))},e.prototype.canSendDtmf=function(e){return!!e&&(this.syncSender(e),!!this.ortcSender&&this.ortcSender.canInsertDTMF)},e.prototype.dispose=function(){this.queue.cleanup()},e.prototype.syncSender=function(e){this.ortcSender&&this.ortcSender.sender===e||(this.ortcSender&&(this.ortcSender.ontonechange=null,this.queue.cleanup(),this.ortcSender=null),this.ortcSender=new RTCDtmfSender(e),this.ortcSender.ontonechange=this.onToneChange.bind(this))},e.prototype.onToneChange=function(e){e.tone&&this.queue.toneSent(e.tone)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(138),o=n(139),a=n(62),s=n(5),c=function(e){function t(t){var n=e.call(this,t)||this;return n.constraintsAdapter=new r.OrtcConstraintsAdapter,n}return i(t,e),t}(a.GumStreamProviderBase);t.ORTCMediaStreamProvider=c;var l=function(e){function t(t){var n=e.call(this,t)||this;return n.constraintsAdapter=new o.OrtcDisplayConstraintsAdapter,n}return i(t,e),t.prototype.getStream=function(e){var t=this.constraintsAdapter.toGumConstraints(e);return this.logger.safe.log("Constraints to be applied: "+JSON.stringify(t)),s.default.window.navigator.getDisplayMedia(t)},t}(a.GumStreamProviderBase);t.ORTCDisplayStreamProvider=l},function(e,t,n){"use strict";var i=n(18),r=n(3),o=n(32),a=n(137),s=n(2),c=n(140),l=n(64),u=n(31),d=function(){function e(e,t,n,i,o,a,s,d){this.configProvider=e,this.channelId=t,this.logger=n,this.channelType=i,this.label=o,this.observer=a,this.ssrcGenerator=s,this.maintainResolution=d,this.contributingSourcesPollingInterval=1e3,this.doMute=!1,this.sendActive=!1,this.recvActive=!1,this.lastSources=[],this.resolutionTable=new u.default,this.subscribedMsi=r.default.MSI.unsubscribe,this.isSsrcUpdated=!1,this.networkSendQualityLevel=1,this.networkRecvQualityLevel=1;var p=e.config.ortcVideoCapabilityMaxFS,h=e.config.ortcVideoCapabilityMaxFPS;this.videoCapabilities=new l.default(p,h),this.dtmfSender=new c.default({logger:this.logger,configProvider:this.configProvider}),this.ssrcRange=this.generateSsrcRange()}return e.prototype.setTransportId=function(e){this.transportId=e},e.prototype.getTransportId=function(){return this.transportId},e.prototype.getLabel=function(){return this.label},e.prototype.getType=function(){return this.channelType},e.prototype.getSubscrbedMsi=function(){return this.subscribedMsi},e.prototype.getMediaParameters=function(){return this.mediaParams},e.prototype.getLocalParameters=function(){var e=s.deepClone(this.getLocalRtpCaps());this.updateCodecParameters(e);var t={rtpCaps:e,rtxSsrc:this.getRtxSsrc(this.ssrcRange),ssrcRange:this.ssrcRange};return{sender:t,receiver:s.deepClone(t)}},e.prototype.configureChannel=function(e,t,n){this.logger.log("configureChannel","type:",this.channelType,"descr:",JSON.stringify(e.descr)),this.mediaParams=e,e.descr.enabled?(this.configureSsrc(e.receiver,e.sender),this.configureReceiver(e.descr,e.receiver,t),this.configureSender(e.descr,e.sender,t,n)):this.disable()},e.prototype.updateLocalMediaStream=function(e){this.rtpSender&&this.replaceMediaStreamIfDifferent(e)},e.prototype.canSubscribe=function(){return this.recvActive&&this.rtpReceiver&&this.subscribedMsi===r.default.MSI.unsubscribe&&this.isVideo()},e.prototype.subscribe=function(e){if(this.subscribedMsi===r.default.MSI.unsubscribe&&this.isVideo())return this.subscribedMsi=e,this.requestSendCsrc(this.subscribedMsi);throw new Error("invalid call for subscribe:"+this.subscribedMsi+"type:"+this.channelType)},e.prototype.unsubscribe=function(){if(this.subscribedMsi===r.default.MSI.unsubscribe||!this.isVideo())throw new Error("invalid call for unsubscribe:"+this.subscribedMsi+"type:"+this.channelType);this.subscribedMsi=r.default.MSI.unsubscribe,this.requestSendCsrc(this.subscribedMsi)},e.prototype.getReportsAsync=function(){var e=this.recvActive?this.rtpReceiver:null,t=this.sendActive?this.rtpSender:null,n=e?e.transport.transport:t?t.transport.transport:null;return a.default.build({logger:this.logger},n,t,e).getReport()},e.prototype.getSendTrack=function(){return this.sendActive&&this.rtpSender?this.rtpSender.track:null},e.prototype.getRecvTrack=function(){return this.recvActive&&this.rtpReceiver?this.recvTrack:null},e.prototype.terminate=function(){this.disable(),this.logger.log("terminated")},e.prototype.sendDtmf=function(e){return this.dtmfSender.sendDtmf(this.rtpSender,e)},e.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.rtpSender)},e.prototype.videoSizeChanged=function(e,t){var n=this,i=this.resolutionTable.getMaxFS(e,t);this.videoCapabilities?this.videoCapabilities.setMaxFS(i,function(e){var t=n.mediaParams.receiver.rtpCaps.codecs[0];"h264"===t.name.toLowerCase()&&n.observer.onMediaCapabilitiesChanged(o.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED,{mediaId:n.channelId,codecName:t.name,capabilities:{"max-fs":e.getMaxFS(),"max-fps":e.getMaxFPS()}})}):this.logger.error("no capabilities for provided modality:",self)},e.prototype.setMute=function(e){this.doMute=e,this.currMediaStreamRef&&this.currMediaStreamRef.setMuted(e)},e.prototype.preconfigureChannel=function(e){if(e){this.logger.debug("Preconfigure with remote ssrc:",e.remoteSsrcRange),this.logger.debug("Preconfigure label",this.label,"to",e.label),this.label=e.label;var t=this.rtpReceiver&&this.hasSsrcChanged(e.remoteSsrcRange,this.recvRemoteSsrc),n=this.rtpSender&&this.hasSsrcChanged(e.remoteSsrcRange,this.sendRemoteSsrc);(t||n)&&(this.isSsrcUpdated=!0,this.updateSsrcRange())}},e.prototype.getLocalRtpCaps=function(){return this.localRtpCaps||(this.localRtpCaps=this.gatherLocalRtpCaps()),this.localRtpCaps},e.prototype.gatherLocalRtpCaps=function(){var e=this,t=this.typeToString(this.channelType),n=RTCRtpReceiver.getCapabilities(t);if(!n.codecs)return n;if(this.channelType===o.MediaChannelType.Audio&&this.configProvider.config.audioCodec){var i=["cn","red"];s.remove(n.codecs,function(t){var n=t.name.toLowerCase();return n!==e.configProvider.config.audioCodec.toLowerCase()&&-1===i.indexOf(n)})}else this.channelType===o.MediaChannelType.Video&&this.configProvider.config.videoCodec&&s.remove(n.codecs,function(t){return t.name.toLowerCase()!==e.configProvider.config.videoCodec.toLowerCase()});if(this.channelType===o.MediaChannelType.Audio)for(var r=n.codecs.length-1;r>=0;r--)"opus"===n.codecs[r].name.toLowerCase()&&(n.codecs[r].preferredPayloadType=111,this.logger.log("Opus payloadType fix, change payload type to 111 for",n.codecs[r].name));if(this.channelType===o.MediaChannelType.Video){var a=s.find(n.codecs,function(e){return"vp8"===e.name.toLowerCase()});a&&s.remove(n.codecs,function(e){return"vp8"===e.name.toLowerCase()||"rtx"===e.name.toLowerCase()&&a.preferredPayloadType===+e.parameters.apt})}return n},e.prototype.getRtxSsrc=function(e){var t=this.getLocalRtpCaps();return i.default.hasRtx(t.codecs)?this.ssrcRange.min+50:0},e.prototype.replaceMediaStreamIfDifferent=function(e){var t,n;this.isAudio()?(n=this.currMediaStreamRef.rawStream.getAudioTracks()[0],t=e.rawStream.getAudioTracks()):(n=this.currMediaStreamRef.rawStream.getVideoTracks()[0],t=e.rawStream.getVideoTracks());var i=t.length?t[0]:null;if(null!==i){var r=n.getSettings().deviceId,o=i.getSettings().deviceId;if(r!==o){this.logger.log("replacing media track","currDevID:",r,"newDevID:",o,"currTrackID:",n.id,"newTrackID:",i.id);var a=e.clone();a.setMuted(this.doMute),this.isAudio()?this.rtpSender.setTrack(a.rawStream.getAudioTracks()[0]):this.rtpSender.setTrack(a.rawStream.getVideoTracks()[0]),this.currMediaStreamRef.dispose(),this.currMediaStreamRef=a}else this.logger.log("NOT replacing media track","currDevID:",r,"newDevID:",o,"currTrackID:",n.id,"newTrackID:",i.id)}else this.logger.error("media track is not available")},e.prototype.isAudio=function(){return this.channelType===o.MediaChannelType.Audio},e.prototype.isVideo=function(){return this.channelType===o.MediaChannelType.Video},e.prototype.updateContributingSources=function(){var e=this;if(this.recvActive&&this.rtpReceiver){var t=void 0;try{t=this.rtpReceiver.getContributingSources()}catch(e){return void this.logger.error("failed to retrieve contributing sources from receiver","error:",e)}if(!t)return void this.logger.warn("could not retrieve contributing sources from receiver");var n=t.map(function(e){return e.csrc});this.lastSources.length===n.length&&n.every(function(t,n){return t===e.lastSources[n]})||(this.logger.debug("contributing sources changed","sources:",n),this.observer.onContributingSourcesChanged(n)),this.lastSources=n,setTimeout(this.updateContributingSources.bind(this),this.contributingSourcesPollingInterval)}else this.logger.debug("receiver is missing, stop polling for contributing sources")},e.prototype.requestSendCsrc=function(e){if(this.recvActive&&this.rtpReceiver){this.logger.log("_requestSendCsrc","csrc:",e);try{this.rtpReceiver.requestSendCSRC(e)}catch(e){this.logger.error("failed to request send csrc","error:",e)}return!0}return!1},e.prototype.raiseAudioQualityEvent=function(e){var t={type:1,value:1,isLocalSource:!0,mediaType:0};if("NetworkSendQuality"===e.name)t.type=1;else{if("NetworkReceiveQuality"!==e.name)return;t.type=2}if("Good"===e.value)t.value=1;else if("Poor"===e.value)t.value=2;else{if("Bad"!==e.value&&"Catastrophic"!==e.value)return;t.value=3}if(1===t.type){if(this.networkSendQualityLevel===t.value)return;this.networkSendQualityLevel=t.value}else if(2===t.type){if(this.networkRecvQualityLevel===t.value)return;this.networkRecvQualityLevel=t.value}this.observer.onAudioQualityChanged(t)},e.prototype.createReceiver=function(e,t){var n=this;this.logger.log("_rtpReceiver create");var i=this.typeToString(this.channelType);this.rtpReceiver=new RTCRtpReceiver(e.transport,i),this.recvTrack=this.rtpReceiver.track,this.rtpReceiver.onerror=function(e){n.logger.error("_rtpReceiver.onerror","event:",e),n.observer.onError({type:r.default.MEDIA_ERROR.internalError,detail:e})},this.rtpReceiver.onmsquality=function(e){e.messages.forEach(function(e){n.logger.info("this.rtpReceiver.onmsquality","event:",e),n.raiseAudioQualityEvent(e)})}},e.prototype.createSender=function(e,t,n){var i,o=this;i=this.isAudio()?t.rawStream.getAudioTracks()[0]:t.rawStream.getVideoTracks()[0],this.logger.log("this.rtpSender create trackID:",i.id),this.rtpSender=new RTCRtpSender(i,e.transport),this.rtpSender.onerror=function(e){o.logger.error("this.rtpSender.onerror","event:",e),o.observer.onError({type:r.default.MEDIA_ERROR.internalError,detail:e})},this.rtpSender.onmsquality=function(e){e.messages.forEach(function(e){o.logger.info("this.rtpSender.onmsquality","event:",e),o.raiseAudioQualityEvent(e)})},this.rtpSender.onssrcconflict=function(e){o.logger.error("this.rtpSender.onssrcconflict","event:",e)}},e.prototype.getRecvParams=function(e){var t=i.default.getRecvParams(e.rtpCaps,e.remoteSsrcRange,this.ssrcRange.min,e.rtcpReducedSize,e.rtcpMux,e.rtxSsrc);return this.maintainResolution&&(t.degradationPreference="maintain-resolution"),t.encodings[0].active=this.recvActive,t},e.prototype.getSendParams=function(e){var t=i.default.getSendParams(e.rtpCaps,this.ssrcRange,e.remoteSsrcRange.min,e.rtcpReducedSize,e.rtcpMux,e.rtxSsrc);return t.encodings[0].active=this.sendActive,t},e.prototype.configureSsrc=function(e,t){(this.rtpReceiver&&this.hasSsrcChanged(e.remoteSsrcRange,this.recvRemoteSsrc)||this.rtpSender&&this.hasSsrcChanged(t.remoteSsrcRange,this.sendRemoteSsrc))&&!this.isSsrcUpdated?this.updateSsrcRange():this.isSsrcUpdated=!1},e.prototype.updateSsrcRange=function(){var e=this.generateSsrcRange();this.logger.debug("SSRC updating: ",this.ssrcRange," -> ",e),this.ssrcRange=e,this.observer.onMediaCapabilitiesChanged(o.VideoCapabilitiesEventType.SSRC_UPDATED,{mediaId:this.channelId,ssrcRange:this.ssrcRange,rtxSsrc:this.getRtxSsrc(this.ssrcRange)})},e.prototype.configureReceiver=function(e,t,n){this.rtpReceiver&&this.hasSsrcChanged(t.remoteSsrcRange,this.recvRemoteSsrc)&&(this.logger.log("SSRC changed, resetting receiver"),this.stopReceiver()),this.rtpReceiver||(this.createReceiver(n,t),this.recvRemoteSsrc=t.remoteSsrcRange),this.recvActive=!!e.recv;var i=this.getRecvParams(t);this.logger.debug("rtpReceiver.receive:",JSON.stringify(i)),this.rtpReceiver.receive(i),this.recvActive&&(this.isAudio()?this.updateContributingSources():this.subscribedMsi!==r.default.MSI.unsubscribe&&this.requestSendCsrc(this.subscribedMsi))},e.prototype.stopReceiver=function(){this.rtpReceiver&&(this.logger.log("_rtpReceiver stop & destroy"),this.recvActive=!1,this.recvTrack=null,this.rtpReceiver.stop(),this.rtpReceiver=null)},e.prototype.configureSender=function(e,t,n,i){if(this.rtpSender&&this.hasSsrcChanged(t.remoteSsrcRange,this.sendRemoteSsrc)&&(this.logger.log("SSRC changed, resetting sender"),this.stopSender()),this.sendActive=!!e.send,this.sendActive&&i){this.currMediaStreamRef?this.replaceMediaStreamIfDifferent(i):(this.currMediaStreamRef=i.clone(),this.currMediaStreamRef.setMuted(this.doMute)),this.rtpSender||(this.createSender(n,this.currMediaStreamRef,t),this.sendRemoteSsrc=t.remoteSsrcRange);var r=this.getSendParams(t);this.logger.debug("this.rtpSender.send:",JSON.stringify(r)),this.rtpSender.send(r)}else this.stopSender(),this.disposeLocalStream()},e.prototype.stopSender=function(){this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.rtpSender&&(this.logger.log("this.rtpSender stop & destroy"),this.sendActive=!1,this.rtpSender.stop(),this.rtpSender=null)},e.prototype.disposeLocalStream=function(){this.currMediaStreamRef&&(this.currMediaStreamRef.dispose(),this.currMediaStreamRef=null)},e.prototype.hasSsrcChanged=function(e,t){return t&&e&&!s.deepEqual(e,t)},e.prototype.updateCodecParameters=function(e){var t=s.find(e.codecs,function(e){return"h264"===e.name.toLowerCase()});t&&t.parameters&&(t.parameters["max-fs"]=this.videoCapabilities.getMaxFS(),t.parameters["max-fps"]=this.videoCapabilities.getMaxFPS())},e.prototype.disable=function(){this.stopReceiver(),this.stopSender(),this.disposeLocalStream()},e.prototype.generateSsrcRange=function(){return this.channelType===o.MediaChannelType.Audio?this.ssrcGenerator.nextAudioStreamSsrc():this.channelType===o.MediaChannelType.Video?this.ssrcGenerator.nextVideoStreamSsrc():null},e.prototype.typeToString=function(e){return o.MediaChannelType[e].toLowerCase()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=d},function(e,t,n){"use strict";var i=n(18),r=n(3),o=n(32),a=n(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var s=n&&t.config.numVideoChannelsGvc?t.config.numVideoChannelsGvc:1;this.processOffer=function(t){c=t,e.debug("PROCESS OFFER","params:",JSON.stringify(c))},this.createMediaDescriptorsForAnswer=function(e){if(u&&u.media.length>c.media.length)throw new Error("Invalid remote offer - removed media lines");var t,n=[],o=!1,a=!1,l=0;d=p(c,!1);for(var f=0;f<c.media.length;f++){if(u&&u.media[f]){if(u.media[f].type!==c.media[f].type)throw new Error("Changing media type not supported");if(u.media[f].label&&c.media[f].label&&u.media[f].label!==c.media[f].label)throw new Error("Changing media label not supported")}c.media[f].descr.label!==r.default.MEDIA_LABEL.audio||o?c.media[f].descr.label===r.default.MEDIA_LABEL.video&&l<s?((t=h(i.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,f),c.media[f])).needsTransport=!0,l>0&&(t.send=!1,t.needsTransport=!1),n.push(t),l++):c.media[f].descr.label!==r.default.MEDIA_LABEL.sharing||a?n.push({enabled:!1,type:c.media[f].descr.type,label:u&&u.media[f]?u.media[f].descr.label:c.media[f].descr.label}):((t=h(i.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,f),c.media[f])).needsTransport=!0,n.push(t),a=!0):((t=h(i.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,f),c.media[f])).needsTransport=!0,n.push(t),o=!0)}if(d){var g=!1;n.forEach(function(e){!g&&e.needsTransport?g=!0:e.needsTransport=!1})}return n},this.createAnswer=function(t,n,i,o){for(var s,u={isOffer:!1,sessionVersion:c.sessionVersion,transportParams:f(n,c.transportParams),media:[],bundled:d,groups:[]},p=!1,h=!1,v=0,S=0,E=0;E<t.length;E++){var T=h&&t[E].label===r.default.MEDIA_LABEL.video||p&&u.bundled,C={},I=a.shallowClone(t[E]);if(I.enabled){p=!0;var A=g(i[E],c.media[E],!1,!1),b=g(i[E],c.media[E],!1,!0);C.receiver=A,C.sender=b,s=I.needsTransport?n[v]:n[S],I.transportId=s.transportId,I.needsTransport&&(S=v,v++),I.label===r.default.MEDIA_LABEL.video&&(I.firstVideoChannel=!h,h=!0),_(I,s,C.receiver)&&_(I,s,C.sender)||(I.enabled=!1,e.warn("Rejecting media since unable to match parameters"))}u.media.push(m(I,C,!1,T,c.media[E].receiver.rtcpReducedSize))}e.debug(o?"CREATE PRANSWER":"CREATE ANSWER","params:",JSON.stringify(u)),o||(l=y(u,c,!1));var O=[];return u.media.forEach(function(e){d&&e.descr.enabled&&e.descr.mid&&O.push(e.descr.mid)}),u.groups=O,u},this.createMediaDescriptorsForOffer=function(e){var t=[],o=!1,a=!1,c=0,l=0;if(u)for(var p=0;p<u.media.length;p++){var h=void 0;u.media[p].descr.label!==r.default.MEDIA_LABEL.audio||o?u.media[p].descr.label===r.default.MEDIA_LABEL.video&&c<s?((h=i.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,l++)).needsTransport=!0,c>0&&(h.send=!1,h.needsTransport=!1),c++):u.media[p].descr.label!==r.default.MEDIA_LABEL.sharing||a?h={enabled:!1,type:u.media[p].descr.type,label:u.media[p].descr.label}:((h=i.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,l++)).needsTransport=!0,a=!0):((h=i.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,l++)).needsTransport=!0,o=!0),h.enabled&&(h.mid=u.media[p].descr.mid),t.push(h)}if(!o&&e.audio){var h=i.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,l++);h.needsTransport=!0,t.push(h)}for(var f=c;f<s&&e.video;f++){var h=i.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,l++);f>0?(h.send=!1,h.needsTransport=!1):h.needsTransport=!0,t.push(h)}if(!a&&e.sharing){var h=i.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,l++);h.needsTransport=!0,t.push(h)}for(var p=0;p<t.length;p++)t[p].mid||(t[p].mid="m"+p);if(n&&(d=!0),d){var g=!1;t.forEach(function(e){!g&&e.needsTransport?g=!0:e.needsTransport=!1})}return t},this.createOffer=function(t,n,i){for(var o={isOffer:!0,sessionVersion:u?u.sessionVersion:0,transportParams:f(n,u?u.transportParams:[]),groups:[],bundled:d,media:[]},a=!1,s=!1,l=0,p=0,h=0;h<t.length;h++){var g,_=u&&u.media[h]&&u.media[h].descr.enabled,v=!_&&t[h].enabled,y=s&&t[h].label===r.default.MEDIA_LABEL.video||o.bundled&&a;t[h].enabled&&t[h].mid&&o.groups.push(t[h].mid),g=v?i[h]:u.media[h],t[h].transportId=t[h].needsTransport?n[l].transportId:n[p].transportId,t[h].needsTransport&&(p=l,l++),a=a||_||v,t[h].label===r.default.MEDIA_LABEL.video&&(t[h].firstVideoChannel=!s,s=!0),o.media.push(m(t[h],g,v,y,!0))}return c=o,e.debug("CREATE OFFER","params:",JSON.stringify(c)),c},this.processAnswer=function(t){e.debug("PROCESS ANSWER","params:",JSON.stringify(t)),l=y(c,t,!0)},this.completeNegotiation=function(){return l.sessionVersion++,u=l,e.debug("NEGOTIATED","params:",JSON.stringify(u)),u},this.onMediaCapabilitiesChanged=function(t,n){return t===o.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED?function(t){var n=a.find(u.media,function(e){return e.descr.mediaId===t.mediaId});if(n){var r=i.default.getCodecByName(t.codecName,n.receiver.rtpCaps.codecs);r&&r.parameters?a.forOwn(t.capabilities,function(n,i){e.log("changing ",i," for ",t.codecName," from ",r.parameters[i]," to ",n),r.parameters[i]=n}):e.warn("codec not found for codecName: ",t.codecName)}else e.warn("mediaCaps not found for mediaId: ",t.mediaId)}(n):t===o.VideoCapabilitiesEventType.SSRC_UPDATED?(r=n,void((s=a.find(u.media,function(e){return e.descr.mediaId===r.mediaId}))?(e.log("SSRC changing: ",s.receiver.ssrcRange," -> ",r.ssrcRange),e.log("rtxSSRC changing: ",s.receiver.rtxSsrc," -> ",r.rtxSsrc),s.receiver.ssrcRange=a.shallowClone(r.ssrcRange),s.sender.ssrcRange=a.shallowClone(r.ssrcRange),s.receiver.rtxSsrc=r.rtxSsrc,s.sender.rtxSsrc=r.rtxSsrc):e.warn("mediaCaps not found for mediaType: ",r.mediaId,u))):void 0;var r,s},this.supportsBundling=p;var c=null,l=null,u=null,d=!1;function p(e,n){return n||t.config.ortcPreferBundling||e&&e.bundledOnly?e&&e.groups&&e.groups.length>0:d}function h(e,t){var n=t.descr;n||(n={enabled:!0,send:!0,recv:!0});var i=e.send&&e.enabled&&n.recv&&n.enabled,r=e.recv&&e.enabled&&n.send&&n.enabled,o=e.enabled&&n.enabled&&(i||r||!e.send&&!e.recv||!n.send&&!n.recv),a=t.receiver.ssrcRange;return{enabled:o,mediaId:e.mediaId,mid:n.mid||null,type:e.type,transportId:e.transportId,needsTransport:e.needsTransport,label:e.label,send:i,recv:r,remoteSsrcRange:a}}function f(e,n,r){for(var o=0;o<e.length;o++)if(e[o]&&(e[o].doRtcpMux=!(n[o]&&!n[o].doRtcpMux)),e[o]&&n[o]){for(var a=!1,s=0;!t.config.disableSdes&&s<n.length;s++)n[s]&&n[s].sdesParamsList&&n[s].sdesParamsList.length&&(a=!0);n[o].doRtcpMux&&(e[o].rtcpIceParams=null,e[o].rtcpIceCandidates=null),e[o].dtlsParams&&n[o].dtlsParams&&(e[o].dtlsParams.role="client"===n[o].dtlsParams.role?"server":"client"),!a&&n[o].dtlsParams||(e[o].dtlsParams=null),a||(e[o].sdesParamsList=[]);var c=null;e[o].sdesParamsList&&n[o].sdesParamsList&&(c=i.default.findMatchingSdesParams(e[o].sdesParamsList,n[o].sdesParamsList))&&(c.localSdesParams.tag=c.remoteSdesParams.tag,e[o].sdesParamsList=[c.localSdesParams],e[o].remoteSdesParams=c.remoteSdesParams)}else e[o]&&e[o].dtlsParams&&(e[o].dtlsParams.role=null);return e}function g(e,t,n,r){var o=r?e.sender:e.receiver,a=r?t.receiver:t.sender,s=i.default.matchRtpCaps(o.rtpCaps,a.rtpCaps,n,r);return{mid:n?o.mid:a.mid,transportId:o.transportId,ssrcRange:o.ssrcRange,remoteSsrcRange:a.ssrcRange,rtxSsrc:i.default.getRtxSsrc(s,o,a,r),rtpCaps:s}}function m(e,t,n,i,r){if(e.enabled){var o=t;return o.sender.rtcpReducedSize=r,o.receiver.rtcpReducedSize=r,o.descr=e,o.justAdded=n,o.bundledWithOther=i,o}return{descr:e}}function _(t,n,i){if(t.enabled){if(!n.sdesParamsList&&!n.dtlsParams)return e.warn("no sdes nor dtls params:",n.sdesParamsList,n.dtlsParams),!1;if(!i.rtpCaps.codecs.length)return e.warn("no common codecs!",i.rtpCaps),!1}return!0}function v(e,t,n,r,o){function a(n){var i=n?e.sender:e.receiver,o=n?t.sender:t.receiver,a=g(e,t,r,n);return a.rtcpMux=u.doRtcpMux,a.rtcpReducedSize=i.rtcpReducedSize&&o.rtcpReducedSize,a.enableDtls=u.enableDtls,a}var s=h(e.descr,t),c={descr:s};if(s.enabled){s.transportId=o?n[0].transportId:s.transportId;var l=i.default.getTransportIndexById(n,s.transportId),u=o?n[0]:n[l];if(c.descr=s,c.sender=a(!0),c.receiver=a(!1),!_(s,u,c.sender)||!_(s,u,c.receiver))throw new Error("Failed to verify negotiated parameters!")}return c}function y(e,t,n){if(e.media.length!==t.media.length)throw new Error("Number of media lines doesn't match in offer & answer l:"+e.media.length+" r: "+t.media.length);d=p(t,n);for(var r={sessionVersion:n?e.sessionVersion:t.sessionVersion,transportParams:function(e,t,n){for(var r=[],o=0;o<Math.max(e.length,t.length);o++){var s=null;if(e[o]&&t[o]){(s=a.shallowClone(t[o])).doRtcpMux=e[o].doRtcpMux&&t[o].doRtcpMux,s.enableDtls=e[o].dtlsParams&&t[o].dtlsParams,s.transportId=e[o].transportId;var c=null;e[o].sdesParamsList&&t[o].sdesParamsList&&(c=i.default.findMatchingSdesParams(e[o].sdesParamsList,t[o].sdesParamsList))&&(c.localSdesParams.tag=c.remoteSdesParams.tag,s.sdesParamsList=[c.localSdesParams],s.remoteSdesParams=c.remoteSdesParams)}r.push(s)}return r}(e.transportParams,t.transportParams),bundle:n?e.groups:t.groups,bundled:d,media:[]},o=0;o<e.media.length;o++)r.media.push(v(e.media[o],t.media[o],r.transportParams,n,r.bundled));return r}}},function(e,t,n){"use strict";var i=n(11),r=n(3),o=n(18),a=n(2),s=n(16);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e,t){return t?e.replace(/\\/g,"/"):e.replace(/\//g,"\\")}function t(e,t){return e.toLowerCase()===t.toLowerCase()}function n(e){return-1===e.indexOf(":")}function c(e,n,i){i.push({foundation:e.foundation,component:n,transport:function(e,t){var n=e.toUpperCase();if("TCP"===n)switch(t.toLowerCase()){case"active":return"TCP-ACT";case"passive":return"TCP-PASS";case"so":return"TCP-SO"}return n}(e.protocol,e.tcpType),priority:e.priority,ip:e.ip,port:e.port,type:e.type,raddr:t(e.type,"host")?void 0:e.relatedAddress,rport:t(e.type,"host")?void 0:e.relatedPort})}function l(e,t,i,r){e&&e.forEach(function(e){n(e.ip)?c(e,t,i):c(e,t,r)})}function u(e){if(e.iceCandidatePair)return{0:e.iceCandidatePair.local,1:e.rtcpIceCandidatePair?e.rtcpIceCandidatePair.local:null};var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority})[0],n=null;if(e.rtcpIceCandidates)for(var i=0;i<e.rtcpIceCandidates.length;++i){var r=e.rtcpIceCandidates[i];if(r.foundation===t.foundation){n=r;break}}return{0:t,1:n}}function d(i,o,s,c,d,p){var h=o.receiver,f={rtp:[],fmtp:[],rtcpFb:[],ext:[],type:o.descr.type,port:0,protocol:"RTP/SAVP",payloads:"",cryptoscale:[],crypto:[],candidates:[],xCandidatesIpv6:[]};if(!o.descr.enabled)return f.type===r.default.MEDIA_TYPE.video?f.payloads="34":f.payloads="9",f;o.descr.mid&&(f.mid=o.descr.mid);var g,m,_,v,y,S,E=u(i);if(f.port=E[0].port,(d&&f.mid===p[0]||!d)&&(g=E[0],m=E[1],c.ip!==g.ip&&(f.connection={version:n(g.ip)?4:6,ip:g.ip})),f.iceUfrag=i.iceParams.usernameFragment,f.icePwd=i.iceParams.password,f.type===r.default.MEDIA_TYPE.audio){var T=function(e){if(0===e.length)return{ptime:0,maxptime:0};var t=e[0].ptime,n=e[0].maxptime;return e.forEach(function(e){n>e.maxptime&&e.maxptime>0&&(n=e.maxptime)}),{ptime:t,maxptime:n}}(h.rtpCaps.codecs);f.maxptime=T.maxptime,f.ptime=T.ptime}f.direction=(_=o.descr.send,v=o.descr.recv,_&&v?"sendrecv":_?"sendonly":v?"recvonly":"inactive"),f.xSsrcRange={ssrcMin:h.ssrcRange.min,ssrcMax:h.ssrcRange.max},f.ssrcGroups=(y=o.sender.rtxSsrc,S=o.sender.ssrcRange.min,y?[{semantics:"FID",ssrcs:S+" "+y}]:[]),f.label=o.descr.label,(f.label!==r.default.MEDIA_LABEL.video||o.descr.firstVideoChannel)&&(f.xSource=f.label),h.rtcpReducedSize&&(f.rtcpRsize=!0),s&&o.justAdded?(i.doRtcpMux&&(f.rtcpMux=!0),f.rtcp={port:m&&m.port||f.port+1}):i.doRtcpMux?f.rtcpMux=!0:f.rtcp={port:m&&m.port||f.port+1};var C=null;function I(e){return 0!==e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:""}if(h.rtpCaps&&h.rtpCaps.codecs&&(h.rtpCaps.codecs.forEach(function(e){f.rtp.push({payload:e.preferredPayloadType,codec:e.name,rate:e.clockRate,encoding:e.numChannels>1?e.numChannels:void 0});var n="";a.forOwn(e.parameters,function(e,t){""!==n&&(n+=";"),n+="events"===t?e:t+"="+e}),""!==n&&f.fmtp.push({payload:e.preferredPayloadType,config:n}),f.payloads+=(f.payloads?" ":"")+e.preferredPayloadType;for(var i=0;i<e.rtcpFeedback.length;i++)t(e.rtcpFeedback[i].type,"x-message")?C=e.rtcpFeedback[i].parameter:f.rtcpFb.push({payload:e.preferredPayloadType,type:e.rtcpFeedback[i].type,subtype:e.rtcpFeedback[i].parameter})}),C&&f.rtcpFb.push({payload:"*",type:"x-message",subtype:C})),h.rtpCaps&&h.rtpCaps.headerExtensions&&h.rtpCaps.headerExtensions.forEach(function(t){f.ext.push({value:t.preferredId,uri:e(t.uri,!1)})}),i.sdesParamsList)for(var A=0;A<i.sdesParamsList.length;++A){var b=i.sdesParamsList[A];t(b.cryptoSuite,"AES_CM_128_HMAC_SHA1_80")?f.crypto.push({id:b.tag,suite:"AES_CM_128_HMAC_SHA1_80",config:b.keyParams[0].keyMethod+":"+b.keyParams[0].keySalt+"|"+b.keyParams[0].lifetime+I(b.keyParams[0])}):t(b.cryptoSuite,"SCALE_AES_CM_128_HMAC_SHA1_80")&&f.cryptoscale.push({id:b.tag,flavor:"client",suite:"AES_CM_128_HMAC_SHA1_80",config:b.keyParams[0].keyMethod+":"+b.keyParams[0].keySalt+"|"+b.keyParams[0].lifetime+I(b.keyParams[0])})}if(o.bundledWithOther||(i.iceCandidatePair?(l([i.iceCandidatePair.local],1,f.candidates,f.xCandidatesIpv6),i.rtcpIceCandidatePair&&!i.doRtcpMux&&l([i.rtcpIceCandidatePair.local],2,f.candidates,f.xCandidatesIpv6),f.remoteCandidates="1 "+i.iceCandidatePair.remote.ip+" "+i.iceCandidatePair.remote.port,i.doRtcpMux?f.remoteCandidates+=" 2 "+i.iceCandidatePair.remote.ip+" "+i.iceCandidatePair.remote.port:f.remoteCandidates+=" 2 "+i.rtcpIceCandidatePair.remote.ip+" "+i.rtcpIceCandidatePair.remote.port):(l(i.iceCandidates,1,f.candidates,f.xCandidatesIpv6),(s&&o.justAdded||!i.doRtcpMux)&&l(i.rtcpIceCandidates,2,f.candidates,f.xCandidatesIpv6)),f.candidates.sort(function(e,t){return+e.foundation-+t.foundation||e.foundation===t.foundation&&e.component-t.component}),f.xCandidatesIpv6.sort(function(e,t){return+e.foundation-+t.foundation||e.foundation===t.foundation&&e.component-t.component})),i.dtlsParams)switch(f.fingerprint={type:i.dtlsParams.fingerprints[0].algorithm,hash:i.dtlsParams.fingerprints[0].value},i.dtlsParams.role){case"auto":f.setup="actpass";break;case"client":f.setup="active";break;case"server":f.setup="passive"}return f}function p(e){var n={foundation:e.foundation,priority:e.priority,ip:e.ip,protocol:function(e){var t=e.toLowerCase();switch(t){case"tcp-act":case"tcp-pass":case"tcp-so":return"tcp";default:return t}}(e.transport),port:e.port,type:e.type};return t(e.type,"host")||(n.tcpType=function(e){switch(e.toLowerCase()){case"tcp-act":return"active";case"tcp-pass":return"passive";case"tcp-so":return"so";default:return}}(e.transport),n.relatedAddress=e.raddr,n.relatedPort=e.rport),n}function h(e,t,n){e.candidates&&e.candidates.forEach(function(e){e.component===t&&n.push(p(e))}),e.xCandidatesIpv6&&e.xCandidatesIpv6.forEach(function(e){e.component===t&&n.push(p(e))})}function f(e){var t=e.match(/(\w+):([a-zA-Z0-9+\/]+={0,2})(\|([0-9\^]+))?(\|([0-9]+):([0-9]+))?/);if(t){var n={keyMethod:t[1],keySalt:t[2],mkiValue:0,mkiLength:0};return void 0!==t[4]&&(n.lifetime=t[4]),void 0!==t[7]&&(n.mkiValue=+t[6],n.mkiLength=+t[7]),n}}function g(e,n){var i={},r=[];function o(e,t,n,i){r.push({tag:e,cryptoSuite:t,keyParams:n,sessionParams:i})}if(n.cryptoscale&&n.cryptoscale.forEach(function(e){var n=t(e.flavor,"server")?f(e.config):void 0;n&&o(e.id,"SCALE_"+e.suite,[n],[])}),n.crypto&&n.crypto.forEach(function(e){var t=f(e.config);t&&o(e.id,e.suite,[t],[])}),i.iceParams={usernameFragment:n.iceUfrag,password:n.icePwd},i.sdesParamsList=r,i.iceCandidates=[],h(n,1,i.iceCandidates),i.doRtcpMux=!!n.rtcpMux,n.rtcpMux||(i.rtcpIceParams={usernameFragment:n.iceUfrag,password:n.icePwd},i.rtcpIceCandidates=[],h(n,2,i.rtcpIceCandidates),e.icelite&&(i.rtcpIceParams.iceLite=!0)),n.remoteCandidates&&(i.iceCandidatePair={}),e.fingerprint||n.fingerprint){var a=n.fingerprint?n.fingerprint:e.fingerprint,s="auto";switch(n.setup?n.setup:e.setup){case"actpass":s="auto";break;case"active":s="client";break;case"passive":s="server"}i.dtlsParams={role:s,fingerprints:[{algorithm:a.type,value:a.hash}]}}return e.icelite&&(i.iceParams.iceLite=!0),i}function m(e){e.direction||(e.direction="sendrecv");var t=e.direction.toLowerCase(),n=0!==parseInt(e.port,10);return e.type!==r.default.MEDIA_TYPE.audio&&e.type!==r.default.MEDIA_TYPE.video&&(n=!1),{enabled:n,type:e.type,label:function(){if(n&&!e.label){if(r.default.MEDIA_TYPE.audio===e.type)return r.default.MEDIA_LABEL.audio;if(r.default.MEDIA_TYPE.video===e.type)return r.default.MEDIA_LABEL.video}return e.label}(),mid:e.mid,send:!!n&&("sendrecv"===t||"sendonly"===t),recv:!!n&&("sendrecv"===t||"recvonly"===t)}}function _(t){var n=m(t);if(n.enabled){var i={rtpCaps:function(t){var n=[],i=[];return t.rtp.forEach(function(e){var i={name:e.codec,kind:t.type,clockRate:e.rate,preferredPayloadType:e.payload,numChannels:e.encoding?e.encoding:1,rtcpFeedback:[],parameters:{}};t.type===r.default.MEDIA_TYPE.audio&&(i.ptime=t.ptime,i.maxptime=t.maxptime),t.rtcpFbXMessage&&t.rtcpFbXMessage.length&&t.rtcpFbXMessage.forEach(function(e){"*"!==e.payload&&i.preferredPayloadType!==+e.payload||i.rtcpFeedback.push({type:"x-message",parameter:e.param})}),t.rtcpFb&&t.rtcpFb.length&&t.rtcpFb.forEach(function(e){"*"!==e.payload&&i.preferredPayloadType!==+e.payload||i.rtcpFeedback.push({type:e.type,parameter:e.subtype||""})}),n.push(i)}),t.fmtp&&t.fmtp.forEach(function(e){var t=s.default.build(e.config),i=o.default.getCodecIndexByPayload(e.payload,n);t.names().forEach(function(e){n[i].parameters[e]=t.get(e)})}),t.ext&&t.ext.forEach(function(n){i.push({kind:t.type,uri:e(n.uri,!0),preferredId:n.value})}),{codecs:n,headerExtensions:i,fecMechanisms:[]}}(t),ssrcRange:{min:t.xSsrcRange?t.xSsrcRange.ssrcMin:0,max:t.xSsrcRange?t.xSsrcRange.ssrcMax:0},mid:t.mid||void 0,rtxSsrc:function(e){if(e){var t=a.find(e,function(e){return"FID"===e.semantics});if(t)return+t.ssrcs.split(" ")[1]}return 0}(t.ssrcGroups),rtcpReducedSize:!!t.rtcpRsize};return{descr:m(t),receiver:i,sender:a.deepClone(i)}}var c={rtpCaps:null,ssrcRange:null,rtcpReducedSize:!1};return{descr:n,receiver:c,sender:c}}function v(e){return e&&e.groups?a.find(e.groups,function(e){return"BUNDLE"===e.type}).mids.toString().split(" "):[]}this.paramsToSdp=function(e){var t={},a=e.transportParams[0]||e.transportParams[1]||e.transportParams[2],s=function(e){for(var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority}),n=0;n<t.length;n++)if("host"===t[n].type)return t[n].ip;return"0.0.0.0"}(a),c=u(a)[0];t.groups=o.default.groupsToSdp(e),t.version=0,t.origin={username:"-",sessionId:0,sessionVersion:e.sessionVersion,netType:"IN",ipVer:n(s)?4:6,address:s},t.bandwidth=[{type:"CT",limit:99980}],t.timing={start:0,stop:0},t.name="session",t.connection={version:n(c.ip)?4:6,ip:c.ip},t.xMediaBw={label:r.default.MEDIA_LABEL.video,sendBw:8100,receiveBw:8e3},t.media=[];for(var l=0;l<e.media.length;l++){var p=e.bundled?0:o.default.getTransportIndexById(e.transportParams,e.media[l].descr.transportId),h=e.transportParams[p];t.media.push(d(h,e.media[l],e.isOffer,c,e.bundled,e.groups))}return i.write(t)},this.sdpToParams=function(e){for(var t=i.parse(e),n={sessionVersion:t.origin.sessionVersion,transportParams:[],groups:v(t),bundledOnly:function(e){for(var t=0;t<e.media.length;t++)if(e.media[t].signalingFbXMessage)return!0;var n=v(e);return!(!n||!n[1])&&e.media.some(function(e){return e.mid===n[1]&&(!e.candidates||0===e.candidates.length)})}(t),media:[]},r=0;r<t.media.length;r++){var o=t.media[r],a=_(o);n.media.push(a),a.descr.enabled&&g(t,o).iceCandidates.length>0&&n.transportParams.push(g(t,o))}return n}}},function(e,t,n){"use strict";var i=n(146),r=n(142),o=n(143),a=n(144),s=n(61),c=n(147),l=n(18),u=n(3),d=n(32),p=n(8),h=n(2),f=n(68),g=n(57),m=n(104),_=n(59),v=n(114);function y(e,t,n){var S;this.configureModalitiesAsync=function(e){var t=Y.then(function(){return new Promise(function(t){var n=this;if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters!"+JSON.stringify(e));var i=se(e);B.start(i).catch(function(e){n.logger.log("Error: "+e)});var r=!E||!p.areNegotiatedDirectionsFulfilled(e,U);E=e,r&&ie(),t(E)})});return Y=t.catch(function(e){A.warn("Error during configuring modalities: ",e)}),t},this.getConfiguredModalities=function(){return E},this.processOfferAsync=function(e){return new Promise(function(t){F=!1;var n,i=e.blob;A.debug("PROCESS OFFER","sdp:",i),h.throwIfNotSupported(e.contentType,j),G=e.contentType,D.change(D.HAVE_REMOTE_OFFER),n=w.sdpToParams(i),N.processOffer(n),P=n.transportParams,T=p.invertModalities(l.default.getModalitiesFromMedia(n.media)),t(T)})},this.createAnswerAsync=function(e){if(e)return D.change(D.HAVE_LOCAL_PRANSWER,!0),Promise.resolve({blob:"",contentType:G,modalities:{audio:"sendrecv",video:"sendrecv",sharing:"sendrecv"}});var t;return Promise.resolve().then(function(){if(D.change(D.HAVE_LOCAL_ANSWER,!0),!E)throw new Error("Modalities not configured for answer");C=p.excludePassiveModalities(E,J,T),t=N.createMediaDescriptorsForAnswer(C);var e=se(C);return Promise.all([B.start(e),W.assureInitAsync("controlled",re(t))])}).then(function(){return W.waitIceCompletionIfNeededAsync(P)}).then(function(){return W.getLocalParamsAsync()}).then(function(n){ae(n),Z(t);var i=N.createAnswer(t,n,te(),e);D.complete(),O.callbacks.onTransportInitialized&&O.callbacks.onTransportInitialized();var r=w.paramsToSdp(i);return A.debug(e?"CREATE PRANSWER":"CREATE ANSWER","sdp:",r),{blob:r,contentType:G,modalities:C}})},this.createOfferAsync=function(){return new Promise(function(t){if(F=!0,D.change(D.HAVE_LOCAL_OFFER,!0),C=p.excludePassiveModalities(E,J,T),!T||!T.video||T.video!==u.default.MEDIA_STATE.send&&T.video!==u.default.MEDIA_STATE.sendReceive||E.video!==u.default.MEDIA_STATE.inactive&&E.video!==u.default.MEDIA_STATE.receive||L.forEach(function(e){e.getMediaParameters().descr.label===u.default.MEDIA_LABEL.video&&e.stopSender()}),T=C,p.hasSendDirectionality(C.sharing)&&!e.configProvider.config.ortcOutgoingScreenSharingEnabled)throw new Error("unsupported shreensharing send directionality in _negotiatingModalities "+JSON.stringify(C));var n=N.createMediaDescriptorsForOffer(C),i=W.assureInitAsync("controlling",re(n)).then(function(){return W.getLocalParamsAsync().then(function(e){ae(e),Z(n);var t=N.createOffer(n,e,te());D.complete();var i=w.paramsToSdp(t);return A.debug("CREATE OFFER","sdp:",i),{blob:i,contentType:G,modalities:C}})});t(i)})},this.processAnswerAsync=function(e,t){var n=e.blob;if(A.debug(t?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",n),h.throwIfNotSupported(e.contentType,j),t)return D.change(D.HAVE_REMOTE_PRANSWER),A.log("ignoring provisional answer"),Promise.resolve();var i=w.sdpToParams(n),r=p.invertModalities(l.default.getModalitiesFromMedia(i.media)),o=se(r);return B.start(o).then(function(){return D.change(D.HAVE_REMOTE_ANSWER),N.processAnswer(i),O.callbacks.onTransportInitialized&&O.callbacks.onTransportInitialized(),r})},this.completeNegotiationAsync=function(){return Promise.resolve().then(function(){D.change(D.STABLE,!0);var e=N.completeNegotiation(),t=e.media,n=function(e){var t=arguments[1];if(B.stop(),e)return t;throw t};!function(e){L.forEach(function(t,n){t.setTransportId(e[n].descr.transportId)})}(t);var i=l.default.getModalitiesFromMedia(t);se(i);return W.configureTransportAsync(e,function(e){var t=[];return e.forEach(function(e){e.descr.enabled&&-1===t.indexOf(e.descr.transportId)&&t.push(e.descr.transportId)}),t}(t)).then(function(){!function(){if(de())throw new Error("session is already terminated")}();for(var e=0;e<t.length;e++){var n=void 0,i=void 0;if(L[e]){n=W.getTransportById(L[e].getTransportId());var r=ce(t[e].descr.label);i=B.streams.get(r)}if(t[e].descr.label===u.default.MEDIA_LABEL.audio){var o=L[e].getRecvTrack();L[e].configureChannel(t[e],n,i),L[e].getRecvTrack()&&L[e].getRecvTrack()!==o?V.play(new MediaStream([L[e].getRecvTrack()])):!L[e].getRecvTrack()&&o&&V.stop()}else t[e].descr.label===u.default.MEDIA_LABEL.video?L[e].configureChannel(t[e],n,i):t[e].descr.label===u.default.MEDIA_LABEL.sharing&&L[e].configureChannel(t[e],n,i)}le(),D.complete(),U=l.default.getModalitiesFromMedia(t);var a=p.excludePassiveModalities(E,J,T),s=x||!p.areNegotiatedDirectionsAcceptable(a,C,U);return s&&ie(),A.log("_completeNegotiationAsync: configured:",JSON.stringify(E),"_negotiatingModalities:",JSON.stringify(C),"activeModalities:",JSON.stringify(U)),{isComplete:!s,activeModalities:U,offeredModalities:T,attemptedModalities:C,configuredModalities:E,initiator:F}}).then(n.bind(null,!0),n.bind(null,!1))})},this.rejectNegotiationAsync=function(e,t){return new Promise(function(n){var i=e===u.default.RENEGOTIATION_ERROR.local;D.state=D.STABLE,A.error("negotiation failed","error:",e),t&&(A.log("retrying failed negotiation"),ie()),n({isComplete:i,activeModalities:U,offeredModalities:T,attemptedModalities:C,configuredModalities:E,initiator:F})})},this.createRemoteRenderer=function(e,t){return z.create(e,t)},this.sendDtmf=function(e){var t=ee(L,u.default.MEDIA_LABEL.audio);if(t)return t.sendDtmf(e);return Promise.reject(new Error("no audio channel"))},this.canSendDtmf=function(){var e=ee(L,u.default.MEDIA_LABEL.audio);if(e)return e.canSendDtmf();return!1},this.getLastKnownStats=function(){return{type:"OrtcMediaStats",data:{}}},this.getStatsAsync=ue,this.terminate=function(){return A.log("terminate"),ue().then(function(){D.change(D.TERMINATED),pe()},pe)},this.isReconnectSupported=function(){return e.configProvider.config.enableReconnectEdge},this.muteInputAsync=function(){return he(!0)},this.unmuteInputAsync=function(){return he(!1)},this.setMuteAsync=he,this.muteOutputAsync=function(){return V.muted=!0,e.config.isSpeakerMuted=!0,Promise.resolve()},this.unmuteOutputAsync=function(){return V.muted=!1,e.config.isSpeakerMuted=!1,Promise.resolve()},this._deviceSelectionChanged=function(){A.log("_deviceSelectionChanged");var e=se(U);de()||!e.get(0)&&!e.get(1)||B.restart(e).then(function(){e.get(0)&&B.streams.get(0)&&ee(L,u.default.MEDIA_LABEL.audio).updateLocalMediaStream(B.streams.get(0)),e.get(1)&&B.streams.get(1)&&ee(L,u.default.MEDIA_LABEL.video).updateLocalMediaStream(B.streams.get(1)),B.stop()}).catch(function(e){ne({type:u.default.MEDIA_ERROR.internalError,detail:e}),B.stop()})},this.onContributingSourcesChanged=null,this.callbacks={},this.getExtensionsManager=function(){return X},this.clone=function(i){void 0===i&&(i=!1);var r=h.shallowClone(e);r.config=h.shallowClone(e.config),r.ortcMediaContentType=G,i&&(r.config.isConference=!0);var o=new y(r,t,n);S&&(o.relayManagerProvider=S);return o.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,o},this.setInternals=function(e){e.renderers&&(z&&z.terminate(),(z=e.renderers).reset(),le())},this.move=function(e){e.setInternals({renderers:z}),e.setMuteAsync(b),z=null,this.callbacks.onTerminated=null},this.getAcceptedTypes=function(){return j},this.selectSharingSource=function(e,t){};var E,T,C,I=e.config.iceTransportPolicy?e.config.iceTransportPolicy:u.default.ICE_TRANSPORT_POLICY.all,A=e.getLogger().createChild("ortc"),b=e.config.muted,O=this,R=!e.config.isConference,P=null,N=new o.default(A,e.configProvider,e.config.isConference),w=new a.default,M=!1,k=!1,D=new function(){var e=this;function t(t){throw new Error("Invalid state change:"+e.state+" "+t+" changing: "+e.changing)}this.STABLE="stable",this.NEGOTIATION_REQUESTED="negotiation_requested",this.HAVE_LOCAL_OFFER="have_local_offer",this.HAVE_REMOTE_PRANSWER="have_remote_pranswer",this.HAVE_REMOTE_ANSWER="have_remote_answer",this.HAVE_REMOTE_OFFER="have_remote_offer",this.HAVE_LOCAL_PRANSWER="have_local_pranswer",this.HAVE_LOCAL_ANSWER="have_local_answer",this.TERMINATED="terminated",this.state=e.STABLE,this.changing=!1,this.change=function(n,i){switch(e.busy&&t(n),i&&(e.changing=i),n){case e.STABLE:e.state!==e.HAVE_REMOTE_ANSWER&&e.state!==e.HAVE_LOCAL_ANSWER&&t(n);break;case e.NEGOTIATION_REQUESTED:e.state!==e.STABLE&&t(n);break;case e.HAVE_LOCAL_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_REMOTE_PRANSWER:case e.HAVE_REMOTE_ANSWER:e.state!==e.HAVE_LOCAL_OFFER&&e.state!==e.HAVE_REMOTE_PRANSWER&&t(n);break;case e.HAVE_REMOTE_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_LOCAL_PRANSWER:case e.HAVE_LOCAL_ANSWER:e.state!==e.HAVE_REMOTE_OFFER&&e.state!==e.HAVE_LOCAL_PRANSWER&&t(n);break;case e.TERMINATED:break;default:t(n)}e.state=n},this.complete=function(){e.changing=!1}},L=[],U={},x=!1,F=!1,H={triggerIceReinvite:function(){e.configProvider.config.disableIceReinvite?A.log("ICE-reinvite disabled - triggerIceReinvite skipped"):(A.log("triggerIceReinvite"),ie(!0))},onConnected:function(e){var t=ee(L,u.default.MEDIA_LABEL.audio);t&&t.getTransportId()===e&&(A.log("audio channel transport connected"),O.callbacks.onAudioStateChanged(u.default.STREAMING_STATE.active));O.callbacks.onTransportConnected&&O.callbacks.onTransportConnected()},onError:function(e,t){e.type=e.type||u.default.MEDIA_ERROR.iceConnectionError,e.detail=e.detail||"none";var n=ee(L,u.default.MEDIA_LABEL.audio)||L[0];n&&n.getTransportId()===t&&(A.error("primary transport disconnected, ending call"),ne(e))}},G=e.configProvider.config.ortcMediaContentType,j=e.configProvider.config.ortcAllowedMediaContentType,B=new v.SessionStreamsProvider(A.createChild("SessionStreamsProvider"),e.getDeviceManager());var V=new _.default(A.createChild("AudioRenderer"));e.config.isSpeakerMuted&&(V.muted=!0);var W=new i.default(e.configProvider,A,H,e.config.isRemoteClientLync,I,R),q=Promise.resolve({}),z=c.default.build(e.configProvider,A),K=new s.default,Y=Promise.resolve(),J=e.config.passiveModalities,X=new f.default,Q=new g.ActiveSpeakerManager(n.onContributingSourcesChanged,n.onDominantSpeakerChanged);function $(e){if(e===u.default.MEDIA_TYPE.audio)return d.MediaChannelType.Audio;if(e===u.default.MEDIA_TYPE.video)return d.MediaChannelType.Video;throw new Error("Error in media descriptors descr.type: "+e)}function Z(t){for(var n=0;n<t.length;n++){if(t[n].label!==u.default.MEDIA_LABEL.audio||L[n]){if(t[n].label===u.default.MEDIA_LABEL.video){if(!L[n]){i=A.createChild("VStrm_"+t[n].mediaId+":");L[n]=new r.default(e.configProvider,t[n].mediaId,i,$(t[n].type),t[n].label,O,K,!1)}}else if(t[n].label===u.default.MEDIA_LABEL.sharing&&!L[n]){i=A.createChild("SStrm_"+t[n].mediaId+":");L[n]=new r.default(e.configProvider,t[n].mediaId,i,$(t[n].type),t[n].label,O,K,!0)}}else{var i=A.createChild("AStrm_"+t[n].mediaId+":");L[n]=new r.default(e.configProvider,t[n].mediaId,i,$(t[n].type),t[n].label,O,K,!1)}if(L[n]&&(L[n].setMute(b),L[n].preconfigureChannel(t[n])),L[n]&&L[n].getLabel()!==t[n].label)throw new Error("Error in media descriptors ch.label: "+L[n].getLabel()+" descr.label: "+t[n].label)}}function ee(e,t){for(var n=0;n<e.length;n++)if(e[n].getLabel()===t)return e[n];return null}function te(){for(var e=[],t=0;t<L.length;t++)L[t]&&(e[t]=L[t].getLocalParameters());return e}function ne(e){A.error("Media error occurred","type:",e.type,"detail:",e.detail),O.callbacks.onSessionErrorOccurred&&O.callbacks.onSessionErrorOccurred(e)}function ie(e){D.state!==D.STABLE||D.changing?e&&(x=!0):(D.change(D.NEGOTIATION_REQUESTED),A.log("triggerNegotiation","mods:",JSON.stringify(E),"force:",e),x=!1,O.callbacks.onNegotiationRequired&&O.callbacks.onNegotiationRequired())}function re(e){var t=0;return e.forEach(function(e){e.needsTransport&&t++}),t}function oe(e,t){O.callbacks.onAudioQualityChanged&&O.callbacks.onAudioQualityChanged({type:e,value:t?3:1,isLocalSource:!0,mediaType:0})}function ae(e){if(W.hasIceCandidates(e)==M&&(oe(37,M=!M),M))throw{type:u.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};W.hasIceCandidates(e)&&W.hasRelayIceCandidates(e)==k&&oe(32,k=!k)}function se(e){var t=new Map;return t.set(0,p.hasSendDirectionality(e.audio)),t.set(1,p.hasSendDirectionality(e.video)),t.set(3,p.hasSendDirectionality(e.sharing)),t}function ce(e){switch(e){case u.default.MEDIA_LABEL.audio:return 0;case u.default.MEDIA_LABEL.video:return 1;case u.default.MEDIA_LABEL.sharing:return 3}}function le(){z.update(L.filter(function(e){return u.default.MEDIA_LABEL.video===e.getLabel()||u.default.MEDIA_LABEL.sharing===e.getLabel()}))}function ue(){return de()?q:q=new Promise(function(e){var n={type:"OrtcMediaStats",data:{},localStreams:[{tracks:[]}],remoteStreams:[{tracks:[]}]},i=ee(L,u.default.MEDIA_LABEL.audio),r=ee(L,u.default.MEDIA_LABEL.video),o=ee(L,u.default.MEDIA_LABEL.sharing);i&&i.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:i.getSendTrack()}),r&&r.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:r.getSendTrack()}),o&&o.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:o.getSendTrack()}),i&&i.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:i.getRecvTrack()}),r&&r.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:r.getRecvTrack()}),o&&o.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:o.getRecvTrack()}),Promise.all([i?i.getReportsAsync():{},r?r.getReportsAsync():{},o?o.getReportsAsync():{}]).then(function(i){n.data={CorrelationId:t,mainAudio:i[0],mainVideo:i[1],appsharingVideo:i[2]},e(n)}).catch(function(t){A.error("getting statistics should never fail:",t),e(n)})})}function de(){return D.state===D.TERMINATED}function pe(){X.dispose(),Q.dispose(),W.stop(),V.stop(),z&&z.terminate(),L.forEach(function(e){e.terminate()}),O.callbacks.onTerminated&&O.callbacks.onTerminated(),n=null}function he(e){return b=e,L.forEach(function(t){t.setMute(e)}),Promise.resolve()}Object.defineProperty(this,"relayManagerProvider",{set:function(e){S=e,W.relayManagerProvider=S}}),Q.setStrategy(new m.DSHGeneratingStrategy({configProvider:e.configProvider})),A.log("create session","config:",e.config),this.onError=function(e){ne(e)},this.onMediaCapabilitiesChanged=function(e,t){N.onMediaCapabilitiesChanged(e,t),D.state!==D.HAVE_LOCAL_ANSWER&&ie(!0)},this.onContributingSourcesChanged=function(e){D.state!==D.STABLE||D.changing||Q.onContributingSourcesChanged(e)},this.onAudioQualityChanged=function(e){O.callbacks.onAudioQualityChanged&&O.callbacks.onAudioQualityChanged(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t,n){return new y(e,t,n)}}},function(e,t,n){"use strict";var i=n(3),r=n(2),o=n(18),a=n(13);function s(e,t,n,r,o,s,c){var l,u,d=this,p=new a.SettablePromise;this.nominatedCandidatePair=null,t.log("create RTCIceGatherer","options:",JSON.stringify(o.iceGathererOptions)),this.iceGatherer=s?s.createAssociatedGatherer():new RTCIceGatherer(o.iceGathererOptions),t.log("create RTCIceTransport"),this.iceTransport=c?c.createAssociatedTransport():new RTCIceTransport,this.getLocalCandidatesAsync=function(){return p.promise},this.start=function(e,i){if(u)throw new Error("icetransport already started!");u=!0,l=n.createCb(o.iceRole),t.log("RTCIceTransport setRemoteCandidates","candidates:",JSON.stringify(e)),d.iceTransport.setRemoteCandidates(e),t.log("RTCIceTransport start","remoteIceParams:",JSON.stringify(i),"role:",o.iceRole),d.iceTransport.start(d.iceGatherer,i,o.iceRole),t.log("RTCIceTransport start","role:",d.iceTransport.role)},this.dispose=function(){t.log("dispose"),d.iceTransport.stop(),d.iceTransport=null,d.iceGatherer=null,p.isPending&&p.reject(new Error("operation canceled due to stop")),l&&l.dispose()},this.iceGatherer.onlocalcandidate=function(e){t.log("RTCIceGatherer.onlocalcandidate","candidate:",JSON.stringify(e.candidate)),0===Object.keys(e.candidate).length&&p.resolve()},this.iceGatherer.onerror=function(e){t.error("RTCIceGatherer.onerror","event:",e),p.reject(new Error("IceGatherer failed!"))},this.iceTransport.onicestatechange=function(){d.iceTransport&&(t.log("RTCIceTransport.onicestatechange","state:",d.iceTransport.state),"completed"===d.iceTransport.state?(t.log("pair:",JSON.stringify(d.iceTransport.getNominatedCandidatePair())),d.nominatedCandidatePair=d.iceTransport.getNominatedCandidatePair(),l.iceCompleted(),r.onConnected(e)):"connected"===d.iceTransport.state?r.onConnected(e):"disconnected"===d.iceTransport.state&&(t.error("audio ICE transport disconnected, ending call!"),r.onError({type:i.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},e)))},this.iceTransport.oncandidatepairchange=function(e){t.log("RTCIceTransport.oncandidatepairchange","event:",e)}}var c=0;function l(e,t,n,r,o,a,l){var u,d,p,h,f=this,g=!1;function m(e){var t=e;return(o.iceCandidateType||o.iceCandidateTransport)&&(t=t.filter(function(e){var t=!0,n=!0;return o.iceCandidateType&&(t=e.type.match(new RegExp(o.iceCandidateType),"i")),o.iceCandidateTransport&&(n=e.protocol.match(new RegExp(o.iceCandidateTransport,"i"))),t&&n})),o.iceGathererOptions.gatherPolicy===i.default.ICE_TRANSPORT_POLICY.relay&&t.forEach(function(e){e.relatedAddress=e.ip,e.relatedPort=e.port}),t}this.transportId=c++,u=new s(this.transportId,t.createChild("IceT"),n,r,o),p=new function(e,t,n,r){var o=this,a=!1;this.dtlsTransport=new RTCDtlsTransport(n),this.dtlsTransport.ondtlsstatechange=function(){t.log("RTCDtlsTransport.ondtlsstatechange","state:",event.state,"role:",o.dtlsTransport?o.dtlsTransport.getLocalParameters().role:"")},this.dtlsTransport.onerror=function(n){t.error("RTCDtlsTransport.onerror","event:",n),r.onError({type:i.default.MEDIA_ERROR.srtpError,detail:n},e)},this.startAsync=function(e){if(a)throw new Error("dtlstransport already started!");return a=!0,t.log("RTCDtlsTransport.start","params:",JSON.stringify(e)),o.dtlsTransport.start(e),Promise.resolve()},this.dispose=function(){a&&o.dtlsTransport.stop(),o.dtlsTransport=null}}(this.transportId,t.createChild("DtlsT"),u.iceTransport,r),a&&(d=new s(this.transportId,t.createChild("RtcpIceT"),n,r,o,u.iceGatherer,u.iceTransport)),Object.defineProperty(this,"transport",{get:function(){return!e.config.disableSdes&&h?h:p?p.dtlsTransport:null}}),this.isStarted=function(){return g},this.getLocalParamsAsync=function(){return(d?Promise.all([u.getLocalCandidatesAsync(),d.getLocalCandidatesAsync()]):u.getLocalCandidatesAsync()).then(function(){return{transportId:f.transportId,iceParams:u.iceGatherer.getLocalParameters(),iceCandidates:m(u.iceGatherer.getLocalCandidates()),iceCandidatePair:u.nominatedCandidatePair,sdesParamsList:l,dtlsParams:p?p.dtlsTransport.getLocalParameters():null,rtcpIceParams:d?d.iceGatherer.getLocalParameters():null,rtcpIceCandidates:d?m(d.iceGatherer.getLocalCandidates()):null,rtcpIceCandidatePair:d?d.nominatedCandidatePair:null}})},this.startAsync=function(e){if(g)throw new Error("mediaTransport already started!");var n=Promise.resolve();return g=!0,u.start(e.iceCandidates,e.iceParams),d&&(e.doRtcpMux?(d.dispose(),d=null):d.start(e.rtcpIceCandidates,e.rtcpIceParams)),e.enableDtls?n=p.startAsync(e.dtlsParams):h||(t.debug("RTCSrtpSdesTransport","local:",JSON.stringify(e.sdesParamsList[0]),"remote:",JSON.stringify(e.remoteSdesParams)),(h=new RTCSrtpSdesTransport(u.iceTransport,e.sdesParamsList[0],e.remoteSdesParams)).onerror=function(e){t.log("RTCSrtpSdesTransport.onerror","event:",e),r.onError({type:i.default.MEDIA_ERROR.srtpError,detail:e},f.transportId)}),n},this.dispose=function(){t.log("dispose"),u.dispose(),u=null,d&&(d.dispose(),d=null),p&&(p.dispose(),p=null)}}function u(e,t){var n=[],i=!1,o=new a.SettablePromise,s=0;this.createCb=function(c){var l=new function(a){this.dispose=function(){r.remove(n,function(e){return e===this})},this.gotCallback=!1,this.iceCompleted=function(){this.gotCallback=!0,this.gotCallbackFromControlling="controlling"===a;for(var r=0,c=0,l=0;l<n.length;l++)n[l].gotCallback&&r++,n[l].gotCallbackFromControlling&&c++;c&&c===s&&!i&&(e.log("IceCompletionMonitor REINVITE"),i=!0,t.triggerIceReinvite()),r&&r===n.length&&(e.log("IceCompletionMonitor ALL COMPLETE"),o.resolve())}}(c);return n.push(l),"controlling"===c&&(i=!1,s++),o.reject(void 0),o=new a.SettablePromise,l},this.waitAllCallbacksAsync=function(){return o.promise}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,a,s){var c,d=this,p=[],h=(a=a||i.default.ICE_TRANSPORT_POLICY.all,new u(t,n)),f=null;this.relayManagerProvider=null,e.config.disableSdes||(f=RTCSrtpSdesTransport.getLocalParameters().filter(function(e){return"SCALE_AES_CM_128_HMAC_SHA1_80"!==e.cryptoSuite})),this.getTransportById=function(e){return p[o.default.getTransportIndexById(p,e)]},this.assureInitAsync=function(i,o){return new Promise(function(u){t.log("assureInitAsync",o),u(function(){if(!c){if(!d.relayManagerProvider)throw new Error("relay manager provider is not set!");c=d.relayManagerProvider.getRelayManager().queryRelaysAsync("msturn",r)}return c}().then(function(r){for(var c,u={iceRole:i,iceCandidateType:e.config.iceCandidateType,iceCandidateTransport:e.config.iceCandidateTransport,iceGathererOptions:{gatherPolicy:a,iceServers:function(e){return e.reduce(function(e,t){return t.addresses.map(function(n){e.push({urls:t.type+":"+n+":"+t.udpPort+"?transport=udp",credential:t.password,username:t.username}),e.push({urls:t.type+":"+n+":"+t.tcpPort+"?transport=tcp",credential:t.password,username:t.username})}),e},[])}(r)}},d=p.length;d<o;d++){t.log("assureInitAsync "+d+u.iceRole),e.config.mediaPortRanges&&(u.iceGathererOptions.portRange=(c=e.config.mediaPortRanges,0===d?{min:c.audioMin,max:c.audioMax}:{min:c.videoMin,max:c.videoMax}));var g={onError:n.onError,onConnected:n.onConnected},m=new l(e,t.createChild("MT"+d),h,g,u,s,f);p.push(m)}}))})},this.getLocalParamsAsync=function(){return t.log("getLocalParamsAsync"),new Promise(function(e){var t=p.map(function(e){return e.getLocalParamsAsync()});e(Promise.all(t))})},this.hasIceCandidates=function(e){return e.some(function(e){return!!e.iceCandidates&&e.iceCandidates.length>0})},this.hasRelayIceCandidates=function(e){return this.hasIceCandidates(e)&&e.some(function(e){return!!e.iceCandidates&&e.iceCandidates.some(function(e){return"relay"===e.type})})},this.waitIceCompletionIfNeededAsync=function(e){return new Promise(function(n){var i="";(e[0]&&e[0].iceCandidatePair||e[1]&&e[1].iceCandidatePair)&&(t.log("waiting ICE completed state!"),i=h.waitAllCallbacksAsync()),n(i)})},this.configureTransportAsync=function(e,t){return new Promise(function(n){var i=[],r=e.transportParams;p=p.filter(function(e){return-1!==t.findIndex(function(t){return t===e.transportId})?(e.isStarted()||i.push(e.startAsync(function(e,t){return e.find(function(e){return e.transportId===t})}(r,e.transportId))),!0):(e.dispose(),!1)}),n(Promise.all(i))})},this.stop=function(){p.forEach(function(e){e.dispose()}),p=[]}}},function(e,t,n){"use strict";var i=n(30),r=n(2),o=n(3),a=n(60),s=n(5),c=n(13),l=1e3;function u(e,t){t=t.createChild("OrtcVideoRendererGroup");var n=[],u=[],d=s.default.window;function p(s,p){i.default.call(this,s);var h,f,g,m,_=this,v=this.dispose.bind(this),y=!1,S=new c.SettablePromise;this.onSizeChanged(function(e,t){e&&t&&T(),p&&p.onVideoSizeChanged&&p.onVideoSizeChanged(e,t)}),this.onError(p?p.onError:null),this.updateRecvTrack=function(e,n){if(n!==function(){var e=_.getMediaStream();return e?e.getVideoTracks()[0]:null}()){var i=n?new MediaStream([n]):null;t.log("updating renderer media stream to",i),_.attachMediaStream(i),f!==e&&(f=e,t.log("renderer subscribed msi updated to",e))}};var E=this.attachMediaStream.bind(this);function T(){m&&(t.log("stopping video tag periodic refresh"),d.clearInterval(m),m=null)}function C(){h&&(h.remove(_),h=void 0),f=void 0}function I(e,t){return r.find(n,function(n){return n.rendererType===e&&n.msi===t})}this.attachMediaStream=function(n){return e.config.ortcVideoRendererAggressiveStreamRefresh&&(n?m||(t.log("starting video tag periodic refresh"),m=d.setInterval(function(){_.getVideoElement().play()},l)):T()),E(n)},this.subscribeVideoAsync=function(i,s){i=i||o.default.MSI.subscribeAny;var l=s?o.default.RENDERER_TYPE.sharing:o.default.RENDERER_TYPE.video;return t.info("subscribing renderer to type:",l,"msi:",i),new Promise(function(s){if(!y){var d=f!==i;d&&C(),S.isPending&&(S.resolve(),S=new c.SettablePromise),i!==o.default.MSI.unsubscribe&&d?(function(e,t){if(!I(e,t)){var i,a=new c.SettablePromise,s=[],l=!1,d=function(){l||(s=[],a.isPending&&a.reject(new Error("disposing renderer")),i&&i.unsubscribe(),r.remove(n,function(n){return n.rendererType===e&&n.msi===t}),l=!0,n.forEach(function(e){e.update()}))},p=function(){if(a.isPending){var n=function(e){return r.find(u,function(t){return t.canSubscribe()&&t.label===function(e){switch(e){case o.default.MODALITY.video:return o.default.MEDIA_LABEL.video;case o.default.MODALITY.sharing:return o.default.MEDIA_LABEL.sharing}}(e)})}(e);n&&(n.subscribe(t),i=n,a.resolve())}if(i){var c=i.getRecvTrack();s.forEach(function(e){e.updateRecvTrack(t,c)})}};n.push({rendererType:e,msi:t,add:function(e,t){a.promise.then(t.resolve,t.reject),s.push(e),p()},remove:function(e){r.remove(s,function(t){return t===e}),0===s.length&&d()},getChannel:function(){return i},update:p,dispose:d,reset:function(){a=new c.SettablePromise}})}(h=I(e,t)).add(_,S)}(l,i),function(){if(!e.config.ortcVideoCapabilityCheckIntervalMin||!e.config.ortcVideoCapabilityCheckIntervalMax)return void t.info("skipping video size tracking");if(g)return;(g=new a.default(_.getVideoElement(),{interval:{min:e.config.ortcVideoCapabilityCheckIntervalMin,max:e.config.ortcVideoCapabilityCheckIntervalMax}})).onSizeChange(function(e,n){t.info("video renderer size changed, updating capabilities"),h.getChannel()&&h.getChannel().videoSizeChanged(e,n)})}()):S.resolve()}s(S.promise)})},this.dispose=function(){t.debug("disposing remote renderer"),g&&(g.dispose(),g=null),T(),C(),S.isPending&&S.reject(new Error("disposing renderer")),y=!0,v()}}this.create=function(e,t){return new p(e,t)},this.reset=function(){n.forEach(function(e){e.reset()})},this.update=function(e){u=e,n.forEach(function(e){e.update()})},this.terminate=function(){n.forEach(function(e){e.dispose()})},p.prototype=Object.create(i.default.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t){return new u(e,t)}}},function(e,t,n){"use strict";var i=n(2);Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new function(){var e;this.process=function(t){return e||(e=t||i.uniqueId().toUpperCase()),e}}}}},function(e,t,n){"use strict";var i=n(2),r=n(8),o=function(){function e(){this.startTime=0,this.elapsed=0,this._count=0}return e.prototype.start=function(){this.startTime||(this.startTime=Date.now(),this._count++)},e.prototype.stop=function(){this.startTime&&(this.elapsed+=Date.now()-this.startTime,this.startTime=0)},e.prototype.isRunning=function(){return!!this.startTime},e.prototype.getElapsed=function(){return this.startTime?this.elapsed+Date.now()-this.startTime:this.elapsed},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e}(),a=function(){function e(e){void 0===e&&(e=1),this.stopWatches=[],this.currentLevel=e,this.getStopWatch(e).start()}return e.prototype.updateLevel=function(e){this.currentLevel!==e&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=e,this.getStopWatch(this.currentLevel).start())},e.prototype.getCount=function(e){var t=this.stopWatches[e];return t?t.count:0},e.prototype.getElapsed=function(e){var t=this.stopWatches[e];return t?t.getElapsed():0},e.prototype.getStopWatch=function(e){var t=this.stopWatches[e];return t||(t=new o,this.stopWatches[e]=t),t},e}(),s=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\:[0-9]{2,5})?$/),c=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),l=RegExp(/^\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\](\:[0-9]{2,5})$/),u=function(){function e(){this.negotiation={offering:this.offering(),answering:this.answering(),current:this.current()},this.creationTime=Date.now(),this.negotiationCount=0,this.initialNegotiationCompleted=!1,this.multiParty=!1,this.noIceCandidatesGoodEventCount=0,this.noIceCandidatesBadEventCount=0,this.noRelayIceCandidatesGoodEventCount=0,this.noRelayIceCandidatesBadEventCount=0,this.cameraInUseBadEventCount=0,this.cameraInUseGoodEventCount=0,this.microphoneInUseBadEventCount=0,this.microphoneInUseGoodEventCount=0,this.networkRecv=new a,this.networkSend=new a,this.retargetIncomingCount=0,this.retargetOutgoingCount=0,this.retargetCompletedCount=0,this.retargetRejectedCount=0,this.reconnectAttemptedCount=0,this.reconnectConnectedCount=0,this.escalationAttemptedCount=0,this.escalationCompletedCount=0,this.escalationRejectedCount=0,this.screenSharingIncomingDecoderFailureCount=0,this.screenSharingIncomingDecoderActiveCount=0,this.screenSharingIncomingDecoderResetCount=0,this.duration=0,this.terminationTime=0,this.sessionId="0",this.rejectedNegotiationCount=0,this.mediaError={type:"none",detail:"none"},this.dtmfSuccess=0,this.dtmfFailure=0,this.relay=null,this.relayManagerTimers=null,this.allowedAudioSend=!1,this.allowedVideoSend=!1,this.allowedScreensharingSend=!1,this.iceInitTime=0,this.finalAnswerTime=0,this.iceConnectedStateTime=0,this.usedDevices=null,this.deviceSelectionChangeCount=0,this.devicesChangeCount=0,this.devicesPollChangeCount=0,this.mute=new o,this.osMute=new o,this.hwSilent=new o,this.swMute=new o,this.speakerMute=new o,this.deviceTelemetryEvents=[]}return e.prototype.terminated=function(){this.terminationTime=(new Date).getTime(),this.duration=this.terminationTime-this.creationTime,this.osMute.stop(),this.swMute.stop(),this.hwSilent.stop(),this.mute.stop(),this.speakerMute.stop()},e.prototype.setMultiParty=function(){this.multiParty=!0},e.prototype.updateCommonMute=function(){this.swMute.isRunning()||this.osMute.isRunning()?this.mute.start():this.swMute.isRunning()||this.osMute.isRunning()||this.mute.stop()},e.prototype.setSwMute=function(e){e?this.swMute.start():this.swMute.stop(),this.updateCommonMute()},e.prototype.setSpeakerMute=function(e){e?this.speakerMute.start():this.speakerMute.stop()},e.prototype.setHwSilent=function(e){e?this.hwSilent.start():this.hwSilent.stop()},e.prototype.setETag=function(e){this.ETag=e},e.prototype.registerQualityStateChangedEvent=function(e){switch(e.type){case 37:1===e.value?this.noIceCandidatesGoodEventCount++:this.noIceCandidatesBadEventCount++;break;case 32:1===e.value?this.noRelayIceCandidatesGoodEventCount++:this.noRelayIceCandidatesBadEventCount++;break;case 39:1===e.value?this.microphoneInUseGoodEventCount++:this.microphoneInUseBadEventCount++;break;case 33:1===e.value?this.cameraInUseGoodEventCount++:this.cameraInUseBadEventCount++;break;case 25:3===e.value?this.osMute.start():this.osMute.stop(),this.updateCommonMute();break;case 2:this.networkRecv.updateLevel(e.value);break;case 1:this.networkSend.updateLevel(e.value)}},e.prototype.registerRetargetIncoming=function(){this.retargetIncomingCount++},e.prototype.registerRetargetOutgoing=function(){this.retargetOutgoingCount++},e.prototype.registerRetargetCompleted=function(){this.retargetCompletedCount++},e.prototype.registerRetargetRejected=function(){this.retargetRejectedCount++},e.prototype.registerEscalationStart=function(){this.escalationAttemptedCount++},e.prototype.registerEscalationCompleted=function(){this.escalationCompletedCount++},e.prototype.registerEscalationRejected=function(){this.escalationRejectedCount++},e.prototype.registerReconnectAttempted=function(){this.reconnectAttemptedCount++},e.prototype.registerReconnectConnected=function(){this.reconnectConnectedCount++},e.prototype.registerSSIncomingDecoderFailed=function(){this.screenSharingIncomingDecoderFailureCount++},e.prototype.registerSSIncomingDecoderActive=function(){this.screenSharingIncomingDecoderActiveCount++},e.prototype.registerSSIncomingDecoderReset=function(){this.screenSharingIncomingDecoderResetCount++},e.prototype.registerDeviceTelemetryEvent=function(e){e.timestamp=e.timestamp-this.creationTime,this.deviceTelemetryEvents.push(e)},e.prototype.setMediaLegId=function(e){this.mediaLegId=e},e.prototype.setId=function(e){this.sessionId=e},e.prototype.setError=function(e){this.mediaError.type=e.type||"internalError",this.mediaError.detail=e.detail||e.toString()},e.prototype.setRelay=function(e){this.relay={address:e.addresses[0],expires:e.expires,realm:e.realm,credentials:!(!e.username||!e.password),ports:[e.udpPort?"udp:"+e.udpPort:"",e.tcpPort?"tcp:"+e.tcpPort:"",e.tlsPort?"tls:"+e.tlsPort:""].join(",")}},e.prototype.setRelayManagerTimers=function(e){this.relayManagerTimers=e},e.prototype.setSendModalities=function(e){this.allowedAudioSend=e.audio.some(function(e){return r.hasSendDirectionality(e)}),this.allowedVideoSend=e.video.some(function(e){return r.hasSendDirectionality(e)}),this.allowedScreensharingSend=e.sharing.some(function(e){return r.hasSendDirectionality(e)})},e.prototype.setIceInitTimestamp=function(e){this.iceInitTime||(this.iceInitTime=e)},e.prototype.setFinalAnswerTimestamp=function(e){this.finalAnswerTime||(this.finalAnswerTime=e)},e.prototype.setIceConnectedStateTimestamp=function(e){this.iceConnectedStateTime||(this.iceConnectedStateTime=e)},e.prototype.dtmfResult=function(e){e?++this.dtmfSuccess:++this.dtmfFailure},e.prototype.setUsedDevices=function(e){this.usedDevices&&!i.weakCompareObject(e,this.usedDevices)&&this.deviceSelectionChangeCount++,this.usedDevices=e},e.prototype.devicesChanged=function(){this.devicesChangeCount++},e.prototype.deviceChangedByPoll=function(){this.devicesPollChangeCount++},e.prototype.getReport=function(){var e=this.usedDevices||{microphone:"none",speaker:"none",camera:"none"};return{CorrelationId:this.sessionId,CallNumber:0,NoIceCandidatesBadEventCount:this.noIceCandidatesBadEventCount,NoIceCandidatesGoodEventCount:this.noIceCandidatesGoodEventCount,NoRelayIceCandidatesBadEventCount:this.noRelayIceCandidatesBadEventCount,NoRelayIceCandidatesGoodEventCount:this.noRelayIceCandidatesGoodEventCount,CameraInUseBadEventCount:this.cameraInUseBadEventCount,CameraInUseGoodEventCount:this.cameraInUseGoodEventCount,MicrophoneInUseBadEventCount:this.microphoneInUseBadEventCount,MicrophoneInUseGoodEventCount:this.microphoneInUseGoodEventCount,RetargetIncomingCount:this.retargetIncomingCount,RetargetOutgoingCount:this.retargetOutgoingCount,RetargetCompletedCount:this.retargetCompletedCount,RetargetRejectedCount:this.retargetRejectedCount,ReconnectAttemptedCount:this.reconnectAttemptedCount,ReconnectConnectedCount:this.reconnectConnectedCount,EscalationAttemptedCount:this.escalationAttemptedCount,EscalationCompletedCount:this.escalationCompletedCount,EscalationRejectedCount:this.escalationRejectedCount,ScreenSharingIncomingDecoderFailureCount:this.screenSharingIncomingDecoderFailureCount,ScreenSharingIncomingDecoderFailureRecoverDelta:this.screenSharingIncomingDecoderFailureCount-this.screenSharingIncomingDecoderActiveCount,ScreenSharingIncomingDecoderResetCount:this.screenSharingIncomingDecoderResetCount,CreationTime:this.getHpTimeFromMillis(this.creationTime),InitTime:this.getHpTimeFromMillis(this.creationTime),TerminationTime:this.getHpTimeFromMillis(this.terminationTime),CallDuration:this.getHpTimeFromMillis(this.duration),InitialNegotiationType:this.initialNegotiationType||"none",InitialNegotiationCompleted:this.initialNegotiationCompleted,NegotiationCount:this.negotiationCount,RejectedNegotiationCount:this.rejectedNegotiationCount,MediaLegId:this.mediaLegId,MultiParty:this.multiParty,ErrorType:this.mediaError.type,ErrorDetail:this.mediaError.detail,DtmfSuccess:this.dtmfSuccess,DtmfFailure:this.dtmfFailure,Relay:this.relay?JSON.stringify(this.relay):"none",RelayManager:this.relayManagerTimers?JSON.stringify(this.relayManagerTimers):"none",AllowedAudioSend:this.allowedAudioSend,AllowedVideoSend:this.allowedVideoSend,AllowedScreensharingSend:this.allowedScreensharingSend,IceInitTime:this.getHpTimeFromMillis(this.iceInitTime),FinalAnswerTime:this.getHpTimeFromMillis(this.finalAnswerTime),IceConnectedStateTime:this.getHpTimeFromMillis(this.iceConnectedStateTime),UsedMicrophone:e.microphone,UsedSpeaker:e.speaker,UsedCamera:e.camera,DeviceSelectionChangeCount:this.deviceSelectionChangeCount,DevicesChangeCount:this.devicesChangeCount,DevicesPollChangeCount:this.devicesPollChangeCount,ETag:this.ETag||"",CallMutedRatio:this.duration>0?this.mute.getElapsed()/this.duration:0,CallOsMuted:this.getHpTimeFromMillis(this.osMute.getElapsed()),CallHwSilent:this.getHpTimeFromMillis(this.hwSilent.getElapsed()),CallSwMuted:this.getHpTimeFromMillis(this.swMute.getElapsed()),CallSpeakerMuted:this.getHpTimeFromMillis(this.speakerMute.getElapsed()),NetworkRecvGood:this.networkRecv.getCount(1)-1,NetworkRecvPoor:this.networkRecv.getCount(2),NetworkRecvBad:this.networkRecv.getCount(3),NetworkSendGood:this.networkSend.getCount(1)-1,NetworkSendPoor:this.networkSend.getCount(2),NetworkSendBad:this.networkSend.getCount(3),NetworkRecvGoodRatio:this.duration>0?this.networkRecv.getElapsed(1)/this.duration:0,NetworkRecvPoorRatio:this.duration>0?this.networkRecv.getElapsed(2)/this.duration:0,NetworkRecvBadRatio:this.duration>0?this.networkRecv.getElapsed(3)/this.duration:0,NetworkSendGoodRatio:this.duration>0?this.networkSend.getElapsed(1)/this.duration:0,NetworkSendPoorRatio:this.duration>0?this.networkSend.getElapsed(2)/this.duration:0,NetworkSendBadRatio:this.duration>0?this.networkSend.getElapsed(3)/this.duration:0,DeviceEvents:JSON.stringify(this.deviceTelemetryEvents)}},e.prototype.generateStatistics=function(e,t){var n=this;if(this.setMediaLegId(t.process()),"OrtcMediaStats"!==e.type&&"WebRtcMediaStats"!==e.type)throw new Error("Unknown stats type - "+e.type);return e.data.metrics=this.getReport(),i.forOwnRec(e.data,function(e,t,i){i[t]=n.addPiiToStatsValue(e)}),e},e.prototype.addPiiToStatsValue=function(e){var t=0;return s.test(e)?t=13:(c.test(e)||l.test(e))&&(t=4),{type:t,value:e,__VALUE__:!0}},e.prototype.offering=function(){var e=this;return{started:function(){e.currentNegotiationType="Offering",e.negotiationStarted()}}},e.prototype.answering=function(){var e=this;return{started:function(){e.currentNegotiationType="Answering",e.negotiationStarted()}}},e.prototype.negotiationStarted=function(){this.initialNegotiationType=this.initialNegotiationType||this.currentNegotiationType,++this.negotiationCount},e.prototype.current=function(){var e=this;return{completed:function(){1===e.negotiationCount&&(e.initialNegotiationCompleted=!0)},rejected:function(){++e.rejectedNegotiationCount}}},e.prototype.getHpTimeFromMillis=function(e){return 1e4*e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=u},function(e,t,n){"use strict";var i=function(){function e(){this.eventCount=0,this.eventValuesSummary=null,this.i=10}return e.prototype.getResult=function(){if(this.eventCount>0&&this.eventValuesSummary)return this.eventValuesSummary/this.eventCount},e.prototype.updateEventValue=function(e){null!==e&&(0===e&&this.i<10||e>0)&&(this.eventCount+=1,this.i=e>0?0:this.i+1,this.eventValuesSummary=this.eventValuesSummary?this.eventValuesSummary+e:e)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";var i=n(153),r=n(152),o=n(174),a=n(5),s=function(){function e(e){this._gatherer=new r.default(e)}return e.prototype.getCapabilities=function(e){return this._gatherer.getGatherer()(e)},e}(),c=function(){return function(e){this.SdpTransform=o.default,this.RTCPeerConnection=i.default,this.RTCSessionDescription=a.default.window.RTCSessionDescription,this.RTCRtpReceiver=new s(e)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},function(e,t,n){"use strict";var i=n(11),r=n(5),o=function(){function e(e){this.selfGlobal=e.global.mozCapabilityGatherer=e.global.mozCapabilityGatherer||{},this.getGatherer()("video")}return e.prototype.getGatherer=function(){var e=this;return function(t){return"video"!==t&&"audio"!==t?Promise.reject(new Error("capabilities for "+t+" are not supported")):(e.selfGlobal.gatherTask||(e.selfGlobal.gatherTask=new Promise(function(t,n){var o=new r.default.window.RTCPeerConnection(null);o.createOffer(function(e){var n={};return i.parse(e.sdp).media.forEach(function(e){n[e.type]=e.rtp.map(function(e){return{mimeType:e.codec.toLowerCase()}})}),o.close(),t(n)},function(t){e.selfGlobal.gatherTask=null,o.close(),n(t)},{offerToReceiveVideo:1,offerToReceiveAudio:1})})),e.selfGlobal.gatherTask.then(function(e){return{codecs:e[t]}}))}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(11),r=n(5);var o=function(){function e(e){return this.peerConnection=new r.default.window.RTCPeerConnection(e),this.shim(),this.peerConnection}return e.prototype.shim=function(){this.shimSetRemoteDescription(),this.shimStats()},e.prototype.shimStats=function(){var e=this,t=this.peerConnection.getStats;this.peerConnection.getStats=function(n,i){t.apply(e.peerConnection,null).then(n).catch(i)}},e.prototype.shimSetRemoteDescription=function(){var e=this,t=this.peerConnection.setRemoteDescription;this.peerConnection.setRemoteDescription=function(n){var o,a,s=i.parse(n.sdp);return s.media.forEach(function(e,t){0===t?(o=e.iceUfrag,a=e.icePwd):void 0!==o&&void 0!==a&&(e.iceUfrag=o,e.icePwd=a),function(e){var t,n;"video"==e.type&&e.fmtp&&0!=e.fmtp.length&&(e.fmtp[0].config=(t=e.fmtp[0].config,n=["max-mbps","max-br"],t.split(";").filter(function(e){return!n.some(function(t){return e.indexOf(t)>-1})}).join(";")))}(e)}),n=new r.default.window.RTCSessionDescription({type:n.type,sdp:i.write(s)}),t.call(e.peerConnection,n)}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(157),r=n(69),o=n(155),a=n(178),s=function(){return function(e){var t=o.default.build(e);this.SdpTransform=a.WebkitSdpTransform,this.RTCPeerConnection=i.default.build(t),this.RTCRtpReceiver={getCapabilities:t.gather},this.RTCSessionDescription=r.default.build()}}();t.WebkitAdapter=s},function(e,t,n){"use strict";var i=n(11),r=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new function(e){var t,n=this,o=r.default.window.webkitRTCPeerConnection;this.gather=function(e){return"video"!==e&&"audio"!==e?Promise.reject(new Error("capabilities for "+e+" are not supported")):(t.gatherTask||(t.gatherTask=new Promise(function(e,n){var r=new o(null);r.createOffer(function(t){var n={};return i.parse(t.sdp).media.forEach(function(e){n[e.type]=e.rtp.map(function(e){return{mimeType:e.codec.toLowerCase()}})}),r.close(),e(n)},function(e){t.gatherTask=null,r.close(),n(e)},{offerToReceiveVideo:1,offerToReceiveAudio:1})})),t.gatherTask.then(function(t){return{codecs:t[e]}}))},t=e.global.webkitCapabilityGatherer=e.global.webkitCapabilityGatherer||{},n.gather("video")}(e)}}},function(e,t,n){"use strict";var i=n(3),r=n(2),o=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};return e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==i.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId=e.audio.deviceId)),e.video&&(t.video={mandatory:{}},e.video.deviceId&&(t.video.mandatory.sourceId=e.video.deviceId),e.video.minWidth&&(t.video.mandatory.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.mandatory.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.mandatory.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.mandatory.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.mandatory.maxFrameRate=e.video.fps),r.isEmpty(t.video.mandatory)&&delete t.video.mandatory),t},e}();t.WebKitConstraintsAdapter=o},function(e,t,n){"use strict";var i=n(11),r=n(15),o=n(16),a=n(69),s=n(5),c=n(2),l=[{name:"telephone-event",rate:8e3},{name:"cn",rate:16e3}];function u(e){var t,n,u,d,p,h,f,g,m,_=[];function v(e){return"RTP/SAVPF"!==e.protocol}return d=a.default.build(),(t=[].slice.apply(arguments)).splice(0,1,null),p="iceTransportPolicy",h="iceTransports",t[1]&&t[1][p]&&(t[1][h]=t[1][p]),n=new(Function.prototype.bind.apply(s.default.window.webkitRTCPeerConnection,t)),[{name:"createOffer",reverseArgs:!0},"createAnswer","setRemoteDescription","setLocalDescription"].forEach(function(e){var t=e.name||e,i=n[t];n[t]=function(){var t=arguments;return new Promise(function(r,o){var a=[r,o];t.length>0&&a.splice(e.reverseArgs?a.length:0,0,t[0]),i.apply(n,a)})}}),function(){["createOffer","createAnswer","setLocalDescription"].forEach(function(t){var i=n[t];n[t]=function(){var t=arguments;return e.gather("video").then(function(){return i.apply(i,t)})}});var t=n.setRemoteDescription;n.setRemoteDescription=function(n){return e.gather("video").then(function(e){var a=e.codecs,s=i.parse(n.sdp);return s.media.forEach(function(e){if("video"===e.type){var t=e.rtp.some(function(e){return a.some(function(t){return e.codec.toLowerCase()===t.mimeType})});t?function(e){r.forCodec(e,{name:"h264",rate:9e4},function(e){if(e.fmtp){var t=o.default.build(),n=o.default.build(e.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach(function(e){if(n.contains(e)){var i=n.get(e);"profile-level-id"==e&&(i="42C02A"),t.setIfMissing(e,i)}}),e.fmtp.config=t.toString()}})}(e):e.port=0}if(!v(e)){var n=r.getBundle(s);n?e.crypto=n.crypto:e.port||s.media.some(function(t){return!!t.port&&(e.crypto=t.crypto,!0)})}}),n.sdp=i.write(s),t(n)})}}(),m=n.setLocalDescription,n.setLocalDescription=function(e){return"rollback"===e.type?"have-local-offer"===n.signalingState?function(){if(!u||!n.remoteDescription||!n.remoteDescription.sdp)return Promise.reject(new Error("rollback requires having both remote and local descriptions set"));var e=i.parse(n.remoteDescription.sdp),t=i.parse(u.sdp);e.media.forEach(function(e,n){v(e)&&(t.media[n]&&t.media[n].setup&&"actpass"!==t.media[n].setup&&(e.setup="active"===t.media[n].setup?"passive":"active"),e.crypto&&delete e.crypto)});var r=new d({type:"answer",sdp:i.write(e)});return t.media.forEach(function(e){e.setup&&(e.setup="actpass")}),m(new d({type:u.type,sdp:i.write(t)})).then(function(){return n.setRemoteDescription(r)})}():Promise.reject(new Error("rollback is supported only from have-local-offer state")):("stable"===n.signalingState&&n.localDescription&&n.localDescription.sdp&&(u=new d({type:"offer",sdp:n.localDescription.sdp})),m(e))},g=n.createAnswer,n.createAnswer=function(){var e=arguments;return g.apply(n,e).then(function(e){if(!n.localDescription||!n.localDescription.sdp)return e;var t=i.parse(n.localDescription.sdp),o=[];if(t.media.forEach(function(e){l.forEach(function(t){r.forCodec(e,t,function(e){o.push(e)})})}),o.length){var a=i.parse(e.sdp),s=!1;a.media.forEach(function(e){o.forEach(function(t){r.forCodec(e,{name:t.rtp.codec,rate:t.rtp.rate},function(e){e.rtp.payload!==t.rtp.payload&&(e.rtp.payload=t.rtp.payload,s=!0)})})}),s&&(e=new d({type:e.type,sdp:i.write(a)}))}return e})},f=n.createOffer,n.createOffer=function(e){var t=arguments;return e&&e.offerToReceiveVideo>1&&(e.offerToReceiveVideo=1),f.apply(n,t).then(function(e){var t=i.parse(e.sdp);return t.media.filter(function(e){return"audio"==e.type}).forEach(function(e){r.removeCodec(e,{codec:"CN",rate:16e3})}),new d({type:e.type,sdp:i.write(t)})})},n.getSenders&&n.addTrack&&n.removeTrack&&!(n.getLocalStreams&&n.addStream&&n.removeStream&&n.createDTMFSender)||(n.getSenders=function(){return _.slice()},n.addTrack=function(e,t){if(!e||!t)throw new Error("both media track and stream need to be provided");var i=n.getLocalStreams().some(function(e){return e.id===t.id});i||n.addStream(t);var r=c.find(_,function(t){return t.track.id===e.id});return r||(r=new function(e,t){var i;Object.defineProperty(this,"dtmf",{get:function(){return"audio"===e.kind?i=i||n.createDTMFSender(e):null}}),this.track=e,this._stream=t}(e,t),_.push(r)),r},n.removeTrack=function(e){n.getLocalStreams().filter(function(t){return t.id===e._stream.id}).forEach(function(e){n.removeStream(e)}),c.remove(_,function(t){return t===e})}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return u.bind(null,e)}}},function(e,t,n){"use strict";var i=n(154),r=n(151),o=n(5);Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return void 0!==o.default.window.webkitRTCPeerConnection?new i.WebkitAdapter(e):void 0!==o.default.window.mozRTCPeerConnection?new r.default(e):new function(){function e(){throw new Error("unsupported platform")}this.SdpTransform=e,this.RTCPeerConnection=e,this.RTCSessionDescription=e,this.RTCRtpReceiver=e}}}},function(e,t,n){"use strict";var i=function(){function e(){}return e.prototype.toGumConstraints=function(e){if(!e||!e.video||!e.video.deviceId)throw new Error("constraints cannot be applied: "+e);var t={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.video.deviceId}}};return e.video.minWidth&&(t.video.mandatory.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.mandatory.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.mandatory.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.mandatory.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.mandatory.maxFrameRate=15),t},e}();t.WebRTCDisplayConstraintsAdapter=i},function(e,t,n){var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(156),o=n(159),a=n(161),s=n(62),c=function(e){function t(t){var n=e.call(this,t)||this;return n.constraintsAdapter=new r.WebKitConstraintsAdapter,n}return i(t,e),t}(s.GumStreamProviderBase);t.WebRTCMediaStreamProvider=c;var l=function(e){function t(t,n){var i=e.call(this,n)||this;return i.configProvider=t,i.extensionProvider=new a.ExtensionProvider(i.configProvider,i.logger.createChild("Extension")),i.constraintsAdapter=new o.WebRTCDisplayConstraintsAdapter,i}return i(t,e),t.prototype.getStream=function(t){var n=this;return this.extensionProvider.checkAvailability().then(function(){return n.extensionProvider.queryDisplayStreamId()}).then(function(i){return t.video.deviceId=i,e.prototype.getStream.call(n,t)})},t}(s.GumStreamProviderBase);t.WebRTCDisplayStreamProvider=l},function(e,t,n){"use strict";var i=n(13),r=n(17),o=n(3),a="mlggpjcbdfbjcfjbibkchfgepekkcidp",s="version",c="get-sourceId",l=function(){function e(e,t){this.logger=t,this.messageQueue=new r.PromiseQueue(this.logger),this.extensionId=e.config.chromeExtensionId||a}return e.prototype.checkAvailability=function(){var e=this;return this.sendMessage(s).then(function(t){return e.version=t})},e.prototype.queryDisplayStreamId=function(){return this.sendMessage(c).then(function(e){if("success"===e.type)return e.streamId;if("error"===e.type&&"NoStreamId"===e.message)throw new Error(o.default.MEDIA_ERROR.sharingCancelledError)})},e.prototype.sendMessage=function(e){if(!chrome||!chrome.runtime||!chrome.runtime.sendMessage)return Promise.reject(new Error(o.default.MEDIA_ERROR.chromeRuntimeNotDefinedError));this.logger.safe.log("sending message to extension "+e+", version "+this.version);var t=new i.SettablePromise;return chrome.runtime.sendMessage(this.extensionId,e,function(e){e?t.resolve(e):t.reject(new Error(o.default.MEDIA_ERROR.extensionNotFoundError))}),this.messageQueue.add(t)},e}();t.ExtensionProvider=l},function(e,t,n){"use strict";var i,r=n(5);!function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Unsupported=2]="Unsupported"}(i=t.ContributingSourcesHandlerState||(t.ContributingSourcesHandlerState={}));var o=function(){function e(e){this.context=e,this._state=i.Stopped,this._lastSources=[],this._window=r.default.window,this._logger=e.logger.createChild("contributingSources")}return e.prototype.startPolling=function(){this._state===i.Stopped&&(this._state=i.Started,this._logger.safe.log("polling started"),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval))},e.prototype.stopPolling=function(){this._state===i.Started&&(this._timer&&(this._window.clearTimeout(this._timer),this._timer=void 0),this._state=i.Stopped,this._logger.safe.log("polling stopped"))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.poll=function(){var e=this;if(this._state===i.Started){var t=this.context.provider();t?(this.context.activeSpeakerManager.onContributingSourcesChanged(t.filter(function(t){var n=e._lastSources.filter(function(e){return e.source===t.source})[0];return!n||n.timestamp!==t.timestamp}).map(function(e){return e.source})),this.updateLastSources(t),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval)):(this._logger.safe.log("contributing sources are not supported on this client"),this._state=i.Unsupported,this.stopPolling())}},e.prototype.updateLastSources=function(e){var t=this;this._lastSources=[],e.forEach(function(e){t._lastSources.push({source:e.source,timestamp:e.timestamp})})},e}();t.ContributingSourcesHandler=o},function(e,t,n){"use strict";var i=n(64),r=n(15),o=n(3),a=function(){function e(e,t,n,i,r,o,a,s,c){this.configProvider=e,this.modality=t,this.mid=n,this.mtype=i,this.streamId=r,this.trackId=o,this.xSourceStreamId=a,this.videoCapabilities=s,this.extensions=c}return e.create=function(t,n,a){var s=r.getTypeFromModality(n),c=null;if(s===o.default.MEDIA_TYPE.video){var l=void 0,u=void 0;n===o.default.MODALITY.sharing?(l=t.config.webrtcScreensharingCapabilityMaxFS,u=t.config.webrtcScreensharingCapabilityMaxFPS):(l=t.config.webrtcVideoCapabilityMaxFS,u=t.config.webrtcVideoCapabilityMaxFPS),c=new i.default(l,u)}return new e(t,n,a,s,null,null,null,c,{})},e.prototype.clone=function(){return new e(this.configProvider,this.modality,this.mid,this.mtype,this.streamId,this.trackId,this.xSourceStreamId,this.videoCapabilities,this.extensions)},e.prototype.getModality=function(){return this.modality},e.prototype.getType=function(){return this.mtype},e.prototype.getMid=function(){return this.mid},e.prototype.disable=function(){this.mid=null},e.prototype.enable=function(e,t){this.modality=e,this.mid=t},e.prototype.isDisabled=function(){return!this.mid},e.prototype.isEnabled=function(){return!!this.mid},e.prototype.getVideoCapabilities=function(){return this.videoCapabilities},e.prototype.getStreamId=function(){return this.streamId},e.prototype.setStreamId=function(e){this.streamId=e},e.prototype.getTrackId=function(){return this.trackId},e.prototype.setTrackId=function(e){this.trackId=e},e.prototype.getXSourceStreamId=function(){return this.xSourceStreamId},e.prototype.setXSourceStreamId=function(e){this.xSourceStreamId=e},e.prototype.getExtension=function(e){return this.extensions[e]},e.prototype.setExtension=function(e,t){this.extensions[e]=t},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var i=n(15),r=n(3),o=n(2),a=n(163),s=function(){function e(e){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.logger=e.logger,this.configProvider=e.configProvider,this.numVideoChannels=e.numVideoChannels}return e.prototype.fromOffer=function(e,t){var n=this;e.media.forEach(function(e){if(e.type===r.default.MEDIA_TYPE.audio)r.default.MODALITY.audio in t&&n.addMediaEntity(r.default.MODALITY.audio);else if(e.type===r.default.MEDIA_TYPE.video){if(r.default.MODALITY.video in t)for(var i=0;i<n.numVideoChannels;i++)n.addMediaEntity(r.default.MODALITY.video);r.default.MODALITY.sharing in t&&n.addMediaEntity(r.default.MODALITY.sharing)}else e.type===r.default.MEDIA_TYPE.data&&r.default.MODALITY.data in t&&n.addMediaEntity(r.default.MODALITY.data)})},e.prototype.fromRemote=function(e,t){var n=this;e.media.forEach(function(e,r){var a=i.getModality(e);if(0!==e.port&&a in t){if(n.mediaEntities[r]?n.mediaEntities[r].enable(a,e.mid||n.generateMid(r)):n.addMediaEntity(a,e.mid||n.generateMid(r)),e.msid)n.mediaEntities[r].setStreamId(e.msid.split(" ")[0]),n.mediaEntities[r].setTrackId(e.msid.split(" ")[1]);else if(e.ssrcs){var s=o.find(e.ssrcs,function(e){return"msid"===e.attribute});s?(n.mediaEntities[r].setStreamId(s.value.split(" ")[0]),n.mediaEntities[r].setTrackId(s.value.split(" ")[1])):n.logger.safe.warn("No ssrc msid for media of type "+e.type+" with mid "+e.mid)}n.mediaEntities[r].setXSourceStreamId(e.xSourceStreamId)}else n.mediaEntities[r]?n.mediaEntities[r].disable():n.addDisabledMediaEntity(a),n.mediaEntities[r].setStreamId(null),n.mediaEntities[r].setTrackId(null)})},e.prototype.isEmpty=function(){return 0===this.mediaEntities.length},e.prototype.addMediaEntity=function(e,t){this.mediaEntities.push(a.default.create(this.configProvider,e,t||this.generateMid(this.mediaEntities.length)))},e.prototype.addDisabledMediaEntity=function(e){this.mediaEntities.push(a.default.create(this.configProvider,e,null))},e.prototype.getMediaEntities=function(){return this.mediaEntities},e.prototype.getMediaEntity=function(e){return this.mediaEntities[e]},e.prototype.getMediaEntityByMid=function(e){return o.find(this.mediaEntities,function(t){return t.getMid()===e})},e.prototype.getMediaEntitiesByModality=function(e){return this.mediaEntities.filter(function(t){return t.getModality()===e})},e.prototype.getMediaEntityByStreamId=function(e){return o.find(this.mediaEntities,function(t){return t.getStreamId()===e})},e.prototype.getMediaEntityByXSourceStreamId=function(e){return o.find(this.mediaEntities,function(t){return t.getXSourceStreamId()===e})},e.prototype.reset=function(){this.mediaEntities=[]},e.prototype.syncModalities=function(e,t){this.disableModalities(e),t||(this.enableModalities(e),this.addModalities(e))},e.prototype.enableModalities=function(e){var t=this;this.mediaEntities.forEach(function(n,i){n.getModality()in e&&n.isDisabled()&&n.enable(n.getModality(),t.generateMid(i))})},e.prototype.disableModalities=function(e){this.mediaEntities.forEach(function(t){t.getModality()in e||t.disable()})},e.prototype.addModalities=function(e){var t={};for(var n in this.mediaEntities.map(function(e){return e.getModality()}).forEach(function(e){t[e]=!0}),e)n in t||this.addMediaEntity(n)},e.prototype.setMediaTracks=function(e){this.mediaTracks=e},e.prototype.getMediaTracks=function(){return this.mediaTracks},e.prototype.backup=function(){var e=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach(function(t){e.mediaEntitiesBackup.push(t.clone())})},e.prototype.commit=function(){this.mediaEntitiesBackup=[]},e.prototype.rollback=function(){this.mediaEntities=this.mediaEntitiesBackup},e.prototype.generateMid=function(e){return"media_"+e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t,n){"use strict";var i=n(11),r=function(){function e(e,t,n){this.webRtcAdapter=e,this.sessionDescription=t,this.negotiationQueue=n}return e.prototype.dispose=function(){this.peerConnection=null},e.prototype.configure=function(e){this.peerConnection=e},e.prototype.renegotiate=function(e){if(!this.peerConnection)throw new Error("trying to renegotiate during empty peerConnection");return this.negotiationQueue.add(this.createNegotiationTask(e))},e.prototype.normalizeSDESAnswer=function(e){var t=this.peerConnection.localDescription.sdp,n=i.parse(t),r=i.parse(e);if(n.media[0].crypto){var o=n.media[0].crypto[0].id;r.media.forEach(function(e){delete e.fingerprint,delete e.setup,e.crypto=e.crypto.filter(function(e){return e.id===o})}),r.fingerprint&&delete r.fingerprint}else r.media.forEach(function(e){var t=n.media[0].setup;"actpass"===e.setup&&(e.setup="active"===t?"passive":"active")});return i.write(r)},e.prototype.createNegotiationTask=function(e){var t=this,n=function(){if(!t.peerConnection)throw new Error("trying to renegotiate during empty peerConnection")};return function(){var i=new t.webRtcAdapter.RTCSessionDescription({sdp:t.normalizeSDESAnswer(t.peerConnection.remoteDescription.sdp),type:"answer"});return e&&e.forEach(function(e){i=e.modifyDescriptor(i)}),Promise.resolve().then(function(){return n(),t.peerConnection.createOffer()}).then(function(e){n();var i=t.sessionDescription.createLocalOffer(e.sdp),r=new t.webRtcAdapter.RTCSessionDescription({sdp:i.toLocal(),type:"offer"});return t.peerConnection.setLocalDescription(r)}).then(function(){return n(),t.peerConnection.setRemoteDescription(i)})}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=n(2),r=n(167),o=function(){function e(e,t,n){var i=this;this.slidingWindow=[],this.logger=e.logger.createChild("qm"),this.listener=t,this.settings=e.settings,this.optimalReceiversCount=this.settings.videoReceiversCount,this.settings.scalingEnabled&&(n.onStatisticsChanged(function(e){i.processEstimatedBandwidth(e.estimatedReceiveBandwidth)}),this.notifyOptimalReceiversCountChanged()),this.resolutionManager=new r.default(e,t,n)}return e.prototype.setCurrentResolution=function(e){this.resolutionManager.setCurrentResolution(e)},e.prototype.setMaxCapabilities=function(e){this.settings.maxResolution&&e.maxFS>this.settings.maxResolution.fs&&(e.maxFS=this.settings.maxResolution.fs),this.resolutionManager.setMaxCapabilities(e)},e.prototype.getCurrentResolution=function(){return this.resolutionManager.getCurrentResolution()},e.prototype.getActive=function(){return this.resolutionManager.getActive()},e.prototype.sample=function(e){if(this.slidingWindow.length>=this.settings.slidingWindowSamples?this.slidingWindow=this.slidingWindow.slice(1):this.slidingWindow.length===this.settings.slidingWindowSamples-1&&(this.slidingWindow=this.slidingWindow.map(function(t){return e})),this.slidingWindow.push(e),this.slidingWindow.length>=this.settings.slidingWindowSamples){var t=this.slidingWindow.slice().sort(),n=i.average(t);return t[t.length-1]-(t[t.length-1]-n*(1-this.settings.slidingWindowPercentile))}return e},e.prototype.processOptimalReceiversCount=function(){if(!(this.bandwidth<0)){var e=Math.floor(this.sample(this.bandwidth)/this.settings.bandwidthPerVideoReceiver);this.optimalReceiversCount!==Math.max(e,1)&&(e?this.logger.safe.log("optimal video receivers count changed to "+e):(this.logger.safe.warn("there is not enough bandwidth even for a single video receiver"),e=1),this.optimalReceiversCount=e,this.notifyOptimalReceiversCountChanged())}},e.prototype.notifyOptimalReceiversCountChanged=function(){this.listener.onOptimalVideoReceiversCountChanged(this.optimalReceiversCount)},e.prototype.processEstimatedBandwidth=function(e){this.bandwidth=e,this.processOptimalReceiversCount()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=function(){function e(e,t,n){var i=this;this.resolutionApplier=t,this.lastSendBW=0,this.coolingDown=!1,this.cooldownTimer=null,this.cooldownEnd=0,this.active=!1,this.maxFps=30,this.logger=e.logger.createChild("rm"),this.resolutionTable=e.resolutionTable,e.settings.scalingEnabled?(this.active=!0,n.onStatisticsChanged(function(e){return i.onStatisticsChanged(e)})):this.logger.safe.log("Resolution management disabled: no resolution management for 1x1 calls")}return e.prototype.getActive=function(){return this.active},e.prototype.setMaxResolution=function(e){e!==this.maxResolution&&(this.logger.safe.log("New max resolution: "+e),this.maxResolution=e,this.lastSendBW&&this.processEstimatedBandwidth(this.lastSendBW))},e.prototype.setMaxCapabilities=function(e){var t=this.resolutionTable.getResolution(e.maxFS);e.maxFPS&&(this.maxFps=e.maxFPS),this.setMaxResolution(t)},e.prototype.setCurrentResolution=function(e){this.logger.safe.log("New resolution: "+e),this.currentResolution=e,e&&this.cooldown()},e.prototype.getCurrentResolution=function(){return this.currentResolution},e.prototype.applyRes=function(e){var t=this;this.pendingResolution=e,this.coolingDown&&(!this.currentResolution||e.fs>this.currentResolution.fs)||(this.coolingDown=!0,this.logger.safe.log("Changing resolution to "+e),this.resolutionApplier.applyResolution(e,this.maxFps).then(function(n){n&&e===t.pendingResolution?(t.pendingResolution=null,t.coolingDown&&!t.currentResolution&&(t.coolingDown=!1)):n||(t.logger.safe.log("Unable to apply resolution at the moment"),t.cooldown(5e3))}).catch(function(e){t.logger.safe.error("Error while applying new resolution:",e),t.pendingResolution=null}))},e.prototype.cooldown=function(e){var t=this;void 0===e&&(e=15e3),this.coolingDown&&this.cooldownEnd-Date.now()>15e3||(this.cooldownTimer&&clearTimeout(this.cooldownTimer),this.coolingDown=!0,this.cooldownEnd=Date.now()+15e3,this.cooldownTimer=setTimeout(function(){t.logger.safe.debug("Resolution changer cooled down"),t.coolingDown=!1,t.cooldownTimer=null,t.pendingResolution?t.proposeResolution(t.pendingResolution):t.processEstimatedBandwidth(t.lastSendBW)},e))},e.prototype.proposeResolution=function(e){this.maxResolution&&this.maxResolution.fs<e.fs&&(e=this.maxResolution),this.currentResolution&&e.fs===this.currentResolution.fs||this.applyRes(e)},e.prototype.processEstimatedBandwidth=function(e){var t=this.resolutionTable.getResolutionForBitrate(e),n=t.lowRes,i=t.highRes,r=e<this.lastSendBW?i:n;e<this.lastSendBW&&r&&this.currentResolution&&this.currentResolution.fs<r.fs||(r&&this.proposeResolution(r),this.lastSendBW=e)},e.prototype.onStatisticsChanged=function(e){var t=e.estimatedSendBandwidth;t!==this.lastSendBW&&(this.logger.safe.debug("Send BW: "+t),this.processEstimatedBandwidth(t))},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";var i=n(2);function r(e){var t="";return e.dtls&&(t+="dtls"),e.sdes&&(t+="sdes"),t}var o=function(){function e(){this.info={OfferedSrtp:"none",NegotiatedSrtp:"none",IceConnectionState:"none",IceConnectionStatePrevious:"none",SignalingState:"none",SignalingStatePrevious:"none",RelayCandidate:"none"}}return e.prototype.setOfferedModalities=function(e){this.offeredModalities=e,this.activeModalities=e},e.prototype.setNegotiatedModalities=function(e){this.negotiatedModalities=e,this.activeModalities=e},e.prototype.setNegotiatedSrtpInfo=function(e){this.info.NegotiatedSrtp=r(e)},e.prototype.setOfferedSrtpInfo=function(e){this.info.OfferedSrtp=r(e)},e.prototype.setIceConnectionState=function(e){this.info.IceConnectionStatePrevious=this.info.IceConnectionState,this.info.IceConnectionState=e},e.prototype.setSignalingConnectionState=function(e){this.info.SignalingStatePrevious=this.info.SignalingState,this.info.SignalingState=e},e.prototype.setRelayCandidateInfo=function(e){this.info.RelayCandidate=JSON.stringify(e)},e.prototype.fillExtensionInfo=function(e){i.assign(e,this.info)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(170),r=n(168),o=n(5),a=n(2),s=n(8);function c(e){var t={};return e.result().forEach(function(e){e.names().forEach(function(n){t[e.type]=t[e.type]||{},t[e.type][e.id]=t[e.type][e.id]||{},t[e.type][e.id][n]=e.stat(n)}),t[e.type][e.id].id=e.id}),t}t.unwrapResults=c;var l=function(){function e(e,t){this.window=o.default.window,this.statisticsChangedListener=a.noop,this.gatheringInterval=1e3,this._sessionInfo=new r.default,this._webRtcStatistics=new i.default(e,{logger:t.logger,sessionInfo:this._sessionInfo,configProvider:t.configProvider}),this.configProvider=t.configProvider,this.gatheringInterval=Number(this.configProvider.config.webrtcStatPollInterval)}return Object.defineProperty(e.prototype,"sessionInfo",{get:function(){return this._sessionInfo},enumerable:!0,configurable:!0}),e.prototype.onStatisticsChanged=function(e){var t=this.statisticsChangedListener;this.statisticsChangedListener=function(n){t(n),e(n)},this.startGathering()},e.prototype.initialize=function(e){this.pc=e,this.startGathering()},e.prototype.startWaitingForStreamStart=function(e,t){void 0===t&&(t=!1),this._webRtcStatistics.startWaitingForStreamStart(e,t)},e.prototype.setMediaEntities=function(e){this._webRtcStatistics.setMediaEntities(e)},e.prototype.setTerminated=function(){this._webRtcStatistics.setTerminated()},e.prototype.getReport=function(){var e=this;return this.processStatistics().then(function(){return e.getLastKnownReport()})},e.prototype.getLastKnownReport=function(){var e=this._webRtcStatistics.getReport();return this.addStreamInfoForE2ETests(e),e},e.prototype.dispose=function(){this.interval&&(this.window.clearInterval(this.interval),this.interval=0),this.pc=null},e.prototype.addStreamInfoForE2ETests=function(e){var t=this._sessionInfo.negotiatedModalities;t&&(e.localStreams=this.getSendersReport(this.pc.getSenders(),{audio:s.hasSendDirectionality(t.audio),video:s.hasSendDirectionality(t.video)}),e.remoteStreams=this.getStreamsReport(this.pc.getRemoteStreams(),{audio:s.hasReceiveDirectionality(t.audio),video:s.hasReceiveDirectionality(t.video)}))},e.prototype.getStreamsReport=function(e,t){var n=[];return e.forEach(function(e){var i={tracks:[]};n.push(i),e.getTracks().forEach(function(n){("audio"===n.kind&&t.audio||"video"===n.kind&&t.video)&&i.tracks.push({stream:e,track:n})})}),n},e.prototype.getSendersReport=function(e,t){var n=[],i={tracks:[]};return n.push(i),e.forEach(function(e){e.track&&("audio"===e.track.kind&&t.audio||"video"===e.track.kind&&t.video)&&i.tracks.push({stream:void 0,track:e.track})}),n},e.prototype.startGathering=function(){var e=this;this.isInitialized&&!this.interval&&(this.interval=this.window.setInterval(function(){e.processStatistics()},this.gatheringInterval))},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.pc&&this.pc.getStats},enumerable:!0,configurable:!0}),e.prototype.processStatistics=function(){var e=this;return new Promise(function(t){e.pc?e.pc.getStats(function(n){n.result?(e.processStatsDict(c(n)),t()):t()}):t()})},e.prototype.processStatsDict=function(e){this._webRtcStatistics.processStatsDict(e);var t=0,n=0,i=e.VideoBwe?e.VideoBwe.bweforvideo:null;i&&(t=Number(i.googAvailableReceiveBandwidth),n=Number(i.googAvailableSendBandwidth));var r={estimatedReceiveBandwidth:isNaN(t)?0:t,estimatedSendBandwidth:isNaN(n)?0:n,videoStreams:{},audioHwSilent:this._webRtcStatistics.getAudioHwSilent(),networkSendLevel:this._webRtcStatistics.getNetworkSendLevel(),networkRecvLevel:this._webRtcStatistics.getNetworkRecvLevel()};a.forOwn(e.ssrc,function(e){if(-1!==e.id.indexOf("_recv")){var t=e.googTrackId;"video"===e.mediaType&&(r.videoStreams[t]={trackId:t,frameRateReceived:Number(e.googFrameRateReceived),frameRateDecoded:Number(e.googFrameRateDecoded),framesDecoded:Number(e.framesDecoded)})}}),a.deepEqual(this.statistics,r)||(this.statistics=r,this.notifyStatisticsChanged())},e.prototype.notifyStatisticsChanged=function(){this.statisticsChangedListener(this.statistics)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=l},function(e,t,n){"use strict";var i=n(8),r=n(2),o=n(150),a=["googFrameHeightReceived","googFrameWidthReceived","googNacksSent","googPlisSent","framesDecoded","googFrameRateDecoded","googFrameRateReceived","packetsLost","packetsSent","packetsReceived","bytesReceived","bytesSent","googFrameHeightSent","googFrameWidthSent","googFrameRateInput","googFrameRateSent","googEncodeUsagePercent","audioInputLevel","googDecodingCTN","googDecodingPLC"],s=["bytesSent","bytesReceived","googRtt","packetsSent","requestsSent","consentRequestsSent","responsesSent","requestsReceived","responsesReceived"],c=["googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTransmitBitrate"],l=function(){function e(e,t){this.mediaEntities=[],this.terminated=!1,this.hwSilent=!1,this.networkSendLevel=1,this.networkRecvLevel=1,this.jitterBuffer=new o.default,this.videoSendFrameRate=new o.default,this.videoRecvFrameRate=new o.default,this.sharingSendFrameRate=new o.default,this.sharingRecvFrameRate=new o.default,this.extensions={WebRTCStats:{},AudioTransportRecvBitrate:0,AudioTransportSendBitrate:0,AudioPayloadSendBitrate:0,AudioPayloadRecvBitrate:0,VideoPayloadSendBitrate:0,VideoPayloadRecvBitrate:0,TimerAudioTransportRecvBitrate:0,TimerAudioTransportSendBitrate:0,TimerAudioPayloadRecvBitrate:0,TimerAudioPayloadSendBitrate:0,TimerVideoPayloadRecvBitrate:0,TimerVideoPayloadSendBitrate:0,StartTime:Date.now(),EndTime:Date.now(),WebRTCStats_ssrc_audio_recv_jitterBufferAvgSize:0,WebRTCStats_ssrc_video_send_frameRateAvg:0,WebRTCStats_ssrc_video_recv_frameRateAvg:0,WebRTCStats_ssrc_sharing_send_frameRateAvg:0,WebRTCStats_ssrc_sharing_recv_frameRateAvg:0},this.report={type:"WebRtcMediaStats",data:{Extensions:this.extensions}},this.storedRecordsNumber=Number(t.configProvider.config.webrtcStatStoredRecordsNumber),this.hwSilentDetectionDuration=Number(t.configProvider.config.webrtcStatHwSilentDetectionDuration),this.hwSilentDetectionLevel=Number(t.configProvider.config.webrtcStatHwSilentDetectionLevel),this.networkDetectionDuration=Number(t.configProvider.config.webrtcStatNetworkDetectionDuration);var n=Number(t.configProvider.config.webrtcStatNetworkDetectionHysteresis);this.networkDetectionBadLevelHigh=Number(t.configProvider.config.webrtcStatNetworkDetectionBadLevel)+n/2,this.networkDetectionBadLevelLow=this.networkDetectionBadLevelHigh-n,this.networkDetectionGoodLevelHigh=Number(t.configProvider.config.webrtcStatNetworkDetectionGoodLevel)+n/2,this.networkDetectionGoodLevelLow=this.networkDetectionGoodLevelHigh-n,this.report.data.CorrelationId=e,this.logger=t.logger.createChild("WebrtcStatistics"),this.sessionInfo=t.sessionInfo}return e.prototype.setMediaEntities=function(e){this.mediaEntities=e},e.prototype.setTerminated=function(){this.extensions.EndTime=(new Date).getTime(),this.terminated=!0},e.prototype.startWaitingForStreamStart=function(e,t){this.streamStartDetection||this.sessionInfo.setOfferedModalities(e),this.streamStartDetection=!0},e.prototype.processStatsDict=function(e){try{if(this.getWebrtcReport(this.extensions.WebRTCStats,e),this.streamStartDetection&&(this.setStartTime(this.sessionInfo.offeredModalities)||this.terminated)&&(this.streamStartDetection=!1),this.calculateHwSilentState(),this.calculateNetworkQualityLevels(),this.extensions.WebRTCStats.ssrc_video_send&&this.extensions.WebRTCStats.ssrc_video_send.googFrameRateSent){var t=this.extensions.WebRTCStats.ssrc_video_send.googFrameRateSent;this.videoSendFrameRate.updateEventValue(parseInt(t[t.length-1]))}if(this.extensions.WebRTCStats.ssrc_video_recv&&this.extensions.WebRTCStats.ssrc_video_recv.googFrameRateReceived){t=this.extensions.WebRTCStats.ssrc_video_recv.googFrameRateReceived;this.videoRecvFrameRate.updateEventValue(parseInt(t[t.length-1]))}if(this.extensions.WebRTCStats.ssrc_sharing_send&&this.extensions.WebRTCStats.ssrc_sharing_send.googFrameRateSent){t=this.extensions.WebRTCStats.ssrc_sharing_send.googFrameRateSent;this.sharingSendFrameRate.updateEventValue(parseInt(t[t.length-1]))}if(this.extensions.WebRTCStats.ssrc_sharing_recv&&this.extensions.WebRTCStats.ssrc_sharing_recv.googFrameRateReceived){t=this.extensions.WebRTCStats.ssrc_sharing_recv.googFrameRateReceived[0];this.sharingRecvFrameRate.updateEventValue(parseInt(t[t.length-1]))}this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs&&this.jitterBuffer.updateEventValue(parseInt(this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs[0]))}catch(e){this.extensions.WebRTCStats={getStatsError:e}}},e.prototype.getReport=function(){return this.extensions.WebRTCStats_ssrc_audio_recv_jitterBufferAvgSize=this.jitterBuffer.getResult()?Math.round(this.jitterBuffer.getResult()):-1,this.extensions.WebRTCStats_ssrc_video_send_frameRateAvg=this.videoSendFrameRate.getResult()?this.videoSendFrameRate.getResult():-1,this.extensions.WebRTCStats_ssrc_video_recv_frameRateAvg=this.videoRecvFrameRate.getResult()?this.videoRecvFrameRate.getResult():-1,this.extensions.WebRTCStats_ssrc_sharing_send_frameRateAvg=this.sharingSendFrameRate.getResult()?this.sharingSendFrameRate.getResult():-1,this.extensions.WebRTCStats_ssrc_sharing_recv_frameRateAvg=this.sharingRecvFrameRate.getResult()?this.sharingRecvFrameRate.getResult():-1,this.sessionInfo.fillExtensionInfo(this.extensions),Object.keys(this.extensions.WebRTCStats).length>0&&!this.extensions.WebRTCStats.getStatsError&&this.calculateAverages(),this.report},e.prototype.getAudioHwSilent=function(){return this.hwSilent},e.prototype.getNetworkSendLevel=function(){return this.networkSendLevel},e.prototype.getNetworkRecvLevel=function(){return this.networkRecvLevel},e.prototype.setStartTime=function(e){var t=this.extensions.WebRTCStats;if(!t.ssrc_audio_send||!t.ssrc_audio_recv)return!1;var n=function(e,t){return!e||t&&-1===t?t:(new Date).getTime()};return this.extensions.TimerAudioPayloadRecvBitrate=i.hasReceiveDirectionality(e.audio)?n(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioPayloadRecvBitrate):-1,this.extensions.TimerAudioPayloadSendBitrate=i.hasSendDirectionality(e.audio)?n(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioPayloadSendBitrate):-1,this.extensions.TimerAudioTransportRecvBitrate=i.hasReceiveDirectionality(e.audio)?n(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioTransportRecvBitrate):-1,this.extensions.TimerAudioTransportSendBitrate=i.hasSendDirectionality(e.audio)?n(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioTransportSendBitrate):-1,!(!t.ssrc_video_send||!t.ssrc_video_recv)&&(this.extensions.TimerVideoPayloadRecvBitrate=i.hasReceiveDirectionality(e.video)?n(t.ssrc_video_recv.bytesReceived,this.extensions.TimerVideoPayloadRecvBitrate):-1,this.extensions.TimerVideoPayloadSendBitrate=i.hasSendDirectionality(e.video)?n(t.ssrc_video_send.bytesSent,this.extensions.TimerVideoSendBitrate):-1,!!(this.extensions.TimerVideoPayloadRecvBitrate&&this.extensions.TimerVideoPayloadSendBitrate&&this.extensions.TimerAudioPayloadRecvBitrate&&this.extensions.TimerAudioPayloadSendBitrate&&this.extensions.TimerAudioTransportRecvBitrate&&this.extensions.TimerAudioTransportSendBitrate))},e.prototype.calculateAverages=function(){var e=this,t=this.extensions.EndTime,n=function(e,n){return e&&t-n>0&&0!==n&&-1!==n?Math.round(8*e/(t-n)):0},i=function(t){var n=t.split(".").reduce(function(e,t){return void 0===e||null===e?e:e[t]},e.extensions.WebRTCStats);return Array.isArray(n)?n[n.length-1]:n};this.extensions.AudioPayloadRecvBitrate=n(i("ssrc_audio_recv.bytesReceived"),this.extensions.TimerAudioPayloadRecvBitrate),this.extensions.AudioPayloadSendBitrate=n(i("ssrc_audio_send.bytesSent"),this.extensions.TimerAudioPayloadSendBitrate),this.extensions.VideoPayloadRecvBitrate=n(i("ssrc_video_recv.bytesReceived"),this.extensions.TimerVideoPayloadRecvBitrate),this.extensions.VideoPayloadSendBitrate=n(i("ssrc_video_send.bytesSent"),this.extensions.TimerVideoPayloadSendBitrate),this.extensions.AudioTransportRecvBitrate=n(i("ssrc_audio_send.pair.bytesReceived"),this.extensions.TimerAudioTransportRecvBitrate),this.extensions.AudioTransportSendBitrate=n(i("ssrc_audio_send.pair.bytesSent"),this.extensions.TimerAudioTransportSendBitrate)},e.prototype.addFilteredFields=function(e,t,n){for(var i in void 0===n&&(n=[]),t)if(t.hasOwnProperty(i)&&"type"!==i)if(-1!==n.indexOf(i)){var r=e[i]||[];r.push(t[i]),r.length>this.storedRecordsNumber&&r.shift(),e[i]||(e[i]=r)}else e[i]=t[i]},e.prototype.processSource=function(e,t,n){if(this.addFilteredFields(e,t,a),t.transportId){var i=n.googComponent[t.transportId];if(e.transport||(e.transport={}),this.addFilteredFields(e.transport,i),i.selectedCandidatePairId){var r=n.googCandidatePair[i.selectedCandidatePairId];e.pair||(e.pair={}),this.addFilteredFields(e.pair,r,s)}}},e.prototype.getWebrtcReport=function(e,t){if(e.hasOwnProperty("getStatsError")&&delete e.getStatsError,t.ssrc){var n=function(n){if(t.ssrc[n].hasOwnProperty("transportId")){var o=t.ssrc[n],a=r.find(i.mediaEntities,function(e){return e.trackId===o.googTrackId}),s=a?a.modality:o.mediaType,c=o.id.replace(/[0-9]+/,s);e[c]||(e[c]={}),i.processSource(e[c],o,t)}},i=this;for(var o in t.ssrc)n(o);t.VideoBwe&&t.VideoBwe.bweforvideo&&(e.bweStat||(e.bweStat={}),this.addFilteredFields(e.bweStat,t.VideoBwe.bweforvideo,c))}},e.prototype.calculateHwSilentState=function(){var e=this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.audioInputLevel;if(e&&!(e.length<2*this.hwSilentDetectionDuration)){for(var t=!0,n=e.length-this.hwSilentDetectionDuration-1;n<e.length;n++)if(e[n]>this.hwSilentDetectionLevel){t=!1;break}this.hwSilent!==t&&(this.hwSilent=t,this.logger.safe.info("HW silent changed to "+this.hwSilent))}},e.prototype.calculateNetworkQualityLevel=function(e,t,n){if(!e||!t||this.networkDetectionDuration<1||e.length<2*this.networkDetectionDuration)return n;for(var i=e.length-1-this.networkDetectionDuration,r=e[e.length-1];i>=0&&r-e[i]<100*this.networkDetectionDuration;)i--;if(i<0)return n;var o=n,a=r-e[i],s=t[t.length-1]-t[i];if(a>0){var c=s/a;c<this.networkDetectionGoodLevelLow?o=1:c>this.networkDetectionGoodLevelHigh&&(c<this.networkDetectionBadLevelLow?o=2:c>this.networkDetectionBadLevelHigh&&(o=3))}return o},e.prototype.calculateNetworkQualityLevels=function(){this.networkRecvLevel=this.calculateNetworkQualityLevel(this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingCTN,this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingPLC,this.networkRecvLevel)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=l},function(e,t,n){"use strict";var i=function(){function e(e,t){this.callbacks=t,this.streamIsActive=!1,this.statsGathererSubscribed=!1,this.lastReceivedFps=0,this.lastFramesDecoded=0,this.configProvider=e.configProvider,this.statisticsGatherer=e.statsGatherer,this.logger=e.logger.createChild("streamWatcher")}return e.prototype.watchStream=function(e){this.currentStream!==e&&(this.currentStream=e,this.startMonitoringStats(),this.disposeTimer())},e.prototype.stopWatchingStream=function(e){e===this.currentStream&&(this.currentStream=null,this.disposeTimer())},e.prototype.dispose=function(){this.callbacks=void 0,this.disposeTimer()},e.prototype.disposeTimer=function(){this.resetTimeoutId&&(clearTimeout(this.resetTimeoutId),this.resetTimeoutId=void 0)},e.prototype.startMonitoringStats=function(){var e=this;this.statsGathererSubscribed||(this.statisticsGatherer.onStatisticsChanged(function(t){return e.onStatisticsChanged(t)}),this.statsGathererSubscribed=!0)},e.prototype.onStatisticsChanged=function(e){if(this.currentStream){var t=e.videoStreams[this.currentStream.id];t?(this.lastReceivedFps=t.frameRateReceived,this.lastReceivedFps<=0?this.disposeTimer():(t.frameRateDecoded<=0?this.streamBroken||this.scheduleResetScreenShare():(this.streamIsActive||(this.logger.safe.info("Video stream is active now"),this.callbacks.onStreamIncomingDecoderActive(),this.lastFramesDecoded>t.framesDecoded&&this.callbacks.onStreamIncomingDecoderReset()),this.streamIsActive=!0,this.disposeTimer()),this.lastFramesDecoded=t.framesDecoded)):this.logger.safe.warn("WebRTC Stats for video stream "+this.currentStream.id+" not found")}},Object.defineProperty(e.prototype,"streamBroken",{get:function(){return void 0!==this.resetTimeoutId},enumerable:!0,configurable:!0}),e.prototype.scheduleResetScreenShare=function(){var e=this;this.resetTimeoutId=setTimeout(function(){e.resetTimeoutId=void 0,e.streamIsActive=!1,e.logger.safe.error("Decoding 0 frameRate while receiving "+e.lastReceivedFps+", asking for recovery"),e.callbacks.onStreamIncomingDecoderFailed()},this.configProvider.config.webrtcVideoStreamRecoverWaitTimeout)},e}();t.VideoStreamWatcher=i},function(e,t,n){"use strict";var i=n(63),r=function(){function e(e,t,n,r){this.msi=i.MediaSourceIdentifiers.SourceNone,this.operations=Promise.resolve(),this.mediaStream=e,this.modality=t,this.sourceStreamId=n,this.controller=r}return e.prototype.getId=function(){return this.mediaStream.id},e.prototype.getModality=function(){return this.modality},e.prototype.getMsi=function(){return this.msi},e.prototype.getMediaStream=function(){return this.mediaStream},e.prototype.requestSource=function(e){var t=this;this.msi=e;var n=this.operations.then(function(){return t.controller.requestSource(t.sourceStreamId,e)});return this.operations=n.catch(function(){}),n},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=n(15);function r(){var e=[{jsep:"active",msSdp:"tcp-act"},{jsep:"passive",msSdp:"tcp-pass"},{jsep:"so",msSdp:"tcp-so"}];function t(t,n){delete t.generation,t.transport.match(/tcp/i)&&function(t,n){e.some(function(e){if(n){if(e.msSdp===t.transport.toLowerCase())return t.transport="tcp",t.tcptype=e.jsep,!0}else if(t.tcptype&&e.jsep===t.tcptype.toLowerCase())return t.transport=e.msSdp,delete t.tcptype,!0;return!1})}(t,n)}function n(e,t,n){var i=t.connection||n.connection,r=function(e,t,n){return e.port===n&&e.ip===t};return!!i&&(1===e.component?r(e,i.ip,t.port):!!t.rtcp&&r(e,t.rtcp.ip||i.ip,t.rtcp.port))}this.fromMsSdp=function(e){e.candidates=e.candidates||[],e.xCandidatesIpv6&&(e.xCandidatesIpv6.forEach(function(t){e.candidates.push(t)}),delete e.xCandidatesIpv6),e.candidates.forEach(function(e){t(e,!0)})},this.toMsSdp=function(e,r){e.candidates=e.candidates||[],e.candidates.sort(function(t,i){return t.foundation!==i.foundation?t.foundation-i.foundation:t.component!==i.component?t.component-i.component:+n(i,e,r)-+n(t,e,r)}),e.candidates=e.candidates.filter(function(n,i){t(n,!1);var r=e.candidates[i-1];return!r||r.component!==n.component||r.foundation!==n.foundation}),function(e,t){if(e.port&&!e.candidates.length){var n=i.getBundle(t);n&&(e.port=n.port,e.connection=n.connection)}}(e,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new r}}},function(e,t,n){"use strict";var i=n(15),r=function(){function e(){}return e.prototype.fromNative=function(e,t,n,r){return e.media.forEach(function(e,r){var o=t.getMediaEntity(r);o&&o.isEnabled()&&0!==e.port?(e.label=i.getLabelForModality(o.getModality()),e.direction=n[o.getModality()]):e.port=0}),e},e.prototype.toLocal=function(e,t,n){return e},e.prototype.toOffer=function(e,t,n){return this.fromNative(e,t,n,!0)},e.prototype.toAnswer=function(e,t,n){return this.fromNative(e,t,n,!1)},e.prototype.toRemote=function(e,t,n){var i;return e.media.forEach(function(e,t){e.connection?i=e.connection:i&&(e.connection=i)}),e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var i=n(173),r=n(177),o=n(176),a=n(8),s=n(5),c=n(3),l={audio:"main-audio",video:"main-video"},u={udpTlsRtpSavpf:"UDP/TLS/RTP/SAVPF",rtpSavpf:"RTP/SAVPF",rtpSavp:"RTP/SAVP"};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){this.toMsSdp=function(i,r){return i.msidSemantic={semantic:"WMS",token:"*"},i.media.forEach(function(o){var a;if(o.protocol=u.rtpSavp,o.label=o.label||(a=o.type,l.hasOwnProperty(a)&&l[a]||"undefined"),0===o.port){for(var s in o)o.hasOwnProperty(s)&&["type","port","protocol","payloads"].indexOf(s)<0&&delete o[s];o.payloads=34}d.toMsSdp(o),o.crypto&&o.crypto.forEach(function(e){e.config+="|2^31"}),0!==o.port&&i.fingerprint&&(o.fingerprint=i.fingerprint),n.toMsSdp(o,i),p.toMsSdp(o,i,r),o.invalid&&(t.error("Unknown SDP attributes! "+o.invalid),delete o.invalid),h(o,!1),0!==o.port&&(o.type===c.default.MEDIA_TYPE.audio&&e.configProvider.config.webrtcAudioChannelSignalingFeedback?o.signalingFbXMessage={payload:"*",param:e.configProvider.config.webrtcAudioChannelSignalingFeedback}:o.type===c.default.MEDIA_TYPE.video&&e.configProvider.config.webrtcVideoChannelSignalingFeedback&&(o.signalingFbXMessage={payload:"*",param:e.configProvider.config.webrtcVideoChannelSignalingFeedback}))}),delete i.fingerprint,i},this.fromMsSdp=function(t,i){for(var r=a.getSrtpInfo(t),o=t.media.length-1;o>=0;--o){var s=t.media[o];if((s.ssrcs&&s.ssrcs[0]||s.xSsrcRange)&&(t.msidSemantic={semantic:"WMS",token:"*"}),s.protocol=u.udpTlsRtpSavpf,(!r.dtls||r.sdes&&e.configProvider.config.preferSdesSrtp)&&(s.protocol=u.rtpSavpf),0!==s.port){if(d.fromMsSdp(s),delete s.cryptoscale,s.fingerprint&&f(i)&&(s.setup="actpass"),s.crypto)for(var c=s.crypto.length-1;c>=0;--c){var l=s.crypto[c];l.config.match(/.*\|\d+:\d+/)?s.crypto.splice(c,1):l.config=l.config.replace(/(.*)\|2\^\d+/,"$1")}s.remoteCandidates&&(delete s.candidates,delete s.xCandidatesIpv6,delete s.remoteCandidates),n.fromMsSdp(s),s.rtcpFbXMessage&&delete s.rtcpFbXMessage,h(s,!0)}else s.direction||(s.direction="inactive")}return t};var t=e.logger,n=(s.default.window,i.default.build()),d=r.default.build(),p=o.default.build();function h(e,t){var n=[{name:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",encoded:"http:\\\\www.webrtc.org\\experiments\\rtp-hdrext\\abs-send-time"}];e.ext&&e.ext.forEach(function(e){n.some(function(n){var i=t?n.encoded:n.name,r=t?n.name:n.encoded;return i===e.uri&&(e.uri=r,!0)})})}function f(e){return"offer"===e.type}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new function(){this.toMsSdp=function(e,t,n){"offer"===n.type?e.rtcp&&(e.rtcp={port:e.port}):delete e.rtcp}}}}},function(e,t,n){"use strict";var i=n(3),r=n(2),o=n(179),a=[{label:i.default.MEDIA_LABEL.audio,id:o.default.STREAM_ID.audio},{label:i.default.MEDIA_LABEL.video,id:o.default.STREAM_ID.video},{label:i.default.MEDIA_LABEL.sharing,id:o.default.STREAM_ID.sharing}].reduce(function(e,t){return e[t.label]=t.id,e},{}),s=r.uniqueId();function c(){function e(e,t,n,i){e.ssrcs=e.ssrcs||[],e.ssrcs.push({attribute:"cname",id:t,value:n}),e.ssrcs.push({attribute:"msid",id:t,value:i})}function t(e,t,n){var i=function(e){return a[e]?a[e]+o.default.STREAM_ID_DELIMITER:""}(n);return i+e+" "+i+t}this.fromMsSdp=function(n){if(0!==n.port){if(!function(e){return"recvonly"===e.direction}(n)){if(n.msid){n.ssrcs&&1===n.ssrcs.length&&(e(n,n.ssrcs[0].id,n.ssrcs[0].value,n.msid),n.ssrcs.shift());var i=n.msid.split(" ");n.msid=t(i[0],i[1]||i[0],n.label)}if(n.ssrcs)o=n.ssrcs,a=function(e,i){return t(e,i,n.label)},o.filter(function(e){return"msid"===e.attribute}).forEach(function(e){var t=e.value.split(" ");e.value=a(t[0],t[1]||t[0])});else{var r=function(e){if(e.ssrcGroups){var t;if(e.ssrcGroups.some(function(e){return"FID"===e.semantics&&(t=e,!0)}),t)return t.ssrcs.split(" ").map(function(e){return+e})}return[]}(n);r.length>0?r.forEach(function(i){e(n,i,s,t(r[0],r[0],n.label))}):n.xSsrcRange&&e(n,n.xSsrcRange.ssrcMin,s,t(n.xSsrcRange.ssrcMin,n.xSsrcRange.ssrcMin,n.label))}}var o,a;delete n.xSsrcRange}},this.toMsSdp=function(e){var t;0!==e.port&&(e.ssrcs&&e.ssrcs[0]&&(t=e.ssrcs[0].id),void 0!==t&&(e.xSsrcRange={ssrcMin:t,ssrcMax:t}))}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new c}}},function(e,t,n){"use strict";var i=n(15),r=n(3),o=n(2),a=n(61),s=[48e3,32e3,24e3,16e3,12e3],c=function(){function e(e){this.cname=o.uniqueId(),this.ssrcGenerator=new a.default,this.videoSSRCs=[],this.configProvider=e.configProvider}return e.prototype.fixTelephoneEvent=function(e){var t;return s.forEach(function(t){i.removeCodec(e,{codec:"telephone-event",rate:t})}),i.updatePayload(e,101,999),i.forCodec(e,{name:"telephone-event",rate:8e3},function(e){return t=e.rtp.payload,e.rtp.payload=101,e}),i.updatePayload(e,999,t||101),t},e.prototype.enforceFixedSsrc=function(e){var t=this,n=-1;if(e.ssrcs&&(e.ssrcs.forEach(function(i){"cname"===i.attribute&&n++,i.id=t.getVideoSSRC(e,n)}),e.ssrcGroups)){var i=e.ssrcs.filter(function(e){return"cname"===e.attribute}).map(function(e){return e.id});e.ssrcGroups.forEach(function(e,t){e.ssrcs=[i[2*t],i[2*t+1]].join(" ")})}},e.prototype.toLocal=function(e,t,n){var r,a=this,s=o.deepClone(e);return s.media.forEach(function(e){"audio"===e.type?r=a.fixTelephoneEvent(e):(r&&i.updatePayload(e,101,r),a.enforceFixedSsrc(e))}),s},e.prototype.toOffer=function(e,t,n){return this.fromNative(e,t,n,!0)},e.prototype.toAnswer=function(e,t,n){return this.fromNative(e,t,n,!1)},e.prototype.toRemote=function(e,t,n){var a=this,s=o.deepClone(e),c=null,d=null,p=l(s);if(s.media.forEach(function(e,n){t.getMediaEntity(n).isDisabled()&&(e.port=0)}),s.media.forEach(function(e,t){e.type===r.default.MEDIA_TYPE.data&&(a.dataMedia=e,s.media[t]=u(e.type,e.label,e.protocol))}),!p){var h=!1;s.media.forEach(function(e,n){var i=t.getMediaEntity(n);!h&&i.isEnabled()?(e.mid=i.getMid(),h=!0):(i.disable(),e.port=0)}),h&&(s.groups||(s.groups=[]),p={type:"BUNDLE"},s.groups.push(p))}s.media.forEach(function(e){var t=i.getModality(e);n[t]===r.default.MEDIA_STATE.send&&(e.direction&&e.direction.toLowerCase()===r.default.MEDIA_STATE.receive||(e.direction=r.default.MEDIA_STATE.receive))});var f=o.find(s.media,function(e){return e.type===r.default.MEDIA_TYPE.audio});f&&(0!==f.port?((c=o.deepClone(f)).mid="audio",delete c.label,function(e){i.removeCodec(e,{codec:"g722",rate:8e3,encoding:2})}(c)):c=u(r.default.MEDIA_TYPE.audio,void 0,f.protocol));var g=s.media.filter(function(e){return e.type===r.default.MEDIA_TYPE.video});if(g.length>0){var m=g.filter(function(e){return 0!==e.port});m.length>0?((d=o.deepClone(m[0])).mid="video",d.direction=null,delete d.label,d.ssrcs=[],d.ssrcGroups=[],m.forEach(function(e){e.ssrcs&&(d.ssrcs=d.ssrcs.concat(e.ssrcs)),e.ssrcGroups&&(d.ssrcGroups=d.ssrcGroups.concat(e.ssrcGroups)),d.direction=function(e,t){if(e===r.default.MEDIA_STATE.sendReceive||t===r.default.MEDIA_STATE.sendReceive)return r.default.MEDIA_STATE.sendReceive;if(e===t)return e;if(e&&t&&e!==t)return r.default.MEDIA_STATE.sendReceive;return e||t}(d.direction,e.direction||r.default.MEDIA_STATE.sendReceive)})):d=u(r.default.MEDIA_TYPE.video,void 0,g[0].protocol)}return s.media=[c,d].filter(function(e){return e}),t.getMediaEntities()[0].getModality()!==r.default.MODALITY.audio&&s.media.reverse(),p&&(p.mids=s.media.map(function(e){return e.mid}).filter(function(e){return e}).join(" ")),this.configProvider.config.preferSdesSrtp||s.media.forEach(function(e,t){e.fingerprint&&e.crypto&&delete e.crypto}),s},e.prototype.splitMedia=function(e,t,n,a,s){var c=this,l=e.getMid(),d=e.getModality(),p=o.deepClone(t);if(p.label=i.getLabelForModality(d),p.direction=a,p.mid=l,p.ssrcs=[],p.ssrcGroups=[],a===r.default.MEDIA_STATE.send||a===r.default.MEDIA_STATE.sendReceive){var h=o.find(n,function(e){return e.modality===d});if(!h)return u(t.type,i.getLabelForModality(d),t.protocol);var f=[];t.ssrcs&&(f=t.ssrcs.filter(function(e){return"msid"===e.attribute&&h.track===e.value.split(" ")[1]}).map(function(e){return e.id}),p.ssrcs=t.ssrcs.filter(function(e){return f.indexOf(e.id)>-1}),p.ssrcs.forEach(function(e){"cname"===e.attribute&&(e.value=c.cname)})),t.ssrcGroups&&(p.ssrcGroups=t.ssrcGroups.filter(function(e){var t=e.ssrcs.split(" ");return o.find(t,function(e){return f.indexOf(+e)>-1})}))}else a!=r.default.MEDIA_STATE.receive&&a!=r.default.MEDIA_STATE.inactive||(s[t.type].ssrcs&&s[t.type].ssrcs[0]?p.ssrcs=[{id:s[t.type].ssrcs[0].id,attribute:"cname",value:this.cname}]:t.type===r.default.MEDIA_TYPE.audio?p.ssrcs=[{id:4195875351,attribute:"cname",value:this.cname}]:t.type===r.default.MEDIA_TYPE.video&&(p.ssrcs=[{id:1,attribute:"cname",value:this.cname}]));return p},e.prototype.fromNative=function(e,t,n,a){var s=this,c=o.deepClone(e),d=o.find(c.media,function(e){return e.type===r.default.MEDIA_TYPE.audio}),p=o.find(c.media,function(e){return e.type===r.default.MEDIA_TYPE.video}),h={};h[r.default.MODALITY.audio]=d,h[r.default.MODALITY.video]=p,h[r.default.MODALITY.sharing]=p,h[r.default.MODALITY.data]=this.dataMedia;var f={};f[r.default.MEDIA_TYPE.audio]=d,f[r.default.MEDIA_TYPE.video]=p,f[r.default.MEDIA_TYPE.data]=this.dataMedia;var g={};g[r.default.MODALITY.audio]=t.getMediaEntitiesByModality(r.default.MODALITY.audio)[0],g[r.default.MODALITY.video]=t.getMediaEntitiesByModality(r.default.MODALITY.video)[0],g[r.default.MODALITY.sharing]=t.getMediaEntitiesByModality(r.default.MODALITY.sharing)[0],g[r.default.MODALITY.data]=t.getMediaEntitiesByModality(r.default.MODALITY.data)[0],c.media=[],t.getMediaEntities().forEach(function(e){var o,l=n[e.getModality()];!e.isEnabled()||0===h[e.getModality()].port||e!==g[e.getModality()]&&l===r.default.MEDIA_STATE.send?o=u(e.getType(),i.getLabelForModality(e.getModality()),h[e.getModality()].protocol):(l!==r.default.MEDIA_STATE.inactive&&e!==g[e.getModality()]&&(l=r.default.MEDIA_STATE.receive),o=s.splitMedia(e,h[e.getModality()],t.getMediaTracks(),l,f),e!==g[e.getModality()]&&(o.candidates=[]));var d=h[e.getModality()].setup;d&&("actpass"!==d?e.setExtension("setup",d):a&&void 0!==e.getExtension("setup")&&(o.setup="actpass"!==e.getExtension("setup")?e.getExtension("setup"):d)),0===o.port&&e.disable(),c.media.push(o)});var m=l(c);return m&&(m.mids=c.media.map(function(e){return e.mid}).filter(function(e){return e}).join(" ")),c},e.prototype.getVideoSSRC=function(e,t){return void 0===this.videoSSRCs[e.mid]&&(this.videoSSRCs[e.mid]=[]),void 0===this.videoSSRCs[e.mid][t]&&(this.videoSSRCs[e.mid][t]=this.ssrcGenerator.nextVideoStreamSsrc().min),this.videoSSRCs[e.mid][t]},e.prototype.clearSSRCs=function(e){this.videoSSRCs[e.mid]&&delete this.videoSSRCs[e.mid]},e}();function l(e){return e.groups?o.find(e.groups,function(e){return"BUNDLE"===e.type}):null}function u(e,t,n){return{type:e,port:0,label:t,payloads:"36",protocol:n}}t.WebkitSdpTransform=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_ID:{audio:"mainAudio",video:"mainVideo",sharing:"applicationsharingVideo"},STREAM_ID_DELIMITER:"-"}},function(e,t,n){"use strict";var i=n(58),r=function(){function e(e){this.webRtcSender=null,this.configProvider=e.configProvider,this.queue=new i.DTMFQueue(e.logger)}return e.prototype.sendDtmf=function(e,t){return e&&e.getSenders?(this.syncSender(e),this.webRtcSender?(this.webRtcSender.ontonechange=this.onToneChange.bind(this),this.webRtcSender.insertDTMF(this.webRtcSender.toneBuffer+t,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(t)):Promise.reject(new Error("not available"))):Promise.reject(new Error("bad peerConnection"))},e.prototype.canSendDtmf=function(e){return!(!e||!e.getSenders)&&(this.syncSender(e),!!this.webRtcSender&&this.webRtcSender.canInsertDTMF)},e.prototype.dispose=function(){this.queue.cleanup()},e.prototype.syncSender=function(e){var t=e.getSenders().filter(function(e){return e.dtmf&&e.dtmf.canInsertDTMF})[0];this.webRtcSender&&t&&t.dtmf!=this.webRtcSender&&(this.webRtcSender.ontonechange=null,this.queue.cleanup()),this.webRtcSender=t?t.dtmf:null},e.prototype.onToneChange=function(e){e.tone&&this.queue.toneSent(e.tone)},e}();t.WebRtcDTMFSender=r,Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new r(e)}}},function(e,t,n){"use strict";var i=n(171),r=n(3),o=n(8),a=n(56),s=n(182),c=n(158),l=n(164),u=n(2),d=n(180),p=n(121),h=n(110),f=n(122),g=n(31),m=n(68),_=n(57),v=n(59),y=n(172),S=n(166),E=n(169),T=n(17),C=n(13),I=n(165),A=n(162),b=n(66),O=396,R=function(e,t,n){this.configureModalitiesAsync=function(e){var t=Re.then(function(){return new Promise(function(t){if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters!"+JSON.stringify(e));var n=!k||!o.areNegotiatedDirectionsFulfilled(e,ie);k=e,x.safe.log("configure modalities","audio:",e.audio,"video:",e.video,"sharing",e.sharing,"peerconnection:",!!q,"pc.signalingState:",q?q.signalingState:"-","needNewRenegotiation:",n),n&&tt(),t(k)})});return Re=t.catch(function(e){x.safe.warn("Error during configuring modalities: "+e)}),t},this.createOfferAsync=function(){var e=ke.add(function(){return new Promise(function(e){x.safe.log("create [offer] configured: "+k),se=!0,et("no configured modalities to create offer for"),Z=!1,D=o.excludePassiveModalities(k,Pe,M),M=D;var t=o.negotiateModalities(M,D);e(nt(M,!0,!0).then(function(){var e=function(e){function t(e){return!!e&&(o.hasReceiveDirectionality(e)||"inactive"===e)}return{offerToReceiveAudio:+t(e.audio),offerToReceiveVideo:+t(e.video)+ +t(e.sharing)}}(M);return x.safe.log("create [offer] offered: "+M+" constraints: "+e),q.createOffer(e)}).then(function(e){x.unsafe.debug("create [offer] offer from peer connection","sdp:",e.sdp);var t=W.createLocalOffer(e.sdp);t.needToWaitIceCandidates()&&qe(),_e.startWaitingForStreamStart(M);var n=new H.RTCSessionDescription({sdp:t.toLocal(),type:"offer"});return We(),Promise.all([q.setLocalDescription(n),X.promise])}).then(function(){var e=W.createLocalOffer(q.localDescription.sdp);e.updateModalities(M),Ye(e);var n=e.toOffer();return x.unsafe.debug("CREATE OFFER","sdp:",n),{blob:n,contentType:pe,modalities:t}}))})});return it(),e},this.processOfferAsync=function(e){var t=ke.add(function(){return new Promise(function(t){var n=e.blob;x.unsafe.debug("process [offer]","sdp:",n),u.throwIfNotSupported(e.contentType,he),pe=e.contentType,se=!1,w=W.createRemoteOffer(n),Z=!1,M=o.invertModalities(w.getModalities());var i=Promise.resolve(M);if(o.hasSendDirectionality(M.video)||o.hasReceiveDirectionality(M.video)||o.hasSendDirectionality(M.sharing)||o.hasReceiveDirectionality(M.sharing)){var r=w.getVideoCodecs();i=H.RTCRtpReceiver.getCapabilities("video").then(function(e){var t=e.codecs.some(function(e){return r.some(function(t){return e.mimeType===t})});if(!t){x.safe.warn("offer doesn't contain any supported video codecs");var n=u.shallowClone(M);return n.video=void 0,n.sharing=void 0,n}return M}).catch(function(e){return x.safe.error("failed to get video capability "+e),M})}t(i.then(function(e){return x.safe.log("process [offer] offered: "+M+" acceptable: "+e),e}))})});return it(),t},this.createAnswerAsync=function(e){return new Promise(function(t){if(e)t({blob:"",contentType:pe,modalities:{audio:"sendrecv",video:"sendrecv",sharing:"sendrecv"}});else{x.safe.log("create [answer] offered: "+M+" configured: "+k),et("no configured modalities to create answer for"),D=o.excludePassiveModalities(k,Pe,M);var n=o.negotiateModalities(M,D);t(nt(n,!0,!1).then(function(){return ot(w)}).then(function(){return function(){if(w.isCodecSwitchSupported())return Promise.resolve();return H.RTCRtpReceiver.getCapabilities(r.default.MEDIA_TYPE.audio).then(function(e){var t=e.codecs.map(function(e){return e.mimeType});w.usePrimaryAudioCodecOnly(t)}).catch(function(e){x.safe.error("failed to set primary codec based on audio capability "+e)})}()}).then(function(){var e=w.toRemote(n);return x.log("create [answer] set remote description","negotiated:",n,"sdp:",e),q.setRemoteDescription(new H.RTCSessionDescription({sdp:e,type:"offer"}))}).then(function(){return L.callbacks.onTransportInitialized&&L.callbacks.onTransportInitialized(),nt(n,!1,!0)}).then(function(){return q.createAnswer()}).then(function(e){x.unsafe.debug("create [answer] answer from peer connection","sdp:",e.sdp);var t=W.createLocalAnswer(e.sdp);t.needToWaitIceCandidates()&&qe(),_e.startWaitingForStreamStart(n);var i=new H.RTCSessionDescription({sdp:t.toLocal(),type:"answer"});return We(),Promise.all([q.setLocalDescription(i),X.promise])}).then(function(){var e=W.createLocalAnswer(q.localDescription.sdp);e.updateModalities(n),Ye(e);var t=e.toAnswer();return Ve(n=e.getModalities()),x.unsafe.debug("CREATE ANSWER","sdp:",t),{blob:t,contentType:pe,modalities:ie}}))}})},this.processAnswerAsync=function(e,t){return new Promise(function(n){var i=e.blob;if(x.unsafe.debug(t?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",i),u.throwIfNotSupported(e.contentType,he),t)return x.safe.log("process [pranswer] ignored"),void n({});var r=W.createRemoteAnswer(i),a=o.invertModalities(r.getModalities());Ve(a);var s=r.toRemote(ie);x.log("process [answer] set remote description","negotiated:",ie,"sdp:",s),n(q.setRemoteDescription(new H.RTCSessionDescription({sdp:s,type:"answer"})).then(function(){return L.callbacks.onTransportInitialized&&L.callbacks.onTransportInitialized(),ie}).then(function(){return ot(r)}).then(function(e){e&&tt(!0)}).then(function(){return ie}))})},this.completeNegotiationAsync=function(){return new Promise(function(e){B.commit();var t=o.excludePassiveModalities(k,Pe,M),n=ne&&!o.isOnHold(ie)||!o.areNegotiatedDirectionsAcceptable(t,D,ie)||$,i=!n;Z=!0,x.safe.log("negotiation completed isComplete: "+i+" configured: "+k+" negotiating: "+D+" offered: "+M+" negotiated: "+ie),n&&tt(),we.resolve(),e({isComplete:i,activeModalities:ie,offeredModalities:M,attemptedModalities:D,configuredModalities:k,initiator:se})})},this.rejectNegotiationAsync=function(e,t){return new Promise(function(n){B.rollback();var i=!t,r=Promise.resolve();x.safe.warn("negotiation rejected isComplete: "+i+" error: "+e+" configured: "+k+" negotiating: "+D+" offered: "+M+" negotiated: "+ie),q&&("have-local-offer"===q.signalingState?(x.safe.log("rolling back local description"),r=q.setLocalDescription(new H.RTCSessionDescription({type:"rollback"}))):x.safe.error("cannot rollback local description in currrent state: "+q.signalingState)),Z=!0,we.reject("negotiation rejected"),n(r.then(function(){return t&&(x.safe.log("retrying failed negotiation"),tt()),{isComplete:i,activeModalities:ie,offeredModalities:M,attemptedModalities:D,configuredModalities:k,initiator:se}}))})},this.createRemoteRenderer=function(e,t){return new h.default({logger:x,subscriptionManager:me,configProvider:U},e,t,je)},this.getStatsAsync=dt,this.getLastKnownStats=function(){return _e.getLastKnownReport()},this.terminate=function(){return x.safe.log("terminate"),_e.setTerminated(),dt().then(function(){ae=!0,at()},at)},this.isReconnectSupported=function(){return U.config.enableReconnectChrome},this.muteInputAsync=function(){return ut(!0)},this.unmuteInputAsync=function(){return ut(!1)},this.setMuteAsync=ut,this.muteOutputAsync=function(){return Oe.muted=!0,e.config.isSpeakerMuted=!0,Promise.resolve()},this.unmuteOutputAsync=function(){return Oe.muted=!1,e.config.isSpeakerMuted=!1,Promise.resolve()},this.sendDtmf=function(e){return de.sendDtmf(q,e)},this.canSendDtmf=function(){return de.canSendDtmf(q)},this.callbacks={},this.getExtensionsManager=function(){return Le},this._deviceSelectionChanged=function(){q&&(Oe&&Oe.getStream()&&Oe.setOutputDevice(F.getOutputDeviceId()),Te.setCurrentResolution(null),o.isOnHold(ie)||(ne=!0,tt(!0)))},this.clone=function(i){void 0===i&&(i=!1);var r=u.shallowClone(e);r.config=u.shallowClone(e.config),r.config.webrtcMediaContentType=pe,r.config.iceHostCandidateOnly=!1,i&&(r.config.isConference=!0);var o=new R(r,t,n);L.relayManagerProvider&&(o.relayManagerProvider=L.relayManagerProvider);return o.callbacks.onNegotiationRequired=L.callbacks.onNegotiationRequired,o},this.setInternals=function(e){if(e.extensionsManager&&Le){var t=e.extensionsManager.getExtension(r.default.EXTENSION_TYPE.videoStreamControl);t&&t.getOptions()&&Le.configureExtension(r.default.EXTENSION_TYPE.videoStreamControl,t.getOptions())}e.subscriptionManager&&(me&&me.dispose(),(me=e.subscriptionManager).setStreamProvider({getStreams:Fe,onStreamsChanged:He}),Ge())},this.move=function(e){e.setInternals({subscriptionManager:me,extensionsManager:Le}),e.setMuteAsync(J),me=null,L.callbacks.onTerminated=null},this.getConfiguredModalities=function(){return k},this.relayManagerProvider=null,this.getAcceptedTypes=function(){return he},this.selectSharingSource=function(e,t){Ee=t};var P,N,w,M,k,D,L=this,U=e.configProvider,x=e.getLogger().createChild("webrtc"),F=e.getDeviceManager(),H=c.default.build({global:e.maContext,configProvider:U}),G=e.config&&e.config.isConference,j=G&&(e.config.hasOwnProperty("iceHostCandidateOnly")?e.config.iceHostCandidateOnly:U.config.iceHostCandidateOnly),B=new l.default({logger:x,configProvider:U,numVideoChannels:G&&U.config.numVideoChannelsGvc?U.config.numVideoChannelsGvc:1}),V=new g.default,W=s.default.build({sdpTransform:new H.SdpTransform(e.maContext),mediaManager:B,logger:x,configProvider:U}),q=null,z=null,K=null,Y=null,J=e.config.muted,X=new C.SettablePromise,Q=null,$=!1,Z=!0,ee=!1,te=!1,ne=!1,ie={},re=null,oe=Promise.resolve({}),ae=!1,se=!1,ce=null,le=!G||U.config.webrtcMultiPartyVideoScaling,ue=U.config.webrtcVideoScaling,de=d.default.build({logger:x,configProvider:U}),pe=U.config.webrtcMediaContentType,he=U.config.webrtcAllowedMediaContentType,fe=new p.default({streamAdded:function(e){r.default.MODALITY.audio===e.getModality()&&(Oe.play(e.getMediaStream()),Oe.setOutputDevice(F.getOutputDeviceId()));r.default.MODALITY.sharing===e.getModality()&&Ce.watchStream(e.getMediaStream());Ge()},streamRemoved:function(e){r.default.MODALITY.audio===e.getModality()&&Oe.getStream()===e.getMediaStream()&&Oe.stop();r.default.MODALITY.sharing===e.getModality()&&Ce.stopWatchingStream(e.getMediaStream());Ge()}}),ge=!1,me=new f.default({logger:x,configProvider:U},{getStreams:Fe,onStreamsChanged:He}),_e=new E.default(t,{logger:x,configProvider:U}),ve=!1,ye=1,Se=1;_e.onStatisticsChanged(function(e){ve!==e.audioHwSilent&&(ve=e.audioHwSilent,L.callbacks.onAudioHwSilentChanged&&L.callbacks.onAudioHwSilentChanged(ve)),Se!==e.networkRecvLevel&&ze(2,Se=e.networkRecvLevel,!0,0),ye!==e.networkSendLevel&&ze(1,ye=e.networkSendLevel,!0,0)});var Ee,Te=new S.default({logger:x,resolutionTable:V,settings:{videoReceiversCount:U.config.webrtcVideoReceiversCount,bandwidthPerVideoReceiver:U.config.webrtcBandwidthPerVideoReceiver,cooldownTimeout:U.config.webrtcResolutionManagerCooldownTimeout,slidingWindowSamples:U.config.webrtcQualitySlidingWindowSamples,slidingWindowPercentile:U.config.webrtcQualitySlidingWindowPercentile,retryDelay:U.config.webrtcResolutionManagerRetryDelay,scalingEnabled:ue||G,maxResolution:le?null:V.getResolution(O)}},{onOptimalVideoReceiversCountChanged:function(e){n.onOptimalVideoReceiversCountChanged&&n.onOptimalVideoReceiversCountChanged(e)},applyResolution:function(e,t){if(we.isPending)return x.safe.log("##### Renegotiation is in progress, no local resolution switch for now #####"),we.promise.then(function(){return Promise.resolve(!1)});if(!z)return x.safe.log(e+" is ignored as no video is sent, no renegotiation"),Promise.resolve(!0);x.safe.log("Queueing local renegotiation...");var n=!1;return ke.add(function(){return x.safe.log("############# LOCAL RENEGOTIATION START #############"),rt(e,t).then(function(){n=!0})}),De.renegotiate().then(function(){return x.safe.log("############# LOCAL RENEGOTIATION END. RESULT: "+n+"  #############"),n})}},{onStatisticsChanged:function(e){_e.onStatisticsChanged(e)}}),Ce=new i.VideoStreamWatcher({statsGatherer:_e,configProvider:U,logger:x},{onStreamIncomingDecoderFailed:function(){x.safe.warn("ScreenSharing stream decoding failed"),function(){x.safe.warn("Attemping ScreenSharing stream recovery");var e=fe.getStreams().find(function(e){return e.getModality()===r.default.MODALITY.sharing}),t=new b.ModalityToggler(e.getMediaStream().id,x.createChild("SSModalityToggler"));De.renegotiate([t]).then(function(){return x.safe.warn("ScreenSharing recovery: decoder disabled"),De.renegotiate([t])}).then(function(){x.safe.warn("ScreenSharing recovery: decoder should be active again")})}(),L.callbacks.onScreenSharingIncomingDecoderFailed&&L.callbacks.onScreenSharingIncomingDecoderFailed()},onStreamIncomingDecoderActive:function(){L.callbacks.onScreenSharingIncomingDecoderActive&&L.callbacks.onScreenSharingIncomingDecoderActive()},onStreamIncomingDecoderReset:function(){L.callbacks.onScreenSharingIncomingDecoderReset&&L.callbacks.onScreenSharingIncomingDecoderReset()}}),Ie=new Map;var Ae=new _.ActiveSpeakerManager(n.onContributingSourcesChanged,n.onDominantSpeakerChanged),be=new A.ContributingSourcesHandler({activeSpeakerManager:Ae,logger:x,configProvider:U,provider:function(){if(!q)return[];if(q.getReceivers&&G){var e=q.getReceivers().filter(function(e){return"audio"===e.track.kind})[0];if(!e)return[];if(e.getContributingSources)return e.getContributingSources()}}}),Oe=new v.default(x.createChild("AudioRenderer"));e.config.isSpeakerMuted&&(Oe.muted=!0);var Re=Promise.resolve(),Pe=e.config.passiveModalities,Ne={},we=new C.SettablePromise;we.promise.catch(function(){}),we.reject("placeholder");var Me,ke=new T.PromiseQueue(x),De=new I.default(H,W,ke),Le=((Me=new m.default).addExtension(r.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:x,callback:Ae.onDominantSpeakerHistoryChanged.bind(Ae)}),Me.addExtension(r.default.EXTENSION_TYPE.videoStreamControl,{logger:x,negotiationEmulator:De,qualityManager:Te}),Me),Ue=[],xe=U.config.iceTransportPolicyForced||e.config.iceTransportPolicy||r.default.ICE_TRANSPORT_POLICY.all;function Fe(){return fe.getStreams()}function He(e){ce=e}function Ge(){ge||we.promise.catch(function(){}).then(function(){ge=!1,ce&&ce()})}function je(e,t,n){var i=e.getMediaStream();if(i){var r=V.getMaxFS(t,n),o=B.getMediaEntityByStreamId(i.id);if(!o||!o.getVideoCapabilities())return void x.safe.warn("no capabilities for provided modality: "+e.getModality());o.getVideoCapabilities().setMaxFS(r,function(){x.safe.log("updated max-fs video capability to "+r),tt(!0)})}else x.safe.warn("renderer has no stream attached")}function Be(e){x.safe.error("Media error occurred type: "+e.type+" detail: "+e.detail),L.callbacks.onSessionErrorOccurred&&L.callbacks.onSessionErrorOccurred(e)}function Ve(e){ie=e,_e.sessionInfo.setNegotiatedModalities(e)}function We(){N=Date.now();var e=U.config.webrtcIceGatheringTimeoutMs;if(e){Q>0&&clearTimeout(Q);var t=X;Q=setTimeout(function(){Q=0,t.isPending&&(x.safe.warn("ICE candidates gathering terminated due to timeout "+e),t.resolve())},e)}}function qe(){x.safe.log("reset candidate gathering"),X.promise.then(function(){},function(){}),X.reject(new Error("reset candidate gathering")),X=new C.SettablePromise}function ze(e,t,n,i){L.callbacks.onAudioQualityChanged&&L.callbacks.onAudioQualityChanged({type:e,value:t,isLocalSource:n,mediaType:i})}function Ke(e,t){L.callbacks.onAudioQualityChanged&&L.callbacks.onAudioQualityChanged({type:e,value:t?3:1,isLocalSource:!0,mediaType:0})}function Ye(e){if(e.hasIceCandidates()===ee&&(Ke(37,ee=!ee),ee))throw{type:r.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};if(e.hasIceCandidates()&&e.hasRelayIceCandidates()===te){if(!e.hasRelayIceCandidates()&&("connected"===q.iceConnectionState||"completed"===q.iceConnectionState))return;Ke(32,te=!te)}}function Je(e){X.isPending&&(e&&_e.sessionInfo.setRelayCandidateInfo(e),x.safe.info("ICE candidates gathered completely"),X.resolve())}function Xe(){x.safe.log("reset peer connection"),Oe&&Oe.dispose(),de&&(de.dispose(),de=null),q&&q.close(),ct(),st(),lt(),Ce.dispose(),q=null,be.stopPolling(),De.configure(null),P=null,qe(),Z=!0,ie={}}function Qe(){re&&(clearTimeout(re),re=null)}function $e(){var e=q;return e&&("connected"===e.iceConnectionState||"completed"===e.iceConnectionState)}function Ze(){if(!P){if(!L.relayManagerProvider)throw new Error("relay manager provider is not set!");P=L.relayManagerProvider.getRelayManager().queryRelaysAsync("turn",e.config.isRemoteClientLync).then(function(t){if(ae)throw new Error("session already disposed");var n={optional:[]};!function(e){var t;if(w){var n=w.getSrtpInfo();_e.sessionInfo.setOfferedSrtpInfo(n),t=!n.dtls||n.sdes&&U.config.preferSdesSrtp}else t=U.config.preferSdesSrtp;t&&(x.safe.log("configuring peer connection to use sdes"),e.optional.push({DtlsSrtpKeyAgreement:!1})),_e.sessionInfo.setNegotiatedSrtpInfo({dtls:!t,sdes:!!t})}(n),function(e){U.config.webrtcNativeCpuOveruseDisabled&&G&&e.optional.push({googCpuOveruseDetection:!1})}(n),x.safe.log("create peer connection"),q=new H.RTCPeerConnection({iceServers:function(e){return e.reduce(function(e,t){return t.addresses.map(function(n){function i(e,t){return("tls"===t?"turns":"turn")+":"+n+":"+e+(t&&"tls"!=t?"?transport="+t:"")}var r,o=U.config.iceServerTransport;o?(r=[],o.includes("udp")&&t.udpPort&&r.push(i(t.udpPort,"udp")),o.includes("tcp")&&t.tcpPort&&r.push(i(t.tcpPort,"tcp")),o.includes("tls")&&t.tlsPort&&r.push(i(t.tlsPort,"tls"))):r=[i(t.udpPort,"udp"),i(t.tcpPort,"tcp")],e.push({urls:r,credential:t.password,username:t.username})}),e},[])}(t),rtcpMuxPolicy:"require",iceTransportPolicy:xe,bundlePolicy:e.config.bundlePolicy?e.config.bundlePolicy:"max-bundle"},n),De.configure(q),_e.initialize(q),be.startPolling(),q.onnegotiationneeded=function(e){var t=e.target;x.safe.log("onnegotiationneeded signalingState: "+t.signalingState)},q.onsignalingstatechange=function(e){var t=e.target;_e.sessionInfo.setSignalingConnectionState(t.signalingState),x.safe.log("onsignalingstatechange signalingState: "+t.signalingState)},q.onaddstream=function e(t){if(!$e())return x.safe.log("onaddstream handling postponed till PC is connected"),void Ue.push(function(){return e(t)});var n=t.stream;x.safe.log("onaddstream","stream:",n);var i=B.getMediaEntityByStreamId(n.id);if(i||(x.safe.log("cannot find media entity with stream id "+n.id+" trying to fallback"),n.getAudioTracks()[0]&&(i=B.getMediaEntitiesByModality(r.default.MODALITY.audio)[0])),i){var o=function(e,t,n){return new y.default(e,t,n,{requestSource:function e(n,i){return G?ie[t]===r.default.MEDIA_STATE.inactive?a.delay(10).then(function(){return e(n,i)}):we.isPending?we.promise.catch(function(){}).then(function(){return e(n,i)}):Promise.resolve().then(function(){var e=Le.getExtension(r.default.EXTENSION_TYPE.videoStreamControl);return e.requestSource(n,i)}):Promise.resolve()}})}(n,i.getModality(),+i.getXSourceStreamId());fe.add(o)}else x.safe.error("could not find media entity for an added stream: "+n.id)},q.ontrack=function(e){x.safe.log("ontrack track: "+e.track)},q.onremovestream=function e(t){if(!$e())return x.safe.log("onremovestream handling postponed till PC is connected"),void Ue.push(function(){return e(t)});x.safe.log("onremovestream stream: "+t.stream),fe.remove(t.stream.id)},q.onicecandidate=function(e){x.log("onicecandidate candidate: "+e.candidate),X.isPending&&(!e.candidate||j?(e.candidate&&x.log("Not waiting for ICE candidates, hoping that prflx is enough"),Je()):e.candidate.candidate.indexOf("typ relay")>-1&&Je({priority:e.candidate.priority||e.candidate.candidate.split(" ")[3],time:Date.now()-N}))},q.onicegatheringstatechange=function(e){var t=e.target;x.safe.log("onicegatheringstatechange iceGatheringState: "+t.iceGatheringState)},q.oniceconnectionstatechange=function(e){var t=e.target;ae||(_e.sessionInfo.setIceConnectionState(t.iceConnectionState),x.safe.log("oniceconnectionstatechange iceConnectionState: "+t.iceConnectionState+" pc.signalingState: "+t.signalingState),"connected"===t.iceConnectionState||"completed"===t.iceConnectionState?function(){for(x.safe.log("audio transport connected");Ue.length;)Ue.shift()();L.callbacks.onAudioStateChanged(r.default.STREAMING_STATE.active),L.callbacks.onTransportConnected&&L.callbacks.onTransportConnected()}():"failed"===t.iceConnectionState&&Be({type:r.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"}),"disconnected"===t.iceConnectionState?U.config.iceDisconnectedTimeoutMs&&(re=setTimeout(function(){x.safe.error("ice disconnected for "+U.config.iceDisconnectedTimeoutMs+"ms. Raise CONSTANTS.MEDIA_ERROR.iceConnectionError"),Be({type:r.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"})},U.config.iceDisconnectedTimeoutMs)):Qe())}})}return P}function et(e){if(!k)throw new Error(e)}function tt(e){Z?(Z=!1,$=!1,x.safe.log("triggering renegotiation"),B.backup(),L.callbacks.onNegotiationRequired&&L.callbacks.onNegotiationRequired()):e&&(x.safe.log("renegotiation postponed"),$=!0)}function nt(t,n,i){var a=o.hasSendDirectionality(ie.audio),s=o.hasSendDirectionality(ie.video),c=o.hasSendDirectionality(ie.sharing),l=o.isOnHold(ie),d=o.hasSendDirectionality(t.audio),p=o.hasSendDirectionality(t.video),h=o.hasSendDirectionality(t.sharing),f=o.isOnHold(t);if(o.hasSendDirectionality(t.sharing)&&!e.configProvider.config.webrtcOutgoingScreenSharingEnabled)throw new Error("unsupported shreensharing send directionality in modalities "+JSON.stringify(t));return Ze().then(function(){if(x.safe.log("updatePeerConnectionStreamsAsync","pc state",q.signalingState,"hold","[",l,"->",f,"]","audio","[",a,"->",d,"]","video","[",s,"->",p,"]","sharing","[",c,"->",h,"]"),(l===f||(z&&z.setHold(f),K&&K.setHold(f),Y&&Y.setHold(f),!f))&&(a!==d||s!==p||c!==h||ne)){i&&(ne=!1);var e=function(){g(r.default.MODALITY.audio)},t=function(){g(r.default.MODALITY.video)},o=function(){g(r.default.MODALITY.sharing)},g=function(e){e in Ne&&(x.safe.log("remove sender track kind: "+Ne[e].track.kind+" track id: "+Ne[e].track.id),q.removeTrack(Ne[e]),delete Ne[e])},m=function(e,t,n){if(e){if(x.safe.log("add media track kind: "+e.kind+" id: "+e.id),Ne[n])throw new Error("track already created, modality:"+n+", kind:"+e.kind+", id:"+e.id);Ne[n]=q.addTrack(e,t)}},_=function(){var e;B.setMediaTracks((e=[],u.forOwn(Ne,function(t,n){e.push({track:t.track.id,modality:n})}),e)),_e.setMediaEntities(B.getMediaEntities())};if(n&&(x.safe.log("not using any media(track api) track, remove all senders"),d||(e(),ct()),i&&p||(t(),st()),i&&h||(o(),lt())),i){var v=[];if(p){var y=F.getVideoStream();v.push(y.start().then(function(){try{if(t(),st(),!q)return void y.dispose();m(y.rawStream.getVideoTracks()[0],y.rawStream,r.default.MODALITY.video),y.onApplyConstraints=function(e){t(),e.then(function(){m(y.rawStream.getVideoTracks()[0],y.rawStream,r.default.MODALITY.video),_()})},z=y}catch(e){throw t(),st(),y.dispose(),e}}))}if(d){var S=F.getAudioStream();v.push(S.start().then(function(){try{K&&S.isSameStream(K)?S.dispose():(e(),ct(),m(S.rawStream.getAudioTracks()[0],S.rawStream,r.default.MODALITY.audio),S.setMuted(J),K=S)}catch(t){throw e(),ct(),S.dispose(),t}}))}if(h){var E=F.getDisplayStream();!function(e){t=e,Ie.has(t)&&function(e){Ie.get(e).dispose(),Ie.delete(e)}(e);var t;Ie.set(e,e.on("onStreamStarted",function(e){Ee&&Ee.onSharingStateChanged&&Ee.onSharingStateChanged("active")})),Ie.set(e,e.on("onStreamEnded",function(e){Ee&&Ee.onSharingStateChanged&&Ee.onSharingStateChanged("stopped")}))}(E),v.push(E.start().then(function(){try{Y&&E.isSameStream(Y)||(o(),m(E.rawStream.getVideoTracks()[0],E.rawStream,r.default.MODALITY.sharing),Y=E)}catch(e){throw o(),lt(),E.dispose(),e}}))}return Promise.all(v).then(function(){return _()})}}})}function it(){we.reject("promise expired"),we=new C.SettablePromise,ke.add(we)}function rt(e,t){return z?(x.safe.log("Changing resolution to "+e+"@"+t),z.applyConstraints({maxFS:e.fs,maxFPS:t}).then(function(t){return Te.setCurrentResolution(e),t})):(x.safe.log("Resolution "+e+"@"+t+" ignored, no video is being sent"),Promise.resolve(!1))}function ot(e){if(U.config.enableLocalVideoConstraints&&o.hasReceiveDirectionality(e.getModalities().video)){var t=e.getVideoRecvCapabilities();if(t.maxFS&&t.maxFPS){Te.setMaxCapabilities(t);var n=z&&z.hasVideo(),i=!le&&Te.getCurrentResolution()&&180===Te.getCurrentResolution().height;if(!n||Te.getActive()||i)return Promise.resolve(!1);var r=V.getResolution(t.maxFS);return le||180===r.height||(r=V.getResolution(O)),rt(r,t.maxFPS)}x.safe.error("remote endpoint didn't specify video receive capability")}return Promise.resolve(!1)}function at(){_e.dispose(),Ae.dispose(),Xe(),me&&me.dispose(),Qe(),Le&&Le.dispose(),L.callbacks.onTerminated&&L.callbacks.onTerminated(),n=null}function st(){z&&(z.dispose(),z=null),Te.setCurrentResolution(null)}function ct(){K&&(K.dispose(),K=null)}function lt(){Y&&(Y.dispose(),Y=null)}function ut(e){return J=e,K&&K.setMuted(e),Promise.resolve()}function dt(){return ae||(oe=oe.then(function(){return _e.getReport()}).then(function(e){return e}).catch(function(e){return x.safe.error("getting statistics should never fail: "+e),{}})),oe}};Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t,n){return new R(e,t,n)}}},function(e,t,n){"use strict";var i=n(11),r=n(3),o=n(8),a=n(175),s=n(16),c=n(15);function l(e,t,n,l){var u,h=e.mediaManager,f=e.sdpTransform,g=i.parse(n),m=new a.default(e);function _(e){e.media.forEach(function(e,t){var n=h.getMediaEntity(t);if(n.getType()===r.default.MEDIA_TYPE.video)return c.forCodec(e,{name:"h264",rate:9e4},function(e){var t=n.getVideoCapabilities();if(t){e.fmtp=e.fmtp||{payload:e.rtp.payload};var i=s.default.build(e.fmtp.config);i.setIfMissing("profile-level-id","42C02A"),i.setIfMissing("max-fs",t.getMaxFS().toString()),i.setIfMissing("max-fps",t.getMaxFPS().toString()),e.fmtp.config=i.toString()}}),!0})}this.getModalities=function(){return u||c.getModalities(g)},this.updateModalities=function(e){u=e},this.getSrtpInfo=function(){return o.getSrtpInfo(g)},this.getVideoCodecs=function(){var e={};g.media.forEach(function(t){"video"===t.type&&t.rtp.map(function(e){return e.codec.toLowerCase()}).forEach(function(t){e[t]=!0})});var t=[];for(var n in e)t.push(n);return t},this.usePrimaryAudioCodecOnly=function(e){var t=["cn","telephone-event"];g.media.forEach(function(n){if(n.type===r.default.MEDIA_TYPE.audio){var i=n.rtp.filter(function(n){return-1!==e.indexOf(n.codec.toLowerCase())&&-1===t.indexOf(n.codec.toLowerCase())});if(0===i.length)throw new Error("there is no matching primary audio codec");n.rtp.filter(function(e){return e!==i[0]&&-1===t.indexOf(e.codec.toLowerCase())}).forEach(function(e){c.removeCodec(n,e)})}})},this.isCodecSwitchSupported=function(){return!g.media.some(function(e){return e.type===r.default.MEDIA_TYPE.audio&&e.xMediaSettings&&(t=e.xMediaSettings,n="codecswitchunsupported",t.some(function(e){return-1!==e.settings.indexOf(n)}));var t,n})},this.toLocal=function(){return g=f.toLocal(g,h,u),i.write(g)},this.toOffer=function(){return p(g,function(t,n){d(e,n)}),h.isEmpty()&&h.fromOffer(g,u),h.syncModalities(u,!1),g=f.toOffer(g,h,u),e.configProvider.config.disableMsSdp||m.toMsSdp(g,{type:t}),_(g),u=c.getModalities(g),i.write(g)},this.toAnswer=function(){return p(g,function(t,n){d(e,n)}),h.syncModalities(u,!0),g=f.toAnswer(g,h,u),e.configProvider.config.disableMsSdp||m.toMsSdp(g,{type:t}),_(g),u=c.getModalities(g),i.write(g)},this.toRemote=function(e){return u=e,h.fromRemote(g,u),g=f.toRemote(g,h,u),i.write(g)},this.getVideoRecvCapabilities=function(){var e={};return g.media.filter(function(e){return"video"===e.type}).some(function(t){return c.forCodec(t,{name:"h264",rate:9e4},function(t){if(t.fmtp){var n=s.default.build(t.fmtp.config),i=+n.get("max-fs");!isNaN(i)&&i&&(e.maxFS=i);var r=+n.get("max-fps");!isNaN(r)&&r&&(e.maxFPS=r/100)}}),!0}),e},this.needToWaitIceCandidates=function(){if(e.bundled){var t=c.getBundle(g);return t&&9===t.port}return g.media.some(function(e){return 9===e.port})},this.hasIceCandidates=function(){return!!g.media&&g.media.some(function(e){return!!e.candidates&&0!==e.candidates.length})},this.hasRelayIceCandidates=function(){return this.hasIceCandidates()&&g.media.some(function(e){return!!e.candidates&&e.candidates.some(function(e){return"relay"===e.type})})},l&&!e.configProvider.config.disableMsSdp&&m.fromMsSdp(g,{type:t}),"answer"===t&&g.groups&&(e.bundled=!0)}function u(e,t,n,r){var o=new a.default(e),s=i.parse(n);return p(s,function(t,n){0===n.port||r[t]||function(e){for(var t in e.port=0,e)e.hasOwnProperty(t)&&["type","port","protocol","payloads","connection","direction"].indexOf(t)<0&&(delete e[t],e.direction="inactive")}(n),n.direction="inactive",d(e,n)}),e.configProvider.config.disableMsSdp||o.toMsSdp(s,{type:t}),i.write(s)}function d(e,t){t.candidates&&(e.configProvider.config.iceCandidateType||e.configProvider.config.iceCandidateTransport)&&(t.candidates=t.candidates.filter(function(t){var n=!0,i=!0;return e.configProvider.config.iceCandidateType&&(n=t.type.match(new RegExp(e.configProvider.config.iceCandidateType),"i")),e.configProvider.config.iceCandidateTransport&&(i=t.transport.match(new RegExp(e.configProvider.config.iceCandidateTransport,"i"))),n&&i}))}function p(e,t){for(var n=0;n<e.media.length;n++)"audio"===e.media[n].type?t(r.default.MEDIA_TYPE.audio,e.media[n]):"video"===e.media[n].type&&t(r.default.MEDIA_TYPE.video,e.media[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return e=e||{},{createLocalOffer:function(t){return new l(e,"offer",t)},createRemoteOffer:function(t){return new l(e,"offer",t,!0)},createLocalAnswer:function(t){return new l(e,"answer",t)},createRemoteAnswer:function(t){return new l(e,"answer",t,!0)},createInactiveOfferSdp:u.bind(null,e,"offer"),createInactiveAnswerSdp:u.bind(null,e,"answer")}}}},function(e,t,n){"use strict";var i=n(1),r=n(7),o=n(4),a=function(){function e(e,t){var n=this;this.broadcastContext=null,this.broadcastControllerUrl="",this.broadcastCallbackUrl="",this.broadcastState=null,this.setContext=function(e){void 0===e&&(e=null),n.logger.log("BroadcastSession :: set broadcast context",e),n.broadcastContext=e},this.getContext=function(){return n.logger.log("BroadcastSession :: get broadcast context",n.broadcastContext||null),n.broadcastContext||null},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[Broadcast]"})}return e.prototype.handleBroadcastStateChanged=function(e){var t=e.body;this.broadcastState=t,this.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.BROADCAST_STATE_CHANGED,e),this.logger.log("BroadcastSession :: broadcast state changed",this.broadcastState),this.updateBroadcastMetadata()},e.prototype.updateBroadcastCallbackUrl=function(){var e=o.get(this.signalingSession,i.URL_PATH.CONV_BROADCAST_UPDATE);this.broadcastCallbackUrl!==e&&(this.broadcastCallbackUrl=e,this.logger.log("BroadcastSession :: broadcast callback url changed",this.broadcastCallbackUrl),this.updateBroadcastMetadata())},e.prototype.handleBroadcastDetailsChanged=function(e){e.activeModalities&&e.activeModalities.broadcast&&e.activeModalities.broadcast.controller!==this.broadcastControllerUrl&&(this.broadcastControllerUrl=e.activeModalities.broadcast.controller,this.logger.log("BroadcastSession :: broadcast controller changed",this.broadcastControllerUrl),this.updateBroadcastMetadata()),!this.broadcastControllerUrl||e.activeModalities&&e.activeModalities.broadcast||(this.broadcastControllerUrl="",this.logger.log("BroadcastSession :: broadcast controller changed",this.broadcastControllerUrl),this.updateBroadcastMetadata())},e.prototype.updateBroadcastMetadata=function(){var e={broadcastControllerUrl:this.broadcastControllerUrl,broadcastStateCallbackUrl:this.broadcastCallbackUrl,broadcastState:this.broadcastState};this.logger.log("BroadcastSession :: update broadcast metadata",e),this.signalingSessionCallback.onBroadcastDetailsUpdated&&this.signalingSessionCallback.onBroadcastDetailsUpdated(e)},e}();t.__esModule=!0,t.default=a},function(e,t,n){"use strict";var i=n(72),r=n(1),o=n(0),a=n(19),s=n(7),c="http://broker.invalid/",l=30,u=5,d=7,p=6,h=function(){function e(e){var t=this;this._signalingSession=e,this.baseUrl=c,this._currentSubscriptionTimeoutInSec=l,this._subscribers=[],this._disposed=!1,this._reportedResultCount=0,this._subscriptionAttemptCount=0,this._subscriptionRetryBackoffInSec=u,this._notifySubscribers=function(e){t._logger.log("_notifySubscribers"),Promise.resolve().then(function(){e.split(",").forEach(function(e){var n=o.decodeMessage(e),i=o.parseRawHttpMessage(n),r=i.body;o.isEncodedMessage(i.headers)&&o.isMessageEncodingSupported(i.headers)&&(r=o.decodeMessage(r));var a={url:i.url,body:JSON.parse(r),headers:i.headers};t._logger.log("_notifySubscribers, parsed request",a,", n. of subscribers",t._subscribers.length),t._subscribers.forEach(function(e){return e(a)})})}).catch(function(e){t._logger.error("_notifySubscribers, failed to decode message",e),t._signalingSession.telemetryHelper.recordEvent(s.EVENTS.BROKER_DECODE_PAYLOAD_FAILURE)})},this._subscribeToBroker=function(e,n){t._disposed?t._logger.warn("_subscribeToBroker, disposed, ignore subscription"):(t._logger.log("_subscribeToBroker, url: ",e,",timeout in sec",n),t._currentSubscriptionUrl=e,t._currentSubscriptionTimeoutInSec=n,t._subscribeStopWatch=a.build(),t._subscriptionAttemptCount++,t._clearAllPendingTimeouts(),t._setSubscriptionTimeout(n),t._signalingSession.http.sendGetRequest({url:t._currentSubscriptionUrl,requestName:s.NETWORK_REQUESTS.BROKER_SUBSCRIBE,customHeaders:t._getBrokerRequestHeaders(),payload:null,retryIntervals:[100,200,500]}).then(t._handleSubscriptionSuccess).catch(t._handleSubscriptionFailure))},this._clearAllPendingTimeouts=function(){t._cancelRequestTimer&&(t._cancelRequestTimer.stop(),t._cancelRequestTimer=null),t._retryRequestTimer&&(t._retryRequestTimer.stop(),t._retryRequestTimer=null)},this._abortPendingRequest=function(){t._signalingSession.http.cancelRequestIfPending(s.NETWORK_REQUESTS.BROKER_SUBSCRIBE)},this._setSubscriptionTimeout=function(e){t._cancelRequestTimer=i.TimerFactory.build(function(){t._disposed||(t._signalingSession.http.hasPendingRequest(s.NETWORK_REQUESTS.BROKER_SUBSCRIBE)?(t._logger.warn("timeout subscription"),t._signalingSession.telemetryHelper.recordEvent(s.EVENTS.BROKER_SUBSCRIPTION_TIMEOUT),t._signalingSession.http.cancelRequestIfPending(s.NETWORK_REQUESTS.BROKER_SUBSCRIBE)):t._logger.error("Unable to resolve timeout deferred, it is not defined!"))}).start(1e3*e)},this._handleSubscriptionSuccess=function(e){if(t._logger.log("_handleSubscriptionSuccess"),t._disposed)t._logger.warn("_handleSubscriptionSuccess, disposed, ignore subscription success");else if(t._reportSubscriptionInTelemetry(e)&&t._signalingSession.telemetryHelper.recordEvent(s.EVENTS.BROKER_SUBSCRIPTION_SUCCESSFUL),t._subscriptionAttemptCount=0,e&&e.response){var n=e.response;t._logger.log("_handleSubscriptionSuccess, response",n),n.message&&t._notifySubscribers(n.message);var i=n.nextSubscribeUrl||t._currentSubscriptionUrl,r=n.expirationTimeInSec||t._currentSubscriptionTimeoutInSec;t._subscribeToBroker(i,r)}},this._handleSubscriptionFailure=function(e){if(t._disposed)t._logger.warn("_handleSubscriptionFailure, disposed, ignore subscription");else if(t._subscriptionAttemptCount>p)t._logger.warn("_handleSubscriptionFailure, reached max subscription attempt, stop subscribing");else{var n=o.getPrintableObject(e);t._logger.error("_handleSubscriptionFailure failed",n),t._reportSubscriptionInTelemetry()&&t._signalingSession.telemetryHelper.recordEvent(s.EVENTS.BROKER_SUBSCRIPTION_FAILED),t._retryRequestTimer=i.TimerFactory.build(function(){t._subscribeToBroker(t._currentSubscriptionUrl,t._currentSubscriptionTimeoutInSec)}).start(1e3*t._subscriptionRetryBackoffInSec)}},this._reportSubscriptionInTelemetry=function(e){return t._reportedResultCount++,t._reportedResultCount<=d},this._getBrokerRequestHeaders=function(){var e={};return e[r.default.HEADERS.CORRELATION_ID]=t._signalingSession.correlationId,e[r.default.HEADERS.MESSAGE_ID]=o.newGuid(),e[r.default.HEADERS.CLIENT_USER_AGENT]=t._signalingSession.signalingAgentConfig.clientInformation,e[r.default.HEADERS.CONTENT_TYPE]=r.default.CONTENT_TYPE.JSON,t._signalingSession.signalingAgentConfig.brokerRequestBatching&&(e[r.default.HEADERS.BROKER_USE_BATCHING_HEADER_NAME]="1"),e},this._logger=this._signalingSession.logger.createChild("Broker"),this._signalingSession.signalingAgentConfig.brokerRetryBackoffInSec&&(this._subscriptionRetryBackoffInSec=this._signalingSession.signalingAgentConfig.brokerRetryBackoffInSec)}return e.prototype.subscribeToBroker=function(e){this._abortPendingRequest(),this._clearAllPendingTimeouts(),this._subscribeToBroker(e,this._currentSubscriptionTimeoutInSec)},e.prototype.onBrokerMessage=function(e){this._logger.log("onBrokerMessage",e),this._subscribers.push(e)},e.prototype.dispose=function(){this._disposed=!0,this._logger.log("dispose"),this._subscribers=[],this._clearAllPendingTimeouts(),this._abortPendingRequest()},e}();t.__esModule=!0,t.default=h},function(e,t,n){"use strict";var i=n(1),r=n(0),o=n(186),a=function(){function e(e,t){var n=this;this.disposed=!1,this.contentSharingToStartCallWith=null,this.contentSharingSessions={},this.DEFAULT_STOP_REASON={code:i.default.CALL_END_CODE.SUCCESS,subCode:i.default.CALL_END_SUB_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.REMOTE_USER_INITIATED},this.DEFAULT_STOP_ID="8:unknown",this.deleteContentSharingAsync=function(e){n.logger.log("deleteContentSharingAsync");var t=r.defer(),i=n.contentSharingSessions[e];if(n.pendingSessionToStart&&n.pendingSessionToStart.correlationId===e&&(i=n.pendingSessionToStart),i){var o=function(){n.contentSharingSessions[e]&&delete n.contentSharingSessions[e]};i.delete(t).then(o,o)}else n.rejectBecauseOfMissingSession(e,t);return t.promise},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[ContentSharingManager]"})}return e.prototype.startContentSharingAsync=function(e,t,n,a,s,c){var l=this;if(this.logger.log("startContentSharingAsync called for: "+e),this.pendingSessionToStart){var u="There is already a ContentSharing session start pending";return this.logger.error(u),Promise.reject(new Error(u))}var d={contentIdentifier:e,subject:n||null,sessionState:t||null,sequenceNumber:1},p=r.defer(),h=new o.ContentSharingSession(this.signalingSession,c||r.newGuid());return this.pendingSessionToStart=h,s?(this.logger.log("Call connected, send content sharing request out immediately"),h.start(a,d,p)):(this.logger.log("Content sharing is to be started when startOutgoingCall is called"),h.addSessionPromise=p,h.fsmState=i.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED,this.contentSharingToStartCallWith=d),p.promise.then(function(){l.contentSharingSessions[h.correlationId]=h,l.pendingSessionToStart=null}).catch(function(){l.pendingSessionToStart=null}),p.promise},e.prototype.joinContentSharingAsync=function(e){this.logger.log("joinContentSharingAsync");var t=r.defer(),n=this.contentSharingSessions[e];return n?n.join(t):this.rejectBecauseOfMissingSession(e,t),t.promise},e.prototype.updateContentSharingSessionStateAsync=function(e,t){this.logger.log("updateContentSharingSessionStateAsync: sessionState = "+JSON.stringify(t));var n=r.defer(),i=this.contentSharingSessions[e];return i?i.updateSessionState(t,n):this.rejectBecauseOfMissingSession(e,n),n.promise},e.prototype.takeContentSharingControlAsync=function(e){this.logger.log("takeContentSharingControlAsync");var t=r.defer(),n=this.contentSharingSessions[e];return n?n.takeControl(t):this.rejectBecauseOfMissingSession(e,t),t.promise},e.prototype.updateContentSharingParticipantStateAsync=function(e){this.logger.log("updateContentSharingParticipantStateAsync");var t=r.defer(),n=this.contentSharingSessions[e];return n?n.updateParticipantState(t):this.rejectBecauseOfMissingSession(e,t),t.promise},e.prototype.updateContentSharingNotificationLinksAsync=function(){for(var e in this.logger.log("updateContentSharingNotificationLinksAsync"),this.contentSharingSessions)if(this.contentSharingSessions.hasOwnProperty(e)){var t=this.contentSharingSessions[e];t&&t.updateNotificationLinks()}},e.prototype.getContentSharingInfoToStartSharing=function(){if(this.contentSharingToStartCallWith){var e=this.pendingSessionToStart,t=i.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED;e&&e.fsmState===t||(this.contentSharingToStartCallWith=null,this.pendingSessionToStart=null)}return this.contentSharingToStartCallWith},e.prototype.dispose=function(e){for(var t in this.logger.log("dispose"),this.disposed=!0,this.contentSharingSessions)if(this.contentSharingSessions.hasOwnProperty(t)){var n=this.contentSharingSessions[t];n&&n.dispose(e)}},e.prototype.handleContentSharingUpdate=function(e){var t=e.body;this.logger.log("handleContentSharingUpdate :",r.getPrintableObject(t));var n=this.contentSharingSessions[t.contentSharingCorrelationId];n?n.handleUpdate(t)&&this.signalingSessionCallback.onContentSharingUpdated({sessionId:t.sessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:t.presenter.id,subject:t.subject||null,sessionState:t.sessionState||null}):this.logger.log("Ignoring contentSharingUpdate: no session with correlation ID "+t.correlationId)},e.prototype.handleAddModalitySuccess=function(e){this.logger.log("handleAddModalitySuccess");var t=this.pendingSessionToStart;t?t.handleAddModalitySuccess(e):this.logger.log("Ignoring handleAddModalitySuccess because not waiting for one")},e.prototype.handleAddModalityFailure=function(e){this.logger.log("handleAddModalityFailure");var t=this.pendingSessionToStart;t?t.handleAddModalityFailure(e):this.logger.log("Ignoring handleAddModalityFailure because not waiting for one")},e.prototype.handleIncomingContentSharingFromRoster=function(e){this.logger.log("handleIncomingContentSharingFromRoster");var t=this.parseSessionsFromRoster(e);this.stopSessionsFromRoster(t),this.startSessionsFromRoster(t)},e.prototype.handleContentSharingEnd=function(e){var t=e.body;this.logger.log("handleContentSharingEnd : ",r.getPrintableObject(t));var n=this.contentSharingSessions[t.contentSharingCorrelationId];if(n){if(n.handleStop(t)){var i={code:t.contentSharingTransactionEnd.code,subCode:t.contentSharingTransactionEnd.subCode,phrase:t.contentSharingTransactionEnd.phrase};this.raiseContentSharingStopped(t.contentSharingCorrelationId,t.presenter.id,i)}}else this.logger.log("Ignoring contentSharingEnd since there is no corresponding sharing ongoing")},e.prototype.parseSessionsFromRoster=function(e){var t=function(e){return e.contentSharing&&e.contentSharing.sessionInformation&&"presenter"===e.contentSharing.sessionInformation.role},n={};for(var i in e.participants){var r=void 0,o=void 0,a=!1,s=this.signalingSession.participantManager.localParticipant.participantId,c=e.participants[i];if(c.endpoints){for(var l in c.endpoints){var u=c.endpoints[l];if(t(u)&&(r=c.details.id,o=u.contentSharing.sessionInformation,a=u.participantId===s))break}r&&(n[o.contentSharingCorrelationId]={presenterId:r,sessionInfo:o,selfEndpointIsPresenter:a})}}return n},e.prototype.stopSessionsFromRoster=function(e){for(var t in this.contentSharingSessions){var n=this.contentSharingSessions[t],i=e[t];n&&!i&&(this.logger.log("An ongoing content sharing session was stopped. Raising ContentSharingStopped"),n.handleStopFromRoster(this.DEFAULT_STOP_REASON),this.raiseContentSharingStopped(n.correlationId))}},e.prototype.startSessionsFromRoster=function(e){for(var t in e){var n=this.contentSharingSessions[t],i=e[t];if(this.pendingSessionToStart&&this.pendingSessionToStart.correlationId===t?this.pendingSessionToStart.confirmInRoster():n&&n.confirmInRoster(),n)n&&this.logger.log("Session "+t+" is already present locally");else{if(i.selfEndpointIsPresenter){this.logger.log("This endpoint is presenting, dont fire callback");continue}this.logger.log("New sharing session found. Raising ContentSharingStarted"),this.raiseContentSharingStarted(i.presenterId,i.sessionInfo).handleStartFromRoster(i.presenterId)}}},e.prototype.raiseContentSharingStopped=function(e,t,n){this.logger.log("raiseContentSharingStopped"),this.signalingSessionCallback.onContentSharingStopped({sessionId:this.contentSharingSessions[e].sessionId,correlationId:e,endedBy:t||this.DEFAULT_STOP_ID,reason:n||this.DEFAULT_STOP_REASON}),delete this.contentSharingSessions[e]},e.prototype.raiseContentSharingStarted=function(e,t){this.logger.log("raiseContentSharingStarted");var n=new o.ContentSharingSession(this.signalingSession,t.contentSharingCorrelationId,t.contentSharingSessionId,((r={})[i.default.LINKS.CONTENT_SHARING_CONTROLLER]=t.contentSharingController,r));this.contentSharingSessions[n.correlationId]=n;var r,a={sessionId:t.contentSharingSessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:e,subject:t.subject||null,sessionState:t.sessionState||null};return this.signalingSessionCallback.onContentSharingStarted(a),n},e.prototype.rejectBecauseOfMissingSession=function(e,t){var n="There is no ContentSharing session with the correlation ID "+e;this.logger.error(n),t&&t.reject(new Error(n))},e}();t.__esModule=!0,t.default=a},function(e,t,n){"use strict";var i=n(192),r=n(205),o=n(208),a=n(19),s=n(221),c=n(226),l=n(227),u=n(228),d=n(0),p=n(1),h=n(7),f=function(){function e(e,t,n,i){var r=this;this.signalingSession=e,this.correlationId=t,this.sessionId=null,this.fsmState=p.default.CONTENT_SHARING_FSM_STATE.IDLE,this.addSessionPromise=null,this.removeSessionPromise=null,this.confirmInRosterPromise=null,this.links={},this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.disposed=!1,this.isPresenter=!1,this.FSM_STATES=p.default.CONTENT_SHARING_FSM_STATE,this.logger=e.logger.createChild(function(){return"["+r.fsmState+"][cs="+r.sessionId+"][cc="+r.correlationId+"]"}),n&&(this.sessionId=n),i&&(this.links=i)}return e.prototype.start=function(e,t,n){var r=this;return this.logger.log("start"),d.assertNotNullOrEmpty(e,"Correct addModality url is not provided"),this.checkState("start",this.FSM_STATES.IDLE,this.addSessionPromise)?(this.addSessionPromise=n,this.confirmInRosterPromise=d.defer(),this.fsmState=this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.addTelemetryOperation(h.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY),this.signalingSession.http.sendPostRequest({url:e,payload:i.getPayload(this.signalingSession,t),requestName:h.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY,contentSharingCorrelationId:this.correlationId,onceTrouterReady:function(){return r.startContentSharingTimer()}}).then(function(){r.disposed||(r.isPresenter=!0)}).catch(function(e){var t=d.getPrintableObject(e);return r.logger.error("start failed because: "+t),r.disposed||(r.signalingSession.timeoutManager.stopTimer(p.default.TIMEOUT_OPERATIONS.ADD_MODALITY),r.rejectPendingPromise(t,d.getErrorForXHRFailure(e).error)),Promise.reject(null)})):Promise.reject(null)},e.prototype.delete=function(e){var t=this;this.logger.log("delete");var n=!1;if(this.fsmState===this.FSM_STATES.IDLE)return this.logger.log("delete skipped because state is already "+this.fsmState),e.resolve(),Promise.resolve();if(this.fsmState===this.FSM_STATES.CONTENT_SHARING_START_INITIATED)n=!0,this.rejectPendingPromise("Session delete called before start was finished");else if(!this.checkState("delete",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return Promise.reject(null);n||d.assertNotNullOrEmpty(this.links[p.default.LINKS.CONTENT_SHARING_CONTROLLER],"Correct controller url is not set"),this.removeSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_DELETE_INITIATED;var i=a.build(),r=this.addTelemetryOperation(h.NETWORK_REQUESTS.DELETE_CONTENT_SHARING);return(n?Promise.resolve():this.signalingSession.http.sendDeleteRequest({url:this.links[p.default.LINKS.CONTENT_SHARING_CONTROLLER],requestName:h.NETWORK_REQUESTS.DELETE_CONTENT_SHARING,payload:o.getPayload(this.signalingSession,{code:p.default.CALL_END_CODE.SUCCESS,subCode:p.default.CALL_END_SUB_CODE.SUCCESS,phrase:p.default.CALL_END_PHRASE.LOCAL_USER_INITIATED})})).then(function(){if(!t.disposed){var e={success:!0,duration:i.duration()};n&&(e.skipReason="Session delete called before start was finished"),t.updateTelemetryOperation(r,e),t.fsmState=t.FSM_STATES.IDLE,t.resolvePendingPromise()}}).catch(function(e){if(t.logger.error("delete failed because: "+d.getPrintableObject(e)),!t.disposed){var n={success:!1,duration:i.duration()};t.updateTelemetryOperation(r,n),t.fsmState=t.FSM_STATES.IDLE,t.resolvePendingPromise()}return Promise.reject(null)})},e.prototype.join=function(e){var t=this;if(this.logger.log("join"),d.assertNotNullOrEmpty(this.links[p.default.LINKS.CONTENT_SHARING_CONTROLLER],"Correct joinContentSharing url is not provided"),this.checkState("join",this.FSM_STATES.IDLE,e)){this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.addSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_JOIN_INITIATED;var n=a.build(),i=this.addTelemetryOperation(h.NETWORK_REQUESTS.JOIN_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[p.default.LINKS.CONTENT_SHARING_CONTROLLER],payload:r.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.JOIN_CONTENT_SHARING}).then(function(e){if(!t.disposed){var r={success:!0,duration:n.duration()};t.updateTelemetryOperation(i,r),t.processStartOrJoinSuccess(e.response),t.resolvePendingPromise(e.response)}}).catch(function(e){var r=d.getPrintableObject(e);if(t.logger.error("join failed because: "+r),!t.disposed){var o={success:!1,duration:n.duration()};t.updateTelemetryOperation(i,o);var a=d.getErrorForXHRFailure(e).error;t.rejectPendingPromise(r,a)}})}},e.prototype.takeControl=function(e){var t=this;if(this.logger.log("takeControl"),d.assertNotNullOrEmpty(this.links[p.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],"correct contentSharingTakeControl url is not provided"),this.checkState("takeControl",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e)){var n=a.build(),i=this.addTelemetryOperation(h.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[p.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],payload:s.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING,withoutTrouter:!0}).then(function(r){if(!t.disposed){var o={success:!0,duration:n.duration()};t.updateTelemetryOperation(i,o),e.resolve({contentIdentifier:r.response.identifier,presenter:r.response.presenter.id,subject:r.response.subject||null,sessionState:r.response.sessionState||null})}}).catch(function(r){var o=d.getPrintableObject(r);if(t.logger.error("takeControl failed because: "+o),!t.disposed){var a={success:!1,duration:n.duration()};t.updateTelemetryOperation(i,a);var s=new Error(o);s.endCode=d.getErrorForXHRFailure(r).error,e.reject(s)}})}},e.prototype.updateSessionState=function(e,t){var n=this;if(this.logger.log("updateSessionState"),d.assertNotNullOrEmpty(this.links[p.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],"Correct sendUpdateSessionState url is not provided"),this.checkState("updateSessionState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,t)){var i=a.build(),r=this.addTelemetryOperation(h.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[p.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],payload:u.getPayload(this.signalingSession,e,this.nextClientSequenceNumberToUse++),requestName:h.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING}).then(function(){if(!n.disposed){var e={success:!0,duration:i.duration()};n.updateTelemetryOperation(r,e),t.resolve()}}).catch(function(e){var o=d.getPrintableObject(e);if(n.logger.error("updateSessionState failed because: "+o),!n.disposed){var a={success:!1,duration:i.duration()};n.updateTelemetryOperation(r,a);var s=new Error(o);s.endCode=d.getErrorForXHRFailure(e).error,t.reject(s)}})}},e.prototype.updateParticipantState=function(e){var t=this;if(this.logger.log("updateParticipantState"),d.assertNotNullOrEmpty(this.links[p.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],"correct confirmContentSharingView url is not provided"),this.checkState("updateParticipantState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e)){var n=a.build(),i=this.addTelemetryOperation(h.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[p.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],payload:l.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,withoutTrouter:!0}).then(function(){if(!t.disposed){var r={success:!0,duration:n.duration()};t.updateTelemetryOperation(i,r),e.resolve()}}).catch(function(r){var o=d.getPrintableObject(r);if(t.logger.error("updateParticipantState failed because: "+o),!t.disposed){var a={success:!1,duration:n.duration()};t.updateTelemetryOperation(i,a);var s=new Error(o);s.endCode=d.getErrorForXHRFailure(r).error,e.reject(s)}})}},e.prototype.updateNotificationLinks=function(){var e=this;if(this.logger.log("updateNotificationLinks"),d.assertNotNullOrEmpty(this.links[p.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],"correct notificationLinks url is not provided"),this.checkState("updateState",this.FSM_STATES.CONTENT_SHARING_CONNECTED)){var t=a.build(),n=this.addTelemetryOperation(h.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS);this.signalingSession.http.sendPostRequest({url:this.links[p.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],payload:c.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS,withoutTrouter:!0}).then(function(){if(!e.disposed){var i={success:!0,duration:t.duration()};e.updateTelemetryOperation(n,i)}}).catch(function(i){if(e.logger.error("updateNotificationLinks failed because: "+d.getPrintableObject(i)),!e.disposed){var r={success:!1,duration:t.duration()};e.updateTelemetryOperation(n,r)}})}},e.prototype.confirmInRoster=function(){this.confirmInRosterPromise&&this.confirmInRosterPromise.isPending&&(this.logger.log("Confirmed in roster"),this.confirmInRosterPromise.resolve())},e.prototype.handleAddModalitySuccess=function(e){var t=this;return this.logger.log("handleAddModalitySuccess"),this.checkState("handleAddModalitySuccess",this.FSM_STATES.CONTENT_SHARING_START_INITIATED)?e.modalitySuccess&&e.modalitySuccess.contentSharing?(this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_SUCCESS),this.processStartOrJoinSuccess(e.modalitySuccess.contentSharing),this.confirmInRosterPromise.promise.then(function(){delete t.confirmInRosterPromise,t.resolvePendingPromise(e.modalitySuccess.contentSharing)}),this.signalingSession.timeoutManager.stopTimer(p.default.TIMEOUT_OPERATIONS.ADD_MODALITY),!0):(this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{skipReason:"no content sharing blob"}),this.logger.log("handleAddModalitySuccess ignored because modalitySuccess was missing or did not contain content sharing blob"),!1):(this.logger.log("handleAddModalitySuccess ignored because session is not waiting to start"),!1)},e.prototype.handleAddModalityFailure=function(e){if(this.logger.log("handleAddModalityFailure"),!this.checkState("handleAddModalityFailure",[this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.FSM_STATES.CONTENT_SHARING_CONNECTED]))return!1;if(!e.modalityFailure||!e.modalityFailure.contentSharing)return this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{skipReason:"no content sharing blob"}),!1;var t=e.modalityFailure.contentSharing;this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{reason:t});var n={code:t.code,subCode:t.subCode,phrase:t.phrase};return this.sendTelemetryData(n),this.rejectPendingPromise(n.phrase,n),this.signalingSession.timeoutManager.stopTimer(p.default.TIMEOUT_OPERATIONS.ADD_MODALITY),!0},e.prototype.handleStartFromRoster=function(e){this.logger.log("handleStartFromRoster"),this.addTelemetryOperation(h.EVENTS.CONTENT_SHARING_START_FROM_ROSTER)},e.prototype.handleStopFromRoster=function(e){this.logger.log("handleStopFromRoster"),this.addTelemetryOperation(h.EVENTS.CONTENT_SHARING_END_FROM_ROSTER),this.sendTelemetryData(e)},e.prototype.handleStop=function(e){if(this.logger.log("handleStop"),this.isSelfInitiatedAction(e))return this.logger.log("handleStop skipped because session was ended by self"),!1;var t={code:e.contentSharingTransactionEnd.code,subCode:e.contentSharingTransactionEnd.subCode,phrase:e.contentSharingTransactionEnd.phrase};return this.addTelemetryOperation(h.EVENTS.HANDLE_CONTENT_SHARING_END),this.sendTelemetryData(t),!0},e.prototype.handleUpdate=function(e){return this.logger.log("handleUpdate"),e.sequenceNumber<=this.lastUpdateSequenceNumber?(this.logger.log("handleUpdate skipped because of old sequence number: last received "+this.lastUpdateSequenceNumber+", update contained "+e.sequenceNumber),this.addTelemetryOperation(h.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{skipReason:"old sequence number"}),!1):(this.lastUpdateSequenceNumber=e.sequenceNumber,this.isPresenter=e.presenter.id===this.signalingSession.participantManager.localParticipant.id,this.isSelfInitiatedAction(e)?(this.logger.log("handleUpdate skipped because update came from self"),!1):(this.addTelemetryOperation(h.EVENTS.HANDLE_CONTENT_SHARING_UPDATE),!0))},e.prototype.dispose=function(e){this.logger.log("dispose"),this.disposed=!0,this.rejectPendingPromise("call ended",e||{code:p.default.CALL_END_CODE.SUCCESS,subCode:p.default.CALL_END_SUB_CODE.SUCCESS,phrase:p.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),this.addTelemetryOperation(h.EVENTS.HANDLE_CALL_END),this.sendTelemetryData(e)},e.prototype.rejectPendingPromise=function(e,t){this.logger.log("rejectPendingPromise");var n=new Error(e);t&&(n.endCode=t),this.removeSessionPromise&&(this.removeSessionPromise.reject(n),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.reject(n),this.addSessionPromise=null)},e.prototype.resolvePendingPromise=function(e){this.logger.log("resolvePendingPromise");var t=null;e&&(t={sessionId:e.sessionId,correlationId:e.contentSharingCorrelationId,contentIdentifier:e.identifier,presenter:e.presenter.id,subject:e.subject||null,sessionState:e.sessionState||null}),this.removeSessionPromise&&(this.removeSessionPromise.resolve(t),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.resolve(t),this.addSessionPromise=null)},e.prototype.processStartOrJoinSuccess=function(e){this.logger.log("processStartOrJoinSuccess"),this.sessionId=e.sessionId,this.fsmState=this.FSM_STATES.CONTENT_SHARING_CONNECTED,this.lastUpdateSequenceNumber=-1,this.links[p.default.LINKS.CONTENT_SHARING_CONTROLLER]=e.links.contentSharingController,this.links[p.default.LINKS.CONTENT_SHARING_TAKE_CONTROL]=e.links.takeControl,this.links[p.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE]=e.links.updateSessionState,this.links[p.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE]=e.links.sync,this.links[p.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[p.default.LINKS.CONTENT_SHARING_LEAVE]=e.links.leave},e.prototype.checkState=function(e,t,n){if("string"==typeof t?this.fsmState===t:t.indexOf(this.fsmState)>-1)return!0;var i=e+" requires state "+t+", but state is "+this.fsmState;return this.logger.error(i),n&&n.reject(i),!1},e.prototype.isSelfInitiatedAction=function(e){return e.presenter.participantId===this.signalingSession.participantManager.localParticipant.participantId},e.prototype.startContentSharingTimer=function(){var e=this;this.logger.log("startContentSharingTimer"),this.signalingSession.timeoutManager.startTimer(p.default.TIMEOUT_OPERATIONS.ADD_MODALITY,function(){e.addTelemetryOperation(h.EVENTS.ADD_MODALITY_TIMEOUT),e.signalingSession.timeoutManager.stopTimer(p.default.TIMEOUT_OPERATIONS.ADD_MODALITY),e.rejectPendingPromise("timed out waiting for ContentSharing to start",{code:p.default.CALL_END_CODE.TIMEOUT,subCode:p.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:p.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})})},e.prototype.addTelemetryOperation=function(e,t){return this.signalingSession.telemetryHelper.addContentSharingOperation(this.correlationId,e,t)},e.prototype.updateTelemetryOperation=function(e,t){this.signalingSession.telemetryHelper.updateContentSharingOperation(this.correlationId,e,t)},e.prototype.sendTelemetryData=function(e){this.signalingSession.telemetryHelper.sendContentSharingTelemetryData(this.correlationId,this.signalingSession.sessionId,this.isPresenter,e,this.links[p.default.LINKS.CONTENT_SHARING_CONTROLLER],this.sessionId)},e}();t.ContentSharingSession=f},function(e,t,n){"use strict";var i,r=n(1),o=n(243),a=n(0),s=n(242),c=n(19),l={HTTP:"HTTP",HTTPS:"HTTPS"},u=((i={})[1]="POST",i[0]="GET",i[2]="PUT",i[3]="DELETE",i),d=function(){return function(e){var t=this;this.signalingSession=e,this.pendingRequests={},this.sendGetRequest=function(e){return t.sendRequest(0,e)},this.sendPostRequest=function(e){return t.sendRequest(1,e)},this.sendPutRequest=function(e){return t.sendRequest(2,e)},this.sendDeleteRequest=function(e){return t.sendRequest(3,e)},this.cancelRequestIfPending=function(e,n){t.pendingRequests[e]&&(n?t.hasPendingRequest(e,n)&&t.cancelRequest(e,n):Object.keys(t.pendingRequests[e]).forEach(function(n){return t.cancelRequest(e,n)}))},this.cancelAllRequests=function(){Object.keys(t.pendingRequests).forEach(function(e){Object.keys(t.pendingRequests[e]).forEach(function(n){return t.cancelRequest(e,n)})})},this.hasPendingRequest=function(e,n){return!!t.pendingRequests[e]&&Boolean(n?t.pendingRequests[e][n]:t.pendingRequests[e])},this.cancelRequest=function(e,n){try{t.pendingRequests[e][n].timeoutDeferred.resolve(),t.pendingRequests[e][n].dispatcher&&t.pendingRequests[e][n].dispatcher.cancelFurtherRetries(),t.pendingRequests[e][n].aborted=!0,t.logger.log("Request",e,"aborted")}catch(i){t.logger.warn("Unable to cancel request",e,n)}},this.buildRequestTelemetry=function(e,t){return{name:u[e]+"-"+t.requestName,eventStart:(new Date).getTime(),trouterReady:-1,requestReady:-1,messageId:"",attempts:[],uid:t.requestId,error:""}},this.addPendingRequest=function(e,n){return t.pendingRequests[e.requestName]||(t.pendingRequests[e.requestName]={}),t.pendingRequests[e.requestName][e.requestId]={dispatcher:null,timeoutDeferred:n,requestPromise:null,aborted:!1},t.pendingRequests[e.requestName][e.requestId]},this.extractMessageIdPrefix=function(e){return e.headers&&"string"==typeof e.headers[r.default.HEADERS.MESSAGE_ID]?e.headers[r.default.HEADERS.MESSAGE_ID].split("-")[0]:""},this.sendRequest=function(e,n){if(!n.url)return t.logger.error(n.requestName,"Link does not exist"),Promise.reject("Link does not exist");var i,r;n.requestId||(n.requestId=a.newGuid()),n.retryIntervals||(n.retryIntervals=[200,500,1e3]);var u=c.build(),d=(new Date).getTime(),p=a.defer(),h=t.buildRequestTelemetry(e,n),f=function(){t.signalingSession.disposed?t.logger.log("Unable to record telemetry, session disposed"):t.signalingSession.telemetryHelper.updateNetworkRequest(h)};f();var g=function(e){e&&e.request?(t.logger.warn("Request",n.requestName,"finished, status:",e.request.status,"statusText",e.request.statusText,"retry count",e.attempt),h.attempts.push({protocol:i,status:e.request.status,statusText:e.request.statusText,attempt:e.attempt,start:e.requestSendTimestamp-d,end:e.requestResponseTimestamp-d,online:navigator.onLine,aborted:t.pendingRequests[n.requestName][n.requestId].aborted}),f()):t.logger.warn(n.requestName,"missing request details, unable to record for telemetry!")};if(t.hasPendingRequest(n.requestName,n.requestId))return t.logger.warn(n.requestName,n.requestId,"is already pending request!!"),t.pendingRequests[n.requestName][n.requestId].requestPromise;r=t.addPendingRequest(n,p);var m=function(e,i,r,o){t.hasPendingRequest(n.requestName,n.requestId)?(delete t.pendingRequests[i][r],Object.keys(t.pendingRequests[i]).length||delete t.pendingRequests[i]):t.logger.warn("Unable to clean up!"),t.signalingSession.disposed||(o&&(h.error=o),t.signalingSession.telemetryHelper.addNetworkOperationCompleted(n.requestName,e,u.duration()),f())},_=function(e){return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(t.signalingSession.disposed)throw new Error("Session disposed");if(t.hasPendingRequest(n.requestName,n.requestId)&&t.pendingRequests[n.requestName][n.requestId].aborted)throw new Error("Request canceled");return e.apply(void 0,i)}},v=_(function(){return n.withoutTrouter?Promise.resolve():t.signalingSession.ensureMessageChannelReady(n.requestName)}),y=_(function(){return h.trouterReady=u.duration(),n.onceTrouterReady&&n.onceTrouterReady(),f(),Promise.resolve()}),S=_(function(){return s.get(t.signalingSession,n.requestName,n.payload,n.customHeaders,p.promise,n.contentSharingCorrelationId)}),E=_(function(e){return h.requestReady=u.duration(),h.messageId=t.extractMessageIdPrefix(e),f(),Promise.resolve(e)}),T=_(function(a){i=l.HTTPS;var s=o.build(t.signalingSession.signalingAgentConfig.httpRequestDispatcher,e,n.url,a,n.retryIntervals,g);return r.dispatcher=s,f(),s.sendRequestWithRetry()}),C=_(function(e){return g(e),t.logger.log("Request",n.requestName,"success"),m(!0,n.requestName,n.requestId),e}),I=Promise.resolve().then(v).then(y).then(S).then(E).then(T).then(C).catch(function(e){var i=a.getPrintableObject(e);return m(!1,n.requestName,n.requestId,i),t.logger.error("Request",n.requestName,"failed :",i),Promise.reject(e)});return r.requestPromise=I,I},this.logger=this.signalingSession.logger.createChild("HTTP_STACK")}}();t.HttpStack=d},function(e,t,n){"use strict";var i=n(1),r=function(){function e(e){var t=this;this.handleMessage=function(e){if(!t.isMessageForExistingCall(e))return{isHandled:!1};if(e.url.search(new RegExp("/"+i.default.URL_BASE.CALLAGENT+"/","i"))>-1){var n=t.signalingAgent.handleIncomingNotification(e);return"number"==typeof n?{isHandled:!0,resultCode:n}:{isHandled:!0,resultCode:n.resultCode,responseBody:n.responseBody,responseHeaders:n.responseHeaders}}return{isHandled:!1}},this.signalingAgent=e}return e.prototype.isMessageForExistingCall=function(e){return!e.eventId},e}();t.__esModule=!0,t.default=r},function(e,t,n){"use strict";var i=n(1),r=n(7),o=n(0),a=n(207),s=function(){function e(e,t){var n=this;this.disposed=!1,this.lastSeenServerSeqNo=-1,this.fsmState=i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE,this.links={},this.getLightWeightMeetingInfoToStartViewing=function(){return n.fsmState=i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_JOIN_INITIATED,{}},this.handleIncomingLightWeightMeeting=function(e){if(n.fsmState!==i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE)if(n.logger.log("LightWeightMeetingSession :: handleIncomingLightWeightMeeting"),e.activeModalities&&e.activeModalities.lwj&&e.activeModalities.lwj.lwjControllerUri)switch(n.links[i.default.LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER]=e.activeModalities.lwj.lwjControllerUri,n.fsmState){case i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTING:case i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTED:break;case i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_JOIN_INITIATED:n.internalJoinLightWeightMeeting()}else n.links[i.default.LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER]&&n.handleLightWeightMeetingEnd(!1,{code:i.default.CALL_END_CODE.SUCCESS,subCode:i.default.CALL_END_SUB_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_END_RECEIVED_FROM_SERVICE})},this.handleLightWeightMeetingUpdate=function(e){var t=e.body;n.logger.log("handleLightWeightMeetingUpdate : ",o.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_UPDATE,e),n.internalHandleLightWeightMeetingUpdate(t)},this.dispose=function(e){n.logger.log("LightWeightMeetingSession :: dispose"),n.fsmState!==i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE&&n.signalingSessionCallback.onLightWeightMeetingEnded(e),n.disposed=!0,n.clearFlags()},this.internalHandleLightWeightMeetingUpdate=function(e){if(n.fsmState===i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTED)return e&&e.lwj?void(e.sequenceNumber<=n.lastSeenServerSeqNo?n.logger.log("ignoring lightWeightMeetingUpdate. Last seen seq = "+n.lastSeenServerSeqNo):(n.logger.log("LightWeightMeetingSession :: handleLightWeightMeetingUpdate raising event"),n.lastSeenServerSeqNo=e.sequenceNumber,n.signalingSessionCallback.onLightWeightMeetingUpdated(e.lwj))):(n.logger.log("decoding failed, ending light weight meeting"),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_UPDATE_FAILURE),void n.handleLightWeightMeetingEnd(!0,{code:i.default.CALL_END_CODE.DECODING_FAILED,subCode:i.default.CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_JOIN_FAILED,phrase:i.default.CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_JOIN_FAILED}))},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"["+n.fsmState+"]"})}return e.prototype.handleLightWeightMeetingJoinTimeout=function(){this.logger.log("handleLightWeightMeetingJoinTimeout"),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT),this.handleLightWeightMeetingEnd(!0,{code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_JOIN_TIMEOUT,phrase:i.default.CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_TIMEOUT})},e.prototype.handleLightWeightMeetingEndByService=function(e){this.logger.log("handleLightWeightMeetingEndByService"),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_END,{byService:!0}),this.handleLightWeightMeetingEnd(!1)},e.prototype.handleLightWeightMeetingEnd=function(e,t){this.logger.log("handleLightWeightMeetingEnd",e),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_END),t||(t={code:i.default.CALL_END_CODE.SUCCESS,subCode:i.default.CALL_END_SUB_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.CONV_END_FROM_SERVICE}),this.signalingSessionCallback.onLightWeightMeetingEnded(t),this.clearFlags(),this.signalingSession.onLightWeightMeetingEnded(t,e)},e.prototype.internalJoinLightWeightMeeting=function(){var e=this;this.logger.log("LightWeightMeetingSession :: internalJoinLightWeightMeeting"),o.assertNotNullOrEmpty(this.links[i.default.LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER],"correct light weight meeting url is not provided!"),this.fsmState=i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTING,this.signalingSession.http.sendPostRequest({url:this.links[i.default.LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER],payload:a.getPayload(this.signalingSession),requestName:r.NETWORK_REQUESTS.JOIN_LIGHT_WEIGHT_MEETING}).then(function(t){e.disposed||(e.fsmState=i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTED,e.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.LIGHT_WEIGHT_MEETING_JOIN),e.internalHandleLightWeightMeetingUpdate(t.response),e.logger.log("LightWeightMeetingSession :: internalJoinLightWeightMeeting connected"))}).catch(function(t){var n=o.getPrintableObject(t);if(e.logger.error("internalJoinLightWeightMeeting failed because : "+n),!e.disposed){var r=o.getErrorForXHRFailure(t).error;e.handleLightWeightMeetingEnd(!0,{code:r,subCode:i.default.CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_JOIN_FAILED,phrase:i.default.CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_JOIN_FAILED})}})},e.prototype.clearFlags=function(){this.lastSeenServerSeqNo=-1,this.fsmState=i.default.LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE},e}();t.__esModule=!0,t.default=s},function(e,t,n){"use strict";var i=n(1),r=n(7),o=n(0),a=n(210),s=n(233),c=n(232),l=function(){function e(e,t){var n=this;this.vbssInitiated=!1,this.disposed=!1,this.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.IDLE,this.glareError={code:i.default.CALL_END_CODE.GLARE_ERROR,subCode:i.default.CALL_END_SUB_CODE.GLARE_ERROR,phrase:i.default.CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS},this.links={},this.renegotiationOffersSeenSoFar=[],this.isOutgoingRenegotiationInProgress=function(){return n.fsmState===i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||n.fsmState===i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.isIncomingRenegotiationInProgress=function(){return n.fsmState===i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||n.fsmState===i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.acceptRenegotiationAsync=function(e,t){n.logger.log("acceptRenegotiationAsync"),t&&n.logger.log("acceptRenegotiationAsync called with mediaTypes : "+o.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.ACCEPT_RENEGOTIATION),o.assertNotNullOrEmpty(n.links[i.default.LINKS.MEDIA_ANSWER],"MediaAnswer link not set");var a=o.defer();switch(n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION;break;default:return n.logger.log("there is no incoming media renegotiation offer to accept "),a.reject(new Error("there is no incoming media renegotiation offer to accept")),a.promise}return n.signalingSession.http.sendPostRequest({url:n.links[i.default.LINKS.MEDIA_ANSWER],payload:s.getPayload(n.signalingSession,e,t),requestName:r.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,onceTrouterReady:function(){n.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,n.handleMediaAnswerAcknowledgmentTimeout.bind(n))}}).then(function(e){a.resolve(e.response)}).catch(function(e){var t=o.getPrintableObject(e);n.logger.error("acceptRenegotiationAsync failed because : "+t),n.disposed||n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),a.reject(new Error("acceptRenegotiationAsync failed because : "+t))}),a.promise},this.startRenegotiationAsync=function(e,t,s){n.logger.log("startRenegotiationAsync called "),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.START_RENEGOTIATION),o.assertNotNullOrEmpty(t,"MediaRenegotiation link not set");var c=o.defer();switch(n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION;break;case i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return n.logger.log("media renegotiation can only be performed with no current outstanding renegotiations."),n.signalingSessionCallback.onMediaRenegotiationRejection(n.glareError),Promise.resolve(null);default:return n.logger.log("media renegotiation can only be performed on an established call"),c.reject(new Error("media renegotiation can only be performed on an established call")),c.promise}var l=s&&o.arrayContains(s,i.default.MEDIA_TYPES.SCREEN_SHARER);l?(n.vbssInitiated=!0,n.signalingSession.telemetryHelper.addVbssOperations(r.default.VBSS_OPERATION.START)):!l&&n.vbssInitiated&&(n.vbssInitiated=!1,n.signalingSession.telemetryHelper.addVbssOperations(r.default.VBSS_OPERATION.STOP));return n.signalingSession.http.sendPostRequest({url:t,payload:a.getPayload(n.signalingSession,e,s),requestName:r.NETWORK_REQUESTS.START_RENEGOTIATION,onceTrouterReady:function(){n.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER,n.handleMediaAnswerTimeout.bind(n))}}).then(function(e){c.resolve(e.response)}).catch(function(e){var t=o.getPrintableObject(e);if(n.logger.error("startRenegotiationAsync failed because : "+t),!n.disposed){switch(n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION}n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER)}c.reject(new Error("startRenegotiationAsync failed because : "+t))}),c.promise},this.handleMediaAcknowledgment=function(e){n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT),n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),n.signalingSession.saveMediaControllerLinksIfAny(e),n.signalingSession.saveUpdatedCallLinksIfAny(e),n.signalingSessionCallback.onMediaAcknowledgementSuccess(!0)},this.onCallConnected=function(){n.logger.log("onCallConnected"),n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED},this.handleMediaNegotiationFailure=function(e){n.handleMediaNegotiationFailureInternal(e.body.mediaNegotiationFailure,e.origin)},this.handleMediaAnswer=function(e){switch(n.logger.log("handleMediaAnswer called"),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ANSWER),n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:return}n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER);var t=[];e.mediaAnswer.callModalities&&e.mediaAnswer.callModalities.length>0&&(t=o.getMediaTypes(e.mediaAnswer.callModalities),n.signalingSession.telemetryHelper.addIncomingModalities(t));var a={provisional:!1,renegotiation:!0,mediaTypes:t,remoteParticipantId:n.signalingSession.getParticipantIdForOfferAnswer(e.mediaAnswer.mediaContent),mediaContent:e.mediaAnswer.mediaContent};n.signalingSession.http.sendPostRequest({url:e.mediaAnswer.links.mediaAcknowledgement,payload:null,requestName:r.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT}).catch(function(e){n.logger.error("handleMediaAnswer failed because: "+o.getPrintableObject(e)),n.signalingSession.disposed||n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ANSWER_FAILED)}),n.signalingSessionCallback.onAnswer(a)},this.handleMediaNegotiationOffer=function(e){var t=e.body,a=e.headers;n.logger.log(r.EVENTS.HANDLE_MEDIA_OFFER),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_OFFER,{origin:e.origin});var s=o.isDuplicateMessage(a,n.renegotiationOffersSeenSoFar);switch(n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,n.raiseMediaRenegotiationOffer(t);break;case i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,n.raiseMediaRenegotiationOffer(t);break;default:n.logger.error("Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress. isDuplicateOffer = "+s),s||n.rejectMediaRenegotiation(t.mediaNegotiation.links.rejection,n.glareError)}},this.rejectRenegotiationAsync=function(e){n.logger.log("rejectRenegotiationAsync called"),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.REJECT_RENEGOTIATION),o.assertNotNullOrEmpty(n.links[i.default.LINKS.MEDIA_REJECTION],"MediaRejection link not set");var t=e||{code:i.default.CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:i.default.CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:i.default.CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,n.rejectMediaRenegotiation(n.links[i.default.LINKS.MEDIA_REJECTION],t);case i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,n.rejectMediaRenegotiation(n.links[i.default.LINKS.MEDIA_REJECTION],t);default:return n.logger.error("There is no incoming media renegotiation offer to reject"),Promise.resolve(null)}},this.handleRetargetCompleted=function(e){var t=e.body.retargetCompleted;n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_RETARGET_COMPLETED,e);var i=o.getPrintableObject(t);n.logger.log("handleRetargetCompleted called with : "+i),0===t.code?n.signalingSessionCallback.onReTargetCompletedSuccess():n.signalingSessionCallback.onReTargetCompletedFailure(i)},this.dispose=function(){n.logger.log("mediaRenegotiationManager :: dispose"),n.disposed=!0},this.handleMediaNegotiationFailureInternal=function(e,t){switch(n.logger.log(r.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,o.getPrintableObject(e)),n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,{origin:t}),n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),n.fsmState){case i.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case i.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:n.fsmState=i.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:return}n.vbssInitiated&&(n.vbssInitiated=!1,n.signalingSession.telemetryHelper.addVbssOperations(r.default.VBSS_OPERATION.REJECTED)),n.signalingSession.telemetryHelper.addIncomingModalities(["Rejected"]),n.signalingSessionCallback.onMediaRenegotiationRejection({code:e.code,subCode:e.subCode,phrase:e.phrase})},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"["+n.fsmState+"]"})}return e.prototype.raiseMediaRenegotiationOffer=function(e){this.logger.log("raiseMediaRenegotiationOffer"),this.links[i.default.LINKS.MEDIA_ANSWER]=e.mediaNegotiation.links.mediaAnswer,this.links[i.default.LINKS.MEDIA_REJECTION]=e.mediaNegotiation.links.rejection;var t=[];e.mediaNegotiation.callModalities&&e.mediaNegotiation.callModalities.length>0&&(t=o.getMediaTypes(e.mediaNegotiation.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(t),o.arrayContains(t,i.default.MEDIA_TYPES.SCREEN_SHARER)&&this.signalingSession.telemetryHelper.addVbssOperations(r.default.VBSS_OPERATION.REMOTE_START));var n={mediaTypes:t,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(e.mediaNegotiation.mediaContent),mediaContent:e.mediaNegotiation.mediaContent,renegotiation:!0};this.signalingSessionCallback.onOffer(n)},e.prototype.rejectMediaRenegotiation=function(e,t){this.logger.log("rejectMediaRenegotiation");var n=o.defer();return this.signalingSession.http.sendPostRequest({url:e,payload:c.getPayload(this.signalingSession,t),requestName:r.NETWORK_REQUESTS.SEND_MEDIA_REJECTION}).then(function(e){n.resolve(e.response)}).catch(function(e){n.reject(new Error("rejectMediaRenegotiation failed because : "+o.getPrintableObject(e)))}),n.promise},e.prototype.handleMediaAnswerTimeout=function(){this.logger.log("handleMediaAnswerTimeout"),this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(r.default.VBSS_OPERATION.TIMEOUT)),this.signalingSession.telemetryHelper.addIncomingModalities(["Timeout"]),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ANSWER_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.handleMediaNegotiationFailureInternal({code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:i.default.CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT},r.default.EVENT_SOURCE.LOCAL)},e.prototype.handleMediaAnswerAcknowledgmentTimeout=function(){this.logger.log("handleMediaAnswerAcknowledgmentTimeout"),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),this.signalingSessionCallback.onMediaAcknowledgementFailure(!0,new Error("timed out waiting for Media Answer Acknowledgement"))},e}();t.__esModule=!0,t.default=l},function(e,t,n){"use strict";var i=n(1),r=n(7),o=n(0),a=n(34),s=n(194),c=n(193),l=n(214),u=n(213),d=n(195),p=n(219),h=n(211),f=n(225),g=n(196),m=n(218),v=function(){function e(e,t,n){var a=this;this.connectedRemoteParticipantIds={},this.disposed=!1,this.localAddParticipantRequests={},this.localRemoveParticipantRequests={},this.localAdmitParticipantRequests={},this.localCallMeBackRequests={},this.unmuteApprovalLinks={},this.setLocalParticipantId=function(e){e&&(a.localParticipant.participantId=e)},this.admitParticipantAsync=function(e,t){a.logger.log("admitParticipantAsync called for : "+e.id);var n=o.defer();return!1===a.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(a.logger.error("unable to admit a participant that is not found in roster"+e.id),n.reject(new Error("the given participant is not found in roster"))):a.localAdmitParticipantRequests.hasOwnProperty(e.id)?(a.logger.error("there is an existing pending request to admit the participant : "+e.id),n.reject(new Error("there is an existing pending request to admit the participant"))):(o.tryAddNewKeyToHashTable(a.localAdmitParticipantRequests,e.id,{participant:e,promise:n}),a.sendNetworkRequestForAdmittingParticipant(e,t)),n.promise},this.addParticipantAsync=function(e,t,n,i,r,s){a.logger.log("addParticipantAsync called for : "+e.id);var c=o.defer();return a.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(a.logger.error("the given participant is already connected to the call : "+e.id),c.reject(new Error("the given participant is already connected to the call"))):a.localAddParticipantRequests.hasOwnProperty(e.id)?(a.logger.error("there is an existing pending request to add the participant : "+e.id),c.reject(new Error("there is an existing pending request to add the participant"))):(o.tryAddNewKeyToHashTable(a.localAddParticipantRequests,e.id,{participant:e,promise:c}),n&&a.sendNetworkRequestForAddingParticipant(e,t,i,r,s)),c.promise},this.nudgeParticipantsAsync=function(e,t,n,i,r,o){return a.logger.log("nudgeParticipantAsync called for : "+e),n?a.sendNetworkRequestForNudgingParticipants(e,t,i,r,o):Promise.reject("Call not started")},this.callMeBackAsync=function(e,t,n){a.logger.log("callMeBackAsync called for : "+e.id);var i=o.defer();return a.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(a.logger.error("the given participant is already connected to the call : "+e.id),i.reject(new Error("the given participant is already connected to the call"))):a.localCallMeBackRequests.hasOwnProperty(e.id)?(a.logger.error("there is an existing pending request to call back the participant : "+e.id),i.reject(new Error("there is an existing pending request to call back the participant"))):(o.tryAddNewKeyToHashTable(a.localCallMeBackRequests,e.id,{participant:e,promise:i}),a.sendNetworkRequestForCallMeBack(e,t)),i.promise},this.removeParticipantAsync=function(e,t){a.logger.log("removeParticipantAsync called for : "+e.id),o.assertNotNullOrEmpty(t,"correct removeParticipantUrl is not provided");var n=o.defer();o.tryAddNewKeyToHashTable(a.localRemoveParticipantRequests,e.id,{participant:e,promise:n});return a.signalingSession.http.sendPostRequest({url:t,payload:p.getPayload(a.signalingSession,e),requestName:r.NETWORK_REQUESTS.REMOVE_PARTICIPANT,onceTrouterReady:function(){a.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,function(){a.signalingSession.telemetryHelper.recordEvent(r.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),a.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),a.rejectPromiseAndDeleteFromHashTable(a.localRemoveParticipantRequests,e.id,"timed out waiting for participant to not show up in roster",{code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:i.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT})},e.id)}}).catch(function(t){a.logger.error("removeParticipantAsync failed because: "+o.getPrintableObject(t)),a.disposed||(a.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),a.rejectPromiseAndDeleteFromHashTable(a.localRemoveParticipantRequests,e.id,o.getPrintableObject(t),i.default.CALL_END_NETWORK_ERROR))}),n.promise},this.getParticipantsToInitiateCallWith=function(){a.logger.log("getParticipantsToInitiateCallWith");var e=[];for(var t in a.localAddParticipantRequests)a.localAddParticipantRequests.hasOwnProperty(t)&&e.push(a.localAddParticipantRequests[t].participant);return e},this.initializeForIncomingCall=function(e){a.logger.log("initializeForIncomingCall"),a.rejectLocalQueuedOperations("incoming calls cannot add/remove participants until call is connected")},this.handleAddParticipantSuccess=function(e){var t=e.body;a.logger.log("handleAddParticipantSuccess : ",o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS,e),a.hasPendingCallMeBackOperation(t)?a.internalHandleCallMeBackSuccess(t):a.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS)},this.handleAddParticipantFailure=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,o.getPrintableObject(t)),t.modalityFailure?(a.logger.error("handleAddParticipantFailure - got modalityFailure : "+o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE,e)):t.participants&&a.internalHandleAddParticipantFailure(e)},this.handleAdmitParticipantSuccess=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,e)},this.handleAdmitParticipantFailure=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,o.getPrintableObject(t)),t.participants&&a.internalHandleAdmitParticipantFailure(e)},this.handleRemoveParticipantFailure=function(e){var t=e.body;for(var n in a.logger.log(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,e),t.participants)t.participants.hasOwnProperty(n)&&a.internalHandleRemoveParticipantFailure(n,t.participants[n])},this.handleRemoveParticipantSuccess=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,e)},this.handleUnmuteConfirmRequest=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_UNMUTE_CONFIRM,o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_UNMUTE_CONFIRM,e),a.unmuteApprovalLinks[t.from.id]={approve:t.links.approveUnmute,reject:t.links.rejectUnmute},a.signalingSessionCallback.onUnmuteRequested(t.from.id)},this.approveUnmuteRequestAsync=function(e){a.logger.log("approveUnmuteRequestAsync");var t=o.defer();return a.unmuteApprovalLinks.hasOwnProperty(e)?(a.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.APPROVE_UNMUTE).then(function(){a.muteUnmute(r.NETWORK_REQUESTS.APPROVE_UNMUTE,g.getPayload(a.signalingSession),t,a.unmuteApprovalLinks[e].approve)}).catch(function(e){var n=o.getPrintableObject(e);a.logger.error("approveUnmuteRequestAsync failed because : "+n),t.reject(new Error(e))}),t.promise):(t.reject(new Error("no unmute links found for given participant")),t.promise)},this.rejectUnmuteRequestAsync=function(e,t){a.logger.log("rejectUnmuteRequestAsync");var n=o.defer();if(!a.unmuteApprovalLinks.hasOwnProperty(e))return n.reject(new Error("no unmute links found for given participant")),n.promise;var s=t||{code:i.default.CALL_END_CODE.REJECT,subCode:i.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_REJECTED,phrase:i.default.CALL_END_PHRASE.UNMUTE_REQUEST_REJECTED};return a.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.REJECT_UNMUTE).then(function(){a.muteUnmute(r.NETWORK_REQUESTS.REJECT_UNMUTE,m.getPayload(a.signalingSession,s),n,a.unmuteApprovalLinks[e].reject)}).catch(function(e){var t=o.getPrintableObject(e);a.logger.error("rejectUnmuteRequestAsync failed because : "+t),n.reject(new Error(e))}),n.promise},this.handleUnmuteFailure=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_UNMUTE_FAILURE,o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_UNMUTE_FAILURE,e)},this.handleUnmuteSuccess=function(e){var t=e.body;a.logger.log(r.EVENTS.HANDLE_UNMUTE_SUCCESS,o.getPrintableObject(t)),a.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_UNMUTE_SUCCESS,e)},this.handleRosterUpdate=function(e){a.logger.log("handleRosterUpdate :",a.logRoster(e));var t=a.getCurrentParticipantsInCallModality(!1);for(var n in e.participants)e.participants.hasOwnProperty(n)&&a.handleRosterParticipant(e.participants[n],t);a.checkForRemovedParticipants(t,e.participants)},this.muteAsync=function(e,t,n){a.logger.log("muteAsync called with :"+t);var s="specified",c=[];switch(t){case i.default.MUTE_SCOPE.MYSELF:c.push({id:a.localParticipant.id});break;case i.default.MUTE_SCOPE.EVERYONE_ELSE:s="all";break;case i.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS:o.assertNotNullOrEmpty(n,"array of participantIds must be specified for SPECIFIED_PARTICIPANTS mute scope"),n.forEach(function(e){c.push({id:e})});break;default:o.assert(!1,"muteScope is a required param. please pass in a valid value.")}var l=o.defer();if(t===i.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS){var u=a.areParticipantsConnectedToCall(n);if(!u.result)return l.reject(new Error("specified participant is not connected to call yet. Id = "+u.participant)),l.promise}return a.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.MUTE).then(function(){a.muteUnmute(r.NETWORK_REQUESTS.MUTE,h.getPayload(a.signalingSession,s,c),l,e)}).catch(function(e){var t=o.getPrintableObject(e);a.logger.error("muteAsync failed because : "+t),l.reject(new Error(e))}),l.promise},this.unmuteAsync=function(e){a.logger.log("unmuteAsync");var t=o.defer();return a.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.UNMUTE).then(function(){a.muteUnmute(r.NETWORK_REQUESTS.UNMUTE,f.getPayload(a.signalingSession),t,e,!0)}).catch(function(e){var n=o.getPrintableObject(e);a.logger.error("unmuteAsync failed because : "+n),t.reject(new Error(e))}),t.promise},this.dispose=function(e){a.logger.log("participantManager :: dispose"),a.disposed=!0,a.rejectLocalQueuedOperations("call ended",e),a.signalingSession.telemetryHelper.setParticipantId(a.localParticipant.participantId)},this.logRoster=function(e){try{return{participants:Object.keys(e.participants)}}catch(e){return{participants:"unable to parse roster"}}},this.hasPendingCallMeBackOperation=function(e){if(e&&e.participants)for(var t=0;t<e.participants.length;t++)if(a.localCallMeBackRequests.hasOwnProperty(e.participants[t]))return!0;return!1},this.internalHandleCallMeBackSuccess=function(e){for(var t=0;t<e.participants.length;t++){var n=e.participants[t];if(a.localCallMeBackRequests.hasOwnProperty(n)){var r={id:n};a.logger.log("participant : "+n+" was successfully added. Resolving CallMeBack request"),a.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,n),a.resolvePromiseAndDeleteFromHashTable(a.localCallMeBackRequests,r)}}},this.signalingSession=e,this.signalingSessionCallback=t,this.localParticipant=n,this.logger=e.logger.createChild("ParticipantManager"),this.localParticipant.endpointId||(this.localParticipant.endpointId=this.signalingSession.getEndpointId()),this.localParticipant.participantId||(this.localParticipant.participantId=o.newGuid()),e.signalingAgentConfig.languageCode&&(this.localParticipant.languageId=e.signalingAgentConfig.languageCode),e.telemetryHelper.setEndPointId(this.localParticipant.endpointId)}return e.prototype.areParticipantsConnectedToCall=function(e){this.logger.log("areParticipantsConnectedToCall : "+o.getPrintableObject(e));for(var t=this.getCurrentParticipantsInCallModality(!0),n=0;n<e.length;n++)if(!t.hasOwnProperty(e[n]))return this.logger.log("areParticipantsConnectedToCall : returning false for :"+e[n]),{result:!1,participant:e[n]};return this.logger.log("areParticipantsConnectedToCall : returning true"),{result:!0}},e.prototype.muteUnmute=function(e,t,n,a,s){var c=this;this.logger.log("muteUnmute called with operation : "+e),a?(s&&this.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.UNMUTE,function(){c.signalingSession.telemetryHelper.recordEvent(r.EVENTS.UNMUTE_TIMEOUT),c.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.UNMUTE);var e=new Error("timed out waiting for response to request");e.endCode={code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_TIMEOUT,phrase:i.default.CALL_END_PHRASE.UNMUTE_REQUEST_TIMEOUT},n.reject(e)}),this.signalingSession.http.sendPostRequest({url:a,payload:t,requestName:e,withoutTrouter:!0}).then(function(){c.disposed||n.resolve()}).catch(function(e){var t=o.getPrintableObject(e);if(c.logger.error("mute/unmute failed because : "+t),!c.disposed){s&&c.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.UNMUTE);var r=new Error(e);r.endCode=i.default.CALL_END_NETWORK_ERROR,n.reject(r)}})):n.reject(new Error("mute/unmute operation cannot be performed now, the link is not yet available"))},e.prototype.sendNetworkRequestForNudgingParticipants=function(e,t,n,a,s){var c=this;if(t){var d=a?u.getPayload(this.signalingSession,e,a,s,n):l.getPayload(this.signalingSession,e,n);return this.signalingSession.http.sendPostRequest({url:t,payload:d,requestName:r.NETWORK_REQUESTS.NUDGE_PARTICIPANT,onceTrouterReady:function(){c.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,function(){c.signalingSession.telemetryHelper.recordEvent(r.EVENTS.NUDGE_PARTICIPANT_TIMEOUT),c.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT)})}}).catch(function(e){var t=o.getPrintableObject(e);c.logger.error("sendNetworkRequestForNudgingParticipant failed because : "+t),c.disposed||c.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT)})}return this.logger.error("sendNetworkRequestForNudgingParticipant failed because correct nudgeParticipantUrl is not provided"),Promise.reject("Missing nudgeParticipant url")},e.prototype.sendNetworkRequestForAddingParticipant=function(e,t,n,a,l){var u=this;if(t){var d=a?c.getPayload(this.signalingSession,e,a,l,n):s.getPayload(this.signalingSession,e,n);this.signalingSession.http.sendPostRequest({url:t,payload:d,requestName:r.NETWORK_REQUESTS.ADD_PARTICIPANT,onceTrouterReady:function(){u.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,function(){u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.ADD_PARTICIPANT_TIMEOUT),u.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),u.rejectPromiseAndDeleteFromHashTable(u.localAddParticipantRequests,e.id,"timed out waiting for participant to show up in roster",{code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:i.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},e.id)}}).catch(function(t){var n=o.getPrintableObject(t);if(u.logger.error("sendNetworkRequestForAddingParticipant failed because : "+n),!u.disposed){var r=o.getErrorForXHRFailure(t);u.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),u.rejectPromiseAndDeleteFromHashTable(u.localAddParticipantRequests,e.id,n,r.error)}})}else this.logger.error("sendNetworkRequestForAddingParticipant failed because correct addParticipantUrl is not provided"),this.rejectPromiseAndDeleteFromHashTable(this.localAddParticipantRequests,e.id,"correct addParticipantUrl is not provided",{code:i.default.CALL_END_CODE.LOCAL_ERROR,subCode:i.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:i.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING})},e.prototype.sendNetworkRequestForCallMeBack=function(e,t){var n=this;if(t){this.signalingSession.http.sendPostRequest({url:t,payload:c.getPayload(this.signalingSession,e,this.signalingSession.threadId,this.signalingSession.teamsMessageId),requestName:r.NETWORK_REQUESTS.CALL_ME_BACK,onceTrouterReady:function(){n.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,function(){n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.CALL_ME_BACK_TIMEOUT),n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),n.rejectPromiseAndDeleteFromHashTable(n.localCallMeBackRequests,e.id,"timed out waiting for call me back success response",{code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:i.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},e.id)}}).catch(function(t){var r=o.getPrintableObject(t);n.logger.error("sendNetworkRequestForCallMeBack failed because : "+r),n.disposed||(n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),n.rejectPromiseAndDeleteFromHashTable(n.localCallMeBackRequests,e.id,r,i.default.CALL_END_NETWORK_ERROR))})}else this.logger.error("sendNetworkRequestForCallMeBack failed because correct addParticipantUrl is not provided"),this.rejectPromiseAndDeleteFromHashTable(this.localCallMeBackRequests,e.id,"correct addParticipantUrl is not provided",{code:i.default.CALL_END_CODE.LOCAL_ERROR,subCode:i.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:i.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING})},e.prototype.sendNetworkRequestForAdmittingParticipant=function(e,t){var n=this;if(t){this.signalingSession.http.sendPostRequest({url:t,payload:d.getPayload(this.signalingSession,e),requestName:r.NETWORK_REQUESTS.ADMIT_PARTICIPANT,onceTrouterReady:function(){n.signalingSession.timeoutManager.startTimer(i.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,function(){n.signalingSession.telemetryHelper.recordEvent(r.EVENTS.ADMIT_PARTICIPANT_TIMEOUT),n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),n.rejectPromiseAndDeleteFromHashTable(n.localAdmitParticipantRequests,e.id,"timed out waiting for participant to show up in roster",{code:i.default.CALL_END_CODE.TIMEOUT,subCode:i.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:i.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},e.id)}}).catch(function(t){var r=o.getPrintableObject(t);n.logger.error("sendNetworkRequestForAdmittingParticipant failed because : "+r),n.disposed||(n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),n.rejectPromiseAndDeleteFromHashTable(n.localAdmitParticipantRequests,e.id,r,i.default.CALL_END_NETWORK_ERROR))})}else this.logger.error("sendNetworkRequestForAdmittingParticipant failed because correct admitParticipantUrl is not provided"),this.rejectPromiseAndDeleteFromHashTable(this.localAdmitParticipantRequests,e.id,"correct admitParticipantUrl is not provided",{code:i.default.CALL_END_CODE.LOCAL_ERROR,subCode:i.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:i.default.CALL_END_PHRASE.ADMIT_PARTICIPANT_URL_MISSING})},e.prototype.handleRosterParticipant=function(e,t){if(this.logger.log("handleRosterParticipant:",e.details.id),e.details.id!==this.localParticipant.id){var n=a.default.fromRoster(e);if(n){o.tryAddNewKeyToHashTable(this.connectedRemoteParticipantIds,e.details.id,!0);var r=t.hasOwnProperty(n.id);r&&(t[n.id]=!1),this.localAddParticipantRequests.hasOwnProperty(n.id)&&this.isParticipantInCall(n)?(this.logger.log("participant:",n.id," appears in roster. Resolving AddParticipant request"),this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,n.id),this.resolvePromiseAndDeleteFromHashTable(this.localAddParticipantRequests,n)):this.localAdmitParticipantRequests.hasOwnProperty(n.id)&&this.isParticipantInCall(n)?(this.logger.log("participant:",n.id," appears in roster. Resolving AdmitParticipant request"),this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,n.id),this.resolvePromiseAndDeleteFromHashTable(this.localAdmitParticipantRequests,n),this.checkForJoinedOrUpdatedParticipants(n,r)):this.checkForJoinedOrUpdatedParticipants(n,r)}}else this.updateLocalParticipant(e)},e.prototype.isParticipantInCall=function(e){return e.endpointDetails&&e.endpointDetails[0]&&!e.endpointDetails[0].isLobby},e.prototype.updateLocalParticipant=function(e){var t=this,n=a.default.fromRoster(e);if(this.logger.log("updateLocalParticipant"),n&&n.endpointDetails){var i=_.find(n.endpointDetails,function(e){return t.localParticipant.endpointId===e.endpointId}),o=_.find(this.localParticipant.endpointDetails,function(e){return t.localParticipant.endpointId===e.endpointId});!i||!i.isLobby||o&&o.isLobby?!i||i.isLobby||o&&!o.isLobby||this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.CONNECTED):this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.IN_LOBBY)}n&&(this.localParticipant.displayName=n.displayName,this.localParticipant.languageId=n.languageId,this.localParticipant.endpointDetails=n.endpointDetails,this.localParticipant.acceptedBy=n.acceptedBy,this.localParticipant.role=n.role,this.localParticipant.tenantId=n.tenantId,this.signalingSessionCallback.onSelfParticipantUpdated(this.localParticipant))},e.prototype.checkForRemovedParticipants=function(e,t){var n=this;for(var r in this.logger.log("checkForRemovedParticipants"),e)e.hasOwnProperty(r)&&!1!==e[r]&&!this.localAddParticipantRequests.hasOwnProperty(r)&&(o.tryRemoveKeyFromHashTable(this.connectedRemoteParticipantIds,r),this.logger.log("participant:",r,"removed from roster"),this.signalingSessionCallback.onParticipantRemoved({id:r}));var s=[];Object.keys(t).forEach(function(e){var n=a.default.fromRoster(t[e]);n&&n.endpointDetails&&n.endpointDetails.forEach(function(e){e.originalId&&s.push(e.originalId)})}),Object.keys(this.localRemoveParticipantRequests).forEach(function(e){-1!==s.indexOf(e)||t.hasOwnProperty(e)||(n.logger.log("participant:",e+" no longer appears in roster. Resolving RemoveParticipant request"),o.tryRemoveKeyFromHashTable(n.connectedRemoteParticipantIds,e),n.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e),n.resolvePromiseAndDeleteFromHashTable(n.localRemoveParticipantRequests,{id:e}))})},e.prototype.checkForJoinedOrUpdatedParticipants=function(e,t){t?(this.logger.log("firing onParticipantUpated for : "+e.id),this.signalingSessionCallback.onParticipantUpdated(e)):this.localRemoveParticipantRequests.hasOwnProperty(e.id)?this.logger.log("ignoring participant : "+e.id+" who has been requested to be removed"):(this.logger.log("firing onParticipantJoined for : "+e.id),this.signalingSessionCallback.onParticipantJoined(e))},e.prototype.getCurrentParticipantsInCallModality=function(e){var t={},n=[i.default.PARTICIPANT_AUDIO_STATE.CONNECTED];return e||n.push(i.default.PARTICIPANT_AUDIO_STATE.CONNECTING,i.default.PARTICIPANT_AUDIO_STATE.RINGING),this.signalingSessionCallback.getRemoteParticipantCollection().forEach(function(e){n.some(function(t){return t===e.audioState})&&(t[e.mri]=!0)}),t},e.prototype.resolvePromiseAndDeleteFromHashTable=function(e,t){if(this.logger.log("resolvePromiseAndDeleteFromHashTable for : "+t.id),e.hasOwnProperty(t.id)){var n=e[t.id].promise;delete e[t.id],n.resolve(t)}},e.prototype.rejectPromiseAndDeleteFromHashTable=function(e,t,n,i){this.logger.log("rejectPromiseAndDeleteFromHashTable for : "+t+" reason : "+n);var r=new Error(n);if(i&&(r.endCode=i),e.hasOwnProperty(t)){var o=e[t].promise;delete e[t],o.reject(r)}},e.prototype.internalHandleRemoveParticipantFailure=function(e,t){if(this.localRemoveParticipantRequests.hasOwnProperty(e)){this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e),this.logger.log("participantRemove failed for : "+e+" reason : "+o.getPrintableObject(t));var n=this.getCallEndGivenParticipantFailure(t);this.rejectPromiseAndDeleteFromHashTable(this.localRemoveParticipantRequests,e,n.phrase,n)}},e.prototype.internalHandleAddParticipantFailure=function(e){var t=e.body;for(var n in t.participants)if(t.participants.hasOwnProperty(n)&&this.localAddParticipantRequests.hasOwnProperty(n)){this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,n);var a=t.participants[n];this.logger.log("participantAdd failed for : "+n+" reason : "+o.getPrintableObject(a));var s=this.getCallEndGivenParticipantFailure(a);this.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,e,s),this.rejectPromiseAndDeleteFromHashTable(this.localAddParticipantRequests,n,s.phrase,s)}else if(t.participants.hasOwnProperty(n)&&this.localCallMeBackRequests.hasOwnProperty(n)){this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,n);a=t.participants[n];this.logger.log("callMeBack failed for : "+n+" reason : "+o.getPrintableObject(a));s=this.getCallEndGivenParticipantFailure(a);this.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,e,s),this.rejectPromiseAndDeleteFromHashTable(this.localCallMeBackRequests,n,s.phrase,s)}},e.prototype.internalHandleAdmitParticipantFailure=function(e){var t=e.body;for(var n in t.participants)if(t.participants.hasOwnProperty(n)&&this.localAdmitParticipantRequests.hasOwnProperty(n)){this.signalingSession.timeoutManager.stopTimer(i.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,n);var a=t.participants[n];this.logger.log("Admit participant failed for : "+n+" reason : "+o.getPrintableObject(a));var s=this.getCallEndGivenParticipantFailure(a);this.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,e,s),this.rejectPromiseAndDeleteFromHashTable(this.localAdmitParticipantRequests,n,s.phrase,s)}},e.prototype.getCallEndGivenParticipantFailure=function(e){var t={code:e.code,subCode:e.subCode,phrase:e.phrase};return e.code===i.default.CALL_END_CODE.CALL_MODALITY_FAILURE&&e.callControllerTransactionEnd?t={code:e.callControllerTransactionEnd.code,subCode:e.callControllerTransactionEnd.subCode,phrase:e.callControllerTransactionEnd.phrase}:e.code===i.default.CALL_END_CODE.ATC_CONTROLLER_FAILURE&&e.atcControllerTransactionEnd&&(t={code:e.atcControllerTransactionEnd.code,subCode:e.atcControllerTransactionEnd.subCode,phrase:e.atcControllerTransactionEnd.phrase}),t},e.prototype.rejectLocalQueuedOperations=function(e,t){var n=this;this.logger.log("rejectLocalQueuedOperations");var r=t||{code:i.default.CALL_END_CODE.SUCCESS,subCode:i.default.CALL_END_SUB_CODE.SUCCESS,phrase:i.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.localAddParticipantRequests).forEach(function(t){n.rejectPromiseAndDeleteFromHashTable(n.localAddParticipantRequests,t,e,r)}),Object.keys(this.localCallMeBackRequests).forEach(function(t){n.rejectPromiseAndDeleteFromHashTable(n.localCallMeBackRequests,t,e,r)}),Object.keys(this.localRemoveParticipantRequests).forEach(function(t){n.rejectPromiseAndDeleteFromHashTable(n.localRemoveParticipantRequests,t,e,r)}),this.localAddParticipantRequests={},this.localRemoveParticipantRequests={},this.connectedRemoteParticipantIds={}},e}();t.__esModule=!0,t.default=v},function(e,t,n){"use strict";var i=n(1),r=n(0),o=n(4);t.getPayload=function(e,t){return r.assertNotNull(e,"signalingSession cannot be null"),r.assertNotNull(t,"content cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[]},contentSharing:{identifier:t.contentIdentifier,subject:t.subject,sessionState:t.sessionState,sequenceNumber:t.sequenceNumber,links:{sessionUpdate:o.get(e,i.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:o.get(e,i.URL_PATH.CONV_CONTENT_SHARING_END)}},links:{addModalitySuccess:o.get(e,i.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:o.get(e,i.URL_PATH.CONV_ADD_MODALITY_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n,a,s){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"remoteParticipant cannot be null"),i.assertNotNullOrEmpty(n,"threadId should be set prior to adding participant"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,assertedId:t.assertedId,displayName:t.displayName}]},participantInvitationData:s,groupChat:{threadId:n,messageId:a},links:{addParticipantSuccess:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,assertedId:t.assertedId,displayName:t.displayName}]},participantInvitationData:n,links:{addParticipantSuccess:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"remoteParticipant cannot be null"),i.assertNotNullOrEmpty(e.threadId,"threadId should be set prior to adding participant"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{admitFailure:r.get(e,o.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE),admitSuccess:r.get(e,o.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS)}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"]}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){void 0===n&&(n=!0),i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"joinUrl cannot be null");var a={type:"multiPartyEndpoint",rosterUpdate:r.get(e,o.URL_PATH.CONV_ROSTER_UPDATE)};return{payload:{attach:{requireMediaContent:n,links:{end:r.get(e,o.URL_PATH.END)}},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled",supportsCompressedServicePayload:e.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled"},additionalActions:[{input:{capabilities:{cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled"},conversationRequest:{roster:a,links:{conversationEnd:r.get(e,o.URL_PATH.CONV_END),conversationUpdate:r.get(e,o.URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},endpointMetadata:e.endpointMetadata,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}},name:"join",url:t,waitForResponse:!0}]}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:r.get(e,o.URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,o.URL_PATH.TRANSFER),replacement:r.get(e,o.URL_PATH.REPLACE),balanceUpdate:r.get(e,o.URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,o.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:r.get(e,o.URL_PATH.CONTROL_VIDEO_STREAMING)}}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){i.assertNotNull(e,"signalingSession cannot be null");var a=i.getMediaTypes(n);return e.telemetryHelper.addOutgoingModalities(a),{payload:{callAcceptance:{acceptedBy:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},acceptedCallModalities:a,capabilities:{cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled"},links:{mediaRenegotiation:r.get(e,o.URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,o.URL_PATH.TRANSFER),replacement:r.get(e,o.URL_PATH.REPLACE),balanceUpdate:r.get(e,o.URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,o.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:r.get(e,o.URL_PATH.CONTROL_VIDEO_STREAMING)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,callKeepAliveInterval:null}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{callProgress:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},status:"ringing",phrase:"ringing"}}}}},function(e,t,n){"use strict";var i=n(0),r=n(1);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:r.default.CALL_END_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n,a){i.assertNotNull(e,"signalingSession cannot be null");var s=[];s=a.invitationType===o.default.INVITATION_TYPE.NUDGE&&Array.isArray(a.participantsToNudge)?a.participantsToNudge.map(function(e){return{id:e}}):e.participantManager.getParticipantsToInitiateCallWith(),e.signalingAgentConfig.doHostlessCalling||i.assert(s.length>0,"remoteParticipants need to be set before a call can be made");var c={type:"multiPartyEndpoint",rosterUpdate:r.get(e,o.URL_PATH.CONV_ROSTER_UPDATE)},l=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,u=e.contentSharingManager.getContentSharingInfoToStartSharing(),d=null===u?null:{identifier:u.contentIdentifier,subject:u.subject,sessionState:u.sessionState,sessionUpdateSequenceNumber:u.sequenceNumber,links:{sessionUpdate:r.get(e,o.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,o.URL_PATH.CONV_CONTENT_SHARING_END)}},p=a.enableLightWeightMeeting?e.lightWeightMeetingSession.getLightWeightMeetingInfoToStartViewing():null,h=e.broadcastSession.getContext();1!==s.length?i.assertNotNullOrEmpty(e.threadId,"threadId should be set prior to making a multiparty call"):e.telemetryHelper.setCalleeType(s[0].id),e.numberOfOriginalInvitees=s.length;var f=[];s.forEach(function(e){var t={id:e.id};e.displayName&&(t.displayName=e.displayName),a.callToVoicemail&&(t.endpointType="voicemail"),f.push(t)});var g=a.enableLightWeightMeeting&&0===n.length?null:i.getMediaTypes(n);e.telemetryHelper.addOutgoingModalities(g);var m=e.transferContext?e.transferContext.transferor:null,_={};a.callToVoicemail&&(a.voicemailResourcePath&&(_.localResourcePath=a.voicemailResourcePath),a.voicemailItemId&&(_.voicemailItemId=a.voicemailItemId));var v={payload:{callInvitation:{callModalities:g,replaces:null,transferor:m||null,links:{progress:r.get(e,o.URL_PATH.PROGRESS),mediaAnswer:r.get(e,o.URL_PATH.MEDIA_ANSWER),acceptance:r.get(e,o.URL_PATH.ACCEPT),redirection:r.get(e,o.URL_PATH.REDIRECTION),end:r.get(e,o.URL_PATH.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,emergencyContent:e.getEmergencyContent(),voicemailSettings:_,routingFlags:a.routingFlags},conversationRequest:{conversationType:a.castCall?"cast":null,subject:e.convSubject,suppressDialout:a.suppressDialout,roster:c,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:r.get(e,o.URL_PATH.CONV_END),conversationUpdate:r.get(e,o.URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),addModalitySuccess:r.get(e,o.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:r.get(e,o.URL_PATH.CONV_ADD_MODALITY_FAILURE),confirmUnmute:r.get(e,o.URL_PATH.CONV_CONFIRM_UNMUTE)}},lwj:p,broadcast:h,contentSharing:d,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:f},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledOutgoing?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCOutgoingEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",autoJoinOnConflict:e.signalingAgentConfig.autoJoinOnConflict?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled",supportsCompressedServicePayload:e.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled"},endpointMetadata:e.endpointMetadata,groupChat:l,meetingInfo:e.getMeetingInfo(),endpointState:a.endpointState}};return a.pickupCode&&(v.payload.callInvitation.unparkContent={pickupCode:a.pickupCode}),a.invitationType===o.default.INVITATION_TYPE.NUDGE&&(v.payload.participants.invitationType=a.invitationType),a.onBehalfOf&&(v.payload.callInvitation.onBehalfOf={id:a.onBehalfOf}),v}},function(e,t,n){"use strict";var i=n(0),r=n(1);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:r.default.CALL_END_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED},callTransactionEnd:t}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{callEnd:t}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{contentSharing:{links:{sessionUpdate:r.get(e,o.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,o.URL_PATH.CONV_CONTENT_SHARING_END)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n,a){i.assertNotNull(e,"signalingSession cannot be null");var s=a.enableLightWeightMeeting&&0==n.length?null:i.getMediaTypes(n);e.telemetryHelper.addOutgoingModalities(s);var c=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,l=a.enableLightWeightMeeting?e.lightWeightMeetingSession.getLightWeightMeetingInfoToStartViewing():null;return{payload:{callInvitation:{callModalities:s,replaces:null,transferor:null,links:{progress:r.get(e,o.URL_PATH.PROGRESS),mediaAnswer:r.get(e,o.URL_PATH.MEDIA_ANSWER),acceptance:r.get(e,o.URL_PATH.ACCEPT),redirection:r.get(e,o.URL_PATH.REDIRECTION),end:r.get(e,o.URL_PATH.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent},conversationRequest:{conversationType:a.castCall?"cast":null,subject:e.convSubject,suppressDialout:a.suppressDialout,roster:{type:"multiPartyEndpoint",rosterUpdate:r.get(e,o.URL_PATH.CONV_ROSTER_UPDATE)},properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:r.get(e,o.URL_PATH.CONV_END),conversationUpdate:r.get(e,o.URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,o.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},lwj:l,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",autoJoinOnConflict:e.signalingAgentConfig.autoJoinOnConflict?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled",supportsCompressedServicePayload:e.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled"},endpointMetadata:e.endpointMetadata,groupChat:c,meetingInfo:e.getMeetingInfo(),endpointState:a.endpointState}}}},function(e,t,n){"use strict";var i=n(4),r=n(0),o=n(1);t.getPayload=function(e){return r.assertNotNull(e,"signalingSession cannot be null"),{payload:{lwj:{sessionUpdate:i.get(e,o.URL_PATH.CONV_LIGHT_WEIGHT_MEETING_UPDATE),sessionEnd:i.get(e,o.URL_PATH.CONV_LIGHT_WEIGHT_MEETING_END)},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{contentSharingTransactionEnd:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";var i=n(0),r=n(1);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:r.default.CALL_END_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){i.assertNotNull(e,"signalingSession cannot be null");var a=[];return n&&(a=i.getMediaTypes(n),e.telemetryHelper.addOutgoingModalities(a)),{payload:{mediaNegotiation:{callModalities:a,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAnswer:r.get(e,o.URL_PATH.MEDIA_ANSWER),rejection:r.get(e,o.URL_PATH.MEDIA_REJECTION)},mediaContent:t}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t,n){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"muteScope be null"),i.assertNotNull(n,"participantList cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:t,muteParticipants:n,mediaTypes:["audio"]}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(n,"newOfferLink cannot be null"),{payload:{mediaOfferRequirements:{compatibleContentTypes:t,links:{offerReady:r.get(e,o.URL_PATH.NEW_MEDIA_OFFER)}}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n,a,s){i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"participantsIds cannot be null"),i.assertNotNullOrEmpty(n,"threadId should be set prior to adding participant");var c=[];return t.forEach(function(e){var t={id:e};c.push(t)}),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},invitationType:o.default.INVITATION_TYPE.NUDGE,to:c},participantInvitationData:s,groupChat:{threadId:n,messageId:a},links:{nudgeParticipantSuccess:r.get(e,o.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:r.get(e,o.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"participantsIds cannot be null");var a=[];return t.forEach(function(e){var t={id:e};a.push(t)}),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},invitationType:o.default.INVITATION_TYPE.NUDGE,to:a},participantInvitationData:n,links:{nudgeParticipantSuccess:r.get(e,o.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:r.get(e,o.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t){return i.assertNotNull(t,"signalingSession cannot be null"),{payload:{callTransfer:{target:{id:t.participantManager.localParticipant.id},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},parkType:e,links:{transferAcceptance:r.get(t,o.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:r.get(t,o.URL_PATH.TRANSFER_COMPLETION)}}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{callParticipantUpdate:{links:{mediaRenegotiation:r.get(e,o.URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,o.URL_PATH.TRANSFER),replacement:r.get(e,o.URL_PATH.REPLACE),end:r.get(e,o.URL_PATH.END),balanceUpdate:r.get(e,o.URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,o.URL_PATH.RETARGET_COMPLETION)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls()}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{callEnd:t}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{transactionEnd:t}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{removeParticipantSuccess:r.get(e,o.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:r.get(e,o.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){i.assertNotNull(e,"signalingSession cannot be null");var t=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null;return{payload:{conversationRequest:{roster:{type:"multiPartyEndpoint",rosterUpdate:r.get(e,o.URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:r.get(e,o.URL_PATH.CONV_END),conversationUpdate:r.get(e,o.URL_PATH.CONV_UPDATE)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",autoJoinOnConflict:e.signalingAgentConfig.autoJoinOnConflict?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled",supportsCompressedServicePayload:e.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled"},groupChat:t,meetingInfo:e.getMeetingInfo()}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";t.getPayload=function(){return{payload:{transferAcceptance:{}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){i.assertNotNull(t,"signalingSession cannot be null"),i.assertNotNullOrEmpty(e,"transferTarget cannot be null OR empty");var a=n?{replaces:n.replaces}:null;return{payload:{callTransfer:{target:{id:e},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},links:{transferAcceptance:r.get(t,o.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:r.get(t,o.URL_PATH.TRANSFER_COMPLETION)},replacementDetails:a}}}}},function(e,t,n){"use strict";t.getPayload=function(e){return{payload:{transferCompletion:e}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"],links:{unmuteSuccess:r.get(e,o.URL_PATH.CONV_UNMUTE_SUCCESS),unmuteFailure:r.get(e,o.URL_PATH.CONV_UNMUTE_FAILURE)}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{links:{sessionUpdate:r.get(e,o.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,o.URL_PATH.CONV_CONTENT_SHARING_END)}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t,n){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertNotNull(t,"sessionState cannot be null"),i.assertNotNull(n,"sequenceNumber cannot be null"),{payload:{sessionUpdateSequenceNumber:n,sessionState:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(t,"clientMetadataJson cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},endpointMetadata:t}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(t,"clientStateJson cannot be null"),{payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},endpointState:t}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},roster:{type:"multiPartyEndpoint",rosterUpdate:r.get(e,o.URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:r.get(e,o.URL_PATH.CONV_END),conversationUpdate:r.get(e,o.URL_PATH.CONV_UPDATE),confirmUnmute:r.get(e,o.URL_PATH.CONV_CONFIRM_UNMUTE)}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),i.assertCallEndReason(t),{payload:{mediaNegotiationFailure:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},code:t.code,subCode:t.subCode,phrase:t.phrase},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}}}},function(e,t,n){"use strict";var i=n(0),r=n(4),o=n(1);t.getPayload=function(e,t,n){i.assertNotNull(e,"signalingSession cannot be null");var a=[];return n&&(a=i.getMediaTypes(n),e.telemetryHelper.addOutgoingModalities(a)),{payload:{mediaAnswer:{callModalities:a,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:r.get(e,o.URL_PATH.MEDIA_ACKNOWLEDGEMENT)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}}}},function(e,t,n){"use strict";var i=n(0);t.getPayload=function(e,t){return i.assertNotNull(e,"signalingSession cannot be null"),{payload:{mediaAnswer:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaContent:t,pstnContent:e.pstnContent}}}}},function(e,t,n){"use strict";var i=n(70),r=n(236),o=n(1),a=n(7),s=n(4),c=n(0),l=function(){function e(e){var t=this;this.endpointId=c.newGuid(),this.signalingSessions={},this.getNewSignalingSession=function(e,n,i){c.assertNotNull(e,"selfParticipant should be a non null value"),c.assertNotNull(n,"signalingSessionCallback should be a non null value");var o=i||c.newGuid();c.assertNotNullOrEmpty(o,"signalingSession id generated cannot be null or empty"),t.checkConfigChange();var a=r.build(e,n,t.signalingAgentConfig,o,t),s=a.sessionId;return t.signalingSessions[s]=a,t.logger.log("Created new signalingSession with correlation ID "+o+" and session ID "+s),a},this.resolvePotentialCallConflict=function(e){var n;if(!e.multiParty)return Object.keys(t.signalingSessions).forEach(function(i){t.isSessionInConflictingState(t.signalingSessions[i],!e.isIncomingCall)&&(n=e.isIncomingCall?t.compareAndGetConflictingSession(e,t.signalingSessions[i]):t.compareAndGetConflictingSession(t.signalingSessions[i],e))}),n?(t.logger.info("Call conflict done, conflicting session callId=",n.correlationId,"urlIdentifier=",n.urlIdentifier),n.telemetryHelper.recordEvent(a.EVENTS.CONFLICTED_CALL),t.signalingAgentConfig.endConflictedCall?(t.endConflictedSession(n),n):void 0):void 0},this.handleIncomingNotification=function(e){if(c.assertNotNull(e,"request should be a non null value"),t.logger.log("handleIncomingNotification to : "+e.url),!e.body&&!e.rawBody)return t.logger.error("request has no body"),t.buildNotificationResponse(o.default.HTTP_STATUS_CODES.BAD_REQUEST);var n=o.default.HTTP_STATUS_CODES.OK,i=s.getIdFromUrl(e.url);if(i)if(t.signalingSessions.hasOwnProperty(i)){var r=t.signalingSessions[i];if(c.isEncodedMessage(e.headers))try{if(!c.isMessageEncodingSupported(e.headers))throw"Unsupported encoding";var l=c.decodeMessage(e.rawBody),u=JSON.parse(l);e.body=u}catch(e){return r.telemetryHelper.recordEvent(a.EVENTS.TROUTER_DECODE_PAYLOAD_FAILURE),t.buildNotificationResponse(o.default.HTTP_STATUS_CODES.BAD_REQUEST)}if(r.canHandleIncomingMsgSync(e))return r.handleIncomingMsgSync(e);setTimeout(function(){if(t.signalingSessions.hasOwnProperty(i)){var n=t.signalingSessions[i];n.handleIncomingMsgAsync(e).catch(function(e){n&&n.telemetryHelper&&n.telemetryHelper.recordEvent(a.EVENTS.FAILED_TO_HANDLE_TROUTER_MESSAGE),t.logger.error("handling IncomingMsg failed with error: "+e)})}},0)}else t.logger.log("Incoming message for session ID "+i+", but session was not found!"),n=o.default.HTTP_STATUS_CODES.NOT_FOUND;else t.logger.error("Could not retrieve session ID from Url path. Path = "+e.url),n=o.default.HTTP_STATUS_CODES.BAD_REQUEST;return t.buildNotificationResponse(n)},this.onCallCompleted=function(e){t.signalingSessions.hasOwnProperty(e)?(delete t.signalingSessions[e],t.logger.log("Session ID "+e+" found. Deleted from signalingSession table")):t.logger.error("Session ID "+e+" not found. Could not delete from signalingSession table")},this.endConflictedSession=function(e){t.logger.log("Call conflict, ending signalingSession with callId=",e.correlationId,"urlIdentifier=",e.urlIdentifier),e.endAsync({code:o.default.CALL_END_CODE.CONFLICT,subCode:o.default.CALL_END_SUB_CODE.CONFLICT_IN_NG,phrase:o.default.CALL_END_PHRASE.CONFLICT},!1)},this.compareAndGetConflictingSession=function(e,t){if(c.is1to1Mri(e.incomingCallCallerId)&&c.is1to1Mri(t.participantManager.localParticipant.id)){var n=c.stripMri(e.incomingCallCallerId),i=c.stripMri(t.participantManager.getParticipantsToInitiateCallWith().length&&t.participantManager.getParticipantsToInitiateCallWith()[0].id),r=c.stripMri(t.participantManager.localParticipant.id);if(i===n)return r>n?e:t}},this.isSessionInConflictingState=function(e,n){if(!e)return t.logger.log("Call conflict, ignore, session already disposed"),!1;var i=[o.default.CALL_STATUS.IDLE,o.default.CALL_STATUS.CONNECTING,o.default.CALL_STATUS.RINGING];return!e.multiParty&&i.indexOf(e.getCallStatus())>-1&&(n&&e.isIncomingCall||!n&&!e.isIncomingCall)},this.buildNotificationResponse=function(e,n){return t.signalingAgentConfig.supportsSynchronousTrouterResponse?{resultCode:e,responseBody:n}:e},i.default(e),this.signalingAgentConfig=e,this.logger=e.logger.createChild("SignalingAgent"),c.assertNotNull(e,"signalingAgentConfig should be a non null value"),this.logger.log(e.isWebRtcEnabled?"webRTC enabled":"ORTC enabled"),this.addSkypeTokenCaching()}return e.prototype.updateSignalingAgentConfig=function(e){i.default(e),this.updatedSignalingAgentConfig=e},e.prototype.checkConfigChange=function(){this.updatedSignalingAgentConfig&&this.updatedSignalingAgentConfig!==this.signalingAgentConfig&&(this.signalingAgentConfig=this.updatedSignalingAgentConfig,this.updatedSignalingAgentConfig=null)},e.prototype.addSkypeTokenCaching=function(){var e=this,t=this.signalingAgentConfig.skypeToken;this.signalingAgentConfig.skypeToken=function(){return t.apply(e.signalingAgentConfig).then(function(t){return e.signalingAgentConfig.lastSkypeToken=t,t})}},e}();t.__esModule=!0,t.default=l},function(e,t,n){var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r=n(1),o=n(7),a=n(238),s=n(34),c=n(184),l=n(0),u=n(202),d=n(206),p=n(220),h=n(209),f=n(203),g=n(201),m=n(204),v=n(199),y=n(217),S=n(197),E=n(212),T=n(200),C=n(198),I=n(216),A=n(230),b=n(229),O=n(231),R=n(234),P=n(223),N=n(215),w=n(222),M=n(224),k=n(191),D=n(190),L=n(185),U=n(189),x=n(183),F=n(240),H=n(244),G=n(187),j=n(19),B=n(73),V=function(){function e(e,t,n,u,d){var h=this;this.disposed=!1,this.convSubject=null,this.threadId=null,this.incomingCallCallerId=null,this.incomingCallPayload=null,this.multiParty=!1,this.isIncomingCall=!1,this.isHostLessCall=!1,this.isCastCall=!1,this.numberOfOriginalInvitees=0,this.teamsMessageId=null,this.enableGroupCallMeetupGeneration=!1,this.meetingInfo=null,this.meetingDetails=null,this.emergencyContent=null,this.transferContext=null,this.callType="default",this.transferor=null,this.onBehalfOf=null,this.endpointMetadata={},this.sessionId=l.newGuid(),this.links={},this.provisionalMediaAnswersSeenSoFar=[],this.incomingTrouterMessagesSeenSoFar=[],this.incomingBrokerMessagesSeenSoFar=[],this.currentCallStatus=null,this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,this.convJoined=!1,this.keepAliveTimer=null,this.keepAliveInterval=null,this.keepAliveCount=1,this.remoteCallerOrCallee=null,this.mediaTypesToUse=null,this.lastUsedOutgoingMediaContent=null,this.endpointStateSequenceNumber=0,this.linkUpdateRequested={conversationLinks:!1,keepAliveLinks:!1},this.incomingMessageSyncResponseCache={},this.lastRosterUpdateSeqNumber=-1,this.updateEndpointState=function(e){h.logger.log("updateEndpointState: ",JSON.stringify(e.state));var t=h.links[r.default.LINKS.UPDATE_ENDPOINT_STATE];return h.telemetryHelper.recordEvent(o.EVENTS.UPDATE_ENDPOINT_STATE,{state:e.state}),h.fsmState!==r.default.SIGNALING_FSM_STATE.CONNECTED?(h.logger.log("updateEndpointState will be queued as we are not connected!"),h.pendingEndpointStateWhileConnecting=e,Promise.resolve()):h.endpointStateOnServer&&h.endpointStateOnServer.state&&_.isEqual(e.state,h.endpointStateOnServer.state)&&!h.http.hasPendingRequest(o.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE)?(h.logger.log("updateEndpointState will ignore current update as there is nothing new to send."),Promise.reject("Ignored")):t?(h.http.cancelRequestIfPending(o.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE),e.endpointStateSequenceNumber=++h.endpointStateSequenceNumber,h.http.sendPostRequest({url:t,requestName:o.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE,payload:A.getPayload(h,e),retryIntervals:[0,300,450,600]}).then(function(){h.disposed||(h.endpointStateOnServer=e,h.pendingEndpointStateWhileConnecting=null)})):(h.logger.error("updateEndpointState operation cannot be performed now, the link is not yet available"),Promise.reject("No link"))},this.getParticipantIdForOfferAnswer=function(e){l.assertNotNull(e,"mediaContent should be a non null value"),h.logger.log("getParticipantIdForOfferAnswer");var t=null;return!h.remoteCallerOrCallee||h.threadId||e.newOffer||e.escalationOccurring||(t=h.remoteCallerOrCallee.id),t},this.getMeetingInfo=function(){return h.telemetryHelper.recordEvent(o.EVENTS.GET_MEETING_INFO),h.meetingInfo},this.getEmergencyContent=function(){return h.telemetryHelper.recordEvent(o.EVENTS.GET_EMERGENCY_CONTENT),h.emergencyContent},this.getEndpointId=function(){return h.signalingAgent.endpointId},this.setSubject=function(e){h.disposed||(h.telemetryHelper.recordEvent(o.EVENTS.SET_SUBJECT),l.assertNotNull(e,"subject should be a non null value"),h.convSubject=e)},this.setMultiParty=function(){h.telemetryHelper.recordEvent(o.EVENTS.SET_MULTIPARTY),h.multiParty=!0},this.setOfferAnswerGenerationTimestamps=function(e){h.disposed||h.telemetryHelper.setOfferAnswerGenerationTimestamps(e)},this.setTimeToRingDuration=function(){h.disposed||h.telemetryHelper.setTimeToRingDuration()},this.startLightWeightMeeting=function(e){if(h.disposed)h.logger.log("startLightWeightMeeting canceled");else{h.telemetryHelper.recordEvent(o.EVENTS.START_LIGHT_WEIGHT_MEETING),h.telemetryHelper.setDirection(o.default.DIRECTION.OUTGOING),h.telemetryHelper.setRole(o.default.ROLE.START_FOR_LIGHT_WEIGHT_MEETING),h.telemetryHelper.setMeetingInfo(h.getMeetingInfo()),h.isBrokerEnabledForOutgoingCall()&&h.setupBrokerChannel();var t={newCall:!0,suppressDialout:e&&e.suppressDialout||!1,castCall:e&&e.castCall||!1,conversationServiceUrl:h.signalingAgentConfig.conversationServiceUrl,onBehalfOf:e?e.onBehalfOf:null,enableLightWeightMeeting:!0};h.isCastCall=t.castCall,h.onBehalfOf=t.onBehalfOf,h.placeLightWeightMeetingCall(t)}},this.joinLightWeightMeeting=function(e,t){if(l.assertNotNull(t,"correlationId should be a non null value"),l.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),h.logger.log("joinLightWeightMeeting with url = "+e+" , correlationId = "+t),h.disposed)h.logger.log("joinLightWeightMeeting canceled");else{h.telemetryHelper.recordEvent(o.EVENTS.JOIN_LIGHT_WEIGHT_MEETING),h.telemetryHelper.setDirection(o.default.DIRECTION.INCOMING),h.telemetryHelper.setRole(o.default.ROLE.JOIN_FOR_LIGHT_WEIGHT_MEETING),h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.updateCorrelationId(t);var n={newCall:!1,suppressDialout:!0,castCall:!1,conversationServiceUrl:e,enableLightWeightMeeting:!0};h.isCastCall=n.castCall,h.placeLightWeightMeetingCall(n)}},this.setThreadId=function(e){h.telemetryHelper.recordEvent(o.EVENTS.SET_THREADID),l.assertNotNull(e,"threadId should be a non null value"),h.threadId!==e&&(l.assert(!h.threadId,"conversation threadId has already been set. It cannot be overwritten"),h.threadId=e)},this.setCallOptions=function(e){if(l.assertNotNull(e,"callOptions should be a non null value"),h.logger.log("setCallOptions",JSON.stringify(e)),h.telemetryHelper.recordEvent(o.EVENTS.SET_CALLOPTIONS),e){h.teamsMessageId=e.teamsMessageId||null,h.meetingInfo=e.meetingInfo||null,h.emergencyContent=e.emergencyContent||null,h.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration||!1,h.broadcastSession.setContext(e.broadcastContext);try{h.endpointMetadata=JSON.parse(e.endpointMetadata)}catch(e){h.logger.warn("Unable to parse endpoint metadata")}}},this.setTransferContext=function(e){l.assertNotNull(e,"transferContext should not be null"),h.logger.log("Transfer: setTransferContext",e),h.telemetryHelper.recordEvent(o.EVENTS.SET_TRANSFER_CONTEXT),h.transferContext=e},this.muteAsync=function(e,t){return h.logger.log("muteAsync",e,t),h.telemetryHelper.recordEvent(o.EVENTS.MUTE),e===r.default.MUTE_SCOPE.MYSELF?h.updateEndpointStateForMute(!0):(l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"mute operation for all or specified only allowed in a connected call"),h.participantManager.muteAsync(h.links[r.default.LINKS.MUTE],e,t))},this.unmuteAsync=function(){var e=s.default.isServerMuted(h.participantManager.localParticipant.endpointDetails,h.participantManager.localParticipant.endpointId),t=s.default.isInLobby(h.participantManager.localParticipant.endpointDetails,h.participantManager.localParticipant.endpointId);return h.logger.log("unmuteAsync, isServerMuted:"+e+" isInLobby: "+t),h.telemetryHelper.recordEvent(o.EVENTS.UNMUTE),!e||t?h.updateEndpointStateForMute(!1):(l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"unmute operation only allowed in a connected call"),h.participantManager.unmuteAsync(h.links[r.default.LINKS.UNMUTE]).then(function(){return h.updateEndpointStateForMute(!1)}))},this.rejectUnmuteRequestAsync=function(e,t){return l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"rejectUnmute operation only allowed in a connected call"),l.assertNotNullOrEmpty(e,"requestor must be specified"),h.telemetryHelper.recordEvent(o.EVENTS.REJECT_UNMUTE),h.participantManager.rejectUnmuteRequestAsync(e,t)},this.approveUnmuteRequestAsync=function(e){return l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"approveUnmute operation only allowed in a connected call"),l.assertNotNullOrEmpty(e,"requestor must be specified"),h.telemetryHelper.recordEvent(o.EVENTS.APPROVE_UNMUTE),h.participantManager.approveUnmuteRequestAsync(e)},this.sendWebRtcMediaNotificationAsync=function(e){return l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"webRtc media notification can only be sent in a connected call"),h.telemetryHelper.recordEvent(o.EVENTS.SEND_WEBRTC_MEDIA_NOTIFICATION),h.webRtcSignalingManager.sendControlVideoStreamingAsync(h.links[r.default.LINKS.CONTROL_VIDEO_STREAMING],e)},this.addParticipantAsync=function(e,t,n,i){l.assertNotNull(e,"remoteParticipant should be a non null value"),l.assert(h.isCallOngoing(),"remoteParticipants can only be added before starting an outgoing call or to an ongoing call"),h.logger.log("addParticipantAsync",e.id,t,n),h.telemetryHelper.recordEvent(o.EVENTS.ADD_PARTICIPANT);var a=h.threadId||n,s=h.teamsMessageId||i,c=a?h.links[r.default.LINKS.ADD_PARTICIPANT_AND_MODALITY]:h.links[r.default.LINKS.ADD_PARTICIPANT];return h.participantManager.addParticipantAsync(e,c,h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,t,a,s)},this.nudgeParticipantsAsync=function(e,t,n,i){if(l.assertNotNull(e,"ParticipantsIds should be a non null value"),l.assert(h.isCallOngoing(),"Participants can only be nudged before starting an outgoing call or to an ongoing call"),h.logger.log("nudgeParticipantsAsync",e,r.default.INVITATION_TYPE.NUDGE,t,n),void 0===e||e.length<1)return Promise.reject("List of participants to nudge is empty");h.telemetryHelper.recordEvent(o.EVENTS.ADD_PARTICIPANT,{withNudge:r.default.INVITATION_TYPE.NUDGE});var a=h.threadId||n,s=h.teamsMessageId||i,c=a?h.links[r.default.LINKS.ADD_PARTICIPANT_AND_MODALITY]:h.links[r.default.LINKS.ADD_PARTICIPANT];return h.participantManager.nudgeParticipantsAsync(e,c,h.fsmState===r.default.SIGNALING_FSM_STATE.OUTGOING||h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,t,a,s)},this.callMeBackAsync=function(e){return l.assertNotNull(e,"remoteParticipant should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"call me back can only be called during an ongoing call"),h.logger.log("callMeBackAsync",e.id),h.telemetryHelper.recordEvent(o.EVENTS.CALL_ME_BACK),h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED&&l.assertNotNullOrEmpty(h.threadId,"threadId must be set before using call me back"),h.participantManager.callMeBackAsync(e,h.links[r.default.LINKS.ADD_PARTICIPANT_AND_MODALITY],h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED)},this.removeParticipantAsync=function(e){return l.assertNotNull(e,"remoteParticipant should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"participants can only be removed from an ongoing call"),h.logger.log("removeParticipantAsync",e.id),h.telemetryHelper.recordEvent(o.EVENTS.REMOVE_PARTICIPANT),h.participantManager.removeParticipantAsync(e,h.links[r.default.LINKS.REMOVE_PARTICIPANT])},this.admitParticipantAsync=function(e){return l.assertNotNull(e,"remoteParticipant should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"remoteParticipants can only be admitted to an ongoing call"),l.assertNotNullOrEmpty(h.threadId,"threadId must be set before admitting more participants to connected call"),h.logger.log("admitParticipantAsync",e.id),h.telemetryHelper.recordEvent(o.EVENTS.ADMIT_PARTICIPANT),h.participantManager.admitParticipantAsync(e,h.links[r.default.LINKS.ADMIT])},this.startContentSharingAsync=function(e,t,n,i){return l.assertNotNull(e,"contentIdentifier should be a non null value"),l.assert(h.isCallOngoing(),"contentSharing can only be added before starting an outgoing call or to an ongoing call"),h.logger.log("ContentSharing: start",e,t),h.telemetryHelper.recordEvent(o.EVENTS.ADD_CONTENT_SHARING_MODALITY),h.contentSharingManager.startContentSharingAsync(e,t,n,h.links[r.default.LINKS.ADD_MODALITY],h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,i)},this.deleteContentSharingAsync=function(e){return h.telemetryHelper.recordEvent(o.EVENTS.DELETE_CONTENT_SHARING),h.contentSharingManager.deleteContentSharingAsync(e)},this.joinContentSharingAsync=function(e){return h.telemetryHelper.recordEvent(o.EVENTS.JOIN_CONTENT_SHARING),h.contentSharingManager.joinContentSharingAsync(e)},this.updateContentSharingSessionStateAsync=function(e,t){return l.assertNotNull(t,"sessionState should be a non null value"),h.telemetryHelper.recordEvent(o.EVENTS.UPDATE_SESSION_STATE_CONTENT_SHARING),h.logger.log("ContentSharing: update session state",t),h.contentSharingManager.updateContentSharingSessionStateAsync(e,t)},this.takeContentSharingControlAsync=function(e){return h.telemetryHelper.recordEvent(o.EVENTS.TAKE_CONTROL_CONTENT_SHARING),h.contentSharingManager.takeContentSharingControlAsync(e)},this.updateContentSharingParticipantStateAsync=function(e){return h.telemetryHelper.recordEvent(o.EVENTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING),h.contentSharingManager.updateContentSharingParticipantStateAsync(e)},this.startOutgoingCall=function(e,t,n,i){if(l.assertNotNull(e,"mediaContent should be a non null value"),l.assertNotNull(e.blob,"outgoingSdp should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),h.logger.log("startOutgoingCall"),h.disposed)h.logger.warn("startOutgoingCall canceled");else{var a,s=null;n&&(n.invitationType===r.default.INVITATION_TYPE.NUDGE&&(s={withNudge:n.invitationType===r.default.INVITATION_TYPE.NUDGE}),n.parkContext&&(s={unpark:!0,context:n.parkContext})),h.telemetryHelper.recordEvent(o.EVENTS.START_CALL,s),h.telemetryHelper.setDirection(o.default.DIRECTION.OUTGOING),h.telemetryHelper.setRole(o.default.ROLE.CALLER),h.telemetryHelper.startCallInitializationWatch(i),h.telemetryHelper.setMeetingInfo(h.getMeetingInfo()),h.isBrokerEnabledForOutgoingCall()&&h.setupBrokerChannel(),h.fsmState=r.default.SIGNALING_FSM_STATE.OUTGOING,n&&n.muted&&((a=h.getEndpointState()).state.isMuted=n.muted);var c={newCall:!0,suppressDialout:n&&n.suppressDialout||!1,castCall:n&&n.castCall||!1,conversationServiceUrl:h.signalingAgentConfig.conversationServiceUrl,onBehalfOf:n?n.onBehalfOf:null,enableLightWeightMeeting:!1,callToVoicemail:!!n&&n.callToVoicemail,voicemailResourcePath:n?n.voicemailResourcePath:null,voicemailItemId:n?n.voicemailItemId:null,endpointState:a,invitationType:n&&n.invitationType?n.invitationType:null,participantsToNudge:n&&Array.isArray(n.participantsToNudge)?n.participantsToNudge:null,routingFlags:n?n.routingFlags:null,parkContext:n?n.parkContext:null,pickupCode:n?n.pickupCode:null};h.isCastCall=c.castCall,h.onBehalfOf=c.onBehalfOf,h.placeCall(c,e,t)}},this.joinGivenConversation=function(e,t,n,i,a,s){if(l.assertNotNull(n,"mediaContent should be a non null value"),l.assertNotNull(n.blob,"outgoingSdp should be a non null value"),l.assertNotNull(t,"correlationId should be a non null value"),l.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),l.assert(h.isCallInProgress(),"a call is already in progress"),h.logger.log("joinGivenConversation with url = "+e+" , correlationId = "+t),h.disposed)h.logger.warn("joinGivenConversation canceled");else{var c;h.telemetryHelper.recordEvent(o.EVENTS.JOIN_CALL),h.telemetryHelper.setDirection(o.default.DIRECTION.INCOMING),h.telemetryHelper.setRole(o.default.ROLE.JOIN),h.telemetryHelper.startCallInitializationWatch(a),h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.fsmState=r.default.SIGNALING_FSM_STATE.OUTGOING,h.updateCorrelationId(t),s&&s.muted&&((c=h.getEndpointState()).state.isMuted=s.muted);var u={newCall:!1,suppressDialout:!0,castCall:!1,conversationServiceUrl:e,enableLightWeightMeeting:!1,endpointState:c};h.isCastCall=u.castCall,h.placeCall(u,n,i)}},this.subscribeToCall=function(e,t){return l.assertNotNull(t,"correlationId should be a non null value"),l.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),h.logger.log("subscribeToCall with url = "+e+" , correlationId = "+t),h.disposed?(h.logger.warn("subscribeToCall canceled because session is already disposed"),Promise.reject(r.default.CALL_END_CODE.CALL_DOES_NOT_EXIST)):(h.telemetryHelper.recordEvent(o.EVENTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY),h.telemetryHelper.setDirection(o.default.DIRECTION.INCOMING),h.telemetryHelper.setRole(o.default.ROLE.JOIN_FOR_ROSTER_ONLY),h.telemetryHelper.setConversationServiceUrl(e),h.telemetryHelper.setCallerType(h.participantManager.localParticipant.id),h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.fsmState=r.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,h.updateCorrelationId(t),h.http.sendPostRequest({url:e,requestName:o.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,payload:p.getPayload(h)}).then(function(e){if(!h.disposed){if(!e.response.roster)throw new Error("response does not contain a roster");h.fsmState=r.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,h.processConversationServiceResponse(e.response),h.onCallStatusChanged(r.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY),h.internalHandleRosterUpdate(e.response.roster)}}).catch(function(e){if(!h.disposed){h.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var t=l.getErrorForXHRFailure(e);h.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Subscribe to call failed:"+l.getPrintableObject(e)}),h.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,t.error),h.dispose(t.error)}}))},this.transferCallAsync=function(e,t){l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet"),h.logger.log("Transfer: transferCallAsync",e,t),h.telemetryHelper.recordEvent(o.EVENTS.TRANSFER_CALL),h.timeoutManager.startTimer(r.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,function(){return h.handleCallTransferTimeout()}),h.http.sendPostRequest({url:h.links[r.default.LINKS.TRANSFER],requestName:o.NETWORK_REQUESTS.SEND_TRANSFER_REQUEST,payload:P.getPayload(e,h,t)}).catch(function(e){h.logger.error("transferCallAsync failed because: "+l.getPrintableObject(e)),h.disposed||h.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:r.default.CALL_END_CODE.NETWORK_ERROR,reason:l.getPrintableObject(e)}})})},this.parkCallAsync=function(e){l.assertNotNull(e,"context should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet"),h.logger.log("ParkCall:",e),h.telemetryHelper.recordEvent(o.EVENTS.PARK_CALL),h.timeoutManager.startTimer(r.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,function(){return h.handleCallTransferTimeout()}),h.http.sendPostRequest({url:h.links[r.default.LINKS.TRANSFER],requestName:o.NETWORK_REQUESTS.SEND_PARK_REQUEST,payload:N.getPayload(e,h)}).catch(function(e){h.logger.error("parkCallAsync failed because: "+l.getPrintableObject(e)),h.disposed||h.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:r.default.CALL_END_CODE.NETWORK_ERROR,reason:l.getPrintableObject(e)}})})},this.getCallStatus=function(){return h.currentCallStatus},this.processIncomingCallRequest=function(e,t){if(l.assertNotNull(e,"request should be a non null value"),l.assertNotNullOrEmpty(e.body,"request should have a valid body"),l.assertNotNullOrEmpty(e.body.gp,"request does not look valid"),l.assert(h.isCallInProgress(),"a call is already in progress"),h.logger.log("processIncomingCallRequest"),h.disposed)h.logger.warn("processIncomingCallRequest canceled");else{h.telemetryHelper.recordEvent(o.EVENTS.HANDLE_INCOMING_CALL),h.telemetryHelper.setDirection(o.default.DIRECTION.INCOMING),h.telemetryHelper.setRole(o.default.ROLE.CALLEE),h.telemetryHelper.setCalleeType(h.participantManager.localParticipant.id),h.telemetryHelper.startCallInitializationWatch(),h.isIncomingCall=!0,h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.fsmState=r.default.SIGNALING_FSM_STATE.INCOMING,h.participantManager.initializeForIncomingCall();var n={};try{t&&(n=JSON.parse(t))}catch(e){h.logger.warn("Unable to parse endpoint metadata")}h.endpointMetadata=n;try{var i=atob(e.body.gp),a=JSON.parse(i);if(!a.callNotification)throw"CallNotification is missing";h.processIncomingCallPayload(a),h.incomingCallPayload=a}catch(e){h.endIncomingCallBecauseOfInvalidPayload()}}},this.sendAttachToCall=function(){return h.logger.log("sendAttachToCall"),h.incomingCallPayload?(h.onCallStatusChanged(r.default.CALL_STATUS.IDLE),h.sendAttachToCallInternal()):(h.endIncomingCallBecauseOfInvalidPayload(),Promise.reject(r.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD))},this.supportsNewOfferRequest=function(){return h.signalingAgentConfig.handleNewOfferRequest},this.requestNewOffer=function(e){return h.telemetryHelper.recordEvent(o.EVENTS.REQUEST_NEW_OFFER),h.signalingAgentConfig.handleNewOfferRequest?(l.assertNotNullOrEmpty(h.links[r.default.LINKS.NEW_OFFER],"newOffer link should be a non null value"),h.http.sendPostRequest({url:h.links[r.default.LINKS.NEW_OFFER],requestName:o.NETWORK_REQUESTS.REQUEST_NEW_OFFER,payload:E.getPayload(h,e,h.links[r.default.LINKS.NEW_OFFER])}).then(function(e){return h.disposed?Promise.reject("Session disposed!"):Promise.resolve(e)}).catch(function(e){if(h.logger.error("requestNewOffer failed because: "+l.getPrintableObject(e)),!h.disposed){h.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var t=l.getErrorForXHRFailure(e);h.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Failed to attach to call. Error = "+l.getPrintableObject(e)}),h.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,t.error),h.dispose(t.error)}})):Promise.reject("Disabled")},this.endAsync=function(e,t){if(h.logger.log("endAsync",e&&JSON.stringify(e)),h.disposed)return h.logger.warn("endAsync canceled but session already disposed"),Promise.resolve(null);if(h.telemetryHelper.recordEvent(o.EVENTS.END_CALL,e?{code:e.code,subCode:e.subCode}:void 0),h.fsmState===r.default.SIGNALING_FSM_STATE.INCOMING)return h.rejectIncomingCall(e);if(h.fsmState===r.default.SIGNALING_FSM_STATE.OUTGOING||h.fsmState===r.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY)return h.cancelOutgoingCall(e);if(h.fsmState===r.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK)return h.rejectIncomingCall(e);if((h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED||h.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||h.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())&&t)return h.deleteConversation(e);if(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED||h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||h.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||h.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())return h.terminateEstablishedCall(e);h.logger.log("endAsync, there is no call to cancel or end or reject in current state");var n=e||{code:r.default.CALL_END_CODE.NOT_FOUND,subCode:r.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:r.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST};return h.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultDetail:"There is no call to cancel or end or reject",endCode:n.code,endSubCode:n.subCode}),h.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,n),h.dispose(n),Promise.resolve(null)},this.handleIncomingMsgAsync=function(e,t){void 0===t&&(t=r.default.INCOMING_MESSAGE_ORIGIN.TROUTER),l.assertNotNull(e,"incoming message should be a non null value");var n=e.headers?e.headers[r.default.HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",a=l.defer(),s=e.body,c=e.url,u=i({},e,{origin:t});if(h.logger.log("handleIncomingMsg","message id:",n,"message url:",c),!s)return h.logger.error("handleIncomingMsg : received message with no body to : "+e.url),h.telemetryHelper.recordEvent(o.EVENTS.MESSAGE_MISSING_BODY,{origin:t,messageId:n}),a.reject(new Error("received message with no body")),a.promise;if(h.disposed)return h.logger.log("handleIncomingMsg : received message after call is disposed"),a.reject(new Error("received message after call is disposed")),a.promise;if(h.isDuplicatedIncomingMessage(u))return h.logger.info("handleIncomingMsg : message was already handled",u),h.telemetryHelper.recordEvent(o.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:t,messageId:n}),a.resolve(new Error("Message was already handled")),a.promise;h.checkCorrelationIdChange(e);var d,p,f=((d={})[r.PAYLOAD_PROPERTY.CALL_NOTIFICATION]=function(e){return h.handleCallNotification(e)},d[r.PAYLOAD_PROPERTY.MEDIA_ANSWER]=function(e){return h.handleMediaAnswer(e)},d[r.PAYLOAD_PROPERTY.MEDIA_ACKNOWLEDGEMENT]=function(e){return h.handleMediaAcknowledgement(e)},d[r.PAYLOAD_PROPERTY.CALL_ACCEPTANCE]=function(e){return h.handleCallAcceptance(e)},d[r.PAYLOAD_PROPERTY.CALL_END]=function(e){return h.handleCallEnd(e)},d[r.PAYLOAD_PROPERTY.CALL_PROGRESS]=function(e){return h.handleCallProgress(e)},d[r.PAYLOAD_PROPERTY.CALL_ACCEPTANCE_ACKNOWLEDGEMENT]=function(e){return h.handleCallAcceptanceAck(e)},d[r.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION]=function(e){return h.mediaRenegotiationManager.handleMediaNegotiationOffer(e)},d[r.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION_FAILURE]=function(e){return h.mediaRenegotiationManager.handleMediaNegotiationFailure(e)},d[r.PAYLOAD_PROPERTY.BALANCE_UPDATE]=function(e){return h.handlePSTNBalanceUpdate(e)},d[r.PAYLOAD_PROPERTY.RETARGET_COMPLETED]=function(e){return h.mediaRenegotiationManager.handleRetargetCompleted(e)},d[r.PAYLOAD_PROPERTY.CALL_TRANSFER]=function(e){return h.handleTransferRequested(e)},d[r.PAYLOAD_PROPERTY.TRANSFER_COMPLETION]=function(e){return h.handleTransferCompletion(e)},d[r.PAYLOAD_PROPERTY.TRANSFER_ACCEPTANCE]=function(e){return h.handleTransferAcceptance(e)},d),g=((p={})[r.URL_PATH.CONTROL_VIDEO_STREAMING]=function(e){return h.webRtcSignalingManager.handleControlVideoStreaming(e)},p[r.URL_PATH.DOMINANT_SPEAKER_INFO]=function(e){return h.webRtcSignalingManager.handleDominantSpeakerInfo(e)},p[r.URL_PATH.CSRC_INFO]=function(e){return h.webRtcSignalingManager.handleCsrcInfo(e)},p[r.URL_PATH.CONV_ROSTER_UPDATE]=function(e){return h.handleRosterUpdate(e)},p[r.URL_PATH.NEW_MEDIA_OFFER]=function(e){return h.handleNewMediaOffer(e)},p[r.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS]=function(e){return h.participantManager.handleAddParticipantSuccess(e)},p[r.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE]=function(e){return h.participantManager.handleAddParticipantFailure(e)},p[r.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS]=function(e){return h.participantManager.handleAdmitParticipantSuccess(e)},p[r.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE]=function(e){return h.participantManager.handleAdmitParticipantFailure(e)},p[r.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS]=function(e){return h.participantManager.handleRemoveParticipantSuccess(e)},p[r.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE]=function(e){return h.participantManager.handleRemoveParticipantFailure(e)},p[r.URL_PATH.CONV_CONFIRM_UNMUTE]=function(e){return h.participantManager.handleUnmuteConfirmRequest(e)},p[r.URL_PATH.CONV_UNMUTE_FAILURE]=function(e){return h.participantManager.handleUnmuteFailure(e)},p[r.URL_PATH.CONV_UNMUTE_SUCCESS]=function(e){return h.participantManager.handleUnmuteSuccess(e)},p[r.URL_PATH.CONV_UPDATE]=function(e){return h.handleConversationUpdate(e)},p[r.URL_PATH.CONV_ADD_MODALITY_SUCCESS]=function(e){return h.handleAddModalitySuccess(e)},p[r.URL_PATH.CONV_ADD_MODALITY_FAILURE]=function(e){return h.handleAddModalityFailure(e)},p[r.URL_PATH.CONV_LIGHT_WEIGHT_MEETING_UPDATE]=function(e){return h.lightWeightMeetingSession.handleLightWeightMeetingUpdate(e)},p[r.URL_PATH.CONV_LIGHT_WEIGHT_MEETING_END]=function(e){return h.lightWeightMeetingSession.handleLightWeightMeetingEndByService(e)},p[r.URL_PATH.CONV_BROADCAST_UPDATE]=function(e){return h.broadcastSession.handleBroadcastStateChanged(e)},p[r.URL_PATH.CONV_CONTENT_SHARING_UPDATE]=function(e){return h.contentSharingManager.handleContentSharingUpdate(e)},p[r.URL_PATH.CONV_CONTENT_SHARING_END]=function(e){return h.contentSharingManager.handleContentSharingEnd(e)},p[r.URL_PATH.CONV_END]=function(e){return h.handleCallEnd(e)},p);try{var m=Object.keys(f).filter(function(e){return s.hasOwnProperty(e)})[0],_=Object.keys(g).filter(function(e){return u.url&&l.stringEndsWith(u.url,e)})[0];m?f[m](u):_?g[_](u):(h.telemetryHelper.recordEvent(o.EVENTS.UNKNOWN_MESSAGE_TYPE,{messageId:n}),h.logger.error("handleIncomingMsg : received unknown message to : "+c+"  with body : "+l.getPrintableObject(s))),a.resolve(!0)}catch(e){h.telemetryHelper.recordEvent(o.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:n}),h.logger.error("handleIncomingMsg failed with error : "+e.message+"stack trace : "+e.stack),a.reject(new Error(e.message))}return a.promise},this.canHandleIncomingMsgSync=function(e){if(h.signalingAgentConfig.supportsSynchronousTrouterResponse){var t=e.body;return Boolean(t.callAcceptance)}return!1},this.handleIncomingMsgSync=function(e){var t,n=e.headers?e.headers[r.default.HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",a=e.body,s=e.url,c=r.default.INCOMING_MESSAGE_ORIGIN.TROUTER,u=i({},e,{origin:c});h.logger.log("handleIncomingMsg","message id:",n,"message url:",s);var d=r.default.HTTP_STATUS_CODES.OK,p="",f={};if(l.isDuplicateMessage(u.headers,h.incomingTrouterMessagesSeenSoFar)){h.logger.warn("handleIncomingMsgSync : received message was already handled");var g=l.getMessageResultFromCache(u.headers,h.incomingMessageSyncResponseCache);if(g)return h.logger.warn("handleIncomingMsgSync : returning previous result",g),g;h.telemetryHelper.recordEvent(o.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:c,messageId:n}),h.logger.warn("handleIncomingMsgSync : previous result not found, returning error code:",r.default.HTTP_STATUS_CODES.BAD_REQUEST),d=r.default.HTTP_STATUS_CODES.BAD_REQUEST}else if(a){if(a.callAcceptance)try{var m=h.handleCallAcceptanceSync(u);p=JSON.stringify(m)}catch(e){h.telemetryHelper.recordEvent(o.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:n,origin:c}),h.logger.error("handleIncomingMsgSync failed with error : "+e.message+"stack trace : "+e.stack),d=r.default.HTTP_STATUS_CODES.BAD_REQUEST}}else h.logger.error("handleIncomingMsgSync : received message with no body to : "+u.url),h.telemetryHelper.recordEvent(o.EVENTS.MESSAGE_MISSING_BODY,{origin:c,messageId:n}),d=r.default.HTTP_STATUS_CODES.BAD_REQUEST;return u.headers&&(u.headers[r.default.HEADERS.CORRELATION_ID]&&(f[r.default.HEADERS.CORRELATION_ID]=u.headers[r.default.HEADERS.CORRELATION_ID]),u.headers[r.default.HEADERS.MESSAGE_ID]&&(f[r.default.HEADERS.MESSAGE_ID]=u.headers[r.default.HEADERS.MESSAGE_ID])),t={resultCode:d,responseBody:p,responseHeaders:f},l.cacheMessageResult(u.headers,h.incomingMessageSyncResponseCache,t),h.logger.log("handleIncomingMsgSync : message handled with resultCode : ",d,"responseBody",p),t},this.acceptRenegotiationAsync=function(e,t){return l.assertNotNull(e.blob,"finalSdp should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),h.logger.log("acceptRenegotiationAsync",t),h.mediaRenegotiationManager.acceptRenegotiationAsync(e,t)},this.setProvisionalAnswerAsync=function(e){l.assertNotNull(e.blob,"sdp should be a non null value"),h.telemetryHelper.recordEvent(o.EVENTS.SET_PROVISIONAL_ANSWER);var t=l.defer();return h.fsmState!==r.default.SIGNALING_FSM_STATE.INCOMING?(h.logger.log("there is no incoming call to set provisional answer on."),t.reject(new Error("there is no incoming call to set provisional answer on.")),t.promise):(h.http.sendPostRequest({url:h.links[r.default.LINKS.MEDIA_ANSWER],requestName:o.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,payload:R.getPayload(h,e)}).then(function(e){h.disposed||h.onCallStatusChanged(r.default.CALL_STATUS.CONNECTING),t.resolve(e.response),h.disposed||(h.telemetryHelper.recordEvent(o.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT),h.telemetryHelper.setTimeToRingDuration(),h.onCallStatusChanged(r.default.CALL_STATUS.RINGING),h.signalingSessionCallback.onMediaAcknowledgementSuccess(!1))}).catch(function(e){h.logger.error("setProvisionalAnswerAsync failed because: "+l.getPrintableObject(e)),h.disposed||h.telemetryHelper.recordEvent(o.EVENTS.SET_PROVISIONAL_ANSWER_FAILED),t.reject(o.EVENTS.SET_PROVISIONAL_ANSWER_FAILED)}),t.promise)},this.startRenegotiationAsync=function(e,t){return l.assertNotNull(e,"mediaContent should be a non null value"),l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),h.logger.log("startRenegotiationAsync"),h.mediaRenegotiationManager.startRenegotiationAsync(e,h.links[r.default.LINKS.MEDIA_RENEGOTIATION],t)},this.acceptAsync=function(e,t){l.assertNotNull(e,"mediaContent should be a non null value"),l.assertNotNull(e.blob,"outgoingSdp should be a non null value"),h.logger.log("acceptAsync"),h.telemetryHelper.recordEvent(o.EVENTS.ACCEPT_CALL);var n=l.defer();return h.fsmState!==r.default.SIGNALING_FSM_STATE.INCOMING?(h.logger.warn("acceptAsync, there is no incoming call to accept"),n.reject(new Error("there is no incoming call to accept")),n.promise):(h.fsmState=r.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK,h.http.sendPostRequest({url:h.links[r.default.LINKS.ACCEPT],requestName:o.NETWORK_REQUESTS.SEND_ACCEPTANCE,payload:v.getPayload(h,e,t)}).then(function(e){h.disposed||(h.currentCallStatus===r.default.CALL_STATUS.IDLE&&(h.telemetryHelper.setTimeToRingDuration(),h.telemetryHelper.recordEvent(o.EVENTS.ACCEPTED_BEFORE_RINGING),h.onCallStatusChanged(r.default.CALL_STATUS.CONNECTING)),e.response.callAcceptanceAcknowledgement&&(h.logger.log("acceptAsync, handling inlined callAcceptanceAcknowledgement"),h.internalHandleCallAcceptanceAck(e.response))),n.resolve(e.response)}).catch(function(e){h.disposed||(h.fsmState=r.default.SIGNALING_FSM_STATE.INCOMING),n.reject(new Error("acceptAsync, failed because : "+l.getPrintableObject(e)))}),n.promise)},this.rejectRenegotiationAsync=function(e){return l.assert(h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),h.logger.error("rejectRenegotiationAsync",e),h.mediaRenegotiationManager.rejectRenegotiationAsync(e)},this.saveMediaControllerLinksIfAny=function(e){e.links&&e.links.controlVideoStreaming&&(h.links[r.default.LINKS.CONTROL_VIDEO_STREAMING]=e.links.controlVideoStreaming)},this.getInitialMediaOfferFromIncomingCallPayload=function(){return h.signalingAgentConfig.handleMediaOfferFromPushNotification&&h.incomingCallPayload&&h.incomingCallPayload.callNotification&&h.incomingCallPayload.callNotification.mediaContent?h.incomingCallPayload.callNotification.mediaContent:null},this.updateCorrelationId=function(e){h.correlationId===e||h.disposed||(h.correlationId=e,h.telemetryHelper&&h.telemetryHelper.recordEvent&&h.telemetryHelper.recordEvent(o.EVENTS.CORRELATION_ID_UPDATED,{newId:h.correlationId}),h.signalingSessionCallback&&h.signalingSessionCallback.onCorrelationIdUpdated&&h.signalingSessionCallback.onCorrelationIdUpdated(h.correlationId))},this.endIncomingCallBecauseOfInvalidPayload=function(){h.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,h.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,endCode:r.default.CALL_END_CODE.BAD_REQUEST,endSubCode:r.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,resultDetail:"Invalid callNotification request"});var e={code:r.default.CALL_END_CODE.BAD_REQUEST,subCode:r.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:r.default.CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD};h.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,e),h.dispose(e)},this.isDuplicatedIncomingMessage=function(e){return e.origin===r.default.INCOMING_MESSAGE_ORIGIN.BROKER&&l.isDuplicateMessage(e.headers,h.incomingBrokerMessagesSeenSoFar)||e.origin===r.default.INCOMING_MESSAGE_ORIGIN.TROUTER&&l.isDuplicateMessage(e.headers,h.incomingTrouterMessagesSeenSoFar)},this.updateEndpointStateForMute=function(e){if(!h.signalingAgentConfig.serverMuteUnmute)return Promise.resolve(null);var t=h.getEndpointState();return e||void 0!==t.state.isMuted?(t.state.isMuted=e,h.updateEndpointState(t),Promise.resolve(null)):Promise.resolve(null)},this.getEndpointState=function(){var e;return e=h.currentCallStatus===r.default.CALL_STATUS.CONNECTED?_.cloneDeep(h.endpointStateOnServer):_.cloneDeep(h.pendingEndpointStateWhileConnecting),_.isEmpty(e)&&(e={endpointStateSequenceNumber:h.endpointStateSequenceNumber,state:{}}),e},this.setupTrouterChannel=function(){h.logger.log("enabled");var e=function(e){e&&"string"==typeof e&&e.trim()&&(h.baseMessagingChannelUrl=h.previousTrouterUrl=h.currentTrouterUrl=e.trim(),h.telemetryHelper.addTrouterChannel())};h.brokerExclusiveEnabled()||(h.signalingAgentConfig.trouterServiceProvider&&h.signalingAgentConfig.trouterServiceProvider.state()===B.TrouterState.Connected?(h.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync().then(e),h.signalingAgentConfig.trouterServiceProvider.onStateChanged(h.onTrouterStateChanged)):(e(h.signalingAgentConfig.trouterUrlGetter.trouterUrl()),h.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed(h.onTrouterUrlChanged)))},this.getTrouterUrlAsync=function(){return h.signalingAgentConfig.trouterServiceProvider?h.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync():h.signalingAgentConfig.trouterUrlGetter.getTrouterUrlAsync()},this.brokerExclusiveEnabled=function(){return h.signalingAgentConfig.brokerEnabledOutgoing&&h.signalingAgentConfig.brokerEnabledIncoming&&h.signalingAgentConfig.brokerExclusively},this.isBrokerEnabledForOutgoingCall=function(){return h.signalingAgent.signalingAgentConfig.brokerEnabledOutgoing},this.isBrokerEnabledForIncomingCall=function(){return h.signalingAgent.signalingAgentConfig.brokerEnabledIncoming},this.setupBrokerChannel=function(){h.brokerService||(h.logger.log("setupBrokerChannel, Enable broker"),h.brokerService=new c.default(h),h.brokerService.onBrokerMessage(function(e){h.logger.log("setupBrokerChannel, message from broker",e),h.handleIncomingMsgAsync(e,r.default.INCOMING_MESSAGE_ORIGIN.BROKER).catch(function(e){h.telemetryHelper.recordEvent(o.EVENTS.FAILED_TO_HANDLE_BROKER_MESSAGE),h.logger.info("setupBrokerChannel, Failed to handle message from broker",e)})}),h.baseMessagingChannelUrl||(h.telemetryHelper.addBrokerChannel(),h.baseMessagingChannelUrl=h.brokerService.baseUrl))},this.onTrouterUrlChanged=function(){h.logger.log("onTrouterUrlChanged"),h.disposed?h.logger.log("onTrouterUrlChanged ignored"):(h.telemetryHelper.recordEvent(o.EVENTS.TROUTER_URL_CHANGED,{url:h.signalingAgentConfig.trouterUrlGetter.trouterUrl()}),h.telemetryHelper.addTrouterChannel(),h.updateLinksToTrouter(o.EVENTS.TROUTER_URL_CHANGED))},this.onTrouterStateChanged=function(e,t){h.logger.log("onTrouterStateChanged"),h.disposed?h.logger.log("onTrouterStateChanged ignored"):(h.telemetryHelper.recordEvent(o.EVENTS.TROUTER_STATE_CHANGED,{state:e,url:t}),e===B.TrouterState.Connected&&(h.telemetryHelper.addTrouterChannel(),h.updateLinksToTrouter(o.EVENTS.TROUTER_STATE_CHANGED)))},this.updateLinksToTrouter=function(e){h.logger.log("updateLinksToTrouter"),h.ensureLatestTrouterUrl(e).then(function(){h.previousTrouterUrl!==h.currentTrouterUrl?(h.previousTrouterUrl=h.currentTrouterUrl,h.updateConversationLinks(),h.updateKeepAliveUrl(),h.contentSharingManager.updateContentSharingNotificationLinksAsync(),h.broadcastSession.updateBroadcastCallbackUrl()):h.logger.info("updateLinksToTrouter, skip updating links, url did not change")}).catch(function(e){h.disposed||h.telemetryHelper.recordEvent(o.EVENTS.TROUTER_URL_UPDATE_FAILED),h.logger.warn("updateLinksToTrouter, failed to update links to trouter")})},this.updateLinks=function(e){h.ensureLatestTrouterUrl(o.EVENTS.TROUTER_URL_CHANGED).then(function(){return e()}).catch(function(e){h.disposed||h.telemetryHelper.recordEvent(o.EVENTS.TROUTER_URL_UPDATE_FAILED),h.logger.warn("Failed to update links")})},this.handleRosterFromCreateAndJoin=function(e){h.signalingAgentConfig.handleRosterFromCreateAndJoin&&e.response&&e.response.roster&&h.internalHandleRosterUpdate(e.response.roster)},this.updateKeepAliveUrl=function(){h.logger.log("updateKeepAliveUrl"),h.links.hasOwnProperty(r.default.LINKS.KEEPALIVE)?(h.linkUpdateRequested.keepAliveLinks=!1,h.logger.log("updateKeepAliveUrl, sending request"),h.sendToKeepAliveUrl(I.getPayload(h))):h.linkUpdateRequested.keepAliveLinks=!0},this.updateConversationLinks=function(){h.logger.log("updateConversationLinks"),h.telemetryHelper.recordEvent(o.EVENTS.UPDATE_CONVERSATION_LINKS),h.links.hasOwnProperty(r.default.LINKS.NOTIFICATION_LINKS)?(h.linkUpdateRequested.conversationLinks=!1,h.logger.log("sending conversation service UpdateNotificationLinks request"),h.http.sendPostRequest({url:h.links[r.default.LINKS.NOTIFICATION_LINKS],retryIntervals:[500,1e3,2e3,3e3],payload:O.getPayload(h),withoutTrouter:!0,requestName:o.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS}).then(function(e){h.disposed||(h.telemetryHelper.recordEvent(o.EVENTS.UPDATE_CONVERSATION_LINKS_SUCCESS),h.processConversationServiceResponse(e.response))}).catch(function(e){h.logger.error("updateConversationLinks failed because: "+l.getPrintableObject(e)),h.disposed||h.telemetryHelper.recordEvent(o.EVENTS.UPDATE_CONVERSATION_LINKS_FAILED)})):h.linkUpdateRequested.conversationLinks=!0},this.sendAttachToCallInternal=function(){h.telemetryHelper.recordEvent(o.EVENTS.SEND_ATTACH);var e,t=h.signalingAgentConfig.sendProgressFromCC?((e={})[r.default.HEADERS.CACHE_SKYPE_TOKEN]="1",e):null;return h.http.sendPostRequest({url:h.incomingCallPayload.callNotification.links.attach,customHeaders:t,requestName:o.NETWORK_REQUESTS.SEND_CALL_ATTACH,payload:S.getPayload(h,h.incomingCallPayload.conversationInvitation.conversationController,!h.getInitialMediaOfferFromIncomingCallPayload())}).then(function(e){if(!h.disposed){h.processAttachResponse(h.incomingCallPayload,e);var t=e.response.additionalActionResponses;t&&t.length>0&&(h.processConversationServiceResponse(t[0].output),t[0].output.roster&&(h.logger.log("sendAttachToCall, handling roster update from join response"),h.internalHandleRosterUpdate(t[0].output.roster))),h.onCallStatusChanged(r.default.CALL_STATUS.RINGING),h.telemetryHelper.setTimeToRingDuration(),h.handleBrokerSubscription(e.response.callInvitation)}}).catch(function(e){if(h.logger.error("sendAttachToCall failed because: "+l.getPrintableObject(e)),!h.disposed){h.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var t=l.getErrorForXHRFailure(e);h.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Failed to attach to call. Error = "+l.getPrintableObject(e)}),h.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,t.error),h.dispose(t.error)}})},this._processCallAcceptance=function(e){h.fsmState===r.default.SIGNALING_FSM_STATE.OUTGOING&&(h.processCallAcceptance(e.body),h.telemetryHelper.setTimeToRingDuration(),h.multiParty||h.participantManager.handleRosterUpdate(h.getFakeRoster(e.body)))},this.restartKeepAliveInterval=function(e){void 0===e&&(e=!1),h.disposed||(e&&h.telemetryHelper.recordEvent(o.EVENTS.SEND_KEEP_ALIVE_FAILED),h.keepAliveTimer=window.setInterval(h.sendKeepAlive.bind(h),h.keepAliveInterval))},this.isCallOngoing=function(){return h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED||h.fsmState===r.default.SIGNALING_FSM_STATE.IDLE},this.isCallInProgress=function(){return h.fsmState===r.default.SIGNALING_FSM_STATE.IDLE||h.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},this.signalingSessionCallback=t,this.signalingAgentConfig=n,this.signalingAgent=d,this.urlIdentifier=u,this.updateCorrelationId(u),this.logger=n.logger.createChild(function(){return"SignalingAgent::["+h.correlationId+"]["+u+"]["+h.fsmState+"]"},this.correlationId,!0),this.http=new G.HttpStack(this),this.telemetryHelper=new a.default(this),this.mediaRenegotiationManager=new D.default(this,t),this.participantManager=new k.default(this,t,e),this.timeoutManager=new F.default(this),this.contentSharingManager=new L.default(this,t),this.lightWeightMeetingSession=new U.default(this,t),this.broadcastSession=new x.default(this,t),this.webRtcSignalingManager=new H.default(this,t),this.pstnContent={emergencyCallCountry:n.emergencyCallCountry||"",platformName:n.clientInformation,publicApiCall:!1},this.setupTrouterChannel()}return e.prototype.updateEndpointMetadata=function(e){var t={};try{t=JSON.parse(e)}catch(e){return Promise.reject("Invalid metadata")}return this.http.sendPutRequest({url:this.links[r.default.LINKS.UPDATE_ENDPOINT_METADATA],requestName:o.NETWORK_REQUESTS.UPDATE_ENDPOINT_METADATA,payload:b.getPayload(this,t)}).then(function(){})},e.prototype.getCallReplacementDetails=function(){return{replaces:this.links[r.default.LINKS.REPLACE]}},e.prototype.onLightWeightMeetingEnded=function(e,t){this.logger.log("onLightWeightMeetingEnded"),this.isCallOngoing()?this.logger.log("onLightWeightMeetingEnded, canceled, call is not ongoing"):(this.telemetryHelper.setTerminatingData({terminatingEnd:t?o.default.CALL_TERMINATING_END.LOCAL:o.default.CALL_TERMINATING_END.REMOTE,resultValue:e.code===r.default.CALL_END_CODE.SUCCESS?o.default.RESULT_VALUE.SUCCESS:o.default.RESULT_VALUE.FAILURE,resultDetail:e.phrase,endCode:e.code,endSubCode:e.subCode}),this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(t?r.default.CALL_STATUS.LOCAL_TERMINATED:r.default.CALL_STATUS.REMOTE_TERMINATED,e),this.dispose(e))},e.prototype.saveUpdatedCallLinksIfAny=function(e){e.links&&(this.logger.log("saveUpdatedCallLinksIfAny, updated call links found, update to new links"),this.links[r.default.LINKS.MEDIA_RENEGOTIATION]=e.links.mediaRenegotiation||this.links[r.default.LINKS.MEDIA_RENEGOTIATION],this.links[r.default.LINKS.TRANSFER]=e.links.transfer||this.links[r.default.LINKS.TRANSFER],this.links[r.default.LINKS.REPLACE]=e.links.replacement||this.links[r.default.LINKS.REPLACE],this.links[r.default.LINKS.HANGUP]=e.links.callLeg||this.links[r.default.LINKS.HANGUP],this.links[r.default.LINKS.KEEPALIVE]=e.links.callLeg||this.links[r.default.LINKS.KEEPALIVE])},e.prototype.ensureMessageChannelReady=function(e){return this.disposed?Promise.reject(new Error("Session already disposed")):this.brokerService?(this.telemetryHelper.addTrouterWaitOperation(o.default.TROUTER_WAIT_OPERATION.STARTED+":"+e),this.telemetryHelper.addTrouterWaitOperation(o.default.TROUTER_WAIT_OPERATION.ENDED+":"+e),Promise.resolve()):this.ensureLatestTrouterUrl(e)},e.prototype.ensureLatestTrouterUrl=function(e){var t=this;return this.telemetryHelper.addTrouterWaitOperation(o.default.TROUTER_WAIT_OPERATION.STARTED+":"+e),this.getTrouterUrlAsync().then(function(n){if(!n||"string"==typeof n&&!n.trim())throw t.telemetryHelper.recordEvent(o.EVENTS.TROUTER_URL_CHANGED_TO_INVALID),t.telemetryHelper.addTrouterWaitOperation(o.default.TROUTER_WAIT_OPERATION.ENDED+":"+e),"Invalid trouter url";if(t.disposed)throw"ensureLatestTrouterUrl, trouterUrlGetter returned too late. Object is already disposed";t.telemetryHelper.addTrouterWaitOperation(o.default.TROUTER_WAIT_OPERATION.ENDED+":"+e),t.baseMessagingChannelUrl=t.currentTrouterUrl=n}).catch(function(n){throw t.disposed||t.telemetryHelper.addTrouterWaitOperation(o.default.TROUTER_WAIT_OPERATION.FAILED+":"+e),t.logger.error("ensureLatestTrouterUrl, failed because : "+n),n})},e.prototype.signalTransferAcceptedAsync=function(){return this.logger.log("Transfer: signalTransferAcceptedAsync"),this.disposed?(this.logger.log("Transfer: Call already ended, skip acceptance request"),Promise.reject({code:r.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):this.http.sendPostRequest({url:this.links[r.default.LINKS.TRANSFER_ACCEPTANCE],requestName:o.NETWORK_REQUESTS.TRANSFER_ACCEPTANCE,payload:w.getPayload()})},e.prototype.signalTransferCompletedAsync=function(e){return this.logger.log("Transfer: signalTransferCompletedAsync"),this.disposed?(this.logger.log("Transfer: Call already ended by transferor, skip completion request"),Promise.reject({code:r.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):this.http.sendPostRequest({url:this.links[r.default.LINKS.TRANSFER_COMPLETION],requestName:o.NETWORK_REQUESTS.TRANSFER_COMPLETION,payload:M.getPayload(e)})},e.prototype.endWithBeacon=function(){if(navigator&&navigator.sendBeacon&&!this.disposed){var e={code:r.default.CALL_END_CODE.SUCCESS,subCode:r.default.CALL_END_SUB_CODE.BEACON,phrase:r.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};this.telemetryHelper.recordEvent(o.EVENTS.END_WITH_BEACON);var t=JSON.stringify(h.getPayload(this,e).payload),n=-1===this.links[r.default.LINKS.LEAVE].indexOf("?")?"?":"&",i="skypeToken="+this.signalingAgentConfig.lastSkypeToken;return navigator.sendBeacon(""+this.links[r.default.LINKS.LEAVE]+n+i,t)}return!1},e.prototype.placeLightWeightMeetingCall=function(e){var t=this;this.logger.log("placeLightWeightMeetingCall"),this.telemetryHelper.setConversationServiceUrl(e.conversationServiceUrl);var n=j.build();if(!this.isCallInProgress())return l.assert(!1,"a call is already in progress"),this.telemetryHelper.addNetworkOperationCompleted(o.NETWORK_REQUESTS.PLACE_LIGHT_WEIGHT_MEETING_CALL,!1,n.duration()),void this.onLightWeightMeetingEnded({code:r.default.CALL_END_CODE.LOCAL_ERROR,subCode:r.default.CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_START_CALL_FAILED,phrase:r.default.CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_START_FAILED},!0);this.fsmState=r.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY;var i=e.newCall?u.getPayload(this,null,[],e):d.getPayload(this,null,[],e);this.timeoutManager.startTimer(r.default.TIMEOUT_OPERATIONS.LIGHT_WEIGHT_MEETING_JOIN,this.lightWeightMeetingSession.handleLightWeightMeetingJoinTimeout.bind(this.lightWeightMeetingSession)),this.http.sendPostRequest({url:e.conversationServiceUrl,requestName:o.NETWORK_REQUESTS.PLACE_LIGHT_WEIGHT_MEETING_CALL,payload:i}).then(function(e){t.disposed||(t.processConversationServiceResponse(e.response),t.fsmState=r.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,t.onCallStatusChanged(r.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY))}).catch(function(e){if(!t.disposed){t.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var n=l.getErrorForXHRFailure(e);t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,endCode:n.telemetryEndSubCode,endSubCode:n.error.subCode,resultDetail:"Failed to place light weight meeting call. Error = "+l.getPrintableObject(e)}),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,n.error),t.dispose(n.error)}})},e.prototype.processConversationServiceResponse=function(e){this.logger.log("processConversationServiceResponse"),this.convJoined=!0,this.links[r.default.LINKS.CONVERSATION_CONTROLLER]=e.conversationController,this.links[r.default.LINKS.ADD_PARTICIPANT]=e.links.addParticipant,this.links[r.default.LINKS.ADD_PARTICIPANT_AND_MODALITY]=e.links.addParticipantAndModality,this.links[r.default.LINKS.LEAVE]=e.links.leave,this.links[r.default.LINKS.NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[r.default.LINKS.REMOVE_PARTICIPANT]=e.links.removeParticipant,this.links[r.default.LINKS.ADD_MODALITY]=e.links.addModality,this.links[r.default.LINKS.REMOVE_MODALITY]=e.links.removeModality,this.links[r.default.LINKS.MUTE]=e.links.mute||null,this.links[r.default.LINKS.UNMUTE]=e.links.unmute||null,this.links[r.default.LINKS.ADMIT]=e.links.admit||null,this.links[r.default.LINKS.UPDATE_ENDPOINT_STATE]=e.links.updateEndpointState||null,this.links[r.default.LINKS.UPDATE_ENDPOINT_METADATA]=e.links.updateEndpointMetadata||null,this.convSubject=e.subject,e.activeModalities&&e.activeModalities.groupChat&&(this.threadId=e.activeModalities.groupChat.threadId,this.teamsMessageId=e.activeModalities.groupChat.messageId||null),e.state&&(this.multiParty=e.state.isMultiParty||!1,this.isHostLessCall=e.state.isHostless||!1,this.isCastCall=!!e.state.conversationType&&"cast"===e.state.conversationType),this.handleMeetingDetailsChanged(e),this.handleBrokerSubscription(e),this.linkUpdateRequested.conversationLinks&&(this.logger.log("processConversationServiceResponse, Updating CS links as requested"),this.updateLinks(this.updateConversationLinks))},e.prototype.handleMeetingDetailsChanged=function(e){this.logger.log("handleMeetingDetailsChanged"),e.meetingDetails&&!_.isEqual(e.meetingDetails,this.meetingDetails)&&this.signalingSessionCallback.onMeetingDetailsUpdated&&(this.meetingDetails=e.meetingDetails,this.signalingSessionCallback.onMeetingDetailsUpdated(this.meetingDetails))},e.prototype.handleBrokerSubscription=function(e){e.links.subscribe&&(this.brokerService?this.brokerService.subscribeToBroker(e.links.subscribe):this.telemetryHelper.recordEvent(o.EVENTS.BROKER_DISABLED_SUBSCRIBE_URL_PRESENT))},e.prototype.cancelOutgoingCall=function(e){var t=this,n=l.defer(),i=e||{code:r.default.CALL_END_CODE.CANCEL,subCode:r.default.CALL_END_SUB_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};return this.links.hasOwnProperty(r.default.LINKS.LEAVE)?(this.logger.log("cancelOutgoingCall, cancelling outgoing call"),this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,this.http.sendPostRequest({url:this.links[r.default.LINKS.LEAVE],requestName:o.NETWORK_REQUESTS.CANCEL_CALL,payload:g.getPayload(this,i)}).then(function(e){t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultDetail:"User cancelled call",endCode:i.code,endSubCode:i.subCode}),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,i),t.dispose(i)),n.resolve(e.response)}).catch(function(e){t.logger.error("cancelOutgoingCall failed because: "+l.getPrintableObject(e)),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:i.code,endSubCode:i.subCode,resultDetail:"Failed to Cancel Call. Error = "+l.getPrintableObject(e)}),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,i),t.dispose(i)),n.resolve(null)})):(this.logger.log("cancelOutgoingCall, Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways."),this.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultDetail:"Conversation Service Leave Url is not yet set",endCode:i.code,endSubCode:r.default.CALL_END_SUB_CODE.CONV_URL_NOT_SET}),i.subCode=r.default.CALL_END_SUB_CODE.CONV_URL_NOT_SET,this.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,i),this.dispose(i),n.resolve(null)),n.promise},e.prototype.terminateEstablishedCall=function(e){var t=this;this.logger.log("terminateEstablishedCall");var n=l.defer();this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var i=this.convJoined?o.NETWORK_REQUESTS.LEAVE_CONVERSATION:o.NETWORK_REQUESTS.END_CALL,a=j.build(),s=e||{code:r.default.CALL_END_CODE.SUCCESS,subCode:r.default.CALL_END_SUB_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};return this.endCallAndLeaveConversation(s).then(function(){t.logger.log("terminateEstablishedCall, success"),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:s.phrase}),t.telemetryHelper.addNetworkOperationCompleted(i,!0,a.duration()),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),n.resolve(null)}).catch(function(e){var c=l.getPrintableObject(e);t.logger.error("terminateEstablishedCall, failed:"+c),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:"Failed to end Call. Error = "+c}),t.telemetryHelper.addNetworkOperationCompleted(i,!1,a.duration()),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),n.resolve(null)}),n.promise},e.prototype.deleteConversation=function(e){var t=this;this.logger.log("deleteConversation");var n=l.defer();this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var i=o.NETWORK_REQUESTS.DELETE_CONVERSATION,a=j.build(),s=e||{code:r.default.CALL_END_CODE.SUCCESS,subCode:r.default.CALL_END_SUB_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED};return this.deleteConversationController(s).then(function(){t.logger.log("deleteConversation success"),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:s.phrase}),t.telemetryHelper.addNetworkOperationCompleted(i,!0,a.duration()),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),n.resolve(null)}).catch(function(e){var c=l.getPrintableObject(e);t.logger.error("deleteConversation, failed:"+c),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:"Failed to end call for all. Error = "+c}),t.telemetryHelper.addNetworkOperationCompleted(i,!1,a.duration()),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),n.resolve(null)}),n.promise},e.prototype.endCallAndLeaveConversation=function(e){var t=this,n=this.deleteCall(e),i=this.leaveConversation(e);return Promise.all([n,i]).then(function(e){t.logger.log("endedCall and left conversation")}).catch(function(e){t.logger.log("ignoring error encountered by endCallAndLeaveConversation. error = "+l.getPrintableObject(e))})},e.prototype.deleteCall=function(e){return this.links[r.default.LINKS.HANGUP]?(this.logger.log("deleteCall"),this.http.sendDeleteRequest({url:this.links[r.default.LINKS.HANGUP],requestName:o.NETWORK_REQUESTS.END_CALL,payload:m.getPayload(this,e),withoutTrouter:!0})):(this.logger.log("deleteCall ignored, ending call link on CallController not available"),Promise.resolve())},e.prototype.leaveConversation=function(e){return this.convJoined?(this.logger.log("leaveConversation"),this.http.sendPostRequest({url:this.links[r.default.LINKS.LEAVE],requestName:o.NETWORK_REQUESTS.LEAVE_CONVERSATION,payload:h.getPayload(this,e),withoutTrouter:!0})):(this.logger.log("leaveConversation, ignore, not joined to conversation"),Promise.resolve())},e.prototype.deleteConversationController=function(e){return this.convJoined?(this.logger.log("deleteConversationController"),this.http.sendDeleteRequest({url:this.links[r.default.LINKS.CONVERSATION_CONTROLLER],requestName:o.NETWORK_REQUESTS.DELETE_CONVERSATION,payload:f.getPayload(this,e),withoutTrouter:!0})):(this.logger.log("deleteConversationController, ignored, not joined to conversation"),Promise.resolve())},e.prototype.rejectIncomingCall=function(e){var t=this;this.telemetryHelper.recordEvent(o.EVENTS.REJECT_INCOMING_CALL);var n=l.defer();this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var i=e||{code:r.default.CALL_END_CODE.REJECT,subCode:r.default.CALL_END_SUB_CODE.SUCCESS,phrase:r.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};return this.http.sendDeleteRequest({url:this.links[r.default.LINKS.REJECT],requestName:o.NETWORK_REQUESTS.REJECT_CALL,payload:y.getPayload(this,i)}).then(function(e){t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:i.code,endSubCode:i.subCode,resultDetail:"User rejected call"}),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,i),t.dispose(i)),n.resolve(e.response)}).catch(function(e){t.logger.error("rejectIncomingCall failed because: "+l.getPrintableObject(e));var a=l.getPrintableObject(e);t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,endCode:i.code,endSubCode:i.subCode,resultDetail:"Failed to reject call. Error = "+a}),t.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,i),t.dispose(i)),n.resolve(null)}),n.promise},e.prototype.onCallStatusChanged=function(e,t){this.logger.log("onCallStatusChanged",this.currentCallStatus+" => "+e),this.disposed&&this.logger.warn("Call is already disposed!!"),t&&this.logger.log("onCallStatusChanged: statusCode = "+l.getPrintableObject(t)),this.orderOfCallState(e)>this.orderOfCallState(this.currentCallStatus)&&this.currentCallStatus!==e&&(this.currentCallStatus=e,this.telemetryHelper.recordEvent(o.EVENTS.UPDATE_CALL_STATUS,{callStatus:e,statusCode:t}),this.signalingSessionCallback.onCallStatusChanged(e,t),this.currentCallStatus===r.default.CALL_STATUS.CONNECTED&&this.pendingEndpointStateWhileConnecting&&(this.logger.log("onCallStatusChanged sending pending endpoint state now that we are connected."),this.updateEndpointState(this.pendingEndpointStateWhileConnecting)))},e.prototype.orderOfCallState=function(e){switch(e){case r.default.CALL_STATUS.IDLE:case r.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case r.default.CALL_STATUS.CONNECTING:return 1;case r.default.CALL_STATUS.RINGING:return 2;case r.default.CALL_STATUS.CONNECTED:return 3;case r.default.CALL_STATUS.LOCAL_TERMINATED:case r.default.CALL_STATUS.REMOTE_TERMINATED:return 4;default:return-1}},e.prototype.handlePSTNBalanceUpdate=function(e){var t=e.body.balanceUpdate;this.logger.log(o.EVENTS.HANDLE_PSTN_BALANCE_UPDATE),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,e),t.updateBalance?this.signalingSessionCallback.onPSTNBalanceUpdate(t):this.logger.log(o.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,"this was a pstn keepAlive message - ignore")},e.prototype.handleCallAcceptanceAck=function(e){var t=e.body;this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_CALL_ACCEPTANCE_ACK,e),this.internalHandleCallAcceptanceAck(t)},e.prototype.internalHandleCallAcceptanceAck=function(e){this.fsmState!==r.default.SIGNALING_FSM_STATE.CONNECTED&&(this.links[r.default.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptanceAcknowledgement.links.mediaRenegotiation,this.links[r.default.LINKS.TRANSFER]=e.callAcceptanceAcknowledgement.links.transfer,this.links[r.default.LINKS.REPLACE]=e.callAcceptanceAcknowledgement.links.replacement,this.links[r.default.LINKS.HANGUP]=e.callAcceptanceAcknowledgement.links.callLeg,this.links[r.default.LINKS.KEEPALIVE]=e.callAcceptanceAcknowledgement.links.callLeg,this.saveMediaControllerLinksIfAny(e.callAcceptanceAcknowledgement),this.scheduleKeepAlives(e.callAcceptanceAcknowledgement.callKeepAliveInterval),this.fsmState=r.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(r.default.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(),this.onCallStatusChanged(r.default.CALL_STATUS.CONNECTED),this.linkUpdateRequested.keepAliveLinks&&(this.logger.log("handleCallAcceptanceAck, updating CC links as requested"),this.updateLinks(this.updateKeepAliveUrl)))},e.prototype.placeCall=function(e,t,n){var i=this;if(this.logger.log("placeCall"),this.disposed)this.logger.log("placeCall, session already disposed, ignore");else{this.multiParty||(this.multiParty=1!==this.participantManager.getParticipantsToInitiateCallWith().length),this.telemetryHelper.setConversationServiceUrl(e.conversationServiceUrl),this.mediaTypesToUse=n,this.lastUsedOutgoingMediaContent=t,this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id);var a=e.newCall?u.getPayload(this,t,n,e):d.getPayload(this,t,n,e);this.http.sendPostRequest({url:e.conversationServiceUrl,requestName:o.NETWORK_REQUESTS.PLACE_CALL,payload:a}).then(function(t){i.disposed||(i.processConversationServiceResponse(t.response),i.onCallStatusChanged(r.default.CALL_STATUS.CONNECTING),i.handleRosterFromCreateAndJoin(t),e.endpointState&&(i.endpointStateOnServer=e.endpointState))}).catch(function(e){if(i.logger.error("placeCall failed because: "+l.getPrintableObject(e)),!i.disposed){i.fsmState=r.default.SIGNALING_FSM_STATE.IDLE;var t=l.getErrorForXHRFailure(e);i.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Failed to place call. Error = "+l.getPrintableObject(e)}),i.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,t.error),i.dispose(t.error)}})}},e.prototype.processIncomingCallPayload=function(e){this.remoteCallerOrCallee=s.default.fromWireParticipant(e.callNotification.from),this.participantManager.setLocalParticipantId(e.callNotification.to.participantId),this.links[r.default.LINKS.CONVERSATION_CONTROLLER]=e.conversationInvitation.conversationController,this.links[r.default.LINKS.ATTACH]=e.callNotification.links.attach,this.updateCorrelationId(e.debugContent.callId),this.multiParty=!!e.conversationInvitation.isMultiParty,this.isHostLessCall=!!e.conversationInvitation.isHostless,this.onBehalfOf=e.callNotification.onBehalfOf?e.callNotification.onBehalfOf.id:null,this.callType=e.callNotification.callType,this.incomingCallCallerId=e.callNotification.from.id,e.callNotification.transferor&&(this.transferor=e.callNotification.transferor.details?e.callNotification.transferor.details.id:null),e.groupChat&&e.groupChat.threadId&&(this.threadId=e.groupChat.threadId,this.teamsMessageId=e.groupChat.messageId||null)},e.prototype.processAttachResponse=function(e,t){this.telemetryHelper.recordEvent(o.EVENTS.PROCESS_INITIAL_OFFER),this.links[r.default.LINKS.MEDIA_ANSWER]=t.response.callInvitation.links.mediaAnswer,this.links[r.default.LINKS.ACCEPT]=t.response.callInvitation.links.acceptance,this.links[r.default.LINKS.REJECT]=t.response.callInvitation.links.callLeg,this.links[r.default.LINKS.REDIRECT]=t.response.callInvitation.links.redirection,this.links[r.default.LINKS.NEW_OFFER]=t.response.callInvitation.links.newOffer,this.signalingAgentConfig.sendProgressFromCC||this.sendProgress(t);var n=this.getInitialMediaOfferFromIncomingCallPayload()||t.response.callInvitation.mediaContent;this.telemetryHelper.setCallerType(this.getParticipantIdForOfferAnswer(n));var i=l.getMediaTypes(t.response.callInvitation.callModalities);this.telemetryHelper.addIncomingModalities(i),this.signalingSessionCallback.onOffer({subject:e.conversationInvitation.subject,remoteParticipantId:this.getParticipantIdForOfferAnswer(n),remoteEndpointId:t.response.participants.from.endpointId,transferor:t.response.callInvitation.transferor,mediaTypes:i,mediaContent:n,renegotiation:!1})},e.prototype.sendProgress=function(e){var t=this;this.telemetryHelper.recordEvent(o.EVENTS.SEND_PROGRESS),this.http.sendPostRequest({url:e.response.callInvitation.links.progress,requestName:o.NETWORK_REQUESTS.SEND_CALL_PROGRESS,payload:T.getPayload(this)}).catch(function(e){t.logger.error("sendProgress failed because: "+l.getPrintableObject(e)),t.disposed||t.telemetryHelper.recordEvent(o.EVENTS.SEND_PROGRESS_FAILED)})},e.prototype.handleCallNotification=function(e){if(this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_CALL_NOTIFICATION,e),!l.stringEndsWith(e.url,r.URL_PATH.REPLACE))throw new Error("IncomingCallNotification should not be received in handleIncomingMsg");this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_INCOMING_CALL_REPLACEMENT,e),this.logger.log("handleIncomingMsg : received replacementCallNotification"),this.signalingSessionCallback&&this.signalingSessionCallback.onIncomingCallReplacement(e.body)},e.prototype.handleMediaAnswer=function(e){this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_MEDIA_ANSWER,e);var t=e.body;if(this.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())this.mediaRenegotiationManager.handleMediaAnswer(t);else if(this.fsmState===r.default.SIGNALING_FSM_STATE.CONNECTED);else if(this.fsmState===r.default.SIGNALING_FSM_STATE.OUTGOING){if(l.isDuplicateMessage(e.headers,this.provisionalMediaAnswersSeenSoFar))return void this.logger.log("handleMediaAnswer, ignoring provisional answer retried by service");t.mediaAnswer.sender&&(this.remoteCallerOrCallee=t.mediaAnswer.sender),this.resetCallEstablishmentTimeout(),t.mediaAnswer.noRingBack||(this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(r.default.CALL_STATUS.RINGING)),this.signalingSessionCallback.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:t.mediaAnswer.sender?t.mediaAnswer.sender.endpointId:l.newGuid(),remoteParticipantId:this.getParticipantIdForOfferAnswer(t.mediaAnswer.mediaContent),mediaContent:t.mediaAnswer.mediaContent})}},e.prototype.handleCallAcceptance=function(e){var t=this;this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_CALL_ACCEPTANCE,e),this._processCallAcceptance(e),this.http.sendPostRequest({url:e.body.callAcceptance.links.acknowledgement,requestName:o.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT,payload:C.getPayload(this)}).catch(function(e){t.logger.error("handleCallAcceptance failed because: "+l.getPrintableObject(e)),t.disposed||t.telemetryHelper.recordEvent(o.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED)})},e.prototype.handleCallAcceptanceSync=function(e){return this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_CALL_ACCEPTANCE_SYNC,e),this._processCallAcceptance(e),C.getPayload(this).payload},e.prototype.getFakeRoster=function(e){var t,n,i,r=this.participantManager.getParticipantsToInitiateCallWith(),o={id:t=1===r.length?r[0].id:e.callAcceptance.acceptedBy.id,displayName:e.callAcceptance.acceptedBy.id===t?e.callAcceptance.acceptedBy.displayName:"",endpointId:e.callAcceptance.acceptedBy.endpointId,participantId:e.callAcceptance.acceptedBy.participantId,languageId:e.callAcceptance.acceptedBy.languageId},a=e.callAcceptance.acceptedBy.endpointId;return{participants:(n={},n[t]={acceptedBy:e.callAcceptance.acceptedBy.id,details:o,endpoints:(i={},i[a]={call:{},contentSharing:{},capabilities:e.callAcceptance.capabilities},i)},n)}},e.prototype.processCallAcceptance=function(e){this.telemetryHelper.recordEvent(o.EVENTS.PROCESS_CALL_ACCEPTANCE),this.fsmState=r.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(r.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected();var t=!1;e.callAcceptance.controllerName===r.default.MISC.LOBBY_CALL_CONTROLLER&&(this.logger.log("Controller name is lobby so putting user in lobby"),this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId}),t=!0,this.telemetryHelper.recordEvent(o.EVENTS.ACCEPTANCE_USER_IN_LOBBY));var n=this.mediaTypesToUse,i=l.newGuid();e.callAcceptance.acceptedBy&&(this.remoteCallerOrCallee=s.default.fromWireParticipant(e.callAcceptance.acceptedBy),i=e.callAcceptance.acceptedBy.endpointId),e.callAcceptance.acceptedCallModalities&&e.callAcceptance.acceptedCallModalities.length>0&&(n=e.callAcceptance.acceptedCallModalities);var a=l.getMediaTypes(n);this.telemetryHelper.addIncomingModalities(a),this.links[r.default.LINKS.MEDIA_RENEGOTIATION]=e.callAcceptance.links.mediaRenegotiation,this.links[r.default.LINKS.TRANSFER]=e.callAcceptance.links.transfer,this.links[r.default.LINKS.REPLACE]=e.callAcceptance.links.replacement,this.links[r.default.LINKS.HANGUP]=e.callAcceptance.links.callLeg,this.links[r.default.LINKS.KEEPALIVE]=e.callAcceptance.links.callLeg,this.saveMediaControllerLinksIfAny(e.callAcceptance),this.scheduleKeepAlives(e.callAcceptance.callKeepAliveInterval);var c=this.getParticipantIdForOfferAnswer(e.callAcceptance.mediaContent);this.signalingSessionCallback.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:i,remoteParticipantId:c,callAcceptedByNGCVoicemail:c===r.default.KNOWN_BOTS.VOICEMAIL_BOT_ID,mediaTypes:a,mediaContent:e.callAcceptance.mediaContent}),this.onCallStatusChanged(r.default.CALL_STATUS.CONNECTED),t&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant),this.linkUpdateRequested.keepAliveLinks&&(this.logger.log("Updating CC links as requested"),this.updateLinks(this.updateKeepAliveUrl))},e.prototype.handleCallEnd=function(e){var t=e.body.callEnd||e.body;if(this.logger.log("handleCallEnd:",l.getPrintableObject(t)),this.telemetryHelper.recordEvent(o.EVENTS.HANDLE_CALL_END,{origin:e.origin,code:t?t.code:"unknown",subCode:t?t.subCode:"unknown"}),this.fsmState!==r.default.SIGNALING_FSM_STATE.IDLE)if(t.code===r.default.CALL_END_CODE.CONFLICT&&this.multiParty&&t.conversationUrl&&t.conversationUrl.Location)this.handleConversationResolutionConflict(t);else{t.callControllerTransactionEnd&&(this.logger.log("handleCallEnd: using CC end details specified in CS end"),t=t.callControllerTransactionEnd);var n=t.code===r.default.CALL_END_CODE.SUCCESS||t.code===r.default.CALL_END_CODE.CANCEL||t.code===r.default.CALL_END_CODE.REJECT;this.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.REMOTE,resultDetail:t.phrase,resultValue:n?o.default.RESULT_VALUE.SUCCESS:o.default.RESULT_VALUE.FAILURE,endCode:t.code,endSubCode:t.subCode});var i={code:t.code,subCode:t.subCode,phrase:t.phrase};this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(r.default.CALL_STATUS.REMOTE_TERMINATED,i),this.dispose(i)}else this.logger.log("handleCallEnd, not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE")},e.prototype.handleConversationResolutionConflict=function(e){this.logger.log("handleConversationResolutionConflict"),this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,this.timeoutManager.stopTimer(r.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.joinGivenConversation(e.conversationUrl.Location,e.correlationId,this.lastUsedOutgoingMediaContent,this.mediaTypesToUse)},e.prototype.handleCallProgress=function(e){this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_CALL_PROGRESS,e);var t=e.body.callProgress;this.fsmState===r.default.SIGNALING_FSM_STATE.OUTGOING&&(this.telemetryHelper.setTimeToRingDuration(),this.resetCallEstablishmentTimeout(),this.onCallStatusChanged(r.default.CALL_STATUS.RINGING),"forwarded"===t.status&&this.signalingSessionCallback.onCallForwarded({destinationType:t.forwardingDestinationType||"user"}))},e.prototype.resetCallEstablishmentTimeout=function(){this.logger.log("resetCallEstablishmentTimeout"),this.timeoutManager.stopTimer(r.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.timeoutManager.startTimer(r.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,this.handleCallEstablishmentTimeout.bind(this))},e.prototype.handleMediaAcknowledgement=function(e){this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_MEDIA_ACK,e);var t=e.body;this.currentCallStatus!==r.default.CALL_STATUS.CONNECTED?this.telemetryHelper.recordEvent(o.EVENTS.HANDLE_MEDIA_PROVISIONAL_ACK):this.mediaRenegotiationManager.handleMediaAcknowledgment(t)},e.prototype.handleConversationUpdate=function(e){var t=e.body,n=this.threadId,i=this.teamsMessageId;this.logger.log(o.EVENTS.HANDLE_CONVERSATION_UPDATE,l.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_CONVERSATION_UPDATE,e),this.processConversationServiceResponse(t),this.threadId===n&&this.teamsMessageId===i||this.signalingSessionCallback.onConversationUpdated({threadId:this.threadId,teamsMessageId:this.teamsMessageId}),this.lightWeightMeetingSession.handleIncomingLightWeightMeeting(t),this.broadcastSession.handleBroadcastDetailsChanged(t)},e.prototype.handleAddModalityFailure=function(e){var t=e.body;this.logger.log(o.EVENTS.HANDLE_ADD_MODALITY_FAILURE,l.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_ADD_MODALITY_FAILURE,e),t.modalityFailure.contentSharing?this.contentSharingManager.handleAddModalityFailure(t):t.modalityFailure.groupChat&&this.signalingSessionCallback.onChatModalitySetupFailed({code:t.modalityFailure.groupChat.code,subCode:t.modalityFailure.groupChat.subCode,phrase:t.modalityFailure.groupChat.phrase})},e.prototype.handleAddModalitySuccess=function(e){var t=e.body;this.logger.log(o.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,l.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,e),t.modalitySuccess.contentSharing&&this.contentSharingManager.handleAddModalitySuccess(t)},e.prototype.handleTransferRequested=function(e){var t=e.body.callTransfer;this.logger.log("Transfer:",o.EVENTS.HANDLE_TRANSFER_REQUESTED,t),t.parkType?(this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_PARK_REQUESTED,e,{type:t.parkType}),this.telemetryHelper.addSharedCorrelationId(t.sharedCorrelationId)):this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_TRANSFER_REQUESTED,e),this.links[r.default.LINKS.TRANSFER_ACCEPTANCE]=t.links.transferAcceptance,this.links[r.default.LINKS.TRANSFER_COMPLETION]=t.links.transferCompletion,this.signalingSessionCallback.onTransferRequested?this.signalingSessionCallback.onTransferRequested(t):this.logger.warn("Transfer:",o.EVENTS.HANDLE_TRANSFER_REQUESTED,"failed, no callback defined")},e.prototype.handleTransferAcceptance=function(e){var t=e.body;this.logger.log("Transfer:",o.EVENTS.HANDLE_TRANSFER_ACCEPTANCE,t),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_TRANSFER_ACCEPTANCE,e),this.signalingSessionCallback.onTransferAccepted?this.signalingSessionCallback.onTransferAccepted():this.logger.warn("Transfer:",o.EVENTS.HANDLE_TRANSFER_ACCEPTANCE,"failed, no callback defined")},e.prototype.handleTransferCompletion=function(e){var t=e.body,n=t.transferCompletion;this.logger.log("Transfer:",o.EVENTS.HANDLE_TRANSFER_COMPLETION,n),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_TRANSFER_COMPLETION,e),t.sharedCorrelationId&&this.telemetryHelper.addSharedCorrelationId(t.sharedCorrelationId),this.signalingSessionCallback.onTransferCompleted?this.signalingSessionCallback.onTransferCompleted(t):this.logger.warn("Transfer:",o.EVENTS.HANDLE_TRANSFER_COMPLETION,"failed, no callback defined")},e.prototype.handleRosterUpdate=function(e){var t=e.body;this.logger.debug(o.EVENTS.HANDLE_ROSTER_UPDATE,l.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_ROSTER_UPDATE,e),this.internalHandleRosterUpdate(t)},e.prototype.handleNewMediaOffer=function(e){this.telemetryHelper.recordIncomingEvent(o.EVENTS.HANDLE_NEW_OFFER,e),this.signalingSessionCallback.onNewOffer({mediaContent:e.body.mediaOfferReady.mediaContent,renegotiation:!1})},e.prototype.internalHandleRosterUpdate=function(e){this.logger.debug(o.EVENTS.HANDLE_ROSTER_UPDATE,l.getPrintableObject(e));var t=e.sequenceNumber;t>this.lastRosterUpdateSeqNumber?(this.lastRosterUpdateSeqNumber=t,this.participantManager.handleRosterUpdate(e),this.contentSharingManager.handleIncomingContentSharingFromRoster(e)):(this.telemetryHelper.recordEvent(o.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,sequenceNumber:t}),this.logger.log("Ignoring old roster update: received "+t+", but already handled "+this.lastRosterUpdateSeqNumber))},e.prototype.scheduleKeepAlives=function(e){var t=.9*e*1e3;this.logger.log("scheduleKeepAlives: every "+t+" milliseconds"),this.keepAliveInterval=t,this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)},e.prototype.sendKeepAlive=function(){this.logger.log("sendKeepAlive"),this.disposed?this.logger.log("sendKeepAlive ignored"):(this.logger.log("sendKeepAlive keepAlive count = "+this.keepAliveCount++),this.sendToKeepAliveUrl(null))},e.prototype.sendToKeepAliveUrl=function(e){var t=this;window.clearInterval(this.keepAliveTimer),this.disposed||(this.telemetryHelper.recordEvent(o.EVENTS.SEND_KEEP_ALIVE),this.http.sendPostRequest({url:this.links[r.default.LINKS.KEEPALIVE],payload:e,requestName:o.NETWORK_REQUESTS.SEND_KEEP_ALIVE,retryIntervals:[100,300,600,1e3],withoutTrouter:!0}).then(function(){return t.restartKeepAliveInterval()}).catch(function(){return t.restartKeepAliveInterval(!0)}))},e.prototype.handleCallEstablishmentTimeout=function(){this.telemetryHelper.recordEvent(o.EVENTS.HANDLE_CALL_ESTABLISHMENT_TIMEOUT),this.telemetryHelper.setTerminatingData({terminatingEnd:o.default.CALL_TERMINATING_END.LOCAL,resultValue:o.default.RESULT_VALUE.FAILURE,resultDetail:r.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,endCode:r.default.CALL_END_CODE.TIMEOUT,endSubCode:r.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT});var e={code:r.default.CALL_END_CODE.TIMEOUT,subCode:r.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:r.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT};this.fsmState=r.default.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(r.default.CALL_STATUS.LOCAL_TERMINATED,e),this.dispose(e)},e.prototype.handleCallTransferTimeout=function(){if(this.telemetryHelper.recordEvent(o.EVENTS.HANDLE_CALL_TRANSFER_TIMEOUT),this.disposed)this.logger.log("Transfer: handleCallTransferTimeout ignored");else{var e={code:r.default.CALL_END_CODE.TIMEOUT,phrase:r.default.CALL_END_PHRASE.TRANSFER_COMPLETION_TIMEOUT};this.signalingSessionCallback.onTransferCompleted&&this.signalingSessionCallback.onTransferCompleted({transferCompletion:e})}},e.prototype.checkCorrelationIdChange=function(e){if(e&&e.headers&&e.headers[r.default.HEADERS.CORRELATION_ID]&&e.headers[r.default.HEADERS.CORRELATION_ID].length){var t=[r.URL_PATH.CONV_CONTENT_SHARING_UPDATE,r.URL_PATH.CONV_CONTENT_SHARING_END].some(function(t){return e.url&&l.stringEndsWith(e.url,t)}),n=e.headers[r.default.HEADERS.CORRELATION_ID];this.correlationId===n||t||(this.logger.log("updateCorrelationId:",this.correlationId,"=>",n),this.telemetryHelper.addChangingCorrelationId(this.correlationId,n),this.updateCorrelationId(n))}},e.prototype.dispose=function(e){this.disposed||(this.logger.log("dispose"),this.disposed=!0,this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.brokerService&&this.brokerService.dispose(),this.http.cancelAllRequests(),this.signalingAgent.onCallCompleted(this.sessionId),this.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed.off(this.onTrouterUrlChanged),this.signalingAgentConfig.trouterServiceProvider&&this.signalingAgentConfig.trouterServiceProvider.offStateChanged(this.onTrouterStateChanged),this.timeoutManager.dispose(),this.timeoutManager=null,this.participantManager.dispose(e),this.participantManager=null,this.mediaRenegotiationManager.dispose(),this.mediaRenegotiationManager=null,this.contentSharingManager.dispose(e),this.contentSharingManager=null,this.lightWeightMeetingSession.dispose(e),this.lightWeightMeetingSession=null,this.telemetryHelper.dispose(),this.telemetryHelper=null,this.webRtcSignalingManager.dispose(),this.webRtcSignalingManager=null)},e}();t.SignalingSession=V,t.build=function(e,t,n,i,r){return new V(e,t,n,i,r)}},function(e,t,n){"use strict";var i=function(){function e(e,t){this.appTelemetryManager=e,this.skypeConcoreToken=t}return e.prototype.sendEvent=function(e,t){this.appTelemetryManager.sendEvent(this.skypeConcoreToken,e,t)},e}();t.__esModule=!0,t.default=i},function(e,t,n){var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r=n(1),o=n(0),a=n(19),s=n(239),c=n(7),l=function(){function e(e){var t=this;this.callStartTime=(new Date).getTime(),this.networkRequestsCompleted=[],this.networkRequestsStarted={},this.networkRequests={},this.localOperationsPerformed=[],this.recordedEvents=[],this.contentSharingOperationsPerformed={},this.outgoingModalities=[],this.incomingModalities=[],this.vbssOperations=[],this.vbssStarted=!1,this.localOfferAnswerGenerationTimestamps=[],this.trouterWaitOperations=[],this.telemetryData={},this.contentSharingBaseTelemetryData={},this.httpRequestTelemetryData={},this.connectedStopWatch=null,this.timeToRingStopWatch=null,this.addBrokerChannel=function(){t.setMessagingChannel(c.default.MESSAGING_CHANNEL.BROKER)},this.addTrouterChannel=function(){t.setMessagingChannel(c.default.MESSAGING_CHANNEL.TROUTER)},this.addTrouterWaitOperation=function(e){t.trouterWaitOperations.push(t.recordOperation(e))},this.recordIncomingEvent=function(e,n,i){var o="";n.headers&&"string"==typeof n.headers[r.default.HEADERS.MESSAGE_ID]&&(o=n.headers[r.default.HEADERS.MESSAGE_ID].split("-")[0]);var a={origin:n.origin,messageId:o,data:i};i||delete a.data,t.recordEvent(e,a)},this.recordEvent=function(e,n){t.logger.debug("Event:",e,n),t.localOperationsPerformed.push(t.recordOperation(e));var i={};i[e]=t.timeSinceCallStart(),n&&(i.data=n),t.recordedEvents.push(i)},this.addOutgoingModalities=function(e){e&&t.outgoingModalities.push(e)},this.addIncomingModalities=function(e){e&&t.incomingModalities.push(e)},this.addVbssOperations=function(e){e&&(e===c.default.VBSS_OPERATION.START?t.vbssStarted=!0:t.vbssStarted=!1,t.vbssOperations.push(t.recordOperation(e)))},this.addNetworkOperationStarted=function(e){o.tryAddNewKeyToHashTable(t.networkRequestsStarted,e,t.recordOperation(e))},this.addNetworkOperationCompleted=function(e,n,i){var r=n?c.default.RESULT_VALUE.SUCCESS:c.default.RESULT_VALUE.FAILURE;t.networkRequestsCompleted.push(t.recordOperation(e+":"+r+":"+i)),o.tryRemoveKeyFromHashTable(t.networkRequestsStarted,e)},this.updateNetworkRequest=function(e){t.networkRequests[e.uid]?Object.assign(t.networkRequests[e.uid],e):t.networkRequests[e.uid]=e},this.addContentSharingOperation=function(e,n,i){t.contentSharingOperationsPerformed[e]||(t.contentSharingOperationsPerformed[e]=[]);var r=((o={})[n]=t.timeSinceCallStart(),o);t.contentSharingOperationsPerformed[e].push(r);var o,a=t.contentSharingOperationsPerformed[e].length-1;return i&&t.updateContentSharingOperation(e,a,i),a},this.updateContentSharingOperation=function(e,n,i){if(t.contentSharingOperationsPerformed[e]){var r=t.contentSharingOperationsPerformed[e][n],o=[];for(var a in i)o.push(a+": "+i[a]);r.data=o.join(", ")}},this.setDirection=function(e){t.telemetryData[c.default.EXTENSIONS.DIRECTION]=e},this.setEndPointId=function(e){t.telemetryData[c.default.CONTEXT_ID.ENDPOINT_ID]=e,t.contentSharingBaseTelemetryData[c.default.CONTEXT_ID.ENDPOINT_ID]=e,t.httpRequestTelemetryData[c.default.CONTEXT_ID.ENDPOINT_ID]=e},this.setParticipantId=function(e){t.telemetryData[c.default.CONTEXT_ID.PARTICIPANT_ID]=e,t.contentSharingBaseTelemetryData[c.default.CONTEXT_ID.PARTICIPANT_ID]=e,t.httpRequestTelemetryData[c.default.CONTEXT_ID.PARTICIPANT_ID]=e},this.setConversationServiceUrl=function(e){t.telemetryData[c.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=e},this.setMeetingInfo=function(e){e||(t.telemetryData[c.default.EXTENSIONS.MEETING_INFO]=e)},this.setRole=function(e){t.telemetryData[c.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]=e},this.setCallerType=function(e){e&&(t.telemetryData[c.default.EXTENSIONS.CALLER_TYPE]=e.split(":",1)[0])},this.setCalleeType=function(e){e&&(t.telemetryData[c.default.EXTENSIONS.CALLEE_TYPE]=e.split(":",1)[0])},this.setTerminatingData=function(e){t.telemetryData[c.default.EXTENSIONS.CALL_TERMINATING_END]=e.terminatingEnd,t.telemetryData[c.default.EXTENSIONS.CALL_END_CODE]=e.endCode||r.default.CALL_END_CODE.SUCCESS,t.telemetryData[c.default.EXTENSIONS.CALL_END_SUB_CODE]=e.endSubCode||r.default.CALL_END_SUB_CODE.SUCCESS,t.telemetryData[c.default.EXTENSIONS.RESULT_VALUE]=e.resultValue||c.default.RESULT_VALUE.SUCCESS,t.telemetryData[c.default.EXTENSIONS.RESULT_DETAIL]=e.resultDetail||"Call gracefully hungup"},this.startCallInitializationWatch=function(e){t.timeToRingStopWatch=a.build(),e&&(t.timeToRingStopWatch.msElapsed+=e)},this.startCallConnectedWatch=function(){t.connectedStopWatch=a.build()},this.setOfferAnswerGenerationTimestamps=function(e){t.localOfferAnswerGenerationTimestamps.push(t.recordOperation(e))},this.setTimeToRingDuration=function(){t.timeToRingStopWatch&&(t.telemetryData[c.default.EXTENSIONS.TIME_TO_RING_IN_MS]=t.timeToRingStopWatch.duration(),t.timeToRingStopWatch=null)},this.dispose=function(){t.sendCallModalityTelemetryData(),t.sendHttpTelemetryData()},this.setMessagingChannel=function(e){t.telemetryData[c.default.EXTENSIONS.MESSAGING_CHANNEL]||(t.telemetryData[c.default.EXTENSIONS.MESSAGING_CHANNEL]=[]),t.telemetryData[c.default.EXTENSIONS.MESSAGING_CHANNEL].some(function(t){return-1!==t.indexOf(e)})||t.telemetryData[c.default.EXTENSIONS.MESSAGING_CHANNEL].push(t.recordOperation(e))},this.sendHttpTelemetryData=function(){var e=i({},t.httpRequestTelemetryData);e[c.default.CONTEXT_ID.CORRELATION_ID]=t.signalingSession.correlationId,e[c.default.CONTEXT_ID.SIGNALING_SESSION_ID]=t.signalingSession.sessionId,e[c.default.EXTENSIONS.CLIENT_INFORMATION]=t.signalingSession.signalingAgentConfig.clientInformation;var n=Object.keys(t.networkRequests).map(function(e){return delete t.networkRequests[e].uid,t.networkRequests[e]}),r=JSON.stringify({eventStart:t.callStartTime,events:n});e[c.default.EXTENSIONS.NETWORK_REQUESTS_BAG]=r,t.telemetryLogger.logHttpTelemetryEvent(e)},this.signalingSession=e,this.logger=e.logger,this.telemetryLogger=s.getLogger(e,this.logger),this.telemetryData[c.default.EXTENSIONS.CALL_START_TIME]=this.callStartTime,this.telemetryData[c.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=e.signalingAgentConfig.conversationServiceUrl}return e.prototype.addChangingCorrelationId=function(e,t){this.telemetryData[c.default.EXTENSIONS.CHANGING_CORRELATION_ID_OLD_ID]=e,this.telemetryData[c.default.EXTENSIONS.CHANGING_CORRELATION_ID_NEW_ID]=t},e.prototype.addSharedCorrelationId=function(e){this.telemetryData[c.default.CONTEXT_ID.SHARED_CORRELATION_ID]=e},e.prototype.sendContentSharingTelemetryData=function(e,t,n,r,o,a){var s=i({},this.contentSharingBaseTelemetryData),l=this.contentSharingOperationsPerformed[e];l&&(s[c.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=JSON.stringify(l)),s[c.default.CONTEXT_ID.CONTENT_SHARING_CORRELATION_ID]=e,s[c.default.CONTEXT_ID.SIGNALING_SESSION_ID]=t,s[c.default.CONTEXT_ID.CONTENT_SHARING_ID]=a||"",s[c.default.EXTENSIONS.CONTENT_SHARING_SERVICE_URL]=o,s[c.default.EXTENSIONS.CONTENT_SHARING_DIRECTION]=n?c.default.DIRECTION.OUTGOING:c.default.DIRECTION.INCOMING,s[c.default.EXTENSIONS.CALL_END_CODE]=r.code,s[c.default.EXTENSIONS.CALL_END_SUB_CODE]=r.subCode,s[c.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,delete this.contentSharingOperationsPerformed[e],this.telemetryLogger.logConversationContentSharingEvent(s)},e.prototype.recordOperation=function(e){return e+":"+this.timeSinceCallStart()},e.prototype.timeSinceCallStart=function(){return(new Date).getTime()-this.callStartTime},e.prototype.sendCallModalityTelemetryData=function(){if(this.vbssStarted&&this.addVbssOperations(c.default.VBSS_OPERATION.CALL_END),this.telemetryData[c.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,this.telemetryData[c.default.EXTENSIONS.CALL_END_TIME]=(new Date).getTime(),this.connectedStopWatch&&(this.telemetryData[c.default.EXTENSIONS.CONNECTED_DURATION_IN_MS]=this.connectedStopWatch.duration()),this.networkRequestsCompleted.length>0&&(this.telemetryData[c.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(this.networkRequestsCompleted)),this.localOperationsPerformed.length>0&&(this.telemetryData[c.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(this.localOperationsPerformed)),this.trouterWaitOperations.length>0&&(this.telemetryData[c.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS]=JSON.stringify(this.trouterWaitOperations)),this.localOfferAnswerGenerationTimestamps.length>0&&(this.telemetryData[c.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=JSON.stringify(this.localOfferAnswerGenerationTimestamps)),this.incomingModalities.length>0&&(this.telemetryData[c.default.EXTENSIONS.INCOMING_MODALITIES]=JSON.stringify(this.incomingModalities)),this.outgoingModalities.length>0&&(this.telemetryData[c.default.EXTENSIONS.OUTGOING_MODALITIES]=JSON.stringify(this.outgoingModalities)),this.vbssOperations.length>0&&(this.telemetryData[c.default.EXTENSIONS.VBSS_OPERATIONS]=JSON.stringify(this.vbssOperations)),this.recordedEvents.length>0){var e=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents});this.telemetryData[c.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=e}var t=[];for(var n in this.networkRequestsStarted)this.networkRequestsStarted.hasOwnProperty(n)&&t.push(this.networkRequestsStarted[n]);t.length>0&&(this.telemetryData[c.default.EXTENSIONS.NETWORK_REQUESTS_PENDING]=JSON.stringify(t)),this.telemetryLogger.logConversationCallModalityEvent(this.telemetryData)},e}();t.__esModule=!0,t.default=l},function(e,t,n){"use strict";var i=n(7),r=function(){function e(e,t){var n=this;this.signalingSession=e,this.logger=t,this.logConversationCallModalityEvent=function(e){var t=n.createCallModalityEvent(e);n.logger.log("sending modality telemetry:",n.getStringifiedEventData(t)),t.hostName=location.host,n.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(i.default.EVENT_TYPE.CONVERSATION_CALL_MODALITY,t)},this.logConversationContentSharingEvent=function(e){e[i.default.CONTEXT_ID.CORRELATION_ID]=n.signalingSession.correlationId,n.logger.log("sending content sharing telemetry:",n.getStringifiedEventData(e)),e.hostName=location.host,n.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(i.default.EVENT_TYPE.CONVERSATION_CONTENT_SHARING,e)},this.logHttpTelemetryEvent=function(e){n.logger.log("sending http telemetry:",n.getStringifiedEventData(e)),e.hostName=location.host,n.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(i.default.EVENT_TYPE.CONVERSATION_HTTP_REQUEST,e)},this.getSignalingAgentConfig=function(){var e=[],t=n.signalingSession.signalingAgentConfig;return t.supportsCompressedServicePayload&&e.push(i.default.SIGNALING_CONFIG_FLAGS.SUPPORTS_COMPRESSED_PAYLOAD),t.brokerEnabledOutgoing&&e.push(i.default.SIGNALING_CONFIG_FLAGS.BROKER_OUTGOING_ENABLED),t.brokerEnabledIncoming&&e.push(i.default.SIGNALING_CONFIG_FLAGS.BROKER_INCOMING_ENABLED),t.brokerRequestBatching&&e.push(i.default.SIGNALING_CONFIG_FLAGS.BROKER_REQUEST_BATCHING_ENABLED),t.brokerExclusively&&e.push(i.default.SIGNALING_CONFIG_FLAGS.BROKER_EXCLUSIVELY_ENABLED),t.supportsSynchronousTrouterResponse&&e.push(i.default.SIGNALING_CONFIG_FLAGS.SYNC_TROUTER_RESPONSE),t.serverMuteUnmute&&e.push(i.default.SIGNALING_CONFIG_FLAGS.SERVER_MUTE_UNMUTE),t.handleMediaOfferFromPushNotification&&e.push(i.default.SIGNALING_CONFIG_FLAGS.HANDLE_OFFER_FROM_NOTIFICATION),t.handleNewOfferRequest&&e.push(i.default.SIGNALING_CONFIG_FLAGS.HANDLE_NEW_OFFER_REQUEST),t.sendProgressFromCC&&e.push(i.default.SIGNALING_CONFIG_FLAGS.SEND_PROGRESS_FROM_CC),e.join(",")},this.getStringifiedEventData=function(e){try{return JSON.stringify(e)}catch(e){return"invalid data"}}}return e.prototype.createCallModalityEvent=function(e){var t={};return t.Type=i.default.SOURCE.NGC_SOURCE,t.ResultDetail=e[i.default.EXTENSIONS.RESULT_DETAIL],t.ResultValue=e[i.default.EXTENSIONS.RESULT_VALUE],t.ResultCode=e[i.default.EXTENSIONS.CALL_END_CODE],t[i.default.SIGNALING_CONFIG]=this.getSignalingAgentConfig(),t[i.default.CONTEXT_ID.CORRELATION_ID]=this.signalingSession.correlationId,e[i.default.CONTEXT_ID.SHARED_CORRELATION_ID]&&(t[i.default.CONTEXT_ID.SHARED_CORRELATION_ID]=e[i.default.CONTEXT_ID.SHARED_CORRELATION_ID]),t[i.default.CONTEXT_ID.SIGNALING_SESSION_ID]=this.signalingSession.sessionId,t[i.default.CONTEXT_ID.ENDPOINT_ID]=e[i.default.CONTEXT_ID.ENDPOINT_ID],t[i.default.CONTEXT_ID.PARTICIPANT_ID]=e[i.default.CONTEXT_ID.PARTICIPANT_ID],t[i.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=e[i.default.EXTENSIONS.CONVERSATION_SERVICE_URL],t[i.default.EXTENSIONS.CALL_START_TIME]=JSON.stringify(e[i.default.EXTENSIONS.CALL_START_TIME]),t[i.default.EXTENSIONS.CALL_END_TIME]=JSON.stringify(e[i.default.EXTENSIONS.CALL_END_TIME]),t[i.default.EXTENSIONS.MESSAGING_CHANNEL]=JSON.stringify(e[i.default.EXTENSIONS.MESSAGING_CHANNEL]),t[i.default.EXTENSIONS.IS_GROUP_CALL]=this.signalingSession.multiParty?"true":"false",t[i.default.EXTENSIONS.IS_HOSTLESS_CALL]=this.signalingSession.isHostLessCall?"true":"false",t[i.default.EXTENSIONS.IS_CAST_CALL]=this.signalingSession.isCastCall?"true":"false",t[i.default.EXTENSIONS.IS_ON_BEHALF_OF_CALL]=this.signalingSession.onBehalfOf?"true":"false",t[i.default.EXTENSIONS.CLIENT_INFORMATION]=e[i.default.EXTENSIONS.CLIENT_INFORMATION],t[i.default.EXTENSIONS.CALL_TERMINATING_END]=e[i.default.EXTENSIONS.CALL_TERMINATING_END],t[i.default.EXTENSIONS.CALL_END_CODE]=JSON.stringify(e[i.default.EXTENSIONS.CALL_END_CODE]),t[i.default.EXTENSIONS.CALL_END_SUB_CODE]=JSON.stringify(e[i.default.EXTENSIONS.CALL_END_SUB_CODE]),e.hasOwnProperty(i.default.EXTENSIONS.DIRECTION)&&(t[i.default.EXTENSIONS.DIRECTION]=e[i.default.EXTENSIONS.DIRECTION],t[i.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]=e[i.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]),e.hasOwnProperty(i.default.EXTENSIONS.CONNECTED_DURATION_IN_MS)&&(t[i.default.EXTENSIONS.CONNECTED_DURATION_IN_MS]=JSON.stringify(e[i.default.EXTENSIONS.CONNECTED_DURATION_IN_MS])),e.hasOwnProperty(i.default.EXTENSIONS.TIME_TO_RING_IN_MS)&&(t[i.default.EXTENSIONS.TIME_TO_RING_IN_MS]=JSON.stringify(e[i.default.EXTENSIONS.TIME_TO_RING_IN_MS])),e.hasOwnProperty(i.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED)&&(t[i.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=e[i.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]),e.hasOwnProperty(i.default.EXTENSIONS.NETWORK_REQUESTS_PENDING)&&(t[i.default.EXTENSIONS.NETWORK_REQUESTS_PENDING]=e[i.default.EXTENSIONS.NETWORK_REQUESTS_PENDING]),e.hasOwnProperty(i.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED)&&(t[i.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=e[i.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]),e.hasOwnProperty(i.default.EXTENSIONS.EVENT_TIMESTAMP_BAG)&&(t[i.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=e[i.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]),e.hasOwnProperty(i.default.EXTENSIONS.NETWORK_REQUESTS_BAG)&&(t[i.default.EXTENSIONS.NETWORK_REQUESTS_BAG]=e[i.default.EXTENSIONS.NETWORK_REQUESTS_BAG]),e.hasOwnProperty(i.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS)&&(t[i.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS]=e[i.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS]),e.hasOwnProperty(i.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS)&&(t[i.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=e[i.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]),e.hasOwnProperty(i.default.EXTENSIONS.OUTGOING_MODALITIES)&&(t[i.default.EXTENSIONS.OUTGOING_MODALITIES]=e[i.default.EXTENSIONS.OUTGOING_MODALITIES]),e.hasOwnProperty(i.default.EXTENSIONS.INCOMING_MODALITIES)&&(t[i.default.EXTENSIONS.INCOMING_MODALITIES]=e[i.default.EXTENSIONS.INCOMING_MODALITIES]),e.hasOwnProperty(i.default.EXTENSIONS.VBSS_OPERATIONS)&&(t[i.default.EXTENSIONS.VBSS_OPERATIONS]=e[i.default.EXTENSIONS.VBSS_OPERATIONS]),e.hasOwnProperty(i.default.EXTENSIONS.CALLER_TYPE)&&(t[i.default.EXTENSIONS.CALLER_TYPE]=e[i.default.EXTENSIONS.CALLER_TYPE]),e.hasOwnProperty(i.default.EXTENSIONS.CALLEE_TYPE)&&(t[i.default.EXTENSIONS.CALLEE_TYPE]=e[i.default.EXTENSIONS.CALLEE_TYPE]),this.signalingSession.callType&&(t[i.default.EXTENSIONS.CALL_TYPE]=this.signalingSession.callType),this.signalingSession.signalingAgentConfig.testCall&&(t[i.default.EXTENSIONS.TEST_CONTEXT_ID]="Test"),this.signalingSession.threadId&&(t[i.default.CONTEXT_ID.THREAD_ID]=this.signalingSession.threadId),this.signalingSession.teamsMessageId&&(t[i.default.CONTEXT_ID.TEAMS_MESSAGEID]=this.signalingSession.teamsMessageId),this.signalingSession.getMeetingInfo()&&(t[i.default.CONTEXT_ID.TEAMS_MEETINGINFO]=JSON.stringify(this.signalingSession.getMeetingInfo())),this.signalingSession.multiParty&&0===this.signalingSession.numberOfOriginalInvitees&&e.hasOwnProperty(i.default.EXTENSIONS.SELF_PARTICIPANT_ROLE)&&e[i.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]===i.default.ROLE.CALLER&&(t[i.default.EXTENSIONS.IS_MEETUP_CALL]="true"),t},e}();t.TelemetryLogger=r,t.getLogger=function(e,t){return new r(e,t)}},function(e,t,n){"use strict";var i=n(1),r=n(0),o=function(){return function(e){var t=this;this.timers={},this.startTimer=function(e,n,o){t.logger.log("startTimer called for : "+e);var a=0;switch(e){case i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT:r.assertNotNullOrEmpty(o,"remoteParticipantId must be specified for : "+e),a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.ADD_PARTICIPANT_TIMEOUT,e=e+"_"+o;break;case i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT:r.assertNotNullOrEmpty(o,"remoteParticipantId must be specified for : "+e),a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,e=e+"_"+o;break;case i.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT:r.assertNotNullOrEmpty(o,"remoteParticipantId must be specified for : "+e),a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_PARTICIPANT_TIMEOUT,e=e+"_"+o;break;case i.default.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.INCOMING_CALL_ESTABLISHMENT_TIMEOUT;break;case i.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT;break;case i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_TIMEOUT;break;case i.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT;break;case i.default.TIMEOUT_OPERATIONS.ADD_MODALITY:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.ADD_MODALITY_TIMEOUT;break;case i.default.TIMEOUT_OPERATIONS.UNMUTE:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.UNMUTE_TIMEOUT;break;case i.default.TIMEOUT_OPERATIONS.LIGHT_WEIGHT_MEETING_JOIN:a=1e3*i.default.TIMEOUT_VALUES_IN_SECONDS.LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT;break;default:return}var s=setTimeout(n,a);t.timers[e]=s},this.stopTimer=function(e,n){switch(e){case i.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT:case i.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT:r.assertNotNullOrEmpty(n,"remoteParticipantId must be specified for : "+e),e=e+"_"+n}t.logger.log("stopTimer called for : "+e),t.timers.hasOwnProperty(e)&&(clearTimeout(t.timers[e]),delete t.timers[e])},this.dispose=function(){for(var e in t.logger.log("timeoutManager :: dispose"),t.timers)t.timers.hasOwnProperty(e)&&t.stopTimer(e)},this.logger=e.logger}}();t.__esModule=!0,t.default=o},function(e,t,n){"use strict";var i=function(){return function(e,t){var n=this;this.getRequestOptions=function(e,t,i,r){return{headers:t||{},timeout:r,retry:{delay:1e3,enabled:!0,limit:3,strategy:"fixed",isTransientCheck:n.transientFaultPolicy.isTransientFailure,isSuccessCheck:n.transientFaultPolicy.isWebApiSuccess},reporting:{serviceName:"ngcCallController-"+(e||"")},payload:i||null}},this.getAsync=function(e,t){return n.salRequestDispatcher.get(e,t)},this.postAsync=function(e,t){return n.salRequestDispatcher.post(e,t)},this.putAsync=function(e,t){return n.salRequestDispatcher.put(e,t)},this.removeAsync=function(e,t){return n.salRequestDispatcher.remove(e,t)},this.salRequestDispatcher=e,this.transientFaultPolicy=t}}();t.__esModule=!0,t.default=i},function(e,t,n){var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r=n(1),o=n(0);t.get=function(e,t,n,a,s,c){return void 0===a&&(a={}),e.disposed?Promise.reject("Session already disposed"):e.signalingAgentConfig.skypeToken().then(function(l){if(e.disposed)throw"skypeToken Getter returned too late. Object is already disposed";var u={};u[r.default.HEADERS.CORRELATION_ID]=e.correlationId,u[r.default.HEADERS.MESSAGE_ID]=o.newGuid(),u[r.default.HEADERS.CLIENT_USER_AGENT]=e.signalingAgentConfig.clientInformation,u[r.default.HEADERS.SKYPE_TOKEN]=l,c&&(u[r.default.HEADERS.CONTENT_SHARING_CORRELATION_ID]=c);var d=n&&n.payload?JSON.stringify(n.payload):null,p=e.signalingAgentConfig.httpRequestDispatcher.getRequestOptions(t,i({},u,a),d,s);return e.telemetryHelper.addNetworkOperationStarted(t),p},function(e){throw"string"==typeof e&&(e=new Error(e)),e.skypeTokenError=!0,e})}},function(e,t,n){"use strict";var i=n(72);t.build=function(e,t,n,i,o,a){return new r(e,t,n,i,o,a)};var r=function(){function e(e,t,n,i,r,o){this.dispatcher=e,this.requestType=t,this.url=n,this.request=i,this.delaySeconds=r,this.requestFailureCallback=o,this.attempts=0}return e.prototype.sendRequestWithRetry=function(){var e=this;return this.isCancelled=!1,new Promise(function(t,n){e.resolve=t,e.reject=n,e.queueAttempt()})},e.prototype.cancelFurtherRetries=function(){this.isCancelled=!0,this.attemptTimer&&(this.attemptTimer.stop(),this.attemptTimer=null)},e.prototype.getRequestMethod=function(e){switch(e){case 0:return this.dispatcher.getAsync.bind(this.dispatcher);case 1:return this.dispatcher.postAsync.bind(this.dispatcher);case 2:return this.dispatcher.putAsync.bind(this.dispatcher);case 3:return this.dispatcher.removeAsync.bind(this.dispatcher);default:return null}},e.prototype.queueAttempt=function(e){var t=this;e&&e.status&&!this.isStatusRetryable(e.status)||this.isCancelled||this.attempts>this.delaySeconds.length?this.reject(e):(this.attemptTimer=i.TimerFactory.build(function(){return t.attempt()}),this.attemptTimer.start(this.getNextDelay()))},e.prototype.attempt=function(){var e=this;this.attempts++,this.attemptTimer=null;var t=(new Date).getTime();this.getRequestMethod(this.requestType)(this.url,this.request).then(function(n){return n?e.resolve({request:n.request,response:n.response,attempt:e.attempts,requestSendTimestamp:t,requestResponseTimestamp:(new Date).getTime()}):Promise.reject("Invalid response")}).catch(function(n){e.requestFailureCallback({request:n,attempt:e.attempts,requestSendTimestamp:t,requestResponseTimestamp:(new Date).getTime()}),e.queueAttempt(n)})},e.prototype.getNextDelay=function(){var e;return this.attempts?this.attempts<=this.delaySeconds.length&&(e=this.delaySeconds[this.attempts-1]):e=0,e},e.prototype.isStatusRetryable=function(e){return[500,502,503,504].indexOf(e)>-1},e}();t.RequestDispatcher=r},function(e,t,n){"use strict";var i=n(1),r=n(7),o=n(4),a=n(0),s=function(){function e(e,t){var n=this;this.disposed=!1,this.lastSeenSeqNumbers={},this.getClientUrls=function(){var e=null;return n.isWebRtcCall&&(e={controlVideoStreaming:o.get(n.signalingSession,i.URL_PATH.CONTROL_VIDEO_STREAMING),dominantSpeakerInfo:o.get(n.signalingSession,i.URL_PATH.DOMINANT_SPEAKER_INFO),csrcInfo:o.get(n.signalingSession,i.URL_PATH.CSRC_INFO)}),e},this.handleDominantSpeakerInfo=function(e){var t=e.body;n.logger.debug("handleDominantSpeakerInfo : ",a.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_DOMINANT_SPEAKER_INFO,e),n.handleWebRtcNotification(i.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO,t.dominantSpeakerInformation)},this.handleControlVideoStreaming=function(e){var t=e.body;n.logger.debug("handleControlVideoStreaming: ",a.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CONTROL_VIDEO_STREAMING,e),n.handleWebRtcNotification(i.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING,t.controlVideoStreaming)},this.handleCsrcInfo=function(e){var t=e.body;n.logger.debug("handleCsrcInfo : ",a.getPrintableObject(t)),n.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CSRC_INFO,e),n.handleWebRtcNotification(i.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO,t.csrcInfo)},this.sendControlVideoStreamingAsync=function(e,t){n.logger.log("sendControlVideoStreamingAsync"),a.assert(n.isWebRtcCall,"this is not a webrtc call"),a.assertNotNullOrEmpty(e,"correct controlVideoStreaming requestUrl is not provided"),a.assertNotNullOrEmpty(t,"controlVideoStreaming requestBody cannot be null or empty");var o=a.defer(),s=r.NETWORK_REQUESTS.SEND_CONTROL_VIDEO_STREAMING,c={payload:t};return n.signalingSession.http.sendPostRequest({url:e,payload:c,requestName:s,withoutTrouter:!0}).then(function(){n.disposed||o.resolve()}).catch(function(e){var t=a.getPrintableObject(e);if(n.logger.error("sendControlVideoStreamingAsync failed because : "+t),!n.disposed){var r=new Error(e);r.endCode=i.default.CALL_END_NETWORK_ERROR,o.reject(r)}}),o.promise},this.dispose=function(){n.logger.log("WebRtcSignalingManager :: dispose"),n.disposed=!0},this.signalingSession=e,this.signalingSessionCallback=t,this.isWebRtcCall=e.signalingAgentConfig.isWebRtcEnabled,this.logger=e.logger,this.lastSeenSeqNumbers[i.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING]=-1,this.lastSeenSeqNumbers[i.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO]=-1,this.lastSeenSeqNumbers[i.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO]=-1}return e.prototype.handleWebRtcNotification=function(e,t){a.assert(this.isWebRtcCall,"ignoring message in non-webrtc call");var n=this.lastSeenSeqNumbers[e];t.sequenceNumber<=n?this.logger.log("ignoring "+e+" . Last seen seq = "+n+" current seq = "+t.sequenceNumber):(this.lastSeenSeqNumbers[e]=t.sequenceNumber,this.signalingSessionCallback.onWebRtcMediaNotification(e,t))},e}();t.__esModule=!0,t.default=s},function(e,t,n){var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r=n(6),o={Service:{url:"https://trap.skype.com/",tokenUrl:"https://trap.skype.com/tokens",disabled:!1},Relay:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478,Lync:{addresses:["mr.skype.net"],tcpPort:443,udpPort:3478},Skype:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478},Turn:{addresses:["104.44.195.106"],tcpPort:443,udpPort:3478,url:"https://world.turn.skype.com/relay"}},Token:{earlyRefreshMinutes:60,earlyRefreshPercentage:50}};function a(e){return{expires:e.expires,username:e.username,password:e.password,realm:e.realm}}var s=function(){function e(e){var t=this;this.updateRelaysPromise=null,this.config=r.cloneDeep(o),this.trapTokens={},this.$unit={enforceUpdate:function(){t.updateRelaysPromise=null}},this.queryRelaysAsync=function(e,n){return t.updateRelaysPromise||(t.updateRelaysPromise=t.updateRelaysFromConfigAsync()),t.updateRelaysPromise.then(function(n){return t.fetchTurnRelayAddresses(e,n)}).then(function(t){return t?"turn"===e?t.Turn:n?t.Lync:t.Skype:[]})},this.context=e,this.logger=e.logger.createChild("RM"),this.request=e.request}return e.prototype.initialize=function(){this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync())},e.prototype.fetchTurnRelayAddresses=function(e,t){var n=this;if("turn"===e){var i=this.config.Relay.Turn.url;return this.request.get(i).then(function(e){var i=e.response,o=JSON.parse(JSON.stringify(i));return t.Turn[0].addresses=o.relay?[o.relay]:t.Turn[0].addresses,r.assign(t.Turn[0],a(n.getTrapToken(o.realm))),Promise.resolve(t)}).catch(function(e){return n.logger.error("failed to retreive turn relay addresses",e),Promise.resolve(t)})}return Promise.resolve(t)},e.prototype.updateRelaysFromConfigAsync=function(e){var t=this,n=this.getConfigAsync().then(function(){return t.updateRelaysAsync()}).then(function(e){return t.updateRelaysPromise=n,e}).catch(function(n){return t.updateRelaysPromise=null,e?t.logger.warn("failed to retrieve relays",n):t.logger.error("failed to retrieve relays",n),null});return n},e.prototype.refreshRelaysFromConfig=function(){this.request.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn("not refreshing relays due to no network connection"))},e.prototype.updateRelaysAsync=function(){var e=this,t=this.config.Service.tokenUrl;return this.context.tokenProvider().then(function(n){return e.request.get(t,{headers:{"X-Skypetoken":n,"api-version":2}})}).then(function(t){var n,r=t.response,o=e.config.Token.earlyRefreshMinutes,s=e.config.Token.earlyRefreshPercentage;e.storeTrapTokens(r),n=Math.max(r.expires-60*o,r.expires*s/100),window.setTimeout(e.refreshRelaysFromConfig.bind(e),1e3*n);var c=a(e.getTrapToken('"rtcmedia"')),l={Skype:[i({addresses:e.config.Relay.Skype.addresses,tcpPort:e.config.Relay.Skype.tcpPort,udpPort:e.config.Relay.Skype.udpPort,type:"msturn"},c)],Lync:[i({addresses:e.config.Relay.Lync.addresses,tcpPort:e.config.Relay.Lync.tcpPort,udpPort:e.config.Relay.Lync.udpPort,type:"msturn"},c)],Turn:[i({addresses:e.config.Relay.Turn.addresses,tcpPort:e.config.Relay.Turn.tcpPort,udpPort:e.config.Relay.Turn.udpPort,type:"turn"},c)]};return e.logger.log("relays from trap",l),l})},e.prototype.storeTrapTokens=function(e){if(e&&e.tokens){var t={};e.tokens.forEach(function(n){t[n.realm]={expires:e.expires,username:n.username,password:n.password,realm:n.realm}}),this.trapTokens=t}else this.logger.error("failed to get tokens from trap response")},e.prototype.getTrapToken=function(e){if("string"==typeof e){var t='"'+e.replace(/^"|"$/g,"")+'"',n=this.trapTokens[t];if(n)return n}throw new Error("token for relay not found, realm: "+e)},e.prototype.getConfigAsync=function(){var e=this;return this.logger.log("retrieving configuration"),Promise.resolve(this.context.configProvider()).then(function(t){e.logger.log("retrieved configuration:",t),e.config=r.cloneDeep(o),r.merge(e.config,t),e.logger.log("applied configuration:",e.config)}).catch(function(t){e.logger.warn("failed to retrieve configuration",t)})},e}();t.RelayManager=s,t.build=function(e){return new s(e)}},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t,n){n(35),n(20),n(25),n(26),n(74),n(37),n(38),n(39),n(21),n(36),n(41),n(40),e.exports=n(75)}])},e.exports=i(n(381),n(341),n(388),n(391))},function(e,t,n){(function(e,i){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o,a=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",c="Expected a function",l="__lodash_hash_undefined__",u=500,d="__lodash_placeholder__",p=1,h=2,f=4,g=1,m=2,_=1,v=2,y=4,S=8,E=16,T=32,C=64,I=128,A=256,b=512,O=30,R="...",P=800,N=16,w=1,M=2,k=1/0,D=9007199254740991,L=1.7976931348623157e308,U=NaN,x=4294967295,F=x-1,H=x>>>1,G=[["ary",I],["bind",_],["bindKey",v],["curry",S],["curryRight",E],["flip",b],["partial",T],["partialRight",C],["rearg",A]],j="[object Arguments]",B="[object Array]",V="[object AsyncFunction]",W="[object Boolean]",q="[object Date]",z="[object DOMException]",K="[object Error]",Y="[object Function]",J="[object GeneratorFunction]",X="[object Map]",Q="[object Number]",$="[object Null]",Z="[object Object]",ee="[object Proxy]",te="[object RegExp]",ne="[object Set]",ie="[object String]",re="[object Symbol]",oe="[object Undefined]",ae="[object WeakMap]",se="[object WeakSet]",ce="[object ArrayBuffer]",le="[object DataView]",ue="[object Float32Array]",de="[object Float64Array]",pe="[object Int8Array]",he="[object Int16Array]",fe="[object Int32Array]",ge="[object Uint8Array]",me="[object Uint8ClampedArray]",_e="[object Uint16Array]",ve="[object Uint32Array]",ye=/\b__p \+= '';/g,Se=/\b(__p \+=) '' \+/g,Ee=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Te=/&(?:amp|lt|gt|quot|#39);/g,Ce=/[&<>"']/g,Ie=RegExp(Te.source),Ae=RegExp(Ce.source),be=/<%-([\s\S]+?)%>/g,Oe=/<%([\s\S]+?)%>/g,Re=/<%=([\s\S]+?)%>/g,Pe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ne=/^\w*$/,we=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Me=/[\\^$.*+?()[\]{}|]/g,ke=RegExp(Me.source),De=/^\s+|\s+$/g,Le=/^\s+/,Ue=/\s+$/,xe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Fe=/\{\n\/\* \[wrapped with (.+)\] \*/,He=/,? & /,Ge=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,je=/\\(\\)?/g,Be=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ve=/\w*$/,We=/^[-+]0x[0-9a-f]+$/i,qe=/^0b[01]+$/i,ze=/^\[object .+?Constructor\]$/,Ke=/^0o[0-7]+$/i,Ye=/^(?:0|[1-9]\d*)$/,Je=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Xe=/($^)/,Qe=/['\n\r\u2028\u2029\\]/g,$e="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ze="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",et="[\\ud800-\\udfff]",tt="["+Ze+"]",nt="["+$e+"]",it="\\d+",rt="[\\u2700-\\u27bf]",ot="[a-z\\xdf-\\xf6\\xf8-\\xff]",at="[^\\ud800-\\udfff"+Ze+it+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",st="\\ud83c[\\udffb-\\udfff]",ct="[^\\ud800-\\udfff]",lt="(?:\\ud83c[\\udde6-\\uddff]){2}",ut="[\\ud800-\\udbff][\\udc00-\\udfff]",dt="[A-Z\\xc0-\\xd6\\xd8-\\xde]",pt="(?:"+ot+"|"+at+")",ht="(?:"+dt+"|"+at+")",ft="(?:"+nt+"|"+st+")"+"?",gt="[\\ufe0e\\ufe0f]?"+ft+("(?:\\u200d(?:"+[ct,lt,ut].join("|")+")[\\ufe0e\\ufe0f]?"+ft+")*"),mt="(?:"+[rt,lt,ut].join("|")+")"+gt,_t="(?:"+[ct+nt+"?",nt,lt,ut,et].join("|")+")",vt=RegExp("['â€™]","g"),yt=RegExp(nt,"g"),St=RegExp(st+"(?="+st+")|"+_t+gt,"g"),Et=RegExp([dt+"?"+ot+"+(?:['â€™](?:d|ll|m|re|s|t|ve))?(?="+[tt,dt,"$"].join("|")+")",ht+"+(?:['â€™](?:D|LL|M|RE|S|T|VE))?(?="+[tt,dt+pt,"$"].join("|")+")",dt+"?"+pt+"+(?:['â€™](?:d|ll|m|re|s|t|ve))?",dt+"+(?:['â€™](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",it,mt].join("|"),"g"),Tt=RegExp("[\\u200d\\ud800-\\udfff"+$e+"\\ufe0e\\ufe0f]"),Ct=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,It=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],At=-1,bt={};bt[ue]=bt[de]=bt[pe]=bt[he]=bt[fe]=bt[ge]=bt[me]=bt[_e]=bt[ve]=!0,bt[j]=bt[B]=bt[ce]=bt[W]=bt[le]=bt[q]=bt[K]=bt[Y]=bt[X]=bt[Q]=bt[Z]=bt[te]=bt[ne]=bt[ie]=bt[ae]=!1;var Ot={};Ot[j]=Ot[B]=Ot[ce]=Ot[le]=Ot[W]=Ot[q]=Ot[ue]=Ot[de]=Ot[pe]=Ot[he]=Ot[fe]=Ot[X]=Ot[Q]=Ot[Z]=Ot[te]=Ot[ne]=Ot[ie]=Ot[re]=Ot[ge]=Ot[me]=Ot[_e]=Ot[ve]=!0,Ot[K]=Ot[Y]=Ot[ae]=!1;var Rt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Pt=parseFloat,Nt=parseInt,wt="object"==typeof e&&e&&e.Object===Object&&e,Mt="object"==typeof self&&self&&self.Object===Object&&self,kt=wt||Mt||Function("return this")(),Dt="object"==typeof t&&t&&!t.nodeType&&t,Lt=Dt&&"object"==typeof i&&i&&!i.nodeType&&i,Ut=Lt&&Lt.exports===Dt,xt=Ut&&wt.process,Ft=function(){try{var e=Lt&&Lt.require&&Lt.require("util").types;return e||xt&&xt.binding&&xt.binding("util")}catch(e){}}(),Ht=Ft&&Ft.isArrayBuffer,Gt=Ft&&Ft.isDate,jt=Ft&&Ft.isMap,Bt=Ft&&Ft.isRegExp,Vt=Ft&&Ft.isSet,Wt=Ft&&Ft.isTypedArray;function qt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function zt(e,t,n,i){for(var r=-1,o=null==e?0:e.length;++r<o;){var a=e[r];t(i,a,n(a),e)}return i}function Kt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function Yt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Jt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function Xt(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}function Qt(e,t){return!!(null==e?0:e.length)&&cn(e,t,0)>-1}function $t(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}function Zt(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}function en(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}function tn(e,t,n,i){var r=-1,o=null==e?0:e.length;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function nn(e,t,n,i){var r=null==e?0:e.length;for(i&&r&&(n=e[--r]);r--;)n=t(n,e[r],r,e);return n}function rn(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}var on=pn("length");function an(e,t,n){var i;return n(e,function(e,n,r){if(t(e,n,r))return i=n,!1}),i}function sn(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function cn(e,t,n){return t==t?function(e,t,n){var i=n-1,r=e.length;for(;++i<r;)if(e[i]===t)return i;return-1}(e,t,n):sn(e,un,n)}function ln(e,t,n,i){for(var r=n-1,o=e.length;++r<o;)if(i(e[r],t))return r;return-1}function un(e){return e!=e}function dn(e,t){var n=null==e?0:e.length;return n?gn(e,t)/n:U}function pn(e){return function(t){return null==t?o:t[e]}}function hn(e){return function(t){return null==e?o:e[t]}}function fn(e,t,n,i,r){return r(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)}),n}function gn(e,t){for(var n,i=-1,r=e.length;++i<r;){var a=t(e[i]);a!==o&&(n=n===o?a:n+a)}return n}function mn(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function _n(e){return function(t){return e(t)}}function vn(e,t){return Zt(t,function(t){return e[t]})}function yn(e,t){return e.has(t)}function Sn(e,t){for(var n=-1,i=e.length;++n<i&&cn(t,e[n],0)>-1;);return n}function En(e,t){for(var n=e.length;n--&&cn(t,e[n],0)>-1;);return n}var Tn=hn({"Ã€":"A","Ã":"A","Ã‚":"A","Ãƒ":"A","Ã„":"A","Ã…":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã‡":"C","Ã§":"c","Ã":"D","Ã°":"d","Ãˆ":"E","Ã‰":"E","ÃŠ":"E","Ã‹":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","ÃŒ":"I","Ã":"I","ÃŽ":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã‘":"N","Ã±":"n","Ã’":"O","Ã“":"O","Ã”":"O","Ã•":"O","Ã–":"O","Ã˜":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã™":"U","Ãš":"U","Ã›":"U","Ãœ":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã†":"Ae","Ã¦":"ae","Ãž":"Th","Ã¾":"th","ÃŸ":"ss","Ä€":"A","Ä‚":"A","Ä„":"A","Ä":"a","Äƒ":"a","Ä…":"a","Ä†":"C","Äˆ":"C","ÄŠ":"C","ÄŒ":"C","Ä‡":"c","Ä‰":"c","Ä‹":"c","Ä":"c","ÄŽ":"D","Ä":"D","Ä":"d","Ä‘":"d","Ä’":"E","Ä”":"E","Ä–":"E","Ä˜":"E","Äš":"E","Ä“":"e","Ä•":"e","Ä—":"e","Ä™":"e","Ä›":"e","Äœ":"G","Äž":"G","Ä ":"G","Ä¢":"G","Ä":"g","ÄŸ":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å€":"l","Å‚":"l","Åƒ":"N","Å…":"N","Å‡":"N","ÅŠ":"N","Å„":"n","Å†":"n","Åˆ":"n","Å‹":"n","ÅŒ":"O","ÅŽ":"O","Å":"O","Å":"o","Å":"o","Å‘":"o","Å”":"R","Å–":"R","Å˜":"R","Å•":"r","Å—":"r","Å™":"r","Åš":"S","Åœ":"S","Åž":"S","Å ":"S","Å›":"s","Å":"s","ÅŸ":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å’":"Oe","Å“":"oe","Å‰":"'n","Å¿":"s"}),Cn=hn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function In(e){return"\\"+Rt[e]}function An(e){return Tt.test(e)}function bn(e){var t=-1,n=Array(e.size);return e.forEach(function(e,i){n[++t]=[i,e]}),n}function On(e,t){return function(n){return e(t(n))}}function Rn(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n];a!==t&&a!==d||(e[n]=d,o[r++]=n)}return o}function Pn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function Nn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function wn(e){return An(e)?function(e){var t=St.lastIndex=0;for(;St.test(e);)++t;return t}(e):on(e)}function Mn(e){return An(e)?function(e){return e.match(St)||[]}(e):function(e){return e.split("")}(e)}var kn=hn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Dn=function e(t){var n,i=(t=null==t?kt:Dn.defaults(kt.Object(),t,Dn.pick(kt,It))).Array,r=t.Date,$e=t.Error,Ze=t.Function,et=t.Math,tt=t.Object,nt=t.RegExp,it=t.String,rt=t.TypeError,ot=i.prototype,at=Ze.prototype,st=tt.prototype,ct=t["__core-js_shared__"],lt=at.toString,ut=st.hasOwnProperty,dt=0,pt=(n=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",ht=st.toString,ft=lt.call(tt),gt=kt._,mt=nt("^"+lt.call(ut).replace(Me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=Ut?t.Buffer:o,St=t.Symbol,Tt=t.Uint8Array,Rt=_t?_t.allocUnsafe:o,wt=On(tt.getPrototypeOf,tt),Mt=tt.create,Dt=st.propertyIsEnumerable,Lt=ot.splice,xt=St?St.isConcatSpreadable:o,Ft=St?St.iterator:o,on=St?St.toStringTag:o,hn=function(){try{var e=Ho(tt,"defineProperty");return e({},"",{}),e}catch(e){}}(),Ln=t.clearTimeout!==kt.clearTimeout&&t.clearTimeout,Un=r&&r.now!==kt.Date.now&&r.now,xn=t.setTimeout!==kt.setTimeout&&t.setTimeout,Fn=et.ceil,Hn=et.floor,Gn=tt.getOwnPropertySymbols,jn=_t?_t.isBuffer:o,Bn=t.isFinite,Vn=ot.join,Wn=On(tt.keys,tt),qn=et.max,zn=et.min,Kn=r.now,Yn=t.parseInt,Jn=et.random,Xn=ot.reverse,Qn=Ho(t,"DataView"),$n=Ho(t,"Map"),Zn=Ho(t,"Promise"),ei=Ho(t,"Set"),ti=Ho(t,"WeakMap"),ni=Ho(tt,"create"),ii=ti&&new ti,ri={},oi=da(Qn),ai=da($n),si=da(Zn),ci=da(ei),li=da(ti),ui=St?St.prototype:o,di=ui?ui.valueOf:o,pi=ui?ui.toString:o;function hi(e){if(Rs(e)&&!_s(e)&&!(e instanceof _i)){if(e instanceof mi)return e;if(ut.call(e,"__wrapped__"))return pa(e)}return new mi(e)}var fi=function(){function e(){}return function(t){if(!Os(t))return{};if(Mt)return Mt(t);e.prototype=t;var n=new e;return e.prototype=o,n}}();function gi(){}function mi(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}function _i(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=x,this.__views__=[]}function vi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function yi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Si(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Ei(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Si;++t<n;)this.add(e[t])}function Ti(e){var t=this.__data__=new yi(e);this.size=t.size}function Ci(e,t){var n=_s(e),i=!n&&ms(e),r=!n&&!i&&Es(e),o=!n&&!i&&!r&&Us(e),a=n||i||r||o,s=a?mn(e.length,it):[],c=s.length;for(var l in e)!t&&!ut.call(e,l)||a&&("length"==l||r&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||zo(l,c))||s.push(l);return s}function Ii(e){var t=e.length;return t?e[Er(0,t-1)]:o}function Ai(e,t){return ca(no(e),Di(t,0,e.length))}function bi(e){return ca(no(e))}function Oi(e,t,n){(n===o||hs(e[t],n))&&(n!==o||t in e)||Mi(e,t,n)}function Ri(e,t,n){var i=e[t];ut.call(e,t)&&hs(i,n)&&(n!==o||t in e)||Mi(e,t,n)}function Pi(e,t){for(var n=e.length;n--;)if(hs(e[n][0],t))return n;return-1}function Ni(e,t,n,i){return Hi(e,function(e,r,o){t(i,e,n(e),o)}),i}function wi(e,t){return e&&io(t,rc(t),e)}function Mi(e,t,n){"__proto__"==t&&hn?hn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ki(e,t){for(var n=-1,r=t.length,a=i(r),s=null==e;++n<r;)a[n]=s?o:Zs(e,t[n]);return a}function Di(e,t,n){return e==e&&(n!==o&&(e=e<=n?e:n),t!==o&&(e=e>=t?e:t)),e}function Li(e,t,n,i,r,a){var s,c=t&p,l=t&h,u=t&f;if(n&&(s=r?n(e,i,r,a):n(e)),s!==o)return s;if(!Os(e))return e;var d=_s(e);if(d){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ut.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!c)return no(e,s)}else{var g=Bo(e),m=g==Y||g==J;if(Es(e))return Xr(e,c);if(g==Z||g==j||m&&!r){if(s=l||m?{}:Wo(e),!c)return l?function(e,t){return io(e,jo(e),t)}(e,function(e,t){return e&&io(t,oc(t),e)}(s,e)):function(e,t){return io(e,Go(e),t)}(e,wi(s,e))}else{if(!Ot[g])return r?e:{};s=function(e,t,n){var i,r,o,a=e.constructor;switch(t){case ce:return Qr(e);case W:case q:return new a(+e);case le:return function(e,t){var n=t?Qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case ue:case de:case pe:case he:case fe:case ge:case me:case _e:case ve:return $r(e,n);case X:return new a;case Q:case ie:return new a(e);case te:return(o=new(r=e).constructor(r.source,Ve.exec(r))).lastIndex=r.lastIndex,o;case ne:return new a;case re:return i=e,di?tt(di.call(i)):{}}}(e,g,c)}}a||(a=new Ti);var _=a.get(e);if(_)return _;if(a.set(e,s),ks(e))return e.forEach(function(i){s.add(Li(i,t,n,i,e,a))}),s;if(Ps(e))return e.forEach(function(i,r){s.set(r,Li(i,t,n,r,e,a))}),s;var v=d?o:(u?l?Mo:wo:l?oc:rc)(e);return Kt(v||e,function(i,r){v&&(i=e[r=i]),Ri(s,r,Li(i,t,n,r,e,a))}),s}function Ui(e,t,n){var i=n.length;if(null==e)return!i;for(e=tt(e);i--;){var r=n[i],a=t[r],s=e[r];if(s===o&&!(r in e)||!a(s))return!1}return!0}function xi(e,t,n){if("function"!=typeof e)throw new rt(c);return ra(function(){e.apply(o,n)},t)}function Fi(e,t,n,i){var r=-1,o=Qt,s=!0,c=e.length,l=[],u=t.length;if(!c)return l;n&&(t=Zt(t,_n(n))),i?(o=$t,s=!1):t.length>=a&&(o=yn,s=!1,t=new Ei(t));e:for(;++r<c;){var d=e[r],p=null==n?d:n(d);if(d=i||0!==d?d:0,s&&p==p){for(var h=u;h--;)if(t[h]===p)continue e;l.push(d)}else o(t,p,i)||l.push(d)}return l}hi.templateSettings={escape:be,evaluate:Oe,interpolate:Re,variable:"",imports:{_:hi}},hi.prototype=gi.prototype,hi.prototype.constructor=hi,mi.prototype=fi(gi.prototype),mi.prototype.constructor=mi,_i.prototype=fi(gi.prototype),_i.prototype.constructor=_i,vi.prototype.clear=function(){this.__data__=ni?ni(null):{},this.size=0},vi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},vi.prototype.get=function(e){var t=this.__data__;if(ni){var n=t[e];return n===l?o:n}return ut.call(t,e)?t[e]:o},vi.prototype.has=function(e){var t=this.__data__;return ni?t[e]!==o:ut.call(t,e)},vi.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ni&&t===o?l:t,this},yi.prototype.clear=function(){this.__data__=[],this.size=0},yi.prototype.delete=function(e){var t=this.__data__,n=Pi(t,e);return!(n<0||(n==t.length-1?t.pop():Lt.call(t,n,1),--this.size,0))},yi.prototype.get=function(e){var t=this.__data__,n=Pi(t,e);return n<0?o:t[n][1]},yi.prototype.has=function(e){return Pi(this.__data__,e)>-1},yi.prototype.set=function(e,t){var n=this.__data__,i=Pi(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},Si.prototype.clear=function(){this.size=0,this.__data__={hash:new vi,map:new($n||yi),string:new vi}},Si.prototype.delete=function(e){var t=xo(this,e).delete(e);return this.size-=t?1:0,t},Si.prototype.get=function(e){return xo(this,e).get(e)},Si.prototype.has=function(e){return xo(this,e).has(e)},Si.prototype.set=function(e,t){var n=xo(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},Ei.prototype.add=Ei.prototype.push=function(e){return this.__data__.set(e,l),this},Ei.prototype.has=function(e){return this.__data__.has(e)},Ti.prototype.clear=function(){this.__data__=new yi,this.size=0},Ti.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ti.prototype.get=function(e){return this.__data__.get(e)},Ti.prototype.has=function(e){return this.__data__.has(e)},Ti.prototype.set=function(e,t){var n=this.__data__;if(n instanceof yi){var i=n.__data__;if(!$n||i.length<a-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new Si(i)}return n.set(e,t),this.size=n.size,this};var Hi=ao(Ki),Gi=ao(Yi,!0);function ji(e,t){var n=!0;return Hi(e,function(e,i,r){return n=!!t(e,i,r)}),n}function Bi(e,t,n){for(var i=-1,r=e.length;++i<r;){var a=e[i],s=t(a);if(null!=s&&(c===o?s==s&&!Ls(s):n(s,c)))var c=s,l=a}return l}function Vi(e,t){var n=[];return Hi(e,function(e,i,r){t(e,i,r)&&n.push(e)}),n}function Wi(e,t,n,i,r){var o=-1,a=e.length;for(n||(n=qo),r||(r=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?Wi(s,t-1,n,i,r):en(r,s):i||(r[r.length]=s)}return r}var qi=so(),zi=so(!0);function Ki(e,t){return e&&qi(e,t,rc)}function Yi(e,t){return e&&zi(e,t,rc)}function Ji(e,t){return Xt(t,function(t){return Is(e[t])})}function Xi(e,t){for(var n=0,i=(t=zr(t,e)).length;null!=e&&n<i;)e=e[ua(t[n++])];return n&&n==i?e:o}function Qi(e,t,n){var i=t(e);return _s(e)?i:en(i,n(e))}function $i(e){return null==e?e===o?oe:$:on&&on in tt(e)?function(e){var t=ut.call(e,on),n=e[on];try{e[on]=o;var i=!0}catch(e){}var r=ht.call(e);return i&&(t?e[on]=n:delete e[on]),r}(e):function(e){return ht.call(e)}(e)}function Zi(e,t){return e>t}function er(e,t){return null!=e&&ut.call(e,t)}function tr(e,t){return null!=e&&t in tt(e)}function nr(e,t,n){for(var r=n?$t:Qt,a=e[0].length,s=e.length,c=s,l=i(s),u=1/0,d=[];c--;){var p=e[c];c&&t&&(p=Zt(p,_n(t))),u=zn(p.length,u),l[c]=!n&&(t||a>=120&&p.length>=120)?new Ei(c&&p):o}p=e[0];var h=-1,f=l[0];e:for(;++h<a&&d.length<u;){var g=p[h],m=t?t(g):g;if(g=n||0!==g?g:0,!(f?yn(f,m):r(d,m,n))){for(c=s;--c;){var _=l[c];if(!(_?yn(_,m):r(e[c],m,n)))continue e}f&&f.push(m),d.push(g)}}return d}function ir(e,t,n){var i=null==(e=ta(e,t=zr(t,e)))?e:e[ua(Ca(t))];return null==i?o:qt(i,e,n)}function rr(e){return Rs(e)&&$i(e)==j}function or(e,t,n,i,r){return e===t||(null==e||null==t||!Rs(e)&&!Rs(t)?e!=e&&t!=t:function(e,t,n,i,r,a){var s=_s(e),c=_s(t),l=s?B:Bo(e),u=c?B:Bo(t),d=(l=l==j?Z:l)==Z,p=(u=u==j?Z:u)==Z,h=l==u;if(h&&Es(e)){if(!Es(t))return!1;s=!0,d=!1}if(h&&!d)return a||(a=new Ti),s||Us(e)?Po(e,t,n,i,r,a):function(e,t,n,i,r,o,a){switch(n){case le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ce:return!(e.byteLength!=t.byteLength||!o(new Tt(e),new Tt(t)));case W:case q:case Q:return hs(+e,+t);case K:return e.name==t.name&&e.message==t.message;case te:case ie:return e==t+"";case X:var s=bn;case ne:var c=i&g;if(s||(s=Pn),e.size!=t.size&&!c)return!1;var l=a.get(e);if(l)return l==t;i|=m,a.set(e,t);var u=Po(s(e),s(t),i,r,o,a);return a.delete(e),u;case re:if(di)return di.call(e)==di.call(t)}return!1}(e,t,l,n,i,r,a);if(!(n&g)){var f=d&&ut.call(e,"__wrapped__"),_=p&&ut.call(t,"__wrapped__");if(f||_){var v=f?e.value():e,y=_?t.value():t;return a||(a=new Ti),r(v,y,n,i,a)}}return!!h&&(a||(a=new Ti),function(e,t,n,i,r,a){var s=n&g,c=wo(e),l=c.length,u=wo(t).length;if(l!=u&&!s)return!1;for(var d=l;d--;){var p=c[d];if(!(s?p in t:ut.call(t,p)))return!1}var h=a.get(e);if(h&&a.get(t))return h==t;var f=!0;a.set(e,t),a.set(t,e);for(var m=s;++d<l;){p=c[d];var _=e[p],v=t[p];if(i)var y=s?i(v,_,p,t,e,a):i(_,v,p,e,t,a);if(!(y===o?_===v||r(_,v,n,i,a):y)){f=!1;break}m||(m="constructor"==p)}if(f&&!m){var S=e.constructor,E=t.constructor;S!=E&&"constructor"in e&&"constructor"in t&&!("function"==typeof S&&S instanceof S&&"function"==typeof E&&E instanceof E)&&(f=!1)}return a.delete(e),a.delete(t),f}(e,t,n,i,r,a))}(e,t,n,i,or,r))}function ar(e,t,n,i){var r=n.length,a=r,s=!i;if(null==e)return!a;for(e=tt(e);r--;){var c=n[r];if(s&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++r<a;){var l=(c=n[r])[0],u=e[l],d=c[1];if(s&&c[2]){if(u===o&&!(l in e))return!1}else{var p=new Ti;if(i)var h=i(u,d,l,e,t,p);if(!(h===o?or(d,u,g|m,i,p):h))return!1}}return!0}function sr(e){return!(!Os(e)||pt&&pt in e)&&(Is(e)?mt:ze).test(da(e))}function cr(e){return"function"==typeof e?e:null==e?Nc:"object"==typeof e?_s(e)?fr(e[0],e[1]):hr(e):Hc(e)}function lr(e){if(!Qo(e))return Wn(e);var t=[];for(var n in tt(e))ut.call(e,n)&&"constructor"!=n&&t.push(n);return t}function ur(e){if(!Os(e))return function(e){var t=[];if(null!=e)for(var n in tt(e))t.push(n);return t}(e);var t=Qo(e),n=[];for(var i in e)("constructor"!=i||!t&&ut.call(e,i))&&n.push(i);return n}function dr(e,t){return e<t}function pr(e,t){var n=-1,r=ys(e)?i(e.length):[];return Hi(e,function(e,i,o){r[++n]=t(e,i,o)}),r}function hr(e){var t=Fo(e);return 1==t.length&&t[0][2]?Zo(t[0][0],t[0][1]):function(n){return n===e||ar(n,e,t)}}function fr(e,t){return Yo(e)&&$o(t)?Zo(ua(e),t):function(n){var i=Zs(n,e);return i===o&&i===t?ec(n,e):or(t,i,g|m)}}function gr(e,t,n,i,r){e!==t&&qi(t,function(a,s){if(Os(a))r||(r=new Ti),function(e,t,n,i,r,a,s){var c=na(e,n),l=na(t,n),u=s.get(l);if(u)Oi(e,n,u);else{var d=a?a(c,l,n+"",e,t,s):o,p=d===o;if(p){var h=_s(l),f=!h&&Es(l),g=!h&&!f&&Us(l);d=l,h||f||g?_s(c)?d=c:Ss(c)?d=no(c):f?(p=!1,d=Xr(l,!0)):g?(p=!1,d=$r(l,!0)):d=[]:ws(l)||ms(l)?(d=c,ms(c)?d=Ws(c):Os(c)&&!Is(c)||(d=Wo(l))):p=!1}p&&(s.set(l,d),r(d,l,i,a,s),s.delete(l)),Oi(e,n,d)}}(e,t,s,n,gr,i,r);else{var c=i?i(na(e,s),a,s+"",e,t,r):o;c===o&&(c=a),Oi(e,s,c)}},oc)}function mr(e,t){var n=e.length;if(n)return zo(t+=t<0?n:0,n)?e[t]:o}function _r(e,t,n){var i=-1;return t=Zt(t.length?t:[Nc],_n(Uo())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(pr(e,function(e,n,r){return{criteria:Zt(t,function(t){return t(e)}),index:++i,value:e}}),function(e,t){return function(e,t,n){for(var i=-1,r=e.criteria,o=t.criteria,a=r.length,s=n.length;++i<a;){var c=Zr(r[i],o[i]);if(c){if(i>=s)return c;var l=n[i];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)})}function vr(e,t,n){for(var i=-1,r=t.length,o={};++i<r;){var a=t[i],s=Xi(e,a);n(s,a)&&br(o,zr(a,e),s)}return o}function yr(e,t,n,i){var r=i?ln:cn,o=-1,a=t.length,s=e;for(e===t&&(t=no(t)),n&&(s=Zt(e,_n(n)));++o<a;)for(var c=0,l=t[o],u=n?n(l):l;(c=r(s,u,c,i))>-1;)s!==e&&Lt.call(s,c,1),Lt.call(e,c,1);return e}function Sr(e,t){for(var n=e?t.length:0,i=n-1;n--;){var r=t[n];if(n==i||r!==o){var o=r;zo(r)?Lt.call(e,r,1):Fr(e,r)}}return e}function Er(e,t){return e+Hn(Jn()*(t-e+1))}function Tr(e,t){var n="";if(!e||t<1||t>D)return n;do{t%2&&(n+=e),(t=Hn(t/2))&&(e+=e)}while(t);return n}function Cr(e,t){return oa(ea(e,t,Nc),e+"")}function Ir(e){return Ii(hc(e))}function Ar(e,t){var n=hc(e);return ca(n,Di(t,0,n.length))}function br(e,t,n,i){if(!Os(e))return e;for(var r=-1,a=(t=zr(t,e)).length,s=a-1,c=e;null!=c&&++r<a;){var l=ua(t[r]),u=n;if(r!=s){var d=c[l];(u=i?i(d,l,c):o)===o&&(u=Os(d)?d:zo(t[r+1])?[]:{})}Ri(c,l,u),c=c[l]}return e}var Or=ii?function(e,t){return ii.set(e,t),e}:Nc,Rr=hn?function(e,t){return hn(e,"toString",{configurable:!0,enumerable:!1,value:Oc(t),writable:!0})}:Nc;function Pr(e){return ca(hc(e))}function Nr(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var a=i(o);++r<o;)a[r]=e[r+t];return a}function wr(e,t){var n;return Hi(e,function(e,i,r){return!(n=t(e,i,r))}),!!n}function Mr(e,t,n){var i=0,r=null==e?i:e.length;if("number"==typeof t&&t==t&&r<=H){for(;i<r;){var o=i+r>>>1,a=e[o];null!==a&&!Ls(a)&&(n?a<=t:a<t)?i=o+1:r=o}return r}return kr(e,t,Nc,n)}function kr(e,t,n,i){t=n(t);for(var r=0,a=null==e?0:e.length,s=t!=t,c=null===t,l=Ls(t),u=t===o;r<a;){var d=Hn((r+a)/2),p=n(e[d]),h=p!==o,f=null===p,g=p==p,m=Ls(p);if(s)var _=i||g;else _=u?g&&(i||h):c?g&&h&&(i||!f):l?g&&h&&!f&&(i||!m):!f&&!m&&(i?p<=t:p<t);_?r=d+1:a=d}return zn(a,F)}function Dr(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n],s=t?t(a):a;if(!n||!hs(s,c)){var c=s;o[r++]=0===a?0:a}}return o}function Lr(e){return"number"==typeof e?e:Ls(e)?U:+e}function Ur(e){if("string"==typeof e)return e;if(_s(e))return Zt(e,Ur)+"";if(Ls(e))return pi?pi.call(e):"";var t=e+"";return"0"==t&&1/e==-k?"-0":t}function xr(e,t,n){var i=-1,r=Qt,o=e.length,s=!0,c=[],l=c;if(n)s=!1,r=$t;else if(o>=a){var u=t?null:Co(e);if(u)return Pn(u);s=!1,r=yn,l=new Ei}else l=t?[]:c;e:for(;++i<o;){var d=e[i],p=t?t(d):d;if(d=n||0!==d?d:0,s&&p==p){for(var h=l.length;h--;)if(l[h]===p)continue e;t&&l.push(p),c.push(d)}else r(l,p,n)||(l!==c&&l.push(p),c.push(d))}return c}function Fr(e,t){return null==(e=ta(e,t=zr(t,e)))||delete e[ua(Ca(t))]}function Hr(e,t,n,i){return br(e,t,n(Xi(e,t)),i)}function Gr(e,t,n,i){for(var r=e.length,o=i?r:-1;(i?o--:++o<r)&&t(e[o],o,e););return n?Nr(e,i?0:o,i?o+1:r):Nr(e,i?o+1:0,i?r:o)}function jr(e,t){var n=e;return n instanceof _i&&(n=n.value()),tn(t,function(e,t){return t.func.apply(t.thisArg,en([e],t.args))},n)}function Br(e,t,n){var r=e.length;if(r<2)return r?xr(e[0]):[];for(var o=-1,a=i(r);++o<r;)for(var s=e[o],c=-1;++c<r;)c!=o&&(a[o]=Fi(a[o]||s,e[c],t,n));return xr(Wi(a,1),t,n)}function Vr(e,t,n){for(var i=-1,r=e.length,a=t.length,s={};++i<r;){var c=i<a?t[i]:o;n(s,e[i],c)}return s}function Wr(e){return Ss(e)?e:[]}function qr(e){return"function"==typeof e?e:Nc}function zr(e,t){return _s(e)?e:Yo(e,t)?[e]:la(qs(e))}var Kr=Cr;function Yr(e,t,n){var i=e.length;return n=n===o?i:n,!t&&n>=i?e:Nr(e,t,n)}var Jr=Ln||function(e){return kt.clearTimeout(e)};function Xr(e,t){if(t)return e.slice();var n=e.length,i=Rt?Rt(n):new e.constructor(n);return e.copy(i),i}function Qr(e){var t=new e.constructor(e.byteLength);return new Tt(t).set(new Tt(e)),t}function $r(e,t){var n=t?Qr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Zr(e,t){if(e!==t){var n=e!==o,i=null===e,r=e==e,a=Ls(e),s=t!==o,c=null===t,l=t==t,u=Ls(t);if(!c&&!u&&!a&&e>t||a&&s&&l&&!c&&!u||i&&s&&l||!n&&l||!r)return 1;if(!i&&!a&&!u&&e<t||u&&n&&r&&!i&&!a||c&&n&&r||!s&&r||!l)return-1}return 0}function eo(e,t,n,r){for(var o=-1,a=e.length,s=n.length,c=-1,l=t.length,u=qn(a-s,0),d=i(l+u),p=!r;++c<l;)d[c]=t[c];for(;++o<s;)(p||o<a)&&(d[n[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function to(e,t,n,r){for(var o=-1,a=e.length,s=-1,c=n.length,l=-1,u=t.length,d=qn(a-c,0),p=i(d+u),h=!r;++o<d;)p[o]=e[o];for(var f=o;++l<u;)p[f+l]=t[l];for(;++s<c;)(h||o<a)&&(p[f+n[s]]=e[o++]);return p}function no(e,t){var n=-1,r=e.length;for(t||(t=i(r));++n<r;)t[n]=e[n];return t}function io(e,t,n,i){var r=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var c=t[a],l=i?i(n[c],e[c],c,n,e):o;l===o&&(l=e[c]),r?Mi(n,c,l):Ri(n,c,l)}return n}function ro(e,t){return function(n,i){var r=_s(n)?zt:Ni,o=t?t():{};return r(n,e,Uo(i,2),o)}}function oo(e){return Cr(function(t,n){var i=-1,r=n.length,a=r>1?n[r-1]:o,s=r>2?n[2]:o;for(a=e.length>3&&"function"==typeof a?(r--,a):o,s&&Ko(n[0],n[1],s)&&(a=r<3?o:a,r=1),t=tt(t);++i<r;){var c=n[i];c&&e(t,c,i,a)}return t})}function ao(e,t){return function(n,i){if(null==n)return n;if(!ys(n))return e(n,i);for(var r=n.length,o=t?r:-1,a=tt(n);(t?o--:++o<r)&&!1!==i(a[o],o,a););return n}}function so(e){return function(t,n,i){for(var r=-1,o=tt(t),a=i(t),s=a.length;s--;){var c=a[e?s:++r];if(!1===n(o[c],c,o))break}return t}}function co(e){return function(t){var n=An(t=qs(t))?Mn(t):o,i=n?n[0]:t.charAt(0),r=n?Yr(n,1).join(""):t.slice(1);return i[e]()+r}}function lo(e){return function(t){return tn(Ic(mc(t).replace(vt,"")),e,"")}}function uo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=fi(e.prototype),i=e.apply(n,t);return Os(i)?i:n}}function po(e){return function(t,n,i){var r=tt(t);if(!ys(t)){var a=Uo(n,3);t=rc(t),n=function(e){return a(r[e],e,r)}}var s=e(t,n,i);return s>-1?r[a?t[s]:s]:o}}function ho(e){return No(function(t){var n=t.length,i=n,r=mi.prototype.thru;for(e&&t.reverse();i--;){var a=t[i];if("function"!=typeof a)throw new rt(c);if(r&&!s&&"wrapper"==Do(a))var s=new mi([],!0)}for(i=s?i:n;++i<n;){var l=Do(a=t[i]),u="wrapper"==l?ko(a):o;s=u&&Jo(u[0])&&u[1]==(I|S|T|A)&&!u[4].length&&1==u[9]?s[Do(u[0])].apply(s,u[3]):1==a.length&&Jo(a)?s[l]():s.thru(a)}return function(){var e=arguments,i=e[0];if(s&&1==e.length&&_s(i))return s.plant(i).value();for(var r=0,o=n?t[r].apply(this,e):i;++r<n;)o=t[r].call(this,o);return o}})}function fo(e,t,n,r,a,s,c,l,u,d){var p=t&I,h=t&_,f=t&v,g=t&(S|E),m=t&b,y=f?o:uo(e);return function _(){for(var v=arguments.length,S=i(v),E=v;E--;)S[E]=arguments[E];if(g)var T=Lo(_),C=function(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}(S,T);if(r&&(S=eo(S,r,a,g)),s&&(S=to(S,s,c,g)),v-=C,g&&v<d){var I=Rn(S,T);return Eo(e,t,fo,_.placeholder,n,S,I,l,u,d-v)}var A=h?n:this,b=f?A[e]:e;return v=S.length,l?S=function(e,t){for(var n=e.length,i=zn(t.length,n),r=no(e);i--;){var a=t[i];e[i]=zo(a,n)?r[a]:o}return e}(S,l):m&&v>1&&S.reverse(),p&&u<v&&(S.length=u),this&&this!==kt&&this instanceof _&&(b=y||uo(b)),b.apply(A,S)}}function go(e,t){return function(n,i){return function(e,t,n,i){return Ki(e,function(e,r,o){t(i,n(e),r,o)}),i}(n,e,t(i),{})}}function mo(e,t){return function(n,i){var r;if(n===o&&i===o)return t;if(n!==o&&(r=n),i!==o){if(r===o)return i;"string"==typeof n||"string"==typeof i?(n=Ur(n),i=Ur(i)):(n=Lr(n),i=Lr(i)),r=e(n,i)}return r}}function _o(e){return No(function(t){return t=Zt(t,_n(Uo())),Cr(function(n){var i=this;return e(t,function(e){return qt(e,i,n)})})})}function vo(e,t){var n=(t=t===o?" ":Ur(t)).length;if(n<2)return n?Tr(t,e):t;var i=Tr(t,Fn(e/wn(t)));return An(t)?Yr(Mn(i),0,e).join(""):i.slice(0,e)}function yo(e){return function(t,n,r){return r&&"number"!=typeof r&&Ko(t,n,r)&&(n=r=o),t=Gs(t),n===o?(n=t,t=0):n=Gs(n),function(e,t,n,r){for(var o=-1,a=qn(Fn((t-e)/(n||1)),0),s=i(a);a--;)s[r?a:++o]=e,e+=n;return s}(t,n,r=r===o?t<n?1:-1:Gs(r),e)}}function So(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=Vs(t),n=Vs(n)),e(t,n)}}function Eo(e,t,n,i,r,a,s,c,l,u){var d=t&S;t|=d?T:C,(t&=~(d?C:T))&y||(t&=~(_|v));var p=[e,t,r,d?a:o,d?s:o,d?o:a,d?o:s,c,l,u],h=n.apply(o,p);return Jo(e)&&ia(h,p),h.placeholder=i,aa(h,e,t)}function To(e){var t=et[e];return function(e,n){if(e=Vs(e),n=null==n?0:zn(js(n),292)){var i=(qs(e)+"e").split("e");return+((i=(qs(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}var Co=ei&&1/Pn(new ei([,-0]))[1]==k?function(e){return new ei(e)}:Lc;function Io(e){return function(t){var n=Bo(t);return n==X?bn(t):n==ne?Nn(t):function(e,t){return Zt(t,function(t){return[t,e[t]]})}(t,e(t))}}function Ao(e,t,n,r,a,s,l,u){var p=t&v;if(!p&&"function"!=typeof e)throw new rt(c);var h=r?r.length:0;if(h||(t&=~(T|C),r=a=o),l=l===o?l:qn(js(l),0),u=u===o?u:js(u),h-=a?a.length:0,t&C){var f=r,g=a;r=a=o}var m=p?o:ko(e),b=[e,t,n,r,a,f,g,s,l,u];if(m&&function(e,t){var n=e[1],i=t[1],r=n|i,o=r<(_|v|I),a=i==I&&n==S||i==I&&n==A&&e[7].length<=t[8]||i==(I|A)&&t[7].length<=t[8]&&n==S;if(!o&&!a)return e;i&_&&(e[2]=t[2],r|=n&_?0:y);var s=t[3];if(s){var c=e[3];e[3]=c?eo(c,s,t[4]):s,e[4]=c?Rn(e[3],d):t[4]}(s=t[5])&&(c=e[5],e[5]=c?to(c,s,t[6]):s,e[6]=c?Rn(e[5],d):t[6]),(s=t[7])&&(e[7]=s),i&I&&(e[8]=null==e[8]?t[8]:zn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=r}(b,m),e=b[0],t=b[1],n=b[2],r=b[3],a=b[4],!(u=b[9]=b[9]===o?p?0:e.length:qn(b[9]-h,0))&&t&(S|E)&&(t&=~(S|E)),t&&t!=_)O=t==S||t==E?function(e,t,n){var r=uo(e);return function a(){for(var s=arguments.length,c=i(s),l=s,u=Lo(a);l--;)c[l]=arguments[l];var d=s<3&&c[0]!==u&&c[s-1]!==u?[]:Rn(c,u);return(s-=d.length)<n?Eo(e,t,fo,a.placeholder,o,c,d,o,o,n-s):qt(this&&this!==kt&&this instanceof a?r:e,this,c)}}(e,t,u):t!=T&&t!=(_|T)||a.length?fo.apply(o,b):function(e,t,n,r){var o=t&_,a=uo(e);return function t(){for(var s=-1,c=arguments.length,l=-1,u=r.length,d=i(u+c),p=this&&this!==kt&&this instanceof t?a:e;++l<u;)d[l]=r[l];for(;c--;)d[l++]=arguments[++s];return qt(p,o?n:this,d)}}(e,t,n,r);else var O=function(e,t,n){var i=t&_,r=uo(e);return function t(){return(this&&this!==kt&&this instanceof t?r:e).apply(i?n:this,arguments)}}(e,t,n);return aa((m?Or:ia)(O,b),e,t)}function bo(e,t,n,i){return e===o||hs(e,st[n])&&!ut.call(i,n)?t:e}function Oo(e,t,n,i,r,a){return Os(e)&&Os(t)&&(a.set(t,e),gr(e,t,o,Oo,a),a.delete(t)),e}function Ro(e){return ws(e)?o:e}function Po(e,t,n,i,r,a){var s=n&g,c=e.length,l=t.length;if(c!=l&&!(s&&l>c))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var d=-1,p=!0,h=n&m?new Ei:o;for(a.set(e,t),a.set(t,e);++d<c;){var f=e[d],_=t[d];if(i)var v=s?i(_,f,d,t,e,a):i(f,_,d,e,t,a);if(v!==o){if(v)continue;p=!1;break}if(h){if(!rn(t,function(e,t){if(!yn(h,t)&&(f===e||r(f,e,n,i,a)))return h.push(t)})){p=!1;break}}else if(f!==_&&!r(f,_,n,i,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function No(e){return oa(ea(e,o,va),e+"")}function wo(e){return Qi(e,rc,Go)}function Mo(e){return Qi(e,oc,jo)}var ko=ii?function(e){return ii.get(e)}:Lc;function Do(e){for(var t=e.name+"",n=ri[t],i=ut.call(ri,t)?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==e)return r.name}return t}function Lo(e){return(ut.call(hi,"placeholder")?hi:e).placeholder}function Uo(){var e=hi.iteratee||wc;return e=e===wc?cr:e,arguments.length?e(arguments[0],arguments[1]):e}function xo(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function Fo(e){for(var t=rc(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,$o(r)]}return t}function Ho(e,t){var n=function(e,t){return null==e?o:e[t]}(e,t);return sr(n)?n:o}var Go=Gn?function(e){return null==e?[]:(e=tt(e),Xt(Gn(e),function(t){return Dt.call(e,t)}))}:Bc,jo=Gn?function(e){for(var t=[];e;)en(t,Go(e)),e=wt(e);return t}:Bc,Bo=$i;function Vo(e,t,n){for(var i=-1,r=(t=zr(t,e)).length,o=!1;++i<r;){var a=ua(t[i]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++i!=r?o:!!(r=null==e?0:e.length)&&bs(r)&&zo(a,r)&&(_s(e)||ms(e))}function Wo(e){return"function"!=typeof e.constructor||Qo(e)?{}:fi(wt(e))}function qo(e){return _s(e)||ms(e)||!!(xt&&e&&e[xt])}function zo(e,t){var n=typeof e;return!!(t=null==t?D:t)&&("number"==n||"symbol"!=n&&Ye.test(e))&&e>-1&&e%1==0&&e<t}function Ko(e,t,n){if(!Os(n))return!1;var i=typeof t;return!!("number"==i?ys(n)&&zo(t,n.length):"string"==i&&t in n)&&hs(n[t],e)}function Yo(e,t){if(_s(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ls(e))||Ne.test(e)||!Pe.test(e)||null!=t&&e in tt(t)}function Jo(e){var t=Do(e),n=hi[t];if("function"!=typeof n||!(t in _i.prototype))return!1;if(e===n)return!0;var i=ko(n);return!!i&&e===i[0]}(Qn&&Bo(new Qn(new ArrayBuffer(1)))!=le||$n&&Bo(new $n)!=X||Zn&&"[object Promise]"!=Bo(Zn.resolve())||ei&&Bo(new ei)!=ne||ti&&Bo(new ti)!=ae)&&(Bo=function(e){var t=$i(e),n=t==Z?e.constructor:o,i=n?da(n):"";if(i)switch(i){case oi:return le;case ai:return X;case si:return"[object Promise]";case ci:return ne;case li:return ae}return t});var Xo=ct?Is:Vc;function Qo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||st)}function $o(e){return e==e&&!Os(e)}function Zo(e,t){return function(n){return null!=n&&n[e]===t&&(t!==o||e in tt(n))}}function ea(e,t,n){return t=qn(t===o?e.length-1:t,0),function(){for(var r=arguments,o=-1,a=qn(r.length-t,0),s=i(a);++o<a;)s[o]=r[t+o];o=-1;for(var c=i(t+1);++o<t;)c[o]=r[o];return c[t]=n(s),qt(e,this,c)}}function ta(e,t){return t.length<2?e:Xi(e,Nr(t,0,-1))}function na(e,t){if("__proto__"!=t)return e[t]}var ia=sa(Or),ra=xn||function(e,t){return kt.setTimeout(e,t)},oa=sa(Rr);function aa(e,t,n){var i=t+"";return oa(e,function(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(xe,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return Kt(G,function(n){var i="_."+n[0];t&n[1]&&!Qt(e,i)&&e.push(i)}),e.sort()}(function(e){var t=e.match(Fe);return t?t[1].split(He):[]}(i),n)))}function sa(e){var t=0,n=0;return function(){var i=Kn(),r=N-(i-n);if(n=i,r>0){if(++t>=P)return arguments[0]}else t=0;return e.apply(o,arguments)}}function ca(e,t){var n=-1,i=e.length,r=i-1;for(t=t===o?i:t;++n<t;){var a=Er(n,r),s=e[a];e[a]=e[n],e[n]=s}return e.length=t,e}var la=function(e){var t=ss(e,function(e){return n.size===u&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(we,function(e,n,i,r){t.push(i?r.replace(je,"$1"):n||e)}),t});function ua(e){if("string"==typeof e||Ls(e))return e;var t=e+"";return"0"==t&&1/e==-k?"-0":t}function da(e){if(null!=e){try{return lt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function pa(e){if(e instanceof _i)return e.clone();var t=new mi(e.__wrapped__,e.__chain__);return t.__actions__=no(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ha=Cr(function(e,t){return Ss(e)?Fi(e,Wi(t,1,Ss,!0)):[]}),fa=Cr(function(e,t){var n=Ca(t);return Ss(n)&&(n=o),Ss(e)?Fi(e,Wi(t,1,Ss,!0),Uo(n,2)):[]}),ga=Cr(function(e,t){var n=Ca(t);return Ss(n)&&(n=o),Ss(e)?Fi(e,Wi(t,1,Ss,!0),o,n):[]});function ma(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:js(n);return r<0&&(r=qn(i+r,0)),sn(e,Uo(t,3),r)}function _a(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i-1;return n!==o&&(r=js(n),r=n<0?qn(i+r,0):zn(r,i-1)),sn(e,Uo(t,3),r,!0)}function va(e){return null!=e&&e.length?Wi(e,1):[]}function ya(e){return e&&e.length?e[0]:o}var Sa=Cr(function(e){var t=Zt(e,Wr);return t.length&&t[0]===e[0]?nr(t):[]}),Ea=Cr(function(e){var t=Ca(e),n=Zt(e,Wr);return t===Ca(n)?t=o:n.pop(),n.length&&n[0]===e[0]?nr(n,Uo(t,2)):[]}),Ta=Cr(function(e){var t=Ca(e),n=Zt(e,Wr);return(t="function"==typeof t?t:o)&&n.pop(),n.length&&n[0]===e[0]?nr(n,o,t):[]});function Ca(e){var t=null==e?0:e.length;return t?e[t-1]:o}var Ia=Cr(Aa);function Aa(e,t){return e&&e.length&&t&&t.length?yr(e,t):e}var ba=No(function(e,t){var n=null==e?0:e.length,i=ki(e,t);return Sr(e,Zt(t,function(e){return zo(e,n)?+e:e}).sort(Zr)),i});function Oa(e){return null==e?e:Xn.call(e)}var Ra=Cr(function(e){return xr(Wi(e,1,Ss,!0))}),Pa=Cr(function(e){var t=Ca(e);return Ss(t)&&(t=o),xr(Wi(e,1,Ss,!0),Uo(t,2))}),Na=Cr(function(e){var t=Ca(e);return t="function"==typeof t?t:o,xr(Wi(e,1,Ss,!0),o,t)});function wa(e){if(!e||!e.length)return[];var t=0;return e=Xt(e,function(e){if(Ss(e))return t=qn(e.length,t),!0}),mn(t,function(t){return Zt(e,pn(t))})}function Ma(e,t){if(!e||!e.length)return[];var n=wa(e);return null==t?n:Zt(n,function(e){return qt(t,o,e)})}var ka=Cr(function(e,t){return Ss(e)?Fi(e,t):[]}),Da=Cr(function(e){return Br(Xt(e,Ss))}),La=Cr(function(e){var t=Ca(e);return Ss(t)&&(t=o),Br(Xt(e,Ss),Uo(t,2))}),Ua=Cr(function(e){var t=Ca(e);return t="function"==typeof t?t:o,Br(Xt(e,Ss),o,t)}),xa=Cr(wa);var Fa=Cr(function(e){var t=e.length,n=t>1?e[t-1]:o;return Ma(e,n="function"==typeof n?(e.pop(),n):o)});function Ha(e){var t=hi(e);return t.__chain__=!0,t}function Ga(e,t){return t(e)}var ja=No(function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,r=function(t){return ki(t,e)};return!(t>1||this.__actions__.length)&&i instanceof _i&&zo(n)?((i=i.slice(n,+n+(t?1:0))).__actions__.push({func:Ga,args:[r],thisArg:o}),new mi(i,this.__chain__).thru(function(e){return t&&!e.length&&e.push(o),e})):this.thru(r)});var Ba=ro(function(e,t,n){ut.call(e,n)?++e[n]:Mi(e,n,1)});var Va=po(ma),Wa=po(_a);function qa(e,t){return(_s(e)?Kt:Hi)(e,Uo(t,3))}function za(e,t){return(_s(e)?Yt:Gi)(e,Uo(t,3))}var Ka=ro(function(e,t,n){ut.call(e,n)?e[n].push(t):Mi(e,n,[t])});var Ya=Cr(function(e,t,n){var r=-1,o="function"==typeof t,a=ys(e)?i(e.length):[];return Hi(e,function(e){a[++r]=o?qt(t,e,n):ir(e,t,n)}),a}),Ja=ro(function(e,t,n){Mi(e,n,t)});function Xa(e,t){return(_s(e)?Zt:pr)(e,Uo(t,3))}var Qa=ro(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});var $a=Cr(function(e,t){if(null==e)return[];var n=t.length;return n>1&&Ko(e,t[0],t[1])?t=[]:n>2&&Ko(t[0],t[1],t[2])&&(t=[t[0]]),_r(e,Wi(t,1),[])}),Za=Un||function(){return kt.Date.now()};function es(e,t,n){return t=n?o:t,t=e&&null==t?e.length:t,Ao(e,I,o,o,o,o,t)}function ts(e,t){var n;if("function"!=typeof t)throw new rt(c);return e=js(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=o),n}}var ns=Cr(function(e,t,n){var i=_;if(n.length){var r=Rn(n,Lo(ns));i|=T}return Ao(e,i,t,n,r)}),is=Cr(function(e,t,n){var i=_|v;if(n.length){var r=Rn(n,Lo(is));i|=T}return Ao(t,i,e,n,r)});function rs(e,t,n){var i,r,a,s,l,u,d=0,p=!1,h=!1,f=!0;if("function"!=typeof e)throw new rt(c);function g(t){var n=i,a=r;return i=r=o,d=t,s=e.apply(a,n)}function m(e){var n=e-u;return u===o||n>=t||n<0||h&&e-d>=a}function _(){var e=Za();if(m(e))return v(e);l=ra(_,function(e){var n=t-(e-u);return h?zn(n,a-(e-d)):n}(e))}function v(e){return l=o,f&&i?g(e):(i=r=o,s)}function y(){var e=Za(),n=m(e);if(i=arguments,r=this,u=e,n){if(l===o)return function(e){return d=e,l=ra(_,t),p?g(e):s}(u);if(h)return l=ra(_,t),g(u)}return l===o&&(l=ra(_,t)),s}return t=Vs(t)||0,Os(n)&&(p=!!n.leading,a=(h="maxWait"in n)?qn(Vs(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),y.cancel=function(){l!==o&&Jr(l),d=0,i=u=r=l=o},y.flush=function(){return l===o?s:v(Za())},y}var os=Cr(function(e,t){return xi(e,1,t)}),as=Cr(function(e,t,n){return xi(e,Vs(t)||0,n)});function ss(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new rt(c);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=e.apply(this,i);return n.cache=o.set(r,a)||o,a};return n.cache=new(ss.Cache||Si),n}function cs(e){if("function"!=typeof e)throw new rt(c);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}ss.Cache=Si;var ls=Kr(function(e,t){var n=(t=1==t.length&&_s(t[0])?Zt(t[0],_n(Uo())):Zt(Wi(t,1),_n(Uo()))).length;return Cr(function(i){for(var r=-1,o=zn(i.length,n);++r<o;)i[r]=t[r].call(this,i[r]);return qt(e,this,i)})}),us=Cr(function(e,t){var n=Rn(t,Lo(us));return Ao(e,T,o,t,n)}),ds=Cr(function(e,t){var n=Rn(t,Lo(ds));return Ao(e,C,o,t,n)}),ps=No(function(e,t){return Ao(e,A,o,o,o,t)});function hs(e,t){return e===t||e!=e&&t!=t}var fs=So(Zi),gs=So(function(e,t){return e>=t}),ms=rr(function(){return arguments}())?rr:function(e){return Rs(e)&&ut.call(e,"callee")&&!Dt.call(e,"callee")},_s=i.isArray,vs=Ht?_n(Ht):function(e){return Rs(e)&&$i(e)==ce};function ys(e){return null!=e&&bs(e.length)&&!Is(e)}function Ss(e){return Rs(e)&&ys(e)}var Es=jn||Vc,Ts=Gt?_n(Gt):function(e){return Rs(e)&&$i(e)==q};function Cs(e){if(!Rs(e))return!1;var t=$i(e);return t==K||t==z||"string"==typeof e.message&&"string"==typeof e.name&&!ws(e)}function Is(e){if(!Os(e))return!1;var t=$i(e);return t==Y||t==J||t==V||t==ee}function As(e){return"number"==typeof e&&e==js(e)}function bs(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=D}function Os(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Rs(e){return null!=e&&"object"==typeof e}var Ps=jt?_n(jt):function(e){return Rs(e)&&Bo(e)==X};function Ns(e){return"number"==typeof e||Rs(e)&&$i(e)==Q}function ws(e){if(!Rs(e)||$i(e)!=Z)return!1;var t=wt(e);if(null===t)return!0;var n=ut.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&lt.call(n)==ft}var Ms=Bt?_n(Bt):function(e){return Rs(e)&&$i(e)==te};var ks=Vt?_n(Vt):function(e){return Rs(e)&&Bo(e)==ne};function Ds(e){return"string"==typeof e||!_s(e)&&Rs(e)&&$i(e)==ie}function Ls(e){return"symbol"==typeof e||Rs(e)&&$i(e)==re}var Us=Wt?_n(Wt):function(e){return Rs(e)&&bs(e.length)&&!!bt[$i(e)]};var xs=So(dr),Fs=So(function(e,t){return e<=t});function Hs(e){if(!e)return[];if(ys(e))return Ds(e)?Mn(e):no(e);if(Ft&&e[Ft])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Ft]());var t=Bo(e);return(t==X?bn:t==ne?Pn:hc)(e)}function Gs(e){return e?(e=Vs(e))===k||e===-k?(e<0?-1:1)*L:e==e?e:0:0===e?e:0}function js(e){var t=Gs(e),n=t%1;return t==t?n?t-n:t:0}function Bs(e){return e?Di(js(e),0,x):0}function Vs(e){if("number"==typeof e)return e;if(Ls(e))return U;if(Os(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Os(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(De,"");var n=qe.test(e);return n||Ke.test(e)?Nt(e.slice(2),n?2:8):We.test(e)?U:+e}function Ws(e){return io(e,oc(e))}function qs(e){return null==e?"":Ur(e)}var zs=oo(function(e,t){if(Qo(t)||ys(t))io(t,rc(t),e);else for(var n in t)ut.call(t,n)&&Ri(e,n,t[n])}),Ks=oo(function(e,t){io(t,oc(t),e)}),Ys=oo(function(e,t,n,i){io(t,oc(t),e,i)}),Js=oo(function(e,t,n,i){io(t,rc(t),e,i)}),Xs=No(ki);var Qs=Cr(function(e,t){e=tt(e);var n=-1,i=t.length,r=i>2?t[2]:o;for(r&&Ko(t[0],t[1],r)&&(i=1);++n<i;)for(var a=t[n],s=oc(a),c=-1,l=s.length;++c<l;){var u=s[c],d=e[u];(d===o||hs(d,st[u])&&!ut.call(e,u))&&(e[u]=a[u])}return e}),$s=Cr(function(e){return e.push(o,Oo),qt(sc,o,e)});function Zs(e,t,n){var i=null==e?o:Xi(e,t);return i===o?n:i}function ec(e,t){return null!=e&&Vo(e,t,tr)}var tc=go(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ht.call(t)),e[t]=n},Oc(Nc)),nc=go(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ht.call(t)),ut.call(e,t)?e[t].push(n):e[t]=[n]},Uo),ic=Cr(ir);function rc(e){return ys(e)?Ci(e):lr(e)}function oc(e){return ys(e)?Ci(e,!0):ur(e)}var ac=oo(function(e,t,n){gr(e,t,n)}),sc=oo(function(e,t,n,i){gr(e,t,n,i)}),cc=No(function(e,t){var n={};if(null==e)return n;var i=!1;t=Zt(t,function(t){return t=zr(t,e),i||(i=t.length>1),t}),io(e,Mo(e),n),i&&(n=Li(n,p|h|f,Ro));for(var r=t.length;r--;)Fr(n,t[r]);return n});var lc=No(function(e,t){return null==e?{}:function(e,t){return vr(e,t,function(t,n){return ec(e,n)})}(e,t)});function uc(e,t){if(null==e)return{};var n=Zt(Mo(e),function(e){return[e]});return t=Uo(t),vr(e,n,function(e,n){return t(e,n[0])})}var dc=Io(rc),pc=Io(oc);function hc(e){return null==e?[]:vn(e,rc(e))}var fc=lo(function(e,t,n){return t=t.toLowerCase(),e+(n?gc(t):t)});function gc(e){return Cc(qs(e).toLowerCase())}function mc(e){return(e=qs(e))&&e.replace(Je,Tn).replace(yt,"")}var _c=lo(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),vc=lo(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),yc=co("toLowerCase");var Sc=lo(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});var Ec=lo(function(e,t,n){return e+(n?" ":"")+Cc(t)});var Tc=lo(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Cc=co("toUpperCase");function Ic(e,t,n){return e=qs(e),(t=n?o:t)===o?function(e){return Ct.test(e)}(e)?function(e){return e.match(Et)||[]}(e):function(e){return e.match(Ge)||[]}(e):e.match(t)||[]}var Ac=Cr(function(e,t){try{return qt(e,o,t)}catch(e){return Cs(e)?e:new $e(e)}}),bc=No(function(e,t){return Kt(t,function(t){t=ua(t),Mi(e,t,ns(e[t],e))}),e});function Oc(e){return function(){return e}}var Rc=ho(),Pc=ho(!0);function Nc(e){return e}function wc(e){return cr("function"==typeof e?e:Li(e,p))}var Mc=Cr(function(e,t){return function(n){return ir(n,e,t)}}),kc=Cr(function(e,t){return function(n){return ir(e,n,t)}});function Dc(e,t,n){var i=rc(t),r=Ji(t,i);null!=n||Os(t)&&(r.length||!i.length)||(n=t,t=e,e=this,r=Ji(t,rc(t)));var o=!(Os(n)&&"chain"in n&&!n.chain),a=Is(e);return Kt(r,function(n){var i=t[n];e[n]=i,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__);return(n.__actions__=no(this.__actions__)).push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,en([this.value()],arguments))})}),e}function Lc(){}var Uc=_o(Zt),xc=_o(Jt),Fc=_o(rn);function Hc(e){return Yo(e)?pn(ua(e)):function(e){return function(t){return Xi(t,e)}}(e)}var Gc=yo(),jc=yo(!0);function Bc(){return[]}function Vc(){return!1}var Wc=mo(function(e,t){return e+t},0),qc=To("ceil"),zc=mo(function(e,t){return e/t},1),Kc=To("floor");var Yc,Jc=mo(function(e,t){return e*t},1),Xc=To("round"),Qc=mo(function(e,t){return e-t},0);return hi.after=function(e,t){if("function"!=typeof t)throw new rt(c);return e=js(e),function(){if(--e<1)return t.apply(this,arguments)}},hi.ary=es,hi.assign=zs,hi.assignIn=Ks,hi.assignInWith=Ys,hi.assignWith=Js,hi.at=Xs,hi.before=ts,hi.bind=ns,hi.bindAll=bc,hi.bindKey=is,hi.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return _s(e)?e:[e]},hi.chain=Ha,hi.chunk=function(e,t,n){t=(n?Ko(e,t,n):t===o)?1:qn(js(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var a=0,s=0,c=i(Fn(r/t));a<r;)c[s++]=Nr(e,a,a+=t);return c},hi.compact=function(e){for(var t=-1,n=null==e?0:e.length,i=0,r=[];++t<n;){var o=e[t];o&&(r[i++]=o)}return r},hi.concat=function(){var e=arguments.length;if(!e)return[];for(var t=i(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return en(_s(n)?no(n):[n],Wi(t,1))},hi.cond=function(e){var t=null==e?0:e.length,n=Uo();return e=t?Zt(e,function(e){if("function"!=typeof e[1])throw new rt(c);return[n(e[0]),e[1]]}):[],Cr(function(n){for(var i=-1;++i<t;){var r=e[i];if(qt(r[0],this,n))return qt(r[1],this,n)}})},hi.conforms=function(e){return function(e){var t=rc(e);return function(n){return Ui(n,e,t)}}(Li(e,p))},hi.constant=Oc,hi.countBy=Ba,hi.create=function(e,t){var n=fi(e);return null==t?n:wi(n,t)},hi.curry=function e(t,n,i){var r=Ao(t,S,o,o,o,o,o,n=i?o:n);return r.placeholder=e.placeholder,r},hi.curryRight=function e(t,n,i){var r=Ao(t,E,o,o,o,o,o,n=i?o:n);return r.placeholder=e.placeholder,r},hi.debounce=rs,hi.defaults=Qs,hi.defaultsDeep=$s,hi.defer=os,hi.delay=as,hi.difference=ha,hi.differenceBy=fa,hi.differenceWith=ga,hi.drop=function(e,t,n){var i=null==e?0:e.length;return i?Nr(e,(t=n||t===o?1:js(t))<0?0:t,i):[]},hi.dropRight=function(e,t,n){var i=null==e?0:e.length;return i?Nr(e,0,(t=i-(t=n||t===o?1:js(t)))<0?0:t):[]},hi.dropRightWhile=function(e,t){return e&&e.length?Gr(e,Uo(t,3),!0,!0):[]},hi.dropWhile=function(e,t){return e&&e.length?Gr(e,Uo(t,3),!0):[]},hi.fill=function(e,t,n,i){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Ko(e,t,n)&&(n=0,i=r),function(e,t,n,i){var r=e.length;for((n=js(n))<0&&(n=-n>r?0:r+n),(i=i===o||i>r?r:js(i))<0&&(i+=r),i=n>i?0:Bs(i);n<i;)e[n++]=t;return e}(e,t,n,i)):[]},hi.filter=function(e,t){return(_s(e)?Xt:Vi)(e,Uo(t,3))},hi.flatMap=function(e,t){return Wi(Xa(e,t),1)},hi.flatMapDeep=function(e,t){return Wi(Xa(e,t),k)},hi.flatMapDepth=function(e,t,n){return n=n===o?1:js(n),Wi(Xa(e,t),n)},hi.flatten=va,hi.flattenDeep=function(e){return null!=e&&e.length?Wi(e,k):[]},hi.flattenDepth=function(e,t){return null!=e&&e.length?Wi(e,t=t===o?1:js(t)):[]},hi.flip=function(e){return Ao(e,b)},hi.flow=Rc,hi.flowRight=Pc,hi.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var r=e[t];i[r[0]]=r[1]}return i},hi.functions=function(e){return null==e?[]:Ji(e,rc(e))},hi.functionsIn=function(e){return null==e?[]:Ji(e,oc(e))},hi.groupBy=Ka,hi.initial=function(e){return null!=e&&e.length?Nr(e,0,-1):[]},hi.intersection=Sa,hi.intersectionBy=Ea,hi.intersectionWith=Ta,hi.invert=tc,hi.invertBy=nc,hi.invokeMap=Ya,hi.iteratee=wc,hi.keyBy=Ja,hi.keys=rc,hi.keysIn=oc,hi.map=Xa,hi.mapKeys=function(e,t){var n={};return t=Uo(t,3),Ki(e,function(e,i,r){Mi(n,t(e,i,r),e)}),n},hi.mapValues=function(e,t){var n={};return t=Uo(t,3),Ki(e,function(e,i,r){Mi(n,i,t(e,i,r))}),n},hi.matches=function(e){return hr(Li(e,p))},hi.matchesProperty=function(e,t){return fr(e,Li(t,p))},hi.memoize=ss,hi.merge=ac,hi.mergeWith=sc,hi.method=Mc,hi.methodOf=kc,hi.mixin=Dc,hi.negate=cs,hi.nthArg=function(e){return e=js(e),Cr(function(t){return mr(t,e)})},hi.omit=cc,hi.omitBy=function(e,t){return uc(e,cs(Uo(t)))},hi.once=function(e){return ts(2,e)},hi.orderBy=function(e,t,n,i){return null==e?[]:(_s(t)||(t=null==t?[]:[t]),_s(n=i?o:n)||(n=null==n?[]:[n]),_r(e,t,n))},hi.over=Uc,hi.overArgs=ls,hi.overEvery=xc,hi.overSome=Fc,hi.partial=us,hi.partialRight=ds,hi.partition=Qa,hi.pick=lc,hi.pickBy=uc,hi.property=Hc,hi.propertyOf=function(e){return function(t){return null==e?o:Xi(e,t)}},hi.pull=Ia,hi.pullAll=Aa,hi.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?yr(e,t,Uo(n,2)):e},hi.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?yr(e,t,o,n):e},hi.pullAt=ba,hi.range=Gc,hi.rangeRight=jc,hi.rearg=ps,hi.reject=function(e,t){return(_s(e)?Xt:Vi)(e,cs(Uo(t,3)))},hi.remove=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,r=[],o=e.length;for(t=Uo(t,3);++i<o;){var a=e[i];t(a,i,e)&&(n.push(a),r.push(i))}return Sr(e,r),n},hi.rest=function(e,t){if("function"!=typeof e)throw new rt(c);return Cr(e,t=t===o?t:js(t))},hi.reverse=Oa,hi.sampleSize=function(e,t,n){return t=(n?Ko(e,t,n):t===o)?1:js(t),(_s(e)?Ai:Ar)(e,t)},hi.set=function(e,t,n){return null==e?e:br(e,t,n)},hi.setWith=function(e,t,n,i){return i="function"==typeof i?i:o,null==e?e:br(e,t,n,i)},hi.shuffle=function(e){return(_s(e)?bi:Pr)(e)},hi.slice=function(e,t,n){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&Ko(e,t,n)?(t=0,n=i):(t=null==t?0:js(t),n=n===o?i:js(n)),Nr(e,t,n)):[]},hi.sortBy=$a,hi.sortedUniq=function(e){return e&&e.length?Dr(e):[]},hi.sortedUniqBy=function(e,t){return e&&e.length?Dr(e,Uo(t,2)):[]},hi.split=function(e,t,n){return n&&"number"!=typeof n&&Ko(e,t,n)&&(t=n=o),(n=n===o?x:n>>>0)?(e=qs(e))&&("string"==typeof t||null!=t&&!Ms(t))&&!(t=Ur(t))&&An(e)?Yr(Mn(e),0,n):e.split(t,n):[]},hi.spread=function(e,t){if("function"!=typeof e)throw new rt(c);return t=null==t?0:qn(js(t),0),Cr(function(n){var i=n[t],r=Yr(n,0,t);return i&&en(r,i),qt(e,this,r)})},hi.tail=function(e){var t=null==e?0:e.length;return t?Nr(e,1,t):[]},hi.take=function(e,t,n){return e&&e.length?Nr(e,0,(t=n||t===o?1:js(t))<0?0:t):[]},hi.takeRight=function(e,t,n){var i=null==e?0:e.length;return i?Nr(e,(t=i-(t=n||t===o?1:js(t)))<0?0:t,i):[]},hi.takeRightWhile=function(e,t){return e&&e.length?Gr(e,Uo(t,3),!1,!0):[]},hi.takeWhile=function(e,t){return e&&e.length?Gr(e,Uo(t,3)):[]},hi.tap=function(e,t){return t(e),e},hi.throttle=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new rt(c);return Os(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),rs(e,t,{leading:i,maxWait:t,trailing:r})},hi.thru=Ga,hi.toArray=Hs,hi.toPairs=dc,hi.toPairsIn=pc,hi.toPath=function(e){return _s(e)?Zt(e,ua):Ls(e)?[e]:no(la(qs(e)))},hi.toPlainObject=Ws,hi.transform=function(e,t,n){var i=_s(e),r=i||Es(e)||Us(e);if(t=Uo(t,4),null==n){var o=e&&e.constructor;n=r?i?new o:[]:Os(e)&&Is(o)?fi(wt(e)):{}}return(r?Kt:Ki)(e,function(e,i,r){return t(n,e,i,r)}),n},hi.unary=function(e){return es(e,1)},hi.union=Ra,hi.unionBy=Pa,hi.unionWith=Na,hi.uniq=function(e){return e&&e.length?xr(e):[]},hi.uniqBy=function(e,t){return e&&e.length?xr(e,Uo(t,2)):[]},hi.uniqWith=function(e,t){return t="function"==typeof t?t:o,e&&e.length?xr(e,o,t):[]},hi.unset=function(e,t){return null==e||Fr(e,t)},hi.unzip=wa,hi.unzipWith=Ma,hi.update=function(e,t,n){return null==e?e:Hr(e,t,qr(n))},hi.updateWith=function(e,t,n,i){return i="function"==typeof i?i:o,null==e?e:Hr(e,t,qr(n),i)},hi.values=hc,hi.valuesIn=function(e){return null==e?[]:vn(e,oc(e))},hi.without=ka,hi.words=Ic,hi.wrap=function(e,t){return us(qr(t),e)},hi.xor=Da,hi.xorBy=La,hi.xorWith=Ua,hi.zip=xa,hi.zipObject=function(e,t){return Vr(e||[],t||[],Ri)},hi.zipObjectDeep=function(e,t){return Vr(e||[],t||[],br)},hi.zipWith=Fa,hi.entries=dc,hi.entriesIn=pc,hi.extend=Ks,hi.extendWith=Ys,Dc(hi,hi),hi.add=Wc,hi.attempt=Ac,hi.camelCase=fc,hi.capitalize=gc,hi.ceil=qc,hi.clamp=function(e,t,n){return n===o&&(n=t,t=o),n!==o&&(n=(n=Vs(n))==n?n:0),t!==o&&(t=(t=Vs(t))==t?t:0),Di(Vs(e),t,n)},hi.clone=function(e){return Li(e,f)},hi.cloneDeep=function(e){return Li(e,p|f)},hi.cloneDeepWith=function(e,t){return Li(e,p|f,t="function"==typeof t?t:o)},hi.cloneWith=function(e,t){return Li(e,f,t="function"==typeof t?t:o)},hi.conformsTo=function(e,t){return null==t||Ui(e,t,rc(t))},hi.deburr=mc,hi.defaultTo=function(e,t){return null==e||e!=e?t:e},hi.divide=zc,hi.endsWith=function(e,t,n){e=qs(e),t=Ur(t);var i=e.length,r=n=n===o?i:Di(js(n),0,i);return(n-=t.length)>=0&&e.slice(n,r)==t},hi.eq=hs,hi.escape=function(e){return(e=qs(e))&&Ae.test(e)?e.replace(Ce,Cn):e},hi.escapeRegExp=function(e){return(e=qs(e))&&ke.test(e)?e.replace(Me,"\\$&"):e},hi.every=function(e,t,n){var i=_s(e)?Jt:ji;return n&&Ko(e,t,n)&&(t=o),i(e,Uo(t,3))},hi.find=Va,hi.findIndex=ma,hi.findKey=function(e,t){return an(e,Uo(t,3),Ki)},hi.findLast=Wa,hi.findLastIndex=_a,hi.findLastKey=function(e,t){return an(e,Uo(t,3),Yi)},hi.floor=Kc,hi.forEach=qa,hi.forEachRight=za,hi.forIn=function(e,t){return null==e?e:qi(e,Uo(t,3),oc)},hi.forInRight=function(e,t){return null==e?e:zi(e,Uo(t,3),oc)},hi.forOwn=function(e,t){return e&&Ki(e,Uo(t,3))},hi.forOwnRight=function(e,t){return e&&Yi(e,Uo(t,3))},hi.get=Zs,hi.gt=fs,hi.gte=gs,hi.has=function(e,t){return null!=e&&Vo(e,t,er)},hi.hasIn=ec,hi.head=ya,hi.identity=Nc,hi.includes=function(e,t,n,i){e=ys(e)?e:hc(e),n=n&&!i?js(n):0;var r=e.length;return n<0&&(n=qn(r+n,0)),Ds(e)?n<=r&&e.indexOf(t,n)>-1:!!r&&cn(e,t,n)>-1},hi.indexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:js(n);return r<0&&(r=qn(i+r,0)),cn(e,t,r)},hi.inRange=function(e,t,n){return t=Gs(t),n===o?(n=t,t=0):n=Gs(n),function(e,t,n){return e>=zn(t,n)&&e<qn(t,n)}(e=Vs(e),t,n)},hi.invoke=ic,hi.isArguments=ms,hi.isArray=_s,hi.isArrayBuffer=vs,hi.isArrayLike=ys,hi.isArrayLikeObject=Ss,hi.isBoolean=function(e){return!0===e||!1===e||Rs(e)&&$i(e)==W},hi.isBuffer=Es,hi.isDate=Ts,hi.isElement=function(e){return Rs(e)&&1===e.nodeType&&!ws(e)},hi.isEmpty=function(e){if(null==e)return!0;if(ys(e)&&(_s(e)||"string"==typeof e||"function"==typeof e.splice||Es(e)||Us(e)||ms(e)))return!e.length;var t=Bo(e);if(t==X||t==ne)return!e.size;if(Qo(e))return!lr(e).length;for(var n in e)if(ut.call(e,n))return!1;return!0},hi.isEqual=function(e,t){return or(e,t)},hi.isEqualWith=function(e,t,n){var i=(n="function"==typeof n?n:o)?n(e,t):o;return i===o?or(e,t,o,n):!!i},hi.isError=Cs,hi.isFinite=function(e){return"number"==typeof e&&Bn(e)},hi.isFunction=Is,hi.isInteger=As,hi.isLength=bs,hi.isMap=Ps,hi.isMatch=function(e,t){return e===t||ar(e,t,Fo(t))},hi.isMatchWith=function(e,t,n){return n="function"==typeof n?n:o,ar(e,t,Fo(t),n)},hi.isNaN=function(e){return Ns(e)&&e!=+e},hi.isNative=function(e){if(Xo(e))throw new $e(s);return sr(e)},hi.isNil=function(e){return null==e},hi.isNull=function(e){return null===e},hi.isNumber=Ns,hi.isObject=Os,hi.isObjectLike=Rs,hi.isPlainObject=ws,hi.isRegExp=Ms,hi.isSafeInteger=function(e){return As(e)&&e>=-D&&e<=D},hi.isSet=ks,hi.isString=Ds,hi.isSymbol=Ls,hi.isTypedArray=Us,hi.isUndefined=function(e){return e===o},hi.isWeakMap=function(e){return Rs(e)&&Bo(e)==ae},hi.isWeakSet=function(e){return Rs(e)&&$i(e)==se},hi.join=function(e,t){return null==e?"":Vn.call(e,t)},hi.kebabCase=_c,hi.last=Ca,hi.lastIndexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i;return n!==o&&(r=(r=js(n))<0?qn(i+r,0):zn(r,i-1)),t==t?function(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}(e,t,r):sn(e,un,r,!0)},hi.lowerCase=vc,hi.lowerFirst=yc,hi.lt=xs,hi.lte=Fs,hi.max=function(e){return e&&e.length?Bi(e,Nc,Zi):o},hi.maxBy=function(e,t){return e&&e.length?Bi(e,Uo(t,2),Zi):o},hi.mean=function(e){return dn(e,Nc)},hi.meanBy=function(e,t){return dn(e,Uo(t,2))},hi.min=function(e){return e&&e.length?Bi(e,Nc,dr):o},hi.minBy=function(e,t){return e&&e.length?Bi(e,Uo(t,2),dr):o},hi.stubArray=Bc,hi.stubFalse=Vc,hi.stubObject=function(){return{}},hi.stubString=function(){return""},hi.stubTrue=function(){return!0},hi.multiply=Jc,hi.nth=function(e,t){return e&&e.length?mr(e,js(t)):o},hi.noConflict=function(){return kt._===this&&(kt._=gt),this},hi.noop=Lc,hi.now=Za,hi.pad=function(e,t,n){e=qs(e);var i=(t=js(t))?wn(e):0;if(!t||i>=t)return e;var r=(t-i)/2;return vo(Hn(r),n)+e+vo(Fn(r),n)},hi.padEnd=function(e,t,n){e=qs(e);var i=(t=js(t))?wn(e):0;return t&&i<t?e+vo(t-i,n):e},hi.padStart=function(e,t,n){e=qs(e);var i=(t=js(t))?wn(e):0;return t&&i<t?vo(t-i,n)+e:e},hi.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Yn(qs(e).replace(Le,""),t||0)},hi.random=function(e,t,n){if(n&&"boolean"!=typeof n&&Ko(e,t,n)&&(t=n=o),n===o&&("boolean"==typeof t?(n=t,t=o):"boolean"==typeof e&&(n=e,e=o)),e===o&&t===o?(e=0,t=1):(e=Gs(e),t===o?(t=e,e=0):t=Gs(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var r=Jn();return zn(e+r*(t-e+Pt("1e-"+((r+"").length-1))),t)}return Er(e,t)},hi.reduce=function(e,t,n){var i=_s(e)?tn:fn,r=arguments.length<3;return i(e,Uo(t,4),n,r,Hi)},hi.reduceRight=function(e,t,n){var i=_s(e)?nn:fn,r=arguments.length<3;return i(e,Uo(t,4),n,r,Gi)},hi.repeat=function(e,t,n){return t=(n?Ko(e,t,n):t===o)?1:js(t),Tr(qs(e),t)},hi.replace=function(){var e=arguments,t=qs(e[0]);return e.length<3?t:t.replace(e[1],e[2])},hi.result=function(e,t,n){var i=-1,r=(t=zr(t,e)).length;for(r||(r=1,e=o);++i<r;){var a=null==e?o:e[ua(t[i])];a===o&&(i=r,a=n),e=Is(a)?a.call(e):a}return e},hi.round=Xc,hi.runInContext=e,hi.sample=function(e){return(_s(e)?Ii:Ir)(e)},hi.size=function(e){if(null==e)return 0;if(ys(e))return Ds(e)?wn(e):e.length;var t=Bo(e);return t==X||t==ne?e.size:lr(e).length},hi.snakeCase=Sc,hi.some=function(e,t,n){var i=_s(e)?rn:wr;return n&&Ko(e,t,n)&&(t=o),i(e,Uo(t,3))},hi.sortedIndex=function(e,t){return Mr(e,t)},hi.sortedIndexBy=function(e,t,n){return kr(e,t,Uo(n,2))},hi.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var i=Mr(e,t);if(i<n&&hs(e[i],t))return i}return-1},hi.sortedLastIndex=function(e,t){return Mr(e,t,!0)},hi.sortedLastIndexBy=function(e,t,n){return kr(e,t,Uo(n,2),!0)},hi.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=Mr(e,t,!0)-1;if(hs(e[n],t))return n}return-1},hi.startCase=Ec,hi.startsWith=function(e,t,n){return e=qs(e),n=null==n?0:Di(js(n),0,e.length),t=Ur(t),e.slice(n,n+t.length)==t},hi.subtract=Qc,hi.sum=function(e){return e&&e.length?gn(e,Nc):0},hi.sumBy=function(e,t){return e&&e.length?gn(e,Uo(t,2)):0},hi.template=function(e,t,n){var i=hi.templateSettings;n&&Ko(e,t,n)&&(t=o),e=qs(e),t=Ys({},t,i,bo);var r,a,s=Ys({},t.imports,i.imports,bo),c=rc(s),l=vn(s,c),u=0,d=t.interpolate||Xe,p="__p += '",h=nt((t.escape||Xe).source+"|"+d.source+"|"+(d===Re?Be:Xe).source+"|"+(t.evaluate||Xe).source+"|$","g"),f="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++At+"]")+"\n";e.replace(h,function(t,n,i,o,s,c){return i||(i=o),p+=e.slice(u,c).replace(Qe,In),n&&(r=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),i&&(p+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),u=c+t.length,t}),p+="';\n";var g=t.variable;g||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(ye,""):p).replace(Se,"$1").replace(Ee,"$1;"),p="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m=Ac(function(){return Ze(c,f+"return "+p).apply(o,l)});if(m.source=p,Cs(m))throw m;return m},hi.times=function(e,t){if((e=js(e))<1||e>D)return[];var n=x,i=zn(e,x);t=Uo(t),e-=x;for(var r=mn(i,t);++n<e;)t(n);return r},hi.toFinite=Gs,hi.toInteger=js,hi.toLength=Bs,hi.toLower=function(e){return qs(e).toLowerCase()},hi.toNumber=Vs,hi.toSafeInteger=function(e){return e?Di(js(e),-D,D):0===e?e:0},hi.toString=qs,hi.toUpper=function(e){return qs(e).toUpperCase()},hi.trim=function(e,t,n){if((e=qs(e))&&(n||t===o))return e.replace(De,"");if(!e||!(t=Ur(t)))return e;var i=Mn(e),r=Mn(t);return Yr(i,Sn(i,r),En(i,r)+1).join("")},hi.trimEnd=function(e,t,n){if((e=qs(e))&&(n||t===o))return e.replace(Ue,"");if(!e||!(t=Ur(t)))return e;var i=Mn(e);return Yr(i,0,En(i,Mn(t))+1).join("")},hi.trimStart=function(e,t,n){if((e=qs(e))&&(n||t===o))return e.replace(Le,"");if(!e||!(t=Ur(t)))return e;var i=Mn(e);return Yr(i,Sn(i,Mn(t))).join("")},hi.truncate=function(e,t){var n=O,i=R;if(Os(t)){var r="separator"in t?t.separator:r;n="length"in t?js(t.length):n,i="omission"in t?Ur(t.omission):i}var a=(e=qs(e)).length;if(An(e)){var s=Mn(e);a=s.length}if(n>=a)return e;var c=n-wn(i);if(c<1)return i;var l=s?Yr(s,0,c).join(""):e.slice(0,c);if(r===o)return l+i;if(s&&(c+=l.length-c),Ms(r)){if(e.slice(c).search(r)){var u,d=l;for(r.global||(r=nt(r.source,qs(Ve.exec(r))+"g")),r.lastIndex=0;u=r.exec(d);)var p=u.index;l=l.slice(0,p===o?c:p)}}else if(e.indexOf(Ur(r),c)!=c){var h=l.lastIndexOf(r);h>-1&&(l=l.slice(0,h))}return l+i},hi.unescape=function(e){return(e=qs(e))&&Ie.test(e)?e.replace(Te,kn):e},hi.uniqueId=function(e){var t=++dt;return qs(e)+t},hi.upperCase=Tc,hi.upperFirst=Cc,hi.each=qa,hi.eachRight=za,hi.first=ya,Dc(hi,(Yc={},Ki(hi,function(e,t){ut.call(hi.prototype,t)||(Yc[t]=e)}),Yc),{chain:!1}),hi.VERSION="4.17.11",Kt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){hi[e].placeholder=hi}),Kt(["drop","take"],function(e,t){_i.prototype[e]=function(n){n=n===o?1:qn(js(n),0);var i=this.__filtered__&&!t?new _i(this):this.clone();return i.__filtered__?i.__takeCount__=zn(n,i.__takeCount__):i.__views__.push({size:zn(n,x),type:e+(i.__dir__<0?"Right":"")}),i},_i.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),Kt(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==w||3==n;_i.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Uo(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}}),Kt(["head","last"],function(e,t){var n="take"+(t?"Right":"");_i.prototype[e]=function(){return this[n](1).value()[0]}}),Kt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");_i.prototype[e]=function(){return this.__filtered__?new _i(this):this[n](1)}}),_i.prototype.compact=function(){return this.filter(Nc)},_i.prototype.find=function(e){return this.filter(e).head()},_i.prototype.findLast=function(e){return this.reverse().find(e)},_i.prototype.invokeMap=Cr(function(e,t){return"function"==typeof e?new _i(this):this.map(function(n){return ir(n,e,t)})}),_i.prototype.reject=function(e){return this.filter(cs(Uo(e)))},_i.prototype.slice=function(e,t){e=js(e);var n=this;return n.__filtered__&&(e>0||t<0)?new _i(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==o&&(n=(t=js(t))<0?n.dropRight(-t):n.take(t-e)),n)},_i.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},_i.prototype.toArray=function(){return this.take(x)},Ki(_i.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),r=hi[i?"take"+("last"==t?"Right":""):t],a=i||/^find/.test(t);r&&(hi.prototype[t]=function(){var t=this.__wrapped__,s=i?[1]:arguments,c=t instanceof _i,l=s[0],u=c||_s(t),d=function(e){var t=r.apply(hi,en([e],s));return i&&p?t[0]:t};u&&n&&"function"==typeof l&&1!=l.length&&(c=u=!1);var p=this.__chain__,h=!!this.__actions__.length,f=a&&!p,g=c&&!h;if(!a&&u){t=g?t:new _i(this);var m=e.apply(t,s);return m.__actions__.push({func:Ga,args:[d],thisArg:o}),new mi(m,p)}return f&&g?e.apply(this,s):(m=this.thru(d),f?i?m.value()[0]:m.value():m)})}),Kt(["pop","push","shift","sort","splice","unshift"],function(e){var t=ot[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);hi.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var r=this.value();return t.apply(_s(r)?r:[],e)}return this[n](function(n){return t.apply(_s(n)?n:[],e)})}}),Ki(_i.prototype,function(e,t){var n=hi[t];if(n){var i=n.name+"";(ri[i]||(ri[i]=[])).push({name:t,func:n})}}),ri[fo(o,v).name]=[{name:"wrapper",func:o}],_i.prototype.clone=function(){var e=new _i(this.__wrapped__);return e.__actions__=no(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=no(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=no(this.__views__),e},_i.prototype.reverse=function(){if(this.__filtered__){var e=new _i(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},_i.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=_s(e),i=t<0,r=n?e.length:0,o=function(e,t,n){for(var i=-1,r=n.length;++i<r;){var o=n[i],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=zn(t,e+a);break;case"takeRight":e=qn(e,t-a)}}return{start:e,end:t}}(0,r,this.__views__),a=o.start,s=o.end,c=s-a,l=i?s:a-1,u=this.__iteratees__,d=u.length,p=0,h=zn(c,this.__takeCount__);if(!n||!i&&r==c&&h==c)return jr(e,this.__actions__);var f=[];e:for(;c--&&p<h;){for(var g=-1,m=e[l+=t];++g<d;){var _=u[g],v=_.iteratee,y=_.type,S=v(m);if(y==M)m=S;else if(!S){if(y==w)continue e;break e}}f[p++]=m}return f},hi.prototype.at=ja,hi.prototype.chain=function(){return Ha(this)},hi.prototype.commit=function(){return new mi(this.value(),this.__chain__)},hi.prototype.next=function(){this.__values__===o&&(this.__values__=Hs(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?o:this.__values__[this.__index__++]}},hi.prototype.plant=function(e){for(var t,n=this;n instanceof gi;){var i=pa(n);i.__index__=0,i.__values__=o,t?r.__wrapped__=i:t=i;var r=i;n=n.__wrapped__}return r.__wrapped__=e,t},hi.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof _i){var t=e;return this.__actions__.length&&(t=new _i(this)),(t=t.reverse()).__actions__.push({func:Ga,args:[Oa],thisArg:o}),new mi(t,this.__chain__)}return this.thru(Oa)},hi.prototype.toJSON=hi.prototype.valueOf=hi.prototype.value=function(){return jr(this.__wrapped__,this.__actions__)},hi.prototype.first=hi.prototype.head,Ft&&(hi.prototype[Ft]=function(){return this}),hi}();kt._=Dn,(r=function(){return Dn}.call(t,n,t,i))===o||(i.exports=r)}).call(this)}).call(this,n(22),n(382)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";
/*!
 *  RootToolsManager.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(384),a=n(242),s=n(131),c=n(342),l=a.LogFactory.instance().component("RootToolsManager");a.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var u;!function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(u=t.BuildType||(t.BuildType={}));var d=u.InternalBuild;function p(e,t){var n=[];for(var i in e)n.push(t(i,e[i]));return n}function h(e,t,n){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}return!1}function f(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function g(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&h(e.matchers,t.matchers,f)}function m(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function _(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}t.setBuildType=function(e){var t=d;return d=e,t};var v=function(e){function t(t,n,i){var r=e.call(this)||this;return r._unmetConditions=[],r._rtMan=t,r._triggerCallback=n,r._ecsConfig=i,r.resetConditions(),r}return r(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&g(this._ecsConfig.resetCondition,e.resetCondition)&&h(this._ecsConfig.conditions,e.conditions,g)&&h(this._ecsConfig.filters,e.filters,_)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&g(this._ecsConfig.resetCondition,e.resetCondition)&&h(this._ecsConfig.conditions,e.conditions,g)&&h(this._ecsConfig.filters,e.filters,m)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var n=t[e.arg],i="string"==typeof n?e.value:parseInt(e.value,10);return"="===e.op||"=="===e.op?n===i:"!="===e.op?n!==i:"<"===e.op?n<i:"<="===e.op?n<=i:">"===e.op?n>i:">="===e.op?n>=i:"CONTAINS"===e.op.toUpperCase()&&(""+n).indexOf(e.value)>=0},t.prototype.conditionMatches=function(e,t,n){if(t!==e.logId)return!1;if(e.matchers)for(var i=0;i<e.matchers.length;i++)if(!this.matcherMatches(e.matchers[i],n))return!1;return!0},t.prototype.log=function(e,t,n,i){if(0!==this._unmetConditions.length&&e.component!==l){var r=this._ecsConfig;r.resetCondition&&this.conditionMatches(r.resetCondition,t,i)&&(l.debug4("LogTrigger %s: resetCondition met",r.name),this.resetConditions());for(var o=0;o<this._unmetConditions.length;o++){var a=this._unmetConditions[o];if(this.conditionMatches(r.conditions[a],t,i)){l.debug4("LogTrigger %s: condition %s met",r.name,r.conditions[a].name),this._unmetConditions.splice(o,1);break}}0===this._unmetConditions.length&&(l.debug1("LogTrigger %s has triggered, trying to send the log",r.name),this._triggerCallback.call(this._rtMan,r),r.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(c.AbstractLogAppender),y=function(e){function t(t,n){var i=e.call(this)||this;return i._circularBuffer=[],i._circularBufferMaxSize=0,i._circularBuffer=[],i._circularBufferMaxSize=n,i._includeUnsafe=t,i}return r(t,e),t.prototype.formatMessage=function(e){for(var t=[],n=0;n<e.length;n++)"string"==typeof e[n]||"number"==typeof e[n]?t.push(e[n]):t.push(JSON.stringify(e[n]));return t},t.prototype.log=function(e,t,n,i){if(this._includeUnsafe||e.component.safe()){var r={md:e,logId:t,messages:this.formatMessage(i)};this._circularBuffer.push(r),this._circularBuffer.length>this._circularBufferMaxSize&&this._circularBuffer.shift()}},t.prototype.visit=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t}(c.AbstractLogAppender),S=function(){function e(){this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32)+String.fromCharCode(34)+String.fromCharCode(32)}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),n=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[t>>0&63];this._data+=n,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add64=function(e){this._add32(e/4294967296|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,n,i,r){var o=this._components[e.name()];o||(o=++this._componentCount,this._components[e.name()]=o,this._add8(2),this._add16(o),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(0));var a=128;this._first&&(a|=2);var s=t-this._lastts;this._lastts=t,s>-128&&s<128&&(a|=1),this._add8(a),1&a?this._add8(s):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(o),this._add8(n),this._add32(i),this._add8(r.length);for(var c=0;c<r.length;c++)this._add8(8),this._addS(""+r[c]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e}();function E(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}var T=function(){function e(){this._maxUploadSize=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:s.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed"}return e.prototype.setDelegate=function(e){this._glue=e},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||s.LogLevel.Debug4,delete e.root;var n=p(e,function(e,t){return{component:e,level:t}});n.sort(function(e,t){return e.component.length-t.component.length}),n.forEach(function(e){return a.LogFactory.instance().component(e.component).setLevel(e.level)}),this._native&&this._native.log_config.setLogLevelConfig(n)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId)return null;if(e.matchers&&!(e.matchers instanceof Array))return null;var t,n={name:e.name||(t=e.logId,(4294967296+t).toString(16).substr(-8)),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var i=0,r=e.matchers;i<r.length;i++){var o=r[i],a=this.parseMatcher(o);a&&n.matchers.push(a)}return n},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:a.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,n){if(null==e)return null;if(!(e.conditions instanceof Array)||0==e.conditions.length)return null;if(!(e.filters instanceof Array)||0==e.filters.length)return null;if(e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var i={name:e.name||t+"->"+n,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:d!==u.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:E(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},r=0,o=e.conditions;r<o.length;r++){var a=o[r],s=this.parseCondition(a);s&&i.conditions.push(s)}for(var c=0,l=e.filters;c<l.length;c++){var p=l[c],h=this.parseFilter(p);h&&i.filters.push(h)}return 0===i.conditions.length?null:i},e.prototype.isExperimentListed=function(e,t,n,i){return!!e&&(!(!i||!e.some(function(e){return"*"===e.namespace}))||e.some(function(e){return e.namespace===t&&(e.experiment===n||"*"==e.experiment)}))},e.prototype.isExperimentAllowed=function(e,t,n){return!this.isExperimentListed(e.blacklist,t,n,!0)||this.isExperimentListed(e.whitelist,t,n,!1)},e.prototype.findTrigger=function(e,t){for(var n in e)if(e[n].configEquals(t))return n;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var n in e)if(e[n].nativeConfigEquals(t))return n;return null},e.prototype.OnEcsChange=function(){var e=this;return null==this._glue?o.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then(function(t){l.debug4("Reloading ULBaseline config - new config: %@",t),t||(l.warn("No ULBaseline config"),t={}),e._maxUploadSize=t.logUpload&&t.logUpload.maxSize||1024;var n=[],i=e._triggers;e._triggers={};var r=(t.logUpload&&t.logUpload.maxSize||1024)/100,u=t.circularBuffer&&t.circularBuffer.enabled,d=t.circularBuffer&&t.circularBuffer.buffers||e._defaultBuffers,h=t.circularBuffer&&t.circularBuffer.storeUnsafe;e._defaultExperimentTarget=E(t.defaultExperimentTarget)&&t.defaultExperimentTarget||"Mixed";var f=t.killswitch||e._defaultKillswitch,g=t.blacklists||e._defaultBlacklists;g.component.length>0&&a.LogFactory.instance().setComponentBlacklist(g.component);var m={};(t.componentLevels||[]).forEach(function(e){return m[e.component]=e.level}),function e(t,n,i){return n<t.length?i(t[n]).then(function(){return e(t,n+1,i)}):o.Resolved()}(t.configPaths||[],0,function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then(function(r){var o=r instanceof Array?r:[r];l.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,o);for(var a=0,s=o;a<s.length;a++){var c=s[a];if(null!=c){var d=e.parseConfig(c,t.ns,t.key);if(null!=d)if("JavaScript"===d.experimentTarget||"Mixed"===d.experimentTarget)if(l.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,d),e.isExperimentAllowed(f,t.ns,d.name)){l.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,d.name),u=!0;var p=e.findTrigger(i,d);null!=p?(l.debug2("Triggers updated, keeping trigger %s",d.name),e._triggers[p]=i[p],delete i[p]):n.push(d),d.filters&&d.filters.forEach(function(e){return m[e.component]=Math.min(m[e.component]||255,e.parsedLevel)}),d.includeUnsafe&&(h=!0)}else l.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key);else l.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,d);else l.error("Failed to parse ECS config for %s->%s",t.ns,t.key)}}})}).always(function(){for(var t in e.applyLogLevels(),i)l.debug2("Triggers updated, removing trigger %s",i[t].config().name),a.LogFactory.instance().removeAppender(+t);if(n.forEach(function(t){l.debug2("Triggers updated, adding trigger %s",t.name);var n=new v(e,e._triggered,t),i=a.LogFactory.instance().addAppender(n);e._triggers[String(i)]=n}),m[""]=m.root||s.LogLevel.Debug4,delete m.root,!e._circularBuffer||u&&!e._circularBuffer.needReset(h,r)?e._circularBuffer&&(Object.keys(i).length>0||n.length>0?(l.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):l.debug2("Buffer updated, no change")):(l.debug2("Buffer updated, removing existing buffer"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null),u&&(e._circularBuffer||(l.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",h,r),e._circularBuffer=new y(h,r)),null==e._circularBufferHandle&&(l.debug2("Creating log level wrapper"),e._circularBufferHandle=a.LogFactory.instance().addAppender(c.wrapAppenderWithLogLevels(e._circularBuffer,m),s.AppenderFlags.InsertFront))),e._native){var o=p(m,function(e,t){return{component:e,level:t}});o.sort(function(e,t){return e.component.length-t.component.length}),e._native.log_config.setLogBufferConfig(u,{storeUnsafe:h,buffers:d},o);var f=[];for(var g in e._triggers){var _=e._triggers[g].config();f.push({name:_.name,ecsNs:_.ecsNs,conditions:_.conditions,resetCondition:_.resetCondition,includeUnsafe:_.includeUnsafe,reenableAfterTriggering:_.reenableAfterTriggering,filters:_.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(f,{})}})})},e.prototype.filterMatches=function(e,t,n,i){for(var r=0;r<i.length;r++)if((""===i[r].component||e.component.name()===i[r].component||e.component.name().substr(0,i[r].component.length)===i[r].component&&"."===e.component.name().charAt(i[r].component.length))&&e.level>=i[r].parsedLevel)return!0;return!1},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry("638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104",{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),l.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,n,i,r){var o=this.findTriggerByNativeConfig(this._triggers,e);if(o){var s={level:t.level,component:a.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[o].log(s,n,i,r)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){var n=this;if(this._circularBuffer){var i=new S,r=e.filter.map(function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}});this._circularBuffer.visit(function(e,t,o){return n.filterMatches(e,t,o,r)&&i.log(e.component,e.timestamp,e.level,t,o),i._data.length<n._maxUploadSize}),i.close();var a=i.data();if(this._native){var s=o.Defer();return this._native.log_config.mergeAndDumpLogBuffer(a,e,t,function(e){return s.resolve(e)}),s.promise()}return o.Resolved(a)}return o.Rejected()},e.prototype._triggered=function(e){var t=this,n={compression:s.LogFileCompression.Compress,encoding:s.LogFileEncoding.Base64,encryption:s.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},i={includeUnsafe:e.includeUnsafe,filter:e.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),reverse:!0};this.dumpLogBuffer(i,n).then(function(n){return t._send(e,n)})},e}();t.RootToolsManager=new T},function(e,t,n){"use strict";(function(e){function n(e){return null!==e&&void 0!==e&&"function"==typeof e.then}function i(e){return null!==e&&void 0!==e&&"function"==typeof e.cancel}function r(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var o,a=[],s=void 0!==e;function c(t){a.push(t),1===a.length&&(s?e(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),r=!1;return t.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){r||(r=!0,t.resolve(e))},function(e){r||(r=!0,t.reject(e))}):r||(r=!0,t.resolve(e))}),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var i=this,r=new e;return r.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,i._cancelInternal(e)}),t.task=r,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:r._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),r.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack;var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?r(function(){var r=t.successFunc(o._storedResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?r(function(){var r=t.failFunc(o._storedErrResolution);i(r)&&(t.wasCanceled?e.cancelOtherInternal(r,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(r,t)})),n(r)?r.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(r)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole,t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,r=u(),a=e.length,s=Array(e.length);r.onCancel(function(t){e.forEach(function(e){i(e)&&o.SyncTask.cancelOtherInternal(e,t)})});var c=function(){0==--a&&(void 0!==t?r.reject(t):r.resolve(s))};return e.forEach(function(e,i){n(e)?e.then(function(e){s[i]=e,c()},function(e){void 0===t&&(t=void 0===e||e),c()}):(s[i]=e,c())}),r.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),i=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(i),{timedOut:!1,result:e}}),n.promise()])}}).call(this,n(385).setImmediate)},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(386),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(22))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,o,a,s,c=1,l={},u=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){f(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){f(e.data)},i=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(r=d.documentElement,i=function(e){var t=d.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(f,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),i=function(t){e.postMessage(a+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return l[c]=r,i(c),c++},p.clearImmediate=h}function h(e){delete l[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(22),n(78))},function(e,t,n){"use strict";
/*!
 *  pii.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2017-01-16
 *  Copyright 2017 Microsoft. All rights reserved.
 *
 */Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e},r=!0,o=i,a={},s=0;var c,l=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(c||(c={}));var u=[c.Thread,c.InternalSkype,c.Bot];t.enableAnonymization=function(e){r=e},t.useTagger=function(e){o=e||i},function(e){function t(e){return r?e?a[e]||function(e){return a[e]="u"+ ++s}(e):null:e}e.UserName=function(e){var n=t(e);return o(n)},e.Mri=function(e){var n,i=e.match(l);if(i){var r=Number(i[1]),a=i[2];n=-1!=u.indexOf(r)?e:r+":"+t(a)}else n=t(e);return o(n)},e.Omit=function(e){var t;return t=r?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,o(t)}}(t.pii||(t.pii={}))},function(e,t,n){"use strict";var i=n(389),r=function(){function e(){this.isThenable=function(e){return e&&e.then&&"function"==typeof e.then}}return e.prototype.get=function(e,t){return this.sendRequest(e,t,"GET")},e.prototype.post=function(e,t){return this.sendRequest(e,t,"POST")},e.prototype.put=function(e,t){return this.sendRequest(e,t,"PUT")},e.prototype.remove=function(e,t){return this.sendRequest(e,t,"DELETE")},e.prototype.sendRequest=function(e,t,n){var r=this;return new Promise(function(a,s){var c=Date.now(),l=45e3;"number"==typeof t.timeout&&(l=t.timeout);var u=i.compat({url:e,method:n,headers:t.headers||{},timeout:l,data:t.payload||"",dataType:t.dataType||"json",contentType:t.contentType||"application/json",crossOrigin:o(t.crossOrigin,!0),withCredentials:o(t.withCredentials,!1),success:function(e){a({response:e,request:u.request,duration:Date.now()-c})},error:function(e){s(u.request)}});r.isThenable(t.timeout)&&t.timeout.then(function(){u.abort()}).catch(function(){})})},e}();function o(e,t){return void 0!==e?e:t}e.exports=new r},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__,definition;
/*!
  * Reqwest! A general purpose XHR connection manager
  * license MIT (c) Dustin Diaz 2015
  * https://github.com/ded/reqwest
  */definition=function(){var context=this,XHR2;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else try{XHR2=__webpack_require__(390)}catch(e){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(!0===e.crossOrigin){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){return e._aborted?n(e.request):e._timedOut?n(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request)))}}function setHeaders(e,t){var n,i=t.headers||{};i.Accept=i.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var r="undefined"!=typeof FormData&&t.data instanceof FormData;for(n in t.crossOrigin||i[requestedWith]||(i[requestedWith]=defaultHeaders.requestedWith),i[contentType]||r||(i[contentType]=t.contentType||defaultHeaders.contentType),i)i.hasOwnProperty(n)&&"setRequestHeader"in e&&e.setRequestHeader(n,i[n])}function setCredentials(e,t){void 0!==t.withCredentials&&void 0!==e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,i){var r=uniqid++,o=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(r),s=new RegExp("((^|\\?|&)"+o+")=([^&]+)"),c=i.match(s),l=doc.createElement("script"),u=0,d=-1!==navigator.userAgent.indexOf("MSIE 10.0");return c?"?"===c[3]?i=i.replace(s,"$1="+a):a=c[3]:i=urlappend(i,o+"="+a),context[a]=generalCallback,l.type="text/javascript",l.src=i,l.async=!0,void 0===l.onreadystatechange||d||(l.htmlFor=l.id="_reqwest_"+r),l.onload=l.onreadystatechange=function(){if(l[readyState]&&"complete"!==l[readyState]&&"loaded"!==l[readyState]||u)return!1;l.onload=l.onreadystatechange=null,l.onclick&&l.onclick(),t(lastValue),lastValue=void 0,head.removeChild(l),u=1},head.appendChild(l),{abort:function(){l.onload=l.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(l),u=1}}}function getRequest(e,t){var n,i=this.o,r=(i.method||"GET").toUpperCase(),o="string"==typeof i?i:i.url,a=!1!==i.processData&&i.data&&"string"!=typeof i.data?reqwest.toQueryString(i.data):i.data||null,s=!1;return"jsonp"!=i.type&&"GET"!=r||!a||(o=urlappend(o,a),a=null),"jsonp"==i.type?handleJsonp(i,e,t,o):((n=i.xhr&&i.xhr(i)||xhr(i)).open(r,o,!1!==i.async),setHeaders(n,i),setCredentials(n,i),context[xDomainRequest]&&n instanceof context[xDomainRequest]?(n.onload=e,n.onerror=t,n.onprogress=function(){},s=!0):n.onreadystatechange=handleReadyState(this,e,t),i.before&&i.before(n),s?setTimeout(function(){n.send(a)},200):n.send(a),n)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(null!==e)return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(e){return error(resp,"Could not parse JSON in response",e)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,n);complete(e)}fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n,i,r,o,a=e.name,s=e.tagName.toLowerCase(),c=function(e){e&&!e.disabled&&t(a,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&a)switch(s){case"input":/reset|button|image|file/i.test(e.type)||(n=/checkbox/i.test(e.type),i=/radio/i.test(e.type),r=e.value,(!n&&!i||e.checked)&&t(a,normalize(n&&""===r?"on":r)));break;case"textarea":t(a,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())c(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(o=0;e.length&&o<e.length;o++)e.options[o].selected&&c(e.options[o])}}function eachFormElement(){var e,t,n=this,i=function(e,t){var i,r,o;for(i=0;i<t.length;i++)for(o=e[byTag](t[i]),r=0;r<o.length;r++)serial(o[r],n)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,n),i(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,i){var r,o,a,s=/\[\]$/;if(isArray(t))for(o=0;t&&o<t.length;o++)a=t[o],n||s.test(e)?i(e,a):buildParams(e+"["+("object"==typeof a?o:"")+"]",a,n,i);else if(t&&"[object Object]"===t.toString())for(r in t)buildParams(e+"["+r+"]",t[r],n,i);else i(e,t)}return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},catch:function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t=Array.prototype.slice.call(arguments,0);return(e=t.pop())&&e.nodeType&&t.push(e)&&(e=null),e&&(e=e.type),("map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString).apply(null,t)},reqwest.toQueryString=function(e,t){var n,i,r=t||!1,o=[],a=encodeURIComponent,s=function(e,t){t="function"==typeof t?t():null==t?"":t,o[o.length]=a(e)+"="+a(t)};if(isArray(e))for(i=0;e&&i<e.length;i++)s(e[i].name,e[i].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],r,s);return o.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){for(var t in e=e||{})globalSetupOptions[t]=e[t]},reqwest},void 0!==module&&module.exports?module.exports=definition():void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=definition)?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t){},function(e,t,n){"use strict";var i=/^(2)\d{2}/,r=/^(3)\d{2}/,o=/^(5)\d{2}/,a=function(){function e(){}return e.prototype.isTransientCheck=function(e){return this._isTimeout(e)||this._statusCodeMatch(e,o)},e.prototype.isSuccessCheck=function(e){return this._statusCodeMatch(e,i)||this._statusCodeMatch(e,r)},e.prototype._isTimeout=function(e){return 0===e.status},e.prototype._statusCodeMatch=function(e,t){return t.test(e.status.toString())},e}();e.exports=new a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.getSkypeConfig=function(){return Promise.resolve({mediaAgentConfig:{settings:{numVideoChannelsGvc:10,renegotiationAttempts:3,preferSdesSrtp:!0,iceDisconnectedTimeoutMs:3e4,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcScreensharingCapabilityMaxFS:3600,webrtcScreensharingCapabilityMaxFPS:1500,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcScreensharingCapabilityCheckIntervalMin:8e3,webrtcScreensharingCapabilityCheckIntervalMax:12e3,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:"app recv:dsh",webrtcVideoChannelSignalingFeedback:"app send:src",capabilities:{webrtc:{screensharing:!0}},dtmf:{toneDuration:200,toneGap:100}},notifications:{onDevicesChanged:function(){},onDevicesPermissionChanged:function(){}}}})},e.prototype.getRelayConfig=function(){return Promise.resolve({})},e}();t.testConfigProvider=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(394),r=n(20),o=function(){return function(e){var t=this;this.logEvent=function(e){t._logger.debug(e)},this._logger=e}}(),a=function(){function e(){var e,t,n=this;this._stateCallback=function(e,t){e===i.TrouterState.Connected&&n.trouterUrl(t)},this._trouterUrlChangeListenerRegistry=(e=[],(t=function(t){e.push(t)}).off=function(t){var n=e.indexOf(t,0);n>-1&&e.splice(n,1)},t.notifyAll=function(t){e.forEach(function(e){e(t)})},t),this.trouterUrl=function(){var e=function(e){if(n._logger.info("trouterUrl change"),void 0===e)return n._trouterUrl;n._trouterUrl!==e&&(n._trouterUrl=e,n._trouterUrlChangeListenerRegistry.notifyAll(e))};return e.changed=n._trouterUrlChangeListenerRegistry,e}()}return e.prototype._getSettings=function(e,t){return{registrationId:r.guid.generate(),registrarServiceUrl:t.incomingCalls.registrarServiceUrl,registrarTtlInSeconds:t.incomingCalls.registrarTtlInSeconds,maxRegistrationTimeInMs:t.incomingCalls.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:t.incomingCalls.registrarRefreshTimeoutInMs,pnhAppId:t.incomingCalls.pnhAppId,pnhTemplate:t.incomingCalls.pnhTemplate,platform:e,platformUIVersion:"0.0.0",trouterServiceUrl:t.incomingCalls.trouterServiceUrl,version:t.version,trouterConnectTimeoutInMs:t.incomingCalls.trouterConnectTimeoutInMs,productName:t.productName,sessionId:t.sessionId,environment:"",incallModeTimeoutMs:0}},e.prototype._createTrouterTelemetryConfig=function(e){return{eventLogger:new o(e.createChild("TrouterTelemetry")),settings:{enabled:!0,logHealthCheckError:!0,trouter_js_client_connected:!0,trouter_js_client_disconnected:!0,trouter_js_client_error:!0,trouter_js_client_progress:!0,trouter_js_client_response:!0,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}},e.prototype._getTrouterConfig=function(e,t,n,i,r){return{useNewImplementation:!0,trouterSettings:this._getSettings(t,n),skypeTokenProvider:i,telemetryConfig:this._createTrouterTelemetryConfig(e)}},e.prototype.init=function(e,t,n,r,o){return this._logger=e,this._logger.info("Trouterservice init"),this._trouterService?this._logger.error("Trouterservice already initialized"):(this._options=this._getTrouterConfig(e,t,n,r,o),this._trouterService=i.createTrouterService(e.createChild("Trouter"))),this},e.prototype.start=function(e){this._logger.info("Trouterservice start"),this._trouterService?(e&&(this._options.trouterSettings.environment=e.environment,this._options.trouterSettings.sessionId=e.sessionId),this._trouterService.start(this._options),this._trouterService.onStateChanged(this._stateCallback)):this._logger.error("Trouterservice not initialized")},e.prototype.stop=function(){this._logger.info("Trouterservice stop"),this._trouterService?(this._trouterService.stop(),this._trouterService=void 0):this._logger.error("Trouterservice not inited")},e.prototype.registerMessageHandler=function(e){this._logger.info("Trouterservice registerMessageHandler"),this._trouterService&&this._trouterService.registerMessageHandler(e)},e.prototype.clearMessageHandlers=function(){this._trouterService&&this._trouterService.clearMessageHandlers()},e.prototype.checkConnection=function(){this._trouterService&&this._trouterService.checkConnection()},e.prototype.state=function(){return this._logger.info("Trouterservice state"),this._trouterService?this._trouterService.state():i.TrouterState.Unknown},e.prototype.onStateChanged=function(e){this._logger.info("Trouterservice onStateChanged"),this._trouterService&&this._trouterService.onStateChanged(e)},e.prototype.getTrouterUrlAsync=function(){return this._trouterService?(this._logger.info("getTrouterUrlAsync called"),this._trouterService.getTrouterUrlAsync()):Promise.reject("Trouterservice not started yet")},e}();t.Trouter=a},function(module,exports,__webpack_require__){(function(fetch){module.exports=function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=21)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="114.13.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}};var i=function(){function e(){this.start=Date.now()}return e.prototype.duration=function(){return Date.now()-this.start},e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=i},function(e,t,n){(function(t,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}function r(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<C;e+=2)(0,M[e])(M[e+1]),M[e]=void 0,M[e+1]=void 0;C=0}function a(e,t){var n=arguments,i=this,r=new this.constructor(c);void 0===r[D]&&y(r);var o=i._state;return o?function(){var e=n[o-1];b(function(){return v(o,r,e,i._result)})}():g(i,r,e,t),r}function s(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return d(t,e),t}function c(){}function l(e){try{return e.then}catch(e){return F.error=e,F}}function u(t,n,i){n.constructor===t.constructor&&i===a&&n.constructor.resolve===s?function(e,t){t._state===U?h(e,t._result):t._state===x?f(e,t._result):g(t,void 0,function(t){return d(e,t)},function(t){return f(e,t)})}(t,n):i===F?f(t,F.error):void 0===i?h(t,n):e(i)?function(e,t,n){b(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?d(e,n):h(e,n))},function(t){i||(i=!0,f(e,t))},e._label);!i&&r&&(i=!0,f(e,r))},e)}(t,n,i):h(t,n)}function d(e,t){e===t?f(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?u(e,t,l(t)):h(e,t)}function p(e){e._onerror&&e._onerror(e._result),m(e)}function h(e,t){e._state===L&&(e._result=t,e._state=U,0!==e._subscribers.length&&b(m,e))}function f(e,t){e._state===L&&(e._state=x,e._result=t,b(p,e))}function g(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+U]=n,r[o+x]=i,0===o&&e._state&&b(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?v(n,i,r,o):r(o);e._subscribers.length=0}}function _(){this.error=null}function v(t,n,i,r){var o=e(i),a=void 0,s=void 0,c=void 0,l=void 0;if(o){if((a=function(e,t){try{return e(t)}catch(e){return H.error=e,H}}(i,r))===H?(l=!0,s=a.error,a=null):c=!0,n===a)return void f(n,new TypeError("A promises callback cannot return that same promise."))}else a=r,c=!0;n._state!==L||(o&&c?d(n,a):l?f(n,s):t===U?h(n,a):t===x&&f(n,a))}function y(e){e[D]=G++,e._state=void 0,e._result=void 0,e._subscribers=[]}function S(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[D]||y(this.promise),T(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&h(this.promise,this._result))):f(this.promise,new Error("Array Methods must be provided an Array"))}function E(e){this[D]=G++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof E?function(e,t){try{t(function(t){d(e,t)},function(t){f(e,t)})}catch(t){f(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var T=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},C=0,I=void 0,A=void 0,b=function(e,t){M[C]=e,M[C+1]=t,2===(C+=2)&&(A?A(o):k())},O="undefined"!=typeof window?window:void 0,R=O||{},P=R.MutationObserver||R.WebKitMutationObserver,N="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),w="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,M=new Array(1e3),k=void 0;k=N?function(){return t.nextTick(o)}:P?function(){var e=0,t=new P(o),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():w?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===O?function(){try{var e=n(22);return void 0!==(I=e.runOnLoop||e.runOnContext)?function(){I(o)}:r()}catch(e){return r()}}():r();var D=Math.random().toString(36).substring(16),L=void 0,U=1,x=2,F=new _,H=new _,G=0;return S.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===L&&n<e;n++)this._eachEntry(t[n],n)},S.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===s){var r=l(e);if(r===a&&e._state!==L)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===E){var o=new n(c);u(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},S.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===L&&(this._remaining--,e===x?f(i,n):this._result[t]=n),0===this._remaining&&h(i,this._result)},S.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,function(e){return n._settledAt(U,t,e)},function(e){return n._settledAt(x,t,e)})},E.all=function(e){return new S(this,e).promise},E.race=function(e){var t=this;return new t(T(e)?function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},E.resolve=s,E.reject=function(e){var t=new this(c);return f(t,e),t},E._setScheduler=function(e){A=e},E._setAsap=function(e){b=e},E._asap=b,E.prototype={constructor:E,then:a,catch:function(e){return this.then(null,e)}},E.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=E},E.Promise=E,E})}).call(t,n(15),n(4))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.HttpHeaders=i,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.handleMessage=function(e){for(var t={resultCode:i.UNHANDLED_MESSAGE_ACK},n=0,r=this.messageHandlers;n<r.length;n++){var o=r[n],a=this.safeExecuteHandle(o,e);if(void 0!==a&&(void 0===a.isHandled||a.isHandled))return void 0===a.resultCode&&(a.resultCode=i.HANDLED_MESSAGE_ACK),a}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(2),o=n(0);t.EVENTS={REGISTRATION_SUCCESS:"REGISTRATION_SUCCESS",REGISTRATION_FAILURE:"REGISTRATION_FAILURE",REGISTRATION_REFRESH:"REGISTRATION_REFRESH"};var a=function(){function e(e){this.logFunc=e}return e.prototype.post=function(e,t){var n=this,o=new Headers;o.append("X-Skypetoken",t.headers["X-Skypetoken"]),o.append("content-type","application/json"),o.append("accept","application/json, text/javascript");var a=new Request(e,{method:"POST",mode:"cors",headers:o,body:t.payload});return new i.Promise(function(e,t){fetch(a).then(function(i){i.ok?(n.log("info","Registration request succeed"),e({request:{},response:{status:i.status}})):(n.log("error","Registration request failed with "+i.status+" "+i.statusText),t())}).catch(function(e){n.log("error","Registration request failed with "+r.toJson(e)),t()})})},e.prototype.remove=function(e,t){var n=this,o=new Headers;o.append("X-Skypetoken",t.headers["X-Skypetoken"]),o.append("content-type","application/json"),o.append("accept","application/json, text/javascript");var a=new Request(e,{method:"DELETE",mode:"cors",headers:o});return new i.Promise(function(e,t){fetch(a).then(function(i){n.log("info","Unregistration request succeed"),i.ok?e({request:{},response:{status:i.status}}):(n.log("error","Unregistration request failed with "+i.status+" "+i.statusText),t())}).catch(function(e){n.log("error","Unregistration request failed with "+r.toJson(e)),t()})})},e.prototype.log=function(e,t){var n={level:e,message:t};this.logFunc(JSON.stringify(n))},e}(),s=function(){function e(e,t,n,i,o){var s=this;this.getServerState=t,this.eventLogger=n,this.clientCorrelationID=i,this.environment=o,this.isTtlRefresh=!1,this.registerEndpoint=function(e,t){s.isTtlRefresh=!1,s.currentPublicUrl=e,s.currentRegistrationId=t,s.clearRegistrationRefresh(),s.initialRegistrationTimestamp=Date.now(),s.getPayloadAndRegister()},this.unregisterEndpoint=function(e){s.skypetokenProvider(!1).then(function(t){var n={headers:{"X-Skypetoken":t}},i=new r.Timespan;s.requestDispatcherProvider.remove(s.settings.registrarServiceUrl+"/"+e,n).then(function(e){return s.sendTelemetry("trouter_js_client_unregistration",e.response.status,i.duration()),e}).catch(function(e){throw s.sendTelemetry("trouter_js_client_unregistration",-1,i.duration()),e})},function(){})},this.getPayloadAndRegister=function(){s.skypetokenProvider(!1).then(function(e){var t={headers:{"X-Skypetoken":e},payload:JSON.stringify(s.getPayload())},n=new r.Timespan;return s.requestDispatcherProvider.post(s.settings.registrarServiceUrl,t).then(function(e){return s.sendTelemetry("trouter_js_client_registration",e.response.status,n.duration()),e}).catch(function(e){throw s.sendTelemetry("trouter_js_client_registration",-1,n.duration()),e})}).then(s.registrationSuccess,s.registrationError)},this.renewTtl=function(){s.isTtlRefresh=!0,s.getPayloadAndRegister()},this.registrationSuccess=function(e){e.response||s.registrationError("Invalid success response result, expected response property"),e.response.status||s.registrationError("Invalid success response result, expected status property"),s.isSuccessCode(e.response.status)||s.registrationError(e.response),s.schedulePresenceRefresh(),s.onRegistrationSuccess&&s.onRegistrationSuccess(s.isTtlRefresh)},this.registrationError=function(e){s.onRegistrationError&&s.onRegistrationError("function"==typeof XMLHttpRequest&&e instanceof XMLHttpRequest?e:null)},this.schedulePresenceRefresh=function(){s.clearRegistrationRefresh(),s.getRegistrationTime()+s.settings.registrarRefreshTimeoutInMs<s.settings.maxRegistrationTimeInMs&&(s.refreshTimeout=window.setTimeout(s.renewTtl,s.settings.registrarRefreshTimeoutInMs))},this.clearRegistrationRefresh=function(){window.clearTimeout(s.refreshTimeout)},this.settings=e.settings,this.requestDispatcherProvider=new a(e.logFunc),this.skypetokenProvider=e.skypetokenProvider,this.onRegistrationSuccess=e.onRegistrationSuccess,this.onRegistrationError=e.onRegistrationError}return e.prototype.getPayload=function(){return{clientDescription:{appId:this.settings.pnhAppId,aesKey:"",languageId:"en-US",platform:this.settings.platform,templateKey:this.settings.pnhTemplate,platformUIVersion:this.settings.platformUIVersion},registrationId:this.currentRegistrationId,nodeId:"",transports:{TROUTER:[{context:"",path:this.currentPublicUrl,ttl:this.settings.registrarTtlInSeconds}]}}},e.prototype.sendTelemetry=function(e,t,n){if(void 0!==this.eventLogger){var i=this.getServerState();this.eventLogger.logEvent({name:e,properties:{clientCorrelationID:{value:this.clientCorrelationID},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION+"/orig"},connectionId:{value:i.connectionId},connectedClientId:{value:i.connectedClientId},domId:{value:i.domId},url:{value:i.url},surl:{value:i.surl},ttlInSecs:{value:i.ttlInSecs},status:{value:t},duration:{value:n}}})}},e.prototype.isSuccessCode=function(e){return 202===e||200===e},e.prototype.getRegistrationTime=function(){return Date.now()-this.initialRegistrationTimestamp},e}();t.RegistrarService=s,t.build=function(e,t,n,i,r){return new s(e,t,n,i,r)}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(a=(a=c.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return i(n,void 0,void 0,function(){return r(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,i){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),i(e)})})]})})}}},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r,o,a=n(14),s=n(3),c="114.13.1",l=function(e){if(!e)return"";if("object"!=typeof e)return e;for(var t={},n=0,i=["name","message","description","number","fileName","lineNumber","stack"];n<i.length;n++){var r=i[n];r in e&&(t[r]=e[r])}return JSON.stringify(t)},u=function(e){return"string"==typeof e?e:""},d=function(){return Date.now()},p=function(){},h=function(){if("undefined"!=typeof window&&window&&window.performance){var e=function(){return Math.round(window.performance.now())};e(),d=e}},f=function(){function e(e,t){this.originator=e,this.recipient=t}return e.GetCallback=function(t,n){var i=new e(t,n);return i.callback.bind(i)},e.prototype.callback=function(){if("function"==typeof this.recipient){var e=Array.prototype.concat.apply(this.originator,arguments);this.recipient.apply(this.recipient,e)}},e}();!function(e){e[e.Connected=0]="Connected",e[e.Disconnected=1]="Disconnected",e[e.Error=2]="Error",e[e.Progress=3]="Progress",e[e.Response=4]="Response",e[e.Request=5]="Request"}(o||(o={}));var g,m=((r={})[o.Connected]="trouter_js_client_connected",r[o.Disconnected]="trouter_js_client_disconnected",r[o.Error]="trouter_js_client_error",r[o.Progress]="trouter_js_client_progress",r[o.Response]="trouter_js_client_response",r[o.Request]="trouter_js_client_request",r),_=function(){this.cv=c,this.ua="",this.hr="",this.v=""},v=function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3};!function(e){e[e.connect=0]="connect",e[e.connecting=1]="connecting",e[e.connect_failed=2]="connect_failed",e[e.disconnect=3]="disconnect",e[e.reconnect=4]="reconnect",e[e.reconnect_failed=5]="reconnect_failed",e[e.reconnecting=6]="reconnecting",e[e.error=7]="error",e[e.message=8]="message",e[e["trouter.connected"]=9]="trouter.connected"}(g||(g={}));var y=function(e){},S=function(){};t.Properties=S;var E=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4;for(var e=0,t=Object.keys(o).map(function(e){return o[e]}).filter(function(e){return"number"==typeof e});e<t.length;e++){var n=t[e];this[m[n]]=!1}},T=function(){},C=function(){},I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(S),A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.connectionNumber=0,t}return i(t,e),t}(S),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(S),O=function(){function e(e){var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:[],this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:""}return e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e}(),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(S),P=function(e){this.id=e,this.status=200,this.headers={},this.body=""},N=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),w=function(){function e(){this.logFunc=y}return Object.defineProperty(e.prototype,"ConnectionId",{set:function(e){this.connectionId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ConnectedClientId",{set:function(e){this.ccId=e},enumerable:!0,configurable:!0}),e.prototype.debug=function(e){this.log("debug",e)},e.prototype.info=function(e){this.log("info",e)},e.prototype.warn=function(e){this.log("warn",e)},e.prototype.error=function(e){this.log("error",e)},e.prototype.log=function(e,t){var n={level:e,message:t,connectionId:this.connectionId,connectedClientId:this.ccId};this.logFunc(JSON.stringify(n))},e}();t.Logger=w;var M,k=function(){function e(e,t,n,i,r,o){this.logger=e,this.clientCorrelationID=t,this.environment=n,this.clientId=i,this.clientInfo=r,this.getServerState=o,this.clientCorrelationID=t||"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=d(),this.eventLogSettings=new E,this.connectedInfo=new A}return e.prototype.overrideAsBool=function(e,t){t&&(!this.eventLogSettings.hasOwnProperty(e)||!0!==t[e]&&!1!==t[e]||(this.eventLogSettings[e]=t[e]))},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(o.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=d(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n in e.properties=e.properties||{},t)t.hasOwnProperty(n)&&void 0!==t[n]&&(e.properties[n.replace(/-/g,"_")]={value:t[n]})},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[m[e]]&&void 0!==this.eventLogger){var i={name:m[e],properties:{connectionAttempt:{value:this.connectionAttempt},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:JSON.stringify(n||[])},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:c+"/orig"},ua:{value:this.clientInfo.ua}}};if(this.copyProperties(i,this.getServerState()),this.copyProperties(i,t),this.copyProperties(i,this.connectedInfo),this.eventFactory){var r=this.eventFactory();for(var o in r.name=i.name,i.properties)i.properties.hasOwnProperty(o)&&r.setProperty(o,i.properties[o].value);i=r}this.eventLogger.logEvent(i)}}catch(t){this.logger.warn("error in sending event "+e+": "+l(t))}},e.prototype.createStep=function(e,t,n){var i=new T;return i.stepName=e,i.operation=t,i.delta=d()-this.beginTimestamp,i.ts=Date.now(),i.error=n,i},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&0===this.beginTimestamp&&(this.beginTimestamp=d()),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var i=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(o.Progress,{reason:"flush"},i)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,i){void 0===i&&(i=!1),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||(!0===i&&this.addStep(e,t,n),this.sendTelemetry(o.Error,{},[this.createStep(e,t,n)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),i=this.totalStepCount,r=d()-this.beginTimestamp;this.steps.length=0,this.totalStepCount=0,this.beginTimestamp=0,this.sendTelemetry(o.Connected,{stepCount:n.length,totalStepCount:i,connectionEstablishmentMs_Total:r},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=d()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(o.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n=new b;t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body?e.body.length:null,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS?e.startTS:Date.now();var i=e.headers||{};for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r])}}catch(e){n.hasError=!0,n.error=n.error+"error creating request context "+l(e)}this.sendTelemetry(o.Request,n,[])},e.prototype.trackResponse=function(e,t,n,i){var r=new R;i&&(r.hasError=!0,r.error=i);try{if(e){r.requestID=e.id,r.httpMethod=e.method,r.shortUrl=e.shortUrl,r.responseTimestamp=t&&t.sentTS?t.sentTS:Date.now();var a=e.headers||{};for(var s in a)a.hasOwnProperty(s)&&(r[s]=a[s])}t&&(r.latencyMS=n,r.responseCode=t.status,r.responseLength=t.body?t.body.length:null)}catch(e){r.hasError=!0,r.error=r.error+"error creating response context "+l(e)}this.sendTelemetry(o.Response,r,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,n,null,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,e.numberOfStepsToMaintain||0)),this.eventLogSettings.sendProgressTimeoutSecs=Math.min(3600,Math.max(55,e.sendProgressTimeoutSecs||0)),this.overrideAsBool("enabled",e),this.overrideAsBool("logHealthCheckError",e);for(var t=Object.keys(o).map(function(e){return o[e]}),n=0,i=t;n<i.length;n++){var r=i[n];"number"==typeof r&&this.overrideAsBool(m[r],e)}this.overrideAsBool("logSendPingError",e),this.resetProgressSendTimer()}},e}(),D=function(){function e(e,t,n,i,r,o){this.logger=e,this.config=t,this.url=n,this.headers=i,this.body=r,this.callback=o,this.stop=!1,this.xhr=null}return e.prototype.go=function(){try{this.stop||(this.logger.debug("go: "+this.url),this.post(this.url,this.headers,this.body))}catch(t){var e=l(t);this.logger.error("Exception in posting http request: "+e),this.callback(-1,e)}},e.prototype.cancel=function(){this.stop=!0},e.prototype.useCORSXHR=function(){return!this.xhr&&"withCredentials"in new XMLHttpRequest},e.prototype.getXHR=function(){return this.xhr?new this.xhr:this.useCORSXHR?new XMLHttpRequest:new(window.XDomainRequest||XMLHttpRequest)},e.prototype.post=function(e,t,n){var i=this;try{var r=this.getXHR();if(XMLHttpRequest&&r instanceof XMLHttpRequest?r.onreadystatechange=function(){4===r.readyState&&i.done(r.status,r.responseText)}:(r.onload=function(){var e=/^([0-9]{3}).*/g.exec(r.responseText),t=e?e[1]:200;i.done(Number(t),r.responseText)},r.onerror=this.errorHandler),r.open("POST",e,!0),r.setRequestHeader&&(r.setRequestHeader("Content-Type","text/plain"),this.config.userAgent&&r.setRequestHeader("User-Agent",this.config.userAgent),t))for(var o in t)t.hasOwnProperty(o)&&r.setRequestHeader(o,t[o]);"undefined"!=typeof window&&window&&window.XDomainRequest&&r instanceof window.XDomainRequest?(r.onprogress=function(){},r.ontimeout=function(){},setTimeout(function(){try{r.send(n)}catch(n){var t=l(n);i.logger.error("Exception in post to "+e+": "+t),i.errorHandler(t)}},0)):r.send(n)}catch(t){var a=l(t);this.logger.error("Exception in post to "+e+": "+a),this.errorHandler(a)}},e.prototype.done=function(e,t){this.stop||(this.logger.debug("done: "+this.url),this.callback(e,t))},e.prototype.errorHandler=function(e){this.callback(-1,e)},e}(),L=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffCount=0,this.timerHandle=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),i=1e3*Math.pow(2,e)*n;return i=Math.round(i),Math.min(t,i)},e.prototype.backoff=function(t){var n=this,i=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffCount++,this.logger.debug("Backing off for "+i+" milliseconds."),this.timerHandle=setTimeout(function(){n.logger.debug("Back off complete, invoking handler."),t()},i)},e.prototype.reset=function(){this.logger.debug("Resetting back off."),this.cancel(),this.backoffCount=0},e.prototype.cancel=function(){this.logger.debug("Cancelling back off."),clearTimeout(this.timerHandle)},e}();!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.Disconnected=6]="Disconnected",e[e.WaitingHealthCheck=7]="WaitingHealthCheck"}(M||(M={}));var U=function(){function e(e){h(),this.config=e||new C,this.serverClosed=!0,this.reconnectToOldServerFirst=!1,this.connectedClientId="",this.domId="",this.connectionId="",this.currentSocketNumber=0,this.callbacks={token:function(){return s.Promise.reject("Not initialized")},ready:p,request:p,disconnected:p,reconnecting:p,log:y},this.socketIOEventsListened=["connecting","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message"],this.clientInfo=new _,this.clientInfo.cv=c,this.clientInfo.ua="",this.clientID=Date.now(),this.maxBackoffInMs=12e4,this.state=M.Initial,this.connectionTtlInSecs=0,this.config&&this.config.clientInfo&&(this.clientInfo.hr=u(this.config.clientInfo.hr),this.clientInfo.ua=u(this.config.clientInfo.ua),this.clientInfo.v=u(this.config.clientInfo.v)),this.config&&this.config.telemetrySettings&&"number"==typeof this.config.telemetrySettings.maxBackoffInMs&&this.config.telemetrySettings.maxBackoffInMs>=4e3&&this.config.telemetrySettings.maxBackoffInMs<=12e4&&(this.maxBackoffInMs=this.config.telemetrySettings.maxBackoffInMs),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.logger=new w,this.backoff=new L(this.logger,this.maxBackoffInMs),this.connectionTracker=new k(this.logger,this.config.clientCorrelationID||"",this.config.environment||"",this.clientID,this.clientInfo,this.getServerState.bind(this));try{this.config.eventLogger&&"function"==typeof this.config.eventLogger.logEvent?(this.connectionTracker.eventLogger=this.config.eventLogger,this.connectionTracker.eventLogSettings.enabled=!1,this.connectionTracker.mergeSettings(this.config.telemetrySettings||this.config.clientSettings)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.connectionTracker.eventLogSettings.enabled=!1,this.logger.warn("Trouter client event logging disabled. error in initialization: "+l(e))}}return e.createServer=function(t){return new e(t)},e.prototype.on=function(e,t){return"log"===e&&(this.logger.logFunc=t),this.callbacks[e]||this.logger.warn("assigning a callback that is not used: "+e),this.callbacks[e]=t,this},e.prototype.close=function(){try{this.serverClosed=!0,this.socket&&(this.socket.disconnect(),this.socket=void 0),this.cancelReconnectTimeout(),this.allocRequest&&this.allocRequest.cancel(),this.healthRequest&&this.healthRequest.cancel(),this.backoff.reset(),this.allocateResult=void 0,this.allocationUri="",this.transportType=void 0,this.connectionTracker.close()}catch(e){this.logger.error("exception in close: "+l(e))}},e.prototype.open=function(e,t){try{return this.logger.info("opening server "+e),this.allocationUri?(this.logger.error("server.open failed, already open"),null):e?(this.serverClosed=!1,this.allocationUri=e,this.connectionTracker.trackNewConnection(),"string"==typeof t&&0===t.length?(this.logger.debug("Initial token is empty, retrieving token."),this.getToken(!1)):this.allocateConnection(t),this):(this.logger.error("server.open failed, invalid trouterUrl: "+e),this.connectionTracker.trackError("server","open","invalid trouterUrl: "+e),null)}catch(e){var n="exception in open: "+l(e);return this.logger.error(n),this.connectionTracker.trackError("server","open",n),null}},e.prototype.getServerState=function(){var e=new I;return e.connectionId=this.connectionId,e.connectedClientId=this.connectedClientId,e.domId=this.domId,e.url=this.allocateResult?this.allocateResult.url:"",e.surl=this.allocateResult?this.allocateResult.surl:"",e.ttlInSecs=this.connectionTtlInSecs,e},e.prototype.applyTelemetrySettings=function(e){try{this.connectionTracker.mergeSettings(e)}catch(e){this.logger.debug("got an error while trying to apply telemetry settings "+l(e))}},e.prototype.getTelemetrySettings=function(){return JSON.parse(JSON.stringify(this.connectionTracker.eventLogSettings))},e.prototype.checkConnection=function(){if(this.logger.info("checking connection"),this.state===M.Connected)this.sendPing(),this.logger.debug("checkConnection: sent ping");else{if(this.cancelReconnectTimeout(),this.allocRequest&&this.allocRequest.cancel(),this.healthRequest&&this.healthRequest.cancel(),this.backoff.reset(),this.state===M.Handshaking||this.state===M.Connecting||this.state===M.RetrievingToken)return void this.logger.debug("checkConnection: current trouter state - "+this.getClientState()+" skipping reconnect,probably there is no need to do so");this.logger.debug("checkConnection: current trouter state - "+this.getClientState()+" triggering reconnect"),this.maybeReconnect("checkConnection",null)}},e.prototype.getClientState=function(){return M[this.state]},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var i=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+i+n,t)},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.connectionTracker.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionTracker.connectionAttempt:e},e.prototype.getHealthUrl=function(e){var t=e.lastIndexOf("/a");return e.substring(0,t)+"/h"},e.prototype.saveUrl=function(e){this.url=e,this.urlPath=e.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/")},e.prototype.getToken=function(e){var t=this;if(this.state!==M.RetrievingToken){this.state=M.RetrievingToken,this.connectionTracker.trackStart("token"),this.logger.info("Requesting token with "+(e?"force refresh.":"without force refresh."));var n=this.callbacks.token(e);n.then(function(e){e.length>0?(t.connectionTracker.trackEnd("token"),t.allocateConnection(e)):(t.connectionTracker.trackError("token","empty-token","Empty token",!0),t.logger.warn("Received empty token, retrying."),t.backoff.backoff(function(){t.getToken(!0)}))}),n.catch(function(n){var i=l(n);t.logger.error("Error during token retrieval, retrying. Error="+i),t.connectionTracker.trackError("token","error",i,!0),t.backoff.backoff(function(){t.getToken(e)})})}else this.logger.debug("Already retrieving token")},e.prototype.allocateConnection=function(e){if(this.state!==M.Connected){this.state=M.Allocating,this.logger.info("Allocating new connection"),this.allocRequest&&this.allocRequest.cancel(),this.connectionTracker.trackStart("allocation");var t={"X-Skypetoken":e};this.allocRequest=new D(this.logger,this.config,this.appendCorrelationIds(this.allocationUri,!1),t,"",this.processAllocation.bind(this)),this.allocRequest.go()}else this.logger.info("allocateConnection: already connected")},e.prototype.processAllocation=function(e,t){var n=this;if(401===e)return this.connectionTracker.trackError("allocation","end","Allocation returned 401",!0),this.logger.warn("Received status 401, requesting new token."),void this.backoff.backoff(function(){n.getToken(!0)});if(200!==e)return this.connectionTracker.trackError("allocation","end",e.toString(),!0),this.logger.warn("Received status "+e+", retrying with possibly cached token."),void this.backoff.backoff(function(){n.getToken(!1)});this.connectionTracker.trackEnd("allocation");try{this.allocateResult=JSON.parse(t),this.connectionId=this.allocateResult.id||"",this.logger.ConnectionId=this.connectionId,this.allocateResult.healthUrl?this.healthUrl=this.allocateResult.healthUrl:(this.healthUrl=this.getHealthUrl(this.allocationUri),this.logger.warn("No healthUrl property found when parsing allocation.")),!this.connectedClientId&&this.allocateResult.ccid&&(this.connectedClientId=this.allocateResult.ccid,this.logger.ConnectedClientId=this.connectedClientId,this.allocationUri=this.appendConnectedClientIds(this.allocationUri,!1),this.healthUrl=this.appendConnectedClientIds(this.healthUrl,!1),this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}")),this.connectSocket()}catch(e){var i=l(e);this.connectionTracker.trackError("allocation","processAllocation() Error",i),this.logger.error("processAllocation() error: "+i),this.backoff.backoff(function(){n.getToken(!1)})}},e.prototype.reconnectToOldServer=function(){this.logger.info("reconnectToOldServer"),this.reconnectToOldServerFirst=!1,this.healthRequest&&this.healthRequest.cancel(),this.connectionTracker.trackStart("health"),this.connectionTracker.trackNewConnection(),this.sendHealthRequest()},e.prototype.sendHealthRequest=function(){this.state=M.WaitingHealthCheck,this.healthRequest=new D(this.logger,this.config,this.healthUrl,null,"",this.processHealthRequest.bind(this)),this.healthRequest.go()},e.prototype.processHealthRequest=function(e,t){if(this.state!==M.WaitingHealthCheck)return this.logger.debug("processHealthRequest: not reconnecting, state "+this.getClientState()),void this.connectionTracker.trackEnd("health");e>=200&&e<300?(this.connectionTracker.trackEnd("health"),this.serverClosed?this.logger.info("Server is closed, not reconnecting."):(this.logger.debug("Health request succeeded, reconnecting with old allocation."),this.connectSocket())):(this.logger.warn("Health request failed with status "+e+", backing off for another health check."),this.backoff.backoff(this.sendHealthRequest.bind(this)))},e.prototype.maybeReconnect=function(e,t){try{var n=this.reconnectToOldServerFirst?"reusePrevious":"freshConnection";if(t&&t.socketNumber!==this.currentSocketNumber)return this.connectionTracker.trackError("reconnect",n,"not reconnecting on an old socket. old,new id: "+t.socketNumber+","+this.currentSocketNumber),void this.logger.warn("not reconnecting on an old socket");if(this.serverClosed)return void this.callbacks.disconnected();e&&this.logger.info("Last connection failed, reason: "+e),this.connectionTracker.trackProgress("reconnect",n),this.callbacks.reconnecting(),this.serverClosed||(this.reconnectToOldServerFirst?this.reconnectToOldServer():this.getToken(!1))}catch(e){this.connectionTracker.trackError("reconnect","error",l(e),!0),this.logger.error("exception in maybeReconnect: "+l(e))}},e.prototype.sendPing=function(){if(this.socket)try{this.logger.info("sending ping request"),this.socket.emit("ping",this.handlePong.bind(this))}catch(e){this.logger.error("unable to send ping, error: "+l(e)),!0===this.connectionTracker.eventLogSettings.logSendPingError&&this.connectionTracker.trackError("ping","send",l(e))}},e.prototype.handlePong=function(e){this.logger.info("received pong response"),++this.connectionTracker.connectedInfo.numberOfPingReplies},e.prototype.startPing=function(){this.cancelPing(),this.socket&&"websocket"===this.transportType&&(this.pingIntervalId=setInterval(this.sendPing.bind(this),55e3))},e.prototype.cancelPing=function(){this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=void 0)},e.prototype.cancelReconnectTimeout=function(){this.reconnectTimeoutId&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=void 0)},e.prototype.connectSocket=function(){if(this.state!==M.Connected&&this.state!==M.Connecting&&this.state!==M.Handshaking){this.connectionTracker.trackStart("connectSocket");var e=this.config.ioOptions||new v;this.state=M.Handshaking,e["force new connection"]=!0,e.reconnect=!1;var t=this.allocateResult.connectparams;t.r=this.allocateResult.instance,t.v="v4",t.p=this.allocateResult.instancePort,t.tc=encodeURI(JSON.stringify(this.clientInfo)),t.timeout=55,t.auth="true",e.query=this.appendConnectedClientIds(function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&void 0!==e[n]&&t.push(n+"="+e[n]);return t.join("&")}(t),!0),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+e.query),this.cleanupSocket(),this.cancelReconnectTimeout(),this.reconnectTimeoutId=setTimeout(this.onReconnectTimeout.bind(this),12e4),this.socket=(this.config.io||a).connect(this.allocateResult.socketio,e),this.socket?(this.socket.socketNumber=++this.currentSocketNumber,this.socket.on(g[g.connecting],f.GetCallback(this.socket,this.onSocketConnecting.bind(this))),this.socket.on(g[g.connect],f.GetCallback(this.socket,this.onSocketConnect.bind(this))),this.socket.on(g[g.connect_failed],f.GetCallback(this.socket,this.onSocketConnectFailed.bind(this))),this.socket.on(g[g.disconnect],f.GetCallback(this.socket,this.onSocketDisconnect.bind(this))),this.socket.on(g[g.reconnect],f.GetCallback(this.socket,this.onSocketReconnect.bind(this))),this.socket.on(g[g.reconnect_failed],f.GetCallback(this.socket,this.onSocketReconnectFailed.bind(this))),this.socket.on(g[g.reconnecting],f.GetCallback(this.socket,this.onSocketReconnecting.bind(this))),this.socket.on(g[g.error],f.GetCallback(this.socket,this.onSocketError.bind(this))),this.socket.on(g[g.message],f.GetCallback(this.socket,this.onSocketMessage.bind(this))),this.socket.on(g[g["trouter.connected"]],f.GetCallback(this.socket,this.onTrouterConnected.bind(this)))):this.logger.error("Unable create socket.io")}else this.logger.info("connectSocket: not connecting as state is "+this.getClientState())},e.prototype.onReconnectTimeout=function(){this.state!==M.Connecting?(this.connectionTracker.trackProgress("reconnectTimeout","restarting"),this.maybeReconnect(null,null)):(this.connectionTracker.trackProgress("reconnectTimeout","preempted: "+this.transportType),this.logger.info("reconnecting preempted while connecting"))},e.prototype.onSocketConnecting=function(e,t){this.state=M.Connecting,this.logger.info("connecting using transportType: "+t),this.transportType=t,this.connectionTracker.trackProgress("connecting",this.transportType)},e.prototype.onSocketConnect=function(e){try{this.serverClosed&&(this.logger.info("onSocketConnect: Disconnect requested, disconnecting socket."),this.socket&&this.socket.disconnect())}catch(e){var t="exception in socket.on connect: "+l(e);this.logger.error(t),this.connectionTracker.trackError("connectSocket","connectHandler",t)}},e.prototype.onSocketConnectFailed=function(e,t){this.state=M.Disconnected,this.cancelPing(),this.cancelReconnectTimeout(),this.logger.error("connect_failed"),this.connectionTracker.trackError("connect_failed",this.transportType||"",t,!0),this.maybeReconnect(t,e)},e.prototype.onSocketDisconnect=function(e){this.state=M.Disconnected,this.connectionTtlInSecs=0,this.connectDurationInMs="",this.cancelPing(),this.cancelReconnectTimeout(),this.logger.info("disconnected"),this.connectionTracker.trackDisconnected({serverClosed:this.serverClosed}),this.connectionTracker.clearConnectedInfo(),this.maybeReconnect(null,e)},e.prototype.onSocketReconnect=function(e){this.state=M.Connected,this.startPing(),this.logger.info("reconnect")},e.prototype.onSocketReconnectFailed=function(e,t){this.state=M.Disconnected,this.cancelPing(),this.cancelReconnectTimeout(),this.logger.error("reconnect_failed"),this.connectionTracker.trackError("reconnect_failed",this.transportType||"",t,!0),this.maybeReconnect(t,e)},e.prototype.onSocketReconnecting=function(e){this.state=M.Connecting,this.cancelPing(),this.logger.info("reconnecting")},e.prototype.onSocketError=function(e,t){var n=this;this.cancelPing(),this.logger.error("error from socket.io: "+t),this.state!==M.Connecting?(this.logger.debug("Backing off to reconnect."),this.cancelReconnectTimeout(),this.connectionTracker.trackError("connectSocket","socketio.error",t,!0),this.backoff.backoff(function(){n.maybeReconnect(t,e)})):(this.connectionTracker.trackProgress("connectSocket","preempted:"+this.transportType),this.logger.debug("reconnecting preempted while connecting"))},e.prototype.onSocketMessage=function(e,t){var n;try{n=new O(t),this.logger.info("Received request N "+n.id+" to '"+n.url+"'")}catch(e){return this.logger.error("unable to parse request, error: "+l(e)+", request:'"+t+"'"),this.connectionTracker.trackRequest(null,this.logger.error.toString()),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e.message,null,null)}try{var i=void 0;n.startTS=Date.now(),n.url&&0===n.url.indexOf(this.urlPath)&&(n.shortUrl="/"+n.url.substring(this.urlPath.length)),this.connectionTracker.trackRequest(n),this.logger.debug("request: "+JSON.stringify(n)),i=new N(n,new P(n.id),this.sendResponse.bind(this)),this.callbacks.request(n,i)}catch(e){this.logger.error("exception in socket.on message: "+l(e)),this.connectionTracker.sendResponseError(e.message,n,null)}},e.prototype.onTrouterConnected=function(e,t){var n,i;this.state=M.Connected,this.cancelReconnectTimeout(),this.backoff.reset(),this.connectionTtlInSecs=t.ttl,this.connectDurationInMs=t.dur,n=this.allocateResult.url,i=this.url!==n,this.reconnectToOldServerFirst=!0,this.logger.info("connected: "+n),this.saveUrl(n),this.startPing(),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(i,this.transportType||""),this.callbacks.ready(n,i)},e.prototype.sendResponse=function(e,t){this.logger.info("Sending response for request N "+e.id+" with status "+t.status),t.headers=t.headers||{},e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var n=d()-e.startTS;if(t.headers["trouter-client"]=JSON.stringify({cd:n}),this.logger.debug("response: "+JSON.stringify(t)),this.socket)try{this.socket.send(JSON.stringify(t)),t.sentTS=Date.now(),this.connectionTracker.trackResponse(e,t,n)}catch(n){var i="unable to send data on response.end, err: "+l(n);this.logger.error(i),this.connectionTracker.sendResponseError(i,e,t)}else this.connectionTracker.sendResponseError("no socket",e,t)},e.prototype.cleanupSocket=function(){if(this.socket){this.logger.info("clearing previous socket");for(var e=0,t=this.socketIOEventsListened;e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}try{this.socket.disconnect(),this.logger.debug("cleared previous socket"),this.socket=void 0,this.transportType=void 0}catch(e){this.logger.error("exception in disconnecting previous socket: "+l(e))}}},e}();t.default=U},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(1),o=n(18),a=n(20),s=function(){function e(e,t,n,o,s){var c=this;this.logFunc=e,this.options=t,this.tokenProvider=n,this.messageHandlers=o,this.trouterUrlPromise=s,this.onStateChanged=function(e){c.stateCallback=e},this.logger=new r.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+i.toJson(this.options)),this.fsm=new a.TrouterManagerFsm(e,this)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(){this.fsm.stop()},e.prototype.networkIsAvailable=function(){void 0!==this.firstConnection&&this.firstConnection.networkIsAvailable(),void 0!==this.secondConnection&&this.secondConnection.networkIsAvailable()},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.registerMessageHandler=function(e){this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.messageHandlers.clear()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){this.firstConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.firstConnection.start()},e.prototype.startSecondConnection=function(){this.secondConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.secondConnection.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.firstConnection.stop(e),this.storedFirstConnection=this.firstConnection,this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){void 0!==this.firstConnection&&(this.trouterUrlPromise.resolveUrl(this.firstConnection.getServerState().surl),void 0!==this.stateCallback&&this.stateCallback(this.getState(),this.firstConnection.getServerState().surl))},e.prototype.dispatchReconnecting=function(){void 0!==this.stateCallback&&this.stateCallback(this.getState(),"")},e.prototype.dispatchStopped=function(){void 0!==this.stateCallback&&this.stateCallback(this.getState(),"")},e.prototype.onDownstreamRequest=function(e,t,n){var i=this.buildMessage(t),r=this.messageHandlers.handleMessage(i);n.writeHead(r.resultCode,r.responseHeaders),n.end(r.responseBody)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e){this.fsm.onReconnectionRequired(e===this.firstConnection)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection)},e.prototype.getEventIdFromRequestBody=function(e){return e&&(e.evt||e.eventId)||null},e.prototype.buildMessage=function(e){var t,n=null;try{t=JSON.parse(e.body),n=this.getEventIdFromRequestBody(t)}catch(e){}return{eventId:n,url:e.url,body:t,rawBody:e.body,headers:e.headers}},e}();t.TrouterManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=i},function(module,exports,__webpack_require__){(function(global,module){var t,e,n;t=module.exports,e=void 0===global?window:global,n=t,n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,i){var r,o,a=n.util.parseUri(t);e&&e.location&&(a.protocol=a.protocol||e.location.protocol.slice(0,-1),a.host=a.host||(e.document?e.document.domain:e.location.hostname),a.port=a.port||e.location.port),r=n.util.uniqueUri(a);var s={host:a.host,secure:"https"==a.protocol,port:a.port||("https"==a.protocol?443:80),query:a.query||""};return n.util.merge(s,i),!s["force new connection"]&&n.sockets[r]||(o=new n.Socket(s)),!s["force new connection"]&&o&&(n.sockets[r]=o),(o=o||n.sockets[r]).of(a.path.length>1?a.path:"")};var io=module.exports;!function(e,t){var n=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,i=e.host,r=e.port;return"document"in t?(i=i||document.domain,r=r||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(i=i||"localhost",r||"https"!=n||(r=443)),(n||"http")+"://"+i+":"+(r||80)},n.query=function(e,t){var i=n.chunkQuery(e||""),r=[];for(var o in n.merge(i,n.chunkQuery(t||"")),i)i.hasOwnProperty(o)&&r.push(o+"="+i[o]);return r.length?"?"+r.join("&"):""},n.chunkQuery=function(e){for(var t,n={},i=e.split("&"),r=0,o=i.length;r<o;++r)(t=i[r].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,i){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,i)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,i,r){var o,a=r||[],s=void 0===i?2:i;for(o in t)t.hasOwnProperty(o)&&n.indexOf(a,o)<0&&("object"==typeof e[o]&&s?n.merge(e[o],t[o],s-1,a):(e[o]=t[o],a.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var i=[],r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=0,s=o.length;a<s;a++)~n.indexOf(r,o[a])&&i.push(o[a]);return i},n.indexOf=function(e,t,n){for(var i=e.length,n=n<0?n+i<0?0:n+i:n||0;n<i&&e[n]!==t;n++);return i<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return void 0!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){i.removeListener(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var i=this.$events[e];if(t.util.isArray(i)){for(var r=-1,o=0,a=i.length;o<a;o++)if(i[o]===n||i[o].listener&&i[o].listener===n){r=o;break}if(r<0)return this;i.splice(r,1),i.length||delete this.$events[e]}else(i===n||i.listener&&i.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,i);else{if(!t.util.isArray(n))return!1;for(var r=n.slice(),o=0,a=r.length;o<a;o++)r[o].apply(this,i)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,a,s=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)a[n]=str(n,c)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&(i=rep[n],(r=str(i,c))&&a.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c))&&a.push(quote(i)+(gap?": ":":")+r);return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},i=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],a=t.JSON,s=t.util.indexOf;n.encodePacket=function(e){var t=s(i,e.type),n=e.id||"",c=e.endpoint||"",l=e.ack,u=null;switch(e.type){case"error":var d=e.reason?s(r,e.reason):"",p=e.advice?s(o,e.advice):"";""===d&&""===p||(u=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":var h={name:e.name};e.args&&e.args.length&&(h.args=e.args),u=a.stringify(h);break;case"json":u=a.stringify(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+a.stringify(e.args):"")}var f=[t,n+("data"==l?"+":""),c];return null!==u&&void 0!==u&&f.push(u),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,i=e.length;n<i;n++)t+="ï¿½"+e[n].length+"ï¿½"+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(c);if(!t)return{};var n=t[2]||"",e=t[5]||"",s={type:i[t[1]],endpoint:t[4]||""};switch(n&&(s.id=n,t[3]?s.ack="data":s.ack=!0),s.type){case"error":var t=e.split("+");s.reason=r[t[0]]||"",s.advice=o[t[1]]||"";break;case"message":s.data=e||"";break;case"event":try{var l=a.parse(e);s.name=l.name,s.args=l.args}catch(e){}s.args=s.args||[];break;case"json":try{s.data=a.parse(e)}catch(e){}break;case"connect":s.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(s.ackId=t[1],s.args=[],t[3]))try{s.args=t[3]?a.parse(t[3]):[]}catch(e){}}return s},n.decodePayload=function(e){if("ï¿½"==e.charAt(0)){for(var t=[],i=1,r="";i<e.length;i++)"ï¿½"==e.charAt(i)?(t.push(n.decodePacket(e.substr(i+1).substr(0,r))),i+=Number(r)+1,r=""):r+=e.charAt(i);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var i=0,r=n.length;i<r;i++)this.onPacket(n[i])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.open=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.open=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var i=this;t.util.on(n,"unload",function(){i.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=i,t.util.mixin(i,t.EventEmitter),i.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},i.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},i.prototype.handshake=function(e){function n(t){t instanceof Error?i.onError(t.message):e.apply(null,t.split(":"))}var i=this,o=this.options,a=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var s=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=a+"&jsonp="+t.j.length,s.parentNode.insertBefore(c,s),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var l=t.util.request();l.open("GET",a,!0),l.withCredentials=!0,l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=r,200==l.status?n(l.responseText):!i.reconnecting&&i.onError(l.responseText))},l.send(null)}},i.prototype.getTransport=function(e){for(var n,i=e||this.transports,r=0;n=i[r];r++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},i.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(i,r,o,a){function s(){if(!n.connected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(s),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){s()},n.options["connect timeout"]))})}n.sessionid=i,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*r+2e3,n.transports=a?t.util.intersect(a.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},i.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},i.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},i.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},i.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},i.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},i.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},i.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},i.prototype.onOpen=function(){this.open=!0},i.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},i.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},i.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},i.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},i.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=r}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=i?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,i=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new i(this,"json"),this.ackPackets=0,this.acks={}}function i(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],i={type:"event",name:e};return"function"==typeof n&&(i.id=++this.ackPackets,i.ack="data",this.acks[i.id]=n,t=t.slice(0,t.length-1)),i.args=t,this.packet(i)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":var r=[e.name].concat(e.args);"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},i.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},i.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){t.Transport.apply(this,arguments)}function r(){}e.websocket=i,t.util.inherit(i,t.Transport),i.prototype.name="websocket",i.prototype.open=function(e){var i,r=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+r),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},i.prototype.send=function(e){return this.websocket.send(e),this},i.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},i.prototype.close=function(){return this.websocket.close(),this},i.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},i.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},i.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},i.xdomainCheck=function(){return!0},i.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=r),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}e.XHR=i,t.util.inherit(i,t.Transport),i.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},i.prototype.payload=function(e){for(var n=[],i=0,r=e.length;i<r;i++)n.push(t.parser.encodePacket(e[i]));this.send(t.parser.encodePayload(n))},i.prototype.send=function(e){return this.post(e),this},i.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=r,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},i.prototype.close=function(){return this.onClose(),this},i.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),i=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+i,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},i.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},i.check=function(e,i){try{var r=t.util.request(i),o=n.XDomainRequest&&r instanceof XDomainRequest,a=e&&e.options&&e.options.secure?"https:":"http:",s=a!=n.location.protocol;if(r&&(!o||!s))return!0}catch(e){}return!1},i.xdomainCheck=function(){return i.check(null,!0)},i.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=r),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(){t.Transport.XHR.apply(this,arguments)}function r(){}e["xhr-polling"]=i,t.util.inherit(i,t.Transport.XHR),t.util.merge(i,t.Transport.XHR),i.prototype.name="xhr-polling",i.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},i.prototype.get=function(){if(this.open){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=r,this.onerror=r,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},i.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(e){}this.xhr=null}},i.prototype.ready=function(e,n){var i=this;t.util.defer(function(){n.call(i)})},i.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(6)(module))},function(module,exports,__webpack_require__){(function(global,module){var t,e,n;t=module.exports,e=void 0===global?window:global,n=t,n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,i){var r,o,a=n.util.parseUri(t);e&&e.location&&(a.protocol=a.protocol||e.location.protocol.slice(0,-1),a.host=a.host||(e.document?e.document.domain:e.location.hostname),a.port=a.port||e.location.port),r=n.util.uniqueUri(a);var s={host:a.host,secure:"https"==a.protocol,port:a.port||("https"==a.protocol?443:80),query:a.query||""};return n.util.merge(s,i),!s["force new connection"]&&n.sockets[r]||(o=new n.Socket(s)),!s["force new connection"]&&o&&(n.sockets[r]=o),(o=o||n.sockets[r]).of(a.path.length>1?a.path:"")};var io=module.exports;!function(e,t){var n=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,i=e.host,r=e.port;return"document"in t?(i=i||document.domain,r=r||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(i=i||"localhost",r||"https"!=n||(r=443)),(n||"http")+"://"+i+":"+(r||80)},n.query=function(e,t){var i=n.chunkQuery(e||""),r=[];for(var o in n.merge(i,n.chunkQuery(t||"")),i)i.hasOwnProperty(o)&&r.push(o+"="+i[o]);return r.length?"?"+r.join("&"):""},n.chunkQuery=function(e){for(var t,n={},i=e.split("&"),r=0,o=i.length;r<o;++r)(t=i[r].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,i){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,i)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,i,r){var o,a=r||[],s=void 0===i?2:i;for(o in t)t.hasOwnProperty(o)&&n.indexOf(a,o)<0&&("object"==typeof e[o]&&s?n.merge(e[o],t[o],s-1,a):(e[o]=t[o],a.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var i=[],r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=0,s=o.length;a<s;a++)~n.indexOf(r,o[a])&&i.push(o[a]);return i},n.indexOf=function(e,t,n){for(var i=e.length,n=n<0?n+i<0?0:n+i:n||0;n<i&&e[n]!==t;n++);return i<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return void 0!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){i.removeListener(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var i=this.$events[e];if(t.util.isArray(i)){for(var r=-1,o=0,a=i.length;o<a;o++)if(i[o]===n||i[o].listener&&i[o].listener===n){r=o;break}if(r<0)return this;i.splice(r,1),i.length||delete this.$events[e]}else(i===n||i.listener&&i.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,i);else{if(!t.util.isArray(n))return!1;for(var r=n.slice(),o=0,a=r.length;o<a;o++)r[o].apply(this,i)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,a,s=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)a[n]=str(n,c)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&(i=rep[n],(r=str(i,c))&&a.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c))&&a.push(quote(i)+(gap?": ":":")+r);return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},i=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],a=t.JSON,s=t.util.indexOf;n.encodePacket=function(e){var t=s(i,e.type),n=e.id||"",c=e.endpoint||"",l=e.ack,u=null;switch(e.type){case"error":var d=e.reason?s(r,e.reason):"",p=e.advice?s(o,e.advice):"";""===d&&""===p||(u=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":var h={name:e.name};e.args&&e.args.length&&(h.args=e.args),u=a.stringify(h);break;case"json":u=a.stringify(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+a.stringify(e.args):"")}var f=[t,n+("data"==l?"+":""),c];return null!==u&&void 0!==u&&f.push(u),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,i=e.length;n<i;n++)t+="ï¿½"+e[n].length+"ï¿½"+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(c);if(!t)return{};var n=t[2]||"",e=t[5]||"",s={type:i[t[1]],endpoint:t[4]||""};switch(n&&(s.id=n,t[3]?s.ack="data":s.ack=!0),s.type){case"error":var t=e.split("+");s.reason=r[t[0]]||"",s.advice=o[t[1]]||"";break;case"message":s.data=e||"";break;case"event":try{var l=a.parse(e);s.name=l.name,s.args=l.args}catch(e){}s.args=s.args||[];break;case"json":try{s.data=a.parse(e)}catch(e){}break;case"connect":s.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(s.ackId=t[1],s.args=[],t[3]))try{s.args=t[3]?a.parse(t[3]):[]}catch(e){}}return s},n.decodePayload=function(e){if("ï¿½"==e.charAt(0)){for(var t=[],i=1,r="";i<e.length;i++)"ï¿½"==e.charAt(i)?(t.push(n.decodePacket(e.substr(i+1).substr(0,r))),i+=Number(r)+1,r=""):r+=e.charAt(i);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var i=0,r=n.length;i<r;i++)this.onPacket(n[i])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.open=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.open=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var i=this;t.util.on(n,"unload",function(){i.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=i,t.util.mixin(i,t.EventEmitter),i.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},i.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},i.prototype.handshake=function(e){function n(t){t instanceof Error?i.onError(t.message):e.apply(null,t.split(":"))}var i=this,o=this.options,a=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var s=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=a+"&jsonp="+t.j.length,s.parentNode.insertBefore(c,s),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var l=t.util.request();l.open("GET",a,!0),l.withCredentials=!0,l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=r,200==l.status?n(l.responseText):!i.reconnecting&&i.onError(l.responseText))},l.send(null)}},i.prototype.getTransport=function(e){for(var n,i=e||this.transports,r=0;n=i[r];r++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},i.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(i,r,o,a){n.sessionid=i,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*r+2e3,n.transports=a?t.util.intersect(a.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),function e(t){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(t),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){n.remainingTransports||(n.remainingTransports=n.transports.slice(0));for(var t=n.remainingTransports;t.length>0&&t.splice(0,1)[0]!=n.transport.name;);t.length?e(t):n.publish("connect_failed")}},n.options["connect timeout"]))})}(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},i.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},i.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},i.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},i.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},i.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},i.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},i.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},i.prototype.onOpen=function(){this.open=!0},i.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},i.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},i.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},i.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},i.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=r}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=i?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,i=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new i(this,"json"),this.ackPackets=0,this.acks={}}function i(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],i={type:"event",name:e};return"function"==typeof n&&(i.id=++this.ackPackets,i.ack="data",this.acks[i.id]=n,t=t.slice(0,t.length-1)),i.args=t,this.packet(i)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":var r=[e.name].concat(e.args);"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},i.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},i.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){t.Transport.apply(this,arguments)}function r(){}e.websocket=i,t.util.inherit(i,t.Transport),i.prototype.name="websocket",i.prototype.open=function(){var e,i=t.util.query(this.socket.options.query),r=this;return e||(e=n.MozWebSocket||n.WebSocket),this.websocket=new e(this.prepareUrl()+i),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},i.prototype.send=function(e){return this.websocket.send(e),this},i.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},i.prototype.close=function(){return this.websocket.close(),this},i.prototype.onError=function(e){this.socket.onError(e)},i.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},i.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},i.xdomainCheck=function(){return!0},i.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=r),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}e.XHR=i,t.util.inherit(i,t.Transport),i.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},i.prototype.payload=function(e){for(var n=[],i=0,r=e.length;i<r;i++)n.push(t.parser.encodePacket(e[i]));this.send(t.parser.encodePayload(n))},i.prototype.send=function(e){return this.post(e),this},i.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=r,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},i.prototype.close=function(){return this.onClose(),this},i.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),i=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+i,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},i.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},i.check=function(e,i){try{var r=t.util.request(i),o=n.XDomainRequest&&r instanceof XDomainRequest,a=e&&e.options&&e.options.secure?"https:":"http:",s=a!=n.location.protocol;if(r&&(!o||!s))return!0}catch(e){}return!1},i.xdomainCheck=function(){return i.check(null,!0)},i.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=r),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(){t.Transport.XHR.apply(this,arguments)}function r(){}e["xhr-polling"]=i,t.util.inherit(i,t.Transport.XHR),t.util.merge(i,t.Transport.XHR),i.prototype.name="xhr-polling",i.prototype.open=function(){return t.Transport.XHR.prototype.open.call(this),!1},i.prototype.get=function(){if(this.open){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=r,this.onerror=r,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose()}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(e.onData(this.responseText),e.get()):e.onClose())},this.xhr.send(null)}},i.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(e){}this.xhr=null}},i.prototype.ready=function(e,n){var i=this;t.util.defer(function(){n.call(i)})},i.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i,t.util.inherit(i,t.Transport["xhr-polling"]),i.prototype.name="jsonp-polling",i.prototype.post=function(e){function n(){i(),r.socket.setBuffer(!1)}function i(){r.iframe&&r.form.removeChild(r.iframe);try{a=document.createElement('<iframe name="'+r.iframeId+'">')}catch(e){(a=document.createElement("iframe")).name=r.iframeId}a.id=r.iframeId,r.form.appendChild(a),r.iframe=a}var r=this,o=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var a,s=document.createElement("form"),c=document.createElement("textarea"),l=this.iframeId="socketio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.display="none",s.target=l,s.method="POST",s.setAttribute("accept-charset","utf-8"),c.name="d",s.appendChild(c),document.body.appendChild(s),this.form=s,this.area=c}this.form.action=this.prepareUrl()+o,i(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(e){}this.iframe.attachEvent?a.onreadystatechange=function(){"complete"==r.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+i,n.onerror=function(){e.onClose()};var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o),this.script=n,r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype._=function(e){return this.onData(e),this.open&&this.get(),this},i.prototype.ready=function(e,n){var i=this;if(!r)return n.call(this);t.util.load(function(){n.call(i)})},i.check=function(){return"document"in n},i.xdomainCheck=function(){return!0},i.prototype.clearEventHandlers=function(){return t.Transport["xhr-polling"].prototype.clearEventHandlers.call(this),this.script&&(this.script.onerror=function(){}),this},t.transports.push("jsonp-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(6)(module))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(){f&&p&&(f=!1,p.length?h=p.concat(h):g=-1,h.length&&a())}function a(){if(!f){var e=r(o);f=!0;for(var t=h.length;t;){for(p=h,h=[];++g<t;)p&&p[g].run();g=-1,t=h.length}p=null,f=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===i||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var l,u,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{u="function"==typeof clearTimeout?clearTimeout:i}catch(e){u=i}}();var p,h=[],f=!1,g=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new s(e,t)),1!==h.length||f||r(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r,o,a=n(2),s=n(0),c=n(1),l=function(e){this.id=e,this.status=200,this.headers={},this.body=""};t.ResponseData=l,function(e){e[e.Connected=0]="Connected",e[e.Disconnected=1]="Disconnected",e[e.Error=2]="Error",e[e.Progress=3]="Progress",e[e.Response=4]="Response",e[e.Request=5]="Request",e[e.Registration=6]="Registration",e[e.Unregistration=7]="Unregistration"}(o=t.ClientEventName||(t.ClientEventName={}));var u=((r={})[o.Connected]="trouter_js_client_connected",r[o.Disconnected]="trouter_js_client_disconnected",r[o.Error]="trouter_js_client_error",r[o.Progress]="trouter_js_client_progress",r[o.Response]="trouter_js_client_response",r[o.Request]="trouter_js_client_request",r[o.Registration]="trouter_js_client_registration",r[o.Unregistration]="trouter_js_client_unregistration",r),d=function(){};t.TrackerStep=d;var p=function(){};t.Properties=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.connectionNumber=0,t}return i(t,e),t}(p),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(p),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(p),m=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4;for(var e=0,t=Object.keys(o).map(function(e){return o[e]}).filter(function(e){return"number"==typeof e});e<t.length;e++){var n=t[e];this[u[n]]=!1}},_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(p);t.ServerState=_;var v=function(){function e(e,t,n,i,r,o){this.clientId=t,this.clientInfo=n,this.getServerState=i,this.clientCorrelationID=r,this.environment=o,this.logger=new c.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==r?r:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new a.Timespan,this.eventLogSettings=new m,this.connectedInfo=new h}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.overrideAsBool=function(e,t){!this.eventLogSettings.hasOwnProperty(e)||!0!==t[e]&&!1!==t[e]||(this.eventLogSettings[e]=t[e])},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(o.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){e.properties=void 0!==e.properties?e.properties:{};for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];t.hasOwnProperty(r)&&void 0!==t[r]&&(e.properties[r.replace(/-/g,"_")]={value:t[r]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[u[e]]&&void 0!==this.eventLogger){var i={name:u[e],properties:{connectionAttempt:{value:this.connectionAttempt},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:JSON.stringify(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:s.CLIENT_VERSION},ua:{value:this.clientInfo.ua}}};this.copyProperties(i,this.getServerState()),this.copyProperties(i,t),this.copyProperties(i,this.connectedInfo),this.eventLogger.logEvent(i)}}catch(t){this.logger.warn("error in sending event "+e+": "+JSON.stringify(t))}},e.prototype.createStep=function(e,t,n){var i=new d;return i.stepName=e,i.operation=t,i.delta=this.beginTimestamp.duration(),i.ts=Date.now(),i.error=n,i},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var i=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(o.Progress,{reason:"flush"},i)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,i){void 0===i&&(i=!1),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(!0===i&&this.addStep(e,t,n),this.sendTelemetry(o.Error,{},[this.createStep(e,t,n)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),i=this.totalStepCount,r=this.beginTimestamp.duration();this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(o.Connected,{stepCount:n.length,totalStepCount:i,connectionEstablishmentMs_Total:r},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(o.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n=new f;void 0!==t&&(n.hasError=!0,n.error=t);try{n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS;for(var i=e.headers,r=0,a=Object.keys(i);r<a.length;r++){var s=a[r];i.hasOwnProperty(s)&&(n[s]=i[s])}}catch(e){n.hasError=!0,n.error=n.error+"error creating request context "+JSON.stringify(e)}this.sendTelemetry(o.Request,n,[])},e.prototype.trackResponse=function(e,t,n,i){var r=new g;void 0!==i&&(r.hasError=!0,r.error=i);try{r.requestID=e.id,r.httpMethod=e.method,r.shortUrl=e.shortUrl,r.responseTimestamp=void 0!==n?n.sentTS:Date.now();for(var a=e.headers,s=0,c=Object.keys(a);s<c.length;s++){var l=c[s];a.hasOwnProperty(l)&&(r[l]=a[l])}n&&(r.latencyMS=t,r.responseCode=n.status,r.responseLength=n.body.length)}catch(e){r.hasError=!0,r.error=r.error+"error creating response context "+JSON.stringify(e)}this.sendTelemetry(o.Response,r,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,null,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(void 0!==e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0)),this.eventLogSettings.sendProgressTimeoutSecs=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0)),this.overrideAsBool("enabled",e),this.overrideAsBool("logHealthCheckError",e);for(var t=Object.keys(o).map(function(e){return o[e]}),n=0,i=t;n<i.length;n++){var r=i[n];"number"==typeof r&&this.overrideAsBool(u[r],e)}this.overrideAsBool("logSendPingError",e),this.resetProgressSendTimer()}},e}();t.ConnectionTracker=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),i=1e3*Math.pow(2,e)*n;return i=Math.round(i),Math.min(t,i)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var i=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var r=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+r+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout(function(){i.logger.info("Back off for "+t+" with ID "+i.backoffId+" complete, invoking handler"),i.timerHandle=void 0,n()},r)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(2),o=n(16),a=n(0),s=n(17),c=n(1),l=n(19),u=n(13),d=function(){this.cv=a.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},p=function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3},h=function(){function e(e){void 0!==e&&this.init(e)}return e.prototype.init=function(e){var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:""},e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e}(),f=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),g=function(){function e(e,t,n,i){var u=this;this.options=t,this.manager=n,this.tokenProvider=i,this.connectionErrors=0,this.connectionId="",this.connectionTtlInSecs=0,this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.logger=new c.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new s.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new s.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),this.healthUrl=this.options.trouterUrl,"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new d,this.clientInfo.cv=a.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.hr=this.safeString(this.options.clientInfo.hr),this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new o.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return u.getServerState()},this.options.clientCorrelationID,this.options.environment);try{this.options.eventLogger&&"function"==typeof this.options.eventLogger.logEvent?(this.connectionTracker.mergeSettings(this.options.telemetrySettings||this.options.clientSettings),this.connectionTracker.enable(this.options.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.connectionTracker.disable(),this.logger.warn("Trouter client event logging disabled. error in initialization: "+r.toJson(e))}var p=this.options.incallModeTimeoutMs>0;this.fsm=new l.TrouterFsm(e,this,p)}return e.prototype.start=function(){this.logger.info("Starting"),this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.networkIsAvailable=function(){this.logger.info("networkIsAvailable called"),this.fsm.networkIsAvailable()},e.prototype.getServerState=function(){var e=new o.ServerState;return e.connectionId=this.connectionId,e.connectedClientId=this.connectedClientId,e.domId=this.domId,e.url=this.allocateResult?this.allocateResult.url:"",e.surl=this.allocateResult?this.allocateResult.surl:"",e.ttlInSecs=this.connectionTtlInSecs,e},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var i=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then(function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)}).catch(function(t){var i=r.toJson(t);n.logger.error("Error getting token - retry after timeout: "+i),n.connectionTracker.trackError("token","error",i,!0),n.getToken(e,!0)})};t?this.tokenBackoff.backoff("getting token",i):(this.tokenBackoff.reset(),i())},e.prototype.startConnectionTimer=function(){var e=this;this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration.registrarUrl},e.prototype.hasCustomRegisterTtl=function(){return void 0!==this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;if(void 0===this.registrationTimerId){var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=void 0,e.fsm.onRegistrationTimeout()},1e3*t)}else this.logger.error("Another registration timer is set - don't create another one")},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.buildSocketIoUrlParams=function(){var e=this.allocateResult.connectparams;return e.r=this.allocateResult.instance,e.v="v4",e.p=this.allocateResult.instancePort,e.tc=encodeURI(r.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket");var t=this.options.ioOptions||new p;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||u).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",function(t){e.onSocketConnecting(t)}),this.socket.on("connect",function(){e.onSocketConnect()}),this.socket.on("connect_failed",function(t){e.onSocketConnectFailed(t)}),this.socket.on("disconnect",function(){e.onSocketDisconnect()}),this.socket.on("reconnect",function(){e.onSocketReconnect()}),this.socket.on("reconnect_failed",function(t){e.onSocketReconnectFailed(t)}),this.socket.on("reconnecting",function(){e.onSocketReconnecting()}),this.socket.on("error",function(t){e.onSocketError(t)}),this.socket.on("message",function(t){e.onSocketMessage(t)}),this.socket.on("trouter.connected",function(t){e.onTrouterConnected(t)}),this.socket.on("trouter.reconnect",function(){e.onTrouterReconnect()})},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket: "+r.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching connected"),this.manager.onRegistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new f(e,new o.ResponseData(e.id),function(e,n){t.logger.info("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message: "+r.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n=this.appendCorrelationIds(this.options.trouterUrl,!1),i=new Request(n,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.options.userAgent&&i.headers.append("User-Agent",this.options.userAgent),this.logger.info("sendAllocateRequest: POST "+n),this.connectionTracker.trackStart("allocation"),this.fetchWithTimeout(i,this.timeoutOptions.fetchTimeoutMs).then(function(e){if(401===e.status)throw{message:e.statusText||"Request not authorized",status:401};if(200!==e.status)throw new Error("Response status "+e.status+" "+e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type "+n+" is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(e){t.onAllocationResponse(e)}).catch(function(e){t.logger.error("Allocation request failed with "+e.message),t.connectionTracker.trackError("allocation","end",e.message,!0),t.fsm.onAllocationFailed(e.status&&401===e.status)})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",function(){e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var t=r.toJson(e.stack);this.logger.error("unable to send ping, error: "+t),this.connectionTracker.trackError("ping","send",t)}},e.prototype.sendRegisterRequest=function(e){var t=this;this.logger.info("sending register request");var n=new r.Timespan,i={clientDescription:{appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion},registrationId:this.options.registration.registrationId,nodeId:"",transports:{TROUTER:[{context:"",path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}},a=new Request(this.options.registration.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"content-type":"application/json",accept:"application/json, text/javascript"}),body:r.toJson(i)});this.connectionTracker.trackStart("registration"),this.fetchWithTimeout(a,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onRegisterResponse: status "+e.status),t.connectionTracker.trackEnd("registration"),t.fsm.onRegistrationSucceed()):(t.logger.error("Error status in register response: "+e.status),t.connectionTracker.trackError("registration","registration",e.status.toString()),t.fsm.onRegistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending register request: "+e.message),t.fsm.onRegistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:-1,duration:n.duration()},[])})},e.prototype.sendUnregisterRequest=function(e){var t=this;this.logger.info("sending unregister request");var n=new r.Timespan,i=new Request(this.options.registration.registrarUrl+"/"+this.options.registration.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({"X-Skypetoken":e,accept:"application/json, text/javascript"})});this.connectionTracker.trackStart("unregistration"),this.fetchWithTimeout(i,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onUnregisterResponse: status "+e.status),t.connectionTracker.trackEnd("unregistration"),t.fsm.onUnregistrationSucceed()):(t.logger.error("Error status in unregister response: "+e.status),t.connectionTracker.trackError("unregistration","unregistration",e.status.toString()),t.fsm.onUnregistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending unregister request: "+e.message),t.fsm.onUnregistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:-1,duration:n.duration()},[])})},e.prototype.fetchWithTimeout=function(e,t){return new i.Promise(function(n,i){fetch(e).then(n).catch(i),0!==t&&setTimeout(i,t,new Error("Fetch for '"+e.url+"' timed out"))})},e.prototype.sendHealthRequest=function(e){var t=this;this.logger.info("sending health request "+(e?"with backoff":"without backoff"));var n=new Request(this.healthUrl,{method:"POST",mode:"cors",headers:new Headers});this.options.userAgent&&n.headers.append("User-Agent",this.options.userAgent);var i=function(){t.logger.info("sendHealthRequest: POST "+n.url),t.connectionTracker.trackStart("health"),t.fetchWithTimeout(n,t.timeoutOptions.fetchTimeoutMs).then(function(e){if(!e.ok)throw new Error("Response status "+e.status+" "+e.statusText);t.connectionTracker.trackEnd("health"),t.logger.info("Health check request succeed"),t.fsm.onHealthSucceed()}).catch(function(e){t.logger.error("Health check request failed with "+e.message),t.connectionTracker.trackEnd("health"),t.connectionTracker.trackError("health","health error",e.message),t.fsm.onHealthFailed()})};e?this.healthBackoff.backoff("health request",i):(this.healthBackoff.reset(),i())},e.prototype.hasAllocation=function(){return void 0!==this.allocateResult},e.prototype.resetAllocation=function(){this.logger.info("Clearing allocation"),this.allocateResult=void 0},e.prototype.resetConnectionErrorCounter=function(){this.connectionErrors=0},e.prototype.increaseConnectionErrorCounter=function(){return++this.connectionErrors},e.prototype.resetHealthBackoff=function(){this.healthBackoff.reset()},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",this.transportTypeName,e,!0),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(){this.logger.error("onSocketDisconnect"),this.connectionTracker.trackDisconnected({serverClosed:!this.fsm.isActive()}),this.connectionTracker.clearConnectedInfo(),this.fsm.onSocketError(void 0),this.connectionTtlInSecs=0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+r.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket","socketio.error",e,!0),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){this.logger.info("onSocketMessage");var t=new h;try{t.init(e),this.logger.info("Received request N "+t.id+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length)),this.logger.debug("request: "+r.toJson(t))}catch(e){var n=r.toJson(e.stack);return this.logger.error("unable to parse request, error: "+n+", request:"+t),this.connectionTracker.trackRequest(t,n),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e.message,t,void 0)}try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message: "+r.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/"),this.connectionTtlInSecs=e.ttl;var t=this.allocatedUrl!==this.allocateResult.url;this.allocatedUrl=this.allocateResult.url,this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName),this.fsm.onTrouterConnected()},e.prototype.onTrouterReconnect=function(){this.logger.info("onTrouterReconnect"),this.fsm.onReconnectRequired()},e.prototype.onAllocationResponse=function(e){this.logger.info("Received allocation response"),this.allocateResult=e,this.connectionId=this.allocateResult.id||"",this.allocateResult.healthUrl?this.healthUrl=this.allocateResult.healthUrl:(this.healthUrl=this.getHealthUrl(this.options.trouterUrl),this.logger.warn("No healthUrl property found when parsing allocation.")),!this.connectedClientId&&this.allocateResult.ccid&&(this.connectedClientId=this.allocateResult.ccid,this.options.trouterUrl=this.appendConnectedClientIds(this.options.trouterUrl,!1),this.healthUrl=this.appendConnectedClientIds(this.healthUrl,!1),this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}")),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];e.hasOwnProperty(r)&&void 0!==e[r]&&t.push(r+"="+e[r])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var i=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+i+n,t)},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){this.logger.info("Sending response for request N "+e.id+" with status "+t.status),t.headers=t.headers||{},e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var n=Date.now()-e.startTS;if(t.headers["trouter-client"]=r.toJson({cd:n}),this.logger.debug("response: "+r.toJson(t)),this.socket)try{this.socket.send(r.toJson(t)),t.sentTS=Date.now(),this.connectionTracker.trackResponse(e,n,t),"websocket"===this.transportTypeName&&this.sendPingRequest()}catch(n){var i="unable to send data on response.end, err: "+r.toJson(n.stack);this.connectionTracker.sendResponseError(i,e,t),this.logger.error(i)}else this.connectionTracker.sendResponseError("no socket",e,t)},e.prototype.getRegistrationTtl=function(){return void 0!==this.options.registration.registrarTtlSec&&this.allocateResult.ttl>0?Math.min(this.options.registration.registrarTtlSec,this.allocateResult.ttl):void 0!==this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:this.allocateResult.ttl>0?this.allocateResult.ttl:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e}();t.TrouterConnection=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(1);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.CheckingHealth=6]="CheckingHealth",e[e.UnregisteringRetrievingToken=7]="UnregisteringRetrievingToken",e[e.Unregistering=8]="Unregistering"}(i=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(r||(r={}));var a=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.logger=new o.Logger("ConnectionFsm",e),this.setState(i.Initial),this.connectedSubstate=r.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===i.Allocating||this.state===i.CheckingHealth||this.state===i.Connected||this.state===i.Handshaking||this.state===i.Connecting||this.state===i.RetrievingToken},e.prototype.start=function(){return this.state===i.Initial?(this.setState(i.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=r.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetHealthBackoff(),this.worker.resetTokenBackoff(),this.state!==i.Connecting&&this.state!==i.Handshaking&&this.state!==i.Connected&&this.state!==i.CheckingHealth||this.worker.stopSocketIo(),this.isRegistered()?(this.setState(i.UnregisteringRetrievingToken),this.worker.stopRegisterTimer(),this.worker.getToken(!0,!1)):(this.setState(i.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===i.RetrievingToken?(this.setState(i.Allocating),this.worker.sendAllocateRequest(e)):this.state===i.Connected&&this.connectedSubstate===r.RetrievingToken?(this.connectedSubstate=r.Registering,this.worker.sendRegisterRequest(e)):this.state===i.UnregisteringRetrievingToken?(this.setState(i.Unregistering),this.worker.sendUnregisterRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.networkIsAvailable=function(){this.onHealthSucceed()},e.prototype.onAllocationSucceed=function(){return this.state===i.Allocating?(this.setState(i.Handshaking),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):this.state===i.CheckingHealth?(this.setState(i.Handshaking),this.worker.startConnectionTimer(),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===i.Allocating?(this.setState(i.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===i.Allocating||this.state===i.Connecting||this.state===i.Handshaking?(this.setState(i.CheckingHealth),this.resetAllocationIfNecessary(void 0),this.worker.sendHealthRequest(!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===i.Handshaking?this.setState(i.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===i.Connecting?this.onConnectingTimeout():this.state===i.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===i.Handshaking?(this.setState(i.CheckingHealth),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.state===i.Connected?(this.setState(i.CheckingHealth),this.worker.dispatchReconnecting(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.showIgnored("onSocketError")},e.prototype.onHealthSucceed=function(){this.state===i.CheckingHealth?(this.worker.stopSocketIo(),this.worker.hasAllocation()?(this.logger.info("Allocation exists - connecting"),this.setState(i.Handshaking),this.worker.startConnectionTimer(),this.worker.startSocketIo()):(this.logger.info("Allocation doesn't exists - start with getting token"),this.setState(i.RetrievingToken),this.worker.getToken(!0,!0))):this.showIgnored("onHealthSucceed")},e.prototype.onHealthFailed=function(){this.state===i.CheckingHealth?this.worker.sendHealthRequest(!0):this.showIgnored("onHealthFailed")},e.prototype.onTrouterConnected=function(){this.state===i.Connecting||this.state===i.CheckingHealth?(this.setState(i.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.resetConnectionErrorCounter(),this.worker.shouldSkipRegistration()?(this.connectedSubstate=r.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(){this.worker.dispatchReconnectIsRequired()},e.prototype.onDownstreamRequest=function(e){this.state===i.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.state===i.CheckingHealth?(this.setState(i.Connected),this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onPingInterval=function(){this.state===i.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.state===i.Connected?(this.setState(i.CheckingHealth),this.worker.dispatchReconnecting(),this.worker.sendHealthRequest(!1)):this.showIgnored("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===i.CheckingHealth?this.setState(i.Connected):this.state===i.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===i.Connected&&this.connectedSubstate===r.Registering?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===i.Connected?(this.connectedSubstate===r.Registering&&(this.connectedSubstate=r.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===i.Connected&&this.connectedSubstate!==r.NotRegistered?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===i.Unregistering?(this.setState(i.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===i.Unregistering?(this.setState(i.Initial),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===i.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+i[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i[this.state]+"' to state '"+i[e]+"'"),this.state!==e?(this.onStateExit(this.state),this.state=e,this.onStateEnter(this.state)):this.logger.error("Attempt to switching into the current state '"+i[e]+"'")},e.prototype.onStateExit=function(e){e===i.Connected&&this.worker.stopPingTimer()},e.prototype.onStateEnter=function(e){e===i.Connected?(this.worker.startPingTimer(),this.worker.dispatchConnected()):e===i.CheckingHealth?this.worker.stopConnectionTimer():e===i.Allocating&&this.worker.startConnectionTimer()},e.prototype.resetAllocationIfNecessary=function(e){var t=this.worker.increaseConnectionErrorCounter();t>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+t+" - will reset allocation"),this.worker.resetConnectionErrorCounter(),this.worker.resetAllocation()):this.logger.info("Connection error count is "+t+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===r.Registered||this.connectedSubstate===r.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(1),o=function(){function e(e,t){this.worker=t,this.logger=new r.Logger("ManagerFsm",e),this.setState(i.TrouterState.Unknown)}return e.prototype.start=function(){this.state===i.TrouterState.Unknown?(this.setState(i.TrouterState.Disconnected),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(){this.state!==i.TrouterState.Unknown?(this.setState(i.TrouterState.Unknown),this.worker.stopFirstConnection(!1),this.worker.stopSecondConnection(!1)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===i.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(i.TrouterState.Switching):(this.setState(i.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state===i.TrouterState.Disconnected&&!e||this.state===i.TrouterState.Switching&&!e?(this.setState(i.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()):this.showIgnored("onRegistered("+e+")")},e.prototype.onReconnecting=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.state===i.TrouterState.Switching&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Switching),this.worker.startSecondConnection()):this.state===i.TrouterState.Disconnected&&e?this.worker.startSecondConnection():this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===i.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+i.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i.TrouterState[this.state]+"' to state '"+i.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+i.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=o},function(e,t,n){"use strict";function i(){return(new Date).getTime()}function r(e){return Math.ceil((i()-e)/1e3)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(5);t.TrouterState=a.TrouterState;var s=n(7),c=n(8),l=n(9),u=n(10),d=n(11),p=n(12),h=function(){};t.ServerState=h;var f=function(){function e(e){this.logger=e,this.trouterState=a.TrouterState.Unknown,this.trouterUrlPromise=new p.TrouterUrlPromise(e),this.messageHandlers=new s.MessageHandlerRegistry(e),this.logger.info("Created TrouterService version "+o.CLIENT_VERSION)}return e.prototype.state=function(){return this.useNewImplementation&&this.trouterServerNew?this.trouterServerNew.getState():this.trouterState},e.prototype.getServerState=function(){if(this.useNewImplementation){if(void 0!==this.trouterServerNew)return this.trouterServerNew.getServerState()}else if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.start=function(e){if(this.logger.info("Start"),this.useNewImplementation=e.useNewImplementation,void 0!==this.useNewImplementation){if(!e.trouterSettings.disableInternalSkypeTokenCache){var t=e.skypeTokenProvider;e.skypeTokenProvider=l.addCacheAsBackupTo(t)}return this.useNewImplementation?(this.logger.info("Using new implementation"),this.config=e,this.skypetokenProvider=e.skypeTokenProvider,void 0===this.trouterServerNew&&(this.trouterServerNew=new d.TrouterManager(this.logger,function(e){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:e.telemetryConfig.settings,eventLogger:e.telemetryConfig.eventLogger,trouterUrl:e.trouterSettings.trouterServiceUrl,registration:{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId,pnhAppId:e.trouterSettings.pnhAppId,platform:e.trouterSettings.platform,pnhTemplateKey:e.trouterSettings.pnhTemplate,platformUIVersion:e.trouterSettings.platformUIVersion,registrarTtlSec:e.trouterSettings.maxRegistrationTimeInMs/1e3},timeoutOptions:e.trouterSettings.timeoutOptions||{connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4},incallTimeoutOptions:e.trouterSettings.incallTimeoutOptions||{connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4},incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs}}(e),e.skypeTokenProvider,this.messageHandlers,this.trouterUrlPromise)),this.trouterServerNew.start(),void this.trouterServerNew.onStateChanged(this.stateCallback)):this.isStarted?void this.logger.error("TrouterService already started"):void this.startOrigTrouter(e)}this.logger.error("Either new or old implementation should be selected")},e.prototype.stop=function(){if(this.logger.log("[Trouter] close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterSerice is stopped")),this.useNewImplementation)this.trouterServerNew&&this.trouterServerNew.stop();else{if(this.isStarted){this.isStarted=!1,this.clearMessageHandlers();var e=function(){};void 0!==this.trouterServer&&(this.trouterServer.on("ready",e),this.trouterServer.on("token",e),this.trouterServer.on("request",e),this.trouterServer.on("reconnecting",e),this.trouterServer.on("disconnect",e),this.trouterServer.on("log",e),this.trouterServer.close())}this.registrarServiceInstance&&this.registrarServiceInstance.unregisterEndpoint(this.config.trouterSettings.registrationId),this.changeState(a.TrouterState.Unknown)}},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.networkIsAvailable=function(){this.useNewImplementation?this.trouterServerNew&&this.trouterServerNew.networkIsAvailable():this.isStarted&&void 0!==this.trouterServer&&this.trouterServer.checkConnection()},e.prototype.checkConnection=function(){this.networkIsAvailable()},e.prototype.getTrouterUrlAsync=function(){return this.useNewImplementation&&this.trouterServerNew||this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){this.logger.info("onStateChanged called"),this.stateCallback=e,this.useNewImplementation&&this.trouterServerNew&&this.trouterServerNew.onStateChanged(e)},e.prototype.startOrigTrouter=function(e){var t=this;this.logger.info("Using old implementation"),this.config=e,this.skypetokenProvider=e.skypeTokenProvider;var n=function(e){t.onLog(e)};void 0!==e.trouterSettings.registrarServiceUrl?this.registrarServiceInstance=c.build({settings:{registrarServiceUrl:e.trouterSettings.registrarServiceUrl,registrarTtlInSeconds:e.trouterSettings.registrarTtlInSeconds,maxRegistrationTimeInMs:e.trouterSettings.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:e.trouterSettings.registrarRefreshTimeoutInMs,pnhAppId:e.trouterSettings.pnhAppId,pnhTemplate:e.trouterSettings.pnhTemplate,platform:e.trouterSettings.platform,platformUIVersion:e.trouterSettings.platformUIVersion},skypetokenProvider:e.skypeTokenProvider,onRegistrationSuccess:function(e){t.onEndpointRegistrationSuccess(e)},onRegistrationError:function(e){t.onEndpointRegistrationFailed(e)},logFunc:n},function(){return void 0!==t.trouterServer?t.trouterServer.getServerState():new h},e.telemetryConfig.eventLogger,e.trouterSettings.sessionId,e.trouterSettings.environment):this.registrarServiceInstance=void 0,this.serverCreatedTimestamp=i(),this.trouterServer=u.default.createServer(function(e){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:e.telemetryConfig.settings,eventLogger:e.telemetryConfig.eventLogger}}(e)),this.trouterServer.on("ready",function(e,n){t.onMessageChannelReady(e,n)}),this.trouterServer.on("token",function(e){return t.onTokenRequired(e)}),this.trouterServer.on("request",function(e,n){t.onIncomingMessage(e,n)}),this.trouterServer.on("reconnecting",function(){t.onReconnect()}),this.trouterServer.on("disconnect",function(){t.onDisconnect()}),this.trouterServer.on("log",n),this.isStarted=!0,this.onTokenRequired(!1).then(function(e){void 0!==t.trouterServer&&t.trouterServer.open(t.config.trouterSettings.trouterServiceUrl,e)}),this.changeState(a.TrouterState.Disconnected)},e.prototype.changeState=function(e){this.trouterState=e;var t=e===a.TrouterState.Connected?this.trouterEndpointUrl:"";this.stateCallback&&this.stateCallback(e,t)},e.prototype.onMessageChannelReady=function(e,t){this.logger.log("[Trouter] ready");var n={};n.isNewUrl=t,t?(n.authenticatedToReadyTime=r(this.tokenReturnedEventTimestamp),void 0!==this.trouterServer&&(this.trouterEndpointUrl=this.trouterServer.getServerState().surl,this.registerEndpoint(this.trouterEndpointUrl))):n.reconnectingToReadyTime=r(this.reconnectEventTimestamp),this.initialReadyEvent&&(n.initToReadyTime=r(this.serverCreatedTimestamp),this.initialReadyEvent=!1),this.changeState(a.TrouterState.Connected),this.trouterUrlPromise.resolveUrl(this.trouterEndpointUrl)},e.prototype.onTokenRequired=function(e){var t=this;return this.logger.log("[Trouter] token required"),this.trouterUrlPromise.resetUrl(),new Promise(function(n,r){t.skypetokenProvider(e).then(function(e){t.logger.log("[Trouter] token fetched"),t.tokenReturnedEventTimestamp=i(),n(e)}).catch(function(e){t.logger.error("[Trouter] token fetch failed"),t.trouterEndpointUrl="",r(e)})})},e.prototype.onReconnect=function(){this.logger.log("[Trouter event] reconnecting"),this.changeState(a.TrouterState.Disconnected),this.reconnectEventTimestamp=i()},e.prototype.onLog=function(e){try{var t=JSON.parse(e);this.logger[t.level](e)}catch(e){this.logger.warn("onLog failed:  "+e)}},e.prototype.onEndpointRegistrationSuccess=function(e){this.logger.log("[Trouter event] endpoint registered"),e?o.constants.RENEWAL:o.constants.NEW_CONNECTION,this.initialRegistration&&(r(this.serverCreatedTimestamp),this.initialRegistration=!1)},e.prototype.onEndpointRegistrationFailed=function(e){this.logger.log("[Trouter event] endpoint registration failed"),e&&(e.status,e.responseText)},e.prototype.onIncomingMessage=function(e,t){var n=function(e){var t,n=null;try{t=JSON.parse(e.body),n=function(e){return e&&(e.evt||e.eventId)||null}(t)}catch(e){}return{eventId:n,url:e.url,body:t,rawBody:e.body,headers:e.headers}}(e),i=this.messageHandlers.handleMessage(n);!function(e,t,n,i){e.writeHead(t,i),e.end(n)}(t,i.resultCode,i.responseBody,i.responseHeaders)},e.prototype.onDisconnect=function(){this.logger.log("[Trouter] disconnected"),this.changeState(a.TrouterState.Disconnected),this.trouterUrlPromise.rejectUrl(new Error("TrouterService disconnected"))},e.prototype.registerEndpoint=function(e){this.registrarServiceInstance&&this.registrarServiceInstance.registerEndpoint(e,this.config.trouterSettings.registrationId)},e}();t.TrouterService=f,t.createTrouterService=function(e){return new f(e)},t.getTrouterServiceVersion=function(){return o.CLIENT_VERSION}},function(e,t){}])}()}).call(this,__webpack_require__(61))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(2);!function(e){e.Connecting="Skype_Call_Connecting.m4a",e.Dialing="Skype_Call_Dialing.m4a",e.Ended="Skype_Call_Ended.m4a",e.Reconnected="Skype_Call_Reconnected.m4a",e.Ringback="Skype_Call_Ringback.m4a",e.Ringing="Skype_Call_Ringing.m4a"}(i=t.CallingSound||(t.CallingSound={}));var o=function(){function e(){var t=[];for(var n in i)i.hasOwnProperty(n)&&t.push(i[n]);this.soundsArr=t.map(e.loadSound)}return e.loadSound=function(t){var n=new Audio(e.getSoundPath(t));return n.preload="auto",{fileName:t,audioObject:n}},e.getSoundPath=function(e){return r.default.ECS.domain+"/assets/sounds/"+e},e.prototype.getSound=function(e){for(var t=0,n=this.soundsArr;t<n.length;t++){var i=n[t];if(i.fileName===e)return i.audioObject}return null},e.prototype.play=function(e,t){var n=this;return void 0===t&&(t=!0),new Promise(function(i){var r=n.getSound(e);null!==r&&(r.loop=t,r.onended=function(){return i()},r.play())})},e.prototype.stop=function(e){var t=this.getSound(e);null!==t&&(t.pause(),t.currentTime=0)},e.prototype.stopAll=function(){var e=this;this.soundsArr.forEach(function(t){return e.stop(t.fileName)})},e}();t.CallingAudioPlayer=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(4),c=n(6),l=n(2),u=n(48),d=n(0),p=n(397),h=n(398),f=n(60),g=n(399),m=n(400),_=n(413),v=n(414),y=function(e){function t(t){var n=e.call(this,t)||this;return n.DEFAULT_RECT_WIDTH=320,n.DEFAULT_RECT_HEIGHT=180,n.TRANSITION_DELAY=500,n._frameless=!!c.default.get.frameless,n._onCallMriChange=function(e){var t=n.props.currentCall;e&&t&&t.getThreadInfo().then(function(e){n.setState({title:e.displayName})})},n._toggleDock=function(){n.state.isDocked?n._undock():n._dock()},n._toggleChat=function(){n.state.isMinimized?n._maximize():n._minimize()},n._maximize=function(){n.setState({isMinimized:!1}),n.props.onChatToggle(!1)},n._minimize=function(){n.setState({isMinimized:!0}),n.props.onChatToggle(!0)},n._toggleFullscreen=function(){h.default.isFullscreen()?n._exitFullscreen():n._enterFullscreen()},n._onDisconnected=function(){h.default.isFullscreen()&&n._exitFullscreen(),n.state.isMinimized&&n._maximize(),n.state.isDocked&&n._undock()},n._maximizeIfNeeded=function(){d.swc.API.triggerEvent(s.ApiEvents.hideBubbleWindow),n.state.isMinimized&&n._maximize()},n.state={title:"",isDocked:!1,isMinimized:!1,isFullscreen:!1},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this;"dock"!==c.default.get.callStartMode||this.state.isDocked||this._toggleDock();var t=c.default.get.standaloneCalling?l.default.ORIGIN_CALLING:l.default.ORIGIN;this._draggable=new p.default(this.element,!this._frameless,t),this._fullscreen=new h.default,d.swcWindow.swc.API.registerEvent("fullscreenchange",function(t){t||e._exitFullscreen()})},t.prototype.componentWillReceiveProps=function(e){var t=this.props.currentCall,n=e.currentCall;t&&t!==n&&this._unsubscribeFromCall(this.props.currentCall),n&&this._subscribeToCall(n)},t.prototype._subscribeToCall=function(e){e&&(e.subscribe("mri",this._onCallMriChange),this._onCallMriChange(e.mri))},t.prototype._unsubscribeFromCall=function(e){e&&e.unsubscribe("mri",this._onCallMriChange)},t.prototype.render=function(){var e=this,t=["skype-calling"],n=!!this.props.incomingCalls.length&&!this.props.currentCall;return n&&t.push("notified"),this.state.isMinimized&&t.push("minimize"),this.state.isFullscreen&&t.push("fullscreen"),this.state.isDocked&&t.push("wide"),a.createElement("div",{className:t.join(" "),ref:function(t){return e.element=t}},n&&a.createElement(v.IncomingCalls,{calls:this.props.incomingCalls,onCallAccept:this.props.onAcceptCall,onCallReject:this.props.onRejectCall}),this.props.currentCall&&a.createElement(m.CallScreenComponent,{title:this.state.title,call:this.props.currentCall,devices:this.props.devices,isDocked:this.state.isDocked,isFullscreen:this.state.isFullscreen,isMinimized:this.state.isMinimized,onVideoToggle:this.props.onVideoToggle,onAudioToggle:this.props.onAudioToggle,onScreenSharingToggle:this.props.onScreenSharingToggle,onHangup:this.props.onHangup,onDockToggle:this._toggleDock,onRosterToggle:this.props.onRosterToggle,onFullscreenToggle:this._toggleFullscreen,onChatToggle:this._toggleChat,onSettingsToggle:this.props.onSettingsToggle,onIncomingVideoToggle:this.props.onIncomingVideoToggle,onDisconnected:this._onDisconnected,onAvatarClick:this._maximizeIfNeeded}),this.props.displayCallRate&&a.createElement(g.CallRate,{title:this.state.title,call:this.props.currentCall,onSubmit:this.props.onCallRate,onCancel:this.props.onCallRate}),!this.props.displayCallRate&&!this.props.incomingCalls.length&&!this.props.currentCall&&a.createElement(_.CallStartPanel,{onStartCall:this.props.onStartCall}))},t.prototype._dock=function(){var e=this;this.setState({isDocked:!0}),this.props.onDockToggle(!0);var t=this.element.querySelector(".streamWrapper video"),n=t?t.videoWidth:this.DEFAULT_RECT_WIDTH,i=t?t.videoHeight:this.DEFAULT_RECT_HEIGHT,r=c.default.get.standaloneCalling?l.default.ORIGIN_CALLING:l.default.ORIGIN;if(!this._frameless)return this._draggable.drag(!0),void parent.postMessage({origin:r,action:u.default.DockIframe,width:n,height:i},"*");var o=document.body,a={left:o.offsetWidth-n-20,top:20,width:n,height:i};this._originalParent=this.element.parentElement,f.default.transport(this.element,o,a,this.TRANSITION_DELAY,function(){e._draggable.drag(!0)}),c.default.get.isParallelView||(this._originalParent.style.display="none",this._originalParent.style.visibility="hidden")},t.prototype._undock=function(){var e=this;this.setState({isDocked:!1}),this.props.onDockToggle(!1);var t=c.default.get.standaloneCalling?l.default.ORIGIN_CALLING:l.default.ORIGIN;if(this._frameless){this._originalParent.style.display="block",this._draggable.drag(!1);var n=this._originalParent.getBoundingClientRect();f.default.transport(this.element,this._originalParent,n,this.TRANSITION_DELAY,function(){e._originalParent.style.visibility="visible",f.default.resetRectStyle(e.element)},!0)}else parent.postMessage({origin:t,action:u.default.UndockIframe},"*")},t.prototype._enterFullscreen=function(){this.setState({isFullscreen:!0}),this.props.onFullscreenToggle(!0),this.state.isDocked&&(this._frameless&&(this._storedRect=this.element.getBoundingClientRect()),this._draggable.drag(!1)),h.default.enter(this.element),f.default.resetRectStyle(this.element)},t.prototype._exitFullscreen=function(){this.setState({isFullscreen:!1}),this.props.onFullscreenToggle(!1),this.state.isDocked&&(this._frameless&&this._storedRect&&f.default.setRectStyle(this.element,this._storedRect),this._draggable.drag(!0)),h.default.exit()},t}(o.Component);t.CallingComponent=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(48),r=n(2),o=function(){return function(e,t,n){var o=this;this.element=e,this.virtual=t,this.origin=n,this._dragstart=function(e){if(o._dragging=!0,o.virtual)parent.postMessage({origin:o.origin,action:i.default.IframeDragStart,x:e.screenX,y:e.screenY},"*");else{var t=o.element.getBoundingClientRect();o._offsetX=e.clientX-t.left,o._offsetY=e.clientY-t.top}},this._dragstop=function(e){if(o._dragging=!1,o.virtual)parent.postMessage({origin:r.default.ORIGIN,action:i.default.IframeDragStop,x:e.screenX,y:e.screenY},"*");else{var t=e.clientY-o._offsetY-o.element.parentElement.offsetTop,n=e.clientX-o._offsetX-o.element.parentElement.offsetLeft;Math.abs(t)<60&&Math.abs(n)<60&&!o.virtual&&(o.element.style.top="0px",o.element.style.left="0px")}},this._drag=function(e){if(e.x&&e.y&&o._dragging)if(o.virtual)parent.postMessage({origin:r.default.ORIGIN,action:i.default.IframeDragging,x:e.screenX,y:e.screenY},"*");else{o.element,o.element.style.position="absolute";var t=e.clientY-o._offsetY-o.element.parentElement.offsetTop+"px",n=e.clientX-o._offsetX-o.element.parentElement.offsetLeft+"px";o.element.style.top=t,o.element.style.left=n}},this.drag=function(e){e?(o.element.addEventListener("mousedown",o._dragstart,!0),o.element.addEventListener("mouseup",o._dragstop,!0),window.addEventListener("mousemove",o._drag,!0)):(o.element.removeEventListener("mousedown",o._dragstart,!0),o.element.removeEventListener("mouseup",o._dragstop,!0),window.removeEventListener("mousemove",o._drag,!0))}}}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(0),o={fullscreenchange:"onfullscreenchange",webkitfullscreenchange:"onwebkitfullscreenchange",mozfullscreenchange:"onmozfullscreenchange",msfullscreenchange:"onmsfullscreenchange"},a=function(){function e(){var t=document;for(var n in o)if(void 0!==t[o[n]]){t.addEventListener(n,function(){r.swc.API.triggerEvent(i.ApiEvents.Fullscreenchange,e.isFullscreen())});break}}return e.enter=function(e){var t=e||document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},e.exit=function(){var e=document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()},e.isFullscreen=function(){var e=document;return!!(e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||e.webkitFullscreenElement||e.webkitFullscreenElement)},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(1),l=n(0),u=n(343),d=function(e){function t(t){var n=e.call(this,t)||this;return n._onRatingSelect=function(e){n.setState({rating:e})},n._onClick=function(){n.state.rating?n.props.onSubmit(n.state.rating):n.props.onCancel()},n._onWrapperClick=function(e){var t=e.target;t&&t.classList.contains("callRateWrapper")&&n.props.onCancel()},n.state={rating:null},n}return r(t,e),t.prototype.render=function(){var e=c.default.instance.i18n.fetch("action_button_send"),t=c.default.instance.i18n.fetch("sign_in_cancel"),n=l.swc.Assets.SVG;return s.createElement("div",{className:"callRateWrapper",onClick:this._onWrapperClick},s.createElement("div",{className:"callRate"},s.createElement("div",{className:"title"},this.props.title),s.createElement("div",{className:"statusEnded"},c.default.instance.i18n.fetch("message_text_endedCall")),s.createElement(u.CallAvatar,{call:this.props.call}),s.createElement("div",{className:"caption"},c.default.instance.i18n.fetch("calling_rate_request")),s.createElement("div",{className:"rating"},s.createElement("input",{id:"star5",name:"rating",type:"radio",value:"5",checked:"5"===this.state.rating,onChange:a.linkEvent("5",this._onRatingSelect)}),s.createElement("label",o({},{for:"star5"},{title:"5",dangerouslySetInnerHTML:{__html:n.iconStar}})),s.createElement("input",{id:"star4",name:"rating",type:"radio",value:"4",checked:"4"===this.state.rating,onChange:a.linkEvent("4",this._onRatingSelect)}),s.createElement("label",o({},{for:"star4"},{title:"4",dangerouslySetInnerHTML:{__html:n.iconStar}})),s.createElement("input",{id:"star3",name:"rating",type:"radio",value:"3",checked:"3"===this.state.rating,onChange:a.linkEvent("3",this._onRatingSelect)}),s.createElement("label",o({},{for:"star3"},{title:"3",dangerouslySetInnerHTML:{__html:n.iconStar}})),s.createElement("input",{id:"star2",name:"rating",type:"radio",value:"2",checked:"2"===this.state.rating,onChange:a.linkEvent("2",this._onRatingSelect)}),s.createElement("label",o({},{for:"star2"},{title:"2",dangerouslySetInnerHTML:{__html:n.iconStar}})),s.createElement("input",{id:"star1",name:"rating",type:"radio",value:"1",checked:"1"===this.state.rating,onChange:a.linkEvent("1",this._onRatingSelect)}),s.createElement("label",o({},{for:"star1"},{title:"1",dangerouslySetInnerHTML:{__html:n.iconStar}}))),s.createElement("div",{className:"btnContainer"},s.createElement("button",{className:"sendBtn",onClick:this._onClick},this.state.rating?e:t))))},t}(a.Component);t.CallRate=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(6),l=n(24),u=n(343),d=n(401),p=n(402),h=n(403),f=n(404),g=n(405),m=n(406),_=n(112),v=n(408),y=n(412),S=function(e){function t(t){var n=e.call(this,t)||this;n.IMMERSIVE_DELAY=2500,n.RESIZE_TIMEOUT=1e3,n.MIN_ROASTER_WIDTH=640,n.MIN_ROASTER_HEIGHT=480,n._toggleImmersive=function(e){e.stopPropagation(),n.setState({isImmersive:!1}),n._immersiveTimeout&&(clearTimeout(n._immersiveTimeout),n._immersiveTimeout=null),n._immersiveTimeout=setTimeout(function(){var e=n.currentCall;e&&3===e.state&&n.setState({isImmersive:!0})},n.IMMERSIVE_DELAY)},n._toggleSettings=function(){n.state.isSettingsDisplayed?n._hideSettings():n._showSettings()},n._showSettings=function(){n.setState({isSettingsDisplayed:!0}),n.props.onSettingsToggle(!0)},n._hideSettings=function(){n.setState({isSettingsDisplayed:!1}),n.props.onSettingsToggle(!1)},n._updateCallDuration=function(e){n.setState(function(t){return{headerProps:o({},t.headerProps,{duration:e})}})},n._toggleParticipants=function(e){n.setState(function(t){return{participantsListProps:o({},t.participantsListProps,{isVisible:e})}})},n._onCallStateChange=function(e){n.setState(function(t){return{callState:e,buttonsProps:o({},t.buttonsProps,{isVideoOn:n.currentCall.isVideoOn,isAudioOn:!n.currentCall.isMuted})}}),7===e?(n._duration.reset(),n.props.onDisconnected(),n.state.isSettingsDisplayed&&n._hideSettings(),n.setState(function(e){return{headerProps:o({},e.headerProps,{showChatButton:!1})}})):3===e&&(n._duration.start(),n.setState(function(e){return{headerProps:o({},e.headerProps,{showChatButton:c.default.get.isParallelView&&!c.default.get.standaloneCalling})}}))},n._onIncomingVideoAvailabilityChange=function(e){n.setState(function(t){return{buttonsProps:o({},t.buttonsProps,{isIncomingVideoButtonVisible:e})}})},n._onIncomingVideoChange=function(e){n.setState(function(t){return{buttonsProps:o({},t.buttonsProps,{isIncomingVideoOn:e})}})},n._onVideoChange=function(e){n.setState({isVideoOn:e})},n._onMutedChange=function(e){n.setState(function(t){return{buttonsProps:o({},t.buttonsProps,{isAudioOn:!e})}})},n._onScreenSharingChange=function(e){n.setState(function(t){return{buttonsProps:o({},t.buttonsProps,{isScreenSharingOn:e})}})},n._onStageChange=function(e){n.setState(function(t){return{stageProps:o({},t.stageProps,e),participantsListProps:o({},t.participantsListProps,{participants:e.orderedParticipants.map(function(e){return e.participant})})}}),n.currentCall&&n._onIncomingVideoAvailabilityChange(n.currentCall.isIncomingVideoAvailable)},n._onSelectedDevicesChange=function(e){n.setState(function(t){return{settingsProps:o({},t.settingsProps,{selectedCameraId:e.camera,selectedMicrophoneId:e.microphone,selectedSpeakerId:e.speaker})}})},n._onMicrophonesChange=function(e){n.setState(function(t){return{settingsProps:o({},t.settingsProps,{microphones:e})}})},n._onCamerasChange=function(e){n.setState(function(t){return{settingsProps:o({},t.settingsProps,{cameras:e})}})},n._onSpeakersChange=function(e){n.setState(function(t){return{settingsProps:o({},t.settingsProps,{speakers:e})}})},n._checkElementSize=function(){if(n.currentCall){var e=n.element.clientWidth,t=n.element.clientHeight,i=e>=n.MIN_ROASTER_WIDTH&&t>=n.MIN_ROASTER_HEIGHT;n.props.onRosterToggle(i)}n._resizeTimer=setTimeout(n._checkElementSize,n.RESIZE_TIMEOUT)},n._onCallMriChange=function(e){n.setState({mri:e})};var i=l.default.isEdge();return n.state={mri:"",isSettingsDisplayed:!1,isVideoOn:!1,isImmersive:!1,callState:0,headerProps:{showChatButton:!1,onFullscreenToggle:n.props.onFullscreenToggle,onDockToggle:n.props.onDockToggle,onChatToggle:n.props.onChatToggle,onSettingsToggle:n._toggleSettings,duration:0},buttonsProps:{isVideoOn:!0,onVideoButtonClick:n.props.onVideoToggle,isAudioOn:!0,onAudioButtonClick:n.props.onAudioToggle,onStopCallButtonClick:n.props.onHangup,isIncomingVideoButtonVisible:!0,isIncomingVideoOn:!0,onIncomingVideoButtonClick:n.props.onIncomingVideoToggle,isScreenSharingButtonVisible:i,isScreenSharingOn:!1,onScreenSharingButtonClick:n.props.onScreenSharingToggle},stageProps:{capacity:1,maxQueueCapacity:3,hiddenCount:0,orderedParticipants:[],onAggregateClick:function(){return n._toggleParticipants(!0)},onClick:n.props.onAvatarClick},settingsProps:{cameras:[],microphones:[],speakers:[],selectedCameraId:null,selectedMicrophoneId:null,selectedSpeakerId:null,onCameraSelected:n.props.devices.selectCamera,onMicrophoneSelected:n.props.devices.selectMicrophone,onSpeakerSelected:n.props.devices.selectSpeaker},participantsListProps:{isVisible:!1,participants:[],onClose:function(){return n._toggleParticipants(!1)}}},n._duration=new _.Duration(n._updateCallDuration),n}return r(t,e),Object.defineProperty(t.prototype,"currentCall",{get:function(){return this._currentCall},set:function(e){this._currentCall!==e&&(this._unsubscribeFromCall(this._currentCall),this._currentCall=e,this._subscribeToCall(this._currentCall),this._duration.reset(),this.currentCall||this._onStageChange({orderedParticipants:[]}))},enumerable:!0,configurable:!0}),t.prototype.componentWillReceiveProps=function(e){this.currentCall=e.call,this.state.isSettingsDisplayed&&e.isDocked&&this._hideSettings()},t.prototype.componentDidMount=function(){var e=this.props.devices;e.subscribe("selectedDevices",this._onSelectedDevicesChange),e.subscribe("microphones",this._onMicrophonesChange),e.subscribe("cameras",this._onCamerasChange),e.subscribe("speakers",this._onSpeakersChange),this._onMicrophonesChange(e.microphones),this._onCamerasChange(e.cameras),this._onSpeakersChange(e.speakers),this._onSelectedDevicesChange(e.selectedDevices),this._checkElementSize()},t.prototype.componentWillUnmount=function(){this.currentCall=null,this.props.devices.unsubscribe("selectedDevices",this._onSelectedDevicesChange),this.props.devices.unsubscribe("microphones",this._onMicrophonesChange),this.props.devices.unsubscribe("cameras",this._onCamerasChange),this.props.devices.unsubscribe("speakers",this._onSpeakersChange),this._resizeTimer&&(clearTimeout(this._resizeTimer),this._resizeTimer=null)},t.prototype._subscribeToCall=function(e){e&&(e.subscribe("mri",this._onCallMriChange),e.subscribe("state",this._onCallStateChange),e.subscribe("isIncomingVideoAvailable",this._onIncomingVideoAvailabilityChange),e.subscribe("isIncomingVideoEnabled",this._onIncomingVideoChange),e.subscribe("isVideoOn",this._onVideoChange),e.subscribe("isScreenSharingOn",this._onScreenSharingChange),e.subscribe("isMuted",this._onMutedChange),e.subscribe("stage",this._onStageChange),this._onCallMriChange(e.mri),this._onCallStateChange(e.state),this._onIncomingVideoAvailabilityChange(e.isIncomingVideoAvailable),this._onIncomingVideoChange(e.isIncomingVideoEnabled),this._onVideoChange(e.isVideoOn),this._onMutedChange(e.isMuted),this._onScreenSharingChange(e.isScreenSharingOn))},t.prototype._unsubscribeFromCall=function(e){e&&(e.unsubscribe("mri",this._onCallMriChange),e.unsubscribe("state",this._onCallStateChange),e.unsubscribe("isIncomingVideoAvailable",this._onIncomingVideoAvailabilityChange),e.unsubscribe("isIncomingVideoEnabled",this._onIncomingVideoChange),e.unsubscribe("isVideoOn",this._onVideoChange),e.unsubscribe("isScreenSharingOn",this._onScreenSharingChange),e.unsubscribe("isMuted",this._onMutedChange),e.unsubscribe("stage",this._onStageChange))},t.prototype.render=function(){var e=this,t=["callScreen"];switch(this.state.callState){case 2:t.push("connecting");break;case 3:t.push("connected")}return this.state.isImmersive&&t.push("immersive"),this.state.stageProps.orderedParticipants.length||t.push("empty"),s.createElement("div",{className:t.join(" "),onMouseMove:this._toggleImmersive,onTouchStart:this._toggleImmersive,ref:function(t){return e.element=t},"data-test-id":"callingElementConnected"},this.currentCall&&s.createElement(u.CallAvatar,{call:this.currentCall,onClick:this.props.onAvatarClick}),s.createElement(f.CallStatus,{callState:this.state.callState}),s.createElement(p.CallingHeader,o({},this.state.headerProps,{isDocked:this.props.isDocked,isFullscreen:this.props.isFullscreen,username:this.props.title})),s.createElement(d.CallingButtonsPanel,o({},this.state.buttonsProps,{isVideoOn:this.state.isVideoOn})),s.createElement(y.Watermark,null),this.currentCall&&!!this.state.stageProps.orderedParticipants.length&&s.createElement(v.VideoStage,o({},this.state.stageProps)),this.state.isVideoOn&&this.currentCall&&s.createElement(g.LocalVideo,{deviceManager:this.props.devices.getDeviceManager()}),this.state.isSettingsDisplayed&&s.createElement(m.CallSettingsComponent,o({},this.state.settingsProps)),s.createElement(h.CallParticipantsList,o({},this.state.participantsListProps)))},t}(a.Component);t.CallScreenComponent=S},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(4),c=n(1),l=n(0),u=n(122),d=n(344),p=function(e){function t(t){var n=e.call(this,t)||this;return n._getMenuActionItems=function(){var e=[];if(n.props.isIncomingVideoButtonVisible){var t=n.props.isIncomingVideoOn?c.default.instance.i18n.fetch("hide_incoming_video_button"):c.default.instance.i18n.fetch("show_incoming_video_button");e.push({title:t,group:1,action:n._onIncomingVideoButtonClick})}if(n.props.isScreenSharingButtonVisible){t=n.props.isScreenSharingOn?c.default.instance.i18n.fetch("videoPlayer_button_stopScreenSharing"):c.default.instance.i18n.fetch("videoPlayer_button_startScreenSharing");e.push({title:t,group:1,action:n._onScreenSharingButtonClick})}return e},n._onIncomingVideoButtonClick=function(){n.props.onIncomingVideoButtonClick(),n._hideOptions()},n._onScreenSharingButtonClick=function(){n.props.onScreenSharingButtonClick(),n._hideOptions()},n._toggleOptionsMenu=function(){n.state.isOptionsMenuDisplayed?l.swc.API.triggerEvent(s.ApiEvents.hideBubbleWindow):n._showMoreOptions()},n._hideOptions=function(){n.setState({isOptionsMenuDisplayed:!1})},n.state={isOptionsMenuDisplayed:!1},n}return r(t,e),t.prototype.componentDidMount=function(){l.swc.API.registerEvent(s.ApiEvents.hideBubbleWindow,this._hideOptions)},t.prototype.componentWillUnmount=function(){l.swc.API.unregisterEvent(s.ApiEvents.hideBubbleWindow,this._hideOptions)},t.prototype.render=function(){var e=this,t=l.swc.Assets.SVG,n=c.default.instance.i18n.fetch("videoPlayer_button_endCall"),i=c.default.instance.i18n.fetch("show_options"),r=this.props.isVideoOn?c.default.instance.i18n.fetch("videoPlayer_button_turnOffVideo"):c.default.instance.i18n.fetch("videoPlayer_button_turnOnVideo"),o=this.props.isAudioOn?c.default.instance.i18n.fetch("videoPlayer_button_mute"):c.default.instance.i18n.fetch("videoPlayer_button_unmute"),s=this.props.isIncomingVideoButtonVisible||this.props.isScreenSharingButtonVisible;return a.createElement("div",{className:"callingButtons",ref:function(t){return e.panelElement=t}},a.createElement(d.CallingButton,{id:"toggleVideo",title:r,className:"",onClick:this.props.onVideoButtonClick,content:this.props.isVideoOn?t.iconVideoOn:t.iconVideoOff}),a.createElement(d.CallingButton,{id:"toggleAudio",title:o,className:"",onClick:this.props.onAudioButtonClick,content:this.props.isAudioOn?t.iconMuteCall:t.iconUnmuteCall}),a.createElement(d.CallingButton,{id:"stopCall",title:n,className:"",onClick:this.props.onStopCallButtonClick,content:t.iconHangup}),s&&a.createElement(d.CallingButton,{id:"toggleOptions",title:i,className:"",onClick:this._toggleOptionsMenu,content:t.iconMore}))},t.prototype._showMoreOptions=function(){var e=document.createElement("div"),t=this._getMenuActionItems();e.classList.add("menuList","iconMore"),e.setAttribute("data-bind","component: {\n            name: 'menu-list',\n            params: { list: items }\n        }"),ko.applyBindings({items:t},e),u.default.add(this.panelElement.querySelector("#toggleOptions"),this.panelElement.parentElement,e,u.BUBBLE_TYPE.MENU_LIST,u.BubblePosition.nextToElement),this.setState({isOptionsMenuDisplayed:!0})},t}(o.Component);t.CallingButtonsPanel=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=n(0),l=n(344),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=c.swc.Assets.SVG,t=this.props.isDocked?e.iconUndock:e.iconDock,n=this.props.isFullscreen?e.iconFullscreenOff:e.iconFullscreenOn;return a.createElement("div",{className:"callingHeader"},this.props.showChatButton&&a.createElement(l.CallingButton,{id:"",title:s.default.instance.i18n.fetch("calling_button_toggleChat"),className:"toggle-chat",content:e.iconChat,onClick:this.props.onChatToggle}),a.createElement("span",{className:"separator"},"|"),a.createElement("h2",{id:"currentUser"},a.createElement("strong",{className:"name"},this.props.username),a.createElement("span",{className:"duration"},this._formatDuration(this.props.duration))),a.createElement("div",{className:"buttons"},a.createElement(l.CallingButton,{id:"",title:s.default.instance.i18n.fetch("calling_button_dock"),className:"dock-button",content:t,onClick:this.props.onDockToggle}),a.createElement(l.CallingButton,{id:"fullscreen",title:s.default.instance.i18n.fetch("calling_button_fullscreen"),className:"",content:n,onClick:this.props.onFullscreenToggle}),a.createElement(l.CallingButton,{id:"callingSettings",title:s.default.instance.i18n.fetch("calling_button_settings"),className:"toggleSettings",content:e.iconSettings,onClick:this.props.onSettingsToggle})))},t.prototype._pad=function(e){return e>9?e.toString():"0"+e.toString()},t.prototype._formatDuration=function(e){if(e<=0)return"";var t=3600,n=this._pad(~~(e/t)),i=this._pad(~~(e%t/60)),r=this._pad(e%t%60),o="";return o+=parseInt(n,10)?n+":":"",(o+=i+":")+r},t}(o.Component);t.CallingHeader=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=n(89),l=n(0),u=n(76),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onCloseClick=function(e){var n=e.target,i=e.currentTarget;"callParticipants"!==n.id&&"callParticipantsClose"!==i.id||t.props.onClose()},t}return r(t,e),t.prototype.shouldComponentUpdate=function(e){return e.isVisible||this.props.isVisible},t.prototype.componentDidUpdate=function(){this._scrollContainer&&this._scrollViewport&&(this._scroll||(this._scroll=new c.default(this._scrollContainer,this._scrollViewport)),this._scroll.recount())},t.prototype.render=function(){var e=this,t=l.swc.Assets.SVG,n=this.props.participants.slice().sort(function(e,t){var n=e.displayName,i=t.displayName;return n>i?1:n<i?-1:0});return a.createElement("div",{id:"callParticipants",className:this.props.isVisible?"visible":"",onClick:this._onCloseClick},a.createElement("div",{className:"participants-modal addParticipants"},a.createElement("div",{className:"addParticipantsHeader"},a.createElement("h3",{className:"header"}),a.createElement("button",{id:"callParticipantsClose",className:"cancel",title:s.default.instance.i18n.fetch("calling_participants_close"),"aria-label":s.default.instance.i18n.fetch("calling_participants_close"),dangerouslySetInnerHTML:{__html:t.iconCancel},onClick:this._onCloseClick})),a.createElement("div",{className:"searchContainer"},a.createElement("div",{className:"swc-scroll-wrapper searchResultsWrapper",ref:function(t){return e._scrollContainer=t}},a.createElement("div",{className:"swc-scroll-viewport searchResults",ref:function(t){return e._scrollViewport=t}},a.createElement("div",{id:"callParticipantsList",className:"contactsWrapper"},n.map(function(e){var t=s.default.instance.Persons.getPerson(e.id);return a.createElement("div",{key:e.id,className:"item"},a.createElement(u.PersonAvatar,{person:t}),a.createElement("div",{className:"name info"},a.createElement("p",{className:"title"},e.displayName)))})))))))},t}(o.Component);t.CallParticipantsList=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=function(e){function t(t){var n=e.call(this,t)||this;return n._translations={callingScreen_calling:s.default.instance.i18n.fetch("calling_screen_calling"),callingScreen_incoming:s.default.instance.i18n.fetch("calling_screen_incoming"),callingScreen_onHold:s.default.instance.i18n.fetch("calling_screen_onhold")},n.state={status:""},n}return r(t,e),t.prototype.componentWillReceiveProps=function(e){var t=this.props.callState,n="";switch(e.callState){case 1:n=this._translations.callingScreen_incoming;break;case 2:n=1===t?this._translations.callingScreen_incoming:this._translations.callingScreen_calling;break;case 4:case 5:n=this._translations.callingScreen_onHold;break;default:n=""}this.setState({status:n})},t.prototype.render=function(){return a.createElement("div",{className:"status"},a.createElement("strong",{id:"callStatus"},this.state.status))},t}(o.Component);t.CallStatus=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isMount=!1,t}return r(t,e),t.prototype.componentDidMount=function(){this._isMount=!0,this._createPreviewRenderer()},t.prototype.componentWillUnmount=function(){this._isMount=!1,this._disposePreviewRenderer()},t.prototype.render=function(){var e=this;return a.createElement("div",{id:"localVideo",className:"myself",ref:function(t){return e._element=t}})},t.prototype._createPreviewRenderer=function(){var e=this;this._disposePreviewRenderer(),this._element&&this._isMount&&this.props.deviceManager.createPreviewRenderer(this._element).then(function(t){e._disposePreviewRenderer(),e._isMount?e._previewRenderer=t:t.dispose()})},t.prototype._disposePreviewRenderer=function(){this._previewRenderer&&(this._previewRenderer.dispose(),this._previewRenderer=void 0)},t}(o.Component);t.LocalVideo=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(1),o=n(407);t.CallSettingsComponent=function(e){return i.createElement("fieldset",{className:"settings"},i.createElement("legend",null,r.default.instance.i18n.fetch("calling_settings_devices")),i.createElement("label",{htmlFor:"cameras"},r.default.instance.i18n.fetch("calling_settings_cameras")),i.createElement(o.CallSettingsSelect,{id:"cameras",devices:e.cameras,selectedDeviceId:e.selectedCameraId,onSelectedDeviceChanged:e.onCameraSelected}),i.createElement("label",{htmlFor:"microphones"},r.default.instance.i18n.fetch("calling_settings_microphones")),i.createElement(o.CallSettingsSelect,{id:"microphones",devices:e.microphones,selectedDeviceId:e.selectedMicrophoneId,onSelectedDeviceChanged:e.onMicrophoneSelected}),i.createElement("label",{htmlFor:"speakers"},r.default.instance.i18n.fetch("calling_settings_speakers")),i.createElement(o.CallSettingsSelect,{id:"speakers",devices:e.speakers,selectedDeviceId:e.selectedSpeakerId,onSelectedDeviceChanged:e.onSpeakerSelected}))}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onSelectionChange=function(e){var n=e.target.value;t.props.onSelectedDeviceChanged(n)},t}return r(t,e),t.prototype.render=function(){var e=this;return a.createElement("select",{id:this.props.id,value:this.props.selectedDeviceId,onChange:this._onSelectionChange},this.props.devices.map(function(t){var n=e.props.selectedDeviceId===t.id;return a.createElement("option",{key:t.id,label:t.label,value:t.id,selected:n},t.label)}))},t}(o.Component);t.CallSettingsSelect=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),s=n(9),c=n(409),l=n(410),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onClick=function(e){e.stopPropagation(),t.props.onClick&&t.props.onClick()},t}return r(t,e),t.prototype.render=function(){var e=this,t=this.props.orderedParticipants.map(function(t){return s.createElement(l.CallParticipant,o({key:t.participant.id},t,{onClick:e._getParticipantClickHandler(t.onClick)}))});return this.props.hiddenCount&&t.push(s.createElement(c.AggregateCallParticipant,{count:this.props.hiddenCount,order:this.props.maxQueueCapacity-1,onClick:this.props.onAggregateClick})),s.createElement("div",{id:"remoteVideoStage",className:"video","data-capacity":this.props.capacity,onClick:this._onClick},t)},t.prototype._getParticipantClickHandler=function(e){var t=this;return function(n,i){!i&&e&&e(n,i),t.props.onClick&&t.props.onClick()}},t}(a.Component);t.VideoStage=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9);t.AggregateCallParticipant=function(e){return i.createElement("div",{className:"participantWrapper participantWrapper_aggregate","data-order":e.order},i.createElement("div",{className:"avatar initials",onClick:e.onClick},"+"+e.count))}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=n(76),l=n(411),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onClick=function(){var e=t.props.participant.id;t.props.onClick(e,t.props.isOnStage)},t}return r(t,e),t.prototype.render=function(){var e=this.props.participant.id,t=s.default.instance.Persons.getPerson(e),n=this.props.isOnStage&&this.props.isIncomingVideoEnabled,i=this._getSharingStream(),r=n&&i&&i.isAvailable,o=this._getVideoStream(),u=n&&!r&&o&&o.isAvailable,d=["participantWrapper"];return this.props.isOnStage&&d.push("onstage"),this.props.isActiveSpeaker&&d.push("active"),this.props.hideInQueue&&d.push("hidden"),r||u||d.push("novideo"),a.createElement("div",{className:d.join(" "),"data-order":this.props.order},a.createElement(c.PersonAvatar,{person:t,onClick:this._onClick}),r&&a.createElement(l.VideoStream,{participantId:e,stream:i}),u&&a.createElement(l.VideoStream,{participantId:e,stream:o}))},t.prototype._getVideoStream=function(){return this.props.participant.streams[0][0]},t.prototype._getSharingStream=function(){return this.props.participant.streams[1][0]},t}(o.Component);t.CallParticipant=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.stream.start(this._element).then(function(t){e._renderer=t})},t.prototype.componentWillUnmount=function(){this._renderer&&(this._renderer.dispose(),this._renderer=null)},t.prototype.render=function(){var e=this,t=this.props.stream.type,n="stream_"+this.props.participantId,i="streamWrapper";return i+=1===t?" sharing":" normal",a.createElement("div",{id:n,className:i,ref:function(t){return e._element=t}})},t}(o.Component);t.VideoStream=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(0);t.Watermark=function(){var e=r.swc.Assets.SVG;return i.createElement("div",{className:"watermark",dangerouslySetInnerHTML:{__html:e.iconWatermark}})}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=n(0),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onStartCallClick=function(e){t.props.onStartCall(e)},t}return r(t,e),t.prototype.render=function(){var e=c.swc.Assets.SVG;return a.createElement("div",{className:"callStartButtons"},a.createElement("button",{id:"startAudioCall",title:s.default.instance.i18n.fetch("calling_button_startAudio"),onClick:o.linkEvent(!1,this._onStartCallClick),dangerouslySetInnerHTML:{__html:e.iconAudio}}),a.createElement("button",{id:"startVideoCall",title:s.default.instance.i18n.fetch("calling_button_startVideo"),onClick:o.linkEvent(!0,this._onStartCallClick),dangerouslySetInnerHTML:{__html:e.iconVideoCall}}))},t}(o.Component);t.CallStartPanel=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(415);t.IncomingCalls=function(e){return i.createElement("ul",{className:"incomingCalls"},e.calls.map(function(t){return i.createElement(r.IncomingCall,{key:t.mri,call:t,onCallAccept:e.onCallAccept,onCallReject:e.onCallReject})}))}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(9),s=n(1),c=n(0),l=function(e){function t(t){var n=e.call(this,t)||this;return n._onAudioCallAccept=function(){n.props.onCallAccept(n.props.call,!1)},n._onVideoCallAccept=function(){n.props.onCallAccept(n.props.call,!0)},n._onCallReject=function(){n.props.onCallReject(n.props.call)},n.state={title:""},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.call.getThreadInfo().then(function(t){e.setState({title:t.displayName})})},t.prototype.render=function(){var e=c.swc.Assets.SVG;return a.createElement("li",null,a.createElement("h3",{className:"name"},this.state.title),a.createElement("div",{className:"avatar"}),a.createElement("div",{className:"incomingCallButtons","data-test-id":"incomingCallButtons"},a.createElement("button",{class:"accept-audio",title:s.default.instance.i18n.fetch("calling_button_acceptWithAudio"),dangerouslySetInnerHTML:{__html:e.iconAudio},onClick:this._onAudioCallAccept}),a.createElement("button",{class:"accept-video",title:s.default.instance.i18n.fetch("calling_button_acceptWithVideo"),dangerouslySetInnerHTML:{__html:e.iconVideoCall},onClick:this._onVideoCallAccept}),a.createElement("button",{class:"reject",title:s.default.instance.i18n.fetch("calling_button_reject"),dangerouslySetInnerHTML:{__html:e.iconHangup},onClick:this._onCallReject})))},t}(o.Component);t.IncomingCall=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=10,r=33,o=10,a=5,s=function(){function e(){}return e.shouldShowCallRate=function(e,t){if(t/1e3<a)return!1;if("voicemail"===e.forwardingDestinationType)return!1;var s,c,l,u=e.isGroup?o:e.isPstn?r:i;return(s=e.callId,l=s,((c=n(417)("sha256").update(l).digest())[0]<<24|c[1]<<16|c[2]<<8|c[3]<<0)>>>0)%100<u},e}();t.CallRateUtils=s},function(e,t,n){(t=e.exports=function(e){e=e.toLowerCase();var n=t[e];if(!n)throw new Error(e+" is not supported (we accept pull requests)");return new n}).sha=n(418),t.sha1=n(423),t.sha224=n(424),t.sha256=n(345),t.sha384=n(425),t.sha512=n(346)},function(e,t,n){var i=n(84),r=n(85),o=n(63).Buffer,a=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function c(){this.init(),this._w=s,r.call(this,64,56)}function l(e){return e<<30|e>>>2}function u(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(c,r),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,o=0|this._c,s=0|this._d,c=0|this._e,d=0;d<16;++d)n[d]=e.readInt32BE(4*d);for(;d<80;++d)n[d]=n[d-3]^n[d-8]^n[d-14]^n[d-16];for(var p=0;p<80;++p){var h=~~(p/20),f=0|((t=i)<<5|t>>>27)+u(h,r,o,s)+c+n[p]+a[h];c=s,s=o,o=l(r),r=i,i=f}this._a=i+this._a|0,this._b=r+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n(420),r=n(421),o=n(422);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,n)}function l(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=p(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),r=(e=s(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|h(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?s(e,0):p(e,t);if("Buffer"===t.type&&o(t.data))return p(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=s(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=s(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function h(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(i)return G(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function m(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:_(e,t,n,i,r);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,i,r){var o,a=1,s=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var u=-1;for(o=n;o<s;o++)if(l(e,o)===l(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var d=!0,p=0;p<c;p++)if(l(e,o+p)!==l(t,p)){d=!1;break}if(d)return o}return-1}function v(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function y(e,t,n,i){return B(G(t,e.length-n),e,n,i)}function S(e,t,n,i){return B(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function E(e,t,n,i){return S(e,t,n,i)}function T(e,t,n,i){return B(j(t),e,n,i)}function C(e,t,n,i){return B(function(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function I(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,c,l=e[r],u=null,d=l>239?4:l>223?3:l>191?2:1;if(r+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)>127&&(u=c);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&(c=(15&l)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=d}return function(e){var t=e.length;if(t<=b)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=b));return n}(i)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,i){return u(t),t<=0?s(e,t):void 0!==n?"string"==typeof i?s(e,t).fill(n,i):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=c.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):function(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,i,r){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var o=r-i,a=n-t,s=Math.min(o,a),l=this.slice(i,r),u=e.slice(t,n),d=0;d<s;++d)if(l[d]!==u[d]){o=l[d],a=u[d];break}return o<a?-1:a<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},c.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function R(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function P(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=H(e[o]);return r}function N(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function w(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,i,r,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function k(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function D(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function L(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,i,o){return o||L(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function x(e,t,n,i,o){return o||L(e,0,n,8),r.write(e,t,n,i,52,8),n+8}c.prototype.slice=function(e,t){var n,i=this.length;if(e=~~e,t=void 0===t?i:~~t,e<0?(e+=i)<0&&(e=0):e>i&&(e=i),t<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var r=t-e;n=new c(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||w(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||w(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},c.prototype.readUInt8=function(e,t){return t||w(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||w(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||w(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||w(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||w(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||w(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||w(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||w(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||w(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||w(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||w(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||w(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||M(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||M(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return x(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return x(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=c.isBuffer(e)?e:G(new c(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(22))},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){for(var t,n=l(e),i=n[0],a=n[1],s=new o(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),c=0,u=a>0?i-4:i,d=0;d<u;d+=4)t=r[e.charCodeAt(d)]<<18|r[e.charCodeAt(d+1)]<<12|r[e.charCodeAt(d+2)]<<6|r[e.charCodeAt(d+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;2===a&&(t=r[e.charCodeAt(d)]<<2|r[e.charCodeAt(d+1)]>>4,s[c++]=255&t);1===a&&(t=r[e.charCodeAt(d)]<<10|r[e.charCodeAt(d+1)]<<4|r[e.charCodeAt(d+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t);return s},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],a=0,s=n-r;a<s;a+=16383)o.push(u(e,a,a+16383>s?s:a+16383));1===r?(t=e[n-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return o.join("")};for(var i=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)i[s]=a[s],r[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var r,o,a=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(i[(o=r)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var o,a,s=8*r-i-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?r-1:0,p=n?-1:1,h=e[t+d];for(d+=p,o=h&(1<<-u)-1,h>>=-u,u+=s;u>0;o=256*o+e[t+d],d+=p,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=i;u>0;a=256*a+e[t+d],d+=p,u-=8);if(0===o)o=1-l;else{if(o===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,i),o-=l}return(h?-1:1)*a*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var a,s,c,l=8*o-r-1,u=(1<<l)-1,d=u>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=u?(s=0,a=u):a+d>=1?(s=(t*c-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+h]=255&s,h+=f,s/=256,r-=8);for(a=a<<r|s,l+=r;l>0;e[n+h]=255&a,h+=f,a/=256,l-=8);e[n+h-f]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var i=n(84),r=n(85),o=n(63).Buffer,a=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function c(){this.init(),this._w=s,r.call(this,64,56)}function l(e){return e<<5|e>>>27}function u(e){return e<<30|e>>>2}function d(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(c,r),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,o=0|this._c,s=0|this._d,c=0|this._e,p=0;p<16;++p)n[p]=e.readInt32BE(4*p);for(;p<80;++p)n[p]=(t=n[p-3]^n[p-8]^n[p-14]^n[p-16])<<1|t>>>31;for(var h=0;h<80;++h){var f=~~(h/20),g=l(i)+d(f,r,o,s)+c+n[h]+a[f]|0;c=s,s=o,o=u(r),r=i,i=g}this._a=i+this._a|0,this._b=r+this._b|0,this._c=o+this._c|0,this._d=s+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=o.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},function(e,t,n){var i=n(84),r=n(345),o=n(85),a=n(63).Buffer,s=new Array(64);function c(){this.init(),this._w=s,o.call(this,64,56)}i(c,r),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=a.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c},function(e,t,n){var i=n(84),r=n(346),o=n(85),a=n(63).Buffer,s=new Array(160);function c(){this.init(),this._w=s,o.call(this,128,112)}i(c,r),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=a.allocUnsafe(48);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(18),a=n(20),s=n(347),c=function(e){function t(t,n,i){var r=e.call(this)||this;return r._calls=[],r._incomingCalls=[],r._registry=t.getCallRegistry(),r._registry.init({id:n,displayName:n,tokenProvider:i}),r._changedSubscription=r._registry.changed(function(){var e=r._registry.calls.filter(function(e){return!r._findCall(e)});e.forEach(function(e){var t=new s.CallWrapper(e);r._addCall(t)}),e[0]&&r._updateIncomingCalls()}),r}return r(t,e),Object.defineProperty(t.prototype,"incomingCalls",{get:function(){return this._incomingCalls},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentCall",{get:function(){return this._currentCall},set:function(e){if(e){var t=this._findCall(e.getRawCall());t&&t!==e&&(e=t),t||this._addCall(e)}this._currentCall=e,this.publish("currentCall",e)},enumerable:!0,configurable:!0}),t.prototype._addCall=function(e){var t=this,n=e.getRawCall();this._calls.push(e),e.addSub(n.on("callStateChanged",function(){return t._onCallStateChanged(e)}))},t.prototype.dispose=function(){this._changedSubscription.dispose(),this._registry=null,e.prototype.dispose.call(this)},t.prototype._onCallStateChanged=function(e){var t=this;e.isBlocked().then(function(n){n||t.publish("callStateChanged",e)}),this._updateIncomingCalls()},t.prototype._findCall=function(e){return this._calls.filter(function(t){return t.getRawCall()===e})[0]},t.prototype.findCallById=function(e){return this._calls.filter(function(t){return t.callId===e})[0]},t.prototype.findCallByThreadId=function(e){return this._calls.filter(function(t){return t.threadId===e})[0]},t.prototype.createAndCall=function(e,t,n){var i=this._registry.createCall(e,a.guid.generate()),r=this._findCall(i);return t?r.callGroup(e,n):e&&r.callCalee(e,n),this.currentCall=r,r},t.prototype._updateIncomingCalls=function(){var e=this,t=this._calls.filter(function(e){return 1===e.state});Promise.all(t.map(function(e){return e.isBlocked()})).then(function(n){e._incomingCalls=t.filter(function(e,t){return!n[t]}),e.publish("incomingCalls",e.incomingCalls)})},t.prototype.deleteCall=function(e){this._registry.deleteCall(e.getRawCall());var t=this._calls.indexOf(e);-1!==t&&this._calls.splice(t,1),this.currentCall&&e.getRawCall()===this.currentCall.getRawCall()&&(this.currentCall=void 0),this.publish("callDeleted",e),e.dispose()},t}(o.default);t.CallRegistry=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(0),o=function(){function e(e,t){var n=this;this._call=e,this._stageChanged=t,this._maxStageCapacity=1,this._minStageCapacity=1,this._maxQueueCapacity=3,this._isManualMode=!1,this._participantMap={},this._subscribtionMap={},this._participantsOrder=[],this._stageCapacity=1,this._isIncomingVideoEnabled=!0,this._onParticipantClick=function(e){n._updateStage(e)}}return Object.defineProperty(e.prototype,"isVideoAvailable",{get:function(){var t=this;return this._participantsOrder.some(function(n){var i=t._participantMap[n];return e._hasVideoAvailable(i)})},enumerable:!0,configurable:!0}),e.prototype.setMaxStageCapacity=function(e){this._maxStageCapacity!==e&&(this._isManualMode=!1,this._maxStageCapacity=e,this._updateStage())},e.prototype.updateParticipants=function(e){var t=this,n=e.filter(function(e){return!t._participantMap[e.id]}),i=this._participantsOrder.filter(function(t){return!e.filter(function(e){return e.id===t}).length});(n.length||i.length)&&(n.length&&n.forEach(function(e){t._add(e)}),i.length&&i.forEach(function(e){t._remove(e)}),this._isManualMode=!1,this._updateStage())},e.prototype.toggleIncomingVideo=function(e){this._isIncomingVideoEnabled!==e&&(this._isIncomingVideoEnabled=e,this._updateStage())},e.prototype.dispose=function(){var e=this;this._call=null,this._participantsOrder.forEach(function(t){delete e._participantMap[t],e._subscribtionMap[t].dispose(),delete e._subscribtionMap[t]}),this._participantsOrder=[]},e._hasVideoAvailable=function(t){return e._hasSharingAvailable(t)||e._hasCameraVideoAvailable(t)},e._hasSharingAvailable=function(e){if(!e)return!1;var t=e.streams[1][0];return t&&t.isAvailable},e._hasCameraVideoAvailable=function(e){if(!e)return!1;var t=e.streams[0][0];return t&&t.isAvailable},e.prototype._add=function(e){var t=this,n=e.changed(function(){t._updateStage()});this._subscribtionMap[e.id]=n,this._participantMap[e.id]=e,this._participantsOrder.unshift(e.id)},e.prototype._remove=function(e){var t=this._subscribtionMap[e],n=this._participantMap[e];if(t&&(t.dispose(),delete this._subscribtionMap[e]),n){var i=this._participantsOrder.indexOf(e);this._participantsOrder.splice(i,1),delete this._participantMap[e]}},e.prototype._updateStage=function(e){e&&(this._isManualMode=!0);var t=this._getCallDominantSpeakers();this._updateStageCapacity(e),this._updateParticipantsOrder(t,e)},e.prototype._getCallDominantSpeakers=function(){var e=this._call.dominantSpeakerInfo.speakerList;return r.swcWindow.swc.API.triggerEvent(i.ApiEvents.DominantSpeakerChanged,e),e.slice()},e.prototype._updateStageCapacity=function(t){var n=this;if(!this._isManualMode||t){var i=0,r=0;this._participantsOrder.forEach(function(o){var a=n._participantMap[o];e._hasVideoAvailable(a)?r++:o===t&&(i=1)});var o=Math.max(this._minStageCapacity,Math.min(this._maxStageCapacity,this._participantsOrder.length,r+i));this._stageCapacity=o}},e.prototype._updateParticipantsOrder=function(e,t){var n=this;if(t){var i=this._participantsOrder.indexOf(t);i>=0&&this._participantsOrder.splice(i,1),this._participantsOrder.unshift(t)}if(!this._isManualMode){var r=this._getParticipantsComparator(e);this._participantsOrder.sort(r)}var o=this._participantsOrder.length-this._stageCapacity-this._maxQueueCapacity>0,a=0,s=this._participantsOrder.map(function(t,i){var r=n._participantMap[t],s=i<n._stageCapacity,c=e.indexOf(t)>=0,l=o&&i>=n._stageCapacity+n._maxQueueCapacity-1;return l&&a++,{order:s?i:i-n._stageCapacity,isOnStage:s,isActiveSpeaker:c,hideInQueue:l,isIncomingVideoEnabled:n._isIncomingVideoEnabled,participant:r,onClick:n._onParticipantClick}});this._stageChanged({capacity:this._stageCapacity,maxQueueCapacity:this._maxQueueCapacity,hiddenCount:a,orderedParticipants:s})},e.prototype._getParticipantsComparator=function(t){var n=this;return function(i,r){var o=n._participantMap[i],a=n._participantMap[r],s=t.indexOf(i),c=t.indexOf(r),l=s>=0,u=c>=0;return e._hasSharingAvailable(o)&&!e._hasSharingAvailable(a)?-1:!e._hasSharingAvailable(o)&&e._hasSharingAvailable(a)?1:e._hasCameraVideoAvailable(o)&&!e._hasCameraVideoAvailable(a)?-1:!e._hasCameraVideoAvailable(o)&&e._hasCameraVideoAvailable(a)?1:l&&u?s-c:c-s}},e}();t.CallStage=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(18),s=n(429),c=function(e){function t(t,n){var i=e.call(this)||this;return i._selectedDevices={},i._updateDevices=function(e){var t=i._deviceManager.getSelectedDevices();i._cameras=e.filter(function(e){return 1===e.kind}),i._speakers=e.filter(function(e){return 3===e.kind}),i._microphones=e.filter(function(e){return 2===e.kind}),i.publish("cameras",i._cameras),i.publish("speakers",i._speakers),i.publish("microphones",i._microphones),i.publish("selectedDevices",t)},i.selectCamera=function(e){i._selectedDevices.camera=e,i._deviceManager.selectDevices(i._selectedDevices),i.publish("selectedDevices",i._selectedDevices),i._sendEvent("camera",i._cameras.length)},i.selectSpeaker=function(e){i._selectedDevices.speaker=e,i._deviceManager.selectDevices(i._selectedDevices),i.publish("selectedDevices",i._selectedDevices),i._sendEvent("speaker",i._speakers.length)},i.selectMicrophone=function(e){i._selectedDevices.microphone=e,i._deviceManager.selectDevices(i._selectedDevices),i.publish("selectedDevices",i._selectedDevices),i._sendEvent("microphone",i._microphones.length)},i._deviceManager=t,n||(n={}),i.deviceEnumerationPromise=i._deviceManager.enumerateDevicesAsync().then(function(e){var t=i._deviceManager.getSelectedDevices(),r=e.filter(function(e){return 1===e.kind})[0]||{},o=e.filter(function(e){return 3===e.kind})[0]||{},a=e.filter(function(e){return 2===e.kind})[0]||{},s={camera:n.camera&&i.getDeviceId(n.camera,e,1),microphone:n.microphone&&i.getDeviceId(n.microphone,e,2),speaker:n.speaker&&i.getDeviceId(n.speaker,e,3)};i._selectedDevices={microphone:s.microphone||t.microphone||a.id,speaker:s.speaker||t.speaker||o.id,camera:s.camera||t.camera||r.id},i._deviceManager.selectDevices(i._selectedDevices),i._updateDevices(e),i._deviceManager.on("devicesChanged",i._updateDevices)}),i}return r(t,e),Object.defineProperty(t.prototype,"selectedDevices",{get:function(){return this._selectedDevices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"microphones",{get:function(){return this._microphones},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameras",{get:function(){return this._cameras},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speakers",{get:function(){return this._speakers},enumerable:!0,configurable:!0}),t.prototype.getDeviceManager=function(){return this._deviceManager},t.prototype.askDevicePermission=function(e){return this._deviceManager.askDevicePermission(e)},t.prototype.getDeviceId=function(e,t,n){e.indexOf(":")>-1&&(e=e.split(":")[1]);var i=t.filter(function(t){var i=t.browserId;return i.indexOf(":")>-1&&(i=i.split(":")[1]),t.kind===n&&i===e})[0];return i&&i.id},t.prototype._sendEvent=function(e,t){var n=new s.default(e);n.available=t,o.default.instance.TelemetryService.sendEvent(n)},t}(a.default);t.Devices=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=function(e){function t(t){var n=e.call(this,"kpi_device_change")||this;return n.deviceType=t,n}return r(t,e),t.prototype.getCustomProperties=function(){var e=new Array;return e.push(o.TelemetryPropertyValue.Create("deviceType",this.deviceType)),e.push(o.TelemetryPropertyValue.Create("availableQty",this.available)),e},t}(n(8).TelemetryEvent);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.OFFSET_LEFT=234,this.OFFSET_TOP=140,this.OFFSET_INFO=80,this.ARROW_TEXT_TOP=20}return e.prototype.show=function(e,t){if(!this.active){var n=t.top-this.OFFSET_TOP+this.OFFSET_INFO,i=n+this.ARROW_TEXT_TOP,r=t.left-this.OFFSET_LEFT,o='\n            <svg width="'+r+'" height="'+i+'" viewBox="0 0 '+r+" "+i+'" xmlns="http://www.w3.org/2000/svg">\n                <path d="M10 10 '+("C 10 "+i+","+r+" "+i+","+r+" "+i)+' M8 15 L10 10 L13 15" stroke-dasharray="4,2" vector-effect="non-scaling-stroke" stroke-width="1" stroke="black" fill="transparent"/>\n            </svg>';this.guide||(this.guide=document.createElement("div"),this.guide.className="swc-guide",this.arrow=document.createElement("div"),this.arrow.className="arrow",this.text=document.createElement("p"),this.text.className="text",this.guide.appendChild(this.arrow),this.guide.appendChild(this.text)),this.arrow.innerHTML=o,this.text.style.top=n+"px",this.text.style.left=r+"px",this.text.style.width=t.width+"px",this.text.innerText=e,document.body.appendChild(this.guide)}},e.prototype.hide=function(){if(this.guide){var e=this.guide.parentElement;e&&e.removeChild(this.guide)}},e}();t.Guide=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this._callbacks={},this.state=0,this.getCall=function(){return t._call},this._call=e,this.state=this._call.state,this._call.on("callStateChanged",function(){t.state=t._call.state,t._trigger("callStateChanged",t.state)})}return e.prototype._trigger=function(e,t){void 0!==this._callbacks[e]&&this._callbacks[e].map(function(e){return e}).forEach(function(e){e(t)})},e.prototype.on=function(e,t){void 0===this._callbacks[e]&&(this._callbacks[e]=[]),this._callbacks[e].push(t)},e.prototype.off=function(e,t){if(void 0!==this._callbacks[e]){var n=this._callbacks[e].indexOf(t);n>-1&&this._callbacks[e].splice(n,1)}},e.prototype.start=function(e){return this._call.start(e)},e.prototype.stop=function(){return this._call.stop()},e.prototype.startLocalVideo=function(){return this._call.startVideo()},e.prototype.stopLocalVideo=function(){return this._call.stopVideo()},e.prototype.mute=function(){return this._call.mute()},e.prototype.unmute=function(){return this._call.unmute()},e.prototype.accept=function(e){return this._call.accept({withVideo:!!e})},e.prototype.reject=function(){return this._call.reject()},e}();t.SWCall=i}]);
