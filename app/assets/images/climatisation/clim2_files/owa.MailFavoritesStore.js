window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['owa.MailFavoritesStore.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[64],{2660:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(0);t.default=function(e){return o.__assign({__type:"UpdateFavoriteFolderRequest:#Exchange"},e)}},2797:function(e,t,r){"use strict";r.d(t,"a",function(){return l});var o=r(351),a=r.n(o),n=r(71),i=r.n(n),s=r(2660),d=r.n(s),c=r(2976),u=r.n(c);function l(e,t){var r,o,n,s=(r=e,o=t,n=i()({Id:r.FolderId.Id,ChangeKey:r.FolderId.ChangeKey}),d()({Folder:a()({FolderId:n,DisplayName:r.DisplayName}),Operation:o?0:1}));return u()({request:s}).then(function(e){return e})}},2798:function(e,t,r){"use strict";var o=r(3);t.a=Object(o.action)("ADD_FAVORITE_FOLDER_V2",function(e){return{folderIdToAdd:e}})},2976:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(38),a=r(2660);t.default=function(e,t){return void 0===e.request||e.request.__type||(e.request=a.default(e.request)),o.makeServiceRequest("UpdateFavoriteFolder",e,t)}},2977:function(e,t,r){"use strict";r.d(t,"a",function(){return c});var o=r(0),a=r(2798),n=r(12),i=r(104),s=r(3),d=r(31);Object(s.orchestrator)(a.a,function(e){return o.__awaiter(void 0,void 0,void 0,function(){var t,r,a,s,u,l=this;return o.__generator(this,function(v){switch(v.label){case 0:return t=e.folderIdToAdd,r=n.n.folderTable.get(t),a=Object(i.getGuid)(),b=!1,s={treeType:"favorites",type:"folder",favoriteId:a,displayName:(f=r).DisplayName,folderId:f.FolderId.Id,client:b?"Migration":"OWA"},[4,d.K.import()];case 1:return v.sent()(s),u=c(r,!1),Object(d.i)(u).then(function(e){return o.__awaiter(l,void 0,void 0,function(){var t;return o.__generator(this,function(r){switch(r.label){case 0:return t=Object(d.f)(e,"folder"),[4,d.G.import()];case 1:return r.sent()(s,t),[2]}})})}).catch(function(e){return o.__awaiter(l,void 0,void 0,function(){return o.__generator(this,function(t){switch(t.label){case 0:return[4,d.H.import()];case 1:return t.sent()(e.message,s),[2]}})})}),[2]}var f,b})})});function c(e,t){return{Type:"folder",DisplayName:e.DisplayName,SingleValueSettings:[{Key:"FolderId",Value:Object(d.c)(e.FolderId.Id)}],Client:t?"Migration":"OWA"}}},5605:function(e,t,r){"use strict";r.r(t);var o=r(3),a=r(8),n=r(51),i=1e4,s={folderId:"",timeRemoved:null};function d(e){s={folderId:e,timeRemoved:new Date}}var c=Object(o.action)("ADD_FAVORITE_FOLDER",function(e,t){return{folderIdToAdd:e,actionSource:t,datapointConfig:{name:Object(a.c)("tri-favorites-roaming")?"AddOutlookFavoriteFolder":"AddFavoriteFolder",customData:{actionSource:t,distinguishedFolderName:Object(n.a)(e),wasFolderUnfavoritedRecently:(r=e,!(!s.folderId||s.folderId!=r)&&(new Date).getTime()-s.timeRemoved.getTime()<i)}}};var r}),u=r(2797),l=r(12),v=r(4),f=r(31),b=Object(v.action)("addFavoriteFolderV1")(Object(v.select)({favoritesFolderNodes:function(){return f.l.favoritesFolderNodes},orderedFavoritesNodeIds:function(){return f.l.orderedFavoritesNodeIds},folder:function(e){return l.n.folderTable.get(e)}})(function(e,t){if(t.favoritesFolderNodes.has(e))throw new Error("addFavoriteFolderV1: Cannot add duplicate folder to favorites.");t.orderedFavoritesNodeIds.push(e),t.favoritesFolderNodes.set(e,{id:e,type:0}),Object(f.eb)(),Object(u.a)(t.folder,!0)})),m=r(2798),p=(Object(o.orchestrator)(c,function(e){var t=e.folderIdToAdd;Object(a.c)("tri-favorites-roaming")?Object(m.a)(t):b(t)}),r(2977),r(0)),O=r(202),h=Object(o.action)("ADD_FAVORITE_GROUP",function(e,t,r){return{groupSmtp:e,displayName:t,actionSource:r,datapointConfig:{name:O.a.AddFavoriteGroup.datapoint.name,customData:O.a.AddFavoriteGroup.datapoint.customData(e,r)}}}),F=r(104),_=(Object(o.orchestrator)(h,function(e){return p.__awaiter(void 0,void 0,void 0,function(){var t,r,o,a,n,i=this;return p.__generator(this,function(s){switch(s.label){case 0:return t=e.groupSmtp,r=e.displayName,o=Object(F.getGuid)(),a={treeType:"favorites",type:"group",favoriteId:o,displayName:r,groupId:t.toLowerCase(),client:"OWA"},[4,f.K.import()];case 1:return s.sent()(a),n={Type:"group",DisplayName:r,SingleValueSettings:[{Key:"EmailAddress",Value:t}],Index:f.l.orderedOutlookFavoritesIds.length,Client:"OWA"},Object(f.i)(n).then(function(e){return p.__awaiter(i,void 0,void 0,function(){var t;return p.__generator(this,function(r){switch(r.label){case 0:return t=Object(f.f)(e,"group"),[4,f.G.import()];case 1:return r.sent()(a,t),[2]}})})}).catch(function(e){return p.__awaiter(i,void 0,void 0,function(){return p.__generator(this,function(t){switch(t.label){case 0:return[4,f.H.import()];case 1:return t.sent()(e.message,a),[2]}})})}),[2]}})})}),Object(o.action)("REMOVE_FAVORITE_FOLDER",function(e,t){return{folderIdToRemove:e,actionSource:t,datapointConfig:{name:Object(a.c)("tri-favorites-roaming")?"RemoveFavoriteFolderV2":"RemoveFavoriteFolderV1",customData:{actionSource:t,distinguishedFolderName:Object(n.a)(e)}}}})),g=Object(v.action)("removeFavoriteFolderV1")(Object(v.select)({favoritesFolderNodes:function(){return f.l.favoritesFolderNodes},orderedFavoritesNodeIds:function(){return f.l.orderedFavoritesNodeIds},folder:function(e){return l.n.folderTable.get(e)}})(function(e,t){if(!t.favoritesFolderNodes.has(e))throw new Error("removeFavoriteFolderV1: Cannot find the folder id in favorite folder list.");t.orderedFavoritesNodeIds.splice(t.orderedFavoritesNodeIds.indexOf(e),1),t.favoritesFolderNodes.delete(e),Object(f.eb)(),d(e),Object(u.a)(t.folder,!1)})),j=Object(o.action)("REMOVE_FAVORITE_FOLDER_V2",function(e){return{folderIdToRemove:e}}),w=(Object(o.orchestrator)(_,function(e){var t=e.folderIdToRemove;Object(a.c)("tri-favorites-roaming")?j(t):g(t)}),Object(o.orchestrator)(j,function(e){return p.__awaiter(void 0,void 0,void 0,function(){var t,r,o,a=this;return p.__generator(this,function(n){switch(n.label){case 0:return t=e.folderIdToRemove,r=Object(f.p)(t),o=Object(f.m)(r,0),[4,f.S.import()];case 1:return n.sent()(o),d(t),[2,Object(f.k)(r).then(function(){return p.__awaiter(a,void 0,void 0,function(){return p.__generator(this,function(e){switch(e.label){case 0:return[4,f.Q.import()];case 1:return e.sent()(o),[2]}})})}).catch(function(e){return p.__awaiter(a,void 0,void 0,function(){return p.__generator(this,function(t){switch(t.label){case 0:return[4,f.R.import()];case 1:return t.sent()(e.message,o),[2]}})})})]}})})}),Object(o.action)("REMOVE_FAVORITE_GROUP",function(e,t){return{groupIdToRemove:e,actionSource:t,datapointConfig:{name:O.a.RemoveFavoriteGroup.datapoint.name,customData:O.a.RemoveFavoriteGroup.datapoint.customData(e,t)}}})),I=(Object(o.orchestrator)(w,function(e){return p.__awaiter(void 0,void 0,void 0,function(){var t,r,o,a,n=this;return p.__generator(this,function(i){switch(i.label){case 0:if(t=f.l.outlookFavoriteGroups,r=e.groupIdToRemove,o=Object(f.q)(r),a=Object(f.m)(o,2),!t.has(o))throw new Error("removeFavoriteGroup: Cannot find the favorite group in store.");return[4,f.S.import()];case 1:return i.sent()(a),Object(f.k)(o).then(function(){return p.__awaiter(n,void 0,void 0,function(){return p.__generator(this,function(e){switch(e.label){case 0:return[4,f.Q.import()];case 1:return e.sent()(a),[2]}})})}).catch(function(e){return p.__awaiter(n,void 0,void 0,function(){return p.__generator(this,function(t){switch(t.label){case 0:return[4,f.R.import()];case 1:return t.sent()(e.message,a),[2]}})})}),[2]}})})}),r(925)),N=r(103),y=r(84);Object(o.orchestrator)(f.Y,function(e){var t,r,o,a=e.categoryId;I.a(a),t=a,r=Object(N.b)(t),o=Object(y.c)(r,!0),Object(N.j)(o,!1,function(e,r,o,a,n){return i=t,void I.b(i);var i})});Object(o.orchestrator)(f.Z,function(e){I.b(e.categoryId)});var A=r(11),E=r.n(A),T=r(776);function R(e){return p.__awaiter(this,void 0,void 0,function(){var t;return p.__generator(this,function(r){switch(r.label){case 0:return t=e?E.a.favoritesRemoveErrorDescriptionText:E.a.favoritesErrorDescriptionText,[4,T.a.import()];case 1:return r.sent()(t),[2]}})})}function D(e){return p.__awaiter(this,void 0,void 0,function(){var t;return p.__generator(this,function(r){switch(r.label){case 0:return t=e?E.a.favoritesRemoveErrorTitleText:E.a.favoritesErrorTitleText,[4,T.a.import()];case 1:return r.sent()(t),[2]}})})}Object(o.orchestrator)(f.b,function(e){var t=e.favoriteKind;"persona"===t?R(!1):"privatedistributionlist"===t&&D(!1)}),Object(o.orchestrator)(f.cb,function(e){var t=e.favoriteKind;"persona"===t?R(!0):"privatedistributionlist"===t&&D(!0)});var P=Object(v.action)("markFavoritePersonaNodeAsAdded")(Object(v.select)({favoritesPersonaNodes:function(){return f.l.favoritesPersonaNodes}})(function(e,t){var r=t.favoritesPersonaNodes.get(e);r&&(r.isJustAdded=!1)})),S=r(1325),C=r(1333),V=r(9),U=Object(v.action)("validateAndUpdateFavorite",O.a.ValidateAndUpdateFavorite)(function(e){return p.__awaiter(this,void 0,void 0,function(){var t,r,o,a,n,i,s,d,c,u,l,v,b;return p.__generator(this,function(m){switch(m.label){case 0:return t=Object(f.v)(),r=t.favoritesPersonaNodes.get(e),o=Object(f.A)(e)?e:"",r.personaId?(a=Object(C.a)(r.mainEmailAddress,r.displayName,!1),[4,Object(S.a)(r.personaId)]):[3,5];case 1:return(b=m.sent())?(i=b,[3,4]):[3,2];case 2:return[4,a];case 3:i=m.sent(),m.label=4;case 4:return(n=i)?(s=n.DisplayName,d=k(n.EmailAddress),c=(n.EmailAddresses||[]).map(k),u=r.displayName!==s,l=r.mainEmailAddress!==d,p=r.allEmailAddresses,O=c,v=!(p&&O&&p.length===O.length&&p.every(function(e){return O.includes(e)})),u||l||v?(Object(V.n)("ValidateAndUpdateFavorite: Change Detected",["ContactToUpdatedContact",o,u,l,v]),G(r,s,d,c,n.PersonaId.Id),[2,!0]):[2,!1]):(Object(V.n)("ValidateAndUpdateFavorite: Change Detected",["ContactToRecipentCache",o]),G(r,r.displayName,r.mainEmailAddress,r.allEmailAddresses),[2,!0]);case 5:return[4,Object(C.a)(r.mainEmailAddress,r.displayName,!1)];case 6:return(b=m.sent())?(Object(V.n)("ValidateAndUpdateFavorite: Change Detected",["RecipientCacheToContact",o]),G(r,b.DisplayName,k(b.EmailAddress),b.EmailAddresses.map(k),b.PersonaId.Id),[2,!0]):[2,!1];case 7:return[2]}var p,O})})}),G=Object(v.action)("updatePersona")(function(e,t,r,o,a){e.displayName=t||r,e.mainEmailAddress=r,e.allEmailAddresses=o,a?e.personaId=a:delete e.personaId});function k(e){return e?e.RoutingType&&"EX"===e.RoutingType.toUpperCase()?e.OriginalDisplayName:e.EmailAddress||e.OriginalDisplayName:""}var x=r(1315),q=r(92),K=Object(v.action)("updateSelectedNodeWithNewPersona")(function(e){var t=Object(f.v)().favoritesPersonaNodes.get(e),r=Object(q.d)();r.selectedNode=p.__assign({},r.selectedNode,{displayName:t.displayName,mainEmailAddress:t.mainEmailAddress})}),M=r(1174),W=r(7),L=Object(v.action)("onFavoritePersonaSelected",O.a.OnFavoritePersonaSelectedAction)(Object(v.select)({favoritesPersonaNodes:function(){return f.l.favoritesPersonaNodes}})(function(e,t){return p.__awaiter(this,void 0,void 0,function(){var r,o,a,n,i,s,d;return p.__generator(this,function(c){switch(c.label){case 0:if((r=t.favoritesPersonaNodes.get(e)).isSyncUpdateDone)return[2];c.label=1;case 1:return c.trys.push([1,6,,7]),[4,U(r.id)];case 2:return(o=c.sent())&&K(r.id),[4,Object(x.a)(r,"OnClick",o)];case 3:return(a=c.sent())&&setTimeout(function(){Object(M.b)(r.id)},M.a),o||a?[4,Object(f.eb)()]:[3,5];case 4:c.sent(),c.label=5;case 5:return[3,7];case 6:return n=c.sent(),i=O.a.UpdatePersonaAndSearchFolderFailure.datapoint,s=i.name,d=i.customData,W.c.warn(s+": "+n),Object(V.n)(s,d(n.toString())),[3,7];case 7:return[2]}})})})),H=Object(v.action)("onFavoritePersonaUpdated",O.a.OnFavoritePersonaUpdatedAction)(function(e){return p.__awaiter(this,void 0,void 0,function(){var t,r,o;return p.__generator(this,function(a){switch(a.label){case 0:return t=Object(f.v)().favoritesPersonaNodes.get(e),[4,U(t.id)];case 1:return r=a.sent(),[4,Object(x.a)(t,"OnFavoriteUpdate",r)];case 2:return o=a.sent(),r||o?[4,Object(f.eb)()]:[3,4];case 3:a.sent(),a.label=4;case 4:return[2]}})})}),Q=r(384);function $(e){return p.__awaiter(this,void 0,void 0,function(){var t,r,o,a;return p.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e.markedForDeletion?[4,Object(Q.c)([e.searchFolderId],!0)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[3,4];case 3:return t=n.sent(),r=O.a.DeleteFolderFailure.datapoint,o=r.name,a=r.customData,W.c.warn(o+": "+t),Object(V.n)(o,a(t.toString())),[3,4];case 4:return[2]}})})}var B=r(904),J=Object(v.action)("removeFavoritePersona",O.a.RemoveFavoritePersonaAction)(function(e,t){return p.__awaiter(this,void 0,void 0,function(){var t,r,o,a,n,i,s,d,c,u,l,v,b;return p.__generator(this,function(m){switch(m.label){case 0:t=Object(f.v)(),r=t.favoritesPersonaNodes.get(e),o=void 0,a=!1,m.label=1;case 1:if(m.trys.push([1,9,,10]),!r)throw new Error("RemoveFavoritePersona - NodeId could not be found in the store");if(o=r.mainEmailAddress||r.personaId,Object(B.a)(o))throw new Error("RemoveFavoritePersona - Favoriting is already in progress");return I.a(o),a=!0,(n=t.orderedFavoritesNodeIds.indexOf(e))>-1&&t.orderedFavoritesNodeIds.splice(n,1),t.favoritesPersonaNodes.delete(e),[4,Object(f.eb)()];case 2:m.sent(),i=r.searchFolderId,m.label=3;case 3:return m.trys.push([3,7,,8]),i?(s=Object(q.c)()).id!==e?[3,4]:(s.markedForDeletion=!0,[3,6]):[3,6];case 4:return[4,Object(Q.c)([i],!0)];case 5:m.sent(),m.label=6;case 6:return[3,8];case 7:return d=m.sent(),c=O.a.DeleteFolderFailure.datapoint,v=c.name,b=c.customData,W.c.warn(v+": "+d),Object(V.n)(v,b(d.toString())),[3,8];case 8:return I.b(o),[3,10];case 9:throw u=m.sent(),a&&I.b(o),l=O.a.RemoveFavoritePersonaFailure.datapoint,v=l.name,b=l.customData,W.c.warn(v+": "+u),Object(V.n)(v,b(u.toString())),r&&!t.favoritesPersonaNodes.has(r.id)&&(t.orderedFavoritesNodeIds.push(r.id),t.favoritesPersonaNodes.set(r.id,r)),p.__assign({type:"RemoveFavoritePersonaError"},u);case 10:return[2]}})})});function X(e,t){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(r){switch(r.label){case 0:return Object(a.c)("tri-favorites-roaming")?[4,f.T.import()]:[3,2];case 1:return r.sent()(e,t),[3,4];case 2:return[4,J(e,t)];case 3:return[2,r.sent()];case 4:return[2]}})})}var Y=Object(v.action)("RemoveFavoriteSearch",O.a.RemoveFavoriteSearch)(function(e,t){var r=Object(f.v)();if(!r.favoriteSearches.has(e))throw new Error("Cannot find the search query in favorite search list.");r.orderedFavoritesNodeIds.splice(r.orderedFavoritesNodeIds.indexOf(e),1),r.favoriteSearches.delete(e),Object(f.eb)()}),Z=r(106),z=r.n(Z),ee=r(60),te=r.n(ee),re=r(6),oe=r(134),ae=Object(v.action)("toggleFavoritesTreeExpansion")(function(){var e=Object(re.a)().UserOptions;e.IsFavoritesFolderTreeCollapsed=!e.IsFavoritesFolderTreeCollapsed,Object(oe.a)("OWA.UserOptions",[z()({DictionaryKey:te()({Type:"String",Value:["IsFavoritesFolderTreeCollapsed"]}),DictionaryValue:te()({Type:"Boolean",Value:[String(e.IsFavoritesFolderTreeCollapsed)]})})])});r.d(t,"addFavoriteFolder",function(){return c}),r.d(t,"removeFavoriteFolder",function(){return _}),r.d(t,"addFavoriteGroup",function(){return h}),r.d(t,"removeFavoriteGroup",function(){return w}),r.d(t,"markFavoritePersonaNodeAsAdded",function(){return P}),r.d(t,"onFavoritePersonaSelected",function(){return L}),r.d(t,"onFavoritePersonaUpdated",function(){return H}),r.d(t,"onSelectedPersonaNodeChanged",function(){return $}),r.d(t,"removeFavoritePersona",function(){return X}),r.d(t,"handleToggleFavoritePersonaError",function(){return R}),r.d(t,"removeFavoriteSearch",function(){return Y}),r.d(t,"toggleFavoritesTreeExpansion",function(){return ae})}},0,[6,7,25,34,57,0,3,4,9,52,1,2,51,19,60,8,11,55,201,223,56,218,225,232,216,54]]);
//# sourceMappingURL=owa.MailFavoritesStore.js.map
window.scriptsLoaded['owa.MailFavoritesStore.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['owa.MailFavoritesStore.js'] = (new Date()).getTime();